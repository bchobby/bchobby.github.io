<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SystemUI流程分析 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SystemUI流程分析" />
<meta property="og:description" content="在前面的Android中getSystemService流程中，我们知道在系统启动的时候，会启动一些系统的必要服务，SystemUI也是在SystemServer#startOtherServices这里启动的
SystemUI启动时机 static final void startSystemUi(Context context, WindowManagerService windowManager) { Intent intent = new Intent(); intent.setComponent(new ComponentName(&#34;com.android.systemui&#34;, &#34;com.android.systemui.SystemUIService&#34;)); intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING); //Slog.d(TAG, &#34;Starting service: &#34; &#43; intent); context.startServiceAsUser(intent, UserHandle.SYSTEM); windowManager.onSystemUiStarted(); } 上面启动了SystemUIService服务，下面看看那SystemUIService服务具体做了什么
public class SystemUIService extends Service { @Override public void onCreate() { super.onCreate(); ((SystemUIApplication) getApplication()).startServicesIfNeeded(); } } SystemUIApplication#startServicesIfNeeded
public void startServicesIfNeeded() { startServicesIfNeeded(SERVICES); } private void startServicesIfNeeded(Class&lt;?&gt;[] services) { .... final int N = services.length; for (int i = 0; i &lt; N; i&#43;&#43;) { Class&lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/06bfa7f726126dd645a93d4c94985e53/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-02-19T14:10:59+08:00" />
<meta property="article:modified_time" content="2018-02-19T14:10:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SystemUI流程分析</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在前面的<a href="http://blog.csdn.net/mockingbirds/article/details/53048209">Android中getSystemService流程</a>中，我们知道在系统启动的时候，会启动一些系统的必要服务，SystemUI也是在SystemServer#startOtherServices这里启动的</p> 
<h3 id="systemui启动时机">SystemUI启动时机</h3> 
<pre class="prettyprint"><code class=" hljs avrasm">static final void startSystemUi(Context context, WindowManagerService windowManager) {
        Intent intent = new Intent()<span class="hljs-comment">;</span>
        intent<span class="hljs-preprocessor">.setComponent</span>(new ComponentName(<span class="hljs-string">"com.android.systemui"</span>,
                    <span class="hljs-string">"com.android.systemui.SystemUIService"</span>))<span class="hljs-comment">;</span>
        intent<span class="hljs-preprocessor">.addFlags</span>(Intent<span class="hljs-preprocessor">.FLAG</span>_DEBUG_TRIAGED_MISSING)<span class="hljs-comment">;</span>
        //Slog<span class="hljs-preprocessor">.d</span>(TAG, <span class="hljs-string">"Starting service: "</span> + intent)<span class="hljs-comment">;</span>
        context<span class="hljs-preprocessor">.startServiceAsUser</span>(intent, UserHandle<span class="hljs-preprocessor">.SYSTEM</span>)<span class="hljs-comment">;</span>
        windowManager<span class="hljs-preprocessor">.onSystemUiStarted</span>()<span class="hljs-comment">;</span>
}</code></pre> 
<p>上面启动了SystemUIService服务，下面看看那SystemUIService服务具体做了什么</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemUIService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> {<!-- --></span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>() {
        <span class="hljs-keyword">super</span>.onCreate();
        ((SystemUIApplication) getApplication()).startServicesIfNeeded();
    }

}
</code></pre> 
<p><strong>SystemUIApplication#startServicesIfNeeded</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startServicesIfNeeded</span>() {
        startServicesIfNeeded(SERVICES);
}</code></pre> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startServicesIfNeeded</span>(Class&lt;?&gt;[] services) {
    ....

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> N = services.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++) {
            Class&lt;?&gt; cl = services[i];
            <span class="hljs-keyword">if</span> (DEBUG) Log.d(TAG, <span class="hljs-string">"loading: "</span> + cl);
            log.traceBegin(<span class="hljs-string">"StartServices"</span> + cl.getSimpleName());
            <span class="hljs-keyword">long</span> ti = System.currentTimeMillis();
            <span class="hljs-keyword">try</span> {

                Object newService = SystemUIFactory.getInstance().createInstance(cl);
                mServices[i] = (SystemUI) ((newService == <span class="hljs-keyword">null</span>) ? cl.newInstance() : newService);
            } <span class="hljs-keyword">catch</span> (IllegalAccessException ex) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(ex);
            } <span class="hljs-keyword">catch</span> (InstantiationException ex) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(ex);
            }

            mServices[i].mContext = <span class="hljs-keyword">this</span>;
            mServices[i].mComponents = mComponents;
            <span class="hljs-keyword">if</span> (DEBUG) Log.d(TAG, <span class="hljs-string">"running: "</span> + mServices[i]);
            mServices[i].start();  <span class="hljs-comment">// 分别调用每个类的start方法</span>

        }
}</code></pre> 
<p>这里以快捷开关栏SystemBars为例，举例说明：</p> 
<h3 id="快捷开关栏加载流程">快捷开关栏加载流程</h3> 
<p><strong>SystemBars#start</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span>() {
        <span class="hljs-keyword">if</span> (DEBUG) Log.d(TAG, <span class="hljs-string">"start"</span>);
        createStatusBarFromConfig();
    }</code></pre> 
<p><strong>SystemBars#createStatusBarFromConfig</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createStatusBarFromConfig</span>() {
        <span class="hljs-keyword">if</span> (DEBUG) Log.d(TAG, <span class="hljs-string">"createStatusBarFromConfig"</span>);
        final String clsName = mContext.getString(R.<span class="hljs-keyword">string</span>.config_statusBarComponent);
        <span class="hljs-keyword">if</span> (clsName == <span class="hljs-keyword">null</span> || clsName.length() == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> andLog(<span class="hljs-string">"No status bar component configured"</span>, <span class="hljs-keyword">null</span>);
        }
        Class&lt;?&gt; cls = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            cls = mContext.getClassLoader().loadClass(clsName);
        } <span class="hljs-keyword">catch</span> (Throwable t) {
            <span class="hljs-keyword">throw</span> andLog(<span class="hljs-string">"Error loading status bar component: "</span> + clsName, t);
        }
        <span class="hljs-keyword">try</span> {
            mStatusBar = (SystemUI) cls.newInstance();
        } <span class="hljs-keyword">catch</span> (Throwable t) {
            <span class="hljs-keyword">throw</span> andLog(<span class="hljs-string">"Error creating status bar component: "</span> + clsName, t);
        }
        mStatusBar.mContext = mContext;
        mStatusBar.mComponents = mComponents;
        mStatusBar.start();
        <span class="hljs-keyword">if</span> (DEBUG) Log.d(TAG, <span class="hljs-string">"started "</span> + mStatusBar.getClass().getSimpleName());
}</code></pre> 
<pre class="prettyprint"><code class=" hljs avrasm">上述是&lt;string name=<span class="hljs-string">"config_statusBarComponent"</span> translatable=<span class="hljs-string">"false"</span>&gt;<span class="hljs-keyword">com</span><span class="hljs-preprocessor">.android</span><span class="hljs-preprocessor">.systemui</span><span class="hljs-preprocessor">.statusbar</span><span class="hljs-preprocessor">.phone</span><span class="hljs-preprocessor">.StatusBar</span>&lt;/string&gt;类</code></pre> 
<p><strong>StatusBar#start</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span>() {
    ....

    createAndAddWindows();
    ....    

}</code></pre> 
<p><strong>StatusBar#createAndAddWindows</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createAndAddWindows</span>() {
        addStatusBarWindow();
}</code></pre> 
<p><strong>StatusBar#addStatusBarWindow</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addStatusBarWindow</span>() {
        makeStatusBarView();
        mStatusBarWindowManager = Dependency.<span class="hljs-keyword">get</span>(StatusBarWindowManager.class);
        mRemoteInputController = <span class="hljs-keyword">new</span> RemoteInputController(mHeadsUpManager);
        mStatusBarWindowManager.add(mStatusBarWindow, getStatusBarHeight());
}</code></pre> 
<p><strong>StatusBar#makeStatusBarView</strong></p> 
<pre class="prettyprint"><code class=" hljs coffeescript">protected <span class="hljs-reserved">void</span> makeStatusBarView() {
    ....

    <span class="hljs-regexp">//</span> Set up the quick settings tile panel
        View container = mStatusBarWindow.findViewById(R.id.qs_frame);
        <span class="hljs-keyword">if</span> (container != <span class="hljs-literal">null</span>) {
            FragmentHostManager fragmentHostManager = FragmentHostManager.get(container);
            ExtensionFragmentListener.attachExtensonToFragment(container, QS.TAG, R.id.qs_frame,
                    Dependency.get(ExtensionController.class).newExtension(QS.class)
                            .withPlugin(QS.class)
                            .withFeature(
                                    PackageManager.FEATURE_AUTOMOTIVE, <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> <span class="hljs-keyword">new</span> CarQSFragment())
                            .withDefault<span class="hljs-function"><span class="hljs-params">(() -&gt; <span class="hljs-keyword">new</span> QSFragment())</span>
                            .<span class="hljs-title">build</span><span class="hljs-params">()</span>);
            <span class="hljs-title">final</span> <span class="hljs-title">QSTileHost</span> <span class="hljs-title">qsh</span> = <span class="hljs-title">SystemUIFactory</span>.<span class="hljs-title">getInstance</span><span class="hljs-params">()</span>.<span class="hljs-title">createQSTileHost</span><span class="hljs-params">(mContext, <span class="hljs-keyword">this</span>,
                    mIconController)</span>;  // 获取默认显示的快捷按钮，并添加到<span class="hljs-title">qsh</span>对象的<span class="hljs-title">mTiles</span>变量中
            <span class="hljs-title">mBrightnessMirrorController</span> = <span class="hljs-title">new</span> <span class="hljs-title">BrightnessMirrorController</span><span class="hljs-params">(mStatusBarWindow,
                    mScrimController)</span>;
            <span class="hljs-title">fragmentHostManager</span>.<span class="hljs-title">addTagListener</span><span class="hljs-params">(QS.TAG, (tag, f) -&gt; {
                QS qs = (QS) f;
                <span class="hljs-keyword">if</span> (qs <span class="hljs-keyword">instanceof</span> QSFragment) {
                    ((QSFragment) qs).setHost(qsh);  <span class="hljs-regexp">//</span> 从qsh对象获取mTiles中保存的所有默认显示的快捷按钮并且添加到布局中显示
                    mQSPanel = ((QSFragment) qs).getQsPanel();
                    mQSPanel.setBrightnessMirror(mBrightnessMirrorController);
                    mKeyguardStatusBar.setQSPanel(mQSPanel);
                }
            })</span>;
        }
    ....


}</span></code></pre> 
<p>上述创建final QSTileHost qsh = SystemUIFactory.getInstance().createQSTileHost(mContext, this, <br> mIconController); <br> <strong>SystemUIFactory#createQSTileHost</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> QSTileHost <span class="hljs-title">createQSTileHost</span>(Context context, StatusBar statusBar,
            StatusBarIconController iconController) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QSTileHost(context, statusBar, iconController);
    }


<span class="hljs-keyword">public</span> <span class="hljs-title">QSTileHost</span>(Context context, StatusBar statusBar,
            StatusBarIconController iconController) {
        mIconController = iconController;
        mContext = context;
        mStatusBar = statusBar;

        mServices = <span class="hljs-keyword">new</span> TileServices(<span class="hljs-keyword">this</span>, Dependency.<span class="hljs-keyword">get</span>(Dependency.BG_LOOPER));

        mQsFactories.add(<span class="hljs-keyword">new</span> QSFactoryImpl(<span class="hljs-keyword">this</span>));
        Dependency.<span class="hljs-keyword">get</span>(PluginManager.class).addPluginListener(<span class="hljs-keyword">this</span>, QSFactory.class, <span class="hljs-keyword">true</span>);

        Dependency.<span class="hljs-keyword">get</span>(TunerService.class).addTunable(<span class="hljs-keyword">this</span>, TILES_SETTING);
        <span class="hljs-comment">// AutoTileManager can modify mTiles so make sure mTiles has already been initialized.</span>
        mAutoTiles = <span class="hljs-keyword">new</span> AutoTileManager(context, <span class="hljs-keyword">this</span>);
}</code></pre> 
<p><strong>TunerServiceImpl#addTunable</strong></p> 
<pre class="prettyprint"><code class=" hljs avrasm">private void addTunable(Tunable tunable, String key) {
        if (!mTunableLookup<span class="hljs-preprocessor">.containsKey</span>(key)) {
            mTunableLookup<span class="hljs-preprocessor">.put</span>(key, new ArraySet&lt;Tunable&gt;())<span class="hljs-comment">;</span>
        }
        mTunableLookup<span class="hljs-preprocessor">.get</span>(key)<span class="hljs-preprocessor">.add</span>(tunable)<span class="hljs-comment">;</span>
        if (LeakDetector<span class="hljs-preprocessor">.ENABLED</span>) {
            mTunables<span class="hljs-preprocessor">.add</span>(tunable)<span class="hljs-comment">;</span>
            Dependency<span class="hljs-preprocessor">.get</span>(LeakDetector<span class="hljs-preprocessor">.class</span>)<span class="hljs-preprocessor">.trackCollection</span>(mTunables, <span class="hljs-string">"TunerService.mTunables"</span>)<span class="hljs-comment">;</span>
        }
        Uri uri = Settings<span class="hljs-preprocessor">.Secure</span><span class="hljs-preprocessor">.getUriFor</span>(key)<span class="hljs-comment">;</span>
        if (!mListeningUris<span class="hljs-preprocessor">.containsKey</span>(uri)) {
            mListeningUris<span class="hljs-preprocessor">.put</span>(uri, key)<span class="hljs-comment">;</span>
            mContentResolver<span class="hljs-preprocessor">.registerContentObserver</span>(uri, false, mObserver, mCurrentUser)<span class="hljs-comment">;</span>
        }
        // Send the first state.
        String value = Settings<span class="hljs-preprocessor">.Secure</span><span class="hljs-preprocessor">.getStringForUser</span>(mContentResolver, key, mCurrentUser)<span class="hljs-comment">;</span>
        tunable<span class="hljs-preprocessor">.onTuningChanged</span>(key, value)<span class="hljs-comment">;</span>
}</code></pre> 
<p><strong>QSTileHost#onTuningChanged</strong></p> 
<pre class="prettyprint"><code class=" hljs lasso">@Override
    <span class="hljs-keyword">public</span> <span class="hljs-literal">void</span> onTuningChanged(<span class="hljs-built_in">String</span> key, <span class="hljs-built_in">String</span> newValue) {
        <span class="hljs-keyword">if</span> (<span class="hljs-subst">!</span>TILES_SETTING<span class="hljs-built_in">.</span><span class="hljs-keyword">equals</span>(key)) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Recreating tiles"</span>);
        <span class="hljs-keyword">if</span> (newValue <span class="hljs-subst">==</span> <span class="hljs-built_in">null</span> <span class="hljs-subst">&amp;&amp;</span> UserManager<span class="hljs-built_in">.</span>isDeviceInDemoMode(mContext)) {
            newValue <span class="hljs-subst">=</span> mContext<span class="hljs-built_in">.</span>getResources()<span class="hljs-built_in">.</span>getString(R<span class="hljs-built_in">.</span><span class="hljs-built_in">string</span><span class="hljs-built_in">.</span>quick_settings_tiles_retail_mode);
        }
        final <span class="hljs-built_in">List</span><span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span><span class="hljs-subst">&gt;</span> tileSpecs <span class="hljs-subst">=</span> loadTileSpecs(mContext, newValue); <span class="hljs-comment">// 获取快捷栏的按钮</span>
        int currentUser <span class="hljs-subst">=</span> ActivityManager<span class="hljs-built_in">.</span>getCurrentUser();
        <span class="hljs-keyword">if</span> (tileSpecs<span class="hljs-built_in">.</span><span class="hljs-keyword">equals</span>(mTileSpecs) <span class="hljs-subst">&amp;&amp;</span> currentUser <span class="hljs-subst">==</span> mCurrentUser) <span class="hljs-keyword">return</span>;
        mTiles<span class="hljs-built_in">.</span>entrySet()<span class="hljs-built_in">.</span>stream()<span class="hljs-built_in">.</span>filter(tile <span class="hljs-subst">-&gt; </span><span class="hljs-subst">!</span>tileSpecs<span class="hljs-built_in">.</span>contains(tile<span class="hljs-built_in">.</span>getKey()))<span class="hljs-built_in">.</span>forEach(
                tile <span class="hljs-subst">-&gt; </span>{
                    <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Destroying tile: "</span> <span class="hljs-subst">+</span> tile<span class="hljs-built_in">.</span>getKey());
                    tile<span class="hljs-built_in">.</span>getValue()<span class="hljs-built_in">.</span>destroy();
                });
        final LinkedHashMap<span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span>, QSTile<span class="hljs-subst">&gt;</span> newTiles <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> LinkedHashMap<span class="hljs-subst">&lt;&gt;</span>();
        for (<span class="hljs-built_in">String</span> tileSpec : tileSpecs) {
            QSTile tile <span class="hljs-subst">=</span> mTiles<span class="hljs-built_in">.</span>get(tileSpec);
            <span class="hljs-keyword">if</span> (tile <span class="hljs-subst">!=</span> <span class="hljs-built_in">null</span> <span class="hljs-subst">&amp;&amp;</span> (<span class="hljs-subst">!</span>(tile instanceof CustomTile)
                    <span class="hljs-subst">||</span> ((CustomTile) tile)<span class="hljs-built_in">.</span>getUser() <span class="hljs-subst">==</span> currentUser)) {
                <span class="hljs-keyword">if</span> (tile<span class="hljs-built_in">.</span>isAvailable()) {
                    <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Adding "</span> <span class="hljs-subst">+</span> tile);
                    tile<span class="hljs-built_in">.</span>removeCallbacks();
                    <span class="hljs-keyword">if</span> (<span class="hljs-subst">!</span>(tile instanceof CustomTile) <span class="hljs-subst">&amp;&amp;</span> mCurrentUser <span class="hljs-subst">!=</span> currentUser) {
                        tile<span class="hljs-built_in">.</span>userSwitch(currentUser);
                    }
                    newTiles<span class="hljs-built_in">.</span>put(tileSpec, tile);
                } <span class="hljs-keyword">else</span> {
                    tile<span class="hljs-built_in">.</span>destroy();
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Creating tile: "</span> <span class="hljs-subst">+</span> tileSpec);
                try {
                    tile <span class="hljs-subst">=</span> createTile(tileSpec);
                    <span class="hljs-keyword">if</span> (tile <span class="hljs-subst">!=</span> <span class="hljs-built_in">null</span>) {
                        <span class="hljs-keyword">if</span> (tile<span class="hljs-built_in">.</span>isAvailable()) {
                            tile<span class="hljs-built_in">.</span>setTileSpec(tileSpec);
                            newTiles<span class="hljs-built_in">.</span>put(tileSpec, tile);
                        } <span class="hljs-keyword">else</span> {
                            tile<span class="hljs-built_in">.</span>destroy();
                        }
                    }
                } catch (Throwable t) {
                    <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>w(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Error creating tile for spec: "</span> <span class="hljs-subst">+</span> tileSpec, t);
                }
            }
        }
        mCurrentUser <span class="hljs-subst">=</span> currentUser;
        mTileSpecs<span class="hljs-built_in">.</span>clear();
        mTileSpecs<span class="hljs-built_in">.</span>addAll(tileSpecs);
        mTiles<span class="hljs-built_in">.</span>clear();
        mTiles<span class="hljs-built_in">.</span>putAll(newTiles);
        for (int i <span class="hljs-subst">=</span> <span class="hljs-number">0</span>; i <span class="hljs-subst">&lt;</span> mCallbacks<span class="hljs-built_in">.</span>size(); i<span class="hljs-subst">++</span>) {
            mCallbacks<span class="hljs-built_in">.</span>get(i)<span class="hljs-built_in">.</span>onTilesChanged();
        }
}
</code></pre> 
<p><strong>TunerServiceImpl#loadTileSpecs</strong></p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">List</span><span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span><span class="hljs-subst">&gt;</span> loadTileSpecs(Context context, <span class="hljs-built_in">String</span> tileList) {
        final Resources res <span class="hljs-subst">=</span> context<span class="hljs-built_in">.</span>getResources();
        final <span class="hljs-built_in">String</span> defaultTileList <span class="hljs-subst">=</span> res<span class="hljs-built_in">.</span>getString(R<span class="hljs-built_in">.</span><span class="hljs-built_in">string</span><span class="hljs-built_in">.</span>quick_settings_tiles_default);<span class="hljs-comment">// 获取默认显示的快捷按钮</span>
        <span class="hljs-keyword">if</span> (tileList <span class="hljs-subst">==</span> <span class="hljs-built_in">null</span>) {
            tileList <span class="hljs-subst">=</span> res<span class="hljs-built_in">.</span>getString(R<span class="hljs-built_in">.</span><span class="hljs-built_in">string</span><span class="hljs-built_in">.</span>quick_settings_tiles);
            <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Loaded tile specs from config: "</span> <span class="hljs-subst">+</span> tileList);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-keyword">Log</span><span class="hljs-built_in">.</span>d(<span class="hljs-built_in">TAG</span>, <span class="hljs-string">"Loaded tile specs from setting: "</span> <span class="hljs-subst">+</span> tileList);
        }
        final ArrayList<span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span><span class="hljs-subst">&gt;</span> tiles <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> ArrayList<span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span><span class="hljs-subst">&gt;</span>();
        boolean addedDefault <span class="hljs-subst">=</span> <span class="hljs-literal">false</span>;
        for (<span class="hljs-built_in">String</span> tile : tileList<span class="hljs-built_in">.</span>split(<span class="hljs-string">","</span>)) {
            tile <span class="hljs-subst">=</span> tile<span class="hljs-built_in">.</span>trim();
            <span class="hljs-keyword">if</span> (tile<span class="hljs-built_in">.</span>isEmpty()) continue;
            <span class="hljs-keyword">if</span> (tile<span class="hljs-built_in">.</span><span class="hljs-keyword">equals</span>(<span class="hljs-string">"default"</span>)) {
                <span class="hljs-keyword">if</span> (<span class="hljs-subst">!</span>addedDefault) {
                    tiles<span class="hljs-built_in">.</span>addAll(Arrays<span class="hljs-built_in">.</span>asList(defaultTileList<span class="hljs-built_in">.</span>split(<span class="hljs-string">","</span>)));
                    addedDefault <span class="hljs-subst">=</span> <span class="hljs-literal">true</span>;
                }
            } <span class="hljs-keyword">else</span> {
                tiles<span class="hljs-built_in">.</span>add(tile);
            }
        }
        <span class="hljs-keyword">return</span> tiles;
    }</code></pre> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-comment">&lt;!-- The default tiles to display in QuickSettings --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">string</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"quick_settings_tiles_default"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"false"</span>&gt;</span>
        wifi,bt,dnd,flashlight,rotation,battery,cell,airplane,cast
<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
</code></pre> 
<p>这里quick_settings_tiles_default是默认显示的快捷按钮</p> 
<p>上述的 onTuningChanged方法，其实主要做了这样的事，获取获取默认显示的快捷按钮(其实就是字符串标识)，然后添加到mTiles变量中</p> 
<p>下面是从qsh对象获取mTiles中保存的所有默认显示的快捷按钮并且添加到布局中显示</p> 
<p><strong>QSFragment#setHost</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHost</span>(QSTileHost qsh) {
        mQSPanel.setHost(qsh, mQSCustomizer);
        mHeader.setQSPanel(mQSPanel);
        mFooter.setQSPanel(mQSPanel);
        mQSDetail.setHost(qsh);

        <span class="hljs-keyword">if</span> (mQSAnimator != <span class="hljs-keyword">null</span>) {
            mQSAnimator.setHost(qsh);
        }
    }</code></pre> 
<p><strong>QSPanel#setHost</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHost</span>(QSTileHost host, QSCustomizer customizer) {
        mHost = host;
        mHost.addCallback(<span class="hljs-keyword">this</span>);
        setTiles(mHost.getTiles()); <span class="hljs-comment">// 获取获取默认显示的快捷按钮</span>
        mFooter.setHostEnvironment(host);
        mCustomizePanel = customizer;
        <span class="hljs-keyword">if</span> (mCustomizePanel != <span class="hljs-keyword">null</span>) {
            mCustomizePanel.setHost(mHost);
        }
}</code></pre> 
<p><strong>QSPanel#setTiles</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTiles</span>(Collection&lt;QSTile&gt; tiles, <span class="hljs-keyword">boolean</span> collapsedView) {
        <span class="hljs-keyword">for</span> (TileRecord record : mRecords) {
            mTileLayout.removeTile(record);
            record.tile.removeCallback(record.callback);
        }
        mRecords.clear();
        <span class="hljs-keyword">for</span> (QSTile tile : tiles) {
            addTile(tile, collapsedView);
        }
}</code></pre> 
<p><strong>QSPanel#addTile</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">protected</span> TileRecord <span class="hljs-title">addTile</span>(<span class="hljs-keyword">final</span> QSTile tile, <span class="hljs-keyword">boolean</span> collapsedView) {
        <span class="hljs-keyword">final</span> TileRecord r = <span class="hljs-keyword">new</span> TileRecord();
        r.tile = tile;
        r.tileView = createTileView(tile, collapsedView);  <span class="hljs-comment">// 根据读取到的tile创建对应的tile实现</span>
        <span class="hljs-keyword">final</span> QSTile.Callback callback = <span class="hljs-keyword">new</span> QSTile.Callback() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStateChanged</span>(QSTile.State state) {
                drawTile(r, state);
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onShowDetail</span>(<span class="hljs-keyword">boolean</span> show) {
                <span class="hljs-comment">// Both the collapsed and full QS panels get this callback, this check determines</span>
                <span class="hljs-comment">// which one should handle showing the detail.</span>
                <span class="hljs-keyword">if</span> (shouldShowDetail()) {
                    QSPanel.<span class="hljs-keyword">this</span>.showDetail(show, r);
                }
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onToggleStateChanged</span>(<span class="hljs-keyword">boolean</span> state) {
                <span class="hljs-keyword">if</span> (mDetailRecord == r) {
                    fireToggleStateChanged(state);
                }
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onScanStateChanged</span>(<span class="hljs-keyword">boolean</span> state) {
                r.scanState = state;
                <span class="hljs-keyword">if</span> (mDetailRecord == r) {
                    fireScanStateChanged(r.scanState);
                }
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnnouncementRequested</span>(CharSequence announcement) {
                <span class="hljs-keyword">if</span> (announcement != <span class="hljs-keyword">null</span>) {
                    mHandler.obtainMessage(H.ANNOUNCE_FOR_ACCESSIBILITY, announcement)
                            .sendToTarget();
                }
            }
        };
        r.tile.addCallback(callback);
        r.callback = callback;
        r.tileView.init(r.tile);
        r.tile.refreshState();
        mRecords.add(r);

        <span class="hljs-keyword">if</span> (mTileLayout != <span class="hljs-keyword">null</span>) {
            mTileLayout.addTile(r);
        }

        <span class="hljs-keyword">return</span> r;
}</code></pre> 
<p>上述 QSPanel#addTile方法中，首先会创建一个TileRecord，TileRecord就是对定义的tile字符串和对应的tile实现类一一对应起来，另外，上面将所有的快捷开关，其实最终是通过addView的形式保存到mTileLayout中的，mTileLayout是一个布局，在QSPanel中初始化的，其实，systemui中，我们能看到的所有下拉界面的显示，都是添加到mTileLayout中的</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-title">QSPanel</span>(Context context, AttributeSet attrs) {
        super(context, attrs);
        mContext = context;

        setOrientation(VERTICAL);

        mBrightnessView = LayoutInflater.<span class="hljs-keyword">from</span>(context).inflate(
                R.layout.quick_settings_brightness_dialog, <span class="hljs-keyword">this</span>, <span class="hljs-keyword">false</span>);
        addView(mBrightnessView);  <span class="hljs-comment">// 调节亮度的</span>

        setupTileLayout();  <span class="hljs-comment">// 加载mTileLayout对应的布局</span>

        mPageIndicator = LayoutInflater.<span class="hljs-keyword">from</span>(context).inflate(
                R.layout.mTileLayoutqs_page_indicator, <span class="hljs-keyword">this</span>, <span class="hljs-keyword">false</span>);
        addView(mPageIndicator);
        <span class="hljs-keyword">if</span> (mTileLayout instanceof PagedTileLayout) {
            ((PagedTileLayout) mTileLayout).setPageIndicator((PageIndicator) mPageIndicator);
        }  <span class="hljs-comment">// 快捷栏一页显示不下，这里是添加滑动显示的标识圆点</span>

        addDivider();  <span class="hljs-comment">// 分割线</span>

        mFooter = <span class="hljs-keyword">new</span> QSSecurityFooter(<span class="hljs-keyword">this</span>, context);
        addView(mFooter.getView());  <span class="hljs-comment">// 底部编辑</span>

        updateResources();

        mBrightnessController = <span class="hljs-keyword">new</span> BrightnessController(getContext(),
                findViewById(R.id.brightness_icon),
                findViewById(R.id.brightness_slider));
}</code></pre> 
<p>另外，上面将所有的快捷开关，其实最终是通过addView的形式保存到mTileLayout中的，mTileLayout是一个布局，在QSPanel中初始化的，其实，systemui中，我们能看到的 <br> 所有下拉界面的显示，都是添加到mTileLayout中的</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-title">QSPanel</span>(Context context, AttributeSet attrs) {
        super(context, attrs);
        mContext = context;

        setOrientation(VERTICAL);

        mBrightnessView = LayoutInflater.<span class="hljs-keyword">from</span>(context).inflate(
                R.layout.quick_settings_brightness_dialog, <span class="hljs-keyword">this</span>, <span class="hljs-keyword">false</span>);
        addView(mBrightnessView);  <span class="hljs-comment">// 调节亮度的</span>

        setupTileLayout();  <span class="hljs-comment">// 加载mTileLayout对应的布局</span>

        mPageIndicator = LayoutInflater.<span class="hljs-keyword">from</span>(context).inflate(
                R.layout.mTileLayoutqs_page_indicator, <span class="hljs-keyword">this</span>, <span class="hljs-keyword">false</span>);
        addView(mPageIndicator);
        <span class="hljs-keyword">if</span> (mTileLayout instanceof PagedTileLayout) {
            ((PagedTileLayout) mTileLayout).setPageIndicator((PageIndicator) mPageIndicator);
        }  <span class="hljs-comment">// 快捷栏一页显示不下，这里是添加滑动显示的标识圆点</span>

        addDivider();  <span class="hljs-comment">// 分割线</span>

        mFooter = <span class="hljs-keyword">new</span> QSSecurityFooter(<span class="hljs-keyword">this</span>, context);
        addView(mFooter.getView());  <span class="hljs-comment">// 底部编辑</span>

        updateResources();

        mBrightnessController = <span class="hljs-keyword">new</span> BrightnessController(getContext(),
                findViewById(R.id.brightness_icon),
                findViewById(R.id.brightness_slider));
}
</code></pre> 
<p>通过setupTileLayout方法加载mTileLayout对应的布局</p> 
<p>再回到PagedTileLayout#addTile添加快捷设置按钮</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addTile</span>(TileRecord tile) {
        mTiles.add(tile);  <span class="hljs-comment">// 将所有的默认显示快捷设置保存到PagedTileLayout私有变量mTiles</span>
        postDistributeTiles();  <span class="hljs-comment">//postDistributeTiles方法会开启一个线程，执行distributeTiles方法</span>
    }</code></pre> 
<p><strong>PagedTileLayout#distributeTiles</strong></p> 
<pre class="prettyprint"><code class=" hljs avrasm">private void distributeTiles() {
        if (DEBUG) Log<span class="hljs-preprocessor">.d</span>(TAG, <span class="hljs-string">"Distributing tiles"</span>)<span class="hljs-comment">;</span>
        final int NP = mPages<span class="hljs-preprocessor">.size</span>()<span class="hljs-comment">;</span>
        for (int i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; NP; i++) {<!-- --></span>
            mPages<span class="hljs-preprocessor">.get</span>(i)<span class="hljs-preprocessor">.removeAllViews</span>()<span class="hljs-comment">;</span>
        }
        int index = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        final int NT = mTiles<span class="hljs-preprocessor">.size</span>()<span class="hljs-comment">;</span>
        for (int i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; NT; i++) {<!-- --></span>
            TileRecord tile = mTiles<span class="hljs-preprocessor">.get</span>(i)<span class="hljs-comment">;</span>
            if (mPages<span class="hljs-preprocessor">.get</span>(index)<span class="hljs-preprocessor">.isFull</span>()) {  //一页显示不下
                if (++index == mPages<span class="hljs-preprocessor">.size</span>()) {
                    if (DEBUG) Log<span class="hljs-preprocessor">.d</span>(TAG, <span class="hljs-string">"Adding page for "</span>
                            + tile<span class="hljs-preprocessor">.tile</span><span class="hljs-preprocessor">.getClass</span>()<span class="hljs-preprocessor">.getSimpleName</span>())<span class="hljs-comment">;</span>
                    mPages<span class="hljs-preprocessor">.add</span>((TilePage) LayoutInflater<span class="hljs-preprocessor">.from</span>(getContext())
                            <span class="hljs-preprocessor">.inflate</span>(R<span class="hljs-preprocessor">.layout</span><span class="hljs-preprocessor">.qs</span>_paged_page, this, false))<span class="hljs-comment">;</span>
                }
            }
            if (DEBUG) Log<span class="hljs-preprocessor">.d</span>(TAG, <span class="hljs-string">"Adding "</span> + tile<span class="hljs-preprocessor">.tile</span><span class="hljs-preprocessor">.getClass</span>()<span class="hljs-preprocessor">.getSimpleName</span>() + <span class="hljs-string">" to "</span>
                    + index)<span class="hljs-comment">;</span>
            mPages<span class="hljs-preprocessor">.get</span>(index)<span class="hljs-preprocessor">.addTile</span>(tile)<span class="hljs-comment">;  // 添加当前tile到布局中，mPages.get(index)获取TilePage extends TileLayout</span>
        }
        if (mNumPages != index + <span class="hljs-number">1</span>) {
            mNumPages = index + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
            while (mPages<span class="hljs-preprocessor">.size</span>() &gt; mNumPages) {
                mPages<span class="hljs-preprocessor">.remove</span>(mPages<span class="hljs-preprocessor">.size</span>() - <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
            }
            if (DEBUG) Log<span class="hljs-preprocessor">.d</span>(TAG, <span class="hljs-string">"Size: "</span> + mNumPages)<span class="hljs-comment">;</span>
            mPageIndicator<span class="hljs-preprocessor">.setNumPages</span>(mNumPages)<span class="hljs-comment">;</span>
            mPageIndicator<span class="hljs-preprocessor">.setVisibility</span>(mNumPages &gt; <span class="hljs-number">1</span> ? View<span class="hljs-preprocessor">.VISIBLE</span> : View<span class="hljs-preprocessor">.GONE</span>)<span class="hljs-comment">;</span>
            setAdapter(mAdapter)<span class="hljs-comment">;</span>
            mAdapter<span class="hljs-preprocessor">.notifyDataSetChanged</span>()<span class="hljs-comment">;</span>
            setCurrentItem(<span class="hljs-number">0</span>, false)<span class="hljs-comment">;</span>
        }
}</code></pre> 
<p><strong>TileLayout#addView</strong></p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addTile</span>(TileRecord tile) {
        mRecords.add(tile);
        tile.tile.setListening(<span class="hljs-keyword">this</span>, mListening);
        addView(tile.tileView);
}</code></pre> 
<p>TileLayout继承自ViewGroup，所以到这里addView就把对应的tile添加到布局中显示了</p> 
<p>好了，有了这里的流程分析，后面，我会实现一个在systemui的快捷设置栏中添加一个锁屏的快捷菜单，拭目以待^_^</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/892f0caf160c42c00ab9100d53304414/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">分布式事务10_最大努力通知形</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4d28e107f52fbebd5e764ccc2db472da/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">纯C语言实现经典小游戏——贪吃蛇（VS2017）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>