<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UEFI 基础教程 （一） - 基于QEMU搭建UEFI开发环境(win/linux) - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UEFI 基础教程 （一） - 基于QEMU搭建UEFI开发环境(win/linux)" />
<meta property="og:description" content="一、EDKII windows 环境搭建 1. 下载UEFI开源代码 cmd进入C盘根目录，git clone https://github.com/tianocore/edk2.git edkii &amp;&amp; cd edkii &amp;&amp; git submodule update --init (太慢的话，使用gitee, git clone https://gitee.com/xiaopangzi313/edk2.git)
2. 安装ASL编译器 下载 iasl-win-20190405.zip，然后解压至C:\asl。
3. 安装NASM编译器 下载 nasm-2.14.02-win64.zip，解压nasm-2.14.02-win64.zip到C:\nasm
4. 安装VS2013或者VS2015(过程略) 5. 修改启动脚本edksetup.bat 进入edk2目录，在edksetup.bat最后一行添加
build -a X64 -p OvmfPkg\OvmfPkgX64.dsc -D DEBUG_ON_SERIAL_PORT
6. 编译 OVMF.FD 固件文件 在edk2目录执行edksetup.bat,
运行结果如下,
为了运行方便，可以将edksetup.bat放入右键菜单，编写以下文本保存为EDK2_Build.reg 并双击运行，
Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\Directory\shell\EDK2_Build] @=&#34;EDK2_Build&#34; &#34;Icon&#34;=&#34;cmd.exe&#34; [HKEY_CLASSES_ROOT\Directory\shell\EDK2_Build\command] @=&#34;cmd.exe /s /k pushd \&#34;%V\&#34; &amp;&amp; edksetup.bat&#34; [HKEY_CLASSES_ROOT\Directory\Background\shell\EDK2_Build] @=&#34;EDK2_Build&#34; &#34;Icon&#34;=&#34;cmd.exe&#34; [HKEY_CLASSES_ROOT\Directory\Background\shell\EDK2_Build\command] @=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/07e0be8f7d4c779cce175669d5a57a1f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-01T15:22:01+08:00" />
<meta property="article:modified_time" content="2023-12-01T15:22:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UEFI 基础教程 （一） - 基于QEMU搭建UEFI开发环境(win/linux)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="EDKII_windows__0"></a>一、EDKII windows 环境搭建</h3> 
<h4><a id="1_UEFI_2"></a>1. 下载<code>UEFI</code>开源代码</h4> 
<p><code>cmd</code>进入<code>C</code>盘根目录，<code>git clone https://github.com/tianocore/edk2.git edkii &amp;&amp; cd edkii &amp;&amp; git submodule update --init </code><br> (太慢的话，使用<code>gitee</code>, <code>git clone https://gitee.com/xiaopangzi313/edk2.git</code>)<br> <img src="https://images2.imgbox.com/91/51/IoQZ8owW_o.png" alt="edk download"></p> 
<h4><a id="2_ASL_7"></a>2. 安装<code>ASL</code>编译器</h4> 
<p>下载<a href="https://acpica.org/sites/acpica/files/iasl-win-20190405.zip" rel="nofollow noopener noreferrer" target="_blank"> iasl-win-20190405.zip</a>，然后解压至<code>C:\asl</code>。</p> 
<h4><a id="3_NASM_10"></a>3. 安装<code>NASM</code>编译器</h4> 
<p>下载<a href="https://www.nasm.us/pub/nasm/releasebuilds/2.14.02/win64/nasm-2.14.02-win64.zip" rel="nofollow noopener noreferrer" target="_blank"> nasm-2.14.02-win64.zip</a>，解压nasm-2.14.02-win64.zip到<code>C:\nasm</code></p> 
<h4><a id="4_VS2013VS2015_13"></a>4. 安装VS2013或者VS2015(过程略)</h4> 
<h4><a id="5_edksetupbat_15"></a>5. 修改启动脚本<code>edksetup.bat</code></h4> 
<p>进入<code>edk2</code>目录，在<code>edksetup.bat</code>最后一行添加<br> <code>build -a X64 -p OvmfPkg\OvmfPkgX64.dsc -D DEBUG_ON_SERIAL_PORT</code></p> 
<h4><a id="6__OVMFFD__19"></a>6. 编译 <code>OVMF.FD</code> 固件文件</h4> 
<p>在edk2目录执行<code>edksetup.bat</code>,<br> <img src="https://images2.imgbox.com/a8/bc/stRD3VaF_o.png" alt="edksetup start"><br> 运行结果如下,<br> <img src="https://images2.imgbox.com/b7/20/K7PYeAaY_o.png" alt="在这里插入图片描述"><br> 为了运行方便，可以将<code>edksetup.bat</code>放入右键菜单，编写以下文本保存为<code>EDK2_Build.reg</code> 并双击运行，</p> 
<pre><code>Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\shell\EDK2_Build]
@="EDK2_Build"
"Icon"="cmd.exe"

[HKEY_CLASSES_ROOT\Directory\shell\EDK2_Build\command]
@="cmd.exe /s /k pushd \"%V\" &amp;&amp; edksetup.bat"

[HKEY_CLASSES_ROOT\Directory\Background\shell\EDK2_Build]
@="EDK2_Build"
"Icon"="cmd.exe"

[HKEY_CLASSES_ROOT\Directory\Background\shell\EDK2_Build\command]
@="cmd.exe /s /k pushd \"%V\"  &amp;&amp; edksetup.bat"

</code></pre> 
<p>即可以使用右键菜单运行编译脚本，<br> <img src="https://images2.imgbox.com/0e/85/YHuDnYjB_o.png" alt="在这里插入图片描述"></p> 
<p>查看生成的固件文件，<code>dir C:\edkii\Build\OvmfX64\DEBUG_VS2013x86\FV\*.fd</code><br> <img src="https://images2.imgbox.com/1b/ff/TEYrzdsA_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7_QEMUX64_48"></a>7. 安装QEMU(X64)虚拟机</h4> 
<p>下载<code>QEMU</code>并安装，链接：<code>https://pan.baidu.com/s/1aQ7wmQ6bUOInUs94PmAFHA 提取码：csdn </code><br> –来自百度网盘超级会员V1的分享<br> 在C盘创建QEMU并进入，拷贝<code>OVMF.FD</code>到当前目录，创建启动脚本<code>setup-qemu-x64.bat</code><br> <code>C:\qemu&gt;echo "C:\Program Files\qemu\qemu-system-x86_64.exe" -bios "OVMF.fd" -M "pc" -m 256 -cpu "qemu64" -boot order=dc -serial stdio &gt;&gt; setup-qemu-x64.bat</code><br> 运行脚本 <code>setup-qemu-x64.bat</code>，<br> <img src="https://images2.imgbox.com/5c/84/GFVnAXX0_o.png" alt="在这里插入图片描述"><br> 效果如下，<br> <img src="https://images2.imgbox.com/1c/05/a0EuZt65_o.png" alt="在这里插入图片描述"><br> 图中，左侧为<code>Console</code>串口输出，右侧为<code>QEMU</code>的<code>shell</code>界面。</p> 
<h3><a id="EDKII_LinuxCentos7___60"></a>二、EDKII Linux（Centos7） 环境搭建</h3> 
<h4><a id="1__61"></a>1. 设置软件源</h4> 
<pre><code># 备份当前repo文件
cp  /etc/yum.repos.d/CentOS-Base.repo  /etc/yum.repos.d/CentOS-Base.repo.back
# 下载ali cloud centos 源
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo 
# 安装扩展仓库
wget -O /etc/yum.repos.d/epel-7.repo wget http://mirrors.aliyun.com/repo/epel-7.repo 
yum clean all 
yum makecache 
</code></pre> 
<h4><a id="2___72"></a>2. 安装编译器、模拟器环境</h4> 
<p>·<code>yum -y install gcc gcc-c++ git python3 nasm iasl libuuid-devel qemu</code><br> #安装GUI<br> <code>yum groupinstall "GNOME Desktop" "Graphical Administration Tools"</code><br> <code> ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target</code></p> 
<h4><a id="3__UEFI_77"></a>3. 下载UEFI开源代码</h4> 
<p><code>git clone https://github.com/tianocore/edk2.git edkii</code>(如果太慢可以sync到自己的gitee账户，如我的<code>gitee</code>, <code>git clone https://gitee.com/xiaopangzi313/edk2.git</code>)</p> 
<h4><a id="4__UEFI_80"></a>4. 编译UEFI开源代码</h4> 
<pre><code># 编译basetools
  make -C /root/edk2/BaseTools/Source/C
# 编译 Ovmf.fd
 ./OvmfPkg/build.sh -D DEBUG_ON_SERIAL_PORT
</code></pre> 
<h4><a id="5__QEMUOvmffd_87"></a>5. 使用<code>QEMU</code>加载<code>Ovmf.fd</code></h4> 
<ul><li><code>qemu-system-x86_64 -bios ./Build/OvmfX64/DEBUG_GCC48/FV/OVMF.fd </code><br> <img src="https://images2.imgbox.com/c1/5d/rEPbzI4z_o.png" alt="在这里插入图片描述"><br> PS:<br> VMware/Vbox console操作不方便，可以尝试使用虚拟串口方式。 
  <ul><li>虚拟机设置-&gt;硬件&gt;添加-&gt;串行端口-&gt;使用命名管道-&gt;输入<code>\\.\pipe\com_1</code></li><li>Centos 下配置grub: 
    <ol><li><code>sed 's/quiet/console=ttyS1,9600 loglevel=8/' -i /etc/default/grub</code></li><li><code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li><li><code>grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</code></li><li><code>reboot</code></li></ol> </li><li>Putty 配置，serial line设置为<code>\\.\pipe\com_1</code>，speed设置为<code>9600</code><br> 效果如下：<br> <img src="https://images2.imgbox.com/de/ad/rKaOOO63_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> 
<h3><a id="UEFI_OVMF__boot_Linux_102"></a>三、UEFI OVMF 固件 boot Linux</h3> 
<h4><a id="1_Busybox_103"></a>1. 编译<code>Busybox</code></h4> 
<pre><code>#安装相关依赖库以及tool
yum -y  install gcc  gcc-c++
yum install -y ncurses ncurses-devel   
yum install -y elfutils-libelf-devel openssl-devel dwarves make flex bison
yum install -y glibc-static

#创建工作目录
CSDN=/root/csdn
TOP_BUILD=$CSDN/build
mkdidr -p $TOP_BUILD
cd $CSDN

#下载解压busybox源码
wget  https://busybox.net/downloads/busybox-1.26.2.tar.bz2  --no-check-certificate
tar xjf busybox-1.26.2.tar.bz2 
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/82/V4uZm1Nq_o.png" alt="在这里插入图片描述"></p> 
<pre><code>#生成.config
cd $CSDN/busybox-1.26.2
mkdir -pv $TOP_BUILD/obj/busybox-x86
make O=$TOP_BUILD/obj/busybox-x86 defconfig

make O=$TOP_BUILD/obj/busybox-x86 menuconfig
sed -i "s/.*CONFIG_STATIC.*/CONFIG_STATIC=y/" .config
(或者Busybox Settings  ---&gt; Build BusyBox as a static binary (no shared libs).)

cd $TOP_BUILD/obj/busybox-x86
make -j2
make install
</code></pre> 
<p><code>编译完成如下：</code><br> <img src="https://images2.imgbox.com/a2/78/OHdk5x2C_o.png" alt="dd"><br> <code>测试下busybox:</code><br> <img src="https://images2.imgbox.com/cd/5e/wkYHCBeJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_initramfs_141"></a>2. 制作initramfs</h4> 
<pre><code>#创建假的文件系统目录
mkdir -pv $TOP_BUILD/initramfs/x86-busybox
cd $TOP_BUILD/initramfs/x86-busybox
mkdir -pv {bin,dev/tty0,sbin,etc,proc,sys/kernel/debug,usr/{bin,sbin},lib,lib64,mnt/root,root}

#copy 编译生成的busybox
cp -av $TOP_BUILD/obj/busybox-x86/_install/*  $TOP_BUILD/initramfs/x86-busybox
cp -av /dev/{null,console,tty,sda1} $TOP_BUILD/initramfs/x86-busybox/dev/

#创建init文件
cat &gt; $TOP_BUILD/initramfs/x86-busybox/init &lt; EOF
#!/bin/sh
mount -t proc none /proc
mount -t sysfs none /sys
#mount -t debugfs none /sys/kernel/debug
mdev -s
echo -e "\nBoot took $(cut -d' ' -f1 /proc/uptime) seconds\n"
#exec /bin/sh
exec /sbin/init
EOF
chmod +x $TOP_BUILD/initramfs/x86-busybox/init


#创建 ./etc/passwd与 ./etc/group 
echo "root::0:0:root:/:/bin/sh" &gt; ./etc/passwd
touch  ./etc/group 

#创建 ./etc/inittab 
cat &gt; ./etc/inittab &lt;&lt; EOF
::sysinit:/etc/rc.d/rcS
::respawn:/sbin/getty -n -l /bin/sh ttyS0 115200
::respawn:/bin/cttyhack /bin/sh
::shutdown:/bin/umount -a -r
::shutdown:/sbin/swapoff -a
::restart:/sbin/init
EOF

#创建 . ./etc/fstab 
cat &gt; ./etc/fstab &lt;&lt; EOF
proc     /proc    proc     defaults 0 0
sys      /sys     sysfs    defaults 0 0
none     /dev     devtmpfs defaults 0 0
tmpfs    /dev/shm tmpfs    defaults 0 0
none     /dev/pts devpts   defaults 0 0
EOF

#创建 . ./etc/hostname
echo "busybox_csdn" &gt;  ./etc/hostname

#创建  ./etc/rc.d/rcS
mkdir -p ./etc/rc.d/ &amp;&amp; touch ./etc/rc.d/rcS

echo '#!/bin/sh
/bin/hostname -F /etc/hostname
/bin/mount /proc               # We need to do this before remounting root
/bin/mount /sys
/bin/mount -o remount,rw /     # Remount read-write
/bin/mount /dev
/bin/mkdir /dev/shm
/bin/mkdir /dev/pts
/bin/mount -a                  # Mount all filesystems in fstab, except those marked with 'noauto'
/sbin/ifconfig lo 127.0.0.1    # Setup loopback interface for network (if you have networking in your kernel)
#/sbin/inetd                    # If you want inetd to run
#/sbin/telnetd                  # If you want standalone telnetd to run -- incompatible with inetd it seems
' &gt; ./etc/rc.d/rcS
chmod +x ./etc/rc.d/rcS

#创建 tty设备文件
mknod ./dev/tty1 c 4 1
mknod ./dev/tty2 c 4 2
mknod ./dev/tty3 c 4 3
mknod ./dev/tty4 c 4 4
ls -l ./dev/tty[0-9]
</code></pre> 
<p><img src="https://images2.imgbox.com/15/f5/ckIVRiZ8_o.png" alt="在这里插入图片描述"></p> 
<pre><code>#打包initramfs
cd $TOP_BUILD/initramfs/x86-busybox
find . -print0 | cpio --null -ov --format=newc 	| gzip -9 &gt; $TOP_BUILD/obj/initramfs-busybox-x86.cpio.gz
</code></pre> 
<p><img src="https://images2.imgbox.com/32/1b/j4JiARqD_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_EFI_Linux__226"></a>3. 制作支持EFI的 Linux 硬盘镜像</h4> 
<pre><code># 安装相关的tool
 yum install -y dosfstools
 yum install -y  grub2-efi-x64-modules.noarch
 yum install -y  efibootmgr
# 插入 USB 到PC同时保证被Vmware能识别（或者直接宿主linux）
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/fa/p4Cl63P6_o.png" alt="在这里插入图片描述"></p> 
<pre><code>#对U盘前500MB清零
 dd if=/dev/zero of=/dev/sdb  bs=1M count=512;	

#对U盘(/dev/sdb)进行分区
gdisk /dev/sdb
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.

Command (? for help): p
Disk /dev/sdb: 60062500 sectors, 28.6 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 2280F128-40B9-44EF-8972-59E8AA2C1DD3
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 60062466
Partitions will be aligned on 2048-sector boundaries
Total free space is 60062433 sectors (28.6 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name

Command (? for help): n
Partition number (1-128, default 1):
First sector (34-60062466, default = 2048) or {+-}size{KMGTP}:
Last sector (2048-60062466, default = 60062466) or {+-}size{KMGTP}: 110MiB     
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): EF00
Changed type of partition to 'EFI System'

Command (? for help): p
Disk /dev/sdb: 60062500 sectors, 28.6 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 2280F128-40B9-44EF-8972-59E8AA2C1DD3
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 60062466
Partitions will be aligned on 2048-sector boundaries
Total free space is 59839200 sectors (28.5 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          225280   109.0 MiB   EF00  EFI System

Command (? for help): n
Partition number (2-128, default 2):
First sector (34-60062466, default = 227328) or {+-}size{KMGTP}:
Last sector (227328-60062466, default = 60062466) or {+-}size{KMGTP}: 400MiB
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 8300
Changed type of partition to 'Linux filesystem'

Command (? for help): p
Disk /dev/sdb: 60062500 sectors, 28.6 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 2280F128-40B9-44EF-8972-59E8AA2C1DD3
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 60062466
Partitions will be aligned on 2048-sector boundaries
Total free space is 59247327 sectors (28.3 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048          225280   109.0 MiB   EF00  EFI System
   2          227328          819200   289.0 MiB   8300  Linux filesystem

Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sdb.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot.
The operation has completed successfully.
[root@localhost ~]#
</code></pre> 
<p><img src="https://images2.imgbox.com/cb/15/gYhRrjuC_o.png" alt="在这里插入图片描述"></p> 
<pre><code>#对U盘(/dev/sdb)进行格式化
fdisk -l  /dev/sdb
mkfs.vfat  -F 32 -s 2 /dev/sdb1
mkfs.ext3 /dev/sdb2
</code></pre> 
<pre><code>#对U盘安装bootloader这里用grub tool，也可以使用LILO
mount /dev/sdb2 /mnt/
mkdir -p /mnt/boot/efi
mkdir -p /mnt/boot/grub
mount /dev/sdb1  /mnt/boot/efi
grub2-install --root-directory=/mnt/   --target=x86_64-efi   /dev/sdb
</code></pre> 
<p><img src="https://images2.imgbox.com/cf/ed/u7IMkdaW_o.png" alt="在这里插入图片描述"></p> 
<pre><code>#创建EFI/BOOT/bootx64.efi，确保UEFI可以boot
mkdir -p  /mnt/boot/efi/EFI/BOOT
cp  /mnt/boot/efi/EFI/centos/grubx64.efi  /mnt/boot/efi/EFI/BOOT/bootx64.efi

# copy 本机的kernel 镜像（也可以自己编译）
cp  /boot/vmlinuz-3.10.0-514.el7.x86_64  /mnt/

#copy上面编译的busybox initramfs
cp   /root/csdn/build/obj/initramfs-busybox-x86.cpio.gz  /mnt/
</code></pre> 
<p><img src="https://images2.imgbox.com/02/56/GWbAyrXI_o.png" alt="在这里插入图片描述"></p> 
<pre><code># 获取主分区的UUID用来填充grub.cfg
lsblk -f
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/97/AuBkzaJL_o.png" alt="在这里插入图片描述"></p> 
<pre><code># 制作启动菜单
echo 'menuentry 'csdn-kernel-3.10.0-514.el7.x86_64' --class gnu-linux --class gnu --class os {
		insmod gzio
		insmod part_gpt
		search --no-floppy --fs-uuid --set e619cba7-494d-4e0a-976d-e5d6ca196dbc
		echo 'Loading csdn kernel 3.10.0 ...'
		linux  /vmlinuz-3.10.0-514.el7.x86_64  rw init=/bin/sh console=ttyS0,9600n8 console=tty0 consoleblank=0 earlyprintk=ttyS0,9600 kgdboc=kbd,ttyS0 loglevel=7
		echo   'Loading initial ramdisk busybox  ...'
		initrd /initramfs-busybox-x86.cpio.gz
}'  &gt; /mnt/boot/efi/EFI/centos/grub.cfg
</code></pre> 
<pre><code>#卸载U盘
umount /dev/sdb1
umount /dev/sdb2

# 导出U盘为HardDisk image 
dd if=/dev/sdb bs=512 count=819200 of=./csdn_busybox.img
</code></pre> 
<h4><a id="4_OVMF__Linux__371"></a>4. 使用OVMF 固件启动 Linux 硬盘镜像</h4> 
<h6><a id="1Windows__372"></a>1.`Windows 端启动</h6> 
<p><code>chcp 65001 &amp;&amp; "C:\Program Files\qemu\qemu-system-x86_64.exe" -bios "OVMF.fd" -M "pc" -m 256 -cpu "qemu64" -boot order=dc -serial stdio -hda "csdn_busybox.img" </code><br> press F2 -&gt; uefi shell<br> <img src="https://images2.imgbox.com/5b/55/D5b7HL52_o.png" alt="在这里插入图片描述"><br> 退出<code>shell</code>,进入<code>setup</code>, 再进入<code>boot entry</code><br> <img src="https://images2.imgbox.com/61/28/SwfubR0Z_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/dd/PVQYFHGw_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8c/29/SjboaKFx_o.png" alt="在这里插入图片描述"></p> 
<p>`</p> 
<h6><a id="2Linux_382"></a>2.`Linux端启动</h6> 
<p><code>qemu-system-x86_64 -bios ./Build/OvmfX64/DEBUG_GCC48/FV/OVMF.fd -serial stdio -hda /root/csdn_busybox.img</code><br> <img src="https://images2.imgbox.com/6f/07/MEjdW7D7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5_OVMF__win10_385"></a>5. 使用OVMF 固件启动 win10硬盘镜像</h4> 
<p><code>cmd</code> 中执行如下命令<code>qemu-system-x86_64.exe -bios "OVMF.fd" -M "pc" -m 4096 -cpu "qemu64" -hda E:\iso\win10_xxx.raw -serial stdio</code> (注意：win10 镜像可以通过vmware以及vbox制作)<br> <img src="https://images2.imgbox.com/60/2f/vQmL2pSM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6_OVMF__FWTS_388"></a>6. 使用OVMF 固件启动 FWTS硬盘镜像</h4> 
<p><code>cmd</code> 中执行如下命令<code>chcp 65001 &amp;&amp; "C:\Program Files\qemu\qemu-system-x86_64.exe" -bios "OVMF.fd" -M "pc" -m 4096 -cpu "qemu64" -boot order=dc -serial stdio -hda fwts-live-22.03.00-x86_64.img -usbdevice disk:HDD_BOOT.img </code>(注意：fwts镜像可以从 https://fwts.ubuntu.com/fwts-live/ 下载)<br> <img src="https://images2.imgbox.com/a8/1b/uD2vQhQL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_393"></a>小结：</h3> 
<p>本章完成了UEFI 开源固件<code>OVMF</code>的编译环境搭建以及使用<code>OVMF</code> 启动<code>UEFI shell / Linux OS （busybox + fwts）/ windows</code> . 后续再会添加<code>OVMF</code>启动<code>ReactOS</code>.</p> 
<p>PS:<br> 本文使用的<code>Qemu</code>安装包，<code>OVMF</code>固件以及<code>busybox</code>可以从以下链接下载<br> <a href="https://download.csdn.net/download/xiaopangzi313/85274838">qemu+ovmf+busybox</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a719361363724674d12313212a66071/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C语言】Huffman编码解码简单实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f2c52d40d644f657df0bde3240055e85/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IBL环境贴图原理及着色器实现【基于图像的照明】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>