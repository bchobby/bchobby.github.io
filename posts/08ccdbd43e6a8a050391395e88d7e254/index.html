<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Airflow环境搭建 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Airflow环境搭建" />
<meta property="og:description" content="1 Airflow简介 1.1 简介 Apache Airflow是⼀个提供基于DAG（有向⽆环图）来编排⼯作流的、可视化的分布式任务调度平台（也可单机），与Oozie、Azkaban等调度平台类似。Airflow在2014年由Airbnb发起，2016年3⽉进⼊Apache基⾦会，在2019年1⽉成为顶级项⽬。Airflow采⽤Python语⾔编写，并提供可编程⽅式定义DAG⼯作流（编写Python代码）。当⼯作流通过代码来定义时，它们变得更加可维护、可版本化、可测试和协作。
Airflow的可视化界⾯提供了⼯作流节点的运⾏监控，可以查看每个节点的运⾏状态、运⾏耗时、执⾏⽇志等。也可以在界⾯上对节点的状态进⾏操作，如：标记为成功、标记为失败以及重新运⾏等。在Airflow中⼯作流上每个task都是原⼦可重试的，⼀个⼯作流某个环节的task失败可⾃动
或⼿动进⾏重试，不必从头开始跑。
Airflow通常⽤在数据处理领域，也属于⼤数据⽣态圈的⼀份⼦。当然Airflow也可以⽤于调度⾮数据处理的任务，只不过数据处理任务之间通常都会存在依赖关系。⽽且这个关系可能还⽐较复杂，⽤crontab等基础⼯具⽆法满⾜，因此更需要被调度平台编排和管理。
例如：
时间依赖：任务需要等待某⼀个时间点触发
外部系统依赖：任务依赖外部系统需要调⽤接⼝去访问
任务间依赖：任务 A 需要在任务 B 完成后启动，两个任务互相间会产⽣影响
资源环境依赖：任务消耗资源⾮常多， 或者只能在特定的机器上执⾏
Airflow拥有和 Hive、Presto、MySQL、HDFS、Postgres 和 S3 交互的能力，并且拥有很好地扩展性。除了一个命令行界面，该工具还提供了一个基于 Web 的用户界面让您可以可视化管道的依赖关系、监控进度、触发任务等。
传统 Workflow 通常使用 TextFiles (json,xml/etc ) 来定义 DAG ,然后 Scheduler 解析这些 DAG 文件形成具体的 TaskObjec t执行； Airflow 没这么干，它直接用 Python 写 DAG definition ,一下子突破了文本文件表达能力的局限，定义 DAG 变得简单。
1.2 设计原则 动态：Airflow配置为代码（Python），允许动态生成pipeline。 这允许编写动态实例化的pipelines代码。
自定义：轻松定义自己的opertators，执行程序并扩展库，使其符合适合您环境的抽象级别。
优雅：Airflow精益而明确。 使用强大的Jinja模板引擎将参数化脚本内置于Airflow的核心。
可扩展：Airflow具有模块化体系结构，并使用消息队列来协调任意数量的工作者。 Airflow已准备好扩展到无限远。
特点
Python脚本实现DAG，非常容易扩展
可实现复杂的依赖规则
外部依赖较少，搭建容易，仅依赖DB和rabbitmq
工作流依赖可视化。有一套完整的UI，可视化展现所有任务的状态及历史信息
完全支持crontab定时任务格式，可以通过crontab格式指定任务何时进行
业务代码和调度系统解耦，每个业务的流程代码以独立的Python脚本描述，里面定义了流程化的节点来执行业务逻辑，支持任务的热加载
1.3 功能简介 2 Airflow架构详解 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/08ccdbd43e6a8a050391395e88d7e254/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-23T11:49:01+08:00" />
<meta property="article:modified_time" content="2023-03-23T11:49:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Airflow环境搭建</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:null;"> </p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">1 </span><a class="kdocs-link" style="color:#0A6CFF;" href="https://blog.csdn.net/u013010473/article/details/116018061#1_Airflow_1" target="_blank" rel="noopener noreferrer"><span class="kdocs-bold" style="font-weight:bold;">Airflow简介</span></a></h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:96.38989%;height:0;"> 
    <img src="https://images2.imgbox.com/7e/e4/KawHzSXC_o.png" style="margin-left:;display:block;width:554px;margin-top:-96.38989%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style=""></p> 
 <h4 style="padding-left:1.4em;text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">1.1 简介</span></h4> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">Apache Airflow是⼀个提供基于DAG（有向⽆环图）来编排⼯作流的、可视化的分布式任务调度平台（也可单机），与Oozie、Azkaban等调度平台类似。Airflow在2014年由Airbnb发起，2016年3⽉进⼊Apache基⾦会，在2019年1⽉成为顶级项⽬。Airflow采⽤Python语⾔编写，并提供可编程⽅式定义DAG⼯作流（编写Python代码）。当⼯作流通过代码来定义时，它们变得更加可维护、可版本化、可测试和协作。</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">Airflow的可视化界⾯提供了⼯作流节点的运⾏监控，可以查看每个节点的运⾏状态、运⾏耗时、执⾏⽇志等。也可以在界⾯上对节点的状态进⾏操作，如：标记为成功、标记为失败以及重新运⾏等。在Airflow中⼯作流上每个task都是原⼦可重试的，⼀个⼯作流某个环节的task失败可⾃动</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">或⼿动进⾏重试，不必从头开始跑。</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">Airflow通常⽤在数据处理领域，也属于⼤数据⽣态圈的⼀份⼦。当然Airflow也可以⽤于调度⾮数据处理的任务，只不过数据处理任务之间通常都会存在依赖关系。⽽且这个关系可能还⽐较复杂，⽤crontab等基础⼯具⽆法满⾜，因此更需要被调度平台编排和管理。</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">例如：</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">时间依赖：任务需要等待某⼀个时间点触发</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">外部系统依赖：任务依赖外部系统需要调⽤接⼝去访问</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">任务间依赖：任务 A 需要在任务 B 完成后启动，两个任务互相间会产⽣影响</span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">资源环境依赖：任务消耗资源⾮常多， 或者只能在特定的机器上执⾏</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">Airflow拥有和 Hive、Presto、MySQL、HDFS、Postgres 和 S3 交互的能力，并且拥有很好地扩展性。除了一个命令行界面，该工具还提供了一个基于 Web 的用户界面让您可以可视化管道的依赖关系、监控进度、触发任务等。</span></p> 
 <p style="text-indent:1.4em;padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="padding-left:1.4em;text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">传统 Workflow 通常使用 TextFiles (json,xml/etc ) 来定义 DAG ,然后 Scheduler 解析这些 DAG 文件形成具体的 TaskObjec t执行； Airflow 没这么干，它直接用 Python 写 DAG definition ,一下子突破了文本文件表达能力的局限，定义 DAG 变得简单。</span></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://blog.csdn.net/u013010473/article/details/116018061#12__11" target="_blank" rel="noopener noreferrer"><span class="kdocs-bold" style="font-weight:bold;">1.2 设计原则</span></a></h4> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">动态：Airflow配置为代码（Python），允许动态生成pipeline。 这允许编写动态实例化的pipelines代码。</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">自定义：轻松定义自己的opertators，执行程序并扩展库，使其符合适合您环境的抽象级别。</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">优雅：Airflow精益而明确。 使用强大的Jinja模板引擎将参数化脚本内置于Airflow的核心。</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">可扩展：Airflow具有模块化体系结构，并使用消息队列来协调任意数量的工作者。 Airflow已准备好扩展到无限远。</span></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:left;"> </p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">特点</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">Python脚本实现DAG，非常容易扩展</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">可实现复杂的依赖规则</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">外部依赖较少，搭建容易，仅依赖DB和rabbitmq</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">工作流依赖可视化。有一套完整的UI，可视化展现所有任务的状态及历史信息</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">完全支持crontab定时任务格式，可以通过crontab格式指定任务何时进行</span></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">业务代码和调度系统解耦，每个业务的流程代码以独立的Python脚本描述，里面定义了流程化的节点来执行业务逻辑，支持任务的热加载</span></p> 
 <p style="text-align:left;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">1.3 功能简介</span></h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.032494%;height:0;"> 
    <img src="https://images2.imgbox.com/2e/cd/jjM6eQ1J_o.png" style="margin-left:;display:block;width:554px;margin-top:-33.032494%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2 Airflow架构详解</span></h3> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.1 Airflow服务架构</span></h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:51.26354%;height:0;"> 
    <img src="https://images2.imgbox.com/5f/4b/fgDAbLEx_o.png" style="margin-left:;display:block;width:554px;margin-top:-51.26354%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">如上图所示，airflow主要包含以下服务</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">DAGs:</span></p> 
 <p style="text-align:null;">开发者自定义的DAG调度脚本，存放路径由airflow.cfg中的dags_folder参数决定</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Airflow.cfg</span>:</p> 
 <p style="text-align:null;">该文件非常重要，默认在$AIRFLOW_HOME的路径下，主要配置了我们需要用到的所有组件信息以及一些配置参数。</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Scheduler:</span></p> 
 <p style="text-align:null;">负责处理触发计划的工作流，并将任务提交给executor运行</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Worker(s)</span>:</p> 
 <p style="text-align:null;">负责执行调度任务的节点，当任务很大时，可以合理增加Worker节点来水平扩展集群，并将这些新的节点指向同一个元数据库，从而分发处理过程。</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Executor</span>:</p> 
 <p style="text-align:left;">executor负责运行tasks，Airflow安装时每次只有一个executor,executor被定义为Airflowconfig文件(<span class="kdocs-fontSize" style="font-size:9pt;">airflow.cfg</span>)的核心部分。</p> 
 <p style="text-align:left;">executor分两种，localexecutor和remote executor。local包括DebugExecutor，LocalExecutor和SequentialExecutor。remote executor包括CeleryExecutor和KubernetesExecutor。local用于在本地执行任务，在scheduler线程内部。remote executor在远程执行任务，比如在Kubernets cluster的一个pod中，且常通过一系列workers/worker pool实现。</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Web Server:</span></p> 
 <p style="text-align:null;">提供一个方便的用户界面来检查、触发和调试DAG 和任务的平台</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Metadata DB</span></p> 
 <p style="text-align:left;">Airflow的元数据库信息，用于保存executor、scheduler和web server的相关数据。默认使用SQLite，Airflow可使用任何SQLAlchemy支持的数据库，比如Mysql,Postgre等，一般情况用于常选择PostgreSQL。</p> 
 <p style="text-align:left;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.2 WebServer</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Airflow 提供了一个可视化的 Web 界面。启动 WebServer 后，就可以在 Web 界面上查看定义好的 DAG 并监控及改变运行状况。也可以在 Web 界面中对一些变量进行配置。</span></p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.924189%;height:0;"> 
    <img src="https://images2.imgbox.com/90/92/OmAp25qi_o.png" style="margin-left:;display:block;width:554px;margin-top:-22.924189%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">1.左侧 On/Off 按钮控制DAG 的运行状态，Off 为暂停状态，On 为运行状态。注意：所有 DAG 脚本初次部署完成时均为 Off 状态。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">2.若 DAG 名称处于不可点击状态，可能为 DAG 被删除或未载入。若 DAG 未载入，可点击右侧刷新按钮进行刷新。注意：由于可以部署若干 WebServer，所以单次刷新可能无法刷新所有 WebServer 缓存，可以尝试多次刷新。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">3.Recent Tasks 会显示最近一次 DAG Run（可以理解为 DAG 的执行记录）中 Task Instances（可以理解为作业的执行记录）的运行状态，如果 DAG Run 的状态为 running，此时显示最近完成的一次以及正在运行的 DAG Run 中所有 Task Instances 的状态。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">4.Last Run 显示最近一次的 execution date。注意：execution date 并不是真实执行时间，具体细节在下文 DAG 配置中详述。将鼠标移至 execution date 右侧 info 标记上，会显示 start date，start date 为真实运行时间。start date 一般为 execution date 所对应的下次执行时间。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">5．点击指定的DAG就能看到整个DAG的相关task，根据设定的依赖关系以树状方式呈现</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:33.754513%;height:0;"> 
    <img src="https://images2.imgbox.com/f9/fe/uL6unj0U_o.png" style="margin-left:;display:block;width:554px;margin-top:-33.754513%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.3 Task操作</span></h4> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:99.45848%;height:0;"> 
    <img src="https://images2.imgbox.com/c7/d4/gs7V4psk_o.png" style="margin-left:;display:block;width:554px;margin-top:-99.45848%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">在 DAG 的树状图和 DAG 图中都可以点击对应的 Task Instance 以弹出 Task Instance 模态框，以进行 Task Instance 的相关操作。注意：选择的 Task Instance 为对应 DAG Run 中的 Task Instance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Task InstanceDetails</span> 显示该 Task Instance 的详情，可以从中得知该 Task Instance 的当前状态，以及处于当前状态的原因。例如，若该 TaskInstance 为 no status 状态，迟迟不进入queued 及 running 状态，此时就可通过 TaskInstance Details 中的 Dependency 及 Reason 得知原因。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Rendered</span> 显示该 Task Instance 被渲染后的命令。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Run</span> 指令可以直接执行当前作业。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Clear</span> 指令为清除当前 Task Instance 状态，清除任意一个 Task Instance 都会使当前 DAG Run 的状态变更为 running。注意：如果被清除的 Task Instance 的状态为 running，则会尝试 kill 该 Task Instance 所执行指令，并进入 shutdown 状态，并在 kill 完成后将此次执行标记为 failed（如果 retry 次数没有用完，将标记为 up_for_retry）。Clear 有额外的5个选项，均为多选，这些选项从左到右依次为：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Past</span>: 同时清除所有过去的 DAG Run 中此 Task Instance 所对应的 Task Instance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Future</span>: 同时清除所有未来的 DAG Run 中此 Task Instance 所对应的 Task Instance。注意：仅清除已生成的 DAG Run 中的 Task Instance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Upstream</span>: 同时清除该 DAG Run 中所有此 Task Instance 上游的 Task Instance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Downstream</span>: 同时清除该 DAG Run 中所有此 Task Instance 下游的 Task Instance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Recursive</span>: 当此 Task Instance 为 sub DAG 时，循环清除所有该 sub DAG 中的 Task Instance。注意：若当此 Task Instance 不是 sub DAG 则忽略此选项。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Mark Success</span> 指令为讲当前 Task Instance 状态标记为 success。注意：如果该 Task Instance 的状态为 running，则会尝试 kill 该 Task Instance 所执行指令，并进入 shutdown 状态，并在 kill 完成后将此次执行标记为 failed（如果 retry 次数没有用完，将标记为 up_for_retry）。</span></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.4 Worker</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">一般来说我们用Celery Worker 来执行具体的作业。Worker 可以部署在多台机器上，并可以分别设置接收的队列。当接收的队列中有作业任务时，Worker 就会接收这个作业任务，并开始执行。Airflow 会自动在每个部署 Worker 的机器上同时部署一个 Serve Logs 服务，这样我们就可以在 Web 界面上方便的浏览分散在不同机器上的作业日志了。</span></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.5 Scheduler</span></h4> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">调度器实际上就是一个 airflow.jobs.SchedulerJob 实例 job 持续运行 run 方法，job.run() 在开始时将自身的信息加入到 job 表中，并维护状态和心跳，预期能够正常结束，将结束时间也更新到表中，如果异常中断，导致结束时间为空。不管是如何进行的退出，SchedulerJob退出时会关闭所有子进程。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">整个 Airflow 的调度由 Scheduler负责发起，每隔一段时间Scheduler 就会检查所有定义完成的DAG 和定义在其中的作业，如果有符合运行条件的作业，Scheduler就会发起相应的作业任务以供Worker 接收。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">Scheduler 的调度过程如下：</span></span></p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.06499%;height:0;"> 
    <img src="https://images2.imgbox.com/49/d3/jOsEYmsO_o.png" style="margin-left:;display:block;width:554px;margin-top:-66.06499%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">遍历 dags 路径下的所有 dag 文件, 启动一定数量的进程（进程池），并且给每个进程指派一个 dag 文件。 每个 DagFileProcessor 解析分配给它的dag文件，并根据解析结果在 DB中创建DagRuns 和 TaskInstance。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">在scheduler_loop 中，检查与活动 DagRun 关联的 TaskInstance 的状态，解析 TaskInstance 之间的任何依赖，标识需要被执行的 TaskInstance，然后将它们添加至 executor 队列，将新排列的 TaskInstance 状态更新为QUEUED状态。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">每个可用的executor 从队列中取一个 TaskInstance，然后开始执行它，将此 TaskInstance 的数据库记录更新为SCHEDULED。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">当一个TaskInstance 完成运行，关联的 executor 就会报告到队列并更新数据库中的 TaskInstance 的状态（例如“完成”、“失败”等）。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">一旦所有的dag处理完毕后，就会进行下一轮循环处理。这里还有一个细节就是上一轮的某个dag的处理时间可能很长，导致到下一轮处理的时候这个dag还没有处理完成。 Airflow 的处理逻辑是在这一轮不为这个dag创建进程，这样就不会阻塞进程去处理其余dag。</span></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">2.6 Flower</span></h4> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Flower 监控worker进程的存活性，启动或关闭worker进程，查看运行的task。</span></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3 Airflow核心概念</span></h3> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.1DAGs</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">DAG是一个有向无环图，它是task的集合，并且定义了这些task之间的执行顺序和依赖关系。比如，一个DAG包含A，B，C，D四个任务，A先执行，只有A运行成功后B才能执行，C只有在A，B都成功的基础上才能执行，D不受约束，随时都可以执行。DAG并不关心它的组成任务所做的事情，它的任务是确保他们所做的一切都在适当的时间，或以正确的顺序进行，或者正确处理任何意外的问题。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">DAG 是在标准 Python 文件中定义的，这些文件放在 Airflow 的DAG_FOLDER中。Airflow 将执行每个文件中的代码以动态构建DAG对象。 您可以拥有任意数量的 DAG，每个 DAG 都可以描述任意数量的任务。通常，每个应该对应于单个逻辑工作流。</span></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">整个 DAG 的配置就是一份完整的 Python 代码，在代码中实例化 DAG，实例化适合的 Operator，并通过 set_downstream 等方法配置上下游依赖关系。下面我们简单看一下在 DAG 配置中的几个重要概念。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">dag_id:给 DAG 取一个名字，方便日后维护。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">dafault_args:默认参数，当属于这个 DAG 实例的作业没有配置相应参数时，将使用 DAG 实例的 default_args 中的相应参数。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">schedule_interval:配置 DAG 的执行周期，语法和 crontab 的一致。</span></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.2 Task</span></h4> 
 <p style="text-align:null;">task是Dag里最小的单元，是Dag的实例化，task之间存在依赖关系，每一个task执行都有对应的日志存在。task定义任务的类型、任务内容、任务所依赖的dag等。dag中每个task都要有不同的task_id。任务之间通过task.set_upstream/task.set_downstream来设置依赖，也可以用位运算：</p> 
 <p style="text-align:null;">t1 &gt;&gt; t2 &lt;&lt; t3 表示t2依赖于t1和t3。</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.3 TaskInstance</span></h4> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">记录Task的一次运行，TaskInstance有自己的状态，包括：running、success、failed、 skipped、up forretry等。</span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.4 Sensors</span></h4> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Sensors是一个等待（轮询）某一时间、文件、数据库行、S3键、另一个DAG/Task等的Operator。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">Airflow有3种不同的传感器运作模式:</span></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:32.671482%;height:0;"> 
    <img src="https://images2.imgbox.com/31/ad/yyGP24WV_o.png" style="margin-left:;display:block;width:554px;margin-top:-32.671482%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.5 Operator</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Operator即为操作器，定义任务该以哪种方式执行。airflow有多种operator,如BashOperator、DummyOperator、MySqlOperator、HiveOperator以及社区贡献的operator等，其中BaseOperator是所有operator的基础operator。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Operator 主要有三种类型:</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">执行一项操作或在远程机器上执行一项操作。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">将数据从一个系统移动到另一个系统</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">类似传感器，是一种特定类型Operator，它将持续运行，直到满足某种条件。例如在 HDFS 或 S3 中等待特定文件到达，在 Hive 中出现特定的分区或一天中的特定时间，继承自 BaseSensorOperator。</span></p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.36462%;height:0;"> 
    <img src="https://images2.imgbox.com/84/fb/J71fWrkf_o.png" style="margin-left:;display:block;width:554px;margin-top:-37.36462%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.6 BaseOperator</span></h4> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;">所有的 Operator 都是从BaseOperator 派生而来，并通过继承获得更多功能。因此BaseOperator的参数也是其他Operator的参数。</span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.7 Pools</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">当有太多的进程同时冲击时，一些系统会不堪重负。Airflow Pools可以用来限制任意任务集的执行并行性。Pools的列表是在用户界面(Menu -&gt; Admin -&gt; Pools)中管理的，给Pools一个名字，并给它分配一定数量的工作槽。然后，任务可以通过在创建任务（即实例化操作者）时使用池参数与现有池之一相关联。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">池参数可以和priority_weight一起使用，以定义队列中的优先级，当池中有空位时，哪些任务会被首先执行。默认的priority_weight是1，也可以提升到任何数字。当对队列进行排序以评估哪个任务应该被接下来执行时，我们使用priority_weight，并与该任务下游的所有priority_weight值相加。你可以用它来提升一个特定的重要任务，而通往该任务的整个路径都会得到相应的优先级。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.8 Connections</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">连接到外部系统所需的信息存储在Airflow元存储数据库中，可以在用户界面中管理(Menu -&gt; Admin-&gt; Connections)。一个conn_id被定义在那里，主机名/登录/密码/模式信息被附加到它上面。Airflow管线通过指定相关的conn_id来检索集中管理的连接信息.</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.9 Xcoms</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">XComs让任务交换信息，允许更细微的控制形式和共享状态。这个名字是 "交叉通信 "的缩写。XComs主要由一个键、值和时间戳来定义，但也跟踪一些属性，如创建XCom的task/DAG，以及它何时应该变得可见。任何可以被提取的对象都可以作为XCom值，所以用户应该确保使用适当大小的对象。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">XComs可以被 “推”（发送）或 “拉”（接收）。当一个任务推送一个XCom时，它使其他任务普遍可用。任务可以在任何时候通过调用xcom_push()方法推送XComs。此外，如果一个任务返回一个值（无论是从它的操作者的execute()方法，还是从PythonOperator的python_callable函数），那么包含该值的XCom会自动被推送。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">任务调用xcom_pull()来检索XComs，可以选择应用基于key、源task_ids和源dag_id等标准的过滤器。默认情况下，xcom_pull()过滤的是XComs在被推送时由执行函数返回而自动给出的键（而不是手动推送的XComs）。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">如果xcom_pull传递的是单个字符串的task_ids，那么将返回该任务的最新XCom值；如果传递的是task_ids的列表，那么将返回相应的XCom值的列表。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.10 Variables</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">变量是一种通用的方式来存储和检索任意的内容或设置，作为Airflow中一个简单的键值存储。变量可以从用户界面(Admin -&gt;Variables),、代码或CLI中列出、创建、更新和删除。此外，json设置文件也可以通过用户界面批量上传。虽然你的管道代码定义和你的大多数常量和变量应该在代码中定义，并存储在源控制中，但让一些变量或配置项目通过用户界面访问和修改是非常有用的。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">3.11 Hooks</span></h4> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Hooks是连接外部平台和数据库的接口，如Hive、S3、MySQL、Postgres、HDFS和Pig。Hooks在可能的情况下实现一个通用接口，并作为操作者的构建块。它们也使用airflow.models.connection.Connection模型来检索主机名和认证信息。Hooks将认证代码和信息从管道中分离出来，集中在元数据数据库中。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">Hooks本身在Python脚本、Airflowairflow.operators.PythonOperator以及iPython或Jupyter Notebook等交互式环境中使用也非常有用。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;"> </span></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4 环境搭建——安装Python</span></h3> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.1 安装软件环境</span></h4> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">CentOS 7.X</p> 
 <p style="text-align:null;">Python 3.7或以上版本（推荐）</p> 
 <p style="text-align:null;">Postgres 11.9</p> 
 <p style="text-align:null;">Apache-Airflow 2.1.4</p> 
 <p style="text-align:null;">最好是虚拟机可以上网，方便在线安装</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.2 安装依赖环境</span></h4> 
 <p style="text-align:null;">输入命令：</p> 
 <p style="text-align:null;">yum -y install zlib-devel bzip2-developenssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-develdb4-devel libpcap-devel xz-devel</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:24.187725%;height:0;"> 
    <img src="https://images2.imgbox.com/94/96/m5zMIufR_o.png" style="margin-left:;display:block;width:554px;margin-top:-24.187725%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.3 下载安装包</span></h4> 
 <p style="text-align:null;">cd /usr/local/</p> 
 <p style="text-align:null;">wget <a class="kdocs-link" style="color:#0A6CFF;" href="https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz" rel="nofollow noopener noreferrer" target="_blank">https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz</a></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.732852%;height:0;"> 
    <img src="https://images2.imgbox.com/0e/fa/RjiL8yO4_o.png" style="margin-left:;display:block;width:554px;margin-top:-11.732852%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">检查下载的安装包</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.545128%;height:0;"> 
    <img src="https://images2.imgbox.com/7b/a4/JzXWl3vr_o.png" style="margin-left:;display:block;width:554px;margin-top:-37.545128%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">如果出现 找不到wget命令，输入yum-y install wget，依赖将会被安装</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.4 安装Python3</span></h4> 
 <p style="text-align:null;">安装在/usr/local/python3（具体安装位置看个人喜好）</p> 
 <p style="text-align:null;">创建目录： mkdir -p /usr/local/python3</p> 
 <p style="text-align:null;">解压安装包：tar -zxvf Python-3.7.4.tgz</p> 
 <p style="text-align:null;">解压后出现python的文件夹</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:6.6787004%;height:0;"> 
    <img src="https://images2.imgbox.com/28/3e/F46BLse2_o.png" style="margin-left:;display:block;width:554px;margin-top:-6.6787004%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.5 进入解压后的目录，编译安装</span></h4> 
 <p style="text-align:null;">（编译安装前需要安装编译器yum install gcc）</p> 
 <p style="text-align:null;">安装gcc </p> 
 <p style="text-align:null;">输入命令 yum install gcc，确认下载安装输入“y”</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:15.703972%;height:0;"> 
    <img src="https://images2.imgbox.com/ef/60/08tLnWeg_o.png" style="margin-left:;display:block;width:554px;margin-top:-15.703972%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">（2）3.7版本之后需要一个新的包libffi-devel</p> 
 <p style="text-align:null;">yum install libffi-devel -y</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:8.844765%;height:0;"> 
    <img src="https://images2.imgbox.com/55/e9/KbWae159_o.png" style="margin-left:;display:block;width:554px;margin-top:-8.844765%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">（3）进入python文件夹，生成编译脚本(指定安装目录)：</p> 
 <p style="text-align:null;">cd Python-3.7.4</p> 
 <p style="text-align:null;">./configure--prefix=/usr/local/python3 </p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:5.0541515%;height:0;"> 
    <img src="https://images2.imgbox.com/24/81/K8QO9OeU_o.png" style="margin-left:;display:block;width:554px;margin-top:-5.0541515%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">（4）编译：make</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.288809%;height:0;"> 
    <img src="https://images2.imgbox.com/19/19/x9nsBgdK_o.png" style="margin-left:;display:block;width:554px;margin-top:-10.288809%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:19.855597%;height:0;"> 
    <img src="https://images2.imgbox.com/a3/22/ZigtQZcr_o.png" style="margin-left:;display:block;width:554px;margin-top:-19.855597%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">（5）编译成功后，编译安装：make install</p> 
 <p style="text-align:null;">安装成功</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:31.04693%;height:0;"> 
    <img src="https://images2.imgbox.com/c9/2a/FRqHKLiq_o.png" style="margin-left:;display:block;width:554px;margin-top:-31.04693%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">（6）检查python3.7的编译器：/usr/local/python3/bin/python3.7</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:11.732852%;height:0;"> 
    <img src="https://images2.imgbox.com/75/e5/I2FB9h1A_o.png" style="margin-left:;display:block;width:554px;margin-top:-11.732852%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.6 建立Python3和pip3的软链</span></h4> 
 <p style="text-align:null;">ln -sf /usr/local/python3/bin/python3.7/usr/bin/python3</p> 
 <p style="text-align:null;">ln -sf /usr/local/python3/bin/pip3/usr/bin/pip3</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.7 并将/usr/local/python3/bin加入PATH</span></h4> 
 <p style="text-align:null;"># .bash_profile</p> 
 <p style="text-align:null;"># Get the aliases and functions</p> 
 <p style="text-align:null;">if [ -f ~/.bashrc ]; then</p> 
 <p style="text-align:null;">. ~/.bashrc</p> 
 <p style="text-align:null;">fi</p> 
 <p style="text-align:null;"># User specific environment and startupprograms</p> 
 <p style="text-align:null;">PATH=$PATH:$HOME/bin:/usr/local/python3/bin</p> 
 <p style="text-align:null;">export PATH</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">4.8 检查Python3及pip3是否正常可用</span></h4> 
 <p style="text-align:null;">python3 -V</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:485px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:8.865979%;height:0;"> 
    <img src="https://images2.imgbox.com/e7/66/Zqj0n3zn_o.png" style="margin-left:;display:block;width:485px;margin-top:-8.865979%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;">pip3 -V</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:7.7617326%;height:0;"> 
    <img src="https://images2.imgbox.com/2b/07/CI6h6N37_o.png" style="margin-left:;display:block;width:554px;margin-top:-7.7617326%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5 环境搭建——安装Postgre</span></h3> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.1 下载安装包</span></h4> 
 <p style="text-align:null;">官网<a class="kdocs-link" style="color:#0A6CFF;" href="https://www.postgresql.org/" rel="nofollow noopener noreferrer" target="_blank">https://www.postgresql.org/</a></p> 
 <p style="text-align:null;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://www.postgresql.org/ftp/source/v11.9/" rel="nofollow noopener noreferrer" target="_blank">https://www.postgresql.org/ftp/source/v11.9/</a></p> 
 <p style="text-align:null;">下载后上传到Centos对应的路径，如下：</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:10.649819%;height:0;"> 
    <img src="https://images2.imgbox.com/f4/1d/jd4hUXWc_o.png" style="margin-left:;display:block;width:554px;margin-top:-10.649819%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.2 解压</span></h4> 
 <p style="text-align:null;">mkdir /opt/postgresql</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">mv /home/efron/postgresql-11.9.tar.gz /opt/postgresql</p> 
 <p style="text-align:null;">cd /opt/postgresql</p> 
 <p style="text-align:null;">tar zxvf postgresql-11.9.tar.gz</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.3 编译</span></h4> 
 <p style="text-align:null;">mkdir /usr/local/postgresql</p> 
 <p style="text-align:null;">cd /opt/postgresql/postgresql-11.9</p> 
 <p style="text-align:null;">./configure --prefix=/usr/local/postgresql</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.4 安装</span></h4> 
 <p style="text-align:null;">make &amp;&amp; make install</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">进入安装后的目录，查看目录结构</span></p> 
 <p style="text-align:null;">cd /usr/local/postgresql</p> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:518px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.200773%;height:0;"> 
    <img src="https://images2.imgbox.com/96/76/P4CBxFlg_o.png" style="margin-left:;display:block;width:518px;margin-top:-22.200773%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">创建目录data、log</span></p> 
 <p style="text-align:null;">mkdir /usr/local/postgresql/data</p> 
 <p style="text-align:null;">mkdir /usr/local/postgresql/log</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.5 加入系统环境变量</span></h4> 
 <p style="text-align:left;">vim /etc/profile</p> 
 <p style="text-align:left;">在最后写入如下内容</p> 
 <p style="text-align:left;">PGHOME=/usr/local/postgresql</p> 
 <p style="text-align:left;">export PGHOME</p> 
 <p style="text-align:left;">PGDATA=/usr/local/postgresql/data</p> 
 <p style="text-align:left;">export PGDATA</p> 
 <p style="text-align:left;">PATH=$PATH:$HOME/.local/bin:$HOME/bin:$PGHOME/bin</p> 
 <p style="text-align:left;">export PATH</p> 
 <p style="text-align:left;">使配置文件生效</p> 
 <p style="text-align:left;">source /etc/profile</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.6 增加用户 postgres 并赋权</span></h4> 
 <p style="text-align:null;">adduser postgres</p> 
 <p style="text-align:null;">chown -R postgres:root /usr/local/postgresql/</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.7 初始化数据库</span></h4> 
 <p style="text-align:null;">su postgres</p> 
 <p style="text-align:null;"> /usr/local/postgresql/bin/initdb -D/usr/local/postgresql/data/</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.8 编辑配置文件</span></h4> 
 <p style="text-align:left;">vim/usr/local/postgresql/data/postgresql.conf</p> 
 <p style="text-align:left;">listen_addresses = '*'</p> 
 <p style="text-align:left;">port = 5432</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.9 启动数据库服务</span></h4> 
 <p style="text-align:null;">pg_ctl start -l/usr/local/postgresql/log/pg_server.log</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.7472925%;height:0;"> 
    <img src="https://images2.imgbox.com/53/2f/FrcGEGP3_o.png" style="margin-left:;display:block;width:554px;margin-top:-9.7472925%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">查看版本</span></p> 
 <p style="text-align:null;">psql -V</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:453px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:9.933775%;height:0;"> 
    <img src="https://images2.imgbox.com/72/ef/ee6QJaCA_o.png" style="margin-left:;display:block;width:453px;margin-top:-9.933775%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.10 登录数据库</span></h4> 
 <p style="text-align:null;">psql -U postgres -d postgres</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:539px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:17.068645%;height:0;"> 
    <img src="https://images2.imgbox.com/08/60/CI8rm6Nn_o.png" style="margin-left:;display:block;width:539px;margin-top:-17.068645%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">修改密码：</p> 
 <p style="text-align:null;">alter user postgres password"airflow"</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">5.11 创建airflow数据库</span></h4> 
 <p style="text-align:null;">create database airflow;</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:341px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:14.076246%;height:0;"> 
    <img src="https://images2.imgbox.com/97/cd/tSIWFAOA_o.png" style="margin-left:;display:block;width:341px;margin-top:-14.076246%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">GRANT ALL PRIVILEGES ON DATABASE airflow TO postgres;</p> 
 <p style="text-align:left;"> </p> 
 <p style="text-align:left;">/*Also note that since SqlAlchemy does not expose a way to targeta specific schema in the database URI, you may want to set a default schema foryour role with a SQL statement similar to */</p> 
 <p style="text-align:left;"> </p> 
 <p style="text-align:left;">ALTER ROLE postgres SET search_path = airflow, foobar</p> 
 <p style="text-align:left;"> </p> 
 <p style="text-align:null;">如果是Mysql数据库，执行以下操作</p> 
 <p style="text-align:null;">Create database airflowdb;</p> 
 <p style="text-align:null;">--创建用户airflow,设置所有IP均可以访问</p> 
 <p style="text-align:null;">Create user ‘airflow’@’%’ identified by ‘12345678’;</p> 
 <p style="text-align:null;">Create user ‘airflow’@’localhost’ identified by ‘12345678’;</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">--用户授权</p> 
 <p style="text-align:null;">Grant all on airflowdb.* to ‘airflow’@’%’;</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">--设置口令的级别</p> 
 <p style="text-align:null;">Set GLOBAL explicit_defaults_fow_timestamp = 1;</p> 
 <p style="text-align:null;">Flush privileges;</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">使用Dbeaver连接元数据库（这一步不是必须）</p> 
 <p style="text-align:null;">pg 元数据库连接，</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.90614%;height:0;"> 
    <img src="https://images2.imgbox.com/57/e6/WuoeQ7pg_o.png" style="margin-left:;display:block;width:554px;margin-top:-37.90614%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:74.54874%;height:0;"> 
    <img src="https://images2.imgbox.com/4a/2a/r1eajOH9_o.png" style="margin-left:;display:block;width:554px;margin-top:-74.54874%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"> </p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6 环境搭建——安装Airflow</span></h3> 
 <p style="text-align:null;">Airflow安装方式有多种，可以选择拉取镜像安装，如果是在云平台的K8S,还可以通过控制台实现一键安装</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">为了达到学习和练习的目的，我推荐如下安装方式，也是官网推荐的一种安装方式：本地安装(RunningAirflow locally)，对应的官网地址：</p> 
 <p style="text-align:null;"><a class="kdocs-link" style="color:#0A6CFF;" href="https://airflow.apache.org/docs/apache-airflow/stable/start/local.html" rel="nofollow noopener noreferrer" target="_blank">https://airflow.apache.org/docs/apache-airflow/stable/start/local.html</a></p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.1 创建虚拟环境</span></h4> 
 <p style="text-align:null;">python3 -m venv tutorial-env</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">##激活虚拟环境</p> 
 <p style="text-align:null;"># On Windows, run:</p> 
 <p style="text-align:null;"># tutorial-env\Scripts\activate.bat</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"># On Unix or MacOS, run:</p> 
 <p style="text-align:null;">source/usr/local/airflow/tutorial-env/bin/activate</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.2 检查pip版本,升级到最新</span></h4> 
 <p style="text-align:null;">pip3 -V</p> 
 <p style="text-align:null;">pip3 install --upgrade pip</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:14.259928%;height:0;"> 
    <img src="https://images2.imgbox.com/64/c7/PP5ZOxDm_o.png" style="margin-left:;display:block;width:554px;margin-top:-14.259928%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.3 开始安装</span></h4> 
 <p style="text-align:null;"># Airflow needs a home. `~/airflow` is thedefault, but you can put it</p> 
 <p style="text-align:null;"># somewhere else if you prefer (optional)</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">export AIRFLOW_HOME=/usr/local/airflow/</span></p> 
 <p style="text-align:null;">echo "exportAIRFLOW_HOME=/usr/local/airflow" &gt;&gt; ~/.bashrc</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"># Install Airflow using the constraintsfile</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">AIRFLOW_VERSION=2.1.4</span></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">PYTHON_VERSION="$(python3 --version| cut -d " " -f 2 | cut -d "." -f 1-2)"</span></p> 
 <p style="text-align:null;"># For example: 3.6</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">CONSTRAINT_URL="</span><a class="kdocs-link" style="color:#0A6CFF;" href="https://raw.githubusercontent.com/apache/airflow/constraints-%24%7bAIRFLOW_VERSION%7d/constraints-%24%7bPYTHON_VERSION%7d.txt" rel="nofollow"><span class="kdocs-bold" style="font-weight:bold;">https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"</span></a></p> 
 <p style="text-align:null;"># For example:<a class="kdocs-link" style="color:#0A6CFF;" href="https://raw.githubusercontent.com/apache/airflow/constraints-2.2.5/constraints-3.6.txt" rel="nofollow noopener noreferrer" target="_blank">https://raw.githubusercontent.com/apache/airflow/constraints-2.2.5/constraints-3.6.txt</a></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">pip3 install"apache-airflow==${AIRFLOW_VERSION}" --constraint"${CONSTRAINT_URL}"</span></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:663px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:12.217195%;height:0;"> 
    <img src="https://images2.imgbox.com/07/66/hlLxExOF_o.png" style="margin-left:;display:block;width:663px;margin-top:-12.217195%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"># The Standalone command will initialisethe database, make a user,</p> 
 <p style="text-align:null;"># and start all components for you.</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">airflow standalone</span></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.4 自定义元数据库类型</span></h4> 
 <p style="text-align:null;"># 元数据库默认是Sqllit数据库，如果是其他数据库，需要修改对应的配置类型，我们选择的是Postgre,因此按照如下方式修改即可.</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">vim /usr/local/airflow/airflow.cfg</p> 
 <p style="text-align:null;">sql_alchemy_conn =postgresql+psycopg2://postgres:airflow@localhost:5432/airflow</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;"> </span></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.5 安装psycopg2</span></h4> 
 <p style="text-align:null;"># 因为安装时，python需要去连接Postgre数据库，因此还需要安装psycopg2</p> 
 <p style="text-align:null;">pip3 install psycopg2</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.6 元数据库初始化</span></h4> 
 <p style="text-align:null;">airflow db init</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">报错问题解决：</p> 
 <p style="text-align:null;"># ImportError: libpq.so.5: cannot openshared object file: No such file or directory</p> 
 <p style="text-align:null;">cd /etc/ld.so.conf.d</p> 
 <p style="text-align:null;">echo "/usr/local/postgresql/lib"&gt;&gt; pgsql.conf</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">ldconfig</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">find / -name libpq.so.5</p> 
 <p style="text-align:null;">找到</p> 
 <p style="text-align:null;">/usr/local/postgresql/lib/libpq.so.5</p> 
 <p style="text-align:null;">lib下明明有，但还是报这个错</p> 
 <p style="text-align:null;">原来是没有将gp的lib目录添加到环境变量中</p> 
 <p style="text-align:null;">vim ~/.bashrc</p> 
 <p style="text-align:null;">添加</p> 
 <p style="text-align:null;">exportLD_LIBRARY_PATH=/usr/local/postgresql/lib</p> 
 <p style="text-align:null;">source ~/.bashrc</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">find / -name pg_hba.conf</p> 
 <p style="text-align:null;">找到 </p> 
 <p style="text-align:null;">/usr/local/postgresql/data/pg_hba.conf</p> 
 <p style="text-align:null;">添加 </p> 
 <p style="text-align:null;">host postgres all 127.0.0.1/32 ident</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">如果出现schema没有指定的错误，需要修改一个参数文件</p> 
 <p style="text-align:null;">Vim /usr/local/postgresql/data/postgresql.conf</p> 
 <p style="text-align:null;">将 search_path参数打开</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:20.938627%;height:0;"> 
    <img src="https://images2.imgbox.com/74/a5/vNMOK1uF_o.png" style="margin-left:;display:block;width:554px;margin-top:-20.938627%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.7 创建Web UI登陆用户</span></h4> 
 <p style="text-align:null;">--管理员账号</p> 
 <p style="text-align:null;">airflow users create \</p> 
 <p style="text-align:null;"> --username airflow \</p> 
 <p style="text-align:null;"> --firstname efron \</p> 
 <p style="text-align:null;"> --lastname shu \</p> 
 <p style="text-align:null;"> --role Admin \</p> 
 <p style="text-indent:1.4em;text-align:null;">--email <a class="kdocs-link" style="color:#0A6CFF;" href="mailto:efron.shu@sina.com" rel="nofollow noopener noreferrer" target="_blank">efron.shu@sina.com</a></p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">此时会提示设置密码，按提示输入账号密码即可.</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.8 启动webserver和scheduler</span></h4> 
 <p style="text-align:null;">source /usr/local/airflow/tutorial-env/bin/activate</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">检查端口：</p> 
 <p style="text-align:null;">netstat -ntlp | grep 8080</p> 
 <p style="text-align:null;"> </p> 
 <p style="text-align:null;">airflow scheduler -D</p> 
 <p style="text-align:null;">airflow webserver --port 8080 -D</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:5.415162%;height:0;"> 
    <img src="https://images2.imgbox.com/b0/46/NOlXBhP2_o.png" style="margin-left:;display:block;width:554px;margin-top:-5.415162%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.9 Web端口开放</span></h4> 
 <p style="text-align:null;">点击”Tunneling”配置映射端口到本地</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:71.11913%;height:0;"> 
    <img src="https://images2.imgbox.com/ac/93/oREPjHG0_o.png" style="margin-left:;display:block;width:554px;margin-top:-71.11913%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.40433%;height:0;"> 
    <img src="https://images2.imgbox.com/2a/eb/CKwZHIdE_o.png" style="margin-left:;display:block;width:554px;margin-top:-44.40433%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">6.10 Web登陆Airflow</span></h4> 
 <p style="text-align:null;"><a class="kdocs-link" style="color:#0A6CFF;" href="http://127.0.0.1:8080/" rel="nofollow noopener noreferrer" target="_blank">http://127.0.0.1:8080/</a></p> 
 <p style="text-align:null;">airflow/airflow</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:null;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:554px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.563175%;height:0;"> 
    <img src="https://images2.imgbox.com/83/4e/AmO6DK9N_o.png" style="margin-left:;display:block;width:554px;margin-top:-22.563175%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">至此，Airflow的环境就部署完成了</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e98c2c046e26be6ba26dc404b9840eaa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">caj文件怎么转换成pdf格式？三步搞定</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/06b9cf6da548e2eabc047fc981672678/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pyecharts 图表更改颜色</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>