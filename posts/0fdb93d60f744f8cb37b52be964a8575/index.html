<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Share 2021】caoyang.log（END） - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Share 2021】caoyang.log（END）" />
<meta property="og:description" content="本文停更，新篇发布于：https://www.jianshu.com/u/90c2509fcc3e
文章目录 开篇序May 202105-0805-0905-1005-1105-1205-1305-1405-1505-1605-1705-1805-1905-2005-2105-2205-2305-2405-2505-2605-2705-2805-2905-3005-31 June 202106-0106-0206-0306-0406-0506-0606-0706-0806-0906-1006-1106-1206-1306-1406-1506-1606-1706-1806-1906-2006-2106-2206-2306-2406-2506-2606-2706-2806-2906-30 July 202107-0107-0207-0307-0407-0507-0607-0707-0807-0907-1007-1107-1207-1307-1407-1507-1607-1707-1807-1907-2007-2107-2207-2407-2407-2507-2607-2707-2807-2907-3007-31 August 202108-0108-0208-0308-0408-05 完篇记 开篇序 真实原因是上一篇字数超上限不给写了，虽然我也确实很想重写新的…
目测上半年剩余时间会以更新运筹优化，数值计算以及随机分析的内容为主，等到下半年可能会重归本业做些有趣的事情。
今日凌晨VAE发布了新曲MV《乌鸦》，感觉VAE的创作风格真的是越来越剑走偏锋，与前三张专辑的风格迥异，但是多听几遍总是可以产生共情的。
所以有时候会想人和人的喜怒真的是不相通么？也许只是难以同乐，单论共悲或许要容易得多。
由于诸多的偏差，往往我们多数时候只能看到别人光鲜面，却发现自己大部分时候都是在平淡地活着，甚至是颓唐地活着，因此一旦觉察倒世上也有与我一样的人，难免就会触而生情。
但是我想到了这个年纪，并没有几个人真的可以做到无忧无虑，各式各样的烦恼总是会有。
人到底血肉之躯，脆弱的时候至刚易折，偶然有烛火照亮我，就会下意识地去追求这团微弱的光芒，渴求还能找到春天。
假若有缘，或许时间并不是问题，谁知道呢。确实是很久了，有时候觉得可能还是像这次决绝一点好罢。
宴尔新昏，如兄如弟。宴尔新昏，不我屑矣。品荼苦而故作乐，大约是会有一点这种感觉的罢。
May 2021 05-08 午休起来看到W已在801，克制，虽然看到了还是觉得有点遗憾， 定义【可达常数】：若存在常数 m m m，使得 ∀ n ≥ m \forall n\ge m ∀n≥m，图 G G G中任意两个顶点之间都存在一条长度为 n n n的路径，则称 m m m为可达常数。（简单也可以理解为 C n 2 C_n^2 Cn2​对顶点之间最短距离的最大值，其实这个定义不是很严谨）；
昨晚测试了一下随机生成的强连通图 G = ( V , E ) G=(V,E) G=(V,E)，其中 ∣ E ∣ = 2 ∣ V ∣ |E|=2|V| ∣E∣=2∣V∣的一个可达常数（reachability constant）的情况，从 ∣ V ∣ = 2 4 |V|=2^4 ∣V∣=24测试到 ∣ V ∣ = 2 16 |V|=2^{16} ∣V∣=216，发现可达常数刚好是 4 4 4~ 16 16 16，也就是 log ⁡ 2 ∣ V ∣ \log_2 |V| log2​∣V∣的水平，这个确实是一件很巧的事情。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/0fdb93d60f744f8cb37b52be964a8575/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-08T10:08:56+08:00" />
<meta property="article:modified_time" content="2021-05-08T10:08:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Share 2021】caoyang.log（END）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font color="red">本文停更，新篇发布于</font>：<a href="https://www.jianshu.com/u/90c2509fcc3e" rel="nofollow">https://www.jianshu.com/u/90c2509fcc3e</a></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">开篇序</a></li><li><ul><li><a href="#May_2021_24" rel="nofollow">May 2021</a></li><li><ul><li><a href="#0508_25" rel="nofollow">05-08</a></li><li><a href="#0509_40" rel="nofollow">05-09</a></li><li><a href="#0510_51" rel="nofollow">05-10</a></li><li><a href="#0511_109" rel="nofollow">05-11</a></li><li><a href="#0512_120" rel="nofollow">05-12</a></li><li><a href="#0513_137" rel="nofollow">05-13</a></li><li><a href="#0514_183" rel="nofollow">05-14</a></li><li><a href="#0515_212" rel="nofollow">05-15</a></li><li><a href="#0516_285" rel="nofollow">05-16</a></li><li><a href="#0517_303" rel="nofollow">05-17</a></li><li><a href="#0518_316" rel="nofollow">05-18</a></li><li><a href="#0519_337" rel="nofollow">05-19</a></li><li><a href="#0520_355" rel="nofollow">05-20</a></li><li><a href="#0521_371" rel="nofollow">05-21</a></li><li><a href="#0522_423" rel="nofollow">05-22</a></li><li><a href="#0523_438" rel="nofollow">05-23</a></li><li><a href="#0524_512" rel="nofollow">05-24</a></li><li><a href="#0525_617" rel="nofollow">05-25</a></li><li><a href="#0526_643" rel="nofollow">05-26</a></li><li><a href="#0527_651" rel="nofollow">05-27</a></li><li><a href="#0528_682" rel="nofollow">05-28</a></li><li><a href="#0529_692" rel="nofollow">05-29</a></li><li><a href="#0530_768" rel="nofollow">05-30</a></li><li><a href="#0531_836" rel="nofollow">05-31</a></li></ul> 
   </li><li><a href="#June_2021_889" rel="nofollow">June 2021</a></li><li><ul><li><a href="#0601_890" rel="nofollow">06-01</a></li><li><a href="#0602_1015" rel="nofollow">06-02</a></li><li><a href="#0603_1020" rel="nofollow">06-03</a></li><li><a href="#0604_1039" rel="nofollow">06-04</a></li><li><a href="#0605_1146" rel="nofollow">06-05</a></li><li><a href="#0606_1158" rel="nofollow">06-06</a></li><li><a href="#0607_1178" rel="nofollow">06-07</a></li><li><a href="#0608_1222" rel="nofollow">06-08</a></li><li><a href="#0609_1231" rel="nofollow">06-09</a></li><li><a href="#0610_1360" rel="nofollow">06-10</a></li><li><a href="#0611_1451" rel="nofollow">06-11</a></li><li><a href="#0612_1494" rel="nofollow">06-12</a></li><li><a href="#0613_1597" rel="nofollow">06-13</a></li><li><a href="#0614_1646" rel="nofollow">06-14</a></li><li><a href="#0615_1812" rel="nofollow">06-15</a></li><li><a href="#0616_1831" rel="nofollow">06-16</a></li><li><a href="#0617_1882" rel="nofollow">06-17</a></li><li><a href="#0618_1900" rel="nofollow">06-18</a></li><li><a href="#0619_2017" rel="nofollow">06-19</a></li><li><a href="#0620_2036" rel="nofollow">06-20</a></li><li><a href="#0621_2137" rel="nofollow">06-21</a></li><li><a href="#0622_2167" rel="nofollow">06-22</a></li><li><a href="#0623_2303" rel="nofollow">06-23</a></li><li><a href="#0624_2365" rel="nofollow">06-24</a></li><li><a href="#0625_2418" rel="nofollow">06-25</a></li><li><a href="#0626_2436" rel="nofollow">06-26</a></li><li><a href="#0627_2446" rel="nofollow">06-27</a></li><li><a href="#0628_2497" rel="nofollow">06-28</a></li><li><a href="#0629_2510" rel="nofollow">06-29</a></li><li><a href="#0630_2522" rel="nofollow">06-30</a></li></ul> 
   </li><li><a href="#July_2021_2577" rel="nofollow">July 2021</a></li><li><ul><li><a href="#0701_2578" rel="nofollow">07-01</a></li><li><a href="#0702_2645" rel="nofollow">07-02</a></li><li><a href="#0703_2668" rel="nofollow">07-03</a></li><li><a href="#0704_2675" rel="nofollow">07-04</a></li><li><a href="#0705_2826" rel="nofollow">07-05</a></li><li><a href="#0706_2915" rel="nofollow">07-06</a></li><li><a href="#0707_2939" rel="nofollow">07-07</a></li><li><a href="#0708_2965" rel="nofollow">07-08</a></li><li><a href="#0709_3005" rel="nofollow">07-09</a></li><li><a href="#0710_3031" rel="nofollow">07-10</a></li><li><a href="#0711_3058" rel="nofollow">07-11</a></li><li><a href="#0712_3062" rel="nofollow">07-12</a></li><li><a href="#0713_3071" rel="nofollow">07-13</a></li><li><a href="#0714_3248" rel="nofollow">07-14</a></li><li><a href="#0715_3427" rel="nofollow">07-15</a></li><li><a href="#0716_3438" rel="nofollow">07-16</a></li><li><a href="#0717_3497" rel="nofollow">07-17</a></li><li><a href="#0718_3540" rel="nofollow">07-18</a></li><li><a href="#0719_3562" rel="nofollow">07-19</a></li><li><a href="#0720_3582" rel="nofollow">07-20</a></li><li><a href="#0721_3861" rel="nofollow">07-21</a></li><li><a href="#0722_3902" rel="nofollow">07-22</a></li><li><a href="#0724_3933" rel="nofollow">07-24</a></li><li><a href="#0724_3959" rel="nofollow">07-24</a></li><li><a href="#0725_4038" rel="nofollow">07-25</a></li><li><a href="#0726_4176" rel="nofollow">07-26</a></li><li><a href="#0727_4210" rel="nofollow">07-27</a></li><li><a href="#0728_4342" rel="nofollow">07-28</a></li><li><a href="#0729_4359" rel="nofollow">07-29</a></li><li><a href="#0730_4528" rel="nofollow">07-30</a></li><li><a href="#0731_4568" rel="nofollow">07-31</a></li></ul> 
   </li><li><a href="#August_2021_4613" rel="nofollow">August 2021</a></li><li><ul><li><a href="#0801_4614" rel="nofollow">08-01</a></li><li><a href="#0802_4686" rel="nofollow">08-02</a></li><li><a href="#0803_4725" rel="nofollow">08-03</a></li><li><a href="#0804_4817" rel="nofollow">08-04</a></li><li><a href="#0805_4841" rel="nofollow">08-05</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_4901" rel="nofollow">完篇记</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_4"></a>开篇序</h2> 
<p>真实原因是上一篇字数超上限不给写了，虽然我也确实很想重写新的…</p> 
<p>目测上半年剩余时间会以更新运筹优化，数值计算以及随机分析的内容为主，等到下半年可能会重归本业做些有趣的事情。</p> 
<p>今日凌晨VAE发布了新曲MV《乌鸦》，感觉VAE的创作风格真的是越来越剑走偏锋，与前三张专辑的风格迥异，但是多听几遍总是可以产生共情的。</p> 
<p>所以有时候会想人和人的喜怒真的是不相通么？也许只是难以同乐，单论共悲或许要容易得多。</p> 
<p>由于诸多的偏差，往往我们多数时候只能看到别人光鲜面，却发现自己大部分时候都是在平淡地活着，甚至是颓唐地活着，因此一旦觉察倒世上也有与我一样的人，难免就会触而生情。</p> 
<p>但是我想到了这个年纪，并没有几个人真的可以做到无忧无虑，各式各样的烦恼总是会有。</p> 
<p>人到底血肉之躯，脆弱的时候至刚易折，偶然有烛火照亮我，就会下意识地去追求这团微弱的光芒，渴求还能找到春天。</p> 
<p>假若有缘，或许时间并不是问题，谁知道呢。确实是很久了，有时候觉得可能还是像这次决绝一点好罢。</p> 
<p>宴尔新昏，如兄如弟。宴尔新昏，不我屑矣。品荼苦而故作乐，大约是会有一点这种感觉的罢。</p> 
<h3><a id="May_2021_24"></a>May 2021</h3> 
<h4><a id="0508_25"></a>05-08</h4> 
<blockquote> 
 <ul><li>午休起来看到W已在801，克制，虽然看到了还是觉得有点遗憾，</li></ul> 
</blockquote> 
<p><mark>定义【可达常数】</mark>：若存在常数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
      
        m 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span></span></span></span></span>，使得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∀ 
        
       
         n 
        
       
         ≥ 
        
       
         m 
        
       
      
        \forall n\ge m 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83041em; vertical-align: -0.13597em;"></span><span class="mord">∀</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span></span></span></span></span>，图<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
      
        G 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">G</span></span></span></span></span>中任意两个顶点之间都存在一条长度为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span>的路径，则称<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
      
        m 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span></span></span></span></span>为可达常数。（简单也可以理解为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          C 
         
        
          n 
         
        
          2 
         
        
       
      
        C_n^2 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.06111em; vertical-align: -0.247em;"></span><span class="mord"><span style="margin-right: 0.07153em;" class="mord mathdefault">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.453em; margin-left: -0.07153em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span></span></span></span></span>对顶点之间最短距离的最大值，其实这个定义不是很严谨）；</p> 
<p>昨晚测试了一下随机生成的强连通图<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
         = 
        
       
         ( 
        
       
         V 
        
       
         , 
        
       
         E 
        
       
         ) 
        
       
      
        G=(V,E) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="mclose">)</span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∣ 
        
       
         E 
        
       
         ∣ 
        
       
         = 
        
       
         2 
        
       
         ∣ 
        
       
         V 
        
       
         ∣ 
        
       
      
        |E|=2|V| 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mord">∣</span></span></span></span></span>的一个可达常数（<em>reachability constant</em>）的情况，从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∣ 
        
       
         V 
        
       
         ∣ 
        
       
         = 
        
        
        
          2 
         
        
          4 
         
        
       
      
        |V|=2^4 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span>测试到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∣ 
        
       
         V 
        
       
         ∣ 
        
       
         = 
        
        
        
          2 
         
        
          16 
         
        
       
      
        |V|=2^{16} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span></span>，发现可达常数刚好是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         4 
        
       
      
        4 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span></span></span></span></span>~<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         16 
        
       
      
        16 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span></span>，也就是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           log 
          
         
           ⁡ 
          
         
        
          2 
         
        
       
         ∣ 
        
       
         V 
        
       
         ∣ 
        
       
      
        \log_2 |V| 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mord">∣</span></span></span></span></span>的水平，这个确实是一件很巧的事情。</p> 
<p>具体的随机生成方法就是每个顶点都有两个出度，然后确保每个顶点都有入度即可。</p> 
<p>上面的测试结论虽然还是比较容易接受的（因为如果做BFS可以近似的认为遍历的顶点数会呈<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          2 
         
        
          n 
         
        
       
      
        2^n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.664392em; vertical-align: 0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>的速度增长，因此至少这个量级还是比较容易被接受的），但是严格证明起来并不是很容易。</p> 
<p>不过我们也不会太关注证明，类推地，可以想到如果每个顶点有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span></span></span></span></span>个出度，那么可达常数可以用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           log 
          
         
           ⁡ 
          
         
        
          k 
         
        
       
         ∣ 
        
       
         V 
        
       
         ∣ 
        
       
      
        \log_k|V| 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.241968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mord">∣</span></span></span></span></span>来估计。</p> 
<p>一个现实的案例即为<strong>六度空间</strong>，即世界上任意两个人通过六个人即可联系到，以目前<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         70 
        
       
      
        70 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">7</span><span class="mord">0</span></span></span></span></span>亿人口来计算的话，这大约是假设每个人的出度（即人脉数）为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
        
          6 
         
        
        
         
         
           7 
          
         
           × 
          
         
           1 
          
          
          
            0 
           
          
            9 
           
          
         
        
       
         ≈ 
        
       
         43 
        
       
      
        ^6\sqrt{7\times 10^9}\approx 43 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.04em; vertical-align: -0.126611em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.913389em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord">7</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.87339em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
           <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
            <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
           </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.126611em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span><span class="mord">3</span></span></span></span></span>，还算是合理罢。</p> 
<h4><a id="0509_40"></a>05-09</h4> 
<blockquote> 
 <ul><li>真的狼灭啊，三点不睡发邮件，当日还得早起有事。话说这反射弧也太长了，不回也没啥其实，好在这样事件算是正式画上句号，明天最后一课我也不会太尴尬了，如释重负。</li><li>31℃，4km，17’03"，这么好的状态也破不了16’56"的pb，接下来要刷新pb越来越难，下周二周四比较凉快，争取再试一次。</li><li>被迫参加月底研学代会，其实现在我倒是不太抗拒这些无聊的琐事，就算是我本科四年欠下的经历给补上罢。</li></ul> 
</blockquote> 
<p>机器学习×数值分析，就决定做这个方向了，lh想做迭代算法做那我就一个人搞这个，还是有点意思的，至少我现在看了这么多ACL EMNLP的顶会paper从来没有人用过这些最传统的统计方法，以及对优化算法的底层进行改进，现在想想确实如此，有那么多ill-conditioned的问题，凭什么你会觉得在你找到的训练集上模型的损失函数真的可以被优化算法（如SGD，ADAM）优化得很好。</p> 
<p>现在的问题是在DL年代，我们并不关心训练数据长什么样子，反正一股脑儿输进去就完事了，但是我觉得至少输入数据的条件数还是非常有参考意义的（即输入矩阵的最大奇异值除以最小奇异值），尤其是在NLP领域，很多外部知识（如词袋模型，tfidf矩阵，乃至知识图谱？）都是可以转换为矩阵形式输入到模型中去的。只是这里面有个trick，就是现在的输入数据越来越复杂，可能大多数时候已经不是矩阵，而是至少三维的张量，这个条件数以及预条件子矩阵怎么从二维推广到三维确实是个问题，另一个问题是输入的广度也是复杂的，可能有时候需要综合多个不同类型的输入（比如还有其他特征）。我想对于前者可能切片处理，这也许是一个解决方案，给每个切片找个预条件子矩阵，现在不是确实也有人在研究用CNN自动生成预条件子矩阵的事情嘛。对于后者的话，我倾向于建立子模型来处理，我还是挺反对把所有能用的东西全部输入到模型训练，应当将不同的输入分别训练，这可能需要设计更加合理的结构，还得实践才能知道该怎么做。</p> 
<p>总之我越来越觉得邓琪的研究方向很有趣，这学期虽然这门课没有怎么听（因为太难听不懂，而且不考试），但是确实是非常有帮助的知识，对我之后的进展大概率会有思路上的开拓，总之人还是不能太局限于代码上的能力，理论知识，无论紧密与否，选择走这条路就得博采众长，包括计量那边的一些研究方法，也是很值得借鉴的，现在毕业真TM难，我可不想被延毕。</p> 
<h4><a id="0510_51"></a>05-10</h4> 
<blockquote> 
 <ul><li>《散去的时候》我听到了，一个人比较好，尽力在躲避，行吧，还是这样的歌词比较适合你的风格。</li><li>再见很早就已经说过，多说还是太过于矫揉造作。最后一课，我是有想说点什么作为告别，毕竟那晚回来后就再也没有见过了，再次看到时总还是会有点在意，实话说我还真是容易被这种假小子的装扮给惊艳到…</li><li>好在以后不太可能再见了，无声的告别也许确实更好，让一切都淡去吧。总之还是多谢了，各种意义上，前路安好。</li><li>我发誓这是最后一个颓废的晚上了，以后绝对要足够自律起来了，再不自律真的凉了。</li></ul> 
</blockquote> 
<p>GPR的scipy实现：其实我之前就很奇怪，这种根据一条样本曲线去拟合整个样本空间分布的做法实在是很胃疼，虽然看起来是很有道理，但是有道理的事情一般都不太行得通。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>optimize <span class="token keyword">import</span> minimize
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">class</span> <span class="token class-name">GPR</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> optimize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>is_fit <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>train_X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>train_y <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"l"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">"sigma_f"</span><span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>optimize <span class="token operator">=</span> optimize

    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># store train data</span>
        self<span class="token punctuation">.</span>train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>train_y <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>is_fit <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_fit<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GPR Model not fit yet."</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        X <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        Kff <span class="token operator">=</span> self<span class="token punctuation">.</span>kernel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>train_X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>train_X<span class="token punctuation">)</span>  <span class="token comment"># (N, N)</span>
        Kyy <span class="token operator">=</span> self<span class="token punctuation">.</span>kernel<span class="token punctuation">(</span>X<span class="token punctuation">,</span> X<span class="token punctuation">)</span>  <span class="token comment"># (k, k)</span>
        Kfy <span class="token operator">=</span> self<span class="token punctuation">.</span>kernel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>train_X<span class="token punctuation">,</span> X<span class="token punctuation">)</span>  <span class="token comment"># (N, k)</span>
        Kff_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>Kff <span class="token operator">+</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">8</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>train_X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># (N, N)</span>
        mu <span class="token operator">=</span> Kfy<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>Kff_inv<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>train_y<span class="token punctuation">)</span>
        cov <span class="token operator">=</span> Kyy <span class="token operator">-</span> Kfy<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>Kff_inv<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>Kfy<span class="token punctuation">)</span>
        <span class="token keyword">return</span> mu<span class="token punctuation">,</span> cov
    <span class="token keyword">def</span> <span class="token function">kernel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dist_matrix <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x1<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x2<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"sigma_f"</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"l"</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">*</span> dist_matrix<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">y</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> noise_sigma<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> noise_sigma<span class="token punctuation">,</span> size<span class="token operator">=</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">return</span> y<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> y<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> noise_sigma<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
gpr <span class="token operator">=</span> GPR<span class="token punctuation">(</span><span class="token punctuation">)</span>
gpr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
mu<span class="token punctuation">,</span> cov <span class="token operator">=</span> gpr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
test_y <span class="token operator">=</span> mu<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span>
uncertainty <span class="token operator">=</span> <span class="token number">1.96</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>cov<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"l=%.2f sigma_f=%.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>gpr<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"l"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> gpr<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"sigma_f"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>test_X<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_y <span class="token operator">+</span> uncertainty<span class="token punctuation">,</span> test_y <span class="token operator">-</span> uncertainty<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>test_X<span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"predict"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"train"</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">"x"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0511_109"></a>05-11</h4> 
<blockquote> 
 <ul><li>还可以，计量终于不会布置作业了，剩下的作业应该就只有随机模型和运筹优化两门课的了。不过一下子就已经跳到考试月，来得还挺突然，只剩四周时间，有两门期末项目要赶，没能抱到lth的大腿，要自己动手，那就跟我来分个高下呗。</li><li>冒雨冲了五圈，均配3’55"，很久没有这样在大雨中狂奔，难得畅快。</li><li>童安格的干燥花，和折翼蝶还挺搭。本打算晚上下课去一趟511的，可惜gjj拖太久，而且似乎也没什么理由去，作罢。</li></ul> 
</blockquote> 
<p>更新预告：我越来越觉得这块内容很有用了。</p> 
<ol><li> <p>参考文献<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           [ 
          
         
           19 
          
         
           ] 
          
         
        
          [19] 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mord">9</span><span class="mclose">]</span></span></span></span></span>：对四维卷积核张量的分解研究。如<strong>张量秩分解</strong>（<strong>CPD</strong>），可以将四维卷积核直接分解为四个低秩的卷积层。</p> 
  <ul><li><mark>备注</mark>：<strong>CPD</strong>这个词我第一次是在<strong>RE2RNN</strong>那篇<em>paper</em>里碰到的，在那篇<a href="https://caoyang.blog.csdn.net/article/details/109436961" rel="nofollow">博客</a>里有关于<strong>CPD</strong>的详细说明，对于三维张量的<strong>CPD</strong>应该是会分解成三个二维矩阵，但是对于四维张量的话，分解得到的矩阵数量可能会非常多。</li></ul> </li></ol> 
<h4><a id="0512_120"></a>05-12</h4> 
<blockquote> 
 <ul><li>好天气，手环到手，计划试跑一次半马。</li><li>刚跑就出太阳，跑完就下山，真就针对我呗。最终4’40"的配跑了12km，测了一下发现心率基本维持在175左右，很离谱，看到别人4分配以内心率都不会超过170，差距还真是有够大。</li><li>still not so easy，果然还是对自己的适应的水平太高估。</li></ul> 
</blockquote> 
<p>介绍一种<strong>SVD训练</strong>：</p> 
<ul><li> <p>对于神经网络而言，这相当于是将权重矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           W 
          
         
        
          W 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span></span></span></span></span>分解为两个连续的层：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            W 
           
          
            1 
           
          
         
           = 
          
         
           U 
          
         
           diag 
          
         
           ( 
          
          
          
            s 
           
          
         
           ) 
          
         
        
          W_1=U\text{diag}(\sqrt{s}) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.05028em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mord text"><span class="mord">diag</span></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.80028em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord mathdefault">s</span></span></span><span class="" style="top: -2.76028em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
             <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
              <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.23972em;"><span class=""></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            W 
           
          
            2 
           
          
         
           = 
          
         
           diag 
          
         
           ( 
          
          
          
            s 
           
          
         
           ) 
          
          
          
            V 
           
          
            ⊤ 
           
          
         
        
          W_2=\text{diag}(\sqrt{s})V^\top 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.09911em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">diag</span></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.80028em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord mathdefault">s</span></span></span><span class="" style="top: -2.76028em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
             <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
              <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.23972em;"><span class=""></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span></p> </li><li> <p>对于卷积层而言，卷积核<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           K 
          
         
           ∈ 
          
          
          
            R 
           
           
           
             n 
            
           
             × 
            
           
             c 
            
           
             × 
            
           
             w 
            
           
             × 
            
           
             h 
            
           
          
         
        
          \mathcal{K}\in\R^{n\times c\times w\times h} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72243em; vertical-align: -0.0391em;"></span><span class="mord"><span style="margin-right: 0.01445em;" class="mord mathcal">K</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">c</span><span class="mbin mtight">×</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">h</span></span></span></span></span></span></span></span></span></span></span></span></span>可以表示为一个四维张量，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           n 
          
         
           , 
          
         
           c 
          
         
           , 
          
         
           w 
          
         
           , 
          
         
           h 
          
         
        
          n,c,w,h 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">h</span></span></span></span></span>分别代表<strong>过滤器</strong>（<em>filters</em>）的数量，输入<strong>管道</strong>（<em>channels</em>）的数量，过滤器的宽和高，本文只要使用<strong>空间级</strong>（<em>spatial-wise</em>，参考文献<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           [ 
          
         
           15 
          
         
           ] 
          
         
        
          [15] 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">]</span></span></span></span></span>）或者<strong>管道级</strong>（<em>channel-wise</em>，参考文献<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           [ 
          
         
           39 
          
         
           ] 
          
         
        
          [39] 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">3</span><span class="mord">9</span><span class="mclose">]</span></span></span></span></span>）分解的方法来对卷积层进行分解（因为前人用下来效果很好）：</p> 
  <ol><li> <p>首先将<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             K 
            
           
          
            \mathcal{K} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.01445em;" class="mord mathcal">K</span></span></span></span></span></span><strong>重构</strong>（<em>reshape</em>）成二维矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              K 
             
            
              ^ 
             
            
           
             ∈ 
            
            
            
              R 
             
             
             
               n 
              
             
               × 
              
             
               c 
              
             
               w 
              
             
               h 
              
             
            
           
          
            \hat K\in\R^{n\times cwh} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.98587em; vertical-align: -0.0391em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.94677em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.07153em;" class="mord mathdefault">K</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">c</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mord mathdefault mtight">h</span></span></span></span></span></span></span></span></span></span></span></span></span>；</p> </li><li> <p>然后<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              K 
             
            
              ^ 
             
            
           
          
            \hat K 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.94677em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.94677em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.07153em;" class="mord mathdefault">K</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">^</span></span></span></span></span></span></span></span></span></span>通过<strong>SVD</strong>得到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             U 
            
           
             ∈ 
            
            
            
              R 
             
             
             
               n 
              
             
               × 
              
             
               r 
              
             
            
           
             , 
            
           
             V 
            
           
             ∈ 
            
            
            
              R 
             
             
             
               c 
              
             
               w 
              
             
               h 
              
             
               × 
              
             
               r 
              
             
            
           
             , 
            
           
             s 
            
           
             ∈ 
            
            
            
              R 
             
            
              r 
             
            
           
          
            U\in\R^{n\times r},V\in\R^{cwh\times r},s\in\R^r 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72243em; vertical-align: -0.0391em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.965771em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">×</span><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.04355em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mord mathdefault mtight">h</span><span class="mbin mtight">×</span><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span></span></span></span></span></span></span></span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             U 
            
           
          
            U 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             V 
            
           
          
            V 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span></span></span></span></span>是正交矩阵，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             r 
            
           
             = 
            
           
             min 
            
           
             ⁡ 
            
           
             ( 
            
           
             n 
            
           
             , 
            
           
             c 
            
           
             w 
            
           
             h 
            
           
             ) 
            
           
          
            r=\min(n,cwh) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">c</span><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="mord mathdefault">h</span><span class="mclose">)</span></span></span></span></span>；</p> </li><li> <p>此时原始的卷积测出那个被分解为两个连续的子卷积层：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              K 
             
            
              1 
             
            
           
             ∈ 
            
            
            
              R 
             
             
             
               r 
              
             
               × 
              
             
               c 
              
             
               × 
              
             
               w 
              
             
               × 
              
             
               h 
              
             
            
           
          
            \mathcal{K}_1\in\R^{r\times c\times w\times h} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01445em;" class="mord mathcal">K</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">c</span><span class="mbin mtight">×</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">h</span></span></span></span></span></span></span></span></span></span></span></span></span>（从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             diag 
            
           
             ( 
            
            
            
              s 
             
            
           
             ) 
            
            
            
              V 
             
            
              ⊤ 
             
            
           
          
            \text{diag}(\sqrt{s})V^\top 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.09911em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">diag</span></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.80028em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord mathdefault">s</span></span></span><span class="" style="top: -2.76028em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
               <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
                <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
               </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.23972em;"><span class=""></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span>重构回）与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              K 
             
            
              2 
             
            
           
             ∈ 
            
            
            
              R 
             
             
             
               n 
              
             
               × 
              
             
               r 
              
             
               × 
              
             
               1 
              
             
               × 
              
             
               1 
              
             
            
           
          
            \mathcal{K}_2\in\R^{n\times r\times1\times1} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01445em;" class="mord mathcal">K</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">×</span><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mbin mtight">×</span><span class="mord mtight">1</span><span class="mbin mtight">×</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>（从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             U 
            
           
             diag 
            
           
             ( 
            
            
            
              s 
             
            
           
             ) 
            
           
             ) 
            
           
          
            U\text{diag}(\sqrt{s})) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.05028em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mord text"><span class="mord">diag</span></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.80028em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord mathdefault">s</span></span></span><span class="" style="top: -2.76028em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
               <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
                <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
               </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.23972em;"><span class=""></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span>重构回）；</p> </li></ol> </li></ul> 
<h4><a id="0513_137"></a>05-13</h4> 
<blockquote> 
 <ul><li>休整，月头12天跑了3次10km以上，感觉这个状态其实还行，不算糟糕。晚上进场恰好看到了那个叫WXY的大佬，跟三圈实在是跟不住，回来刷keep看到他3’46"的配跑了5公里多，离谱。下半年一定要把5km练进20分钟，跟这种顶尖的业余跑者比还是差得挺远。</li><li>写proposal时突然感觉邓琪做的事情真的好有趣，我担心wyl指导不了我这方面的东西，我有直觉这些方法是比较可能发paper的。</li><li>回翻了一下近一个月的日记，每天都能写满至少一页纸，想休假在家两三天才能写满一页。事多有事多的紧凑，事少也有事少的清闲，以前回翻自己初高中的日记，那种狂妄自大的气息扑面而来，不知道多年以后我再回翻自己某些时期的日记还会作何感想，人嘛，总得成长。</li></ul> 
</blockquote> 
<ul><li> <p>关于bibtex的使用方法：</p> 
  <ol><li>编写.bib文件（如proposal.bib），内容如下：<pre><code>@article{2020Convolutional,
 title={Convolutional neural nets for estimating the run time and energy consumption of the sparse matrix-vector product},
 author={ Barreda, M.  and  Dolz, M. F.  and  Castao, M. A. },
 journal={International Journal of High Performance Computing Applications},
 number={1},
 year={2020},
 }
</code></pre> </li><li>编写.tex文件（如proposal.tex）：<pre><code>   \documentclass{article}
   \usepackage[utf8]{inputenc}
   \usepackage[margin=1in]{geometry}
   \usepackage{cite}
   \usepackage{graphicx}
   \usepackage{caption2}
   \usepackage{subfigure}
   \begin{document}
   	\begin{center}
   		\LARGE{\textbf{Proposal}}\\
           \vspace{1em}
           \normalsize\textbf{Hao Li, Yang Cao}\\
   	\end{center}
       \begin{normalsize}
       \section{Research Questions and Objectives}
   	\section{Objectives}
      	\section{Significance/Contributions}
       \section{Research Plan}
   	\nocite{1} %只加入到参考文献列表中，不在文中引用（显示[id]）
   	\nocite{*} %显示所有文献
   	\bibliography{proposal.bib}
   	\bibliographystyle{plain}
   	\end{normalsize}
   \end{document}
</code></pre> </li><li>接下来就是先用pdflatex编译，然后bibtex编译，再pdflatex编译即可。上述<code>\bibliographystyle{plain}</code>是默认的plain，可自定义，但比较麻烦。</li></ol> </li></ul> 
<h4><a id="0514_183"></a>05-14</h4> 
<blockquote> 
 <ul><li>MD，proposal硬是拖到下午才写完，最近真废，恨铁不成钢，周末得把这周欠下的都给补上，时隔近一年终于可以开始好好写代码了。</li><li>刚发现明月姐7号发了一篇ACL，组里都给点赞了，就我没点… 关了朋友圈信息就总是特别滞后。博二第一篇顶会paper，我也得加把劲才行，争取要硕士阶段能整点东西。</li><li>麦当劳有这么好吃么… 如果健身锻炼不是为了畅所欲食，那就毫无意义。</li><li>晚课lth居然把zsj带过来了，虽然是带的口罩，我还是一眼就认出了，没好意思去打招呼，老妈说我贼没礼貌，害。课下雷暴，怕被雷击，三圈走人，预报上周末闷热带雨，实在是让人很颓败的天气，不过下周一倒是很凉快，计划再试一次半马，弥补寒假未能完成20km的遗憾。</li></ul> 
</blockquote> 
<p>最近要开始写代码了，实话说还有点小兴奋。</p> 
<p>关于python中的稀疏矩阵：<code>from scipy import sparse</code></p> 
<p>scipy中封装了七种常用的稀疏矩阵存储结构，最常用的还是coo：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse <span class="token keyword">import</span> coo_matrix

_row  <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
_col  <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
_data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
coo <span class="token operator">=</span> coo_matrix<span class="token punctuation">(</span><span class="token punctuation">(</span>_data<span class="token punctuation">,</span> <span class="token punctuation">(</span>_row<span class="token punctuation">,</span> _col<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span>
coo<span class="token punctuation">.</span>todense<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 通过todense方法转化成密集矩阵(numpy.matrix)</span>
coo<span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 通过toarray方法转化成密集矩阵(numpy.ndarray)</span>
</code></pre> 
<p>其他像csc与csr的存储方式也有用，但是我觉得理解起来相对会比较复杂，至少matlab中默认存储稀疏矩阵的方式仍然是coo。</p> 
<p>稀疏矩阵的稀疏存储结构可以大大加快科学计算中矩阵乘法运算的速度，如果能够在特定问题环境下找到合适的预条件子，还能够使得很多迭代求解算法的收敛速度大大提升。</p> 
<p>目前在做这方面的工作，很有趣，因为以前没做过，我发现人总是对新事物会很好奇的，但是真正坚持走下去的确实很少。不思进取，人之常情，也不必多虑，虽然我现在也不太喜欢和别人再争什么，但是至少也别让过去的自己瞧不起现在的自己，最终活成自己讨厌的样子。</p> 
<h4><a id="0515_212"></a>05-15</h4> 
<blockquote> 
 <ul><li>鬼天气，又热又闷，四圈就给报废了。凡事还是得慢慢来，欲速不达，本来三月份已经可以达到4分配坚持3km的水平了，最近自从认识了那个5km跑进18分半的大佬后，开始对自己的配速特别不满，急躁了。</li><li>其实pytorch也有稀疏训练的方法，似乎并没有什么人注意到过，值得好好学习一下。</li></ul> 
</blockquote> 
<p>E2006数据集转稀疏矩阵方法：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy <span class="token keyword">as</span> sp

<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse <span class="token keyword">import</span> coo_matrix<span class="token punctuation">,</span> csr_matrix<span class="token punctuation">,</span> save_npz<span class="token punctuation">,</span> load_npz<span class="token punctuation">,</span> hstack<span class="token punctuation">,</span> vstack
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>sparse<span class="token punctuation">.</span>linalg <span class="token keyword">import</span> cg<span class="token punctuation">,</span> gmres

<span class="token keyword">def</span> <span class="token function">load_dataset</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> format_<span class="token operator">=</span><span class="token string">'csr'</span><span class="token punctuation">,</span> add_constant<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> export_path_matrix<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> export_path_vector<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	format_ <span class="token operator">=</span> format_<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> format_ <span class="token operator">==</span> <span class="token string">'coo'</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'coo'</span><span class="token punctuation">)</span>
		coo_rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		coo_columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		coo_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		vector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		row <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
				line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>
					<span class="token keyword">break</span>
				row <span class="token operator">+=</span> <span class="token number">1</span>
				blocks <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
				vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token keyword">for</span> block <span class="token keyword">in</span> blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
					column<span class="token punctuation">,</span> value <span class="token operator">=</span> block<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
					coo_rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
					coo_columns<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
					coo_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
		vector_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>vector<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
		sparse_matrix <span class="token operator">=</span> coo_matrix<span class="token punctuation">(</span><span class="token punctuation">(</span>coo_values<span class="token punctuation">,</span> <span class="token punctuation">(</span>coo_rows<span class="token punctuation">,</span> coo_columns<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
	<span class="token keyword">elif</span> format_ <span class="token operator">==</span> <span class="token string">'csr'</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'csr'</span><span class="token punctuation">)</span>
		csr_index_pointers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		csr_indices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		csr_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		vector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
				line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>
					<span class="token keyword">break</span>
				blocks <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
				vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				index_pointer <span class="token operator">=</span> csr_index_pointers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>blocks<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
				csr_index_pointers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index_pointer<span class="token punctuation">)</span>
				<span class="token keyword">for</span> block <span class="token keyword">in</span> blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
					column<span class="token punctuation">,</span> value <span class="token operator">=</span> block<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
					csr_indices<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
					csr_values<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
		vector_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>vector<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
		sparse_matrix <span class="token operator">=</span> csr_matrix<span class="token punctuation">(</span><span class="token punctuation">(</span>csr_values<span class="token punctuation">,</span> csr_indices<span class="token punctuation">,</span> csr_index_pointers<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>	
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Unknown keyword augment `format_`: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>format_<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> add_constant<span class="token punctuation">:</span>
		sparse_matrix <span class="token operator">=</span> hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>sparse_matrix<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sparse_matrix<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> export_path_matrix <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>sparse_matrix<span class="token punctuation">)</span><span class="token punctuation">)</span>
		save_npz<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>export_path_matrix<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sparse_matrix<span class="token punctuation">)</span>
	<span class="token keyword">if</span> export_path_vector <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>export_path_vector<span class="token punctuation">,</span> vector_array<span class="token punctuation">)</span>
	<span class="token keyword">return</span> sparse_matrix<span class="token punctuation">,</span> vector_array
</code></pre> 
<h4><a id="0516_285"></a>05-16</h4> 
<blockquote> 
 <ul><li>萎靡了四天，天气确实也不太好，但是明天一定无论如何要试一次半马的了。</li></ul> 
</blockquote> 
<p><code>scipy.sparse.linalg</code>下若干线性系统求解迭代方法的评测（以<a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/regression.html" rel="nofollow">E2006数据集</a>为例）：（API见<a href="https://docs.scipy.org/doc/scipy/reference/sparse.linalg.html#module-scipy.sparse.linalg" rel="nofollow">https://docs.scipy.org/doc/scipy/reference/sparse.linalg.html#module-scipy.sparse.linalg</a>）：</p> 
<table><thead><tr><th>求解方法</th><th>运行时间</th><th>是否需要计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             A 
            
           
             ⊤ 
            
           
          
            A 
           
          
         
           A^\top A 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord mathdefault">A</span></span></span></span></span></th><th>测试集误差<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ∥ 
           
          
            A 
           
          
            x 
           
          
            − 
           
          
            b 
           
           
           
             ∥ 
            
           
             2 
            
           
          
         
           \|Ax-b\|_2 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∥</span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">b</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></th></tr></thead><tbody><tr><td><code>spsolve</code>（稀疏系统求解）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            O 
           
          
            O 
           
          
            M 
           
          
         
           \rm OOM 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">O</span><span class="mord mathrm">O</span><span class="mord mathrm">M</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            a 
           
          
            N 
           
          
         
           \rm NaN 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">a</span><span class="mord mathrm">N</span></span></span></span></span></span></td></tr><tr><td><code>bicg</code>（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            BiConjugate Gradient 
           
          
         
           \text{BiConjugate Gradient} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">BiConjugate Gradient</span></span></span></span></span></span>）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            56min 
           
          
         
           \text{56min} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">56min</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            22.247769608108694 
           
          
         
           22.247769608108694 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span><span class="mord">4</span><span class="mord">7</span><span class="mord">7</span><span class="mord">6</span><span class="mord">9</span><span class="mord">6</span><span class="mord">0</span><span class="mord">8</span><span class="mord">1</span><span class="mord">0</span><span class="mord">8</span><span class="mord">6</span><span class="mord">9</span><span class="mord">4</span></span></span></span></span></td></tr><tr><td><code>cg</code>（共轭梯度法）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1min9s 
           
          
         
           \text{1min9s} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">1min9s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            22.498612313964742 
           
          
         
           22.498612313964742 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">.</span><span class="mord">4</span><span class="mord">9</span><span class="mord">8</span><span class="mord">6</span><span class="mord">1</span><span class="mord">2</span><span class="mord">3</span><span class="mord">1</span><span class="mord">3</span><span class="mord">9</span><span class="mord">6</span><span class="mord">4</span><span class="mord">7</span><span class="mord">4</span><span class="mord">2</span></span></span></span></span></td></tr><tr><td><code>gmres</code>（广义最小残差法）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            54s 
           
          
         
           \text{54s} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">54s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            21.30442357345542 
           
          
         
           21.30442357345542 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">1</span><span class="mord">.</span><span class="mord">3</span><span class="mord">0</span><span class="mord">4</span><span class="mord">4</span><span class="mord">2</span><span class="mord">3</span><span class="mord">5</span><span class="mord">7</span><span class="mord">3</span><span class="mord">4</span><span class="mord">5</span><span class="mord">5</span><span class="mord">4</span><span class="mord">2</span></span></span></span></span></td></tr><tr><td><code>minres</code>（最小残差法）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            44 
           
          
            s 
           
          
         
           44\rm s 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span><span class="mord">4</span><span class="mord"><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            21.526024247327364 
           
          
         
           21.526024247327364 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mord">2</span><span class="mord">6</span><span class="mord">0</span><span class="mord">2</span><span class="mord">4</span><span class="mord">2</span><span class="mord">4</span><span class="mord">7</span><span class="mord">3</span><span class="mord">2</span><span class="mord">7</span><span class="mord">3</span><span class="mord">6</span><span class="mord">4</span></span></span></span></span></td></tr><tr><td><code>gcrotmk</code>（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             G 
            
           
             C 
            
           
             R 
            
           
             O 
            
           
             T 
            
           
          
            ( 
           
          
            m 
           
          
            , 
           
          
            k 
           
          
            ) 
           
          
         
           {\rm GCROT}(m,k) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">C</span><span class="mord mathrm">R</span><span class="mord mathrm">O</span><span class="mord mathrm">T</span></span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mclose">)</span></span></span></span></span>方法）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1min26s 
           
          
         
           \text{1min26s} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66786em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">1min26s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            e 
           
          
            s 
           
          
         
           \rm Yes 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.025em;" class="mord mathrm">Y</span><span class="mord mathrm">e</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            29.943797879916882 
           
          
         
           29.943797879916882 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">9</span><span class="mord">.</span><span class="mord">9</span><span class="mord">4</span><span class="mord">3</span><span class="mord">7</span><span class="mord">9</span><span class="mord">7</span><span class="mord">8</span><span class="mord">7</span><span class="mord">9</span><span class="mord">9</span><span class="mord">1</span><span class="mord">6</span><span class="mord">8</span><span class="mord">8</span><span class="mord">2</span></span></span></span></span></td></tr><tr><td><code>lsqr</code>（求稀疏最小二乘的函数）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            45.8 
           
          
            s 
           
          
         
           45.8\rm s 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span><span class="mord">5</span><span class="mord">.</span><span class="mord">8</span><span class="mord"><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            o 
           
          
         
           \rm No 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">o</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            26.741176979699944 
           
          
         
           26.741176979699944 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">6</span><span class="mord">.</span><span class="mord">7</span><span class="mord">4</span><span class="mord">1</span><span class="mord">1</span><span class="mord">7</span><span class="mord">6</span><span class="mord">9</span><span class="mord">7</span><span class="mord">9</span><span class="mord">6</span><span class="mord">9</span><span class="mord">9</span><span class="mord">9</span><span class="mord">4</span><span class="mord">4</span></span></span></span></span></td></tr><tr><td><code>lsmr</code>（求稀疏最小二乘的迭代方法）</td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            7.31 
           
          
            s 
           
          
         
           \rm 7.31s 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">7</span><span class="mord mathrm">.</span><span class="mord mathrm">3</span><span class="mord mathrm">1</span><span class="mord mathrm">s</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            o 
           
          
         
           \rm No 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">o</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            21.30442357345681 
           
          
         
           21.30442357345681 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">1</span><span class="mord">.</span><span class="mord">3</span><span class="mord">0</span><span class="mord">4</span><span class="mord">4</span><span class="mord">2</span><span class="mord">3</span><span class="mord">5</span><span class="mord">7</span><span class="mord">3</span><span class="mord">4</span><span class="mord">5</span><span class="mord">6</span><span class="mord">8</span><span class="mord">1</span></span></span></span></span></td></tr></tbody></table> 
<p>总结：<code>lsmr</code>永远的神，真就又快又好。</p> 
<h4><a id="0517_303"></a>05-17</h4> 
<blockquote> 
 <ul><li>时隔近四个月，我终于完成了年前未能跑完20km的夙愿，配速4’45"，用时1小时35分，继续下去有望半马进100分钟。昨晚补糖早睡，今早早起继续补糖，就怕自己中途体力不支，结果16km处还是力竭休息了两三分钟。还有必须吐槽坑爹的天气预报，说好早上小雨，结果八点就来这种太阳，还不如抛硬币来得靠谱。</li><li>偶然看到又不吃午饭就去图书馆的人，罢了。累，回去睡午觉。</li><li>下午起来感觉无恙，进场看有没有认识的大佬在跑，准备跟两三圈练练速度，结果打开keep发现sxy在跑，但是并不能找到，也许只是我根本认不出来…</li></ul> 
</blockquote> 
<p>搞了一天稀疏矩阵和稀疏张量的处理，目前几个坑点记录一下：</p> 
<ol><li><code>pytorch</code>更新到1.6.0后开始出现<code>torch.sparse</code>模块，可惜这个模块做得太垃圾了，且不说只有COO格式的存储（不支持CSR格式的存储），导致无法做稀疏张量切片，而且也不能直接用torch.nn.utils.DataLoader去包装（原因很简单，dataloader是可以做批生成的，但是本来这个稀疏矩阵就不能切片，怎么做批生成？），但是我测试下来直接把整个稀疏张量拿进去训练是可行的，但是显然这个代价相比于批训练要大得多。如果放弃稀疏存储而用<code>.to_dense()</code>方法转为普通的张量，显存就直接炸了。</li><li><code>scipy</code>中<code>coo</code>稀疏格式和<code>csr</code>稀疏格式的转换的时间代价很小，即便矩阵很大（本质上运行时间只和非零元<code>nnz</code>的数量有关，所以很快），因此无需存下来多个不同格式的稀疏矩阵，一般存<code>csr</code>格式的就行了，这个是最常用的，转成其他格式的也快。</li><li>巨型坑点：<code>torch</code>中稀疏矩阵乘法问题 
  <ul><li>目前这个坑在于不同版本的<code>torch</code>稀疏矩阵乘法是有不同结论的，笔者目前用的是<code>1.7.0gpu</code>版本，<code>torch</code>已经更新到<code>1.8.0</code>，不知是否有更新，目前的情况似乎是支持稀疏乘稀疏，支持稀疏乘普通，但是不支持普通乘稀疏，这就很tricky了，所以很多时候如果要普通乘稀疏，还得反过来写然后再转置，真的是蠢到不行…</li></ul> </li><li>总之要用稀疏矩阵做训练，估计得自己改写底层代码了，建议直接手写DNN</li></ol> 
<h4><a id="0518_316"></a>05-18</h4> 
<blockquote> 
 <ul><li>keep的路线主任从3月2日做到4月5日，然后驾崩（四月中途零碎了做了十天左右），现在从5月4日一直做到现在，这个时间点还真是够敏感的，显然这并不是什么巧合，很直观的因果关系…</li><li>双腿严重残废，我早在5月1日刷新10km pb后就做好残废的准备了，没想到这个月还能跑4次10km+的里程，最后完成半马，血赚，只是我那路线主任的位置…</li></ul> 
</blockquote> 
<p><mark>收到CSDN定制的nova7的手机壳，看起来还不错，反正我也从来不会买这玩意儿，都是用烂原装的之后就开始“裸机”。</mark></p> 
<p>关于稀疏矩阵求奇异值的问题：</p> 
<ol><li> <p>问题来源于求解矩阵条件数（最大奇异值/最小奇异值），常规做法源自于<code>numpy.linalg</code>中的<code>svd</code>与<code>eig</code>方法，这两种方法是精确求解的方法，算法应该是通过求解线性系统得出所有奇异值和特征值，以及对应的奇异向量与特征向量，缺点是慢。</p> </li><li> <p>注意到<code>scipy.sparse.linalg</code>中提供了<code>svds</code>和<code>eigs</code>两种方法，都是迭代方法，所以会非常快，这里值得注意的是<code>svds</code>方法的调用（<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.svds.html#scipy.sparse.linalg.svds" rel="nofollow">https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.svds.html#scipy.sparse.linalg.svds</a>）：</p> 
  <ul><li>注意到参数<code>which</code>，取值为<code>'LM'</code>（求最大奇异值）或<code>'SM'（求最小奇异值）</code>；</li><li>另外还有一个<code>k</code>指找出最大的几个奇异值；</li><li>有兴趣的朋友可以去看看求<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            k 
           
          
            &gt; 
           
          
            1 
           
          
         
           k&gt;1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>的情况下迭代算法是如何运行的，因为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            k 
           
          
            = 
           
          
            1 
           
          
         
           k=1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>时（即只找到一个）的算法是比较浅显的，我记得找多个其实就是初始化时找若干线性不相关的初始向量去迭代，好像还可能涉及需要QR分解的内容</li><li>但是我实际想说的是这个迭代算法求最大特征值确实非常快（实测100k维的稀疏矩阵只需要不到1秒钟就能找到最大奇异值，而且相当精准），但是找最小奇异值算法是很难迭代收敛（一小时无法收敛），某次测试花了93分钟后报错：<pre><code>ArpackNoConvergence: ARPACK error -1: No convergence (33081 iterations, 0/1 eigenvectors converged)
</code></pre> 这意味着矩阵奇异得厉害，最小奇异值非常小，导致条件数很大，即矩阵是ill-conditioned</li></ul> 
  <ol start="5"><li>这里想做的事情是去找预条件子矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             M 
            
            
            
              − 
             
            
              1 
             
            
           
          
         
           M^{-1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>来修复<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            A 
           
          
         
           A 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>，使得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             M 
            
            
            
              − 
             
            
              1 
             
            
           
          
            A 
           
          
         
           M^{-1}A 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">A</span></span></span></span></span>的条件数变小，要求是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            M 
           
          
         
           M 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span></span></span></span></span>也是一个稀疏矩阵，其实如果盲目地去寻找是非常困难的，所以可能还是偏向于<em>物理降维</em>… 不过还是得试试的，万一运气好找到一个预条件子那不血赚。</li></ol> </li></ol> 
<h4><a id="0519_337"></a>05-19</h4> 
<blockquote> 
 <ul><li>wyl又找了好活，这次的明显靠谱得多，还是跟科大讯飞合作的，大约是问答这块的东西。虽然最近忙得离谱，但是我还是跟wyl说了一句“多少事我都能做”。怎么说呢，多点事儿好，省得我瞎TM乱想别的东西，五月以来一直没有好好做事，该给我点颜色看看了。</li><li>吃苦耐劳能致富，emmm…</li><li>昨晚熬夜搞掉gjj的作业，下午复习完算法，准备开始正事。饭后冒中雨干了3km，很明显感觉跑姿越来越自然，很畅快地跑，有迫切去参加一次半马的渴望。</li></ul> 
</blockquote> 
<p>今日痛点：<strong>LaTeX参考文献.bib文件编译失败的一个原因</strong></p> 
<p>有些期刊名称里包含特殊字符，比如<code>&amp;</code>，关键是好多paper提供的BibTex里都不注意这些小问题，然后编译的时候就会出问题。比如下面这个：</p> 
<pre><code>\bibitem{2009A}
T.~Strohmer and R.~Vershynin.
\newblock A randomized kaczmarz algorithm with exponential convergence.
\newblock {\em Journal of Fourier Analysis &amp; Applications}, 15(2):262, 2009.
</code></pre> 
<p>解决方案要么加反斜杠<code>\&amp;</code>，要么直接把<code>&amp;</code>换成<code>and</code>拉倒。</p> 
<p>还有一个问题，就是你按照pdflatex<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         → 
        
       
      
        \rightarrow 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span>bibtex<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         → 
        
       
      
        \rightarrow 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span>pdflatex的顺序编译后如果发现引用部分（<code>\cite{...}</code>）显示出来的还是<code>[?]</code>，那就紧接着再用<code>pdflatex</code>编译一次，实话说这玩意儿很玄学，有时候三步走能好，有时候就得四步。这年头<code>LaTeX</code>还是硬技能，只是这玩意儿老是犯病，有时候还就很难找到问题在哪。</p> 
<h4><a id="0520_355"></a>05-20</h4> 
<blockquote> 
 <ul><li>520果然还是图书馆更适合单身狗。这年头还有人热心地在食堂门口放一束应急玫瑰，唉，需要的人不缺，不需要的人有了也没用…</li><li>今年11月21日，杨浦新江湾国际半程马拉松，目标首马破100分钟。</li></ul> 
</blockquote> 
<p>牛顿法小结：</p> 
<ul><li> <p>本质上就是在该点附近根据一阶导，二阶导来用一个二次函数近似，然后将二次函数的最低点作为下一个迭代点</p> </li><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           δ 
          
          
          
            x 
           
           
           
             n 
            
           
             t 
            
           
          
         
           = 
          
         
           − 
          
          
          
            ∇ 
           
          
            2 
           
          
         
           f 
          
         
           ( 
          
         
           x 
          
          
          
            ) 
           
           
           
             − 
            
           
             1 
            
           
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
        
          \delta x_{\rm nt}=-\nabla^2f(x)^{-1}\nabla f(x) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span style="margin-right: 0.03785em;" class="mord mathdefault">δ</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord">−</span><span class="mord"><span class="mord">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span></p> </li><li> <p>推论：</p> 
  <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            x 
           
          
            + 
           
          
            δ 
           
           
           
             x 
            
            
            
              n 
             
            
              t 
             
            
           
          
         
           x+\delta x_{\rm nt} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span style="margin-right: 0.03785em;" class="mord mathdefault">δ</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>最小化（二次近似速度）：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              f 
             
            
              ^ 
             
            
           
             ( 
            
           
             x 
            
           
             + 
            
           
             v 
            
           
             ) 
            
           
             = 
            
           
             f 
            
           
             ( 
            
           
             x 
            
           
             ) 
            
           
             + 
            
           
             ∇ 
            
           
             f 
            
           
             ( 
            
           
             x 
            
            
            
              ) 
             
            
              ⊤ 
             
            
           
             v 
            
           
             + 
            
            
            
              1 
             
            
              2 
             
            
            
            
              v 
             
            
              ⊤ 
             
            
            
            
              ∇ 
             
            
              2 
             
            
           
             f 
            
           
             ( 
            
           
             x 
            
           
             ) 
            
           
             v 
            
           
          
            \hat f(x+v)=f(x)+\nabla f(x)^\top v+\frac12v^\top\nabla^2f(x)v 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.20788em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.08333em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14911em; vertical-align: -0.25em;"></span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">2</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord"><span class="mord">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span></span></span></span></span></span></li></ul> </li></ul> 
<h4><a id="0521_371"></a>05-21</h4> 
<blockquote> 
 <ul><li>520看《情书》，属实雅兴，终于拉黑，解脱…</li><li>好天气，可惜睡晚了，加上几天不午睡，状态不算很好。膝盖偶尔还是有点刺痛的，还真以为自己练成钢铁膝盖了，休息一两天回口血，事情也比较多暂时。有空也去科技园一趟，这年头汉堡真有这么好吃？</li><li>ITCS来了些玩飞盘的访问学者，准备陪他们耍耍，看起来还挺好玩的，主要是跑步、跳跃与投掷，权当锻炼身体，培养一些额外的兴趣~</li></ul> 
</blockquote> 
<p>关于连续时间马尔科夫链的转移概率矩阵的计算（实例中的技巧）：</p> 
<ul><li> <p>我们知道可以用下面的ODE来解<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           P 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          P(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>矩阵的表达式：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               { 
              
              
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     P 
                    
                   
                     ˙ 
                    
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                   
                    
                    
                      d 
                     
                    
                      P 
                     
                    
                      ( 
                     
                    
                      t 
                     
                    
                      ) 
                     
                    
                    
                    
                      d 
                     
                    
                      t 
                     
                    
                   
                  
                    = 
                   
                  
                    P 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    ⋅ 
                   
                  
                    Q 
                   
                  
                 
                
               
               
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    P 
                   
                  
                    ( 
                   
                  
                    0 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    I 
                   
                  
                 
                
               
              
             
            
            
            
            
              (3.1) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;\dot P(t)=\frac{\text{d}P(t)}{\text{d}t}=P(t)\cdot Q\\ &amp;P(0)=I \end{aligned}\right.\tag{3.1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.913em; vertical-align: -1.7065em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.49999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.2065em;"><span class="" style="top: -4.2065em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"></span></span><span class="" style="top: -2.3805em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.7065em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.2065em;"><span class="" style="top: -4.2065em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"><span class="mord"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.92019em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.05555em;">˙</span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">d</span></span><span class="mord mathdefault">t</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">d</span></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">Q</span></span></span><span class="" style="top: -2.3805em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.7065em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 3.913em; vertical-align: -1.7065em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 具体解为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               P 
              
             
               ( 
              
             
               t 
              
             
               ) 
              
             
               = 
              
              
              
                e 
               
               
               
                 t 
                
               
                 Q 
                
               
              
             
               = 
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 0 
                
               
               
               
                 + 
                
               
                 ∞ 
                
               
              
              
              
                1 
               
               
               
                 i 
                
               
                 ! 
                
               
              
              
              
                t 
               
              
                i 
               
              
              
              
                Q 
               
              
                i 
               
              
             
               = 
              
             
               I 
              
             
               + 
              
             
               t 
              
             
               Q 
              
             
               + 
              
              
              
                1 
               
               
               
                 2 
                
               
                 ! 
                
               
              
              
              
                t 
               
              
                2 
               
              
              
              
                Q 
               
              
                2 
               
              
             
               + 
              
              
              
                1 
               
               
               
                 3 
                
               
                 ! 
                
               
              
              
              
                t 
               
              
                3 
               
              
              
              
                Q 
               
              
                3 
               
              
             
               + 
              
             
               . 
              
             
               . 
              
             
               . 
              
             
            
            
            
            
              (3.2) 
             
            
           
          
         
           P(t)=e^{tQ}=\sum_{i=0}^{+\infty}\frac{1}{i!}t^iQ^i=I+tQ+\frac1{2!}t^2Q^2+\frac1{3!}t^3Q^3+...\tag{3.2} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.891331em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">Q</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.03601em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75834em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">Q</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">3</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.10556em; vertical-align: 0em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span><span class="tag"><span class="strut" style="height: 3.03601em; vertical-align: -1.27767em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 这个无穷级数很多时候在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Q 
          
         
        
          Q 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span></span></span></span></span>没有特殊形式时是很难求解的，不过有一种更简洁的表达：</p> 
  <blockquote> 
   <p>设对称矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Q 
           
          
         
           Q 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span></span></span></span></span>具有正交对角化的形式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Q 
           
          
            = 
           
          
            S 
           
          
            D 
           
           
           
             S 
            
           
             ⊤ 
            
           
          
         
           Q=SDS^\top 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span>，则有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            P 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
            = 
           
          
            S 
           
           
           
             e 
            
            
            
              t 
             
            
              D 
             
            
           
           
           
             S 
            
           
             ⊤ 
            
           
          
         
           P(t)=Se^{tD}S^\top 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">D</span></span></span></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span></p> 
  </blockquote> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
           
           
             t 
            
           
             D 
            
           
          
         
        
          e^{tD} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.841331em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">D</span></span></span></span></span></span></span></span></span></span></span></span></span>非常好求（直接对角元求指数即可），因此只要能给出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Q 
          
         
        
          Q 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span></span></span></span></span>对角化的形式，即可直接求出结果。</p> <p>问题在于很多时候我们甚至连<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           S 
          
         
        
          S 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span></span></span></span></span>都给不出显示表达，比如下面这个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Q 
          
         
        
          Q 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span></span></span></span></span>矩阵：</p> <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               Q 
              
             
               = 
              
              
               
               
                 [ 
                
                
                 
                  
                   
                    
                    
                      1 
                     
                    
                      − 
                     
                    
                      m 
                     
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                 
                 
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                    
                    
                      1 
                     
                    
                      − 
                     
                    
                      m 
                     
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                 
                 
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                    
                    
                      1 
                     
                    
                      − 
                     
                    
                      m 
                     
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                 
                 
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                 
                 
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                   
                     1 
                    
                   
                  
                  
                   
                    
                    
                      . 
                     
                    
                      . 
                     
                    
                      . 
                     
                    
                   
                  
                  
                   
                    
                    
                      1 
                     
                    
                      − 
                     
                    
                      m 
                     
                    
                   
                  
                 
                
               
                 ] 
                
               
               
               
                 m 
                
               
                 × 
                
               
                 m 
                
               
              
             
            
            
            
            
              (3.3) 
             
            
           
          
         
           Q=\left[\begin{matrix}1-m&amp;1&amp;1&amp;...&amp;1\\1&amp;1-m&amp;1&amp;...&amp;1\\1&amp;1&amp;1-m&amp;...&amp;1\\...&amp;...&amp;...&amp;...&amp;...\\1&amp;1&amp;1&amp;...&amp;1-m\end{matrix}\right]_{m\times m}\tag{3.3} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 6.11207em; vertical-align: -2.85807em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.254em;"><span class="" style="top: -1.04998em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.20498em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -2.80598em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40698em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.00798em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -5.254em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75004em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.254em;"><span class="" style="top: -1.04998em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.20498em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -2.80598em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40698em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.00798em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -5.254em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75004em;"><span class=""></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="" style="top: 0.09974em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.85807em;"><span class=""></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 6.11207em; vertical-align: -2.85807em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p>虽然通过观察容易发现特征值，但是特征向量并不好求。</p> <p>因此这里需要一些别的技巧。通过观察可以发现<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           P 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          P(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>一定是对角元取同一个值，非对角元取另一个值所以我们立刻给出ODE的具体表达：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            P 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
            = 
           
           
           
             [ 
            
            
             
              
               
                
                 
                 
                   f 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
             
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                 
                 
                   f 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
             
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
             
             
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                 
                 
                   g 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                 
                 
                   f 
                  
                 
                   ′ 
                  
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
            
           
             ] 
            
           
          
            = 
           
           
           
             [ 
            
            
             
              
               
                
                
                  f 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
             
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  f 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
             
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
             
             
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  g 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  f 
                 
                
                  ( 
                 
                
                  t 
                 
                
                  ) 
                 
                
               
              
             
            
           
             ] 
            
           
           
           
             [ 
            
            
             
              
               
                
                
                  1 
                 
                
                  − 
                 
                
                  m 
                 
                
               
              
              
               
               
                 1 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
               
                 1 
                
               
              
             
             
              
               
               
                 1 
                
               
              
              
               
                
                
                  1 
                 
                
                  − 
                 
                
                  m 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
               
                 1 
                
               
              
             
             
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
             
             
              
               
               
                 1 
                
               
              
              
               
               
                 1 
                
               
              
              
               
                
                
                  . 
                 
                
                  . 
                 
                
                  . 
                 
                
               
              
              
               
                
                
                  1 
                 
                
                  − 
                 
                
                  m 
                 
                
               
              
             
            
           
             ] 
            
           
          
            = 
           
          
            P 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
            ⋅ 
           
          
            Q 
           
          
         
           P(t)=\left[\begin{matrix}f'(t)&amp;g'(t)&amp;...&amp;g'(t)\\g'(t)&amp;f'(t)&amp;...&amp;g'(t)\\...&amp;...&amp;...&amp;...\\g'(t)&amp;g'(t)&amp;...&amp;f'(t)\end{matrix}\right]=\left[\begin{matrix}f(t)&amp;g(t)&amp;...&amp;g(t)\\g(t)&amp;f(t)&amp;...&amp;g(t)\\...&amp;...&amp;...&amp;...\\g(t)&amp;g(t)&amp;...&amp;f(t)\end{matrix}\right]\left[\begin{matrix}1-m&amp;1&amp;...&amp;1\\1&amp;1-m&amp;...&amp;1\\...&amp;...&amp;...&amp;...\\1&amp;1&amp;...&amp;1-m\end{matrix}\right]=P(t)\cdot Q 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.80204em; vertical-align: -2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.80204em; vertical-align: -2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span></span></span></span></span></span><br> 即：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               { 
              
              
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     f 
                    
                   
                     ′ 
                    
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    ( 
                   
                  
                    1 
                   
                  
                    − 
                   
                  
                    m 
                   
                  
                    ) 
                   
                  
                    f 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    + 
                   
                  
                    ( 
                   
                  
                    m 
                   
                  
                    − 
                   
                  
                    1 
                   
                  
                    ) 
                   
                  
                    g 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                 
                
               
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     g 
                    
                   
                     ′ 
                    
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    f 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    + 
                   
                  
                    ( 
                   
                  
                    1 
                   
                  
                    − 
                   
                  
                    m 
                   
                  
                    ) 
                   
                  
                    g 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    + 
                   
                  
                    ( 
                   
                  
                    m 
                   
                  
                    − 
                   
                  
                    2 
                   
                  
                    ) 
                   
                  
                    g 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    f 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    − 
                   
                  
                    g 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                 
                
               
              
             
            
            
            
            
              (3.6) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;f'(t)=(1-m)f(t)+(m-1)g(t)\\ &amp;g'(t)=f(t)+(1-m)g(t)+(m-2)g(t)=f(t)-g(t) \end{aligned}\right.\tag{3.6} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span><span class="mclose">)</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">m</span><span class="mclose">)</span><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mclose">)</span><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 这个ODE很好解，结论是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                P 
               
               
               
                 i 
                
               
                 j 
                
               
              
             
               ( 
              
             
               t 
              
             
               ) 
              
             
               = 
              
              
              
                { 
               
               
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                    
                    
                      1 
                     
                    
                      m 
                     
                    
                   
                     + 
                    
                    
                     
                     
                       m 
                      
                     
                       − 
                      
                     
                       1 
                      
                     
                    
                      m 
                     
                    
                    
                    
                      e 
                     
                     
                     
                       − 
                      
                     
                       m 
                      
                     
                       t 
                      
                     
                    
                    
                   
                  
                 
                 
                  
                   
                   
                     ( 
                    
                   
                     i 
                    
                   
                     = 
                    
                   
                     j 
                    
                   
                     ) 
                    
                   
                  
                 
                
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                    
                    
                      1 
                     
                    
                      m 
                     
                    
                   
                     − 
                    
                    
                    
                      1 
                     
                    
                      m 
                     
                    
                    
                    
                      e 
                     
                     
                     
                       − 
                      
                     
                       m 
                      
                     
                       t 
                      
                     
                    
                    
                   
                  
                 
                 
                  
                   
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ≠ 
                    
                   
                     j 
                    
                   
                     ) 
                    
                   
                  
                 
                
               
              
             
            
            
            
            
              (3.11) 
             
            
           
          
         
           P_{ij}(t)=\left\{\begin{aligned} &amp;\frac1m+\frac{m-1}me^{-mt}\quad&amp;(i=j)\\ &amp;\frac1m-\frac1me^{-mt}\quad&amp;(i\neq j) \end{aligned}\right.\tag{3.11} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.61488em; vertical-align: -2.05744em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.35002em;"><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.85002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.55744em;"><span class="" style="top: -4.55744em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.05744em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.55744em;"><span class="" style="top: -4.55744em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">m</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">m</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">m</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">m</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.05744em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.55744em;"><span class="" style="top: -4.55744em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mclose">)</span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.32144em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="rlap"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.05744em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 4.61488em; vertical-align: -2.05744em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">1</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 我看别人多是死磕无穷级数，这个方法似乎并没有太多人想到。</p> </li></ul> 
<h4><a id="0522_423"></a>05-22</h4> 
<blockquote> 
 <ul><li>好天气，可惜身体还没有完全回满，中长跑到不了一个月前的水平，周一之后都还是2-4公里的量在恢复，四分配不是那么容易练到的，明天倒很凉快，看状态。</li><li>hdm的期末pre致命了，不到两周，还跟组里事情的节点重叠，Eviews还是半吊子水平，接下来半个月怕要拼命了，聒噪得很，到底得先应付掉后天的考试。</li><li>感觉s每天都在吃麦当劳，建议撤了二教旁边的缤纷谷，直接把店开在那儿，百分百创收[笑]…</li></ul> 
</blockquote> 
<p>最近一些没搞清楚的混淆点（优化理论）:</p> 
<ol><li> <p>牛顿法的下降方向到底是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           − 
          
         
           f 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
           / 
          
          
          
            f 
           
          
            ′ 
           
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
        
          -f(x)/f'(x) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord">−</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span>，还是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           − 
          
          
          
            ∇ 
           
          
            2 
           
          
         
           f 
          
         
           ( 
          
         
           x 
          
          
          
            ) 
           
           
           
             − 
            
           
             1 
            
           
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
        
          -\nabla^2 f(x)^{-1} \nabla f(x) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord">−</span><span class="mord"><span class="mord">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span></p> </li><li> <p>拟牛顿法的初始海森矩阵究竟是取初始点的海森矩阵，还是用单位矩阵，还是随机取一个正定矩阵就行了？</p> </li><li> <p>回溯线搜索（backtracking line search）的算法终止条件，到底是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           − 
          
         
           α 
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           ) 
          
         
           ) 
          
         
           &gt; 
          
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           ) 
          
         
           − 
          
          
          
            c 
           
          
            1 
           
          
          
          
            α 
           
          
            k 
           
          
         
           ∥ 
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           ) 
          
          
          
            ∥ 
           
          
            2 
           
          
            2 
           
          
         
        
          f(x^{(k)}-\alpha \nabla f(x^{(k)}))\gt f(x^{(k)})-c_1\alpha_k\|\nabla f(x^{(k)})\|_2^2 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∥</span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.45189em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.248108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>还是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           + 
          
          
          
            α 
           
          
            k 
           
          
         
           Δ 
          
          
          
            x 
           
          
            k 
           
          
         
           ) 
          
         
           &gt; 
          
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
         
           ) 
          
         
           + 
          
         
           α 
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             k 
            
           
             ) 
            
           
          
          
          
            ) 
           
          
            ⊤ 
           
          
         
           Δ 
          
          
          
            x 
           
          
            k 
           
          
         
        
          f(x^{(k)}+\alpha_k\Delta x_k)\gt f(x^{(k)})+\alpha\nabla f(x^{(k)})^{\top} \Delta x_k 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.0037em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.138em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，感觉两种都可以</p> </li><li> <p>为什么steepest descent method有的说法是在方向上取下降最多的那个步长：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           t 
          
         
           = 
          
          
          
            argmin 
           
          
            t 
           
          
         
           f 
          
         
           ( 
          
         
           x 
          
         
           + 
          
         
           t 
          
         
           Δ 
          
         
           x 
          
         
           ) 
          
         
        
          t = \text{argmin}_t f(x+t\Delta x) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">argmin</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.186416em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">t</span><span class="mord">Δ</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span>，还有一种说法则是针对下降方向：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Δ 
          
         
           x 
          
         
           = 
          
          
          
            argmin 
           
           
           
             v 
            
           
             : 
            
           
             ∥ 
            
           
             v 
            
           
             ∥ 
            
           
             = 
            
           
             1 
            
           
          
         
           ∇ 
          
         
           f 
          
         
           ( 
          
         
           x 
          
          
          
            ) 
           
          
            ⊤ 
           
          
         
           v 
          
         
        
          \Delta x = \text{argmin}_{v:\|v\|=1}\nabla f(x)^\top v 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.26825em; vertical-align: -0.41914em;"></span><span class="mord"><span class="mord text"><span class="mord">argmin</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.28086em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mrel mtight">:</span><span class="mord mtight">∥</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mord mtight">∥</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.41914em;"><span class=""></span></span></span></span></span></span><span class="mord">∇</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span></span></span></span></span></p> <p>注意这里的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∥ 
          
         
           v 
          
         
           ∥ 
          
         
        
          \|v\| 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∥</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mord">∥</span></span></span></span></span>如果是二模则等价于梯度下降法，但是这里有多种不同模的选择，比如可以选一模，还能选二次模：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∥ 
          
         
           x 
          
          
          
            ∥ 
           
          
            P 
           
          
         
           = 
          
          
           
            
            
              x 
             
            
              ⊤ 
             
            
           
             P 
            
           
             x 
            
           
          
         
        
          \|x\|_P=\sqrt{x^\top Px} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∥</span><span class="mord mathdefault">x</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathdefault mtight">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.04em; vertical-align: -0.067446em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.972554em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.775108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span><span class="mord mathdefault">x</span></span></span><span class="" style="top: -2.93255em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
             <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
              <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.067446em;"><span class=""></span></span></span></span></span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           P 
          
         
        
          P 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">P</span></span></span></span></span>是一个正定矩阵，结果就完全不同了。</p> <p>这里很迷的就是前一个steepest descent method是用来确定步长，后一个steepest descent method其实是用来确定下降方向的。[黑人问号脸]</p> </li></ol> 
<h4><a id="0523_438"></a>05-23</h4> 
<blockquote> 
 <ul><li>状态好偏逢连夜雨，难受。晚饭后小雨17’20“跑了10圈，说起来已经很久不跑4km这个距离了。想到甘肃越野21个精英跑者丧生，所以真的别太高估自己的身体素质，人是有极限的。现在我淋雨跑完（虽然现在是很享受雨中跑步的快感）第一件事就是洗澡，就怕闷长得伤寒，在这种持续一天一夜的越野中低温淋湿，真的是会丢了小命的。</li><li>花了半个下午终于找到了一篇数据源全部accessible的paper，看起来可实现性比较高。离谱的是问sxy给我搞了一批百八十页的英文paper，上午硬着头皮看完了一篇实证的introduction，然后彻底放弃。这也太看得起我了，我本专的paper都没看过这么长的…</li></ul> 
</blockquote> 
<p>SVDtraining的模型与损失函数定义：</p> 
<ul><li> <p>这是个最平凡的测试demo，因为我遇到一个很头疼的问题，就是torch好像不能给网络层命名（首先像<code>torch.nn.Linear</code>这些函数的参数里就没有<code>name</code>，然后即便你初始化好之后手动修改，比如<code>self.orthogonal_linear1.name = 'ABC'</code>，在输出模型参数时的<code>name</code>也还是它原先的默认名称），所以我只好给变量命名的时候就带上前缀<code>orthogonal_</code>和<code>diag_</code>，然后才好在损失函数里确定正则项对应的张量（<mark>是不是很蠢？到底有没有不蠢的办法？</mark>）</p> </li><li> <p>这事情确实挺恶心，明明<code>torch</code>里的张量都是可以命名的，但是好像就不能命名网络层，还是我没找到怎么改名字的方法？</p> </li></ul> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8- *-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> torch <span class="token keyword">as</span> th

<span class="token keyword">class</span> <span class="token class-name">DotProduct</span><span class="token punctuation">(</span>th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_features<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>DotProduct<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bias_flag <span class="token operator">=</span> bias
        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>th<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bias<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>bias <span class="token operator">=</span> th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>th<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>weight <span class="token operator">*</span> x
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>bias_flag<span class="token punctuation">:</span>
            x <span class="token operator">=</span> x <span class="token operator">+</span> self<span class="token punctuation">.</span>bias
        <span class="token keyword">return</span> x


<span class="token keyword">class</span> <span class="token class-name">SVDNet</span><span class="token punctuation">(</span>th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>SVDNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>orthogonal_linear1 <span class="token operator">=</span> th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>diag_dotproduct1 <span class="token operator">=</span> DotProduct<span class="token punctuation">(</span>output_dim<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>orthogonal_linear2 <span class="token operator">=</span> th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>output_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>orthogonal_linear1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>diag_dotproduct1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>orthogonal_linear2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token keyword">class</span> <span class="token class-name">SVDLoss</span><span class="token punctuation">(</span>th<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MRRLoss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> y_true<span class="token punctuation">,</span> model<span class="token punctuation">,</span> regularizer_weights<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> th<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">:</span>
        
        regularizer <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'orthogonal_'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                regularizer <span class="token operator">+=</span> self<span class="token punctuation">.</span>singular_vectors_orthogonality_regularizer<span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'diag_'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                regularizer <span class="token operator">+=</span> self<span class="token punctuation">.</span>singular_values_sparsity_inducing_regularizer<span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        error <span class="token operator">=</span> y_pred <span class="token operator">-</span> y_true
        loss <span class="token operator">=</span> error <span class="token operator">*</span> error <span class="token operator">+</span> regularizer
        <span class="token keyword">return</span> loss
    
    <span class="token keyword">def</span> <span class="token function">singular_vectors_orthogonality_regularizer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> th<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>th<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> th<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token string">'fro'</span><span class="token punctuation">)</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">singular_values_sparsity_inducing_regularizer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return th.norm(x, 1)</span>
        <span class="token keyword">return</span> th<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> th<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后我还有一个问题，就是我想写一个函数把任意模型重构成SVD形式的模型，但是我发现这必须先定义一个函数，返回值是一个class，这事情还真从来没做过，突然就触及到经验盲区了，直觉上是可行的。</p> 
<h4><a id="0524_512"></a>05-24</h4> 
<blockquote> 
 <ul><li>中午莫名其妙又吃不下饭，实话说这个月胃口还没坏过。一直暗示自己要开心些，却不那么容易，只有跑步时才能让大脑进入暂时的空白。</li><li>下午算法考试写完第一个交掉，其实以我的性格是不会去提前交卷的，一定是严谨地检查到最后一秒。但就是有那么幼稚，就是想在最后的最后在某人面前装一次B。</li><li>这次写得很顺，四道大题全部想出来，有高中考数学竞赛的那种感觉，其实也是想秀一下lth，让他知道我也宝刀不老，不是看我数分考了60几分就以为我真的是菜了，数竞人的血统是不会这么快衰败的，你是如此，我也不会逊色于你，术业有专攻罢了，四年后鹿死谁手尚未知。</li><li>考完试一改颓势，状态振奋，顶着烈日跑了五圈，对我来说这是个可以接受的状态。接下来真的真的别让我再遇见你哪怕一次了，逃避虽然可耻，但是对忘记过去来说也许确实是有效的。</li></ul> 
</blockquote> 
<p>昨晚小熬夜把中国统计图鉴和中国金融图鉴（from中国知网）的爬虫给做了，有空水一篇blog，数据暂时得到保障，虽然我大概率还是复现不了全部[菜B]。但愿下午考试别翻车，真是一生之敌了。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> re
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

<span class="token keyword">def</span> <span class="token function">download_chinese_statistical_yearbook</span><span class="token punctuation">(</span>ybcode<span class="token operator">=</span><span class="token string">'N2020100004'</span><span class="token punctuation">,</span> is_initial<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0'</span><span class="token punctuation">}</span>
	query_url <span class="token operator">=</span> <span class="token string">'https://data.cnki.net/Yearbook/PartialGetCatalogResult'</span>
	excel_url <span class="token operator">=</span> <span class="token string">'https://data.cnki.net/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span>
	caj_url <span class="token operator">=</span> <span class="token string">'https://data.cnki.net/download/GetCajUrl'</span>
	regex <span class="token operator">=</span> <span class="token string">r'&lt;[^&gt;]+&gt;'</span>
	compiler <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
	formdata <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string">'ybcode'</span><span class="token punctuation">:</span> ybcode<span class="token punctuation">,</span>
		<span class="token string">'entrycode'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
		<span class="token string">'page'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
		<span class="token string">'pagerow'</span><span class="token punctuation">:</span> <span class="token string">'20'</span>
	<span class="token punctuation">}</span>
	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>query_url<span class="token punctuation">,</span> data<span class="token operator">=</span>formdata<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
	html <span class="token operator">=</span> response<span class="token punctuation">.</span>text
	soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
	span <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'s_p_listl'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> link <span class="token keyword">in</span> span<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		
		page <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>string<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第{}页..'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token keyword">not</span> page <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span> 
			formdata <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
				<span class="token string">'ybcode'</span><span class="token punctuation">:</span> ybcode<span class="token punctuation">,</span>
				<span class="token string">'entrycode'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
				<span class="token string">'page'</span><span class="token punctuation">:</span> page<span class="token punctuation">,</span>
				<span class="token string">'pagerow'</span><span class="token punctuation">:</span> <span class="token string">'20'</span>
			<span class="token punctuation">}</span>
			response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>query_url<span class="token punctuation">,</span> data<span class="token operator">=</span>formdata<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
			html <span class="token operator">=</span> response<span class="token punctuation">.</span>text
			soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
		table <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'table'</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> tr <span class="token keyword">in</span> table<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			tds <span class="token operator">=</span> tr<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span>
			<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span>
			title <span class="token operator">=</span> compiler<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
			page_range <span class="token operator">=</span> compiler<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> _link <span class="token keyword">in</span> tds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				href <span class="token operator">=</span> _link<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
				<span class="token keyword">if</span> href<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'/download/excel'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>					 <span class="token comment"># excel</span>
					filecode <span class="token operator">=</span> href<span class="token punctuation">[</span>href<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
					response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>excel_url<span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

					<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'{}.xls'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filecode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
						f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
					<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
						f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'{}\t{}\t{}.xls\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> page_range<span class="token punctuation">,</span> filecode<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">else</span><span class="token punctuation">:</span>													 <span class="token comment"># caj</span>
					filecode <span class="token operator">=</span> _link<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'fn'</span><span class="token punctuation">]</span>
					pagerange <span class="token operator">=</span> _link<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'pg'</span><span class="token punctuation">]</span>
					disk <span class="token operator">=</span> _link<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'disk'</span><span class="token punctuation">]</span>
					_formdata <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
						<span class="token string">'filecode'</span><span class="token punctuation">:</span> filecode<span class="token punctuation">,</span>
						<span class="token string">'pagerange'</span><span class="token punctuation">:</span> pagerange<span class="token punctuation">,</span>
						<span class="token string">'disk'</span><span class="token punctuation">:</span> disk<span class="token punctuation">,</span>
					<span class="token punctuation">}</span>
					response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>caj_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>_formdata<span class="token punctuation">)</span>
					resource_url <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>
					<span class="token keyword">print</span><span class="token punctuation">(</span>resource_url<span class="token punctuation">)</span>
					<span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>resource_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

					<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'{}.caj'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filecode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
						f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
					<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
						f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'{}\t{}\t{}.xls\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> page_range<span class="token punctuation">,</span> filecode<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># Find urls of year</span>
	<span class="token keyword">if</span> is_initial <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
		url <span class="token operator">=</span> <span class="token string">'https://data.cnki.net/trade/Yearbook/Single/{}?z=Z016'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ybcode<span class="token punctuation">)</span>
		response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
		html <span class="token operator">=</span> response<span class="token punctuation">.</span>text
		soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
		div <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'s_year clearfix'</span><span class="token punctuation">)</span>
		links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		ybcodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span> link <span class="token keyword">in</span> div<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			class_ <span class="token operator">=</span> link<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> class_ <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>										 <span class="token comment"># not current</span>
				href <span class="token operator">=</span> link<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
				ybcode <span class="token operator">=</span> href<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
				links<span class="token punctuation">.</span>append<span class="token punctuation">(</span>href<span class="token punctuation">)</span>
				ybcodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>href<span class="token punctuation">)</span>				
		<span class="token keyword">for</span> ybcode <span class="token keyword">in</span> ybcodes<span class="token punctuation">:</span>
			download_chinese_statistical_yearbook<span class="token punctuation">(</span>ybcode<span class="token operator">=</span>ybcode<span class="token punctuation">,</span> is_initial<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	download_chinese_statistical_yearbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0525_617"></a>05-25</h4> 
<blockquote> 
 <ul><li>组会开始前十分钟wyl问今天要不让我来讲，好在我早有准备。讲得还不错，就像是聊天一样，轻松且享受，如果与别人聊天也能这么简单就好了。</li><li>晚饭后直接进场五圈，状态挺不错，果然睡好比啥都强，明天下雨凉快，计划再试一次10k+的距离，没什么明确的目标，一切看状态。</li><li>晚上课上突然发现自己wx也被删了好友，我最近可真的是什么事都没做，结果也这么绝么。不过这下一点儿痕迹都无了，已经所有社交平台都被拉黑，然而可笑的是三教806窗外一瞥就发现20号楼正对着。彼时彼刻，恰如此时此刻，唉，宁可她真的是从未来过，可是为什么还这么容易地能看得到呢，就不该在自己这么多课的一个学期动这种心思，到头来落得一事无成的下场。</li></ul> 
</blockquote> 
<p>最近在看自动解题，认知推理这方面的东西，限于时间并没有给每篇paper做详细的笔注，只做了速读的笔注，推荐下面这篇很有帮助：</p> 
<blockquote> 
 <p>论文标题：<em>Differentiable Learning of Logic Rules for Knowledge Base Reasoning</em></p> 
 <p>中文标题：<strong>基于知识推理的逻辑规则可微学习</strong></p> 
 <p>下载链接：<a href="https://arxiv.org/abs/1702.08367" rel="nofollow">arxiv@1702.08367</a></p> 
 <p>项目地址：<a href="https://github.com/TeamCohen/ProPPR">GitHub@ProPPR</a></p> 
</blockquote> 
<p>上面这篇是基于外部知识的推理，下面这篇则是单纯的模板方法解决代数问题，不过也用到了概率模型，方法值得借鉴：</p> 
<blockquote> 
 <p>论文标题：<em>Learning to Automatically Solve Algebra Word Problems</em></p> 
 <p>中文标题：<strong>学习自动求解代数语言问题</strong></p> 
 <p>下载链接：<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.649.1317&amp;rep=rep1&amp;type=pdf" rel="nofollow">Citeseer</a></p> 
 <p>项目地址：<a href="http://groups.csail.mit.edu/rbg/code/wordprobs/" rel="nofollow">wordsprobs</a></p> 
</blockquote> 
<p>目前我只看了后面这篇，也是今天汇报掉的，虽然任务相对简单，不过方法很值得借鉴。</p> 
<h4><a id="0526_643"></a>05-26</h4> 
<blockquote> 
 <ul><li>七点已经在下雨，进不了场，索性回笼觉，似乎将是要下一天的雨[胃疼]。</li><li>下午趁雨小了一些进场10圈，可惜越跑下得越大，10圈悻悻而归。</li></ul> 
</blockquote> 
<p>我最近发现一种自动更新爬虫cookie的方法，需要更新cookie的时候直接用selenium去请求一下，再提取driver.get_cookies()即可，返回的值是一个字典的列表，然后只需要取每个字典中的<code>name</code>和<code>value</code>字段，按照<code>'{}={}; '.format(name, value)</code>的格式将它们拼接起来即可。</p> 
<p>其实据我所知，cookiejar还有一些别的包或许也可以来存储cookie，不过我记得以前用过不是很好用，最近发现的这个办法可以快速更新cookie，避免爬虫失效。</p> 
<h4><a id="0527_651"></a>05-27</h4> 
<blockquote> 
 <ul><li>《致陌生的你》，河图少有的现代歌，旋律好，演唱难度也很低。只是一直以为歌词是一首写挚友的歌曲，今天重新再听，又不是那样，似乎怎么理解都合理，只是我的心境不同罢了。</li><li>毒热的太阳，起了10km的状态，最终只跑出5km历史最好成绩21’09"。实际上并没有专门测过自己5km，从6km的最好成绩来看，之前的5km pb大约是21’40"上下，这次算是相当高的提升，不过即便是6km也是2个多月之前跑的了，算意料之中。最终目标是5km破20分。</li><li>sxy的麦当劳探店连续剧已经升级成自带下集预告的版本了… 自由自在的吃也是一种不错的生活方式，也不该把自己逼太紧。不过从定位上来看感觉是要吃遍五角场附近所有的连锁店么…</li></ul> 
</blockquote> 
<p>现在关于最速梯度下降就更迷了，下课我问了一次郭加熠，得到的答复和江波截然不同，郭认为最速梯度下降就是在找方向，所谓在方向上找下降最多的步长那是<em>Exact line search</em>，不叫最速梯度下降，然后郭还说江的<em>slide</em>上是把最速梯度下降的标题给写错了，但是我也学了好多遍最速梯度下降了，都没有听说过郭这种说法，网上搜下来也都是与<em>Exact line search</em>一样的定义，但是Boyd的教材上还真是这种跟郭说的一样，到底谁是对的…</p> 
<p>计划再CIFAR-10上面做SVD training的测试，过几天给些结果。torch自己给了一个直接下载CIFAR10数据集的接口，不过也可以自己到<a href="http://www.cs.toronto.edu/~kriz/cifar.html" rel="nofollow">http://www.cs.toronto.edu/~kriz/cifar.html</a>自取：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torchvision <span class="token keyword">as</span> tv            <span class="token comment">#里面含有许多数据集</span>
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms    <span class="token comment">#实现图片变换处理的包</span>
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToPILImage

<span class="token comment">#使用torchvision加载并预处理CIFAR10数据集</span>
show <span class="token operator">=</span> ToPILImage<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">#可以把Tensor转成Image,方便进行可视化</span>
transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>mean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>std <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#把数据变为tensor并且归一化range [0, 255] -&gt; [0.0,1.0]</span>
trainset <span class="token operator">=</span> tv<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data1/'</span><span class="token punctuation">,</span>train <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
trainloader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>trainset<span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
testset <span class="token operator">=</span> tv<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span><span class="token string">'data1/'</span><span class="token punctuation">,</span>train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
testloader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>testset<span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'plane'</span><span class="token punctuation">,</span><span class="token string">'car'</span><span class="token punctuation">,</span><span class="token string">'bird'</span><span class="token punctuation">,</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'deer'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">,</span><span class="token string">'frog'</span><span class="token punctuation">,</span><span class="token string">'horse'</span><span class="token punctuation">,</span><span class="token string">'ship'</span><span class="token punctuation">,</span><span class="token string">'truck'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>data<span class="token punctuation">,</span>label<span class="token punctuation">)</span> <span class="token operator">=</span> trainset<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#输出ship</span>
show<span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
dataiter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span>
images<span class="token punctuation">,</span> labels <span class="token operator">=</span> dataiter<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'%11s'</span><span class="token operator">%</span>classes<span class="token punctuation">[</span>labels<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span>tv<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span><span class="token punctuation">(</span>images<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#make_grid的作用是将若干幅图像拼成一幅图像</span>
</code></pre> 
<h4><a id="0528_682"></a>05-28</h4> 
<blockquote> 
 <ul><li>似乎有人总是半夜一两点来这儿，劝你们早点睡觉，年纪大了有你们后悔的。</li><li>wyl并不打算放过我，即便我还有五门专业课要上到16周，外加两个期末项目和三四次专业作业。</li><li>最近状态非常不错，吃得好睡得好，可惜今天太闷，晚饭后试了两圈就脱力了，等晚课下再去试试。</li><li>哈哈哈，晚课提前溜去跑步，居然在电梯里遇到方慧和史钞老师，听sc说也要去跑步，于是偷偷跟着去偷拍了几张他做准备活动和跑步的雅照。感觉抄男神似乎也是那种不太会跟女老师聊天的人。不过yysy，钞男神的腿真的是一绝，看了男默女泪…</li></ul> 
</blockquote> 
<p>眼下在实现卷积层的分解，重拾一下卷积层，发现把卷积层转为全连接层还是有点意思的，计划会有一篇不错的博客，预告下一篇博客SVD训练的实现，相信我这会是个很有趣的东西。</p> 
<p>事实上在<code>E:\Anaconda3\Lib\site-packages\torchvision\models</code>下面有不少流行模型的开源代码，随着torchvision的升级会不断更新新的研究结果进来，包括老牌的alexnet，resnet，imagenet，以及现在一些新的googlenet等，而且这些代码可以其实直接复制过来就能用，都不需要做什么修改，然后就可以在巨人肩膀上试着去重构模型了。</p> 
<h4><a id="0529_692"></a>05-29</h4> 
<blockquote> 
 <ul><li>呆在520半天，反锁大门，感觉可以把520当成自己的工位用了，没人来，门也不锁，一个人一个教室岂不美哉。</li><li>晚上状态极好，进场看到WXY和两个认识的大爷，热身跟了他们一两圈，本来还是奔着10km去的，可惜第5个1000米起快了，第6个1000米减不下来只得提速冲刺，最后成功把6km的pb突破到26’10"，非常不错（这次应该是被WXY注意到了，他肯定很惊讶学校里除了他还有这么能跑的哈哈），尘封两个多月的6km个人最好被刷新了（其实只是很久不跑6km了… 感觉现在认真跑6km有机会跑进26分，可惜好状态不常有唉）。</li></ul> 
</blockquote> 
<p>全连接层转卷积层很简单（FCN即可），反过来呢？</p> 
<p>卷积层的分解已经写完了，再凑点内容准备水博客了（假如王英林不来烦我的话）。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn

<span class="token comment"># 将给定的二维卷积层转换为线性层</span>
<span class="token keyword">def</span> <span class="token function">conv2d_to_linear</span><span class="token punctuation">(</span>conv2d<span class="token punctuation">,</span> input_height<span class="token punctuation">,</span> input_width<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 卷积层输出维度的计算公式：$O=\frac{W-K+2P}{S}+1$</span>
	<span class="token keyword">def</span> <span class="token function">_clac_output_size</span><span class="token punctuation">(</span>_input_size<span class="token punctuation">,</span> _kernel_size<span class="token punctuation">,</span> _stride_size<span class="token punctuation">,</span> _padding_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		_output_size <span class="token operator">=</span> <span class="token punctuation">(</span>_input_size <span class="token operator">-</span> _kernel_size <span class="token operator">+</span> _padding_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> _stride_size <span class="token operator">+</span> <span class="token number">1</span>
		<span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>_output_size<span class="token punctuation">)</span>																	<span class="token comment"># 一般来说，padding的目的是使得</span>
	
	<span class="token comment"># 将三维索引转成一维索引</span>
	<span class="token keyword">def</span> <span class="token function">_index3d_to_index1d</span><span class="token punctuation">(</span>_channel<span class="token punctuation">,</span> _height<span class="token punctuation">,</span> _width<span class="token punctuation">,</span> _height_dim<span class="token punctuation">,</span> _width_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> _channel <span class="token operator">*</span> _height_dim <span class="token operator">*</span> _width_dim <span class="token operator">+</span> _height <span class="token operator">*</span> _width_dim <span class="token operator">+</span> _width
	
	<span class="token comment"># 将一维索引转回三维索引</span>
	<span class="token keyword">def</span> <span class="token function">_index1d_to_index3d</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> _height_dim<span class="token punctuation">,</span> _width_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
		_size <span class="token operator">=</span> _height_dim <span class="token operator">*</span> _width_dim
		_channel <span class="token operator">=</span> _index <span class="token operator">//</span> _size
		_height <span class="token operator">=</span> <span class="token punctuation">(</span>_index <span class="token operator">-</span> _channel <span class="token operator">*</span> _size<span class="token punctuation">)</span> <span class="token operator">//</span> _width_dim
		_width <span class="token operator">=</span> _index <span class="token operator">-</span> _channel <span class="token operator">*</span> _size <span class="token operator">-</span> _height <span class="token operator">*</span> _width_dim
		<span class="token keyword">return</span> _channel<span class="token punctuation">,</span> _height<span class="token punctuation">,</span> _width
	conv_weight <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>weight																		<span class="token comment"># 卷积层的权重矩阵</span>
	out_channels<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> kernel_height<span class="token punctuation">,</span> kernel_width <span class="token operator">=</span> conv_weight<span class="token punctuation">.</span>shape						<span class="token comment"># 卷积层权重张量的形状：[输出管道数，输入管道数，卷积核高度，卷积核宽度]</span>
	stride_height<span class="token punctuation">,</span> stride_width <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>stride														<span class="token comment"># 高度与宽度方向上卷积核每次移动的步长</span>
	padding_height<span class="token punctuation">,</span> padding_width <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>padding													<span class="token comment"># 高度与宽度方向上输入矩阵</span>
	output_height <span class="token operator">=</span> _clac_output_size<span class="token punctuation">(</span>input_height<span class="token punctuation">,</span> kernel_height<span class="token punctuation">,</span> stride_height<span class="token punctuation">,</span> padding_height<span class="token punctuation">)</span>	<span class="token comment"># 每个管道上的输出高度</span>
	output_width <span class="token operator">=</span> _clac_output_size<span class="token punctuation">(</span>input_width<span class="token punctuation">,</span> kernel_width<span class="token punctuation">,</span> stride_width<span class="token punctuation">,</span> padding_width<span class="token punctuation">)</span>		<span class="token comment"># 每个管道上的输出宽度</span>
	input_dim <span class="token operator">=</span> in_channels <span class="token operator">*</span> input_height <span class="token operator">*</span> input_width											<span class="token comment"># 输入的总维度数（将输入张量拉平为向量）</span>
	output_dim <span class="token operator">=</span> out_channels <span class="token operator">*</span> output_height <span class="token operator">*</span> output_width										<span class="token comment"># 输出的总维度数（将输入张量拉平为向量）	</span>
	linear_weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>output_dim<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>											<span class="token comment"># 初始化线性层的权重矩阵全零</span>
	<span class="token keyword">for</span> output_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>															<span class="token comment"># 遍历每一个输出维度（一维索引）</span>
		_output_channel<span class="token punctuation">,</span> _output_height<span class="token punctuation">,</span> _output_width <span class="token operator">=</span> _index1d_to_index3d<span class="token punctuation">(</span>output_index<span class="token punctuation">,</span> 
																			 output_height<span class="token punctuation">,</span> 
																			 output_width<span class="token punctuation">)</span>			<span class="token comment"># 将对应的一维索引转回成三维索引</span>
		
		<span class="token comment"># 因为有stride的存在，输出点对应的起始坐标未必和输入点对应的起始坐标一致</span>
		start_height <span class="token operator">=</span> _output_height <span class="token operator">*</span> stride_height												<span class="token comment"># 对应_output_height的输入高度方向的起始坐标								</span>
		start_width <span class="token operator">=</span> _output_width <span class="token operator">*</span> stride_width													<span class="token comment"># 对应_output_width的输入宽度方向的起始坐标				</span>
		<span class="token keyword">for</span> _input_height <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_height<span class="token punctuation">,</span> start_height <span class="token operator">+</span> kernel_height<span class="token punctuation">)</span><span class="token punctuation">:</span>						<span class="token comment"># 遍历此时卷积核对应的所有输入高度方向上的坐标</span>
			<span class="token keyword">for</span> _input_width <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_width<span class="token punctuation">,</span> start_width <span class="token operator">+</span> kernel_width<span class="token punctuation">)</span><span class="token punctuation">:</span>						<span class="token comment"># 遍历此时卷积核对应的所有输入宽度方向上的坐标</span>
				<span class="token keyword">for</span> in_channel <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>												<span class="token comment"># 遍历所有的管道</span>
					input_index <span class="token operator">=</span> _index3d_to_index1d<span class="token punctuation">(</span>in_channel<span class="token punctuation">,</span> 
													  _input_height<span class="token punctuation">,</span> 
													  _input_width<span class="token punctuation">,</span> 
													  input_height<span class="token punctuation">,</span> 
													  input_width<span class="token punctuation">)</span>									<span class="token comment"># 找到对应的输出维度上的一维索引</span>
					linear_weight<span class="token punctuation">[</span>output_index<span class="token punctuation">,</span> input_index<span class="token punctuation">]</span> <span class="token operator">=</span> conv_weight<span class="token punctuation">[</span>_output_channel<span class="token punctuation">,</span> 
																			in_channel<span class="token punctuation">,</span> 
																		   _input_height <span class="token operator">-</span> start_height<span class="token punctuation">,</span> 
																		   _input_width <span class="token operator">-</span> start_width<span class="token punctuation">]</span>																				<span class="token comment"># 修正线性层的权重矩阵</span>
	<span class="token keyword">return</span> linear_weight
	
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	
	conv2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> out_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
	image_height <span class="token operator">=</span> <span class="token number">5</span>
	image_width <span class="token operator">=</span> <span class="token number">5</span>
	linear <span class="token operator">=</span> conv2d_to_linear<span class="token punctuation">(</span>conv2d<span class="token punctuation">,</span> image_height<span class="token punctuation">,</span> image_width<span class="token punctuation">)</span>
	
	<span class="token keyword">print</span><span class="token punctuation">(</span>conv2d<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>linear<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>linear<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0530_768"></a>05-30</h4> 
<blockquote> 
 <ul><li>凌晨熬夜把之前看的一篇paper实现完，水了一篇<a href="https://caoyang.blog.csdn.net/article/details/117391702" rel="nofollow">以SVD的分解形式进行深度神经网络的训练</a>，算是一次热身吧，可能是一个月熬得最晚的一次。人一到很晚就会想些乱七八糟的东西，文章结束写了几行废话，深夜还是适合睡觉。</li><li>最后两天，能否有机会10km破44分？感觉这个月的水平有显著提升，这两日状态OK，可惜前天弄丢了跑步用的三分裤，有点心疼…</li><li>傍晚4.05km用时17’14"，逼近4km的pb（16’56"），没有尽全力。至此，4~6km全部恢复到巅峰水平，等一个好天气，准备冲新的10km pb。</li></ul> 
</blockquote> 
<p><mark>信用规模是不是就是负债规模？？？我要疯了。</mark></p> 
<p>二维卷积层转全连接层的实现（卷积核–&gt;权重矩阵）：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn

<span class="token comment"># 将给定的二维卷积层转换为线性层</span>
<span class="token keyword">def</span> <span class="token function">conv2d_to_linear</span><span class="token punctuation">(</span>conv2d<span class="token punctuation">,</span> input_height<span class="token punctuation">,</span> input_width<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 卷积层输出维度的计算公式：$O=\frac{W-K+2P}{S}+1$</span>
	<span class="token keyword">def</span> <span class="token function">_clac_output_size</span><span class="token punctuation">(</span>_input_size<span class="token punctuation">,</span> _kernel_size<span class="token punctuation">,</span> _stride_size<span class="token punctuation">,</span> _padding_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		_output_size <span class="token operator">=</span> <span class="token punctuation">(</span>_input_size <span class="token operator">-</span> _kernel_size <span class="token operator">+</span> _padding_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> _stride_size <span class="token operator">+</span> <span class="token number">1</span>
		<span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>_output_size<span class="token punctuation">)</span>																	<span class="token comment"># 一般来说，padding的目的是使得</span>
	
	<span class="token comment"># 将三维索引转成一维索引</span>
	<span class="token keyword">def</span> <span class="token function">_index3d_to_index1d</span><span class="token punctuation">(</span>_channel<span class="token punctuation">,</span> _height<span class="token punctuation">,</span> _width<span class="token punctuation">,</span> _height_dim<span class="token punctuation">,</span> _width_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> _channel <span class="token operator">*</span> _height_dim <span class="token operator">*</span> _width_dim <span class="token operator">+</span> _height <span class="token operator">*</span> _width_dim <span class="token operator">+</span> _width
	
	<span class="token comment"># 将一维索引转回三维索引</span>
	<span class="token keyword">def</span> <span class="token function">_index1d_to_index3d</span><span class="token punctuation">(</span>_index<span class="token punctuation">,</span> _height_dim<span class="token punctuation">,</span> _width_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
		_size <span class="token operator">=</span> _height_dim <span class="token operator">*</span> _width_dim
		_channel <span class="token operator">=</span> _index <span class="token operator">//</span> _size
		_height <span class="token operator">=</span> <span class="token punctuation">(</span>_index <span class="token operator">-</span> _channel <span class="token operator">*</span> _size<span class="token punctuation">)</span> <span class="token operator">//</span> _width_dim
		_width <span class="token operator">=</span> _index <span class="token operator">-</span> _channel <span class="token operator">*</span> _size <span class="token operator">-</span> _height <span class="token operator">*</span> _width_dim
		<span class="token keyword">return</span> _channel<span class="token punctuation">,</span> _height<span class="token punctuation">,</span> _width

	conv_weight <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>weight																		<span class="token comment"># 卷积层的权重矩阵</span>
	out_channels<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> kernel_height<span class="token punctuation">,</span> kernel_width <span class="token operator">=</span> conv_weight<span class="token punctuation">.</span>shape						<span class="token comment"># 卷积层权重张量的形状：[输出管道数，输入管道数，卷积核高度，卷积核宽度]</span>
	stride_height<span class="token punctuation">,</span> stride_width <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>stride														<span class="token comment"># 高度与宽度方向上卷积核每次移动的步长</span>
	padding_height<span class="token punctuation">,</span> padding_width <span class="token operator">=</span> conv2d<span class="token punctuation">.</span>padding													<span class="token comment"># 高度与宽度方向上输入矩阵</span>
	output_height <span class="token operator">=</span> _clac_output_size<span class="token punctuation">(</span>input_height<span class="token punctuation">,</span> kernel_height<span class="token punctuation">,</span> stride_height<span class="token punctuation">,</span> padding_height<span class="token punctuation">)</span>	<span class="token comment"># 每个管道上的输出高度</span>
	output_width <span class="token operator">=</span> _clac_output_size<span class="token punctuation">(</span>input_width<span class="token punctuation">,</span> kernel_width<span class="token punctuation">,</span> stride_width<span class="token punctuation">,</span> padding_width<span class="token punctuation">)</span>		<span class="token comment"># 每个管道上的输出宽度</span>
	input_dim <span class="token operator">=</span> in_channels <span class="token operator">*</span> input_height <span class="token operator">*</span> input_width											<span class="token comment"># 输入的总维度数（将输入张量拉平为向量）</span>
	output_dim <span class="token operator">=</span> out_channels <span class="token operator">*</span> output_height <span class="token operator">*</span> output_width										<span class="token comment"># 输出的总维度数（将输入张量拉平为向量）	</span>
	linear_weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>output_dim<span class="token punctuation">,</span> input_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>											<span class="token comment"># 初始化线性层的权重矩阵全零</span>
	<span class="token keyword">for</span> output_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>															<span class="token comment"># 遍历每一个输出维度（一维索引）</span>
		_output_channel<span class="token punctuation">,</span> _output_height<span class="token punctuation">,</span> _output_width <span class="token operator">=</span> _index1d_to_index3d<span class="token punctuation">(</span>output_index<span class="token punctuation">,</span> 
																			 output_height<span class="token punctuation">,</span> 
																			 output_width<span class="token punctuation">)</span>			<span class="token comment"># 将对应的一维索引转回成三维索引</span>
		
		<span class="token comment"># 因为有stride的存在，输出点对应的起始坐标未必和输入点对应的起始坐标一致</span>
		start_height <span class="token operator">=</span> _output_height <span class="token operator">*</span> stride_height												<span class="token comment"># 对应_output_height的输入高度方向的起始坐标								</span>
		start_width <span class="token operator">=</span> _output_width <span class="token operator">*</span> stride_width													<span class="token comment"># 对应_output_width的输入宽度方向的起始坐标				</span>
		<span class="token keyword">for</span> _input_height <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_height<span class="token punctuation">,</span> start_height <span class="token operator">+</span> kernel_height<span class="token punctuation">)</span><span class="token punctuation">:</span>						<span class="token comment"># 遍历此时卷积核对应的所有输入高度方向上的坐标</span>
			<span class="token keyword">for</span> _input_width <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_width<span class="token punctuation">,</span> start_width <span class="token operator">+</span> kernel_width<span class="token punctuation">)</span><span class="token punctuation">:</span>						<span class="token comment"># 遍历此时卷积核对应的所有输入宽度方向上的坐标</span>
				<span class="token keyword">for</span> in_channel <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>												<span class="token comment"># 遍历所有的管道</span>
					input_index <span class="token operator">=</span> _index3d_to_index1d<span class="token punctuation">(</span>in_channel<span class="token punctuation">,</span> 
													  _input_height<span class="token punctuation">,</span> 
													  _input_width<span class="token punctuation">,</span> 
													  input_height<span class="token punctuation">,</span> 
													  input_width<span class="token punctuation">)</span>									<span class="token comment"># 找到对应的输出维度上的一维索引</span>
					linear_weight<span class="token punctuation">[</span>output_index<span class="token punctuation">,</span> input_index<span class="token punctuation">]</span> <span class="token operator">=</span> conv_weight<span class="token punctuation">[</span>_output_channel<span class="token punctuation">,</span> 
																			in_channel<span class="token punctuation">,</span> 
																		   _input_height <span class="token operator">-</span> start_height<span class="token punctuation">,</span> 
																		   _input_width <span class="token operator">-</span> start_width<span class="token punctuation">]</span>																				<span class="token comment"># 修正线性层的权重矩阵</span>
	<span class="token keyword">return</span> linear_weight
</code></pre> 
<h4><a id="0531_836"></a>05-31</h4> 
<blockquote> 
 <ul><li>偶然发现研代会群里有认识的人。</li><li>午饭后即兴测了一次400米，果然在短跑上还是个fw，75秒都跑不进。</li><li>晚上lh临时通知我ITCS要玩飞盘，于是取消了今天冲10km pb的计划，我的天，来了四五个清华北大，还有姚班的学生，剩下的都是交大浙大计算机的同好，那个北大飞盘协会的会长听lh说我能跑半马，全程盯着我一个人防，玩了一个多小时，差点没把我的心肺跑炸掉。临走时我看到WXY在跑，似乎已经跑了很久了，于是我顶着爆炸的心肺跟了他五圈，他是4’09"的配速，显然不是他最好的状态（他5km能跑进18分半），我猜可能是在跑20km，五圈后我实在是心肺承受不了了，只得退场，下次看到他一定加个wx，每天跟他练练速度。</li></ul> 
</blockquote> 
<p>带正交正则项与稀疏正则项的交叉熵损失：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">CrossEntropyLossSVD</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> size_average<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">reduce</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">'mean'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>CrossEntropyLossSVD<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>
			weight<span class="token operator">=</span>weight<span class="token punctuation">,</span>
			size_average<span class="token operator">=</span>size_average<span class="token punctuation">,</span>
			ignore_index<span class="token operator">=</span>ignore_index<span class="token punctuation">,</span>
			<span class="token builtin">reduce</span><span class="token operator">=</span><span class="token builtin">reduce</span><span class="token punctuation">,</span>
			reduction<span class="token operator">=</span>reduction<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> regularizer_weights<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> orthogonal_suffix<span class="token operator">=</span><span class="token string">'svd_weight_matrix'</span><span class="token punctuation">,</span> sparse_suffix<span class="token operator">=</span><span class="token string">'svd_weight_vector'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'lh'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">:</span>
		cross_entropy_loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> weight<span class="token operator">=</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span>self<span class="token punctuation">.</span>ignore_index<span class="token punctuation">,</span> reduction<span class="token operator">=</span>self<span class="token punctuation">.</span>reduction<span class="token punctuation">)</span>
		<span class="token keyword">if</span> model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> cross_entropy_loss
		
		<span class="token comment"># 正交正则器</span>
		<span class="token keyword">def</span> <span class="token function">_orthogonality_regularizer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>		 		 				 <span class="token comment"># x应当是一个2D张量（矩阵）且高大于宽</span>
			<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> torch<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token string">'fro'</span><span class="token punctuation">)</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		
		<span class="token comment"># 稀疏导出正则器</span>
		<span class="token keyword">def</span> <span class="token function">_sparsity_inducing_regularizer</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'lh'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>				 <span class="token comment"># x应当是一个1D张量（向量）</span>
			mode <span class="token operator">=</span> mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'lh'</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>	
			<span class="token keyword">elif</span> model <span class="token operator">==</span> <span class="token string">'l1'</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Unknown mode: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mode<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	
		regularizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> name<span class="token punctuation">,</span> parameter <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			lastname <span class="token operator">=</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
			<span class="token keyword">if</span> lastname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>orthogonal_suffix<span class="token punctuation">)</span><span class="token punctuation">:</span>					 <span class="token comment"># 奇异向量矩阵参数：添加正交正则项</span>
				regularizer <span class="token operator">+=</span> _orthogonality_regularizer<span class="token punctuation">(</span>parameter<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
			<span class="token keyword">elif</span> lastname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>sparse_suffix<span class="token punctuation">)</span><span class="token punctuation">:</span>					 <span class="token comment"># 奇异值向量参数：添加稀疏导出正则项</span>
				regularizer <span class="token operator">+=</span> _sparsity_inducing_regularizer<span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> mode<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token keyword">return</span> cross_entropy_loss <span class="token operator">+</span> regularizer
</code></pre> 
<h3><a id="June_2021_889"></a>June 2021</h3> 
<h4><a id="0601_890"></a>06-01</h4> 
<blockquote> 
 <ul><li>早起腰酸背痛，都快挺不起来了，上半身锻炼太少… 昨天手环测下来一共跑了11km多，刨去本来就跑了6圈，玩飞盘差不多跑了有9km，有两只脚趾的关节处磨破，很久脚上不受伤了。不过实话对抗性强一点的极限飞盘还是确实很有意思，多接触点人也开心些，玩爽了就只得熬夜写了一晚上作业…</li><li>有很不好的感觉，我好像又被人拉黑了…</li><li>晚上试跑了四圈，从躯干疼到大腿到脚尖，全身上下除了脑袋，全部都酸胀得厉害，昨天就不该在那么累得情况下还跟WXY跑五圈，怕真伤到了。</li></ul> 
</blockquote> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         / 
        
       
         M 
        
       
         / 
        
       
         ∞ 
        
       
      
        M/M/∞ 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span class="mord">∞</span></span></span></span></span>排队系统性质：</p> 
<ol><li> <p>设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Δ 
          
         
           t 
          
         
        
          \Delta t 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span></span>是一个充分小的正数，对于每台服务器（<em>server</em>），若在时刻<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           t 
          
         
        
          t 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathdefault">t</span></span></span></span></span>观察到该服务器处于繁忙，则定义如下两个事件：</p> 
  <ul><li>事件<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            A 
           
          
         
           A 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>：在该条件下，接下来<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Δ 
           
          
            t 
           
          
         
           \Delta t 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span></span>时间内该服务器仍然保持繁忙状态。</li><li>事件<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            B 
           
          
         
           B 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.05017em;" class="mord mathdefault">B</span></span></span></span></span>：在该条件下，接下来<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Δ 
           
          
            t 
           
          
         
           \Delta t 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span></span>时间内该服务器服务终止。</li></ul> <p>则根据指数分布的无记忆性，可得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               Pr 
              
             
               ⁡ 
              
             
               ( 
              
             
               A 
              
             
               ) 
              
             
               = 
              
             
               Pr 
              
             
               ⁡ 
              
              
              
                ( 
               
              
                Z 
               
              
                ≥ 
               
              
                t 
               
              
                + 
               
              
                Δ 
               
              
                t 
               
              
                ∣ 
               
              
                Z 
               
              
                ≥ 
               
              
                t 
               
              
                ) 
               
              
             
               = 
              
             
               Pr 
              
             
               ⁡ 
              
              
              
                ( 
               
              
                Z 
               
              
                ≥ 
               
              
                Δ 
               
              
                t 
               
              
                ) 
               
              
             
               = 
              
              
              
                e 
               
               
               
                 − 
                
               
                 μ 
                
               
                 Δ 
                
               
                 t 
                
               
              
             
               ≈ 
              
             
               1 
              
             
               − 
              
             
               μ 
              
             
               Δ 
              
             
               t 
              
             
               + 
              
             
               o 
              
             
               ( 
              
             
               Δ 
              
             
               t 
              
             
               ) 
              
              
             
               Pr 
              
             
               ⁡ 
              
             
               ( 
              
             
               B 
              
             
               ) 
              
             
               = 
              
             
               Pr 
              
             
               ⁡ 
              
              
              
                ( 
               
              
                Z 
               
              
                ≤ 
               
              
                t 
               
              
                + 
               
              
                Δ 
               
              
                t 
               
              
                ∣ 
               
              
                Z 
               
              
                ≥ 
               
              
                t 
               
              
                ) 
               
              
             
               = 
              
             
               Pr 
              
             
               ⁡ 
              
              
              
                ( 
               
              
                Z 
               
              
                ≥ 
               
              
                Δ 
               
              
                t 
               
              
                ) 
               
              
             
               = 
              
             
               1 
              
             
               − 
              
              
              
                e 
               
               
               
                 − 
                
               
                 μ 
                
               
                 Δ 
                
               
                 t 
                
               
              
             
               ≈ 
              
             
               μ 
              
             
               Δ 
              
             
               t 
              
             
               + 
              
             
               o 
              
             
               ( 
              
             
               Δ 
              
             
               t 
              
             
               ) 
              
             
            
            
            
            
              (1.1) 
             
            
           
          
         
           \Pr(A)=\Pr\left(Z\ge t+\Delta t|Z\ge t\right)=\Pr\left(Z\ge\Delta t\right)=e^{-\mu\Delta t}\approx1-\mu\Delta t+o(\Delta t)\\ \Pr(B)=\Pr\left(Z\le t+\Delta t|Z\ge t\right)=\Pr\left(Z\ge\Delta t\right)=1-e^{-\mu\Delta t}\approx\mu\Delta t+o(\Delta t)\tag{1.1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mord">∣</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.891331em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">μ</span><span class="mord mtight">Δ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.05017em;" class="mord mathdefault">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mord">∣</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07153em;" class="mord mathdefault">Z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.891331em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">μ</span><span class="mord mtight">Δ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           N 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          N(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>是直到时刻<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           t 
          
         
        
          t 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathdefault">t</span></span></span></span></span>时所有来访客户的总数，根据泊松过程的性质，可得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   ) 
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   ) 
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   − 
                  
                  
                  
                    e 
                   
                   
                   
                     − 
                    
                   
                     λ 
                    
                   
                     Δ 
                    
                   
                     t 
                    
                   
                  
                 
                   = 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ≥ 
                  
                 
                   2 
                  
                 
                   ) 
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
             
            
            
            
            
              (1.2) 
             
            
           
          
         
           \begin{aligned} \Pr(N(t+\Delta t)-N(t)=0)&amp;=1-\lambda\Delta t+o(\Delta t)\\ \Pr(N(t+\Delta t)-N(t)=1)&amp;=1-e^{-\lambda\Delta t}=\lambda\Delta t+o(\Delta t)\\ \Pr(N(t+\Delta t)-N(t)\ge2)&amp;=o(\Delta t) \end{aligned}\tag{1.2} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 4.55911em; vertical-align: -2.02955em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.52955em;"><span class="" style="top: -4.68955em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span class="" style="top: -3.13045em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span class="" style="top: -1.63045em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.02955em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.52955em;"><span class="" style="top: -4.68955em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -3.13045em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">λ</span><span class="mord mtight">Δ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -1.63045em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.02955em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 4.55911em; vertical-align: -2.02955em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 根据式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.1 
          
         
           ) 
          
         
        
          (1.1) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>与式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.2 
          
         
           ) 
          
         
        
          (1.2) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>的结论，可知在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Δ 
          
         
           t 
          
         
        
          \Delta t 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span></span>时间内同时有不低于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2 
          
         
        
          2 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span>个服务器服务终止或不低于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2 
          
         
        
          2 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span>个客户到来的概率都是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           o 
          
         
           ( 
          
         
           Δ 
          
         
           t 
          
         
           ) 
          
         
        
          o(\Delta t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>，则有：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                  
                  
                    ( 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    + 
                   
                  
                    Δ 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    + 
                   
                  
                    1 
                   
                  
                    ∣ 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    ) 
                   
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    ∑ 
                   
                   
                   
                     k 
                    
                   
                     = 
                    
                   
                     0 
                    
                   
                  
                    i 
                   
                  
                  
                  
                    [ 
                   
                  
                    Pr 
                   
                  
                    ⁡ 
                   
                   
                   
                     ( 
                    
                   
                     Exactly  
                    
                   
                     k 
                    
                   
                      services are finished 
                    
                   
                     , 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     Δ 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     − 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     = 
                    
                   
                     k 
                    
                   
                     + 
                    
                   
                     1 
                    
                   
                     ∣ 
                    
                   
                     X 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                     ) 
                    
                   
                  
                    ] 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   No service is finished 
                  
                 
                   , 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   No service is finished 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                   
                   
                     [ 
                    
                   
                     Pr 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     A 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                  
                    i 
                   
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                  
                    ) 
                   
                  
                    i 
                   
                  
                 
                   ( 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   i 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   ( 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   , 
                  
                 
                   1 
                  
                 
                   , 
                  
                 
                   2 
                  
                 
                   , 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   ) 
                  
                 
                
               
              
             
            
            
            
            
              (1.3) 
             
            
           
          
         
           \begin{aligned} \Pr\left(X(t+\Delta t)=i+1|X(t)=i\right)&amp;=\sum_{k=0}^i\left[\Pr\left(\text{Exactly }k\text{ services are finished},N(t+\Delta t)-N(t)=k+1|X(t=i)\right)\right]\\ &amp;=\Pr(\text{No service is finished},N(t+\Delta t)-N(t)=1|X(t)=i)+o(\Delta t)\\ &amp;=\Pr(\text{No service is finished}|X(t)=i)\cdot\Pr(N(t+\Delta t)-N(t)=1)+o(\Delta t)\\ &amp;=\left[\Pr(A)\right]^i\cdot(\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=(1-\mu\Delta t+o(\Delta t))^i(\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=(1-i\mu\Delta t+o(\Delta t))(\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=\lambda \Delta t+o(\Delta t)\quad(i=0,1,2,...) \end{aligned}\tag{1.3} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 12.573em; vertical-align: -6.03651em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.53651em;"><span class="" style="top: -8.53651em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top: 0em;">)</span></span></span></span><span class="" style="top: -6.09439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -4.59439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -2.96983em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -1.43516em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 0.064836em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 1.56484em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.03651em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.53651em;"><span class="" style="top: -8.53651em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.81167em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord text"><span class="mord">Exactly </span></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mord text"><span class="mord"> services are finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span><span class="" style="top: -6.09439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">No service is finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -4.59439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">No service is finished</span></span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.96983em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.964564em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -1.43516em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 0.064836em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 1.56484em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 1em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.03651em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 12.573em; vertical-align: -6.03651em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                  
                  
                    ( 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    + 
                   
                  
                    Δ 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    − 
                   
                  
                    1 
                   
                  
                    ∣ 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    ) 
                   
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    ∑ 
                   
                   
                   
                     k 
                    
                   
                     = 
                    
                   
                     1 
                    
                   
                  
                    i 
                   
                  
                  
                  
                    [ 
                   
                  
                    Pr 
                   
                  
                    ⁡ 
                   
                   
                   
                     ( 
                    
                   
                     Exactly  
                    
                   
                     k 
                    
                   
                      services are finished 
                    
                   
                     , 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     Δ 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     − 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     = 
                    
                   
                     k 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                     ∣ 
                    
                   
                     X 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                     ) 
                    
                   
                  
                    ] 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   Exactly 1 service is finished 
                  
                 
                   , 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   Exactly 1 service is finished 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ⋅ 
                  
                  
                   
                   
                     [ 
                    
                   
                     Pr 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     A 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                   
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   B 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                  
                    ) 
                   
                   
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   − 
                  
                 
                   1 
                  
                 
                   ) 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   , 
                  
                 
                   2 
                  
                 
                   , 
                  
                 
                   3 
                  
                 
                   , 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   ) 
                  
                 
                
               
              
             
            
            
            
            
              (1.4) 
             
            
           
          
         
           \begin{aligned} \Pr\left(X(t+\Delta t)=i-1|X(t)=i\right)&amp;=\sum_{k=1}^i\left[\Pr\left(\text{Exactly }k\text{ services are finished},N(t+\Delta t)-N(t)=k-1|X(t=i)\right)\right]\\ &amp;=\Pr(\text{Exactly 1 service is finished},N(t+\Delta t)-N(t)=0|X(t)=i)+o(\Delta t)\\ &amp;=\Pr(\text{Exactly 1 service is finished}|X(t)=i)\cdot\Pr(N(t+\Delta t)-N(t)=0)+o(\Delta t)\\ &amp;=i\cdot\left[\Pr(A)\right]^{i-1}\cdot\Pr(B)\cdot(1-\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=i\cdot(1-\mu\Delta t+o(\Delta t))^{i-1}\cdot(\mu\Delta t+o(\Delta t))\cdot(1-\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=i\cdot(1-(i-1)\mu\Delta t+o(\Delta t))\cdot(\mu\Delta t+o(\Delta t))\cdot(1-\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=i\mu\Delta t+o(\Delta t)\quad(i=1,2,3,...) \end{aligned}\tag{1.4} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 12.573em; vertical-align: -6.03651em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.53651em;"><span class="" style="top: -8.53651em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top: 0em;">)</span></span></span></span><span class="" style="top: -6.09439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -4.59439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -2.96983em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -1.43516em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 0.064836em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 1.56484em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.03651em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 6.53651em;"><span class="" style="top: -8.53651em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.81167em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord text"><span class="mord">Exactly </span></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mord text"><span class="mord"> services are finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span><span class="" style="top: -6.09439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">Exactly 1 service is finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -4.59439em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">Exactly 1 service is finished</span></span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.96983em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.964564em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.05017em;" class="mord mathdefault">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -1.43516em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 0.064836em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 1.56484em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 1em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 6.03651em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 12.573em; vertical-align: -6.03651em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                  
                  
                    ( 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    + 
                   
                  
                    Δ 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    ∣ 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    ) 
                   
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    ∑ 
                   
                   
                   
                     k 
                    
                   
                     = 
                    
                   
                     0 
                    
                   
                  
                    i 
                   
                  
                  
                  
                    [ 
                   
                  
                    Pr 
                   
                  
                    ⁡ 
                   
                   
                   
                     ( 
                    
                   
                     Exactly  
                    
                   
                     k 
                    
                   
                      services are finished 
                    
                   
                     , 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     Δ 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     − 
                    
                   
                     N 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     = 
                    
                   
                     k 
                    
                   
                     ∣ 
                    
                   
                     X 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                     ) 
                    
                   
                  
                    ] 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   No service is finished 
                  
                 
                   , 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                  
                 
                   + 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   Exactly 1 service is finished 
                  
                 
                   , 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   No service is finished 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                  
                 
                   + 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   Exactly 1 service is finished 
                  
                 
                   ∣ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   − 
                  
                 
                   N 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                   
                   
                     [ 
                    
                   
                     Pr 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     A 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                  
                    i 
                   
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   i 
                  
                 
                   ⋅ 
                  
                  
                   
                   
                     [ 
                    
                   
                     Pr 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     A 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                   
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                   ⋅ 
                  
                 
                   Pr 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   B 
                  
                 
                   ) 
                  
                 
                   ⋅ 
                  
                 
                   ( 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                  
                    ) 
                   
                  
                    i 
                   
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                  
                 
                   + 
                  
                 
                   i 
                  
                 
                   ( 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                  
                    ) 
                   
                   
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                   ( 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   ( 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ) 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   i 
                  
                 
                   μ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   − 
                  
                 
                   λ 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                   − 
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   μ 
                  
                 
                   + 
                  
                 
                   λ 
                  
                 
                   ) 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   + 
                  
                 
                   o 
                  
                 
                   ( 
                  
                 
                   Δ 
                  
                 
                   t 
                  
                 
                   ) 
                  
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   = 
                  
                 
                   0 
                  
                 
                   , 
                  
                 
                   1 
                  
                 
                   , 
                  
                 
                   2 
                  
                 
                   , 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   . 
                  
                 
                   ) 
                  
                 
                
               
              
             
            
            
            
            
              (1.5) 
             
            
           
          
         
           \begin{aligned} \Pr\left(X(t+\Delta t)=i|X(t)=i\right)&amp;=\sum_{k=0}^i\left[\Pr\left(\text{Exactly }k\text{ services are finished},N(t+\Delta t)-N(t)=k|X(t=i)\right)\right]\\ &amp;=\Pr(\text{No service is finished},N(t+\Delta t)-N(t)=0|X(t)=i)\\ &amp;\quad+\Pr(\text{Exactly 1 service is finished},N(t+\Delta t)-N(t)=1|X(t)=i)+o(\Delta t)\\ &amp;=\Pr(\text{No service is finished}|X(t)=i)\cdot\Pr(N(t+\Delta t)-N(t)=0)\\ &amp;\quad+\Pr(\text{Exactly 1 service is finished}|X(t)=i)\cdot\Pr(N(t+\Delta t)-N(t)=1)+o(\Delta t)\\ &amp;=\left[\Pr(A)\right]^i\cdot(1-\lambda\Delta t+o(\Delta t))+i\cdot\left[\Pr(A)\right]^{i-1}\cdot\Pr(B)\cdot(\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=(1-\mu\Delta t+o(\Delta t))^i(1-\lambda\Delta t+o(\Delta t))\\ &amp;\quad+i(1-\mu\Delta t+o(\Delta t))^{i-1}(\mu\Delta t+o(\Delta t))(\lambda\Delta t+o(\Delta t))+o(\Delta t)\\ &amp;=1-i\mu\Delta t-\lambda\Delta t+o(\Delta t)\\ &amp;=1-(i\mu+\lambda)\Delta t+o(\Delta t)\quad(i=0,1,2,...) \end{aligned}\tag{1.5} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 17.1077em; vertical-align: -8.30384em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 8.80384em;"><span class="" style="top: -10.8038em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top: 0em;">)</span></span></span></span><span class="" style="top: -8.36172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -6.86172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -5.36172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -3.86172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -2.23716em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: -0.702496em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 0.832168em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 2.33217em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span><span class="" style="top: 3.83217em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 8.30384em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 8.80384em;"><span class="" style="top: -10.8038em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.81167em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord text"><span class="mord">Exactly </span></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mord text"><span class="mord"> services are finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span><span class="" style="top: -8.36172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">No service is finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span><span class="" style="top: -6.86172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">Exactly 1 service is finished</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -5.36172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">No service is finished</span></span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span class="" style="top: -3.86172em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord text"><span class="mord">Exactly 1 service is finished</span></span><span class="mord">∣</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.23716em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.964564em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mop">Pr</span><span class="mopen">(</span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.964564em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">Pr</span><span class="mopen">(</span><span style="margin-right: 0.05017em;" class="mord mathdefault">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -0.702496em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span class="" style="top: 0.832168em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 2.33217em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: 3.83217em;"><span class="pstrut" style="height: 3.81167em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mclose">)</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 1em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 8.30384em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 17.1077em; vertical-align: -8.30384em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p>知<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           M 
          
         
           / 
          
         
           M 
          
         
           / 
          
         
           ∞ 
          
         
        
          M/M/\infty 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span class="mord">∞</span></span></span></span></span>排队系统对应生灭过程的状态空间为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
           = 
          
         
           N 
          
         
           = 
          
         
           { 
          
         
           0 
          
         
           , 
          
         
           1 
          
         
           , 
          
         
           2 
          
         
           , 
          
         
           . 
          
         
           . 
          
         
           . 
          
         
           } 
          
         
        
          \mathcal{X}=\N=\{0,1,2,...\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.14643em;" class="mord mathcal">X</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">N</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mclose">}</span></span></span></span></span></p> <p>根据式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.3 
          
         
           ) 
          
         
           ( 
          
         
           1.4 
          
         
           ) 
          
         
           ( 
          
         
           1.5 
          
         
           ) 
          
         
        
          (1.3)(1.4)(1.5) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">3</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span>，状态转移率矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Q 
          
         
           = 
          
         
           { 
          
          
          
            q 
           
           
           
             i 
            
           
             j 
            
           
          
         
           } 
          
         
        
          Q=\{q_{ij}\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>具有如下的显式表达：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                q 
               
               
               
                 i 
                
               
                 j 
                
               
              
             
               = 
              
              
              
                { 
               
               
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     0 
                    
                   
                  
                 
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     if  
                    
                   
                     j 
                    
                   
                     &gt; 
                    
                   
                     i 
                    
                   
                     + 
                    
                   
                     1 
                    
                   
                      or  
                    
                   
                     j 
                    
                   
                     &lt; 
                    
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     λ 
                    
                   
                  
                 
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     if  
                    
                   
                     j 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                     + 
                    
                   
                     1 
                    
                   
                  
                 
                
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     i 
                    
                   
                     μ 
                    
                   
                  
                 
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     if  
                    
                   
                     j 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                     − 
                    
                   
                     1 
                    
                   
                  
                 
                
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     − 
                    
                   
                     λ 
                    
                   
                     − 
                    
                   
                     i 
                    
                   
                     μ 
                    
                   
                  
                 
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     if  
                    
                   
                     j 
                    
                   
                     = 
                    
                   
                     i 
                    
                   
                  
                 
                
               
              
             
            
            
            
            
              (1.6) 
             
            
           
          
         
           q_{ij}=\left\{\begin{aligned} &amp;0&amp;&amp;\text{if }j&gt;i+1\text{ or }j&lt;i-1\\ &amp;\lambda&amp;&amp;\text{if }j=i+1\\ &amp;i\mu&amp;&amp;\text{if }j=i-1\\ &amp;-\lambda-i\mu&amp;&amp;\text{if }j=i \end{aligned}\right.\tag{1.6} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 6.00004em; vertical-align: -2.75002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25002em;"><span class="" style="top: -1.29999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.29999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.59999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.90001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.20001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.50002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -0.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord">0</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathdefault">λ</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -0.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mord text"><span class="mord"> or </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 6.00004em; vertical-align: -2.75002em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 对应的状态转移率示意图如下所示（省略状态转移到自身的负转移率）：</p> </li></ol> 
<p><img src="https://images2.imgbox.com/4a/d5/kAo1RuGh_o.png" alt="在这里插入图片描述"></p> 
<p>综上所述，式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         1.6 
        
       
         ) 
        
       
      
        (1.6) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">6</span><span class="mclose">)</span></span></span></span></span>与上图即为所求。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ■ 
        
       
      
        \blacksquare 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.675em; vertical-align: 0em;"></span><span class="mord amsrm">■</span></span></span></span></span></p> 
<ol start="2"><li> <p>根据<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Slide 
          
         
        
          \text{Slide} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">Slide</span></span></span></span></span></span>中的对应内容，可得一般形式下生灭过程的<strong>稳定状态概率</strong>（<em>steady state probability</em>）为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               { 
              
              
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     π 
                    
                   
                     0 
                    
                   
                  
                    = 
                   
                   
                    
                    
                      [ 
                     
                     
                     
                       1 
                      
                     
                       + 
                      
                      
                      
                        ∑ 
                       
                       
                       
                         n 
                        
                       
                         = 
                        
                       
                         1 
                        
                       
                      
                        ∞ 
                       
                      
                      
                      
                        ( 
                       
                       
                        
                         
                         
                           ∏ 
                          
                          
                          
                            k 
                           
                          
                            = 
                           
                          
                            0 
                           
                          
                          
                          
                            n 
                           
                          
                            − 
                           
                          
                            1 
                           
                          
                         
                         
                         
                           λ 
                          
                         
                           k 
                          
                         
                        
                        
                         
                         
                           ∏ 
                          
                          
                          
                            k 
                           
                          
                            = 
                           
                          
                            1 
                           
                          
                         
                           n 
                          
                         
                         
                         
                           μ 
                          
                         
                           k 
                          
                         
                        
                       
                      
                        ) 
                       
                      
                     
                    
                      ] 
                     
                    
                    
                    
                      − 
                     
                    
                      1 
                     
                    
                   
                  
                 
                
               
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     π 
                    
                   
                     t 
                    
                   
                  
                    = 
                   
                   
                   
                     ( 
                    
                    
                     
                      
                      
                        ∏ 
                       
                       
                       
                         k 
                        
                       
                         = 
                        
                       
                         0 
                        
                       
                       
                       
                         t 
                        
                       
                         − 
                        
                       
                         1 
                        
                       
                      
                      
                      
                        λ 
                       
                      
                        k 
                       
                      
                     
                     
                      
                      
                        ∏ 
                       
                       
                       
                         k 
                        
                       
                         = 
                        
                       
                         1 
                        
                       
                      
                        t 
                       
                      
                      
                      
                        μ 
                       
                      
                        k 
                       
                      
                     
                    
                   
                     ) 
                    
                   
                   
                   
                     π 
                    
                   
                     0 
                    
                   
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    = 
                   
                  
                    1 
                   
                  
                    , 
                   
                  
                    2 
                   
                  
                    , 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                    ) 
                   
                  
                 
                
               
              
             
            
            
            
            
              (1.7) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;\pi_0=\left[{1+\sum_{n=1}^\infty\left(\frac{\prod_{k=0}^{n-1}\lambda_k}{\prod_{k=1}^n\mu_k}\right)}\right]^{-1}\\ &amp;\pi_t=\left(\frac{\prod_{k=0}^{t-1}\lambda_k}{\prod_{k=1}^t\mu_k}\right)\pi_0\quad(t=1,2,...) \end{aligned}\right.\tag{1.7} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6.82115em; vertical-align: -3.16058em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.55002em;"><span class="" style="top: -0.99999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -0.99999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.29999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.59999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.90001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.20001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.50001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.80002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.05002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.66058em;"><span class="" style="top: -5.66058em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span><span class="" style="top: -2.34346em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.16058em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.66058em;"><span class="" style="top: -5.66058em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.88289em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.26711em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.64372em;"><span class="" style="top: -2.30571em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.68971em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.994002em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.95401em;"><span class="" style="top: -4.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.34346em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.64372em;"><span class="" style="top: -2.17654em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.933456em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.68971em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.12317em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.16058em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 6.82115em; vertical-align: -3.16058em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">7</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 其中对应本题的生灭过程，可得具体的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            λ 
           
          
            i 
           
          
         
        
          \lambda_i 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            μ 
           
          
            i 
           
          
         
        
          \mu_i 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的表达式：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               { 
              
              
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     λ 
                    
                   
                     i 
                    
                   
                  
                    = 
                   
                  
                    λ 
                   
                  
                 
                
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    i 
                   
                  
                    = 
                   
                  
                    0 
                   
                  
                    , 
                   
                  
                    1 
                   
                  
                    , 
                   
                  
                    2 
                   
                  
                    , 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                 
                
               
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     μ 
                    
                   
                     i 
                    
                   
                  
                    = 
                   
                  
                    i 
                   
                  
                    μ 
                   
                  
                 
                
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    i 
                   
                  
                    = 
                   
                  
                    1 
                   
                  
                    , 
                   
                  
                    2 
                   
                  
                    , 
                   
                  
                    3 
                   
                  
                    , 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                 
                
               
              
             
            
            
            
            
              (1.8) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;\lambda_i=\lambda&amp;&amp;i=0,1,2,...\\ &amp;\mu_i=i\mu&amp;&amp;i=1,2,3,... \end{aligned}\right.\tag{1.8} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">λ</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">8</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 将式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.8 
          
         
           ) 
          
         
        
          (1.8) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">8</span><span class="mclose">)</span></span></span></span></span>代入式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.7 
          
         
           ) 
          
         
        
          (1.7) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">7</span><span class="mclose">)</span></span></span></span></span>即可得到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           M 
          
         
           / 
          
         
           M 
          
         
           / 
          
         
           ∞ 
          
         
        
          M/M/\infty 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span class="mord">∞</span></span></span></span></span>排队系统对应生灭过程的<strong>稳定状态概率</strong>（<em>steady state probability</em>），设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ρ 
          
         
           = 
          
          
          
            λ 
           
          
            μ 
           
          
         
        
          \rho=\frac\lambda\mu 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">ρ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.36122em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">μ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">λ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               { 
              
              
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     π 
                    
                   
                     0 
                    
                   
                  
                    = 
                   
                   
                    
                    
                      [ 
                     
                    
                      1 
                     
                    
                      + 
                     
                     
                     
                       ∑ 
                      
                      
                      
                        n 
                       
                      
                        = 
                       
                      
                        1 
                       
                      
                     
                       ∞ 
                      
                     
                     
                     
                       1 
                      
                      
                      
                        n 
                       
                      
                        ! 
                       
                      
                     
                     
                      
                      
                        ( 
                       
                       
                       
                         λ 
                        
                       
                         μ 
                        
                       
                      
                        ) 
                       
                      
                     
                       n 
                      
                     
                    
                      ] 
                     
                    
                    
                    
                      − 
                     
                    
                      1 
                     
                    
                   
                  
                 
                
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    = 
                   
                   
                   
                     e 
                    
                    
                    
                      − 
                     
                    
                      ρ 
                     
                    
                   
                  
                 
                
                
                 
                  
                 
                
               
               
                
                 
                  
                 
                
                
                 
                  
                   
                   
                   
                     π 
                    
                   
                     i 
                    
                   
                  
                    = 
                   
                   
                   
                     1 
                    
                    
                    
                      i 
                     
                    
                      ! 
                     
                    
                   
                   
                    
                    
                      ( 
                     
                     
                     
                       λ 
                      
                     
                       μ 
                      
                     
                    
                      ) 
                     
                    
                   
                     i 
                    
                   
                   
                   
                     π 
                    
                   
                     0 
                    
                   
                  
                 
                
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    = 
                   
                   
                   
                     1 
                    
                    
                    
                      i 
                     
                    
                      ! 
                     
                    
                   
                   
                   
                     ρ 
                    
                   
                     i 
                    
                   
                   
                   
                     e 
                    
                    
                    
                      − 
                     
                    
                      ρ 
                     
                    
                   
                  
                 
                
                
                 
                  
                 
                
                
                 
                  
                   
                  
                    i 
                   
                  
                    = 
                   
                  
                    1 
                   
                  
                    , 
                   
                  
                    2 
                   
                  
                    , 
                   
                  
                    3 
                   
                  
                    , 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                    . 
                   
                  
                 
                
               
              
             
            
            
            
            
              (1.9) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;\pi_0=\left[1+\sum_{n=1}^\infty\frac1{n!}\left(\frac{\lambda}{\mu}\right)^n\right]^{-1}&amp;&amp;=e^{-\rho}&amp;\\ &amp;\pi_i=\frac1{i!}\left(\frac\lambda\mu\right)^i\pi_0&amp;&amp;=\frac1{i!}\rho^ie^{-\rho}&amp;&amp;i=1,2,3,... \end{aligned}\right.\tag{1.9} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6.43572em; vertical-align: -2.96786em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25002em;"><span class="" style="top: -1.29999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.29999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.59999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.90001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.20001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.50002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.46786em;"><span class="" style="top: -5.46786em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span><span class="" style="top: -2.23618em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.46786em;"><span class="" style="top: -5.46786em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">[</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.88289em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.26711em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">μ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">λ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.50429em;"><span class="" style="top: -3.9029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.95401em;"><span class="" style="top: -4.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.23618em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">μ</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">λ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.66456em;"><span class="" style="top: -3.9029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.46786em;"><span class="" style="top: -5.46786em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span><span class="" style="top: -2.23618em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.46786em;"><span class="" style="top: -5.46786em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.23618em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.46786em;"><span class="" style="top: -5.46786em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span><span class="" style="top: -2.23618em;"><span class="pstrut" style="height: 3.95401em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="" style="top: -1.94674em;"><span class="pstrut" style="height: 3.66456em;"></span><span class="mord"><span class="mord"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.96786em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 6.43572em; vertical-align: -2.96786em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 综上所述，式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.9 
          
         
           ) 
          
         
        
          (1.9) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span>即为所求。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ■ 
          
         
        
          \blacksquare 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.675em; vertical-align: 0em;"></span><span class="mord amsrm">■</span></span></span></span></span></p> </li><li> <p><strong>效用</strong>（<em>utilization</em>）为处于繁忙状态的服务器的期望数量，在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           M 
          
         
           / 
          
         
           M 
          
         
           / 
          
         
           ∞ 
          
         
        
          M/M/\infty 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span class="mord">∞</span></span></span></span></span>的排队系统中即<strong>平均队长</strong>（<em>average queue length</em>）：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               Utilization 
              
             
               = 
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
             
               i 
              
              
              
                π 
               
              
                i 
               
              
             
               = 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
              
              
                1 
               
               
               
                 ( 
                
               
                 i 
                
               
                 − 
                
               
                 1 
                
               
                 ) 
                
               
                 ! 
                
               
              
              
              
                ρ 
               
              
                i 
               
              
             
               = 
              
             
               ρ 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
              
              
                ∑ 
               
               
               
                 t 
                
               
                 = 
                
               
                 0 
                
               
              
                ∞ 
               
              
              
              
                1 
               
               
               
                 t 
                
               
                 ! 
                
               
              
              
              
                ρ 
               
              
                t 
               
              
             
               = 
              
             
               ρ 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
             
               ⋅ 
              
              
              
                e 
               
              
                ρ 
               
              
             
               = 
              
             
               ρ 
              
             
            
            
            
            
              (1.10) 
             
            
           
          
         
           \text{Utilization}=\sum_{i=1}^\infty i\pi_i=e^{-\rho}\sum_{i=1}^\infty \frac1{(i-1)!}\rho^i=\rho e^{-\rho}\sum_{t=0}^\infty \frac1{t!}\rho^{t}=\rho e^{-\rho}\cdot e^\rho=\rho\tag{1.10} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">Utilization</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.91851em; vertical-align: -1.26711em;"></span><span class="mord mathdefault">ρ</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.88289em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.26711em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.01577em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">ρ</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.714392em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714392em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">ρ</span></span><span class="tag"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">0</span></span><span class="mord">)</span></span></span></span></span></span></span><br> <strong>吞吐量</strong>（<em>throughput</em>）为客户离开排队系统的速率，根据式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.9 
          
         
           ) 
          
         
        
          (1.9) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span>，可得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               Throughput 
              
             
               = 
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
             
               i 
              
             
               μ 
              
             
               ⋅ 
              
              
              
                π 
               
              
                i 
               
              
             
               = 
              
             
               μ 
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
             
               i 
              
              
              
                π 
               
              
                i 
               
              
             
               = 
              
             
               μ 
              
             
               ⋅ 
              
             
               Utilization 
              
             
               = 
              
             
               μ 
              
             
               ρ 
              
             
            
            
            
            
              (1.11) 
             
            
           
          
         
           \text{Throughput}=\sum_{i=1}^\infty i\mu\cdot\pi_i=\mu\sum_{i=1}^{\infty}i\pi_i=\mu\cdot\text{Utilization}=\mu\rho\tag{1.11} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Throughput</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.63889em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">Utilization</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord mathdefault">ρ</span></span><span class="tag"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 综上所述，式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.10 
          
         
           ) 
          
         
        
          (1.10) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span>与式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.11 
          
         
           ) 
          
         
        
          (1.11) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>即为所求。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ■ 
          
         
        
          \blacksquare 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.675em; vertical-align: 0em;"></span><span class="mord amsrm">■</span></span></span></span></span></p> </li><li> <p><strong>平均队长</strong>（<em>average queue length</em>）可以根据式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.9 
          
         
           ) 
          
         
        
          (1.9) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span>计算得出：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               E 
              
             
               [ 
              
             
               X 
              
             
               ] 
              
             
               = 
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
             
               i 
              
              
              
                π 
               
              
                i 
               
              
             
               = 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
              
              
                ∑ 
               
               
               
                 i 
                
               
                 = 
                
               
                 1 
                
               
              
                ∞ 
               
              
              
              
                1 
               
               
               
                 ( 
                
               
                 i 
                
               
                 − 
                
               
                 1 
                
               
                 ) 
                
               
                 ! 
                
               
              
              
              
                ρ 
               
              
                i 
               
              
             
               = 
              
             
               ρ 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
              
              
                ∑ 
               
               
               
                 t 
                
               
                 = 
                
               
                 0 
                
               
              
                ∞ 
               
              
              
              
                1 
               
               
               
                 t 
                
               
                 ! 
                
               
              
              
              
                ρ 
               
              
                t 
               
              
             
               = 
              
             
               ρ 
              
              
              
                e 
               
               
               
                 − 
                
               
                 ρ 
                
               
              
             
               ⋅ 
              
              
              
                e 
               
              
                ρ 
               
              
             
               = 
              
             
               ρ 
              
             
            
            
            
            
              (1.12) 
             
            
           
          
         
           E[X]=\sum_{i=1}^\infty i\pi_i=e^{-\rho}\sum_{i=1}^\infty \frac1{(i-1)!}\rho^i=\rho e^{-\rho}\sum_{t=0}^\infty \frac1{t!}\rho^{t}=\rho e^{-\rho}\cdot e^\rho=\rho\tag{1.12} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.91851em; vertical-align: -1.26711em;"></span><span class="mord mathdefault">ρ</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.88289em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.26711em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mclose">!</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.01577em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">ρ</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.714392em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714392em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">ρ</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">ρ</span></span><span class="tag"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br> <strong>平均系统时间</strong>（<em>average system time</em>），在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           M 
          
         
           / 
          
         
           M 
          
         
           / 
          
         
           ∞ 
          
         
        
          M/M/\infty 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="mord">/</span><span class="mord">∞</span></span></span></span></span>的排队系统中即为每台服务器的平均服务时间：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               E 
              
             
               [ 
              
             
               S 
              
             
               ] 
              
             
               = 
              
              
              
                1 
               
              
                μ 
               
              
             
            
            
            
            
              (1.13) 
             
            
           
          
         
           E[S]=\frac1\mu\tag{1.13} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="mopen">[</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.20188em; vertical-align: -0.88044em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">μ</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.88044em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 2.20188em; vertical-align: -0.88044em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 综上所述，式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.12 
          
         
           ) 
          
         
        
          (1.12) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>与式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1.13 
          
         
           ) 
          
         
        
          (1.13) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span>即为所求。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ■ 
          
         
        
          \blacksquare 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.675em; vertical-align: 0em;"></span><span class="mord amsrm">■</span></span></span></span></span></p> </li></ol> 
<h4><a id="0602_1015"></a>06-02</h4> 
<blockquote> 
 <ul><li>三天两夜，准备创造一个奇迹（感觉已经被ddl逼上绝路）。今天身体更疼，又要错过一个凉快的天气了，唉。</li><li>但是晚上还是不甘心浪费这么好的天气，强行起跑，结果5圈就报销。右膝疼，左脚踝也疼，感觉腰还有点扭了，肩膀也不行，整就一废人。五圈之后练了三组400米间歇，基本上还是在1分30左右的水平，状态差就只能跑间歇练速耐了，至于10km，有的是机会去破。权且休整数日罢。</li></ul> 
</blockquote> 
<h4><a id="0603_1020"></a>06-03</h4> 
<blockquote> 
 <ul><li>最终我决定靠想象力凑齐数据，要我看500多张excel表一个个找，那是不可能的。</li><li>研代会还要正装，烦，不想去了都，搞这么复杂。</li><li>本来晚饭后去热了两圈身，步伐很沉，完全提不起状态。晚课下之后看确实很凉快，觉得浪费这么好的天气也很可惜，轻装上阵，结果35分18秒跑完8.02km，平均配速4’23"！其实我还是本着44分10km去跑的，可惜第8个1000米提速太早，最后200米我感觉心脏都要跳出来了，整个人都要变形了。至此，近半年历史最佳成绩汇总（基本上都是近两个月内）：</li></ul> 
</blockquote> 
<table><thead><tr><th>里程</th><th>平均配速</th><th>总用时</th><th>日期</th></tr></thead><tbody><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1 
           
          
            k 
           
          
            m 
           
          
         
           \rm 1km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">1</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             3 
            
           
             ′ 
            
           
          
            3 
           
           
           
             4 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           3'34'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">3</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             3 
            
           
             ′ 
            
           
          
            3 
           
           
           
             4 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           3'34'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">3</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            3 
           
          
         
           2021/5/3 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">3</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2 
           
          
            k 
           
          
            m 
           
          
         
           \rm 2km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">2</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             3 
            
           
             ′ 
            
           
          
            5 
           
           
           
             4 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           3'54'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">5</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             7 
            
           
             ′ 
            
           
          
            4 
           
           
           
             9 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           7'49'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">7</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">4</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            7 
           
          
         
           2021/5/7 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">7</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            3 
           
          
            k 
           
          
            m 
           
          
         
           \rm 3km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">3</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            0 
           
           
           
             2 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'02'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1 
           
           
           
             2 
            
           
             ′ 
            
           
          
            0 
           
           
           
             7 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           12'07'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">7</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            4 
           
          
            / 
           
          
            18 
           
          
         
           2021/4/18 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">4</span><span class="mord">/</span><span class="mord">1</span><span class="mord">8</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            4 
           
          
            k 
           
          
            m 
           
          
         
           \rm 4km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">4</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            1 
           
           
           
             3 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'13'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            1 
           
           
           
             6 
            
           
             ′ 
            
           
          
            5 
           
           
           
             5 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           16'55'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">5</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            4 
           
          
            / 
           
          
            22 
           
          
         
           2021/4/22 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">4</span><span class="mord">/</span><span class="mord">2</span><span class="mord">2</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            5 
           
          
            k 
           
          
            m 
           
          
         
           \rm 5km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">5</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            1 
           
           
           
             3 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'13'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2 
           
           
           
             1 
            
           
             ′ 
            
           
          
            0 
           
           
           
             8 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           21'08'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">8</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            27 
           
          
         
           2021/5/27 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">2</span><span class="mord">7</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            6 
           
          
            k 
           
          
            m 
           
          
         
           \rm 6km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">6</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            2 
           
           
           
             1 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'21'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">2</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2 
           
           
           
             6 
            
           
             ′ 
            
           
          
            0 
           
           
           
             9 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           26'09'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            29 
           
          
         
           2021/5/29 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">2</span><span class="mord">9</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            8 
           
          
            k 
           
          
            m 
           
          
         
           \rm 8km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">8</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            2 
           
           
           
             3 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'23'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">2</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            3 
           
           
           
             5 
            
           
             ′ 
            
           
          
            1 
           
           
           
             0 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           35'10'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            6 
           
          
            / 
           
          
            3 
           
          
         
           2021/6/3 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">6</span><span class="mord">/</span><span class="mord">3</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            10 
           
          
            k 
           
          
            m 
           
          
         
           \rm 10km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            2 
           
           
           
             5 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'25'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            4 
           
           
           
             4 
            
           
             ′ 
            
           
          
            0 
           
           
           
             8 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           44'08'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">4</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">8</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            1 
           
          
         
           2021/5/1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            12 
           
          
            k 
           
          
            m 
           
          
         
           \rm 12km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">1</span><span class="mord mathrm">2</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            4 
           
           
           
             0 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'40'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">4</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            5 
           
           
           
             6 
            
           
             ′ 
            
           
          
            0 
           
           
           
             9 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           56'09'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">5</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            12 
           
          
         
           2021/5/12 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">1</span><span class="mord">2</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            15 
           
          
            k 
           
          
            m 
           
          
         
           \rm 15km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">1</span><span class="mord mathrm">5</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            4 
           
           
           
             4 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'44'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">4</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            7 
           
           
           
             1 
            
           
             ′ 
            
           
          
            0 
           
           
           
             5 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           71'05'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">7</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2020 
           
          
            / 
           
          
            12 
           
          
            / 
           
          
            31 
           
          
         
           2020/12/31 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">0</span><span class="mord">/</span><span class="mord">1</span><span class="mord">2</span><span class="mord">/</span><span class="mord">3</span><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            20 
           
          
            k 
           
          
            m 
           
          
         
           \rm 20km 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">2</span><span class="mord mathrm">0</span><span class="mord mathrm">k</span><span class="mord mathrm">m</span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             4 
            
           
             ′ 
            
           
          
            4 
           
           
           
             5 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           4'45'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">4</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            9 
           
           
           
             5 
            
           
             ′ 
            
           
          
            0 
           
           
           
             8 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
         
           95'08'' 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord">9</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord"><span class="mord">8</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
            / 
           
          
            5 
           
          
            / 
           
          
            17 
           
          
         
           2021/5/17 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mord">/</span><span class="mord">1</span><span class="mord">7</span></span></span></span></span></td></tr></tbody></table> 
<h4><a id="0604_1039"></a>06-04</h4> 
<blockquote> 
 <ul><li>我能理解hdm的不满的心情，因为我也是只用了一周不到糊了一篇汇报出来。但是你指望我们这些到了16周还有五门专业课要上，三门专业课还在布置纸面作业，一学期上了六门专业课外带一两门选修的硕博和博士花一两个月乃至一学期时间做一个以后永远用不到的实证分析研究，这太难了。</li><li>整整五年没有这种被老师训话的经历了，还是当着全班近40个硕博和博士。本来计划晚上讲8组，结果只讲了四组，其中三组全被hdm劝退。能理解hdm也是好心，可惜院里这些老一辈做的研究真的跟不上年轻一辈的节奏了，现在院里的主流还是OR，OM和ML这块。不过跟hdm也算是有些情分，我尽力而为，下周汇报不会让她太尴尬。</li><li>研路难，且自勉以共进。周末休养生息，吃些好的。研代会可以跟yy见面，等他去阿里总部就没机会了，运气好兴许还能碰到熟人，不过也无碍了。</li></ul> 
</blockquote> 
<p>排队网络（QN）的仿真代码，其实我发现这类随机问题的仿真还挺难，内存耗用特别大，尤其如果你把时间间隔划得非常小（1e-6）左右的水平，16G内存的PC机都很容易卡死。这可能需要在代码上做一些内存占用的优化，比较费脑子，害。其实有一种思想就是时间间隔划大一些，然后做二阶近似（即单位时间间隔内会发生两次转移事件），这样倒也行，就是也有点费脑子。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Pool<span class="token punctuation">,</span> Manager

<span class="token keyword">def</span> <span class="token function">simulate_queue_network</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> p<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> T<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	
	timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T<span class="token operator">/</span>delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	
	system_state_series <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string">'link_states'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>												 <span class="token comment"># 链接上的packet数量记录（dict）</span>
		<span class="token string">'packet_states'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>											 <span class="token comment"># 每个packet的正在位于的link记录</span>
	<span class="token punctuation">}</span>
	
	nodes <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	node_state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>						 <span class="token comment"># 记录每个节点的packet到来情况</span>
	current_link_state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>												 <span class="token comment"># 当前的链接状态：每个链接上存在的所有packets</span>
	current_packet_state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>											 <span class="token comment"># 当前每个packet所处的链接位置：（None表示已经离开系统）</span>
	current_packet_time <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>											 <span class="token comment"># 当前每个packet已经在系统中停留的时间</span>
	num_packets <span class="token operator">=</span> <span class="token number">0</span>														 <span class="token comment"># packet计数值</span>
	
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>												 <span class="token comment"># 初始化current_link_state：每个链接上都没有packet</span>
		<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">!=</span> j<span class="token punctuation">:</span>
				current_link_state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	
	<span class="token keyword">for</span> timestamp <span class="token keyword">in</span> timestamps<span class="token punctuation">:</span>
		<span class="token comment"># 0 期初更新所有时间序列</span>
		system_state_series<span class="token punctuation">[</span><span class="token string">'link_states'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_link_state<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		system_state_series<span class="token punctuation">[</span><span class="token string">'packet_states'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_packet_state<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			
		<span class="token comment"># 外部输入情况</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>										 <span class="token comment"># 遍历每个节点</span>
			<span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> delta<span class="token punctuation">:</span>							 <span class="token comment"># 到来一个packet</span>
				packet_id <span class="token operator">=</span> num_packets									 <span class="token comment"># 给packet编号</span>
				current_packet_time<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
				node_state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>packet_id<span class="token punctuation">)</span>							 <span class="token comment"># 将packet记录到node_state中</span>
				num_packets <span class="token operator">+=</span> <span class="token number">1</span>										 <span class="token comment"># packet计数值+1</span>

		<span class="token comment"># 遍历每个链接：将链接上的东西传到节点中</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">in</span> current_link_state<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> mu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> delta <span class="token keyword">and</span> current_link_state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
				packet_id <span class="token operator">=</span> current_link_state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>			 <span class="token comment"># 这个要求当前链接上有packet，且触发了转移</span>
				node_state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>packet_id<span class="token punctuation">)</span>							 <span class="token comment"># 将这个packet添加到节点中记录</span>
		
		<span class="token comment"># 遍历每个节点，将其中所有的packet输送到各个link上，总之期末的时候node中一定不存在任何packet</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>										 <span class="token comment"># 遍历每个节点</span>
			<span class="token keyword">for</span> packet_id <span class="token keyword">in</span> node_state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>							 <span class="token comment"># 遍历每个节点上的packet</span>
				j <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>a<span class="token operator">=</span>nodes<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> p<span class="token operator">=</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
				<span class="token keyword">if</span> j <span class="token operator">==</span> i<span class="token punctuation">:</span>												 <span class="token comment"># 离开系统</span>
					current_packet_state<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>				 <span class="token comment"># 将该packet的状态置为None</span>
				<span class="token keyword">else</span><span class="token punctuation">:</span>
					current_packet_state<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>			 <span class="token comment"># 更新packet状态</span>
					current_link_state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>packet_id<span class="token punctuation">)</span>		 <span class="token comment"># 更新link状态</span>
				node_state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		
		<span class="token comment"># 更新每个packet的停留时间</span>
		<span class="token keyword">for</span> packet_id <span class="token keyword">in</span> current_packet_state<span class="token punctuation">:</span>
			<span class="token keyword">if</span> current_packet_state<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
				current_packet_time<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'共计: {}个packet'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num_packets<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment"># 计算packet的平均停留时间</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>delta <span class="token operator">*</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>current_packet_time<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token comment"># 计算link的效用</span>
	
	link_busy_time <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>link<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token keyword">for</span> link <span class="token keyword">in</span> current_link_state<span class="token punctuation">}</span>
	
	<span class="token keyword">for</span> packet_state <span class="token keyword">in</span> system_state_series<span class="token punctuation">[</span><span class="token string">'packet_states'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> packet_id <span class="token keyword">in</span> packet_state<span class="token punctuation">:</span>
			<span class="token keyword">if</span> packet_state<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
				link_busy_time<span class="token punctuation">[</span>packet_state<span class="token punctuation">[</span>packet_id<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
	
	<span class="token keyword">for</span> link <span class="token keyword">in</span> link_busy_time<span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> link_busy_time<span class="token punctuation">[</span>link<span class="token punctuation">]</span><span class="token punctuation">,</span> link_busy_time<span class="token punctuation">[</span>link<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>timestamps<span class="token punctuation">)</span><span class="token punctuation">)</span>
		

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>													 <span class="token comment"># 各个节点外部输入的速率</span>
	p <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token punctuation">[</span><span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
		<span class="token punctuation">[</span><span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.6</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
		<span class="token punctuation">[</span><span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
		<span class="token punctuation">[</span><span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
		<span class="token punctuation">[</span><span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">.0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
	<span class="token punctuation">]</span>																	 <span class="token comment"># 节点转移概率矩阵（节点转移到自身的概率为其离开排队网络的速率）</span>
	mu <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
	simulate_queue_network<span class="token punctuation">(</span>r<span class="token punctuation">,</span> p<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> T<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0605_1146"></a>06-05</h4> 
<blockquote> 
 <ul><li>凌晨肝到近三点秒了所有作业，这是我第几遍自学内点法和整数规划了？后悔不好好听课…</li><li>大补了一顿甲鱼，外加午睡两小时，满血满蓝复活。可能还是书包太重一路走回学校太疲劳了，晚八点半一回校就马不停蹄地开始按4分配跑圈，5圈过后明显感觉坚持不到3km，休息了一会儿跑了三组90秒的400间歇，总之追求4分配以内必须练间歇跑了，虽然间歇跑真的太吃力了。</li></ul> 
</blockquote> 
<p>我最近遇到一个很棘手的问题，就是从中国统计年鉴以及中国金融年鉴上下载得到的excel表是受保护的，但是其实可以打开，只是不能编辑，在excel中的审阅里点击取消保护是需要输入密码的。但是如果我用xlrd库去读取或者pandas的read_excel去读取都会报错：</p> 
<pre><code>xlrd.biffh.XLRDError: Workbook is encrypted
</code></pre> 
<p>即连读取都做不到，显示工作表被加密，但是其实正常还是可以打开的。</p> 
<p>然后我发现这种受保护的工作表依然可以导出成csv（这个其实可以写个按键精灵的脚本去一个个手动导出），这样就可以读取了，但是很蠢，而且费时费力，目前有几种可能的处理方案，一个是使用<code>openpyxl</code>库来读取，这个库似乎要比<code>xlrd</code>更高级一些，另一个方案是<code>from win32com.client import DispatchEx</code>，然后<code>excel = DispatchEx('Excel.Application')</code>，我记得以前批量把word转成pdf的脚本也是用到这个底层库，希望能行得通吧，要不然真的要人工看遍500多张excel表了。</p> 
<h4><a id="0606_1158"></a>06-06</h4> 
<blockquote> 
 <ul><li>晚上看到sxy，感觉印象和记忆种的很不同了，人总是在变。最后唱国际歌还在低头忙事情，实习真的是太忙了。临走让颜烨认识了一下，便是如此。</li><li>跟颜烨确实有段时间不见了，他已经入职阿里，明晚就要去杭州了，日薪400想必并不会轻松，祝他好运罢，希望多年后彼此都成家立业后还能亦如此。听他说杉数的同事很多都跳到阿里美团字节。杉数确实不是长久之计，但确然也是个不错的跳板，人生浮沉哪。</li><li>总的来说我们院还是莫得牌面，代表人数跟数院人文一个规模，我们好歹本科也是大院。颜烨最后只吃到了52票，半数都没过，亏我就只给他投了一票。</li></ul> 
</blockquote> 
<p>昨天的问题解决，用DispatchEx可解，附关于python处理Excel的若干方法：</p> 
<ol><li>使用<code>xlrd</code>：<code>data = xlrd.open_workbook()</code></li><li>使用<code>openpyxl</code>：<code>data = openpyxl.load_workbook()</code></li><li>使用<code>pandas</code>：<code>data = pd.read_excel()</code></li><li>使用<code>win32com</code>：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">import</span> DispatchEx		
excel <span class="token operator">=</span> DispatchEx<span class="token punctuation">(</span><span class="token string">'Excel.Application'</span><span class="token punctuation">)</span>
demo <span class="token operator">=</span> excel<span class="token punctuation">.</span>Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_path<span class="token punctuation">,</span> xls_filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
sheet <span class="token operator">=</span> demo<span class="token punctuation">.</span>WorkSheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sheet<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span>
demo<span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0607_1178"></a>06-07</h4> 
<blockquote> 
 <ul><li>最近关注了钞男神微博，才发现到他原来已经35岁，仍单身。从去年11月份就失恋，到今年5月还是郁郁寡欢，怪不得今年随机模型课上的没有去年金融工程那种激情了。想想同龄的常诚都已经是两个孩子的母亲了。北大数学博士也不得志，猛然意识到自己和史钞有好多共通点，跑步、怀旧、古风、民乐、关键都喜欢钻牛角尖，总感觉自己十年后也会是这幅光景… 害怕。</li><li>晚饭后4分配跑了5圈，然后开始跟ITCS那边玩飞盘。中途看到WXY来了，于是跟跑了一会儿，只跟了600米，配速3’45"，本来自己就已经有点疲乏，完全跟不住。隔了10分钟又跟了他800米，刚好是他的冲刺圈，速度太快。很难想象昨天那么热，他居然用3’57"的配速跑了10km，人和人的体质果然不能一概而论，长距离配速上跟他有将近30秒的差距，争取转博前能练到他这种有氧水平。</li></ul> 
</blockquote> 
<p>磁链解析python脚本：利用aria2解析（不要问我是用来做什么的，我只是好奇而已，关于aria2的配置使用，在我上半年的log里有提到）</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> http<span class="token punctuation">.</span>client <span class="token keyword">import</span> HTTPConnection
<span class="token keyword">import</span> json
SAVE_PATH <span class="token operator">=</span> <span class="token string">"torrents"</span>
STOP_TIMEOUT <span class="token operator">=</span> <span class="token number">60</span>
MAX_CONCURRENT <span class="token operator">=</span> <span class="token number">16</span>
MAX_MAGNETS <span class="token operator">=</span> <span class="token number">256</span>
ARIA2RPC_ADDR <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
ARIA2RPC_PORT <span class="token operator">=</span> <span class="token number">6800</span>

<span class="token keyword">def</span> <span class="token function">exec_rpc</span><span class="token punctuation">(</span>magnet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    使用 rpc，减少线程资源占用，关于这部分的详细信息科参考
    https://aria2.github.io/manual/en/html/aria2c.html?highlight=enable%20rpc#aria2.addUri
    """</span>
    conn <span class="token operator">=</span> HTTPConnection<span class="token punctuation">(</span>ARIA2RPC_ADDR<span class="token punctuation">,</span> ARIA2RPC_PORT<span class="token punctuation">)</span>
    req <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"magnet"</span><span class="token punctuation">,</span>
        <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"aria2.addUri"</span><span class="token punctuation">,</span>
        <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>magnet<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"bt-stop-timeout"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>STOP_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"max-concurrent-downloads"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>MAX_CONCURRENT<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"listen-port"</span><span class="token punctuation">:</span> <span class="token string">"6881"</span><span class="token punctuation">,</span>
                <span class="token string">"dir"</span><span class="token punctuation">:</span> SAVE_PATH<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    conn<span class="token punctuation">.</span>request<span class="token punctuation">(</span>
        <span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/jsonrpc"</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    res <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>conn<span class="token punctuation">.</span>getresponse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"error"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Aria2c replied with an error:"</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
exec_rpc<span class="token punctuation">(</span><span class="token string">'magnet:?xt=urn:btih:F6F7A767CFC964D24E05A0F50B04559B45021941'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0608_1222"></a>06-08</h4> 
<blockquote> 
 <ul><li>good，身体完全没有疼，第二次飞盘就完全适应强度了。昨晚回来之后忙里偷闲水了一篇爬虫，好久不做爬虫了，偶尔搞点老本行也挺好。</li><li>早上yy突然发消息来提wyy学术论文写作的pre做得稀碎，被老师怼得很惨。与我无瓜，无能为力，另外真的不能再提了，饶了我吧。</li><li>看得出来每个人期末都不是很好过，想不到经院也要学运筹和随机模型，早上高级计量结课的我一下子就平衡了哈哈。</li></ul> 
</blockquote> 
<p><mark>我醉了，脑子里只有浆糊，肚子里只有酒水，一点墨水也倒不出来了。</mark></p> 
<h4><a id="0609_1231"></a>06-09</h4> 
<blockquote> 
 <ul><li>昨晚课下，颜烨突然跟我提快要分手了，差不多才两个多月，这已经是他第四任了。本来自己状态很好，计划下课要去冲10km pb，临时应邀去陪颜烨喝酒。赌牌，畅饮，诉心肠，直至飘飘然，二人同饮，无需大醉，点到为止，甚是快哉。颜烨今早七点启程去杭州阿里总部，作为践行，昨晚回来十一点绕校跑了4km（均配4’27"），没有尽兴，还能接着跑，一来醒酒，二来且为友人践行。作业，pre，跟纵欲一场又能算得了什么呢？男人的快乐，约莫这么一回事吧。</li><li>结果酒精上头，三点多都睡不着，早上八点就起来，强行写作业到下午三点多，整个人都快散架了，太伤。</li></ul> 
</blockquote> 
<p>几何布朗运动（Geometrical Brownish Motion，GBM）仿真代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> norm
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool<span class="token punctuation">,</span> Manager
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 求解标准正态分布的累计密度函数值</span>
<span class="token keyword">def</span> <span class="token function">norm_dist</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>x<span class="token punctuation">,</span> loc<span class="token operator">=</span>loc<span class="token punctuation">,</span> scale<span class="token operator">=</span>scale<span class="token punctuation">)</span>

<span class="token comment"># 计算几何布朗运动的期望（理论值）</span>
<span class="token keyword">def</span> <span class="token function">calc_theoritical_expectation_for_geometrical_brownian_motion</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> s0 <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>mu <span class="token operator">*</span> t<span class="token punctuation">)</span>

<span class="token comment"># 计算几何布朗运动的方差（理论值）</span>
<span class="token keyword">def</span> <span class="token function">calc_theoritical_variance_for_geometrical_brownian_motion</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> s0 <span class="token operator">*</span> s0 <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> mu <span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>sigma <span class="token operator">*</span> sigma <span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 计算几何布朗运动的期望（仿真值）</span>
<span class="token keyword">def</span> <span class="token function">calc_simulated_expectation_for_geometrical_brownian_motion</span><span class="token punctuation">(</span>sample_paths<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sample_paths<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 计算几何布朗运动的方差（仿真值）</span>
<span class="token keyword">def</span> <span class="token function">calc_simulated_variance_for_geometrical_brownian_motion</span><span class="token punctuation">(</span>sample_paths<span class="token punctuation">)</span><span class="token punctuation">:</span>
	std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>sample_paths<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 
	<span class="token keyword">return</span> std <span class="token operator">*</span> std

<span class="token comment"># 生成一条标准布朗运动的样本路径</span>
<span class="token keyword">def</span> <span class="token function">generate_sample_path_for_standard_brownian_motion</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> timestamps<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> timestamps <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	current_state <span class="token operator">=</span> <span class="token number">0</span>
	sample_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> timestamp <span class="token keyword">in</span> timestamps<span class="token punctuation">:</span>
		sample_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_state<span class="token punctuation">)</span>
		current_state <span class="token operator">+=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>sample_path<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

<span class="token comment"># 根据标准布朗运动生成几何布朗运动</span>
<span class="token keyword">def</span> <span class="token function">geometrical_brownian_motion</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> s0 <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> sigma <span class="token operator">*</span> sigma<span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">+</span> sigma <span class="token operator">*</span> bm<span class="token punctuation">)</span>

<span class="token comment"># 仿真模拟几何布朗运动</span>
<span class="token keyword">def</span> <span class="token function">simulate_geometrical_brownian_motion</span><span class="token punctuation">(</span>mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	sample_paths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>sample_capacity<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>
		standard_brownian_motion_sample_path <span class="token operator">=</span> generate_sample_path_for_standard_brownian_motion<span class="token punctuation">(</span>T<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> timestamps<span class="token punctuation">)</span>
		sample_path <span class="token operator">=</span> geometrical_brownian_motion<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> standard_brownian_motion_sample_path<span class="token punctuation">)</span>
		sample_paths<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sample_path<span class="token punctuation">)</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>sample_paths<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

<span class="token comment"># 仿真模拟几何布朗运动（多进程目标函数）</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>sample_paths<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	standard_brownian_motion_sample_path <span class="token operator">=</span> generate_sample_path_for_standard_brownian_motion<span class="token punctuation">(</span>T<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> timestamps<span class="token punctuation">)</span>
	sample_path <span class="token operator">=</span> geometrical_brownian_motion<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> standard_brownian_motion_sample_path<span class="token punctuation">)</span>
	sample_paths<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sample_path<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token number">.12</span><span class="token punctuation">,</span> <span class="token number">.12</span><span class="token punctuation">,</span> <span class="token number">.005</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span>
	use_multiprocess <span class="token operator">=</span> <span class="token boolean">False</span>
	_timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	theoritical_expectation <span class="token operator">=</span> calc_theoritical_expectation_for_geometrical_brownian_motion<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">)</span>
	theoritical_variance <span class="token operator">=</span> calc_theoritical_variance_for_geometrical_brownian_motion<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> s0<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Theoritical expectation: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>theoritical_expectation<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Theoritical variance: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>theoritical_variance<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> use_multiprocess<span class="token punctuation">:</span>
		manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>
		sample_paths <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'sample_paths'</span>	<span class="token punctuation">:</span> sample_paths<span class="token punctuation">,</span>
			<span class="token string">'mu'</span>			<span class="token punctuation">:</span> mu<span class="token punctuation">,</span>
			<span class="token string">'sigma'</span>			<span class="token punctuation">:</span> sigma<span class="token punctuation">,</span>
			<span class="token string">'r'</span>				<span class="token punctuation">:</span> r<span class="token punctuation">,</span>
			<span class="token string">'k'</span>				<span class="token punctuation">:</span> k<span class="token punctuation">,</span>
			<span class="token string">'s0'</span>			<span class="token punctuation">:</span> s0<span class="token punctuation">,</span>
			<span class="token string">'T'</span>				<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
			<span class="token string">'delta'</span>			<span class="token punctuation">:</span> delta<span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
		start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
		pool <span class="token operator">=</span> Pool<span class="token punctuation">(</span>processes<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>sample_capacity<span class="token punctuation">)</span><span class="token punctuation">:</span>
			pool<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> kwds<span class="token operator">=</span>params<span class="token punctuation">)</span>
		pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
		pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
		sample_paths <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>sample_paths<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
		end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  - Time consumption: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		sample_paths <span class="token operator">=</span> simulate_geometrical_brownian_motion<span class="token punctuation">(</span>mu<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">,</span> delta<span class="token punctuation">)</span>
	simulated_expectation <span class="token operator">=</span> calc_simulated_expectation_for_geometrical_brownian_motion<span class="token punctuation">(</span>sample_paths<span class="token punctuation">)</span>
	simulated_variance <span class="token operator">=</span> calc_simulated_variance_for_geometrical_brownian_motion<span class="token punctuation">(</span>sample_paths<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Simulated expectation: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>simulated_expectation<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Simulated variance: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>simulated_variance<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	
	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> theoritical_expectation<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> simulated_expectation<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Expectation'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'$t$'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'$E[S(t)]$'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Theoritical'</span><span class="token punctuation">,</span> <span class="token string">'Simulated'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'expectation.png'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> theoritical_variance<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>_timestamps<span class="token punctuation">,</span> simulated_variance<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Variance'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'$t$'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'$Var[S(t)]$'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Theoritical'</span><span class="token punctuation">,</span> <span class="token string">'Simulated'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'variance.png'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>sample_paths<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> k<span class="token punctuation">)</span> <span class="token operator">/</span> sample_capacity<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0610_1360"></a>06-10</h4> 
<blockquote> 
 <ul><li>昨晚11时金言突然来电说周五要来沪，两年不见了，每次来办签证都还记得找我。可惜我跟朱光耀真的是有五年不见了，这次时间比较紧也不能叫朱光耀从交大赶来，不过可以考虑叫上刘天浩。“金（言）—（曹）阳—（朱）光（耀）”同寝三年，从开始走到结束，只可惜我太拉胯，财大还是不能跟科大交大相提并论。想我们高三(1)班以<strong>天招班</strong>自居，如今随便提几个人都是直博硕博在读，在北京的第一梯队只会更加恐怖。估摸着有一半人都会读到博士，以后真有聚会怕真是会很没面子…</li><li>入梅，持续一个月，沉闷至极，很不快，只能在中长距离上的速耐练习，这种天强行10km以上真的会脱水到休克。</li><li>端午王凯重回杨浦，也是很期待与他会面，一周内与三个最好的挚友约见，对我来说实在是太奢侈了。</li></ul> 
</blockquote> 
<p>关于Black-Scholez模型期权定价的仿真代码：</p> 
<p>这里其实有点问题，就是本质上我只能对一条价格曲线做仿真，如果真的先仿真出多个S(t)的样本路径后，计算对应价格曲线的均值，这个仿真量就太大了，但是题目中是说要仿真5000条样本路径，我就不是很能搞得明白。</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> norm
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool<span class="token punctuation">,</span> Manager
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt


<span class="token comment"># 生成一条标准布朗运动的样本路径</span>
<span class="token keyword">def</span> <span class="token function">generate_sample_path_for_standard_brownian_motion</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> timestamps<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> timestamps <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	current_state <span class="token operator">=</span> <span class="token number">0</span>
	sample_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> timestamp <span class="token keyword">in</span> timestamps<span class="token punctuation">:</span>
		sample_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_state<span class="token punctuation">)</span>
		current_state <span class="token operator">+=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>sample_path<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

<span class="token comment"># 根据标准布朗运动生成几何布朗运动</span>
<span class="token keyword">def</span> <span class="token function">geometrical_brownian_motion</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> bm<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> s0 <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> sigma <span class="token operator">*</span> sigma<span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">+</span> sigma <span class="token operator">*</span> bm<span class="token punctuation">)</span>
	
<span class="token comment"># 随机生成计算某个瞬时几何布朗运动的状态值（根据当前状态s_t与时刻t）</span>
<span class="token keyword">def</span> <span class="token function">generate_final_state_of_gbm</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s_t<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>
	tau <span class="token operator">=</span> T <span class="token operator">-</span> t
	<span class="token keyword">return</span> s_t <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> sigma <span class="token operator">*</span> sigma<span class="token punctuation">)</span> <span class="token operator">*</span> tau <span class="token operator">+</span> sigma <span class="token operator">*</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>tau<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 期权价格的理论值</span>
<span class="token keyword">def</span> <span class="token function">theoritical_price</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> s_t<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>
	tau <span class="token operator">=</span> T <span class="token operator">-</span> t
	d_1 <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>s_t <span class="token operator">/</span> k<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> sigma <span class="token operator">*</span> sigma <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> tau<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sigma <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>tau<span class="token punctuation">)</span><span class="token punctuation">)</span>
	d_2 <span class="token operator">=</span> d_1 <span class="token operator">-</span> sigma <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>tau<span class="token punctuation">)</span>
	<span class="token keyword">return</span> s_t <span class="token operator">*</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>d_1<span class="token punctuation">)</span> <span class="token operator">-</span> k <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>r <span class="token operator">*</span> tau<span class="token punctuation">)</span> <span class="token operator">*</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>d_2<span class="token punctuation">)</span>

<span class="token comment"># 期权价格的仿真值</span>
<span class="token keyword">def</span> <span class="token function">simulate_price</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> s_t<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> T<span class="token punctuation">,</span> n_sample<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	tau <span class="token operator">=</span> T <span class="token operator">-</span> t
	ST_minus_K <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">max</span><span class="token punctuation">(</span>generate_final_state_of_gbm<span class="token punctuation">(</span>t<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s_t<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">-</span> k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_sample<span class="token punctuation">)</span><span class="token punctuation">]</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>r <span class="token operator">*</span> tau<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>ST_minus_K<span class="token punctuation">)</span>

<span class="token comment"># 仿真代码</span>
<span class="token keyword">def</span> <span class="token function">simulate_black_scholes</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">)</span><span class="token punctuation">:</span>
	timestamps <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>T <span class="token operator">/</span> delta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	standard_brownian_motion_sample_path <span class="token operator">=</span> generate_sample_path_for_standard_brownian_motion<span class="token punctuation">(</span>T<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> timestamps<span class="token punctuation">)</span>
	geometrical_brownian_motion_sample_path <span class="token operator">=</span> geometrical_brownian_motion<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> standard_brownian_motion_sample_path<span class="token punctuation">)</span>
	theoritical_price_sample_path <span class="token operator">=</span> theoritical_price<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> geometrical_brownian_motion_sample_path<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
	
	<span class="token comment"># simulated_price_paths = []</span>
	<span class="token comment"># for _ in range(sample_capacity):</span>
		<span class="token comment"># print(_)</span>
		<span class="token comment"># standard_brownian_motion_sample_path = generate_sample_path_for_standard_brownian_motion(T, delta, timestamps)</span>
		<span class="token comment"># geometrical_brownian_motion_sample_path = geometrical_brownian_motion(timestamps, sigma, r, s0, standard_brownian_motion_sample_path)</span>
		<span class="token comment"># simulated_price_path = []</span>
		<span class="token comment"># for timestamp, state in zip(timestamps, geometrical_brownian_motion_sample_path):</span>
			<span class="token comment"># simulated_price = simulate_price(timestamp, state, sigma, r, k, T)</span>
			<span class="token comment"># simulated_price_path.append(simulated_price)</span>
		<span class="token comment"># simulated_price_paths.append(simulated_price_path)</span>
	<span class="token comment"># expected_simulated_price_path = np.mean(simulated_price_paths, axis=0)</span>
	expected_simulated_price_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> timestamp<span class="token punctuation">,</span> state <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> geometrical_brownian_motion_sample_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
		simulated_price <span class="token operator">=</span> simulate_price<span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> state<span class="token punctuation">,</span> sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> T<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">)</span>
		expected_simulated_price_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>simulated_price<span class="token punctuation">)</span>	
	
	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> expected_simulated_price_path<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>timestamps<span class="token punctuation">,</span> theoritical_price_sample_path<span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Simulated'</span><span class="token punctuation">,</span> <span class="token string">'Theoritical'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'price.png'</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
			
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token number">.12</span><span class="token punctuation">,</span> <span class="token number">.005</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span>
	simulate_black_scholes<span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> r<span class="token punctuation">,</span> k<span class="token punctuation">,</span> s0<span class="token punctuation">,</span> T<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> sample_capacity<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0611_1451"></a>06-11</h4> 
<blockquote> 
 <ul><li>金言居然早上七点半点就到了，还好我醒得早。老言子最近小日子过得很滋润，国内国外两头拿津贴，直接月入过万，整个人都发福了，比上次重了10kg，我刚好是瘦了10kg，然而我还是比他重一点哈哈。</li><li>跟老言子交流就会发现自己真的是弱小得很，他已经有一篇一作，还有一篇挂名，都是SCI一区的paper，与我这种菜B已经不可同日而语了。</li><li>到了这个年纪，老言子似乎也有点急，看上了小师妹可惜自己要出国，眼看着身边少年班的天才21岁就和女友拍了婚纱照，自己却还是孑然一身远赴他国，前途未卜，受身边环境的影响的了，人之常情，本来“浓厚的学术氛围”，一下子变成了单身狗座谈会，朱光耀跟管思思很早也分了，我们仨还是我们仨，唉。</li></ul> 
</blockquote> 
<p>几何布朗运动的期望方差计算（很离谱，我看到现在只有百度百科里有结论，就没一个人具体讲讲GBM的推导，关于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         E 
        
       
         [ 
        
        
        
          X 
         
        
          2 
         
        
       
         ( 
        
       
         t 
        
       
         ) 
        
       
         ] 
        
       
      
        \mathbb{E}[X^2(t)] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span>的值使用的是矩母函数的结论）：</p> 
<ul><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
          
          
            2 
           
          
            a 
           
          
            ) 
           
          
         
        
          (\rm 2a) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">2</span><span class="mord mathrm">a</span><span class="mclose">)</span></span></span></span></span></span> 即已知<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           G 
          
         
           B 
          
         
           M 
          
         
        
          \rm GBM 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">B</span><span class="mord mathrm">M</span></span></span></span></span></span>的表达式为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                { 
               
               
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     d 
                    
                   
                     S 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     = 
                    
                   
                     μ 
                    
                   
                     S 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     d 
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     σ 
                    
                   
                     S 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     d 
                    
                   
                     W 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                  
                 
                
                
                 
                  
                   
                  
                 
                 
                  
                   
                    
                   
                     S 
                    
                   
                     ( 
                    
                   
                     0 
                    
                   
                     ) 
                    
                   
                     = 
                    
                    
                    
                      s 
                     
                    
                      0 
                     
                    
                   
                  
                 
                
               
              
              
             
               ⟹ 
              
             
               S 
              
             
               ( 
              
             
               t 
              
             
               ) 
              
             
               = 
              
              
              
                s 
               
              
                0 
               
              
             
               exp 
              
             
               ⁡ 
              
              
              
                { 
               
               
               
                 ( 
                
               
                 μ 
                
               
                 − 
                
                
                
                  1 
                 
                
                  2 
                 
                
                
                
                  σ 
                 
                
                  2 
                 
                
               
                 ) 
                
               
              
                t 
               
              
                + 
               
              
                σ 
               
              
                W 
               
              
                ( 
               
              
                t 
               
              
                ) 
               
              
                } 
               
              
             
            
            
            
            
              (2.1) 
             
            
           
          
         
           \left\{\begin{aligned} &amp;\text{d}S(t)=\mu S(t)\text{d}t+\sigma S(t)\text{d}W(t)\\ &amp;S(0)=s_0 \end{aligned}\right.\\ \Longrightarrow S(t)=s_0\exp\left\{\left(\mu-\frac12\sigma^2\right)t+\sigma W(t)\right\}\tag{2.1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.75em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">d</span></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">μ</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mord text"><span class="mord">d</span></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mord text"><span class="mord">d</span></span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.549em; vertical-align: -0.024em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">2</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">}</span></span></span></span><span class="tag"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           W 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          W(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>是布朗运动，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           μ 
          
         
        
          \mu 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span></span></span></span></span>表示漂移率，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           σ 
          
         
        
          \sigma 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span></span></span></span></span>表示波动率。</p> <p>设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
           = 
          
         
           exp 
          
         
           ⁡ 
          
          
          
            { 
           
           
           
             ( 
            
           
             μ 
            
           
             − 
            
            
            
              1 
             
            
              2 
             
            
            
            
              σ 
             
            
              2 
             
            
           
             ) 
            
           
          
            t 
           
          
            + 
           
          
            σ 
           
          
            W 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
            } 
           
          
         
        
          X(t)=\exp\left\{\left(\mu-\frac12\sigma^2\right)t+\sigma W(t)\right\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.20001em; vertical-align: -0.35001em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">{<!-- --></span></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">}</span></span></span></span></span></span></span>，根据<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           S 
          
         
           l 
          
         
           i 
          
         
           d 
          
         
           e 
          
         
        
          \rm Slide 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span><span class="mord mathrm">l</span><span class="mord mathrm">i</span><span class="mord mathrm">d</span><span class="mord mathrm">e</span></span></span></span></span></span>中<strong>定理<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            7.1 
           
          
         
           7.1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">7</span><span class="mord">.</span><span class="mord">1</span></span></span></span></span></strong>，可知<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          X(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>是鞅，则可得：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                
               
               
                
                 
                  
                 
                   E 
                  
                 
                   [ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                   = 
                  
                 
                   E 
                  
                 
                   [ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   0 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                   = 
                  
                 
                   1 
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   Var 
                  
                 
                   [ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                   = 
                  
                 
                   E 
                  
                  
                  
                    [ 
                   
                   
                   
                     X 
                    
                   
                     2 
                    
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    ] 
                   
                  
                 
                   − 
                  
                 
                   ( 
                  
                 
                   E 
                  
                 
                   [ 
                  
                 
                   X 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                  
                  
                    ) 
                   
                  
                    2 
                   
                  
                 
                   = 
                  
                  
                  
                    e 
                   
                   
                    
                    
                      σ 
                     
                    
                      2 
                     
                    
                   
                     t 
                    
                   
                  
                 
                   − 
                  
                 
                   1 
                  
                 
                
               
              
             
            
            
            
            
              (2.2) 
             
            
           
          
         
           \begin{aligned} &amp;\mathbb{E}[X(t)]=\mathbb{E}[X(0)]=1\\ &amp;\text{Var}[X(t)]=\mathbb{E}\left[X^2(t)\right]-(\mathbb{E}[X(t)])^2=e^{\sigma^2t}-1 \end{aligned}\tag{2.2} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.19692em; vertical-align: -1.34846em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.84846em;"><span class="" style="top: -4.04538em;"><span class="pstrut" style="height: 3.03692em;"></span><span class="mord"></span></span><span class="" style="top: -2.34846em;"><span class="pstrut" style="height: 3.03692em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.34846em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.84846em;"><span class="" style="top: -4.04538em;"><span class="pstrut" style="height: 3.03692em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span></span></span><span class="" style="top: -2.34846em;"><span class="pstrut" style="height: 3.03692em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">Var</span></span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.03692em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.34846em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 3.19692em; vertical-align: -1.34846em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 利用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          X(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>，可以将<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           S 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          S(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>改写为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
             
               S 
              
             
               ( 
              
             
               t 
              
             
               ) 
              
             
               = 
              
              
              
                s 
               
              
                0 
               
              
              
              
                e 
               
               
               
                 μ 
                
               
                 t 
                
               
              
             
               X 
              
             
               ( 
              
             
               t 
              
             
               ) 
              
             
            
            
            
            
              (2.3) 
             
            
           
          
         
           S(t)=s_0e^{\mu t}X(t)\tag{2.3} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.09356em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height: 1.09356em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 根据式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           2.2 
          
         
           ) 
          
         
        
          (2.2) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>，可以计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           S 
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
        
          S(t) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span>的期望与方差：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                 
                   E 
                  
                 
                   [ 
                  
                 
                   S 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   E 
                  
                  
                  
                    [ 
                   
                   
                   
                     s 
                    
                   
                     0 
                    
                   
                  
                    exp 
                   
                  
                    ⁡ 
                   
                   
                   
                     { 
                    
                    
                    
                      ( 
                     
                    
                      μ 
                     
                    
                      − 
                     
                     
                     
                       1 
                      
                     
                       2 
                      
                     
                     
                     
                       σ 
                      
                     
                       2 
                      
                     
                    
                      ) 
                     
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     σ 
                    
                   
                     W 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     } 
                    
                   
                  
                    ] 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                 
                   E 
                  
                  
                  
                    [ 
                   
                  
                    X 
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    ] 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                 
                
               
              
              
               
                
                 
                 
                   Var 
                  
                 
                   [ 
                  
                 
                   S 
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   E 
                  
                 
                   [ 
                  
                  
                  
                    S 
                   
                  
                    2 
                   
                  
                 
                   ( 
                  
                 
                   t 
                  
                 
                   ) 
                  
                 
                   ] 
                  
                 
                   − 
                  
                  
                   
                   
                     ( 
                    
                   
                     E 
                    
                   
                     [ 
                    
                   
                     S 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                     ) 
                    
                   
                  
                    2 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                 
                   E 
                  
                  
                  
                    [ 
                   
                   
                   
                     s 
                    
                   
                     0 
                    
                   
                     2 
                    
                   
                  
                    exp 
                   
                  
                    ⁡ 
                   
                   
                   
                     { 
                    
                   
                     2 
                    
                    
                    
                      ( 
                     
                    
                      μ 
                     
                    
                      − 
                     
                     
                     
                       1 
                      
                     
                       2 
                      
                     
                     
                     
                       σ 
                      
                     
                       2 
                      
                     
                    
                      ) 
                     
                    
                   
                     t 
                    
                   
                     + 
                    
                   
                     2 
                    
                   
                     σ 
                    
                   
                     W 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     } 
                    
                   
                  
                    ] 
                   
                  
                 
                   − 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                    2 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     2 
                    
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                    2 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     2 
                    
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                 
                   E 
                  
                  
                  
                    [ 
                   
                   
                   
                     X 
                    
                   
                     2 
                    
                   
                  
                    ( 
                   
                  
                    t 
                   
                  
                    ) 
                   
                  
                    ] 
                   
                  
                 
                   − 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                    2 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     2 
                    
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                    2 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     2 
                    
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                  
                  
                    ( 
                   
                  
                    Var 
                   
                   
                   
                     [ 
                    
                   
                     X 
                    
                   
                     ( 
                    
                   
                     t 
                    
                   
                     ) 
                    
                   
                     ] 
                    
                   
                  
                    + 
                   
                   
                    
                    
                      ( 
                     
                    
                      E 
                     
                    
                      [ 
                     
                    
                      X 
                     
                    
                      ( 
                     
                    
                      t 
                     
                    
                      ) 
                     
                    
                      ] 
                     
                    
                      ) 
                     
                    
                   
                     2 
                    
                   
                  
                    − 
                   
                  
                    1 
                   
                  
                    ) 
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   = 
                  
                  
                  
                    s 
                   
                  
                    0 
                   
                  
                    2 
                   
                  
                  
                  
                    e 
                   
                   
                   
                     2 
                    
                   
                     μ 
                    
                   
                     t 
                    
                   
                  
                  
                  
                    ( 
                   
                   
                   
                     e 
                    
                    
                     
                     
                       σ 
                      
                     
                       2 
                      
                     
                    
                      t 
                     
                    
                   
                  
                    − 
                   
                  
                    1 
                   
                  
                    ) 
                   
                  
                 
                
               
              
             
            
            
            
            
              (2.4) 
             
            
           
          
         
           \begin{aligned} \mathbb{E}[S(t)]&amp;=\mathbb{E}\left[s_0\exp\left\{\left(\mu-\frac12\sigma^2\right)t+\sigma W(t)\right\}\right]\\ &amp;=s_0e^{\mu t}\mathbb{E}\left[X(t)\right]\\ &amp;=s_0e^{\mu t}\\ \text{Var}[S(t)]&amp;=\mathbb{E}[S^2(t)]-\left(\mathbb{E}[S(t)]\right)^2\\ &amp;=\mathbb{E}\left[s_0^2\exp\left\{2\left(\mu-\frac12\sigma^2\right)t+2\sigma W(t)\right\}\right]-s_0^2e^{2\mu t}\\ &amp;=s_0^2e^{2\mu t}\mathbb{E}\left[X^2(t)\right]-s_0^2e^{2\mu t}\\ &amp;=s_0^2e^{2\mu t}\left(\text{Var}\left[X(t)\right]+\left(\mathbb{E}[X(t)]\right)^2-1\right)\\ &amp;=s_0^2e^{2\mu t}\left(e^{\sigma^2t}-1\right) \end{aligned}\tag{2.4} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 15.7453em; vertical-align: -7.62266em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 8.12266em;"><span class="" style="top: -10.1227em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span></span></span><span class="" style="top: -8.02908em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: -6.52552em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: -4.91151em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord text"><span class="mord">Var</span></span><span class="mopen">[</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span></span></span><span class="" style="top: -2.80151em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: -0.687376em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: 1.12262em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span><span class="" style="top: 3.22264em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 7.62266em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 8.12266em;"><span class="" style="top: -10.1227em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">2</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">}</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span><span class="" style="top: -8.02908em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span><span class="" style="top: -6.52552em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.843556em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -4.91151em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.80151em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">2</span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">}</span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -0.687376em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbb">E</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: 1.12262em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord text"><span class="mord">Var</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span class="mord mathbb">E</span></span><span class="mopen">[</span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.954008em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span><span class="" style="top: 3.22264em;"><span class="pstrut" style="height: 3.45em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.03692em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 7.62266em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 15.7453em; vertical-align: -7.62266em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 综上所述，式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           2.4 
          
         
           ) 
          
         
        
          (2.4) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span>即为所求。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ■ 
          
         
        
          \blacksquare 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.675em; vertical-align: 0em;"></span><span class="mord amsrm">■</span></span></span></span></span></p> </li></ul> 
<h4><a id="0612_1494"></a>06-12</h4> 
<blockquote> 
 <ul><li>现在让我们来看看hdm昨晚到底有多离谱，课前5分钟提示今晚考试，还要把剩下10各组的pre做完。时间显然很紧，于是她给出了70分钟讲10个组，90分钟考试的计划，也就是到8点40能下课。用脚趾头都能想出来怎么可能一个组7分钟，还组里每个人都必须讲。结果大部分组都讲到了双倍时间，直到八点才结束。本以为她放弃考试了，结果强行起考，还问我们谁不想考就举手（被自愿），然后考试形式也是离谱到家——论文精读，我被分到一篇40页的英文paper，只给两个小时看，然后按章节写提纲，最后还要总结论文的创新、优点和不足，花半小时过了一遍，剩下90分钟拼死拼活勉强写完。我就想知道碳基生物能想得出这种活？真就从头离谱到尾呗。</li><li>本来昨天见金言还没睡午觉又累又困，下课后我一肚子怒气无处泄，4’21"的配速出门随意乱跑，3km多莫名奇妙跑进了大学路，稍微平复了一些，可惜还要被人虐一条街，真的是艹了。</li><li>时隔半年，CSDN又开始征水文了，恰好可以把昨天跟老言子的事情拿来说说<a href="https://caoyang.blog.csdn.net/article/details/117846179" rel="nofollow">《纸短情长叹朝夕》</a>。</li></ul> 
</blockquote> 
<p>DOS（常用汇总）</p> 
<pre><code>cmd命令大全（第一部分）
　　winver---------检查Windows版本 
　　wmimgmt.msc----打开windows管理体系结构(WMI) 
　　wupdmgr--------windows更新程序 
　　wscript--------windows脚本宿主设置 
　　write----------写字板 
　　winmsd---------系统信息 
　　wiaacmgr-------扫描仪和照相机向导 
　　winchat--------XP自带局域网聊天
2
cmd命令大全（第二部分）
　　mem.exe--------显示内存使用情况 
　　Msconfig.exe---系统配置实用程序 
　　mplayer2-------简易widnows media player 
　　mspaint--------画图板 
　　mstsc----------远程桌面连接 
　　mplayer2-------媒体播放机 
　　magnify--------放大镜实用程序 
　　mmc------------打开控制台 
　　mobsync--------同步命令
3
cmd命令大全（第三部分）
　　dxdiag---------检查DirectX信息 
　　drwtsn32------ 系统医生 
　　devmgmt.msc--- 设备管理器 
　　dfrg.msc-------磁盘碎片整理程序 
　　diskmgmt.msc---磁盘管理实用程序 
　　dcomcnfg-------打开系统组件服务 
　　ddeshare-------打开DDE共享设置 
　　dvdplay--------DVD播放器
4
cmd命令大全（第四部分）
　　net stop messenger-----停止信使服务 
　　net start messenger----开始信使服务 
　　notepad--------打开记事本 
　　nslookup-------网络管理的工具向导 
　　ntbackup-------系统备份和还原 
　　narrator-------屏幕“讲述人” 
　　ntmsmgr.msc----移动存储管理器 
　　ntmsoprq.msc---移动存储管理员操作请求 
　　netstat -an----(TC)命令检查接口
5
cmd命令大全（第五部分）
　　syncapp--------创建一个公文包 
　　sysedit--------系统配置编辑器 
　　sigverif-------文件签名验证程序 
　　sndrec32-------录音机 
　　shrpubw--------创建共享文件夹 
　　secpol.m转载自电脑十万个为什么http://www.qq880.com，请保留此标记sc-----本地安全策略 
　　syskey---------系统加密，一旦加密就不能解开，保护windows xp系统的双重密码 
　　services.msc---本地服务设置 
　　Sndvol32-------音量控制程序 
　　sfc.exe--------系统文件检查器 
　　sfc /scannow---windows文件保护
6
cmd命令大全（第六部分）
　　tsshutdn-------60秒倒计时关机命令 
　　tourstart------xp简介（安装完成后出现的漫游xp程序） 
　　taskmgr--------任务管理器 
　　eventvwr-------事件查看器 
　　eudcedit-------造字程序 
　　explorer-------打开资源管理器 
　　packager-------对象包装程序 
　　perfmon.msc----计算机性能监测程序 
　　progman--------程序管理器 
　　regedit.exe----注册表 
　　rsop.msc-------组策略结果集 
　　regedt32-------注册表编辑器 
　　rononce -p ----15秒关机 
　　regsvr32 /u *.dll----停止dll文件运行 
　　regsvr32 /u zipfldr.dll------取消ZIP支持
7
cmd命令大全（第七部分）
　　cmd.exe--------CMD命令提示符 
　　chkdsk.exe-----Chkdsk磁盘检查 
　　certmgr.msc----证书管理实用程序 
　　calc-----------启动计算器 
　　charmap--------启动字符映射表 
　　cliconfg-------SQL SERVER 客户端网络实用程序 
　　Clipbrd--------剪贴板查看器 
　　conf-----------启动netmeeting 
　　compmgmt.msc---计算机管理 
　　cleanmgr-------垃圾整理 
　　ciadv.msc------索引服务程序 
　　osk------------打开屏幕键盘 
　　odbcad32-------ODBC数据源管理器 
　　oobe/msoobe /a----检查XP是否激活 
　　lusrmgr.msc----本机用户和组 
　　logoff---------注销命令 
　　iexpress-------木马捆绑工具，系统自带 
　　Nslookup-------IP地址侦测器 
　　fsmgmt.msc-----共享文件夹管理器 
　　utilman--------辅助工具管理器 
　　gpedit.msc-----组策略
</code></pre> 
<h4><a id="0613_1597"></a>06-13</h4> 
<blockquote> 
 <ul><li>感冒加重了，隐隐还有点发烧，特别糟糕的情况。山楂树？</li><li>怎么还能碰得到？而且，时隔一阵子，怎么又取消拉黑我了呢？胃疼，矛盾，无厘头。</li><li>从5月1日开始没有断过的跑步，被迫要停一天了，状态掉落到冰点，咳嗽带着头也开始疼，感觉学校里有不少人感冒，可能是有流感了。</li><li>晚上看到那个体育生在光着上身在裸奔，我跟了1km实在是状态太差，感觉自己有快两年没感冒发烧过了，真是倒大霉了。</li><li>明天王凯来沪，吃个饭正好晚上一起去外滩看个点灯，这么多年我还一次没去看过。</li></ul> 
</blockquote> 
<p>抓取PDF中图片的小脚本：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy
<span class="token keyword">from</span> PyPDF2 <span class="token keyword">import</span> PdfFileReader<span class="token punctuation">,</span> PdfFileWriter

<span class="token keyword">def</span> <span class="token function">parse_pdf_images</span><span class="token punctuation">(</span>import_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>import_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pdf<span class="token punctuation">:</span>
		reader <span class="token operator">=</span> PdfFileReader<span class="token punctuation">(</span>pdf<span class="token punctuation">)</span>
		<span class="token keyword">for</span> number <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>getNumPages<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			page <span class="token operator">=</span> reader<span class="token punctuation">.</span>getPage<span class="token punctuation">(</span>number<span class="token punctuation">)</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Page {}:'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span>
			x_object <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'/Resources'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/XObject'</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> x_object <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> 
				<span class="token keyword">continue</span>
			<span class="token keyword">for</span> key <span class="token keyword">in</span> x_object<span class="token punctuation">:</span>
				<span class="token keyword">if</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Subtype'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/Image'</span><span class="token punctuation">:</span>
					size <span class="token operator">=</span> <span class="token punctuation">(</span>x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Width'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Height'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
					data <span class="token operator">=</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>getData<span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">if</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/ColorSpace'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/DeviceRGB'</span><span class="token punctuation">:</span>
						mode <span class="token operator">=</span> <span class="token string">'RGB'</span>
					<span class="token keyword">else</span><span class="token punctuation">:</span>
						mode <span class="token operator">=</span> <span class="token string">'P'</span>	
					image <span class="token operator">=</span> numpy<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>data<span class="token punctuation">,</span> numpy<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>	
					<span class="token keyword">print</span><span class="token punctuation">(</span>x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Filter'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	

					<span class="token keyword">if</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Filter'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/FlateDecode'</span><span class="token punctuation">:</span>
						<span class="token keyword">print</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>
						<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
						image <span class="token operator">=</span> image<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
						cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'page'</span> <span class="token operator">+</span> <span class="token string">'%05ui'</span> <span class="token operator">%</span> number <span class="token operator">+</span> <span class="token string">'key'</span> <span class="token operator">+</span> key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
					<span class="token keyword">elif</span> x_object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Filter'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/DCTDecode'</span><span class="token punctuation">:</span>
						cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
					<span class="token keyword">elif</span> xObject<span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'/Filter'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/JPXDecode'</span><span class="token punctuation">:</span>
						cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0614_1646"></a>06-14</h4> 
<blockquote> 
 <ul><li>想做就去做呗，反正某人现在不也没课没考试了，想谈恋爱又嫌麻烦。现在我觉得所有的胡思乱想都可以归结于太闲（虽然我现在也没资格这么评判别人）。</li><li>星巴克约了下午茶后，晚上请王凯去悦荟吃了个烤肉（其实就是我自己想吃了，我都好久没出去吃了），顺道去外滩看了个亮灯。颜烨，金言，王凯三人的处事风格相异甚远，但是都已经取得了阶段性的成功（入职阿里，赴美留学，考取复旦），事实上我与他们任何一人的处事风格都不相同，所以我又能走到哪里呢？</li><li>中午找到了救命的头孢克肟，不然我可能真的是要不行了。一天走了将近两万步，晚归疲累到极致，但还是进场跑了五圈，4’34"的配速，近一年多以来可能是最差的状态了。等感冒痊愈，再从头开始练罢。</li></ul> 
</blockquote> 
<p>gpytorch的一个小demo（原谅我最近啥有意义的事情也没做，周末赶完hdm8000字的paper，今天又出去晃了半天，只能拿以前的存货来顶了）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> math

<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> gpytorch
<span class="token keyword">from</span> gpytorch <span class="token keyword">import</span> kernels<span class="token punctuation">,</span> means<span class="token punctuation">,</span> models<span class="token punctuation">,</span> mlls<span class="token punctuation">,</span> settings
<span class="token keyword">from</span> gpytorch <span class="token keyword">import</span> distributions <span class="token keyword">as</span> distr


<span class="token keyword">from</span> IPython<span class="token punctuation">.</span>display <span class="token keyword">import</span> Markdown<span class="token punctuation">,</span> display
<span class="token keyword">def</span> <span class="token function">printmd</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span>

train_x <span class="token operator">=</span> torch<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> torch<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>train_x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>train_x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.2</span>

<span class="token comment"># We will use the simplest form of GP model, exact inference</span>
<span class="token keyword">class</span> <span class="token class-name">ExactGPModel</span><span class="token punctuation">(</span>gpytorch<span class="token punctuation">.</span>models<span class="token punctuation">.</span>ExactGP<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>ExactGPModel<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mean_module <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>means<span class="token punctuation">.</span>ConstantMean<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>covar_module <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>kernels<span class="token punctuation">.</span>ScaleKernel<span class="token punctuation">(</span>gpytorch<span class="token punctuation">.</span>kernels<span class="token punctuation">.</span>RBFKernel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mean_x <span class="token operator">=</span> self<span class="token punctuation">.</span>mean_module<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        covar_x <span class="token operator">=</span> self<span class="token punctuation">.</span>covar_module<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> gpytorch<span class="token punctuation">.</span>distributions<span class="token punctuation">.</span>MultivariateNormal<span class="token punctuation">(</span>mean_x<span class="token punctuation">,</span> covar_x<span class="token punctuation">)</span>

<span class="token comment"># initialize likelihood and model</span>
likelihood <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>likelihoods<span class="token punctuation">.</span>GaussianLikelihood<span class="token punctuation">(</span><span class="token punctuation">)</span>
model <span class="token operator">=</span> ExactGPModel<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>

<span class="token keyword">for</span> param_name<span class="token punctuation">,</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Parameter name: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>param_name<span class="token punctuation">:</span><span class="token format-spec">42</span><span class="token punctuation">}</span></span><span class="token string"> value = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>param<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

raw_outputscale <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'raw_outputscale, '</span><span class="token punctuation">,</span> raw_outputscale<span class="token punctuation">)</span>

<span class="token comment"># Three ways of accessing the raw outputscale constraint</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nraw_outputscale_constraint1'</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale_constraint<span class="token punctuation">)</span>

printmd<span class="token punctuation">(</span><span class="token string">'\n\n**Printing all model constraints...**\n'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> constraint_name<span class="token punctuation">,</span> constraint <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_constraints<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Constraint name: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>constraint_name<span class="token punctuation">:</span><span class="token format-spec">55</span><span class="token punctuation">}</span></span><span class="token string"> constraint = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>constraint<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

printmd<span class="token punctuation">(</span><span class="token string">'\n**Getting raw outputscale constraint from model...**'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>constraint_for_parameter_name<span class="token punctuation">(</span><span class="token string">"covar_module.raw_outputscale"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


printmd<span class="token punctuation">(</span><span class="token string">'\n**Getting raw outputscale constraint from model.covar_module...**'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>constraint_for_parameter_name<span class="token punctuation">(</span><span class="token string">"raw_outputscale"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

raw_outputscale <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale
constraint <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale_constraint

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Transformed outputscale'</span><span class="token punctuation">,</span> constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_outputscale<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>constraint<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_outputscale<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>constraint<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_outputscale<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> raw_outputscale<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Transform a bunch of negative tensors: '</span><span class="token punctuation">,</span> constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Recreate model to reset outputscale</span>
model <span class="token operator">=</span> ExactGPModel<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>

<span class="token comment"># Inconvenient way of getting true outputscale</span>
raw_outputscale <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale
constraint <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale_constraint
outputscale <span class="token operator">=</span> constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_outputscale<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Actual outputscale: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>outputscale<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># Inconvenient way of setting true outputscale</span>
model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fill_<span class="token punctuation">(</span>constraint<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
raw_outputscale <span class="token operator">=</span> model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>raw_outputscale
outputscale <span class="token operator">=</span> constraint<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>raw_outputscale<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Actual outputscale after setting: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>outputscale<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># Recreate model to reset outputscale</span>
model <span class="token operator">=</span> ExactGPModel<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>

<span class="token comment"># Convenient way of getting true outputscale</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Actual outputscale: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>outputscale<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># Convenient way of setting true outputscale</span>
model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>outputscale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Actual outputscale after setting: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>outputscale<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Actual noise value: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>likelihood<span class="token punctuation">.</span>noise<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Noise constraint: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>raw_noise_constraint<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

likelihood <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>likelihoods<span class="token punctuation">.</span>GaussianLikelihood<span class="token punctuation">(</span>noise_constraint<span class="token operator">=</span>gpytorch<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span>GreaterThan<span class="token punctuation">(</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Noise constraint: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>raw_noise_constraint<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment">## Changing the constraint after the module has been created</span>
likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>register_constraint<span class="token punctuation">(</span><span class="token string">"raw_noise"</span><span class="token punctuation">,</span> gpytorch<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span>Positive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Noise constraint: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>raw_noise_constraint<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>



<span class="token comment"># Registers a prior on the sqrt of the noise parameter</span>
<span class="token comment"># (e.g., a prior for the noise standard deviation instead of variance)</span>
likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>register_prior<span class="token punctuation">(</span>
    <span class="token string">"noise_std_prior"</span><span class="token punctuation">,</span>
    gpytorch<span class="token punctuation">.</span>priors<span class="token punctuation">.</span>NormalPrior<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">lambda</span> module<span class="token punctuation">:</span> module<span class="token punctuation">.</span>noise<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment"># Create a GaussianLikelihood with a normal prior for the noise</span>
likelihood <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>likelihoods<span class="token punctuation">.</span>GaussianLikelihood<span class="token punctuation">(</span>
    noise_constraint<span class="token operator">=</span>gpytorch<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span>GreaterThan<span class="token punctuation">(</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    noise_prior<span class="token operator">=</span>gpytorch<span class="token punctuation">.</span>priors<span class="token punctuation">.</span>NormalPrior<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment"># We will use the simplest form of GP model, exact inference</span>
<span class="token keyword">class</span> <span class="token class-name">FancyGPWithPriors</span><span class="token punctuation">(</span>gpytorch<span class="token punctuation">.</span>models<span class="token punctuation">.</span>ExactGP<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>FancyGPWithPriors<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mean_module <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>means<span class="token punctuation">.</span>ConstantMean<span class="token punctuation">(</span><span class="token punctuation">)</span>

        lengthscale_prior <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>priors<span class="token punctuation">.</span>GammaPrior<span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">6.0</span><span class="token punctuation">)</span>
        outputscale_prior <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>priors<span class="token punctuation">.</span>GammaPrior<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>covar_module <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>kernels<span class="token punctuation">.</span>ScaleKernel<span class="token punctuation">(</span>
            gpytorch<span class="token punctuation">.</span>kernels<span class="token punctuation">.</span>RBFKernel<span class="token punctuation">(</span>
                lengthscale_prior<span class="token operator">=</span>lengthscale_prior<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            outputscale_prior<span class="token operator">=</span>outputscale_prior
        <span class="token punctuation">)</span>

        <span class="token comment"># Initialize lengthscale and outputscale to mean of priors</span>
        self<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>base_kernel<span class="token punctuation">.</span>lengthscale <span class="token operator">=</span> lengthscale_prior<span class="token punctuation">.</span>mean
        self<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>outputscale <span class="token operator">=</span> outputscale_prior<span class="token punctuation">.</span>mean

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mean_x <span class="token operator">=</span> self<span class="token punctuation">.</span>mean_module<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        covar_x <span class="token operator">=</span> self<span class="token punctuation">.</span>covar_module<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> gpytorch<span class="token punctuation">.</span>distributions<span class="token punctuation">.</span>MultivariateNormal<span class="token punctuation">(</span>mean_x<span class="token punctuation">,</span> covar_x<span class="token punctuation">)</span>

likelihood <span class="token operator">=</span> gpytorch<span class="token punctuation">.</span>likelihoods<span class="token punctuation">.</span>GaussianLikelihood<span class="token punctuation">(</span>
    noise_constraint<span class="token operator">=</span>gpytorch<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span>GreaterThan<span class="token punctuation">(</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

model <span class="token operator">=</span> FancyGPWithPriors<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> likelihood<span class="token punctuation">)</span>

hypers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'likelihood.noise_covar.noise'</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'covar_module.base_kernel.lengthscale'</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'covar_module.outputscale'</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

model<span class="token punctuation">.</span>initialize<span class="token punctuation">(</span><span class="token operator">**</span>hypers<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>
    model<span class="token punctuation">.</span>likelihood<span class="token punctuation">.</span>noise_covar<span class="token punctuation">.</span>noise<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>base_kernel<span class="token punctuation">.</span>lengthscale<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    model<span class="token punctuation">.</span>covar_module<span class="token punctuation">.</span>outputscale<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0615_1812"></a>06-15</h4> 
<blockquote> 
 <ul><li>看来我昨天还是应该再外滩多留一会儿的，后来确实是有认识的人来的，可惜阿凯要赶火车，而且自己有点脱力，一个人留下不是很明智，关键是今天要考试…</li><li>既然躲不掉，那还是欣然接受罢，取个快递也能碰到。</li><li>卷子发下来，七道大题考了五条半的原题，以为稳了。笑死，根本写（抄）不完，出来问刘天浩情况如何（我其实从来不考完问人题目，但是这次是真的被恶心了），都一样，第一题抄了半小时，结果就开始发慌，后面越做（抄）越急，多出来的那题动态规划，我就不信有人能在4张答题纸上写完所有步骤，到目前为止考得最让我反胃的一门。本来下午复习完胸有成竹，感觉全都弄明白了，考试，考个屁。</li></ul> 
</blockquote> 
<p>重要的几个矩母函数结论（我感觉晚上会用到…）</p> 
<ul><li> <p>设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            M 
           
          
            X 
           
          
         
           ( 
          
         
           t 
          
         
           ) 
          
         
           = 
          
         
           E 
          
          
          
            [ 
           
           
           
             e 
            
            
            
              t 
             
            
              X 
             
            
           
          
            ] 
           
          
         
        
          M_X(t)=E\left[e^{tX}\right] 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.20001em; vertical-align: -0.35001em;"></span><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span>，则：</p> 
  <ol><li> <p>若<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             X 
            
           
             ∼ 
            
           
             Γ 
            
           
             ( 
            
           
             α 
            
           
             , 
            
           
             β 
            
           
             ) 
            
           
          
            X\sim \Gamma(\alpha,\beta) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Γ</span><span class="mopen">(</span><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="mclose">)</span></span></span></span></span>，有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              M 
             
            
              X 
             
            
           
             ( 
            
           
             t 
            
           
             ) 
            
           
             = 
            
            
            
              1 
             
             
             
               ( 
              
             
               1 
              
             
               − 
              
             
               β 
              
             
               t 
              
              
              
                ) 
               
              
                α 
               
              
             
            
           
          
            M_X(t)=\frac1{(1-\beta t)^\alpha} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.36511em; vertical-align: -0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span style="margin-right: 0.05278em;" class="mord mathdefault mtight">β</span><span class="mord mathdefault mtight">t</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.593543em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right: 0.0037em;" class="mord mathdefault mtight">α</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             t 
            
           
             &lt; 
            
            
            
              1 
             
            
              β 
             
            
           
          
            t&lt;\frac1\beta 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65418em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.32622em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.05278em;" class="mord mathdefault mtight">β</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> </li><li> <p>若<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             X 
            
           
             ∼ 
            
            
            
              X 
             
            
              2 
             
            
           
             ( 
            
           
             n 
            
           
             ) 
            
           
          
            X\sim \mathcal{X}^2(n) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.14643em;" class="mord mathcal">X</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>，有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              M 
             
            
              X 
             
            
           
             ( 
            
           
             t 
            
           
             ) 
            
           
             = 
            
            
            
              1 
             
             
             
               ( 
              
             
               1 
              
             
               − 
              
             
               2 
              
             
               t 
              
              
              
                ) 
               
               
               
                 n 
                
               
                 2 
                
               
              
             
            
           
          
            M_X(t)=\frac1{(1-2t)^\frac n2} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.58031em; vertical-align: -0.735205em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.4398em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight">2</span><span class="mord mathdefault mtight">t</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.07172em;"><span class="" style="top: -3.48775em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.81756em;"><span class="" style="top: -2.468em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mtight">2</span></span><span class="" style="top: -3.2255em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em;"></span></span><span class="" style="top: -3.387em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault mtight">n</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.532em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.735205em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             t 
            
           
             &lt; 
            
            
            
              1 
             
            
              2 
             
            
           
          
            t&lt;\frac12 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65418em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> </li><li> <p>若<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             X 
            
           
             ∼ 
            
           
             N 
            
           
             ( 
            
           
             μ 
            
           
             , 
            
            
            
              σ 
             
            
              2 
             
            
           
             ) 
            
           
          
            X\sim N(\mu,\sigma^2) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">N</span><span class="mopen">(</span><span class="mord mathdefault">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              M 
             
            
              X 
             
            
           
             ( 
            
           
             t 
            
           
             ) 
            
           
             = 
            
            
            
              e 
             
             
             
               μ 
              
             
               t 
              
             
               + 
              
              
               
               
                 σ 
                
               
                 2 
                
               
              
                2 
               
              
              
              
                t 
               
              
                2 
               
              
             
            
           
          
            M_X(t)=e^{\mu t+\frac{\sigma^2}2t^2} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.15602em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.15602em;"><span class="" style="top: -3.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">μ</span><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.13289em;"><span class="" style="top: -2.656em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.2255em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em;"></span></span><span class="" style="top: -3.384em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.04844em;"><span class="" style="top: -3.04844em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.64444em;"></span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> </li><li> <p>若<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             X 
            
           
             ∼ 
            
           
             Exp 
            
           
             ( 
            
           
             λ 
            
           
             ) 
            
           
          
            X\sim \text{Exp}(\lambda) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">Exp</span></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mclose">)</span></span></span></span></span>，有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
            
            
              M 
             
            
              X 
             
            
           
             ( 
            
           
             t 
            
           
             ) 
            
           
             = 
            
            
            
              1 
             
             
             
               1 
              
             
               − 
              
             
               λ 
              
             
               t 
              
             
            
           
          
            M_X(t)=\frac1{1-\lambda t} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.07847em;" class="mord mathdefault mtight">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.24844em; vertical-align: -0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">λ</span><span class="mord mathdefault mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.403331em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             t 
            
           
             &lt; 
            
            
            
              1 
             
            
              λ 
             
            
           
          
            t&lt;\frac1\lambda 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65418em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">λ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> </li></ol> </li></ul> 
<p>对于CTMC（连续时间马尔可夫链）的仿真，之前的做法似乎有点不妥，之前一直是选择划分很小的时间间隔，然后等于化解成离散的MC来做，但是其实应该是以每个下一状态的转移率每次去生成指数分布的变量，然后看哪个变量最小就转移到哪个状态，然后时间递增这个指数分布的变量即可。这样就大大地减少了仿真地复杂度，尤其是时间间隔取得太小容易导致内存溢出。怎么以前这么蠢呢，见鬼地<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         LTH 
        
       
      
        \text{LTH} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">LTH</span></span></span></span></span></span>也没想过可以这么做，每次傻兮兮地取个1e-6的时间间隔，要跑上几个小时。</p> 
<h4><a id="0616_1831"></a>06-16</h4> 
<blockquote> 
 <ul><li>早起外面好凉快，但是明天的运筹闭卷，是要拼命的一天… 明早考完再跑了。搞了条三分紧身运动裤，昨晚穿上试跑了一下，挺不错，可惜感冒没好状态还是不行，希望明天感冒能好，能有个好天气罢。</li><li>午饭后感觉实在是太凉快了，不忍错过。进场冲了3km，均配4’01"，破了之前3km的最好成绩，涅槃重生，满血复活，痛快！明天如果还能这么凉快，就去冲10km pb吧，</li><li>闭关一日。昨晚考完难得孙蜀和颜烨都在学校，之后一个去北京，一个去杭州，其实应该跟他们出去喝一杯的，可惜感冒没好，而且要复习，越来越难以两全。天佑明天运筹考的全会（写得全对我就不指望了，反正会就够了，这学期懒得看成绩了，随缘，真的争不动了，考原题真的一点意思没有）。</li></ul> 
</blockquote> 
<p>介绍一个很有趣的概念：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span></p> 
<p>什么样的矩阵可以称为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>呢？即这个矩阵（不要求必须方阵）的所有子方阵（即任取<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span></span></span></span></span>行<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span></span></span></span></span>列构成的阵，取的行列不必连续）的行列式为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         0 
        
       
      
        0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>或<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ± 
        
       
         1 
        
       
      
        \pm1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">±</span><span class="mord">1</span></span></span></span></span>。</p> 
<p>根据上面的定义，容易看出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>的必要条件是矩阵中所有元素的取值为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         0 
        
       
      
        0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>或<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ± 
        
       
         1 
        
       
      
        \pm1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">±</span><span class="mord">1</span></span></span></span></span>，因为单取一个元素也是一个子方阵。</p> 
<p>看起来判定一个矩阵是否属于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>还是很麻烦的，因为子方阵的数量非常多，以<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span>阶方阵为例，子方阵的数量为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         1 
        
       
         + 
        
       
         4 
        
       
         + 
        
       
         9 
        
       
         + 
        
       
         . 
        
       
         . 
        
       
         . 
        
       
         + 
        
        
        
          n 
         
        
          2 
         
        
       
         = 
        
        
        
          1 
         
        
          6 
         
        
       
         n 
        
       
         ( 
        
       
         n 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
         ( 
        
       
         2 
        
       
         n 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
      
        1+4+9+...+n^2=\frac16n(n+1)(2n+1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">4</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">9</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>个，每个都检查一遍显然是太慢了，不过我们有下面的定理：</p> 
<blockquote> 
 <p><font face="楷体"><strong>定理</strong>：一个仅由<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           0 
          
         
           , 
          
         
           ± 
          
         
           1 
          
         
        
          0,\pm1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">±</span><span class="mord">1</span></span></span></span></span>构成的矩阵是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           totally unimodular matrix 
          
         
        
          \text{totally unimodular matrix} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>，当且仅当它的每一列（行）至多包含一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           1 
          
         
        
          1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>，且每一列（行）至多包含一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           − 
          
         
           1 
          
         
        
          -1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">−</span><span class="mord">1</span></span></span></span></span>。</font></p> 
</blockquote> 
<p>反向的证明非常容易，可以用数学归纳法，然后用行列式的主子式展开即可。正向相对麻烦一些，但是你可以相信它是正确的。</p> 
<p>为什么要提<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>的概念，因为它具有一个非常良好的性质：</p> 
<blockquote> 
 <p><font face="楷体"><strong>定理</strong>：若矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
           ∈ 
          
          
          
            R 
           
           
           
             m 
            
           
             × 
            
           
             n 
            
           
          
         
        
          A\in\R^{m\times n} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72243em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.771331em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           totally unimodular matrix 
          
         
        
          \text{totally unimodular matrix} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>且<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           b 
          
         
           ∈ 
          
          
          
            R 
           
          
            m 
           
          
         
        
          b\in\R^{m} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span></span></span>为一个整数向量，则集合<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           { 
          
         
           x 
          
         
           ∣ 
          
         
           A 
          
         
           x 
          
         
           = 
          
         
           b 
          
         
           , 
          
         
           x 
          
         
           ≥ 
          
         
           0 
          
         
           } 
          
         
        
          \{x|Ax=b,x\ge0\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">0</span><span class="mclose">}</span></span></span></span></span>中每一个向量都是整数向量。</font></p> 
</blockquote> 
<p>这个性质意味着<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>对于整数规划意义重大，因为形如<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         x 
        
       
         = 
        
       
         b 
        
       
         , 
        
       
         x 
        
       
         ≥ 
        
       
         0 
        
       
      
        Ax=b,x\ge0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>的线性约束下，总是可以得到整数解。</p> 
<p>一个非常经典的应用案例就是最大流（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         A 
        
       
         X 
        
       
         F 
        
       
         L 
        
       
         O 
        
       
         W 
        
       
      
        \rm MAXFLOW 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">A</span><span class="mord mathrm">X</span><span class="mord mathrm">F</span><span class="mord mathrm">L</span><span class="mord mathrm">O</span><span style="margin-right: 0.01389em;" class="mord mathrm">W</span></span></span></span></span></span>）问题，定义矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         = 
        
        
        
          R 
         
         
         
           ∣ 
          
         
           V 
          
         
           ∣ 
          
         
           × 
          
         
           ∣ 
          
         
           E 
          
         
           ∣ 
          
         
        
       
      
        A=\R^{|V|\times|E|} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.888em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span style="margin-right: 0.22222em;" class="mord mathdefault mtight">V</span><span class="mord mtight">∣</span><span class="mbin mtight">×</span><span class="mord mtight">∣</span><span style="margin-right: 0.05764em;" class="mord mathdefault mtight">E</span><span class="mord mtight">∣</span></span></span></span></span></span></span></span></span></span></span></span></span>：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
          = 
         
        
          { 
         
         
         
           a 
          
          
          
            i 
           
          
            j 
           
          
         
        
          } 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
             
            
            
             
              
               
              
                1 
               
              
             
            
            
             
              
             
            
            
             
              
               
              
                if edge  
               
              
                j 
               
              
                 starts from node  
               
              
                i 
               
              
             
            
           
           
            
             
              
             
            
            
             
              
               
              
                − 
               
              
                1 
               
              
             
            
            
             
              
             
            
            
             
              
               
              
                if edge  
               
              
                j 
               
              
                 ends to node  
               
              
                i 
               
              
             
            
           
           
            
             
              
             
            
            
             
              
               
              
                0 
               
              
             
            
            
             
              
             
            
            
             
              
               
              
                otherwise 
               
              
             
            
           
          
         
        
       
         A=\{a_{ij}\}=\left\{\begin{aligned} &amp;1&amp;&amp;\text{if edge }j\text{ starts from node }i\\ &amp;-1&amp;&amp;\text{if edge }j\text{ ends to node }i\\ &amp;0&amp;&amp;\text{otherwise}\\ \end{aligned}\right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.5em; vertical-align: -2em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.35002em;"><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.85002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.5em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -1.5em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord">1</span></span></span><span class="" style="top: -3.16em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">1</span></span></span><span class="" style="top: -1.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.5em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -1.5em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if edge </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mord text"><span class="mord"> starts from node </span></span><span class="mord mathdefault">i</span></span></span><span class="" style="top: -3.16em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">if edge </span></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span><span class="mord text"><span class="mord"> ends to node </span></span><span class="mord mathdefault">i</span></span></span><span class="" style="top: -1.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">otherwise</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>则最大流问题可以用线性规划建模：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          maximize 
         
         
         
         
           ∑ 
          
          
          
            j 
           
          
            : 
           
          
            ( 
           
          
            s 
           
          
            , 
           
          
            j 
           
          
            ) 
           
          
            ∈ 
           
          
            E 
           
          
         
         
         
           x 
          
          
          
            s 
           
          
            j 
           
          
         
        
          − 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            : 
           
          
            ( 
           
          
            i 
           
          
            , 
           
          
            s 
           
          
            ) 
           
          
            ∈ 
           
          
            E 
           
          
         
         
         
           x 
          
          
          
            i 
           
          
            s 
           
          
         
         
        
          subject to 
         
         
         
         
           A 
          
         
           ˉ 
          
         
        
          x 
         
        
          = 
         
        
          0 
         
         
         
        
          0 
         
        
          ≤ 
         
         
         
           x 
          
          
          
            i 
           
          
            j 
           
          
         
        
          ≤ 
         
         
         
           c 
          
          
          
            i 
           
          
            j 
           
          
         
         
        
          ∀ 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
       
         \text{maximize}\quad\sum_{j:(s,j)\in E}x_{sj}-\sum_{i:(i,s)\in E}x_{is}\\ \text{subject to}\quad \bar Ax=0\\ \quad 0\le x_{ij}\le c_{ij}\quad \forall i,j 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mord text"><span class="mord">maximize</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.809em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span><span class="mrel mtight">:</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">s</span><span class="mpunct mtight">,</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right: 0.05764em;" class="mord mathdefault mtight">E</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.809em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">:</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right: 0.05764em;" class="mord mathdefault mtight">E</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 1.01455em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">subject to</span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.82011em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">A</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.11111em;">ˉ</span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.78041em; vertical-align: -0.13597em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.922078em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord">∀</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span></span></span></span></span></span></p> 
<p>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          A 
         
        
          ˉ 
         
        
       
      
        \bar A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.82011em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.82011em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">A</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.11111em;">ˉ</span></span></span></span></span></span></span></span></span></span>是在矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
      
        A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>中删除<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         , 
        
       
         t 
        
       
      
        s,t 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.80952em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">t</span></span></span></span></span>两个节点所在行后的结果。</p> 
<p>显然<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          A 
         
        
          ˉ 
         
        
       
      
        \bar A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.82011em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.82011em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">A</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.11111em;">ˉ</span></span></span></span></span></span></span></span></span></span>是一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>，关键是下面还有个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         0 
        
       
         ≤ 
        
        
        
          x 
         
         
         
           i 
          
         
           j 
          
         
        
       
         ≤ 
        
        
        
          c 
         
         
         
           i 
          
         
           j 
          
         
        
        
       
         ∀ 
        
       
         i 
        
       
         , 
        
       
         j 
        
       
      
        0\le x_{ij}\le c_{ij}\quad \forall i,j 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.78041em; vertical-align: -0.13597em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.922078em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord">∀</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span></span></span></span></span>的约束，这个其实可以添加松弛变量<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          s 
         
         
         
           i 
          
         
           j 
          
         
        
       
      
        s_{ij} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>来解决，最终的标准形式就是：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          maximize 
         
         
         
         
           ∑ 
          
          
          
            j 
           
          
            : 
           
          
            ( 
           
          
            s 
           
          
            , 
           
          
            j 
           
          
            ) 
           
          
            ∈ 
           
          
            E 
           
          
         
         
         
           x 
          
          
          
            s 
           
          
            j 
           
          
         
        
          − 
         
         
         
           ∑ 
          
          
          
            i 
           
          
            : 
           
          
            ( 
           
          
            i 
           
          
            , 
           
          
            s 
           
          
            ) 
           
          
            ∈ 
           
          
            E 
           
          
         
         
         
           x 
          
          
          
            i 
           
          
            s 
           
          
         
         
        
          subject to 
         
         
         
         
           [ 
          
          
           
            
             
              
              
                A 
               
              
                ˉ 
               
              
             
            
            
             
             
               0 
              
             
            
           
           
            
             
             
               I 
              
             
            
            
             
             
               I 
              
             
            
           
          
         
           ] 
          
         
         
         
           [ 
          
          
           
            
             
             
               X 
              
             
            
           
           
            
             
             
               S 
              
             
            
           
          
         
           ] 
          
         
        
          = 
         
         
         
           [ 
          
          
           
            
             
             
               0 
              
             
            
           
           
            
             
             
               C 
              
             
            
           
          
         
           ] 
          
         
         
         
         
         
           x 
          
          
          
            i 
           
          
            j 
           
          
         
        
          ≥ 
         
        
          0 
         
         
        
          ∀ 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
       
         \text{maximize}\quad\sum_{j:(s,j)\in E}x_{sj}-\sum_{i:(i,s)\in E}x_{is}\\ \text{subject to}\quad \left[\begin{matrix}\bar A&amp;0\\I&amp;I\end{matrix}\right]\left[\begin{matrix}X\\S\end{matrix}\right]=\left[\begin{matrix}0\\C\end{matrix}\right]\\ \quad x_{ij}\ge0 \quad \forall i,j 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mord text"><span class="mord">maximize</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.809em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span><span class="mrel mtight">:</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">s</span><span class="mpunct mtight">,</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right: 0.05764em;" class="mord mathdefault mtight">E</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.809em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">:</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right: 0.05764em;" class="mord mathdefault mtight">E</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="mord text"><span class="mord">subject to</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.82011em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">A</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.11111em;">ˉ</span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07153em;" class="mord mathdefault">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.922078em; vertical-align: -0.286108em;"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.05724em;" class="mord mathdefault mtight">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 1em;"></span><span class="mord">∀</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.05724em;" class="mord mathdefault">j</span></span></span></span></span></span></p> 
<p>显然<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
        
         
          
           
            
            
              A 
             
            
              ˉ 
             
            
           
          
          
           
           
             0 
            
           
          
         
         
          
           
           
             I 
            
           
          
          
           
           
             I 
            
           
          
         
        
       
         ] 
        
       
      
        \left[\begin{matrix}\bar A&amp;0\\I&amp;I\end{matrix}\right] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.82011em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">A</span></span><span class="" style="top: -3.25233em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.11111em;">ˉ</span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span>仍然是一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         totally unimodular matrix 
        
       
      
        \text{totally unimodular matrix} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">totally unimodular matrix</span></span></span></span></span></span>，所以就可以套用上面的性质了，这也就是为什么如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         C 
        
       
      
        C 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07153em;" class="mord mathdefault">C</span></span></span></span></span>是整数向量（即网络流中的所有边的容量都为整数），则一定有一个整数的最大流解。</p> 
<h4><a id="0617_1882"></a>06-17</h4> 
<blockquote> 
 <ul><li>运筹感觉考得一般，没有达到预期，但也算差强人意。最后一门考试还有很久，可以休息一阵子了。</li><li>午饭看到sxy，结果我不是那么确信（总感觉头发没那么短…），怕认错就没打个招呼，最近眼神不行，还菜得真实。</li><li>5月1日跑出44’08"的10km后，今天是第二次冲击44分以内（上一次6月3日冲到8km熄火，不过跑出了8km的pb）还是失败了，主要4~6km时突然下大雨，节奏乱了，T恤湿透贴着特别难受。自己也确实很久不练长距离了，水平掉太多，最后跑到45分出头，还需努力，这种状态下半年是跑不了半马的。</li></ul> 
</blockquote> 
<p>关于凸函数的一个等价定义（比较有趣的表达形式，今天考到了）：</p> 
<p>函数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         : 
        
       
         R 
        
       
         → 
        
       
         R 
        
       
      
        f:\R\rightarrow\R 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span></span></span></span></span>的定义域<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         dom 
        
       
         ( 
        
       
         f 
        
       
         ) 
        
       
      
        \textbf{dom}(f) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord textbf">dom</span></span><span class="mopen">(</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mclose">)</span></span></span></span></span>是一个凸集，则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
      
        f 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span></span></span></span></span>是凸函数当且仅当<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∀ 
        
       
         x 
        
       
         , 
        
       
         y 
        
       
         , 
        
       
         z 
        
       
         ∈ 
        
       
         dom 
        
       
         ( 
        
       
         f 
        
       
         ) 
        
       
      
        \forall x,y,z\in\textbf{dom}(f) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord">∀</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.04398em;" class="mord mathdefault">z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord textbf">dom</span></span><span class="mopen">(</span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mclose">)</span></span></span></span></span>（其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
         &lt; 
        
       
         y 
        
       
         &lt; 
        
       
         z 
        
       
      
        x&lt;y&lt;z 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.04398em;" class="mord mathdefault">z</span></span></span></span></span>），有下式成立：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           ∣ 
          
          
           
            
             
             
               1 
              
             
            
            
             
             
               1 
              
             
            
            
             
             
               1 
              
             
            
           
           
            
             
             
               x 
              
             
            
            
             
             
               y 
              
             
            
            
             
             
               z 
              
             
            
           
           
            
             
              
              
                f 
               
              
                ( 
               
              
                x 
               
              
                ) 
               
              
             
            
            
             
              
              
                f 
               
              
                ( 
               
              
                y 
               
              
                ) 
               
              
             
            
            
             
              
              
                f 
               
              
                ( 
               
              
                z 
               
              
                ) 
               
              
             
            
           
          
         
           ∣ 
          
         
        
          ≥ 
         
        
          0 
         
        
       
         \left|\begin{matrix} 1&amp;1&amp;1\\ x&amp;y&amp;z\\ f(x)&amp;f(y)&amp;f(z)\\ \end{matrix}\right|\ge0 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.636em; vertical-align: -1.55003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.08597em;"><span class="" style="top: -1.05597em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -1.66197em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.26797em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.87397em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -3.47997em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -4.08597em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">x</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.04398em;" class="mord mathdefault">z</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mopen">(</span><span style="margin-right: 0.04398em;" class="mord mathdefault">z</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.08597em;"><span class="" style="top: -1.05597em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -1.66197em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.26797em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -2.87397em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -3.47997em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span><span class="" style="top: -4.08597em;"><span class="pstrut" style="height: 2.606em;"></span><span class="delimsizinginner delim-size1"><span class="">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55003em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span></span></p> 
<p>这个的证明不是特别难，有兴趣的可以试一试，不过这个局限性是只针对一元函数才能用。</p> 
<h4><a id="0618_1900"></a>06-18</h4> 
<blockquote> 
 <ul><li>左膝报销，有两个多月膝盖没疼过了。</li><li>先把preconditioner整明白，有空水一文，计量的复习先缓一缓。</li><li>晚饭后3+5+2间歇，最后2圈最大心率超过190，快到终点时有种可怕的窒息感。明后计划再冲一次10km</li></ul> 
</blockquote> 
<p>下午给考场电脑装QT，本以为要一台台装，所以写了一个监测键盘及鼠标操作的脚本，根据脚本的记录内容可以复原键盘及鼠标的操作，这是我想出来的自动化在WINDOWS系统上安装软件的笨办法（Linux自然可以直接写bash脚本安装），结果我兴致勃勃写完这个脚本，他们告诉我只要在母机上装好，然后把模板上传下载到各个子机上就完事了。真是蠢得真实…</p> 
<p>监测鼠标键盘操作的脚本：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging
<span class="token keyword">from</span> pynput <span class="token keyword">import</span> mouse<span class="token punctuation">,</span> keyboard

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
	level<span class="token operator">=</span> logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span>                                                               
	<span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s  %(filename)s : %(levelname)s  %(message)s'</span><span class="token punctuation">,</span>  
	datefmt<span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span>              
	filename<span class="token operator">=</span><span class="token string">'logging.log'</span><span class="token punctuation">,</span>           
	filemode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>              
console <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>  
console<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>   
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s  %(filename)s : %(levelname)s  %(message)s'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>console<span class="token punctuation">)</span>  

<span class="token keyword">def</span> <span class="token function">keyboard_listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">_on_press</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
		info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'press key </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span></span><span class="token string">'</span></span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">_on_release</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
		info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'release key </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span></span><span class="token string">'</span></span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
	<span class="token keyword">with</span> keyboard<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_press<span class="token operator">=</span>_on_press<span class="token punctuation">,</span> on_release<span class="token operator">=</span>_on_release<span class="token punctuation">)</span> <span class="token keyword">as</span> listener<span class="token punctuation">:</span>
		listener<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">mouse_listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>	
	<span class="token keyword">def</span> <span class="token function">_on_move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
		info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'move to (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">)'</span></span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">_on_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> button<span class="token punctuation">,</span> pressed<span class="token punctuation">)</span><span class="token punctuation">:</span>
		info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token string">"click"</span> <span class="token keyword">if</span> pressed <span class="token keyword">else</span> <span class="token string">"released"</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>button<span class="token punctuation">}</span></span><span class="token string"> at (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">)'</span></span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>info<span class="token punctuation">)</span>			
	<span class="token keyword">def</span> <span class="token function">_on_scroll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">:</span>
		info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'scrolled at (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">) by (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>dx<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>dy<span class="token punctuation">}</span></span><span class="token string">)'</span></span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
	<span class="token keyword">with</span> mouse<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_move<span class="token operator">=</span>_on_move<span class="token punctuation">,</span> on_click<span class="token operator">=</span>_on_click<span class="token punctuation">,</span> on_scroll<span class="token operator">=</span>_on_scroll<span class="token punctuation">)</span> <span class="token keyword">as</span> listener<span class="token punctuation">:</span>
		listener<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	<span class="token comment"># keyboard_listener()</span>
	mouse_listener<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>根据鼠标操作记录复原（键盘暂时没写，稍微麻烦一点，要把所有键位跟id对上，比较费事，以后用到再写）</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> time
<span class="token keyword">from</span> pynput <span class="token keyword">import</span> mouse<span class="token punctuation">,</span> keyboard

<span class="token keyword">def</span> <span class="token function">mouse_script</span><span class="token punctuation">(</span>logging_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">_find_coordinate</span><span class="token punctuation">(</span>_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
		index_1 <span class="token operator">=</span> _string<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span>
		index_2 <span class="token operator">=</span> _string<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> index_1<span class="token punctuation">)</span>
		index_3 <span class="token operator">=</span> _string<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> index_2<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>_string<span class="token punctuation">[</span>index_1<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span> index_2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>_string<span class="token punctuation">[</span>index_2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span> index_3<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>logging_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
		lines <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
	mouse_controller <span class="token operator">=</span> mouse<span class="token punctuation">.</span>Controller<span class="token punctuation">(</span><span class="token punctuation">)</span>
	last_timestamp <span class="token operator">=</span> <span class="token boolean">None</span>
	<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
		x<span class="token punctuation">,</span> y <span class="token operator">=</span> _find_coordinate<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
		timestring <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">]</span>
		timestamp <span class="token operator">=</span> time<span class="token punctuation">.</span>mktime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>timestring<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> last_timestamp <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			last_timestamp <span class="token operator">=</span> timestamp
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>timestamp <span class="token operator">-</span> last_timestamp<span class="token punctuation">)</span>
			last_timestamp <span class="token operator">=</span> timestamp
		<span class="token keyword">print</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token string">'move'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
			mouse_controller<span class="token punctuation">.</span>move<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
		<span class="token keyword">elif</span> <span class="token string">'click'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
			mouse_controller<span class="token punctuation">.</span>move<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token string">'Button.left'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
				mouse_controller<span class="token punctuation">.</span>press<span class="token punctuation">(</span>mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
			<span class="token keyword">elif</span> <span class="token string">'Button.right'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
				mouse_controller<span class="token punctuation">.</span>press<span class="token punctuation">(</span>mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				<span class="token keyword">assert</span> <span class="token boolean">False</span>
		<span class="token keyword">elif</span> <span class="token string">'release'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
			mouse_controller<span class="token punctuation">.</span>move<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token string">'Button.left'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
				mouse_controller<span class="token punctuation">.</span>release<span class="token punctuation">(</span>mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
			<span class="token keyword">elif</span> <span class="token string">'Button.right'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
				mouse_controller<span class="token punctuation">.</span>release<span class="token punctuation">(</span>mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				<span class="token keyword">assert</span> <span class="token boolean">False</span>
		<span class="token keyword">elif</span> <span class="token string">'scroll'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
			mouse_controller<span class="token punctuation">.</span>move<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
			x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> _find_coordinate<span class="token punctuation">(</span>line<span class="token punctuation">[</span>line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">' by '</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			mouse_controller<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">assert</span> <span class="token boolean">False</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	mouse_script<span class="token punctuation">(</span><span class="token string">'logging.log'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0619_2017"></a>06-19</h4> 
<blockquote> 
 <ul><li>巨大突破！得益于前日雨中10k与昨天间歇的训练，10.05km用时42’48"，均配4’15"，刷新pb整整95秒。</li><li>早起就觉得今天是不可错过的好天气，只有20℃，下午雨歇，是突破44分的绝佳机会。起手第一个1000米失误跑到4’09"，4km用时17’06"，比4km的pb只慢了10秒，但是尚有余力，6km用时25’44"（破前pb 26’09"），8km用时34’10"（破前pb 35’12"），当时就有种无所不能的超脱感，只是最后2km明显力竭，已经完成不了加速冲刺。</li><li>可能算是近两三个月最畅快的一次长跑了，计量也复习得差不多（觉得还是把硬性任务先做了，反正早晚要复习），极致的尽兴！这个成绩可能是整个夏天都遥不可及的了。</li></ul> 
</blockquote> 
<p>计量复习里遇到的困惑点：</p> 
<ol><li>为什么一元线性回归的随机误差项方差的最小二乘估计量是无偏的？（事实上我想知道到底是怎么用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          L 
         
        
          S 
         
        
       
         \rm OLS 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">O</span><span class="mord mathrm">L</span><span class="mord mathrm">S</span></span></span></span></span></span>来估计<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Var 
         
        
          ( 
         
        
          μ 
         
        
          ) 
         
        
       
         \text{Var}(\mu) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">Var</span></span><span class="mopen">(</span><span class="mord mathdefault">μ</span><span class="mclose">)</span></span></span></span></span>的，即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            σ 
           
          
            ^ 
           
          
          
          
            O 
           
          
            L 
           
          
            S 
           
          
         
           2 
          
         
        
          = 
         
         
          
           
           
             ∑ 
            
           
             i 
            
           
           
           
             e 
            
           
             i 
            
           
             2 
            
           
          
          
          
            n 
           
          
            − 
           
          
            2 
           
          
         
        
       
         \hat \sigma_{\rm OLS}^2=\frac{\sum_{i}e_i^2}{n-2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.08944em; vertical-align: -0.275331em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.42467em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">O</span><span class="mord mathrm mtight">L</span><span class="mord mathrm mtight">S</span></span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.275331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.56226em; vertical-align: -0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.15893em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.53501em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.149647em;"><span class="" style="top: -2.17856em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.321439em;"><span class=""></span></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.214em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.403331em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>到底是怎么推出来的）。</li><li>其实我还是没有看明白一元线性回归的情况下，变量显著性检验和方程显著性检验等价性的推导，即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          F 
         
        
          = 
         
         
         
           t 
          
         
           2 
          
         
        
       
         F=t^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>，我怎么感觉推导过程那么奇怪…（针对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           H 
          
         
           0 
          
         
        
          : 
         
         
         
           β 
          
         
           1 
          
         
        
          = 
         
        
          0 
         
        
       
         H_0:\beta_1=0 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.08125em;" class="mord mathdefault">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.08125em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>的检验过程，为什么第一个等号就把<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            β 
           
          
            ^ 
           
          
         
           0 
          
         
        
       
         \hat \beta_0 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.15232em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>给丢掉了…）<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           F 
          
         
           = 
          
          
           
           
             ∑ 
            
            
             
             
               y 
              
             
               ^ 
              
             
            
              i 
             
            
              2 
             
            
           
           
           
             ∑ 
            
            
            
              e 
             
            
              i 
             
            
              2 
             
            
           
             / 
            
           
             ( 
            
           
             n 
            
           
             − 
            
           
             2 
            
           
             ) 
            
           
          
         
           = 
          
          
           
            
             
             
               β 
              
             
               ^ 
              
             
            
              1 
             
            
              2 
             
            
           
             ∑ 
            
            
            
              x 
             
            
              i 
             
            
              2 
             
            
           
           
           
             ∑ 
            
            
            
              e 
             
            
              i 
             
            
              2 
             
            
           
             / 
            
           
             ( 
            
           
             n 
            
           
             − 
            
           
             2 
            
           
             ) 
            
           
          
         
           = 
          
          
           
            
            
              β 
             
            
              ^ 
             
            
           
             1 
            
           
             2 
            
           
           
           
             ∑ 
            
            
            
              e 
             
            
              i 
             
            
              2 
             
            
           
             / 
            
           
             ( 
            
           
             n 
            
           
             − 
            
           
             2 
            
           
             ) 
            
           
             ∑ 
            
            
            
              x 
             
            
              i 
             
            
              2 
             
            
           
          
         
           = 
          
          
           
           
             [ 
            
            
             
              
              
                β 
               
              
                ^ 
               
              
             
               1 
              
             
             
              
              
                ∑ 
               
               
               
                 e 
                
               
                 i 
                
               
                 2 
                
               
              
                / 
               
              
                ( 
               
              
                n 
               
              
                − 
               
              
                2 
               
              
                ) 
               
              
                ∑ 
               
               
               
                 x 
                
               
                 i 
                
               
                 2 
                
               
              
             
            
           
             ] 
            
           
          
            2 
           
          
         
           = 
          
          
           
           
             [ 
            
            
             
              
              
                β 
               
              
                ^ 
               
              
             
               1 
              
             
             
              
               
                
                
                  ∑ 
                 
                 
                 
                   e 
                  
                 
                   i 
                  
                 
                   2 
                  
                 
                
                
                
                  n 
                 
                
                  − 
                 
                
                  2 
                 
                
               
              
                ⋅ 
               
               
               
                 1 
                
                
                
                  ∑ 
                 
                 
                 
                   x 
                  
                 
                   i 
                  
                 
                   2 
                  
                 
                
               
              
             
            
           
             ] 
            
           
          
            2 
           
          
         
           = 
          
          
          
            t 
           
          
            2 
           
          
         
        
          F=\frac{\sum\hat y_i^2}{\sum e_i^2/(n-2)}=\frac{\hat\beta_1^2\sum x_i^2}{\sum e_i^2/(n-2)}=\frac{\hat\beta_1^2}{\sum e_i^2/(n-2)\sum x_i^2}=\left[\frac{\hat\beta_1}{\sqrt{\sum e_i^2/(n-2)\sum x_i^2}}\right]^2=\left[\frac{\hat\beta_1}{\sqrt{\frac{\sum e_i^2}{n-2}\cdot\frac1{\sum x_i^2}}}\right]^2=t^2 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.45397em; vertical-align: -0.962864em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.49111em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.44134em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.258664em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.962864em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.59774em; vertical-align: -0.962864em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.63488em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.45189em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.248108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.44134em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.258664em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.962864em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.59774em; vertical-align: -0.962864em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.63488em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.45189em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.248108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.962864em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.20404em; vertical-align: -1.25003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.63488em;"><span class="" style="top: -2.16548em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.944522em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.795908em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.0448em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.90452em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"> 
                      <svg width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"> 
                       <path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z"></path> 
                      </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.295478em;"><span class=""></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.95401em;"><span class="" style="top: -4.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.98403em; vertical-align: -1.73em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.63488em;"><span class="" style="top: -2.11em;"><span class="pstrut" style="height: 3.235em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.235em;"><span class="svg-align" style="top: -3.8em;"><span class="pstrut" style="height: 3.8em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.09918em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.5356em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position: relative; top: -0.000005em;">∑</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.805114em;"><span class="" style="top: -2.17771em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -2.8448em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.322286em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.403331em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.62642em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position: relative; top: -0.000005em;">∑</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.805114em;"><span class="" style="top: -2.17771em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -2.8448em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.322286em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.59918em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.195em;"><span class="pstrut" style="height: 3.8em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.88em;"> 
                      <svg width="400em" height="1.8800000000000001em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
                       <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
                      </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.605em;"><span class=""></span></span></span></span></span></span></span><span class="" style="top: -3.465em;"><span class="pstrut" style="height: 3.235em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.912em;"><span class="pstrut" style="height: 3.235em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.73em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 2.25403em;"><span class="" style="top: -4.50292em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.864108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></li><li>关于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
          u 
         
        
          r 
         
        
          b 
         
        
          i 
         
        
          n 
         
        
       
         \rm Durbin 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">D</span><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span></span></span></span></span>两步法估计带有序列相关性模型的方法：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            Y 
           
          
            i 
           
          
         
           = 
          
          
          
            ( 
           
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             l 
            
           
           
           
             ρ 
            
           
             k 
            
           
           
           
             Y 
            
            
            
              i 
             
            
              − 
             
            
              k 
             
            
           
          
            ) 
           
          
         
           + 
          
          
          
            β 
           
          
            0 
           
          
          
          
            ( 
           
          
            1 
           
          
            − 
           
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             l 
            
           
           
           
             ρ 
            
           
             k 
            
           
          
            ) 
           
          
         
           + 
          
          
          
            β 
           
          
            1 
           
          
          
          
            ( 
           
           
           
             X 
            
           
             i 
            
           
          
            − 
           
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             l 
            
           
           
           
             ρ 
            
           
             k 
            
           
           
           
             X 
            
            
            
              i 
             
            
              − 
             
            
              k 
             
            
           
          
            ) 
           
          
         
        
          Y_i=\left(\sum_{k=1}^l\rho_kY_{i-k}\right)+\beta_0\left(1-\sum_{k=1}^l\rho_k\right)+\beta_1\left(X_i-\sum_{k=1}^l\rho_kX_{i-k}\right) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.13823em; vertical-align: -1.30211em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.83611em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.13823em; vertical-align: -1.30211em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.83611em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 3.13823em; vertical-align: -1.30211em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.83611em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30211em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size4">)</span></span></span></span></span></span></span></span> 
  <ul><li>第一步只是在估计<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             Y 
            
            
            
              i 
             
            
              − 
             
            
              k 
             
            
           
          
         
           Y_{i-k} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span></span></span></span></span>前面的系数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             ρ 
            
           
             k 
            
           
          
         
           \rho_k 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，估计完了代入再估计后面两项，所以第一步只估计<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             Y 
            
            
            
              i 
             
            
              − 
             
            
              k 
             
            
           
          
         
           Y_{i-k} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span></span></span></span></span>前面的系数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             ρ 
            
           
             k 
            
           
          
         
           \rho_k 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，后面两项怎么办呢（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             ρ 
            
           
             k 
            
           
          
         
           \rho_k 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>又观测不到，所以后面两项都不知道怎么做回归…）？</li><li>相对来说<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Cochrane-Orcutt 
           
          
         
           \text{Cochrane-Orcutt} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">Cochrane-Orcutt</span></span></span></span></span></span>迭代法倒是比较明白，就先正常估计<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             Y 
            
           
             i 
            
           
          
            = 
           
           
           
             β 
            
           
             0 
            
           
          
            + 
           
           
           
             β 
            
           
             1 
            
           
           
           
             X 
            
           
             i 
            
           
          
            + 
           
           
           
             μ 
            
           
             i 
            
           
          
         
           Y_i=\beta_0+\beta_1X_i+\mu_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，然后对得到的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             μ 
            
           
             i 
            
           
          
         
           \mu_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>做<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            l 
           
          
         
           l 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.01968em;" class="mord mathdefault">l</span></span></span></span></span>阶自相关回归<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             μ 
            
           
             i 
            
           
          
            = 
           
           
           
             ϵ 
            
           
             i 
            
           
          
            + 
           
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             l 
            
           
           
           
             ρ 
            
           
             k 
            
           
           
           
             μ 
            
            
            
              i 
             
            
              − 
             
            
              k 
             
            
           
          
         
           \mu_i=\epsilon_i+\sum_{k=1}^l\rho_k\mu_{i-k} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.28872em; vertical-align: -0.29971em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.989008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，将估计得到的结果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
              ρ 
             
            
              ^ 
             
            
           
             k 
            
           
          
         
           \hat \rho_k 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">ρ</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>代回到广义差分模型<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             Y 
            
           
             i 
            
           
          
            = 
           
           
           
             ( 
            
            
            
              ∑ 
             
             
             
               k 
              
             
               = 
              
             
               1 
              
             
            
              l 
             
            
            
            
              ρ 
             
            
              k 
             
            
            
            
              Y 
             
             
             
               i 
              
             
               − 
              
             
               k 
              
             
            
           
             ) 
            
           
          
            + 
           
           
           
             β 
            
           
             0 
            
           
           
           
             ( 
            
           
             1 
            
           
             − 
            
            
            
              ∑ 
             
             
             
               k 
              
             
               = 
              
             
               1 
              
             
            
              l 
             
            
            
            
              ρ 
             
            
              k 
             
            
           
             ) 
            
           
          
            + 
           
           
           
             β 
            
           
             1 
            
           
           
           
             ( 
            
            
            
              X 
             
            
              i 
             
            
           
             − 
            
            
            
              ∑ 
             
             
             
               k 
              
             
               = 
              
             
               1 
              
             
            
              l 
             
            
            
            
              ρ 
             
            
              k 
             
            
            
            
              X 
             
             
             
               i 
              
             
               − 
              
             
               k 
              
             
            
           
             ) 
            
           
          
         
           Y_i=\left(\sum_{k=1}^l\rho_kY_{i-k}\right)+\beta_0\left(1-\sum_{k=1}^l\rho_k\right)+\beta_1\left(X_i-\sum_{k=1}^l\rho_kX_{i-k}\right) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.80002em; vertical-align: -0.65002em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.989008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.80002em; vertical-align: -0.65002em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.989008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.80002em; vertical-align: -0.65002em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.989008em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>中把<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
              β 
             
            
              ^ 
             
            
           
             i 
            
           
          
         
           \hat\beta_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.15232em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.95788em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span><span class="" style="top: -3.26344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>估计出来，再代回到原模型<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             Y 
            
           
             i 
            
           
          
            = 
           
           
           
             β 
            
           
             0 
            
           
          
            + 
           
           
           
             β 
            
           
             1 
            
           
           
           
             X 
            
           
             i 
            
           
          
            + 
           
           
           
             μ 
            
           
             i 
            
           
          
         
           Y_i=\beta_0+\beta_1X_i+\mu_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>中去，得到新的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             μ 
            
           
             i 
            
           
          
         
           \mu_i 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>观测值后继续做<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            l 
           
          
         
           l 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.01968em;" class="mord mathdefault">l</span></span></span></span></span>阶自相关回归，重复上述流程即可。</li></ul> </li></ol> 
<h4><a id="0620_2036"></a>06-20</h4> 
<blockquote> 
 <ul><li>WXY昨天刚好在我退场后也进场跑了一次10km，用时40’25"，均配4’02"。太强了，我拼半条命（最后两圈心脏有刺痛感）才跑成这样，差距好大。不过去年认识的那个大爷现在是跑不过我了哈哈。</li><li>复习计量到午夜0:40，全部看完，少一件破事。然后刚好刷到就看到了两点。确实很久不看球了（连番剧也很久不追不补了，真的好多东西都丢了，羡慕这么大岁数还熬夜看球的人），恰好是葡萄牙对阵德国，可惜结局还是莫得悬念…</li><li>出门称重只剩66kg，努力三餐吃饱，可还是止不住体重在掉。晚归随性跑了1km，3’40"，跑完看到裸奔狂人在跑，笑死，他跑一圈，我跟一圈，他再跑一圈，我就休一圈，成功造成我一直跟着他的假象。接下来会经常性练间歇跑，夏天不指望能破6km-10km的成绩，主要练5km内的速度的和10km以上的耐力，我希望能在自己第一个半马上跑出不错的成绩。</li><li>话说娃娃机真能抓到这么大的公仔么… 有个能带着出去玩的室友是真好，大约所谓近朱者赤罢，可能我真的会一直黑到底。其实也不坏，路是自己选的，也容不得后悔。</li></ul> 
</blockquote> 
<p>关于<a href="https://caoyang.blog.csdn.net/article/details/117391702" rel="nofollow">【论文实现】以SVD的分解形式进行深度神经网络的训练（PyTorch）</a>的代码有一点小问题，忘了对重写的卷积层和线性层的权重矩阵参数初始化，导致网络输出中有大量的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
         a 
        
       
         N 
        
       
      
        \rm NaN 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">a</span><span class="mord mathrm">N</span></span></span></span></span></span>，损失函数计算出问题。</p> 
<p>其实源码看得还是不仔细，<code>torch</code>里对所有权重矩阵参数都做了<code>kaiming_uniform_</code>的初始化，不做初始化权重就都是零，所以会出一点问题。不过我也懒得改原博客了，反正也不会有人真的会去细究，修正后的<code>cifar_layers.py</code>如下（构造函数中添加初始化，<code>cifar_init</code>模块即<code>E:\Anaconda3\Lib\site-packages\torch\nn\init.py</code>中的源码，直接复制过来用即可）：</p> 
<p><mark>现在有新的问题，就是似乎跑得很慢，按道理SVDTraining应该很快才对，不知道是哪里理解的不对。</mark></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> math
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> cifar_init <span class="token keyword">as</span> init
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">Conv2dSVD</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""二维卷积层的SVD形式"""</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> groups<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> padding_mode<span class="token operator">=</span><span class="token string">'zeros'</span><span class="token punctuation">,</span> decomposition_mode<span class="token operator">=</span><span class="token string">'channel'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>		
		<span class="token builtin">super</span><span class="token punctuation">(</span>Conv2dSVD<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>
			in_channels<span class="token operator">=</span>in_channels<span class="token punctuation">,</span> 
			out_channels<span class="token operator">=</span>out_channels<span class="token punctuation">,</span> 
			kernel_size<span class="token operator">=</span>kernel_size<span class="token punctuation">,</span> 
			stride<span class="token operator">=</span>stride<span class="token punctuation">,</span> 
			padding<span class="token operator">=</span>padding<span class="token punctuation">,</span> 
			dilation<span class="token operator">=</span>dilation<span class="token punctuation">,</span> 
			groups<span class="token operator">=</span>groups<span class="token punctuation">,</span> 
			bias<span class="token operator">=</span>bias<span class="token punctuation">,</span> 
			padding_mode<span class="token operator">=</span>padding_mode<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
		kernel_height<span class="token punctuation">,</span> kernel_width <span class="token operator">=</span> self<span class="token punctuation">.</span>kernel_size
		self<span class="token punctuation">.</span>decomposition_mode <span class="token operator">=</span> decomposition_mode
		<span class="token keyword">if</span> self<span class="token punctuation">.</span>decomposition_mode <span class="token operator">==</span> <span class="token string">'channel'</span><span class="token punctuation">:</span>						 <span class="token comment"># 管道级的分解</span>
			rank <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> in_channels <span class="token operator">*</span> kernel_height <span class="token operator">*</span> kernel_width<span class="token punctuation">)</span>														<span class="token comment"># r = min(n, cwh)</span>
			self<span class="token punctuation">.</span>svd_weight_matrix_u <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>												<span class="token comment"># 左奇异向量矩阵，形状为n×r</span>
			self<span class="token punctuation">.</span>svd_weight_matrix_v <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>in_channels <span class="token operator">*</span> kernel_width <span class="token operator">*</span> kernel_height<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>				<span class="token comment"># 右奇异向量矩阵，形状为cwh×r</span>
			self<span class="token punctuation">.</span>svd_weight_vector_s <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>rank<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>															<span class="token comment"># 奇异值向量</span>
		
		<span class="token keyword">elif</span> self<span class="token punctuation">.</span>decomposition_mode <span class="token operator">==</span> <span class="token string">'spatial'</span><span class="token punctuation">:</span>						 <span class="token comment"># 空间级的分解</span>
			rank <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>out_channels <span class="token operator">*</span> kernel_width<span class="token punctuation">,</span> in_channels <span class="token operator">*</span> kernel_height<span class="token punctuation">)</span>														<span class="token comment"># r = min(nw, ch)</span>
			self<span class="token punctuation">.</span>svd_weight_matrix_u <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>out_channels <span class="token operator">*</span> kernel_width<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>								<span class="token comment"># 左奇异向量矩阵，形状为nw×r</span>
			self<span class="token punctuation">.</span>svd_weight_matrix_v <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>in_channels <span class="token operator">*</span> kernel_height<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>								<span class="token comment"># 右奇异向量矩阵，形状为ch×r</span>
			self<span class="token punctuation">.</span>svd_weight_vector_s <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>rank<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>															<span class="token comment"># 奇异值向量</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Unknown decomposition mode: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>decomposition_mode<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
			
		<span class="token comment"># 参数初始化：注意源码中构造函数中有self.reset_parameters</span>
		init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_u<span class="token punctuation">,</span> a<span class="token operator">=</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_v<span class="token punctuation">,</span> a<span class="token operator">=</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		init<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_vector_s<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		kernel_height<span class="token punctuation">,</span> kernel_width <span class="token operator">=</span> self<span class="token punctuation">.</span>kernel_size
		<span class="token keyword">if</span> self<span class="token punctuation">.</span>decomposition_mode <span class="token operator">==</span> <span class="token string">'channel'</span><span class="token punctuation">:</span>						 <span class="token comment"># 管道级的分解</span>
			weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_u<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_vector_s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>svd_weight_matrix_v<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># (out_channels, in_channels * kernel_width * kernel_height)</span>
			weight <span class="token operator">=</span> weight<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>out_channels<span class="token punctuation">,</span> self<span class="token punctuation">.</span>in_channels<span class="token punctuation">,</span> kernel_height<span class="token punctuation">,</span> kernel_width<span class="token punctuation">)</span>									<span class="token comment"># (out_channels, in_channels , kernel_height, kernel_width)</span>
		<span class="token keyword">elif</span> self<span class="token punctuation">.</span>decomposition_mode <span class="token operator">==</span> <span class="token string">'spatial'</span><span class="token punctuation">:</span>						 <span class="token comment"># 空间级的分解</span>
			weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_u<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_vector_s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>svd_weight_matrix_v<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># (out_channels * kernel_width, in_channels * kernel_height)</span>
			weight <span class="token operator">=</span> weight<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>out_channels<span class="token punctuation">,</span> kernel_width<span class="token punctuation">,</span> self<span class="token punctuation">.</span>in_channels<span class="token punctuation">,</span> kernel_height<span class="token punctuation">)</span>									<span class="token comment"># (out_channels, kernel_width, in_channels , kernel_height)</span>
			weight <span class="token operator">=</span> weight<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>																						<span class="token comment"># 这里我觉得可能直接reshape成(out_channels, in_channels , kernel_height, kernel_width)也可以，但是从矩阵的形状上来看可能还是按顺序reshape更合理一些，最后再多做一个维度置换即可</span>
		<span class="token comment"># 用法: torch.nn.functional.conv2d(input, weight, bias=None, stride=1, padding=0, dilation=1, groups=1)</span>
		<span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>padding_mode <span class="token operator">==</span> <span class="token string">'zeros'</span><span class="token punctuation">:</span>							 <span class="token comment"># 这部分似乎源码中是未完成状态，内容稍微有点乱，不过一般来说padding都是零填充，所以用不到这边的内容</span>
			<span class="token keyword">from</span> torch<span class="token punctuation">.</span>_six <span class="token keyword">import</span> container_abcs
			<span class="token keyword">from</span> itertools <span class="token keyword">import</span> repeat
			<span class="token keyword">def</span> <span class="token function">_reverse_repeat_tuple</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">def</span> <span class="token function">_ntuple</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> container_abcs<span class="token punctuation">.</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">:</span>
						<span class="token keyword">return</span> x
					<span class="token keyword">return</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>repeat<span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> parse
			_pair <span class="token operator">=</span> _ntuple<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> F<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>F<span class="token punctuation">.</span>pad<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> _reverse_repeat_tuple<span class="token punctuation">(</span>self<span class="token punctuation">.</span>padding<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span>self<span class="token punctuation">.</span>padding_mode<span class="token punctuation">)</span><span class="token punctuation">,</span> weight<span class="token punctuation">,</span> self<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stride<span class="token punctuation">,</span> _pair<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dilation<span class="token punctuation">,</span> self<span class="token punctuation">.</span>groups<span class="token punctuation">)</span>
		<span class="token keyword">return</span> F<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> weight<span class="token punctuation">,</span> self<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stride<span class="token punctuation">,</span> self<span class="token punctuation">.</span>padding<span class="token punctuation">,</span> self<span class="token punctuation">.</span>dilation<span class="token punctuation">,</span> self<span class="token punctuation">.</span>groups<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">LinearSVD</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""线性层的SVD形式"""</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>LinearSVD<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> bias<span class="token punctuation">)</span>
		rank <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> out_features<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>svd_weight_matrix_u <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>out_features<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>svd_weight_matrix_v <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>svd_weight_vector_s <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>rank<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
		
		<span class="token comment"># 参数初始化：注意源码中构造函数中有self.reset_parameters</span>
		init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_u<span class="token punctuation">,</span> a<span class="token operator">=</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_v<span class="token punctuation">,</span> a<span class="token operator">=</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		init<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_vector_s<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		
	<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_matrix_u<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>self<span class="token punctuation">.</span>svd_weight_vector_s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>svd_weight_matrix_v<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> F<span class="token punctuation">.</span>linear<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> weight<span class="token punctuation">,</span> self<span class="token punctuation">.</span>bias<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0621_2137"></a>06-21</h4> 
<blockquote> 
 <ul><li>《不见长安》，理想与现实的差距。每个人都有自己纸上的长安，可是真的抵达却茫然失措，最终怀恨诀别。不属于你的长安，你永远无法拥有，然而长安也许并不存在，因此既要怀揣理想，也要学会走出理想，奈何偶尔看到真的是很美好（齐刘海+口罩确实是上照神器）。</li><li>晚饭后4km慢跑，刚好WXY也在，自己状态不太行没敢跟上去，怕被拉爆。10圈快到终点时被他套了一圈，提速想反超却做不到，害，无能狂怒。</li></ul> 
</blockquote> 
<ol><li>对于多元线性回归模型，何谓“内生性”？它有什么危害？怎么来判断一个模型中是否具有“内生性”？对此问题，请你进行详细论证。</li><li>估计多元线性回归模型，其目标函数是残差的偶数次方和最小，这种做法是否正确？为什么？这一目标函数的结果与采用极大似然法的结果有何不同？</li><li>有一研究者欲分析我国股票市场<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
       
         \rm S 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span></span></span></span></span></span>与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
          D 
         
        
          P 
         
        
       
         \rm GDP 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">D</span><span class="mord mathrm">P</span></span></span></span></span></span>的关系，采用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2000 
         
        
          - 
         
        
          2017 
         
        
       
         2000\text{-}2017 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord text"><span class="mord">-</span></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">7</span></span></span></span></span>年上证指数和我国<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          31 
         
        
       
         31 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">1</span></span></span></span></span>个省级单位的面板数据对各省工业生产总值<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          N 
         
        
          D 
         
        
       
         \rm IND 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">N</span><span class="mord mathrm">D</span></span></span></span></span></span>建立了模型并进行实证检验：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ln 
          
         
           ⁡ 
          
         
           IND 
          
         
           = 
          
          
          
            β 
           
          
            0 
           
          
         
           + 
          
          
          
            β 
           
          
            1 
           
          
         
           ln 
          
         
           ⁡ 
          
         
           S 
          
         
           + 
          
          
          
            μ 
           
          
            1 
           
          
         
        
          \ln\text{IND}=\beta_0+\beta_1\ln\text{S}+\mu_1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">IND</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord">S</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 通过采用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          L 
         
        
          S 
         
        
       
         \rm OLS 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">O</span><span class="mord mathrm">L</span><span class="mord mathrm">S</span></span></span></span></span></span>估计模型参数，得到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           β 
          
         
           1 
          
         
        
          = 
         
        
          3.47 
         
        
       
         \beta_1=3.47 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">.</span><span class="mord">4</span><span class="mord">7</span></span></span></span></span>，于是得出结论：我国股票市场<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
       
         \rm S 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span></span></span></span></span></span>对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
          D 
         
        
          P 
         
        
       
         \rm GDP 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">D</span><span class="mord mathrm">P</span></span></span></span></span></span>的影响弹性为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          3.47 
         
        
       
         3.47 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">.</span><span class="mord">4</span><span class="mord">7</span></span></span></span></span>。请从计量经济学模型理论和方法角度指出以上做法的错误之处。</li><li>现研究城市化<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          u 
         
        
          r 
         
        
          b 
         
        
       
         \rm urb 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">b</span></span></span></span></span></span>对城乡收入差距<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          g 
         
        
          a 
         
        
          p 
         
        
       
         \rm gap 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.01389em;" class="mord mathrm">g</span><span class="mord mathrm">a</span><span class="mord mathrm">p</span></span></span></span></span></span>的影响，有人设立模型：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ln 
          
         
           ⁡ 
          
          
          
            gap 
           
          
            i 
           
          
         
           = 
          
          
          
            β 
           
          
            0 
           
          
         
           + 
          
          
          
            β 
           
          
            1 
           
          
         
           ln 
          
         
           ⁡ 
          
          
          
            urb 
           
          
            i 
           
          
         
           + 
          
          
          
            μ 
           
          
            i 
           
          
          
         
           i 
          
         
           = 
          
         
           1 
          
         
           , 
          
         
           2 
          
         
           , 
          
         
           . 
          
         
           . 
          
         
           . 
          
         
           , 
          
         
           n 
          
         
        
          \ln\text{gap}_i=\beta_0+\beta_1\ln\text{urb}_i+\mu_i\quad i=1,2,...,n 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.93858em; vertical-align: -0.24414em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord text"><span class="mord">gap</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.217524em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord text"><span class="mord">urb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">n</span></span></span></span></span></span> 
  <ul><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             ( 
            
           
             1 
            
           
             ) 
            
           
          
            (1) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> 以上模型可能存在什么问题？这些问题有什么后果？为什么？</p> </li><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             ( 
            
           
             2 
            
           
             ) 
            
           
          
            (2) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span> 如果以上模型中存在随机解释变量问题（内生性问题），请你从经济学理论上出发，为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             u 
            
           
             r 
            
           
             b 
            
           
          
            \rm urb 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">b</span></span></span></span></span></span>找出至少两个工具变量（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             I 
            
           
             V 
            
           
          
            \rm IV 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span style="margin-right: 0.01389em;" class="mord mathrm">V</span></span></span></span></span></span>），并充分论证你所选择的工具变量的合理性。</p> </li><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             ( 
            
           
             3 
            
           
             ) 
            
           
          
            (3) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span> 在以上<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             ( 
            
           
             2 
            
           
             ) 
            
           
          
            (2) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>的基础上，能否采用狭义的工具变量法估计模型参数？为什么？</p> </li><li> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             ( 
            
           
             4 
            
           
             ) 
            
           
          
            (4) 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span> 如果采用两阶段最小二乘法（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             2 
            
           
             S 
            
           
             L 
            
           
             S 
            
           
          
            \rm 2SLS 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">2</span><span class="mord mathrm">S</span><span class="mord mathrm">L</span><span class="mord mathrm">S</span></span></span></span></span></span>）估计模型参数，请写出估计过程。并详细说明它与狭义的工具变量法有什么区别。</p> </li></ul> </li><li>现在需要研究目前中国以下经济社会问题，请从计量经济学模型设定理论出发详细说明如何建立模型进行实证分析。 
  <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            1 
           
          
            ) 
           
          
         
           (1) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2021 
           
          
         
           2021 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span></span></span></span></span>年中国新基建投资规模。</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            2 
           
          
            ) 
           
          
         
           (2) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            2020 
           
          
         
           2020 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">0</span></span></span></span></span>年中国地摊经济就业人数总量预测。</li></ul> </li><li>对我国<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          1990 
         
        
          - 
         
        
          2019 
         
        
       
         1990\text{-}2019 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">9</span><span class="mord">0</span><span class="mord text"><span class="mord">-</span></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">9</span></span></span></span></span>年<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          GDP 
         
        
       
         \text{GDP} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">GDP</span></span></span></span></span></span>和劳动力就业人数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          L 
         
        
          a 
         
        
          b 
         
        
       
         \rm Lab 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="mord mathrm">a</span><span class="mord mathrm">b</span></span></span></span></span></span>的时间序列进行分析： 
  <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            1 
           
          
            ) 
           
          
         
           (1) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> 以上两个序列是否同阶单整？如何检验？请写出详细的检验步骤。</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            2 
           
          
            ) 
           
          
         
           (2) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span> 经过检验，如果发现<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            G 
           
          
            D 
           
          
            P 
           
          
         
           \rm GDP 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">D</span><span class="mord mathrm">P</span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            L 
           
          
            a 
           
          
            b 
           
          
         
           \rm Lab 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="mord mathrm">a</span><span class="mord mathrm">b</span></span></span></span></span></span>单整阶数不同，它们是否可能存在协整关系？在此条件下对二者进行回归分析，会造成什么结果？</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            3 
           
          
            ) 
           
          
         
           (3) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span> 如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            G 
           
          
            D 
           
          
            P 
           
          
         
           \rm GDP 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">D</span><span class="mord mathrm">P</span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            L 
           
          
            a 
           
          
            b 
           
          
         
           \rm Lab 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="mord mathrm">a</span><span class="mord mathrm">b</span></span></span></span></span></span>的短期波动具有误差修正模型（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            E 
           
          
            C 
           
          
            M 
           
          
         
           \rm ECM 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">E</span><span class="mord mathrm">C</span><span class="mord mathrm">M</span></span></span></span></span></span>），这是否意味着它们之间一定具有协整关系？为什么</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            4 
           
          
            ) 
           
          
         
           (4) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span> 对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            G 
           
          
            D 
           
          
            P 
           
          
         
           \rm GDP 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">G</span><span class="mord mathrm">D</span><span class="mord mathrm">P</span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            L 
           
          
            a 
           
          
            b 
           
          
         
           \rm Lab 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="mord mathrm">a</span><span class="mord mathrm">b</span></span></span></span></span></span>进行时间序列分析，“协整关系与误差修正模型（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            E 
           
          
            C 
           
          
            M 
           
          
         
           \rm ECM 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">E</span><span class="mord mathrm">C</span><span class="mord mathrm">M</span></span></span></span></span></span>）没有本质区别”，这种说法是否正确？为什么？如果不正确，那么请问它们的本质区别是什么？请详细说明。</li></ul> </li></ol> 
<h4><a id="0622_2167"></a>06-22</h4> 
<blockquote> 
 <ul><li>计量考完，比去年多两道大题，勉强全部写完（跟写马哲一样，密密麻麻写满四张纸，绝了）。感觉一般，等最终成绩，希望别让我太失望（这学期最后也许还是未能挽救自己，虽然期末感觉自己已经比以往都更尽力了，只是自己这么多年偶尔想要争一回成绩的时候却不得，很失落）。</li><li>刚考完就收到导师的“亲切的问候”，赶紧中午回去休息了一会儿就出门到图书馆干活，紧凑一些好。虽然并非完全出于本意，但还是无可奈何地碰到了wyy，学校就这么大，想躲确实很难（关键自己还跑回去确认一眼也太犯贱了），既来之则安之罢。</li><li>晚归间歇3km+2km+0.5km，均配4’09"+4’13"+3’53"，状态尚可。最后一个500米是跟着裸奔狂人跑的，本来是想要跟完1km，结果他跑得太快，自己刚完成5km已是强弩之末，无奈又被拉爆。有机会满状态跟一次，或许能顺势破3km和4km的pb。</li></ul> 
</blockquote> 
<p>还是憋去图书馆了… 都有一个多月没去过了，真是自找不痛快。</p> 
<p>下午花了一些功夫看了<a href="https://caoyang.blog.csdn.net/article/details/116430150" rel="nofollow">使用CNN进行雅可比预条件子的生成</a>的项目代码，发现这个项目代码写得也太离谱了，README没有也就算了，关键还跑不通，改了好久才通，提供的伪造数据跟代码完全不匹配，还得自己根据paper重写了一份伪造逻辑。不过我看下来似乎只是做有雅可比块和无雅可比块的二分类预测，并不是确切地找到雅可比块的构成，这就有点令人失望了，到底还是确实地把雅可比块找出来比较切实际。眼下硬任务是把邓琪的项目搞掉，大约如此。</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>

<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> h5py
<span class="token keyword">from</span> keras <span class="token keyword">import</span> optimizers
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>callbacks <span class="token keyword">import</span> ModelCheckpoint
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Activation<span class="token punctuation">,</span> add<span class="token punctuation">,</span> BatchNormalization<span class="token punctuation">,</span> Conv2D<span class="token punctuation">,</span> Dense<span class="token punctuation">,</span> Dropout<span class="token punctuation">,</span> Flatten<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> ZeroPadding2D
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> load_model<span class="token punctuation">,</span> Model
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>regularizers <span class="token keyword">import</span> l2
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>utils <span class="token keyword">import</span> plot_model
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">positive_int</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">try</span><span class="token punctuation">:</span>
		parsed <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token keyword">not</span> parsed <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
			<span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> parsed
	<span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
		<span class="token keyword">raise</span> argparse<span class="token punctuation">.</span>ArgumentTypeError<span class="token punctuation">(</span><span class="token string">'value must be an positive integer'</span><span class="token punctuation">)</span>


<span class="token comment"># def parse_cli():</span>
	<span class="token comment"># parser = argparse.ArgumentParser()</span>

	<span class="token comment"># parser.add_argument(</span>
		<span class="token comment"># '-e', '--epochs',</span>
		<span class="token comment"># nargs='?',</span>
		<span class="token comment"># type=positive_int,</span>
		<span class="token comment"># action='store',</span>
		<span class="token comment"># default=10,</span>
		<span class="token comment"># help='number of training epochs'</span>
	<span class="token comment"># )</span>
	<span class="token comment"># parser.add_argument(</span>
		<span class="token comment"># metavar='TRAIN',</span>
		<span class="token comment"># type=str,</span>
		<span class="token comment"># dest='train',</span>
		<span class="token comment"># help='path to the HDF5 file with the training data'</span>
	<span class="token comment"># )</span>
	<span class="token comment"># parser.add_argument(</span>
		<span class="token comment"># metavar='MODEL',</span>
		<span class="token comment"># type=str,</span>
		<span class="token comment"># dest='model',</span>
		<span class="token comment"># help='path where to store the model'</span>
	<span class="token comment"># )</span>

	<span class="token comment"># return parser.parse_args()</span>


<span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">with</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> handle<span class="token punctuation">:</span>
		<span class="token comment"># data = np.array(handle['diagonalset'])</span>
		data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>handle<span class="token punctuation">[</span><span class="token string">'matrixset'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		labels <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>handle<span class="token punctuation">[</span><span class="token string">'vectorset'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> data<span class="token punctuation">,</span> labels


<span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># simply add an additional dimension for the channels for data</span>
	<span class="token comment"># swap axis of the label set</span>
	<span class="token keyword">return</span> np<span class="token punctuation">.</span>moveaxis<span class="token punctuation">(</span>np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>moveaxis<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token comment"># return np.expand_dims(data, axis=3), np.moveaxis(labels, 0, -1)</span>


<span class="token keyword">def</span> <span class="token function">build_model</span><span class="token punctuation">(</span>input_shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
	input_img <span class="token operator">=</span> Input<span class="token punctuation">(</span>shape<span class="token operator">=</span>input_shape<span class="token punctuation">)</span>

	<span class="token comment"># first bottleneck unit</span>
	bn_1 <span class="token operator">=</span> BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input_img<span class="token punctuation">)</span>
	activation_1 <span class="token operator">=</span> Activation<span class="token punctuation">(</span><span class="token string">'selu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>bn_1<span class="token punctuation">)</span>
	conv_1 <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> kernel_regularizer<span class="token operator">=</span>l2<span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>activation_1<span class="token punctuation">)</span>

	bn_2 <span class="token operator">=</span> BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>conv_1<span class="token punctuation">)</span>
	activation_2 <span class="token operator">=</span> Activation<span class="token punctuation">(</span><span class="token string">'selu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>bn_2<span class="token punctuation">)</span>
	<span class="token comment"># conv_2 = Conv2D(128, kernel_size=(3, 3,), padding='same', kernel_regularizer=l2(0.02))(activation_2)</span>
	conv_2 <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> kernel_regularizer<span class="token operator">=</span>l2<span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>activation_2<span class="token punctuation">)</span>

	merged <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token punctuation">[</span>input_img<span class="token punctuation">,</span> conv_2<span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token comment"># corner detection</span>
	bn_3 <span class="token operator">=</span> BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>merged<span class="token punctuation">)</span>
	padding <span class="token operator">=</span> ZeroPadding2D<span class="token punctuation">(</span>padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>bn_3<span class="token punctuation">)</span>
	conv_3 <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'valid'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'tanh'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>padding<span class="token punctuation">)</span>
	<span class="token comment"># conv_4 = Conv2D(128, kernel_size=( 1, 3,), padding='same',  activation='tanh')(conv_3)</span>
	conv_4 <span class="token operator">=</span> Conv2D<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span>  activation<span class="token operator">=</span><span class="token string">'tanh'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>conv_3<span class="token punctuation">)</span>
 
	<span class="token comment"># fully-connected predictor</span>
	flat <span class="token operator">=</span> Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>conv_4<span class="token punctuation">)</span>
	<span class="token comment"># classify = Dense(512, activation='sigmoid')(flat)</span>
	classify <span class="token operator">=</span> Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>flat<span class="token punctuation">)</span>
	dropout <span class="token operator">=</span> Dropout<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>classify<span class="token punctuation">)</span>

	result <span class="token operator">=</span> Dense<span class="token punctuation">(</span>input_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>

	model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>input_img<span class="token punctuation">,</span> outputs<span class="token operator">=</span>result<span class="token punctuation">)</span>
	model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>optimizers<span class="token punctuation">.</span>Nadam<span class="token punctuation">(</span>lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> model

<span class="token keyword">def</span> <span class="token function">train_network</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> model_file<span class="token punctuation">,</span> epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
	plot_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> to_file<span class="token operator">=</span><span class="token string">'{}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>model_file<span class="token punctuation">)</span><span class="token punctuation">,</span> show_shapes<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

	checkpoint <span class="token operator">=</span> ModelCheckpoint<span class="token punctuation">(</span>model_file<span class="token punctuation">,</span> monitor<span class="token operator">=</span><span class="token string">'val_loss'</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> save_best_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> save_weights_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>
	training <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>data<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> epochs<span class="token operator">=</span>epochs<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> validation_split<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">5.0</span><span class="token punctuation">,</span> class_weight<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callbacks<span class="token operator">=</span><span class="token punctuation">[</span>checkpoint<span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'{}.history'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>model_file<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> handle<span class="token punctuation">:</span>
		pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>training<span class="token punctuation">.</span>history<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	<span class="token comment"># arguments = parse_cli()</span>
	<span class="token comment"># data, labels = preprocess(*load_data(arguments.train))</span>
	<span class="token comment"># model = build_model(input_shape=data.shape[1:])</span>
	<span class="token comment"># train_network(model, data, labels, arguments.model, arguments.epochs)</span>
	
	n_epochs <span class="token operator">=</span> <span class="token number">10</span>
	trainset_path <span class="token operator">=</span> <span class="token string">'artificial.h5'</span>
	model_path <span class="token operator">=</span> <span class="token string">'model.h5'</span>
	
	data<span class="token punctuation">,</span> labels <span class="token operator">=</span> preprocess<span class="token punctuation">(</span><span class="token operator">*</span>load_data<span class="token punctuation">(</span>trainset_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
	model <span class="token operator">=</span> build_model<span class="token punctuation">(</span>input_shape<span class="token operator">=</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
	train_network<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> model_path<span class="token punctuation">,</span> n_epochs<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0623_2303"></a>06-23</h4> 
<blockquote> 
 <ul><li>稀疏训练这块还有不少人开发了模块，似乎速度就是会很慢，本质是节约空间么？不科学啊，先再看几篇弄清楚。感觉只剩最后六天想要给邓琪搞点名堂出来比较有挑战性，试试看咯，颜烨那边也在糊报告，不过他们不用汇报倒是容易。搞完邓琪的汇报想先回去休养一阵子了（但愿wyl那边没急事），明明上学期也是每天在跑，却也没像这学期瘦掉将近20多斤，真的太伤了。</li><li>罪过，下午上了个分，国战排位打到枭雄35星…</li><li>晚上每周一次的飞盘活动，上半场40分钟后，轻度疲劳状态下测了一次1000米，3分36秒，算是一个不错的成绩了，下半场打完慢跑了五圈收尾，北大的极限飞盘社社长ljw过一阵子要离开了，拍了一张合照留念（这学期玩了四五吧差不多），以后SUFE要真的有极限飞盘社，我们也算是社团的前身了哈哈。</li><li>这几天很热，想把1000米练进3分半，等28号下雨凉快下来之后跑一次10km以上的长距离耐力，然后回家之前计划再完成一次场地20km，上半年即完满。</li></ul> 
</blockquote> 
<p>吐了，原来<a href="https://caoyang.blog.csdn.net/article/details/116430150" rel="nofollow">使用CNN进行雅可比预条件子的生成</a>的项目代码里是有伪造数据生成的逻辑的额，不写README是真的坑，我以为直接从train开始跑，原来有extract_diagonals.py的… 还是颜烨眼神好[Facepalm]</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>

<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> h5py
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

DATA_DATASET <span class="token operator">=</span> <span class="token string">'matrixset'</span>
DIAGONALS_DATASET <span class="token operator">=</span> <span class="token string">'diagonalset'</span>
WINDOW <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">def</span> <span class="token function">parse_cli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
	parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
		metavar<span class="token operator">=</span><span class="token string">'DATA'</span><span class="token punctuation">,</span>
		<span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span>
		dest<span class="token operator">=</span><span class="token string">'data'</span><span class="token punctuation">,</span>
		<span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'path to the HDF5 file that stores the matrices'</span>
	<span class="token punctuation">)</span>

	<span class="token keyword">return</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">extract_diagonals</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
	handle <span class="token operator">=</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">)</span>
	<span class="token comment"># load the data and move the sample axis to the front</span>
	data <span class="token operator">=</span> np<span class="token punctuation">.</span>moveaxis<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>handle<span class="token punctuation">[</span>DATA_DATASET<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

	width <span class="token operator">=</span> data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	samples <span class="token operator">=</span> data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	diagonalset <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>samples<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> WINDOW <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

	<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
		image <span class="token operator">=</span> data<span class="token punctuation">[</span>j<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
		<span class="token comment"># always reallocate the diagonals image here to fill the left triangle with ones</span>
		out <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> WINDOW <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span>WINDOW<span class="token punctuation">,</span> WINDOW <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			diagonal <span class="token operator">=</span> np<span class="token punctuation">.</span>diagonal<span class="token punctuation">(</span>image<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
			out<span class="token punctuation">[</span>i <span class="token operator">+</span> WINDOW<span class="token punctuation">,</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> diagonal
		out <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>out <span class="token operator">-</span> out<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> out<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
		diagonalset<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> out

	<span class="token comment"># remove the previous diagonals set if present</span>
	<span class="token keyword">if</span> DIAGONALS_DATASET <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>handle<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">del</span> handle<span class="token punctuation">[</span>DIAGONALS_DATASET<span class="token punctuation">]</span>
	handle<span class="token punctuation">[</span>DIAGONALS_DATASET<span class="token punctuation">]</span> <span class="token operator">=</span> diagonalset
	<span class="token comment"># release the handle</span>
	handle<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	<span class="token comment"># arguments = parse_cli()</span>
	<span class="token comment"># extract_diagonals(arguments.data)</span>
</code></pre> 
<h4><a id="0624_2365"></a>06-24</h4> 
<blockquote> 
 <ul><li>高级运筹与优化理论还是挣扎回来了，卡位90分，卷面略差，好在七次作业分数还行。</li><li>老妈来沪办事，下午见了一面，真的是肉眼可见的变老了。这学期中途没有回家，所以四个月不见了，虽然每天都会通电话，但是一看到她越发苍老的脸，自己却正是年富力强，真的很不是滋味。一想到等我博士毕业妈妈可能已经快要六十岁，已经是可以叫奶奶的年纪了，真的好快好快，多想能慢一点，多给我一些时间罢。</li><li>晚4km跑，均配4’20"，太热，两圈心率就飙到160，状态也不太行。不过被WXY跟了5圈，我一看影子的摆臂动作就知道是他，想让他带我，结果直接把我给带崩了。</li><li>PS：我有点好奇到底是谁最近突然把我卖了，明明我断更上一篇log之后已经没有什么访问量了，为什么这两天每天有数十的访问，这个数量和监测到的访问频率应该不是脚本在刷，我想过要删了那篇log，奈何要扣分，而且博客数据也要掉，有点不忍心，这事情有点诡异，奈何现在CSDN更新之后查不到主要访问IP来源了，看且看罢。</li></ul> 
</blockquote> 
<p>lh开始展露他锋锐的一面，邓琪的汇报可能要借他六分力了，总归不能什么事情都是我来主导做。我目前在看一篇新的CNN稀疏训练paper，很有深度，争取今晚把笔注发出来，来不及了，接下来几天我要去院里做助管，这次给的比较多，半天100元，想必破事会很多，赚点外快吧。五体不勤整整一年了，做个人吧cy。</p> 
<p>下面是lh对随机karzman算法并行实现一个matlab脚本，lh在原文基础上想到了一些创新型的改进，确实加快了算法速度。我暂时没空看随机算法的paper，等我把我这边想做的东西的思路理清，再去学习一下，邓琪的汇报嘛，主要是内容质量，形式倒是次要的，说不定跟他聊半小时就算过了，所以得动点脑子。</p> 
<pre><code class="prism language-python">function x<span class="token operator">=</span>randKacz_Parrall<span class="token punctuation">(</span>A<span class="token punctuation">,</span>b<span class="token punctuation">,</span>x1<span class="token punctuation">)</span>
<span class="token punctuation">[</span>w<span class="token punctuation">,</span>l<span class="token punctuation">]</span><span class="token operator">=</span>size<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
funtol <span class="token operator">=</span> <span class="token number">100</span><span class="token operator">*</span>eps<span class="token punctuation">;</span>  xtol <span class="token operator">=</span> <span class="token number">100</span><span class="token operator">*</span>eps<span class="token punctuation">;</span>  maxiter <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> x1<span class="token punctuation">;</span>  
<span class="token operator">%</span>y <span class="token operator">=</span> A<span class="token operator">*</span>x<span class="token operator">-</span>b<span class="token punctuation">;</span>
dx <span class="token operator">=</span> Inf<span class="token punctuation">;</span>   <span class="token operator">%</span> <span class="token keyword">for</span> initial <span class="token keyword">pass</span> below
k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
p<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span>w
   p<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">=</span>norm<span class="token punctuation">(</span>A<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
end
p<span class="token operator">=</span>p<span class="token punctuation">.</span><span class="token operator">/</span><span class="token builtin">sum</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
c <span class="token operator">=</span> parcluster<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dx<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> maxiter<span class="token punctuation">)</span>
   <span class="token operator">%</span> r<span class="token operator">=</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">%</span> <span class="token keyword">for</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span>w
    <span class="token operator">%</span>    <span class="token keyword">if</span> r<span class="token operator">&lt;</span><span class="token builtin">sum</span><span class="token punctuation">(</span>p<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">%</span>        i<span class="token operator">=</span>j<span class="token punctuation">;</span>
    <span class="token operator">%</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token operator">%</span>     end
 <span class="token operator">%</span>   end
   
   <span class="token operator">%</span> a<span class="token operator">=</span>A<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">%</span> dx<span class="token operator">=</span><span class="token punctuation">(</span>b<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">-</span>dot<span class="token punctuation">(</span>a<span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>norm<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">;</span>
    <span class="token operator">%</span>size<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token operator">%</span>size<span class="token punctuation">(</span>dx'<span class="token punctuation">)</span>
  <span class="token operator">%</span> parpool<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
   parfor j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">500</span>
       dx<span class="token punctuation">(</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token builtin">iter</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>b<span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
   end
   <span class="token operator">%</span> dx<span class="token operator">=</span>load<span class="token punctuation">(</span>job<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'dx'</span><span class="token punctuation">)</span>
    step<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">500</span><span class="token punctuation">;</span>
    x<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> x<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token operator">+</span> step'<span class="token punctuation">;</span>
    <span class="token operator">%</span>y<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>norm<span class="token punctuation">(</span>A<span class="token operator">*</span>x<span class="token punctuation">(</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    k<span class="token operator">=</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token operator">%</span> y<span class="token operator">=</span>A<span class="token operator">*</span>x<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span>b<span class="token punctuation">;</span>
end
<span class="token keyword">if</span> k<span class="token operator">==</span>maxiter<span class="token punctuation">,</span> warning<span class="token punctuation">(</span><span class="token string">'Maximum number of iterations reached.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end
end
</code></pre> 
<h4><a id="0625_2418"></a>06-25</h4> 
<blockquote> 
 <ul><li>树欲静而风不止。早上碰到林振炜，得知叉院那边的硕博也有在看我的blog，看来把鬼子引到这里来的要么是刘天浩和刘宏瑞，要么是颜烨。</li><li>午饭留在院里跟几个不认识的老师打了会儿乒乓球，都有三年不碰乒乓球了，好在手感没有掉太多，反拧反拉都还能上得去，正手确实是生疏了。想想确实找个能日常一起打球的真的是不容易，年纪越大，人越忙，所以只能跑跑步。</li><li>确认了WXY的身份，金院大三的武新宇，也是江苏人。其实他去年这个时候差不多跟我现在的配速相仿，然后一年从4’20"提升到3’50"以内，10km的pb37分半，tql。晚上操场封闭，绕五角场跑了10km，均配4’40"，路况很差，天气也很闷，算是差强人意的一次路跑练习。也许我再练上一年也可以达到WXY的水平，期待自己5km与10km突破4分配的那一天，Fight！</li></ul> 
</blockquote> 
<p>我发现今天搭档的另一个助管杨静月居然也是个硕博，一起上了一学期的六门专业课，我居然一点印象也没有…</p> 
<p>李浩证明了随机Karzman算法的一些收敛性质，目前来看比较缓慢，算是伪一次收敛，不过收敛速度还是跟每次选取的矩阵行有关。我目前在学习自定义写优化器，但是可能还是很难把李浩那边的工作给融入进来，实在不行到时候我们各讲各的，反正都算是有一些成果，实在融合不起来也无能为力了。</p> 
<p>Karzman迭代算法用于解大规模线性系统<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         x 
        
       
         = 
        
       
         b 
        
       
      
        Ax=b 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span></span></span></span></span>：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
          
          
            k 
           
          
            + 
           
          
            1 
           
          
         
        
          = 
         
         
         
           x 
          
         
           k 
          
         
        
          − 
         
         
          
           
           
             A 
            
            
            
              r 
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
           
           
           
             x 
            
           
             k 
            
           
          
            − 
           
           
           
             b 
            
            
            
              r 
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
           
          
          
          
            ∥ 
           
           
           
             A 
            
            
            
              r 
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
           
           
           
             ∥ 
            
           
             2 
            
           
          
         
         
         
           A 
          
          
          
            r 
           
          
            ( 
           
          
            i 
           
          
            ) 
           
          
         
           ⊤ 
          
         
        
       
         x^{k+1}=x^k-\frac{A_{r(i)}x^k-b_{r(i)}}{\|A_{r(i)}\|^2}A_{r(i)}^\top 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.899108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.982438em; vertical-align: -0.08333em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.63551em; vertical-align: -1.0412em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.59431em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">∥</span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.7452em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.0412em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -2.428em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">r</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.447em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></p> 
<p>这里本质是随机挑选若干行<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
         ( 
        
       
         i 
        
       
         ) 
        
       
      
        r(i) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span></span></span>出来做迭代，有点类似<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         S 
        
       
         G 
        
       
         D 
        
       
      
        \rm SGD 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span><span class="mord mathrm">G</span><span class="mord mathrm">D</span></span></span></span></span></span>，但是步长并不完全相同。</p> 
<p>我们实现了该算法的并行，并证明了这个算法的收敛速度为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          1 
         
        
          q 
         
        
       
      
        \frac1q 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.32622em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">q</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         q 
        
       
      
        q 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">q</span></span></span></span></span>为每次提取的行的数量，需要在收敛速度与运行速度之间做一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         t 
        
       
         r 
        
       
         a 
        
       
         d 
        
       
         e 
        
       
         o 
        
       
         f 
        
       
         f 
        
       
      
        \rm tradeoff 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">t</span><span class="mord mathrm">r</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">e</span><span class="mord mathrm">o</span><span style="margin-right: 0.07778em;" class="mord mathrm">f</span><span style="margin-right: 0.07778em;" class="mord mathrm">f</span></span></span></span></span></span>，者需要一些实验结果的支撑。</p> 
<h4><a id="0626_2436"></a>06-26</h4> 
<blockquote> 
 <ul><li>早起发现sxy昨天怎么像打了鸡血，运动时长上到300多分钟… 我记得前天才70分钟，也太夸张了…（难以置信，晚上看到已经快500分钟了…）</li><li>这个周末要最后挣扎一下了，这几天跟yy交流了一下那篇CNN预测块雅可比预条件子的代码实现还是有所得的，不至于肚子里倒不出墨水。</li><li>晚上操场又封，不知道搞什么飞机。</li></ul> 
</blockquote> 
<p>我找到了之前SVD training的问题，是因为没有做剪枝，这个感觉实现起来不是那么容易，但是现在的情况是即便不剪枝，效果也不太行，剪了肯定更不行，而且具体要怎么在训练中剪枝，还不是很能透析，头疼，得动动脑子了。</p> 
<p>I get. 我知道怎么做了。</p> 
<h4><a id="0627_2446"></a>06-27</h4> 
<blockquote> 
 <ul><li>黄昏是我一天中状态最好的时候。我又是否算见到过真实的样子呢？总之别做让自己后悔的事情罢。</li><li>下午睡到昏天黑地，这几天莫名其妙晚上睡不着，乱我心者，皆称烦忧，又下不了决心再去拉黑。起来两个芒果补热量，进场破了1km的pb，3分28秒，完成了跑进3分半的夙愿。真的很感慨，从小体育无能，初中体测1km跑了4分50秒，本科6次体测最快的一次也就4分08秒。</li><li>碰到一个妈妈带着她5岁的儿子，跑了17圈，他妈妈说这孩子在家里搞得一团糟，出来让他跑到没力气，回去就不闹了。羡慕这种从小就热爱跑步的人，以后我要是也有个儿子，我每周一定抽空带他去跑步，人活着需要有信仰，否则跟机器有何区别？</li><li>开始动笔写report，实验该做的都做完了，现在的问题就是做的东西稍微有点零散，最后得找个主题把我和李浩做的给连结起来。</li></ul> 
</blockquote> 
<p>pdflatex+bibtex+pdflatex如果编译不通的话，试试xelatex+bibtex+xelatex，明明我之前都没问题的，过了一个月就编译不通了？</p> 
<p>后来想办法测试了剪枝，目前是直接定的SVD的秩数，发现即便定到个位数的水平，还是比原模型ResNet18要慢，差不多是要双倍的时间，真的是醉了，算下来明明模型参数少了好多，怎么还能更慢呢？</p> 
<p>还有一种策略是每隔若干轮后对模型剪枝，这在实现上要动点脑子，但是应该不难，只是这样应该只会更慢吧…</p> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         y 
        
       
         T 
        
       
         o 
        
       
         r 
        
       
         c 
        
       
         h 
        
       
      
        \rm PyTorch 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathrm">P</span><span style="margin-right: 0.01389em;" class="mord mathrm">y</span><span class="mord mathrm">T</span><span class="mord mathrm">o</span><span class="mord mathrm">r</span><span class="mord mathrm">c</span><span class="mord mathrm">h</span></span></span></span></span></span>中统计模型参数（可以手动统计，也可以调包<code>torchsummary</code>），以及统计模型的每秒浮点数运算次数（FLOPs）值的方法：</p> 
<pre><code class="prism language-python"><span class="token comment"># 计算深度模型的FLOPs</span>
<span class="token keyword">def</span> <span class="token function">evaluate_flops</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">from</span> thop <span class="token keyword">import</span> clever_format<span class="token punctuation">,</span> profile
	flops<span class="token punctuation">,</span> params <span class="token operator">=</span> profile<span class="token punctuation">(</span>model<span class="token punctuation">,</span> inputs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>flops<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span>
	flops<span class="token punctuation">,</span> params <span class="token operator">=</span> clever_format<span class="token punctuation">(</span><span class="token punctuation">[</span>flops<span class="token punctuation">,</span> params<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%.3f"</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>flops<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>

<span class="token comment"># 计算模型的参数数量</span>
<span class="token keyword">def</span> <span class="token function">count_params</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 定义总参数量、可训练参数量及非可训练参数量变量</span>
	Total_params <span class="token operator">=</span> <span class="token number">0</span>
	Trainable_params <span class="token operator">=</span> <span class="token number">0</span>
	NonTrainable_params <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token comment"># 遍历model.parameters()返回的全局参数列表</span>
	<span class="token keyword">for</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		mulValue <span class="token operator">=</span> np<span class="token punctuation">.</span>prod<span class="token punctuation">(</span>param<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 使用numpy prod接口计算参数数组所有元素之积</span>
		Total_params <span class="token operator">+=</span> mulValue  <span class="token comment"># 总参数量</span>
		<span class="token keyword">if</span> param<span class="token punctuation">.</span>requires_grad<span class="token punctuation">:</span>
			Trainable_params <span class="token operator">+=</span> mulValue  <span class="token comment"># 可训练参数量</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			NonTrainable_params <span class="token operator">+=</span> mulValue  <span class="token comment"># 非可训练参数量</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Total params: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>Total_params<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Trainable params: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>Trainable_params<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Non-trainable params: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>NonTrainable_params<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 模型总结</span>
<span class="token keyword">def</span> <span class="token function">torch_summary</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">:</span>
	pip install torchsummary
	<span class="token keyword">from</span> torchsummary <span class="token keyword">import</span> summary
	summary<span class="token punctuation">(</span>model<span class="token punctuation">,</span> input_size<span class="token operator">=</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0628_2497"></a>06-28</h4> 
<blockquote> 
 <ul><li>又是在食堂碰到一次，欲言又止，就看着人急着下楼去全家了。</li><li>计量也挣扎回来了，91分，还不错，这确是意料之外，毕竟课上从没答对过问题，平时分拉胯，期中也只有89。也许最后期末写满四张纸真的感动到周建老师了哈哈。不过周建为人确实很好，颇有大师风骨，又完全看不出大师架子（亲和力MAX）。</li><li>一天助管下来很累，五点后跑了5圈就不行了（TMD跑了五圈书包都给保安大哥没收了）。以后如果真的是996，很难每天维持一定强度的锻炼，因为工作完全会剥夺所有的精力。如果人从小到大一辈子都是在被逼着走，实在是太悲哀了，无可避免的话，那我宁可选择平庸。</li><li>明早九点是邓琪汇报的ddl，晚上得挑灯夜战了，思路还是比较清晰的，就是要控制一下时间，天佑。</li><li>某人最近又受啥刺激了… 发些莫名其妙的话。</li></ul> 
</blockquote> 
<p>最后理清了SVD training的所有思路，本质上其实就是先分解，再剪枝，这看起来很抽象，简单的说，对于一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Linear 
        
       
         ( 
        
       
         m 
        
       
         , 
        
       
         n 
        
       
         ) 
        
       
      
        \text{Linear}(m,n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">Linear</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>层，不算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         b 
        
       
         i 
        
       
         a 
        
       
         s 
        
       
      
        \rm bias 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">a</span><span class="mord mathrm">s</span></span></span></span></span></span>的话，一共是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         × 
        
       
         n 
        
       
      
        m\times n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span>个参数，现在相当于是把它分解成了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Linear 
        
       
         ( 
        
       
         m 
        
       
         , 
        
       
         r 
        
       
         ) 
        
       
      
        \text{Linear}(m,r) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">Linear</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mclose">)</span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Linear 
        
       
         ( 
        
       
         r 
        
       
         , 
        
       
         n 
        
       
         ) 
        
       
      
        \text{Linear}(r,n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">Linear</span></span><span class="mopen">(</span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>两个层（如果看作是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         W 
        
       
         = 
        
       
         U 
        
       
         D 
        
        
        
          V 
         
        
          ⊤ 
         
        
       
      
        W=UDV^\top 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.849108em; vertical-align: 0em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span>的分解，则前一个层<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          W 
         
        
          1 
         
        
       
         = 
        
       
         U 
        
        
        
          D 
         
        
       
      
        W_1=U\sqrt{D} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.04em; vertical-align: -0.113335em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.926665em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span></span></span><span class="" style="top: -2.88667em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
           <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
            <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
           </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.113335em;"><span class=""></span></span></span></span></span></span></span></span></span>，后一个层就是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          W 
         
        
          2 
         
        
       
         = 
        
        
        
          D 
         
        
        
        
          V 
         
        
          ⊤ 
         
        
       
      
        W_2=\sqrt{D}V^\top 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.04em; vertical-align: -0.113335em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.926665em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span></span></span><span class="" style="top: -2.88667em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
           <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
            <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
           </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.113335em;"><span class=""></span></span></span></span></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathdefault">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span>，当然说到这里其实可能有其他分解的形式，至少<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         S 
        
       
         V 
        
       
         D 
        
       
      
        \rm SVD 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span><span style="margin-right: 0.01389em;" class="mord mathrm">V</span><span class="mord mathrm">D</span></span></span></span></span></span>目前最浅显），这样的话参数数量就从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         n 
        
       
      
        mn 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">n</span></span></span></span></span>变成了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         r 
        
       
         + 
        
       
         r 
        
       
         n 
        
       
         = 
        
       
         r 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         n 
        
       
         ) 
        
       
      
        mr+rn=r(m+n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">m</span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>，如果是满秩分解，那么<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
         = 
        
       
         min 
        
       
         ⁡ 
        
       
         ( 
        
       
         m 
        
       
         , 
        
       
         n 
        
       
         ) 
        
       
      
        r=\min(m,n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>，则参数数量没有减少，反而增多，但是我们可以通过剪枝把<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
      
        r 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span></span></span></span></span>变得很小，那么就可以得到远小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         n 
        
       
      
        mn 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">n</span></span></span></span></span>的参数量。</p> 
<p>其实看起来还是很浅然的，都不需要做别的事情，但是其实因为选择了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         S 
        
       
         V 
        
       
         D 
        
       
      
        \rm SVD 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">S</span><span style="margin-right: 0.01389em;" class="mord mathrm">V</span><span class="mord mathrm">D</span></span></span></span></span></span>，所以<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         U 
        
       
         , 
        
       
         D 
        
       
      
        U,D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span></span></span></span></span>需要满足正交矩阵的条件，强制要求正交是很难的，所以需要添加一些正则项来控制<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         U 
        
       
         , 
        
       
         D 
        
       
      
        U,D 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">D</span></span></span></span></span>的正交程度，一般可以通过<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ∥ 
        
        
        
          U 
         
        
          ⊤ 
         
        
       
         U 
        
       
         − 
        
       
         I 
        
        
        
          ∥ 
         
        
          F 
         
        
       
      
        \|U^\top U-I\|_F 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.09911em; vertical-align: -0.25em;"></span><span class="mord">∥</span><span class="mord"><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">I</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.13889em;" class="mord mathdefault mtight">F</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>作为惩罚项，如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         U 
        
       
      
        U 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.10903em;" class="mord mathdefault">U</span></span></span></span></span>是正交的，那么显然惩罚项为零。至于为什么选择<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         F 
        
       
      
        F 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span></span></span></span></span>范数，因为算起来简单，求导容易，反向传播方便。</p> 
<p>其实笔者做了一些测试，发现SVD training并不比原模型快，以为是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
      
        r 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span></span></span></span></span>取得太大，后来发现是因为损失函数太难算所以很慢，去掉损失函数里的正则项一下子就变快了，真的是醉了，可能需要一些运算上技巧，按道理算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         F 
        
       
      
        F 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span></span></span></span></span>范数确实计算量有点大，但是比普通的矩阵二范数肯定是容易多了。</p> 
<h4><a id="0629_2510"></a>06-29</h4> 
<blockquote> 
 <ul><li>凌晨肝到将近两点搞完report和pptslide，早上自信给邓琪汇报，尚可，邓琪灵魂拷问为什么李浩跟我不分下来做，明明都做了很多工作，合在一起根本讲不完，我就纳闷了，明明你布置大作业的时候说要做得有深度一些，别做无聊的事情，现在李浩和我既做了理论证明，又搞定实现上的工作，你又嫌长，真TM难伺候。无妨，report写得够很详实了。</li><li>这学期彻底结束，曹某人又有何作为？可惜今天又闷又热，但是我还是想要赶在上半年最后两天再试一次20km的，下午补觉回状态，晚上拼拼看了。</li><li>唉，困到死午觉还睡不着，头疼，最近思想有问题。</li><li>晚上太扫兴了，八点临时被导师叫去办事，九点多才放人，20km计划泡汤，最后跑了3组2km的间歇，第一组均配3’59"，第二组均配4’08"（这组是裸奔狂带着跑的），第三组均配4’24"，间隔休息150秒，算是近期强度比较高的一次间歇训练。明天看情况吧，状态不行就不勉强自己了。</li></ul> 
</blockquote> 
<p>今天汇报时跟邓琪探讨了SVD training的细节（<a href="https://caoyang.blog.csdn.net/article/details/116707855" rel="nofollow">论文摘要</a>和<a href="https://caoyang.blog.csdn.net/article/details/117391702" rel="nofollow">代码实现</a>），刚好他对这篇paper比较熟悉。我提到说其实SVD training并不会加快训练速度，这似乎很反常识，直觉上降秩的模型应该会更快，但是其实如果选择满秩训练，则参数将会由<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         n 
        
       
      
        mn 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">n</span></span></span></span></span>变为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         n 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
      
        r(m+n+1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
         = 
        
       
         min 
        
       
         ⁡ 
        
       
         { 
        
       
         m 
        
       
         , 
        
       
         n 
        
       
         } 
        
       
      
        r=\min\{m,n\} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">min</span><span class="mopen">{<!-- --></span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">n</span><span class="mclose">}</span></span></span></span></span>，显然参数量变多了，自然会慢。而且就本人的实际测试结果来看，损失函数里计算正则项的时间是不容忽视的，甚至会占到60%以上的训练时间，当然这有可能是因为实现的不太好导致算的太慢。</p> 
<p>值得一提的是邓琪指出，SVD training的侧重点是加快了模型预测的速度，或者说是模型部署的速度。我提出一种可能的改进手段，因为如果选择满秩训练真的是太慢了，所以可以借鉴学习率（learning rate）的weight decay方法，我们隔一段时间手动对模型的秩进行降低（通过对奇异值向量剪枝即可），这个的难度在于如何代码实现，因为直觉上如果隔若干epoch后人工调整模型中权重参数的形状，是否是一件不太容易实现的事情？本质上似乎是要重新构建一个新的模型，然后把参数全部记录进去才行。可能需要实际尝试一下才能有定论。</p> 
<p>总之很可惜今天邓琪时间给的太少，其实我还有很多其他想法想要分享，包括之前看的哪个spconv包，这些确实是比较有趣的理论性内容，值得深究，比瞎几把调参有趣多了。</p> 
<h4><a id="0630_2522"></a>06-30</h4> 
<blockquote> 
 <ul><li>浑身酸痛，看来昨天的间歇还是太累。骑车左膝下面髌骨突然疼了一会儿，有点后怕，恐怕是没有机会再试一次半马了。只能晚上去跟ITCS的朋友玩会儿飞盘了。六月总跑量130多km，跟五月差不多的量，虽然很不情愿，但可能又要进一段休整期了。</li><li>批改本科生的期末卷子，本来老师说前面客观题都是送分的，现在看起来只有后面的程序题才是能送分的。客观题错了就是错了，都没有调和的余地，一堆人全错，只能给零分，救都救不了。程序题只要你写了东西总归可以友情给点儿分[Facepalm]</li><li>又是突然就多了100多分钟的运动时长，好厉害，之前我还想S续了一年多的会员怎么突然就不练了，原来是在憋大招呢。</li><li>晚上还是很想跑的，10km后浑身乏力。有点像发烧的那种乏力感，但是显然没有生病。精神状态特别差最近，有点想回家了养好身体再回来了。</li></ul> 
</blockquote> 
<p>添加正交正则项和稀疏导出正则项的交叉熵损失：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">CrossEntropyLossSVD</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">)</span><span class="token punctuation">:</span>

	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> size_average<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">reduce</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">'mean'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>CrossEntropyLossSVD<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>
			weight<span class="token operator">=</span>weight<span class="token punctuation">,</span>
			size_average<span class="token operator">=</span>size_average<span class="token punctuation">,</span>
			ignore_index<span class="token operator">=</span>ignore_index<span class="token punctuation">,</span>
			<span class="token builtin">reduce</span><span class="token operator">=</span><span class="token builtin">reduce</span><span class="token punctuation">,</span>
			reduction<span class="token operator">=</span>reduction<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> regularizer_weights<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> orthogonal_suffix<span class="token operator">=</span><span class="token string">'svd_weight_matrix'</span><span class="token punctuation">,</span> sparse_suffix<span class="token operator">=</span><span class="token string">'svd_weight_vector'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'lh'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">:</span>
		cross_entropy_loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> weight<span class="token operator">=</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span>self<span class="token punctuation">.</span>ignore_index<span class="token punctuation">,</span> reduction<span class="token operator">=</span>self<span class="token punctuation">.</span>reduction<span class="token punctuation">)</span>
		<span class="token keyword">if</span> model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> cross_entropy_loss
		
		<span class="token comment"># 正交正则器</span>
		<span class="token keyword">def</span> <span class="token function">_orthogonality_regularizer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>		 		 				 <span class="token comment"># x应当是一个2D张量（矩阵）且高大于宽</span>
			<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> torch<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token string">'fro'</span><span class="token punctuation">)</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		
		<span class="token comment"># 稀疏导出正则器</span>
		<span class="token keyword">def</span> <span class="token function">_sparsity_inducing_regularizer</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'lh'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>				 <span class="token comment"># x应当是一个1D张量（向量）</span>
			mode <span class="token operator">=</span> mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'lh'</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>	
			<span class="token keyword">elif</span> model <span class="token operator">==</span> <span class="token string">'l1'</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Unknown mode: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mode<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	
		regularizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> name<span class="token punctuation">,</span> parameter <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			lastname <span class="token operator">=</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
			<span class="token keyword">if</span> lastname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>orthogonal_suffix<span class="token punctuation">)</span><span class="token punctuation">:</span>					 <span class="token comment"># 奇异向量矩阵参数：添加正交正则项</span>
				regularizer <span class="token operator">+=</span> _orthogonality_regularizer<span class="token punctuation">(</span>parameter<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
			<span class="token keyword">elif</span> lastname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>sparse_suffix<span class="token punctuation">)</span><span class="token punctuation">:</span>					 <span class="token comment"># 奇异值向量参数：添加稀疏导出正则项</span>
				regularizer <span class="token operator">+=</span> _sparsity_inducing_regularizer<span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> mode<span class="token punctuation">)</span> <span class="token operator">*</span> regularizer_weights<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token keyword">return</span> cross_entropy_loss <span class="token operator">+</span> regularizer
</code></pre> 
<h3><a id="July_2021_2577"></a>July 2021</h3> 
<h4><a id="0701_2578"></a>07-01</h4> 
<blockquote> 
 <ul><li>六月总跑量140km，昨晚强行起跑的后果就是连右膝一起废了。自从寒假伤痛之后再没有伤成这样过，真的是贱骨头，一点记性都不长。接下来开始做些自重（正好体重掉了很多，说不定能拉得上引体），核心练稳，才能维持住高配速跑姿。晚上可能还是会去玩一下飞盘，昨天好多叉院的博士也慕名来玩，渐渐就热闹起来了。</li><li>缺觉极致疲乏，终于是睡了一个美美的午觉，要不是外面突然军训喊口号，我觉得能一觉睡到傍晚… 状态总算恢复，膝盖还是伤。</li><li>好久不去新园，结果晚饭去吃又碰见一次，应该是从图书馆过来的。自己是否还会有感觉？罢了。</li><li>在GitHub上开了个项目，计划深入svdtraining，在更多其他主流模型上的进行测试，包括对一些稀疏运算的研究，我觉得与其盲目建模，不如深耕一些理论性的内容，也许wyl并不能指导我这些内容，不过也不需要人来教我做事。</li></ul> 
</blockquote> 
<p>看看facebook的sparseconvnet里的池化是怎么写的：</p> 
<p>其实我有点好奇，就是目前大部分的稀疏DNN模块都是写的CNN，为什么没有人去做RNN的稀疏改进呢，我RNN不要面子的吗？</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">AveragePooling</span><span class="token punctuation">(</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Average Pooling for SparseConvNetTensors.
    Parameters:
      dimension i.e. 3
      pool_size i.e. 3 or [3,3,3]
      pool_stride i.e. 2 or [2,2,2]
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dimension<span class="token punctuation">,</span> pool_size<span class="token punctuation">,</span> pool_stride<span class="token punctuation">,</span> nFeaturesToDrop<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>AveragePooling<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dimension <span class="token operator">=</span> dimension
        self<span class="token punctuation">.</span>pool_size <span class="token operator">=</span> toLongTensor<span class="token punctuation">(</span>dimension<span class="token punctuation">,</span> pool_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pool_stride <span class="token operator">=</span> toLongTensor<span class="token punctuation">(</span>dimension<span class="token punctuation">,</span> pool_stride<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>nFeaturesToDrop <span class="token operator">=</span> nFeaturesToDrop

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        output <span class="token operator">=</span> SparseConvNetTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
        output<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">.</span>metadata
        output<span class="token punctuation">.</span>spatial_size <span class="token operator">=</span> <span class="token punctuation">(</span>
            <span class="token builtin">input</span><span class="token punctuation">.</span>spatial_size <span class="token operator">-</span> self<span class="token punctuation">.</span>pool_size<span class="token punctuation">)</span> <span class="token operator">//</span> self<span class="token punctuation">.</span>pool_stride <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>spatial_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>pool_stride <span class="token operator">+</span>
                self<span class="token punctuation">.</span>pool_size <span class="token operator">==</span> <span class="token builtin">input</span><span class="token punctuation">.</span>spatial_size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        output<span class="token punctuation">.</span>features <span class="token operator">=</span> AveragePoolingFunction<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>
            <span class="token builtin">input</span><span class="token punctuation">.</span>features<span class="token punctuation">,</span>
            <span class="token builtin">input</span><span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
            <span class="token builtin">input</span><span class="token punctuation">.</span>spatial_size<span class="token punctuation">,</span>
            output<span class="token punctuation">.</span>spatial_size<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>dimension<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>pool_size<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>nFeaturesToDrop<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output

    <span class="token keyword">def</span> <span class="token function">input_spatial_size</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> out_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>out_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>pool_stride <span class="token operator">+</span> self<span class="token punctuation">.</span>pool_size

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token string">'AveragePooling'</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>pool_size<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>pool_size<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span>\
                self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pool_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> \
                <span class="token string">'/'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pool_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>pool_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">')/('</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>pool_stride<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">')'</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>nFeaturesToDrop <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">' nFeaturesToDrop = '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>nFeaturesToDrop
        <span class="token keyword">return</span> s
</code></pre> 
<h4><a id="0702_2645"></a>07-02</h4> 
<blockquote> 
 <ul><li>钱逢胜之后又一个极品，查了一下本科不是本校的，稍微宽慰了一些。林子大了什么鸟都有，永远别把学校拿来说事，看看你能为学校做出过什么贡献，不是拿着学校的名头出去坑蒙拐骗，自己几斤几两心里要有数。</li><li>昨晚玩完飞盘感觉又满血复活了，连续的抢断长传，满场跑完全感觉不到累，总归是件幸事。</li><li>鬼天气，早上醒得早索性去图书馆待了一天。午休深睡，梦醒浑身无力，状态恢复了八九成，奈何外头像蒸馒头似的，暴雨、然后高温蒸煮，以此往复，闷得人透不过气。但愿暑假回家前能找到机会练次半马，这是醉后的倔强。</li><li>想就这么朝九晚十闭关两个月做出点东西来，可惜不愿放弃跑步，学习或许已非一切，可若抛弃，恐怕就一无是处了。</li></ul> 
</blockquote> 
<p>今天学会了些东西，很满足。但不想写太多，给之后写博客留点素材，总之深入研究了一下<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         PyTorch 
        
       
      
        \text{PyTorch} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">PyTorch</span></span></span></span></span></span>里的损失函数和优化器的一些进阶性的用法，主要在优化svdtraining的代码时遇到一些问题。</p> 
<p>提一个比较小的问题，最近旧机上的<code>jupyter</code>突然不可用，装的<code>Anaconda</code>自带<code>jupyter</code>，应该是不会有问题的。无奈只能去重装了一遍：</p> 
<pre><code>pip install jupyter notebook -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>但是发生报错：</p> 
<pre><code>Cannot uninstall 'terminado'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.
</code></pre> 
<p>其实这个报错目前网上还真没有人给出正确的解决方案，我试了别人提供的解决方案都是不可行的（加<code>--user</code>参数？）。这个问题的本质是因为site-packages里的安装信息与其他包发生冲突，导致pip不知道如何正确卸载<code>terminado</code>包。</p> 
<p>好在之前碰到过类似的问题，我记不清具体是卸载哪个包了，好像是<code>Anaconda</code>自带的一个原装包，然后其实只要在pip命令上添加参数<code>----ignore-installed</code>即可：</p> 
<pre><code class="prism language-python">pip install terminado <span class="token operator">-</span><span class="token operator">-</span>upgrade <span class="token operator">-</span><span class="token operator">-</span>ignore<span class="token operator">-</span>installed <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
</code></pre> 
<h4><a id="0703_2668"></a>07-03</h4> 
<blockquote> 
 <ul><li>练一次半马就回扬州，想留下点什么再走，总不能全是遗憾。</li><li>一段很长的悲伤过去了么？这怕不是又动情了。</li><li>下午雷暴，总算消些暑气。屯香蕉和巧克力，今日休整早睡，计划明早五点开练半马，天佑能够成功。</li></ul> 
</blockquote> 
<p>第一版挂到<a href="https://github.com/umask000/svdtraining">GitHub@svdtraining</a>，有点奇怪，这次我改写的是torchvision.models.resnet里的源码，之前别人写的ResNets18好像比torchvision里自带的源码要快好多，不知道是不是实现上有区别。目前遇到的一个非常困难的点，就是如何在训练过程中手动去修改模型参数，简单地说我想手动在训练过程中对模型剪枝，看似很容易，但是实现起来好像真的很复杂，如果直接改模型里的参数，这就意味着要把模型里每个层的参数都改一遍，这个其实是很麻烦的事情，而且改完之后我发现再训练它就不变了，即便我设置了require_grad=true，还有一种思路就是重写一个ResNets类，然后里面所有层的权重参数的初始化都要重写（因为要换成已经训练好的参数），总之就是很复杂，甚至都不能很好地表述清楚我想说什么… 算了，等我搞完再说了。</p> 
<h4><a id="0704_2675"></a>07-04</h4> 
<blockquote> 
 <ul><li>早5:45起，面包+香蕉+燕麦+奶粉+士力架，五神装6:45起跑，结果先是极闷，10圈后实在太难受脱掉上衣，20圈又被保安大哥勒令穿回去（TMD裸奔狂天天晚上跑，操场那么多人都不管，我赶个大早路上都没几个人，真就针对呗）， 25圈结束开始下大雨，27圈右腹岔气，硬撑了1圈只得退场。最终是53分整完成11.30km，其实10圈之后慢慢状态已经起来了，后程基本已经可以维持得住4’40"以内的配速（主要有一个水平相仿的大爷跟我一起跑，比较激励），只能说天时不利，遗憾透顶。</li><li>姨父被下病危通知，罹患肺癌已经十个月，如果真的出事，妈妈也得过来。服役的表哥今天紧急赶回，对我来说这可能是第一个即将要离世的父辈近亲，虽然也不算特别亲近（其实儿子跟父亲一般倒不是太亲近，但是真的失去父亲一定还是会特别难受，而且这对妈妈也是很大的打击），但是也很感慨，毕竟表哥的年纪与我只差了八天，转眼我们这一辈也不再年轻。</li><li>晚上探病，午睡至三点，睡到昏天黑地，整个人都快睡死了。想以后就每天晨跑5km，难度也不大，这样就可以在图书馆待一整天不用出来了，就是一天得洗两次澡，又怕早上起不来，回家后倒可以试试。总之受天气影响，最近长距离水平明显掉了很多，要尽快调整起来，至于半马练习，一定会再试，直到能够成功在最恶劣的天气。</li><li>这几天总是能在新食堂或者图书馆遇见某些人，可是我也不太想去实验室或者院楼，天气闷热在寝室也待不住，也便就这么过罢，心态放正。</li></ul> 
</blockquote> 
<p>最终我实现了隔一段epoch对模型进行SVD剪枝的操作，其实也不太难，就是需要多测试几种写法，因为torch的loss和optimizer其实功能是很强大的，执行逻辑跟想象的有区别（PS：GitHub真香，我要另辟战场）</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*- </span>
<span class="token comment"># @author : caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> sys
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">)</span>


<span class="token keyword">import</span> time
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> logging

<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">from</span> torch <span class="token keyword">import</span> optim
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>models <span class="token keyword">import</span> resnet


<span class="token keyword">from</span> config <span class="token keyword">import</span> ModelConfig
<span class="token keyword">from</span> src<span class="token punctuation">.</span>data <span class="token keyword">import</span> load_cifar
<span class="token keyword">from</span> src<span class="token punctuation">.</span>models <span class="token keyword">import</span> svd_resnet
<span class="token keyword">from</span> src<span class="token punctuation">.</span>svd_loss <span class="token keyword">import</span> CrossEntropyLossSVD
<span class="token keyword">from</span> src<span class="token punctuation">.</span>svd_layer <span class="token keyword">import</span> Conv2dSVD<span class="token punctuation">,</span> LinearSVD
<span class="token keyword">from</span> src<span class="token punctuation">.</span>utils <span class="token keyword">import</span> summary_detail<span class="token punctuation">,</span> initialize_logging<span class="token punctuation">,</span> load_args<span class="token punctuation">,</span> svd_layer_prune

<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
        ckpt_root <span class="token operator">=</span> <span class="token string">'../ckpt/'</span>                                                                                          <span class="token comment"># model checkpoint path</span>
        logging_root <span class="token operator">=</span> <span class="token string">'../logging/'</span>                                                                                    <span class="token comment"># logging saving path</span>
        data_root <span class="token operator">=</span> <span class="token string">'../data/'</span>                                                                                          <span class="token comment"># dataset saving path</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        ckpt_root <span class="token operator">=</span> <span class="token string">'ckpt/'</span>                                                                                             <span class="token comment"># model checkpoint path</span>
        logging_root <span class="token operator">=</span> <span class="token string">'logging/'</span>                                                                                       <span class="token comment"># logging saving path</span>
        data_root <span class="token operator">=</span> <span class="token string">'data/'</span>                                                                                             <span class="token comment"># dataset saving path</span>

    <span class="token comment"># Load model</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>
    model<span class="token punctuation">,</span> model_name <span class="token operator">=</span> svd_resnet<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

    <span class="token comment"># Initialize logging</span>
    initialize_logging<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>logging_root<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string">.log'</span></span><span class="token punctuation">,</span> filemode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>

    <span class="token comment"># Group model parameters</span>
    orthogonal_params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    sparse_params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> name<span class="token punctuation">,</span> parameter <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lastname <span class="token operator">=</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> lastname <span class="token operator">==</span> <span class="token string">'left_singular_matrix'</span> <span class="token keyword">or</span> lastname <span class="token operator">==</span> <span class="token string">'right_singular_matrix'</span><span class="token punctuation">:</span>
            orthogonal_params<span class="token punctuation">.</span>append<span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> lastname <span class="token operator">==</span> <span class="token string">'singular_value_vector'</span><span class="token punctuation">:</span>
            sparse_params<span class="token punctuation">.</span>append<span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>

    <span class="token comment"># Group modules</span>
    svd_module_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    svd_module_expressions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> name<span class="token punctuation">,</span> modules <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> Conv2dSVD<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> LinearSVD<span class="token punctuation">)</span><span class="token punctuation">:</span>
            svd_module_names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
            expression <span class="token operator">=</span> <span class="token string">'model'</span>
            <span class="token keyword">for</span> character <span class="token keyword">in</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> character<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    expression <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f'[</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>character<span class="token punctuation">}</span></span><span class="token string">]'</span></span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    expression <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f'.</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>character<span class="token punctuation">}</span></span><span class="token string">'</span></span>
            svd_module_expressions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>

    <span class="token comment"># Define loss function and optimizer</span>
    loss <span class="token operator">=</span> CrossEntropyLossSVD<span class="token punctuation">(</span><span class="token punctuation">)</span>
    optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>args<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span> momentum<span class="token operator">=</span>args<span class="token punctuation">.</span>momentum<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span>args<span class="token punctuation">.</span>weight_decay<span class="token punctuation">)</span>

    optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'params'</span><span class="token punctuation">:</span> orthogonal_params<span class="token punctuation">,</span> <span class="token string">'lr'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>orthogonal_learning_rate<span class="token punctuation">,</span> <span class="token string">'momentum'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>orthogonal_momentum<span class="token punctuation">,</span> <span class="token string">'weight_decay'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>orthogonal_weight_decay<span class="token punctuation">}</span><span class="token punctuation">,</span>
                           <span class="token punctuation">{<!-- --></span><span class="token string">'params'</span><span class="token punctuation">:</span> sparse_params<span class="token punctuation">,</span> <span class="token string">'lr'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>sparse_learning_rate<span class="token punctuation">,</span> <span class="token string">'momentum'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>sparse_momentum<span class="token punctuation">,</span> <span class="token string">'weight_decay'</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>sparse_weight_decay<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          lr<span class="token operator">=</span>args<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span>
                          momentum<span class="token operator">=</span>args<span class="token punctuation">.</span>momentum<span class="token punctuation">,</span>
                          weight_decay<span class="token operator">=</span>args<span class="token punctuation">.</span>weight_decay<span class="token punctuation">)</span>

    <span class="token comment"># Load dataset</span>
    trainloader<span class="token punctuation">,</span> testloader <span class="token operator">=</span> load_cifar<span class="token punctuation">(</span>root<span class="token operator">=</span>data_root<span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span>args<span class="token punctuation">.</span>batch_size<span class="token punctuation">)</span>
    num_batches <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>summary<span class="token punctuation">:</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            input_size <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape
            summary_detail<span class="token punctuation">(</span>model<span class="token punctuation">,</span> input_size<span class="token operator">=</span>input_size<span class="token punctuation">)</span>
            <span class="token keyword">break</span>

    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>max_epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Train</span>
        epoch_start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
        total_losses <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>
        correct_count <span class="token operator">=</span> <span class="token number">0</span>
        total_count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            X_train<span class="token punctuation">,</span> y_train <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            y_prob <span class="token operator">=</span> model<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
            loss_value <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_prob<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> orthogonal_params<span class="token punctuation">,</span> sparse_params<span class="token punctuation">)</span>
            loss_value<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            total_losses <span class="token operator">+=</span> loss_value<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
            _<span class="token punctuation">,</span> y_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>y_prob<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            total_count <span class="token operator">+=</span> y_train<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            correct_count <span class="token operator">+=</span> <span class="token punctuation">(</span>y_pred <span class="token operator">==</span> y_train<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            train_accuracy <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">.</span> <span class="token operator">*</span> correct_count <span class="token operator">/</span> total_count
            logging<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'[Epoch:%d, Iteration:%d] Loss: %.03f | Train accuarcy: %.3f%%'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                                                                             i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> epoch <span class="token operator">*</span> num_batches<span class="token punctuation">,</span>
                                                                                             total_losses <span class="token operator">/</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                                                           train_accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
        epoch_end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Prune</span>
        <span class="token keyword">if</span> args<span class="token punctuation">.</span>svd_prune <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>svd_prune_cycle <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> expression <span class="token keyword">in</span> svd_module_expressions<span class="token punctuation">:</span>
                svd_layer_prune<span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">,</span> threshold<span class="token operator">=</span>args<span class="token punctuation">.</span>svd_prune_threshold<span class="token punctuation">,</span> reduce_by<span class="token operator">=</span>args<span class="token punctuation">.</span>svd_prune_decay<span class="token punctuation">,</span> min_rank<span class="token operator">=</span>args<span class="token punctuation">.</span>svd_prune_min_rank<span class="token punctuation">)</span>

        <span class="token comment"># Test</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Waiting Test ...'</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            correct_count <span class="token operator">=</span> <span class="token number">0</span>
            total_count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> data <span class="token keyword">in</span> testloader<span class="token punctuation">:</span>
                X_test<span class="token punctuation">,</span> y_test <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
                y_prob <span class="token operator">=</span> model<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
                _<span class="token punctuation">,</span> y_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>y_prob<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                total_count <span class="token operator">=</span> y_test<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                correct_count <span class="token operator">+=</span> <span class="token punctuation">(</span>y_pred <span class="token operator">==</span> y_test<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            test_accuracy <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">.</span> <span class="token operator">*</span> correct_count <span class="token operator">/</span> total_count
            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'EPOCH=%03d | Accuracy= %.3f%%, Time=%.3f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> test_accuracy<span class="token punctuation">,</span> epoch_end_time <span class="token operator">-</span> epoch_start_time<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># Save model to checkpoints</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>ckpt_cycle <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Saving model ...'</span><span class="token punctuation">)</span>
                torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ckpt_root <span class="token operator">+</span> model_name <span class="token operator">+</span> <span class="token string">'_%03d.pth'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    args <span class="token operator">=</span> load_args<span class="token punctuation">(</span>ModelConfig<span class="token punctuation">)</span>
    train<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0705_2826"></a>07-05</h4> 
<blockquote> 
 <ul><li>昨晚回程被个地痞追了一路，实话说很喜欢这种竞逐的刺激，虽然是有些危险，难得享受一下，无碍，毕竟在围墙内憋太久了。以后有机会可以试试长距离的公路车骑行，感觉以现在的耐力应该能坚持得到百八十公里。</li><li>新生军训今晚在操场联欢，教官和学生轮流着在表演节目，十分欢快。当然我也并没什么不高兴的事，只是有些不相通罢了。晚饭又在食堂看到，话说我还真有够脸盲，扎了辫子就认不出来了，还是看到手环才能确认，话说真的是吃了好久…</li><li>晚31℃，按4’05"的均配去练了5圈+3圈的间歇，心率爆炸，很难在这种天气坚持很久，夏天彻底来了。等新生军训完再抽个清晨去试一次半马，还是很固执唉，真是一点没变。</li></ul> 
</blockquote> 
<p>这两天进度稍缓，但是也算是更新了很多内容。其实很想把这几天做得事情写成博客，但是感觉内容特别多，而且条理有些混乱，自己又不是那么空闲，看情况吧，有兴致就写点东西，可能真的是年纪越大，做事越没激情了。年轻真好呵（开始练自重，菜得真实，俯卧撑都做不来，果然自重跟体重一点关系都没有，菜就是菜）。</p> 
<p>提一个比较小的问题，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         y 
        
       
         T 
        
       
         o 
        
       
         r 
        
       
         c 
        
       
         h 
        
       
      
        \rm PyTorch 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathrm">P</span><span style="margin-right: 0.01389em;" class="mord mathrm">y</span><span class="mord mathrm">T</span><span class="mord mathrm">o</span><span class="mord mathrm">r</span><span class="mord mathrm">c</span><span class="mord mathrm">h</span></span></span></span></span></span>中我们要导出<code>argparser</code>中的参数时，可以用<code>json</code>导出，具体像这个样子：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> argparser

<span class="token keyword">def</span> <span class="token function">load_args</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span><span class="token punctuation">:</span>
    config <span class="token operator">=</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser <span class="token operator">=</span> config<span class="token punctuation">.</span>parser
    <span class="token keyword">return</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">save_args</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> save_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> save_path <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        save_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'../logging/config_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d%H%M%S"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.json'</span></span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>比如需要保存的<code>Config</code>参数是<code>ModelConfig</code>像这样的配置类：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author : caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> argparse

<span class="token keyword">from</span> torch <span class="token keyword">import</span> optim

<span class="token keyword">class</span> <span class="token class-name">ModelConfig</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--summary'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--ckpt_cycle'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--max_epoch'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--batch_size'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--learning_rate'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--orthogonal_regularizer_weight'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sparsity_regularizer_weight'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--orthogonal_learning_rate'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sparsity_learning_rate'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--momentum'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">.9</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--orthogonal_momentum'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">.9</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sparsity_momentum'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">.9</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--weight_decay'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--orthogonal_weight_decay'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sparsity_weight_decay'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--optimizer'</span><span class="token punctuation">,</span> default<span class="token operator">=</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">type</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_cycle'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_rank_each_time'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_threshold'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_decay'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_min_rank'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--svd_prune_min_decay'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">.1</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    config<span class="token operator">=</span> ModelConfig<span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser <span class="token operator">=</span> config<span class="token punctuation">.</span>parser
    args<span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>但是你会发现是无法导出为<code>json</code>的，因为配置类中有一个无法序列化的参数：</p> 
<pre><code class="prism language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--optimizer'</span><span class="token punctuation">,</span> default<span class="token operator">=</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">type</span><span class="token punctuation">)</span>
</code></pre> 
<p>那么此时就需要自定义序列化方式，我们修改<code>save_args</code>函数如下所示即可：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">save_args</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> save_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">class</span> <span class="token class-name">_MyEncoder</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">default</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token keyword">return</span> json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">.</span>default<span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>

    <span class="token keyword">if</span> save_path <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        save_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'../logging/config_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d%H%M%S"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.json'</span></span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span> cls<span class="token operator">=</span>_MyEncoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0706_2915"></a>07-06</h4> 
<blockquote> 
 <ul><li>到晚才更，一个原因是白天啥事都没有，闭关把最近的工作整理成文<a href="https://caoyang.blog.csdn.net/article/details/118528910" rel="nofollow">【项目总结】SVD Training（终焉）</a>，个人觉得算是近期比较满意的一篇博客，最后写些后记缓释一下心情。接下来重启其他工作，SVD training告一段落。</li><li>可能是写完博客比较满足，状态还不错，进场冲3km，追平pb（12’04"），上一个3km的pb是在20℃的阴天跑的，今天最高气温35℃，算是非常不错的进步，而且难得被裸奔狂跟了一圈半。2km用时8’08"，以为稳破4km的pb（16’56"），但是6圈后感觉不如提速冲击一下3km12分的梦想，结果还是差了几秒，感觉血亏。下一个好状态何时能来？</li><li>后来休息了5分钟又冲了一个1km，跑完喝水到反胃，难受了将近半个小时，楼梯都爬不动，以前跑20km都没这么难受过，天热还是伤。</li><li>老妈天天催我回去，唉，或许回去也是一个不错的选择罢，只是可能就再也没有机会了（啪！你以为留下来就会有机会了？——人总是要有梦想的嘛~）</li></ul> 
</blockquote> 
<p>python的日志初始化：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">initialize_logging</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> filemode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
        level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span>
        <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s | %(filename)s | %(levelname)s | %(message)s'</span><span class="token punctuation">,</span>
        datefmt<span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span>
        filename<span class="token operator">=</span>filename<span class="token punctuation">,</span>
        filemode<span class="token operator">=</span>filemode<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    console <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
    formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s | %(filename)s | %(levelname)s | %(message)s'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
    logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>console<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0707_2939"></a>07-07</h4> 
<blockquote> 
 <ul><li>EMNLP2020上找了几十篇跟逻辑推理相关的paper，准备做一个论文合集整理，总归还是要回到wyl门下，感觉推理可以作为一个长久的课题。</li><li>看了半天强化学习，很久不做原理都忘了，然后意外发现一个做物理引擎和机器人的包pybullet，不过好像比较难装，看起来会很有趣。</li><li>晚上暴雨，进程赤膊跑了10km，真TMD爽，要是穿着衣服肯定湿透难受地不得了，赤膊上阵，雨下得越大跑得越舒服，那种全场只有自己一个人，极好的状态下在暴雨中狂奔的快感，真的是无法用言语表达。只可惜最后两双鞋灌水湿透，步伐节奏全乱了，要不然至少感觉30圈是可以坚持得到的。</li><li>今晚本意仍是冲半马，但就近日的情况来看，夏天要零补给地跑完一次半马，难度非常大，今晚【暴雨清凉 + 状态高昂】，天时地利人和占尽，还是失败。接下来操场只在17:00-22:00开放，赶早起跑不再可能。军训结束后，食堂很快就要大面积关闭，连伙食都得不到保障。还是趁早回家算了，只是那路线主任… 下学期再来争罢，反正我还要待至少四年，毕业前早晚成为田径场上的一个传说[笑]。</li><li>我现在才意识到党妹好像是个B站UP，之前看到还以为是那个叫呆妹的主播… 反正每年百大UP总有几个要出事，之前那个叫啥槐安遗梦的，不过也秽土转生了。今年LEXBURNER也暴毙，到现在都没复活；回形针纯属内鬼，立场不同就不谈了。所以说像泛式、散人、毕导这些高学历出身的UP，总归三观要正得多，虽说人红是非多，但是最起码的底线得有，娱乐性质的UP还是少点为好，奶嘴太多的环境，早晚会出事的。</li></ul> 
</blockquote> 
<p>关于WIN10上pybullet的安装，一般需要跟gym库一起装，我是选择先装gym包，这个一般直接用pip安装就可以，不会有什么问题。</p> 
<p>但是pybullet的安装确实比较麻烦，pip带清华镜像总是提示没有兼容的包，不带镜像这个包太大也很难下得完，其实直接去<a href="https://pypi.tuna.tsinghua.edu.cn/simple/pybullet/" rel="nofollow">https://pypi.tuna.tsinghua.edu.cn/simple/pybullet/</a>里找最新的（目前是pybullet-3.1.7.tar.gz）即可。</p> 
<p>然后可以手动安装这把tar.gz包，解压后分别执行</p> 
<pre><code>python setup.py build
python setup.py install
</code></pre> 
<p>即可。但是如果没有VS环境会报错</p> 
<pre><code>error: Microsoft Visual C++ 14.0 is required.
</code></pre> 
<p>这个问题遇到过无数次，但是自己一直懒得装VS。安装VS可参考<a href="https://zhuanlan.zhihu.com/p/165008313" rel="nofollow">https://zhuanlan.zhihu.com/p/165008313</a>，主要很多前人提供的安装包都有损坏，还是要去官网拿最新的VS2019社区版（免费），然后按照链接里的教程勾选几个扩展即可，还是比较便捷的。</p> 
<p>在旧机上装好pybullet可用，接下来边读paper，边做些有意思的事情吧，上手了再在新机上做，要真有趣就买个带物理引擎的机器人回来捣鼓捣鼓，感觉pybullet是个有趣的玩意儿，可惜跟我的方向不太搭。唉，我还是应该去读个工科。</p> 
<h4><a id="0708_2965"></a>07-08</h4> 
<blockquote> 
 <ul><li>武东田径场和篮球场翻新，从本月10日到开学，似乎已经没有理由留下了，唉，终究还是如此遗憾的结束了，各种意义上。</li><li>早上发现图书馆四五楼的台灯区都封闭了，五楼空间又满座，不知道从哪儿冒出这么多人来。只得回院里开个空房间呆上半天。三点雷雨大作，似乎将要下到午夜，又是沉郁的一天。</li><li>裸奔一时爽，一直裸奔一直爽。可惜今晚状态很差，5km报销。明天是田径场开放的最后一天，估摸着冲上半马的机会渺茫，整个跑步历史上从未连续两天跑过10km以上的距离（跑步机除外），这几天身体感觉已经完全耗尽，而且食堂是越来越吃不下去。</li><li>回家吧cy，别在这挣扎了，不会有什么结果，而且，你也不会去主动争取些什么，不是么？</li><li>悉实而慎论，还是少些戾气为好。片弟这次撞上枪口，连陈睿也受波及，有心人总是要搞些噱头带带节奏，不过就目前的情况看B站公关做得还行，没搞出什么爆炸热搜。讥笑别人为富不仁，又有多少人能追逐最初的梦想呢？也许会有吧，但可能大都已经被洪水猛兽所吞噬了，屠龙勇士终成恶魔，就是如今社会的悲剧。</li></ul> 
</blockquote> 
<p>抄了一段pybullet的Helloworld脚本，没怎么看懂，但是好有意思啊，这玩意儿其实是做机器人的强化学习的，所以现在改行学做自动驾驶还来得及嘛~</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> pybullet <span class="token keyword">as</span> p
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

physicsClient <span class="token operator">=</span> p<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>p<span class="token punctuation">.</span>GUI<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>setGravity<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span>
planeId <span class="token operator">=</span> p<span class="token punctuation">.</span>loadURDF<span class="token punctuation">(</span><span class="token string">"plane.urdf"</span><span class="token punctuation">)</span>
cubeStartPos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
cubeStartOrientation <span class="token operator">=</span> p<span class="token punctuation">.</span>getQuaternionFromEuler<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
boxId <span class="token operator">=</span> p<span class="token punctuation">.</span>loadURDF<span class="token punctuation">(</span><span class="token string">"r2d2.urdf"</span><span class="token punctuation">,</span> cubeStartPos<span class="token punctuation">,</span> cubeStartOrientation<span class="token punctuation">)</span>
cubePos<span class="token punctuation">,</span> cubeOrn <span class="token operator">=</span> p<span class="token punctuation">.</span>getBasePositionAndOrientation<span class="token punctuation">(</span>boxId<span class="token punctuation">)</span>

useRealTimeSimulation <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>useRealTimeSimulation<span class="token punctuation">)</span><span class="token punctuation">:</span>
	p<span class="token punctuation">.</span>setRealTimeSimulation<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>useRealTimeSimulation<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>useRealTimeSimulation<span class="token punctuation">)</span><span class="token punctuation">:</span>
		p<span class="token punctuation">.</span>setGravity<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span>
		sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>	<span class="token comment"># Time in seconds.</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		p<span class="token punctuation">.</span>stepSimulation<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/b6/4jMD0M1n_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="0709_3005"></a>07-09</h4> 
<blockquote> 
 <ul><li>有点难受，就在眼前，还是犹豫了要不要前去吃饭聊一会儿，总觉得还是太唐突了。真实的无力。</li><li>看了一篇关于多级推理的文，很有趣，居然还用到了最大流的整数规划，真是强行高端，不过确实值得借鉴，计划读个十来篇做个合集，前几篇先详读，后面开始略读，主要还有代码要一起看，精读论文真的很麻烦。</li><li>晚上强行冲半马。至少在跑步上还不想留下遗憾。第一个10km用时45分13秒，休息15分钟开始第二段10km，这可能是我一年半来最艰辛的一次跑步了，38圈结束小腿已经完全软了；45圈结束心肺大腿全部到极限，完全迈不开步子；19km看到胡总和林总来跑，我已经完全没有力气再跟他们打招呼了，20km结束，一共喝光四瓶水，最终20km用时1小时32分半，虽然比5月17日的要快上不少，但是由于还是分段，不过天气也要热得多，所以勉强算是半斤八两。明日操场翻新，这就是我的最后之作了，下学期来时，希望自己能够脱胎换骨，在各种层面上。</li></ul> 
</blockquote> 
<p>推一篇多级推理的文，个人觉得比较有创新，看得差不多了，但是不准备更新，屯点货，发个长文。</p> 
<blockquote> 
 <ul><li> <p>论文标题：<em>PRover: Proof Generation for Interpretable Reasoning over Rules</em></p> </li><li> <p>中文标题：<strong>证明器：通过在规则上进行可解释的推理生成证明过程</strong></p> </li><li> <p>论文下载地址：<a href="https://aclanthology.org/2020.emnlp-main.9/" rel="nofollow"><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             2020.emnlp-main.9 
            
           
          
            \text{2020.emnlp-main.9} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">2020.emnlp-main.9</span></span></span></span></span></span></a></p> </li><li> <p>论文项目地址：<a href="https://github.com/swarnaHub/PRover"><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
         
          
           
           
             GitHub@PRover 
            
           
          
            \text{GitHub@PRover} 
           
          
        </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">GitHub@PRover</span></span></span></span></span></span></a></p> </li><li> <p>论文引用：</p> <pre><code class="prism language-tex">@inproceedings{saha2020prover,
  title={<!-- -->{PR}over: Proof Generation for Interpretable Reasoning over Rules},
  author={Saha, Swarnadeep and Ghosh, Sayan and Srivastava, Shashank and Bansal, Mohit},
  booktitle={EMNLP},
  year={2020}
}
</code></pre> </li></ul> 
</blockquote> 
<h4><a id="0710_3031"></a>07-10</h4> 
<blockquote> 
 <ul><li>壹夜</li></ul> 
</blockquote> 
<p>关于自然语言推断中的证明表示：</p> 
<p><strong>证明</strong>（<em>proof</em>）<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         = 
        
       
         ( 
        
       
         N 
        
       
         , 
        
       
         E 
        
       
         ) 
        
       
      
        \mathcal{P}=(\mathcal{N},\mathcal{E}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.08222em;" class="mord mathcal">P</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.14736em;" class="mord mathcal">N</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.08944em;" class="mord mathcal">E</span></span><span class="mclose">)</span></span></span></span></span>是一个有向图，其中：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
           
             N 
            
           
          
          
           
            
             
            
              ⊆ 
             
            
              R 
             
            
              ∪ 
             
            
              F 
             
            
              ∪ 
             
            
              NAF 
             
            
           
          
         
         
          
           
           
             E 
            
           
          
          
           
            
             
            
              ⊆ 
             
            
              N 
             
            
              × 
             
            
              N 
             
            
           
          
         
        
       
         \begin{aligned} \mathcal{N}&amp;\subseteq R\cup F\cup \text{NAF}\\ \mathcal{E}&amp;\subseteq\mathcal{N}\times\mathcal{N} \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3em; vertical-align: -1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.14736em;" class="mord mathcal">N</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.08944em;" class="mord mathcal">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.75em;"><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.00773em;" class="mord mathdefault">R</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord text"><span class="mord">NAF</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span style="margin-right: 0.14736em;" class="mord mathcal">N</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span style="margin-right: 0.14736em;" class="mord mathcal">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br> 具体而言：</p> 
<ul><li> <p>每个节点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           n 
          
         
           ∈ 
          
         
           N 
          
         
        
          n\in\mathcal{N} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.14736em;" class="mord mathcal">N</span></span></span></span></span></span>表示以下三种对象之一：</p> 
  <ol><li>一个事实<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            f 
           
          
            ∈ 
           
          
            F 
           
          
         
           f\in F 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span></span></span></span></span>；</li><li>一条规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
            ∈ 
           
          
            R 
           
          
         
           r\in R 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.00773em;" class="mord mathdefault">R</span></span></span></span></span>；</li><li>一个特殊的<strong>负面节点</strong>（<em>negation as failure node</em>，下简称为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            A 
           
          
            F 
           
          
         
           \rm NAF 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">A</span><span class="mord mathrm">F</span></span></span></span></span></span>节点）；</li></ol> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           N 
          
         
           A 
          
         
           F 
          
         
        
          \rm NAF 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">A</span><span class="mord mathrm">F</span></span></span></span></span></span>节点指代那些无法被规则集证明的陈述对立面的真实性，其实就是额外添加的一些默认条件，这在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           F 
          
         
           i 
          
         
           g 
          
         
           u 
          
         
           r 
          
         
           e 
          
         
           2 
          
         
        
          \rm Figure 2 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathrm">F</span><span class="mord mathrm">i</span><span style="margin-right: 0.01389em;" class="mord mathrm">g</span><span class="mord mathrm">u</span><span class="mord mathrm">r</span><span class="mord mathrm">e</span><span class="mord mathrm">2</span></span></span></span></span></span>中比较容易看得明白。</p> </li><li> <p>每条边<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           e 
          
         
           ∈ 
          
         
           E 
          
         
        
          e\in\mathcal{E} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.08944em;" class="mord mathcal">E</span></span></span></span></span></span>的指向情形为以下两种之一：</p> 
  <ol><li>从一个事实<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            f 
           
          
         
           f 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span></span></span></span></span>（或一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            A 
           
          
            F 
           
          
         
           \rm NAF 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">A</span><span class="mord mathrm">F</span></span></span></span></span></span>节点）指向一条规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
         
           r 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span></span></span></span></span>，这代表事实<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            f 
           
          
         
           f 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.10764em;" class="mord mathdefault">f</span></span></span></span></span>（或<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            N 
           
          
            A 
           
          
            F 
           
          
         
           \rm NAF 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">N</span><span class="mord mathrm">A</span><span class="mord mathrm">F</span></span></span></span></span></span>节点）被规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            r 
           
          
         
           r 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span></span></span></span></span>所<strong>消耗</strong>（<em>consumed</em>）；</li><li>从一条规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             r 
            
           
             1 
            
           
          
         
           r_1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>指向另一条规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             r 
            
           
             2 
            
           
          
         
           r_2 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，这代表规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             r 
            
           
             1 
            
           
          
         
           r_1 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的输出被规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             r 
            
           
             2 
            
           
          
         
           r_2 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>所<strong>消耗</strong>（<em>consumed</em>）；</li></ol> </li></ul> 
<h4><a id="0711_3058"></a>07-11</h4> 
<blockquote> 
 <ul><li>贰夜</li></ul> 
</blockquote> 
<h4><a id="0712_3062"></a>07-12</h4> 
<blockquote> 
 <ul><li>葬歌。</li><li>气急败坏，还是控制不好情绪，太幼稚了。</li><li>死人的事情办完之后，就是活人的事情。实话说人生走一遭真是不容易，到死也要被殡葬业榨得干干净净，遗产搞不好还要纷争，唉，真的没意思。这几天太累，好好补觉了。</li></ul> 
</blockquote> 
<p>今天突然有了很多有趣的idea，一个是目前看完的PRover的代码准备深究一下，笔注写完但不想发，等代码吃透再一起，主要里面一个用于解整数规划的PuLP包很值得在意。</p> 
<p>另外我突然想做三个小游戏的强化学习测试，推箱子（莫名其妙看到了推箱子就想做，因为觉得推箱子真的很难，发现居然有人还专门开发了一个用于搞推箱子的包，tql），2048（这个是今天刷B站看到有个人做的，很有意思，他用的是蒙特卡洛模拟后三步然后取得分最高的走法，效果拔群，搞到4096不是问题），搞怪碰碰球（这个知道的人肯定很少，因为这个游戏是很老很老的，我很小的时候老妈天天在医院电脑上玩，然后科室里另一个同事特别厉害，每次都能打到一万多分，老妈菜的从几百分慢慢搞，最后也没打穿过7000分，这个游戏我还挺看重，因为它每一步的决策实在是太多了，而且带有随机性，前两个都有人做过，这个想自己设计个算法试试，主要回家精神振奋，就想搞点有的没的东西）。</p> 
<h4><a id="0713_3071"></a>07-13</h4> 
<blockquote> 
 <ul><li>养猪计划 v.s. 晨跑计划，晨跑5km，配速4’27"，吃太撑，节奏不太稳，慢慢来吧，有几天不跑了。</li><li>三伏天跑步机反而比路跑要难，无风，1km多一点就湿透了。</li><li>2048的算法还是挺有趣的，准备在它的基础上做些有趣的事情，一个是迁移到搞怪碰碰球上，另一个是用现有的策略生成若干episode去做个强化学习看看效果如何，目前直观上的Q函数已经可以做到90%的成功率到2048了，不知道能不能学出更优的策略，总之蒙特卡洛永远嘀神。</li></ul> 
</blockquote> 
<p>pygame版本的2048：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*- </span>
<span class="token comment"># @author : caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> random
<span class="token keyword">import</span> pygame
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

nmap <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">'L'</span><span class="token punctuation">}</span>
fmap <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>val<span class="token punctuation">,</span> key<span class="token punctuation">]</span> <span class="token keyword">for</span> key<span class="token punctuation">,</span> val <span class="token keyword">in</span> nmap<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Button</span><span class="token punctuation">(</span>pygame<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> text<span class="token punctuation">,</span> location<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pygame<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>Sprite<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>text <span class="token operator">=</span> text
        self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">=</span> location
        self<span class="token punctuation">.</span>w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>is_show <span class="token operator">=</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">is_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>is_show <span class="token keyword">and</span> self<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>w <span class="token keyword">and</span> self<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> location<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>h


<span class="token keyword">class</span> <span class="token class-name">Grid</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token number">4</span>
    tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    max_tile <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>tiles <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_zero</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">is_full</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>tiles

    <span class="token keyword">def</span> <span class="token function">set_tiles</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> location<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>location<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> number

    <span class="token keyword">def</span> <span class="token function">get_random_location</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_zero<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> x<span class="token punctuation">,</span> y
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">add_tile_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>add_random_tile<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>add_random_tile<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add_random_tile</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            value <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.9</span> <span class="token keyword">else</span> <span class="token number">4</span>
            self<span class="token punctuation">.</span>set_tiles<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_random_location<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> is_fake<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            direction <span class="token operator">=</span> nmap<span class="token punctuation">[</span>direction<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> is_fake<span class="token punctuation">:</span>
            t <span class="token operator">=</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            t <span class="token operator">=</span> self<span class="token punctuation">.</span>tiles
        <span class="token keyword">if</span> direction <span class="token operator">==</span> <span class="token string">'U'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_hl<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> direction <span class="token operator">==</span> <span class="token string">'D'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_hl<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> direction <span class="token operator">==</span> <span class="token string">'L'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_hl<span class="token punctuation">(</span>t<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> direction <span class="token operator">==</span> <span class="token string">'R'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_hl<span class="token punctuation">(</span>t<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>score

    <span class="token keyword">def</span> <span class="token function">move_hl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> hl<span class="token punctuation">)</span><span class="token punctuation">:</span>
        len_hl <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hl<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>len_hl <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> hl<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> len_hl<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        hl<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                        hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                        self<span class="token punctuation">.</span>score <span class="token operator">+=</span> <span class="token number">1</span>
                        <span class="token keyword">break</span>
            <span class="token keyword">if</span> hl<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> len_hl<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> hl<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    hl<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>score <span class="token operator">+=</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                    hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">if</span> hl<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">return</span> hl

    <span class="token keyword">def</span> <span class="token function">is_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">is_win</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>max_tile <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>max_tile <span class="token keyword">in</span> self<span class="token punctuation">.</span>tiles
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        str_ <span class="token operator">=</span> <span class="token string">'====================\n'</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> self<span class="token punctuation">.</span>tiles<span class="token punctuation">:</span>
            str_ <span class="token operator">+=</span> <span class="token string">'-'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> row<span class="token punctuation">:</span>
                str_ <span class="token operator">+=</span> <span class="token string">'|{:4d}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            str_ <span class="token operator">+=</span> <span class="token string">'|\n'</span>
        str_ <span class="token operator">+=</span> <span class="token string">'-'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
        str_ <span class="token operator">+=</span> <span class="token string">'==================\n'</span>
        <span class="token keyword">return</span> str_

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    score <span class="token operator">=</span> <span class="token number">0</span>
    env <span class="token operator">=</span> <span class="token string">'testing'</span>
    state <span class="token operator">=</span> <span class="token string">'start'</span>
    grid <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> grid_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> env<span class="token operator">=</span><span class="token string">'production'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>env <span class="token operator">=</span> env
        self<span class="token punctuation">.</span>grid_size <span class="token operator">=</span> grid_size
        self<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> Grid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid_size<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>env <span class="token operator">==</span> <span class="token string">'production'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>add_tile_init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'run'</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> direction<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>state <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'over'</span><span class="token punctuation">,</span> <span class="token string">'win'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            direction <span class="token operator">=</span> nmap<span class="token punctuation">[</span>direction<span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>run<span class="token punctuation">(</span>direction<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>score <span class="token operator">+=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>score

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>is_over<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'over'</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>is_win<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'win'</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>env <span class="token operator">==</span> <span class="token string">'production'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>add_random_tile<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>grid

    <span class="token keyword">def</span> <span class="token function">printf</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0714_3248"></a>07-14</h4> 
<blockquote> 
 <ul><li>晨跑5km，穿了件背心，没好意思再裸奔… 均配4’32"，比昨天慢一些。发现晨跑的问题就是需要一段时间进状态，一开始总是找不到节奏，3km之后才有感觉。计划养猪30天，争取做到每天晨跑5km加晚饭后跑步机3km。实话说现在体能比去年同期确实长太多了。</li><li>在生成2048的episode，随机策略很快，1w个差不多一分钟就好了，准备加十分之一的标准策略，五六分钟才能有一个，这个如果效果好就准备写搞搞怪了，做出来可以给老妈秀一下。</li><li>照这种吃法，不出半个月必过70kg，一个月后怕不再也跑不动了，这个鬼天气也跑不了长距离，供过于求了，算了，好好养一个月，既来之则安之。</li></ul> 
</blockquote> 
<p>2048生成episode的脚本：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pygame
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token punctuation">(</span>QUIT<span class="token punctuation">,</span>
                           KEYDOWN<span class="token punctuation">,</span>
                           K_ESCAPE<span class="token punctuation">,</span>
                           K_LEFT<span class="token punctuation">,</span>
                           K_RIGHT<span class="token punctuation">,</span>
                           K_DOWN<span class="token punctuation">,</span>
                           K_UP<span class="token punctuation">,</span>
                           K_w<span class="token punctuation">,</span>
                           K_a<span class="token punctuation">,</span>
                           K_s<span class="token punctuation">,</span>
                           K_d<span class="token punctuation">,</span>
                           K_k<span class="token punctuation">,</span>
                           K_l<span class="token punctuation">,</span>
                           MOUSEBUTTONDOWN<span class="token punctuation">)</span>

<span class="token keyword">from</span> config <span class="token keyword">import</span> GameConfig

<span class="token keyword">from</span> src<span class="token punctuation">.</span>utils <span class="token keyword">import</span> load_args<span class="token punctuation">,</span> save_args<span class="token punctuation">,</span> draw_text
<span class="token keyword">from</span> src<span class="token punctuation">.</span>game <span class="token keyword">import</span> Game<span class="token punctuation">,</span> Button
<span class="token keyword">from</span> src<span class="token punctuation">.</span>ai <span class="token keyword">import</span> AI


<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> episode_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Initialize game</span>
    <span class="token comment"># pygame.init()</span>

    <span class="token comment"># Set window</span>
    <span class="token comment"># os.environ['SDL_VIDEO_WINDOW_POS'] = '%d,%d' % args.window_pos</span>
    <span class="token comment"># raw_screen = pygame.display.set_mode((args.window_width, args.window_height), pygame.DOUBLEBUF, 32)</span>
    <span class="token comment"># screen = raw_screen.convert_alpha()</span>
    <span class="token comment"># pygame.display.set_caption(args.window_title)</span>

    interval <span class="token operator">=</span> args<span class="token punctuation">.</span>interval
    state <span class="token operator">=</span> <span class="token string">'start'</span>
    <span class="token comment"># clock = pygame.time.Clock()</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span>args<span class="token punctuation">.</span>grid_dim<span class="token punctuation">)</span>
    ai <span class="token operator">=</span> AI<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    next_direction <span class="token operator">=</span> <span class="token string">''</span>
    last_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    buttons <span class="token operator">=</span> <span class="token punctuation">[</span>
        Button<span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token string">'Restart'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>grid_size <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Button<span class="token punctuation">(</span><span class="token string">'ai'</span><span class="token punctuation">,</span> <span class="token string">'Autorun'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>grid_size <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    episode_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'action'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'tiles'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'score'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'reward'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token keyword">not</span> state <span class="token operator">==</span> <span class="token string">'exit'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> game<span class="token punctuation">.</span>state <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'over'</span><span class="token punctuation">,</span> <span class="token string">'win'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            state <span class="token operator">=</span> game<span class="token punctuation">.</span>state

        <span class="token comment"># Start game</span>
        <span class="token keyword">if</span> state <span class="token operator">==</span> <span class="token string">'start'</span><span class="token punctuation">:</span>
            game<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            state <span class="token operator">=</span> <span class="token string">'ai'</span>

        <span class="token keyword">if</span> state <span class="token operator">==</span> <span class="token string">'ai'</span> <span class="token keyword">and</span> next_direction <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
            next_direction<span class="token punctuation">,</span> reward <span class="token operator">=</span> ai<span class="token punctuation">.</span>get_next<span class="token punctuation">(</span>game<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>tiles<span class="token punctuation">,</span> random_strategy<span class="token operator">=</span>args<span class="token punctuation">.</span>random_strategy<span class="token punctuation">)</span>
            current_direction <span class="token operator">=</span> next_direction

            <span class="token comment"># Logging Episode</span>
            tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>grid_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>grid_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>game<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>tiles<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
            episode_dict<span class="token punctuation">[</span><span class="token string">'tiles'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>tiles<span class="token punctuation">)</span><span class="token punctuation">)</span>
            episode_dict<span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>current_direction<span class="token punctuation">)</span>
            episode_dict<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>game<span class="token punctuation">.</span>score<span class="token punctuation">)</span>
            episode_dict<span class="token punctuation">[</span><span class="token string">'reward'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>reward<span class="token punctuation">)</span>

        <span class="token comment"># Direction</span>
        <span class="token keyword">if</span> next_direction <span class="token keyword">and</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token string">'run'</span> <span class="token keyword">or</span> state <span class="token operator">==</span> <span class="token string">'ai'</span> <span class="token keyword">and</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> last_time <span class="token operator">&gt;</span> interval<span class="token punctuation">)</span><span class="token punctuation">:</span>
            game<span class="token punctuation">.</span>run<span class="token punctuation">(</span>next_direction<span class="token punctuation">)</span>
            next_direction <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token comment"># last_time = time.time()</span>

        <span class="token comment"># Fill background color</span>
        <span class="token comment"># screen.fill((101, 194, 148))</span>

        <span class="token comment"># Draw text</span>
        <span class="token comment"># draw_text(screen, f'Score: {game.score}', (args.grid_size + 100, 40), args.fontface)</span>
        <span class="token comment"># if state == 'ai':</span>
        <span class="token comment">#     draw_text(screen, f'Interval: {interval}', (args.grid_size + 100, 60), args.fontface)</span>
        <span class="token comment">#     draw_text(screen, f'Reward：{round(reward, 3)}', (args.grid_size + 100, 80), args.fontface)</span>

        <span class="token comment"># Draw button</span>
        <span class="token comment"># for button in buttons:</span>
        <span class="token comment">#     if button.is_show:</span>
        <span class="token comment">#         pygame.draw.rect(screen, (180, 180, 200), (button.x, button.y, button.w, button.h))</span>
        <span class="token comment">#         draw_text(screen, button.text, (button.x + button.w / 2, button.y + 9), args.fontface, size=18, center='center')</span>

        <span class="token comment"># Draw map</span>
        <span class="token comment"># for y in range(args.grid_dim):</span>
        <span class="token comment">#     for x in range(args.grid_dim):</span>
        <span class="token comment">#         # Draw block</span>
        <span class="token comment">#         number = game.grid.tiles[y][x]</span>
        <span class="token comment">#         size = args.grid_size / args.grid_dim</span>
        <span class="token comment">#         dx = size * 0.05</span>
        <span class="token comment">#         x_size, y_size = x * size, y * size</span>
        <span class="token comment">#         color = args.colors[str(int(number))] if number &lt;= args.max_number else (0, 0, 255)</span>
        <span class="token comment">#         pygame.draw.rect(screen, color, (x_size + dx, y_size + dx, size - 2 * dx, size - 2 * dx))</span>
        <span class="token comment">#         color = (20, 20, 20) if number &lt;= 4 else (255, 255, 255)</span>
        <span class="token comment">#         if number:</span>
        <span class="token comment">#             length = len(str(number))</span>
        <span class="token comment">#             if length == 1:</span>
        <span class="token comment">#                 text_size = size * 1.2 / 2</span>
        <span class="token comment">#             elif length &lt;= 3:</span>
        <span class="token comment">#                 text_size = size * 1.2 / length</span>
        <span class="token comment">#             else:</span>
        <span class="token comment">#                 text_size = size * 1.5 / length</span>
        <span class="token comment">#             draw_text(screen, str(int(number)), (x_size + size * 0.5, y_size + size * 0.5 - text_size / 2), args.fontface, color=color, size=args.fontsize, center='center')</span>

        <span class="token keyword">if</span> state <span class="token operator">==</span> <span class="token string">'over'</span><span class="token punctuation">:</span>
            <span class="token comment"># pygame.draw.rect(screen, (0, 0, 0, 0.5), (0, 0, args.grid_size, args.grid_size))</span>
            <span class="token comment"># draw_text(screen, 'Game over!', (args.grid_size / 2, args.grid_size / 2), args.fontface, size=25, center='center')</span>
            <span class="token keyword">break</span>

        <span class="token keyword">elif</span> state <span class="token operator">==</span> <span class="token string">'win'</span><span class="token punctuation">:</span>
            <span class="token comment"># pygame.draw.rect(screen, (0, 0, 0, 0.5), (0, 0, args.grid_size, args.grid_size))</span>
            <span class="token comment"># self.draw_text('Win!', (args.grid_size / 2, args.grid_size / 2), args.fontface, size=25, center='center')</span>
            <span class="token keyword">break</span>

        <span class="token comment"># Update</span>
        <span class="token comment"># raw_screen.blit(screen, (0, 0))</span>
        <span class="token comment"># pygame.display.flip()</span>
        <span class="token comment"># clock.tick(args.FPS)</span>

    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>episode_dict<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>episode_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> episode_path <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>episode_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    N <span class="token operator">=</span> <span class="token number">10000</span>
    args <span class="token operator">=</span> load_args<span class="token punctuation">(</span>GameConfig<span class="token punctuation">)</span>

    dfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    args<span class="token punctuation">.</span>random_strategy <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        df <span class="token operator">=</span> run<span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        df<span class="token punctuation">[</span><span class="token string">'episode'</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
        dfs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
    pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>dfs<span class="token punctuation">)</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'episode/random.csv'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>


    args<span class="token punctuation">.</span>random_strategy <span class="token operator">=</span> <span class="token boolean">False</span>
    N <span class="token operator">=</span> <span class="token number">10000</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        df <span class="token operator">=</span> run<span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">'episode/ai_%04d.csv'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># df.loc[:, 'episode'] = i</span>
        <span class="token comment"># dfs.append(df)</span>
    <span class="token comment"># pd.concat(dfs).to_csv('episode/random.csv', sep='\t', header=True, index=False)</span>
</code></pre> 
<h4><a id="0715_3427"></a>07-15</h4> 
<blockquote> 
 <ul><li>路跑5km跑进22分，跑完膝盖有点疼。专攻5km，争取坚持住一个月。其实有点想试试公路车，家里这边倒是有很不错的路段，对膝盖也友好些。</li><li>好像大家都回家了，喝酒是约不到了。卸掉weibo，之前一年多不用，就不知道这学期怎么会想到再把这玩意儿给装上。清静三十日，搞点名堂出来。</li><li>下午暴雨导致大面积断电，雨下到起雾，从三点停到八点，扫兴。晚上做空中蹬腿时感觉右腿确实疼，恐怕真的不能这么跑了。于是试了试punk的动作发现完全跟不住，又想起了小学时被班主任留下来练广播体操的童年阴影，手脚协调性是真的差，这辈子改不了了…</li></ul> 
</blockquote> 
<p>关于强化学习github上有人给出了一个非常好的用pytorch实现的各种算法的仓库<a href="https://github.com/p-christ/Deep-Reinforcement-Learning-Algorithms-with-PyTorch">GitHub@Deep-Reinforcement-Learning-Algorithms-with-PyTorch</a>，很奇怪为什么对于强化学习目前没有什么比较好的框架能用，其实还是跟普通的监督学习有点区别的。</p> 
<p>有点问题，因为episode差不多已经凑齐了，随机的10000个加带策略的1000个，目标函数就用off policy的DQN版本，似乎应该不会有太大问题。</p> 
<p>其实毕竟对强化学习这块做得很少，还是有一些问题，比如如果一个状态下的决策空间很大该怎么办，2048只有4种action，自然可以每个遍历一遍看<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           max 
          
         
           ⁡ 
          
         
         
         
           a 
          
         
           ′ 
          
         
        
       
         Q 
        
       
         ( 
        
        
        
          s 
         
        
          ′ 
         
        
       
         , 
        
        
        
          a 
         
        
          ′ 
         
        
       
         ) 
        
       
      
        \max_{a'}Q(s',a') 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.32798em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的取值，但是如果有非常多的action，是否有其他扩展改进的算法？似乎并不那么容易。</p> 
<h4><a id="0716_3438"></a>07-16</h4> 
<blockquote> 
 <ul><li>这次真的伤痛了，又跟寒假那会儿一样，本来早上不想跑了，但是觉得才三天就断也太差劲了。</li><li>刷国际课程学分，这个暑假暂时没有什么硬事，趁早刷掉15场，省得后面几个暑假费事。</li><li>昨晚刷了10集巨人第四季，下午把剩下六集补了，有大半年没有这么补番了，巨人还是值得画时间补掉的，虽然动画没有画到结局，但是大致的后续基本还是知道的。总体来看第四季还不错，可惜了jsc搞出那种离谱的结局，唉。贾碧没那么坏，还有吉克是真惨，被兵长砍从头砍到尾，完事被弟弟洗脑了还帮着数钱。冤冤相报何时能了，各退一步也许就没那么多悲剧了。</li></ul> 
</blockquote> 
<p>关于今天的讲座做了些笔注：</p> 
<ul><li> <p>Computational不代表是Computer Science</p> <p>Computational指使用计算方法与算法来解决某些其他问题，如Computational social science, Systems biology.</p> </li><li> <p><strong>Computational design science research</strong> is concerned with solving business and societal problems by developing computational models and algorithms</p> </li><li> <p><strong>Computational data science research</strong>是<strong>Computational design science research</strong>的一类，目前仍然是MIS受欢迎的投稿类型，因为这些Editorial里都强调了会接收这些期刊</p> </li><li> <p><strong>Computational data science research</strong>的特点：</p> 
  <ol><li><strong>Problem-oriented</strong>：需要解决商业或社会上的具体问题</li><li><strong>Interdisciplinary</strong>：扩展多个不同的disciplines，如机器学习，优化，社会学，经济学等</li><li><strong>Data-driven</strong>：数据启动</li><li><strong>Methodological Contribution</strong></li><li><strong>Empirically sound</strong></li><li><strong>Demonstrate economic value and managerial insights</strong></li></ol> <p>与相关研究的区别：</p> 
  <ol><li> <p>与CS中的机器学习的区别：Problem to Algorithm v.s. Algorithm to Algorithm</p> <p>要对问题做具体描述（如Fintech的问题可能需要做经济学对该问题的看法，文献综述要有这部分的问题），CS会侧重算法</p> </li><li> <p>一些其他领域用机器学习的（如Fintech），一般只是用现成的算法，而我们则更注重方法论的创新。</p> </li></ol> </li><li> <p>如何进行<strong>Computational data science research</strong>：</p> 
  <ol><li>定义需要解决的问题</li><li>需要对相关领域的文献进行review（如Finance）</li><li>综述先进的模型</li><li>确认问题的挑战性，以及提出的方法的新颖性</li></ol> </li><li> <p><strong>Computational data science research</strong>一些研究点：</p> 
  <ol><li> <p>Fundamental Business Problem, e.g. Industry Classfication System</p> </li><li> <p>Grand Chanllege in Society</p> </li><li> <p>Methodological Contribution：这是<strong>Computational data science research</strong>的主要贡献</p> <p>这是比较主观的一个点，如果论文中能够论述方法与先进模型的比较，一般认为是有方法论贡献的，如果只是对已有方法的应用，一般是No significant contribution，介于这两者中间，成为Nontrival extension（非平凡的扩展），是有可能构成significant contribution</p> </li><li> <p>Evaluation：</p> <p>研究与baseline方法的比较，研究理论分析，消融测试，实验，经济价值等</p> </li></ol> </li><li> <p><strong>Reviews Pitfalls</strong>：</p> 
  <ol><li> <p>缺乏理论性</p> </li><li> <p>Fit（不太懂）</p> </li></ol> </li></ul> 
<h4><a id="0717_3497"></a>07-17</h4> 
<blockquote> 
 <ul><li>临睡刷keep笑死，不是说再喝茶百道是狗么，果然没有人能逃得过真香定律。</li><li>准备练公路车，这腿是没法再跑了，逃得过初一，逃不过十五，应该是6月30号和7月9号两次长距离跑给伤了，否则5km的量不至于三四天就再起不能。</li><li>下周四场讲座好像还可以，感觉要比第一场靠谱点儿，第一场想记些东西，可是也没啥有意义的内容。我一直觉得做ML还是要注重理论性的东西，至少不能完全抛弃，第一场方晓给人的感觉就是那种结果论者，很不看重理论性的创新，认为是可有可无的。最好笑的是他连自己论文的方法都说不清楚，还宣称论文写了四五年。其实大部分搞ML这块的人基本都这个德行，虽然也没什么可解释性，所以我还是很喜欢邓琪的风格，本科对他还是了解得太少。</li></ul> 
</blockquote> 
<p>给下周的四场讲座打个宣传，前两场看起来质量高一些，第一场应该是理论计算机中心请的，模糊决策了解一下；中间两场都是X院老本行了：</p> 
<blockquote> 
 <ul><li>讲座标题：<em>On Fuzzy and Linguistic Decision-Makings: Scenarios and Challenges</em></li><li>中文标题：<strong>模糊和语言决策：情景与挑战</strong></li><li>讲座时间：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2020/07/19 14:30-16:30(GMT+8) 
          
         
        
          \text{2020/07/19 14:30-16:30(GMT+8)} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">2020/07/19 14:30-16:30(GMT+8)</span></span></span></span></span></span></li><li>讲授者：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Enrique Herrera-Viedma 
          
         
        
          \text{Enrique Herrera-Viedma} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Enrique Herrera-Viedma</span></span></span></span></span></span></li><li>讲授者介绍：<strong>Enrique Herrera-Viedma</strong> <em>(IEEE Fellow) received the M.Sc. and Ph.D. degrees in computer science from the University of Granada, Granada, Spain, in 1993 and 1996, respectively. He is currently a Professor of computer science and AI, and the Vice-President of Research and Knowledge Transfer, University of Granada. His H-index is 69, with more than 17 000 citations received in the Web of Science and 85 in Google Scholar, with more than 29 000 cites received. He has been identified as one of the World’s most influential researchers by the Shanghai Centre and Thomson Reuters/Clarivate Analytics in both the scientific categories of computer science and engineering, from 2014 to 2018. His current research interests include group decision making, consensus models, linguistic modeling, aggregation of information, information retrieval, bibliometric, digital libraries, Web quality evaluation, recommender systems, block chain, smart cities, and social media. He is the Vice-President of Publications of the SMC Society and an Associate Editor of several JCR journals, such as IEEE Transactions on Fuzzy Systems, IEEE Transactions on Systems, Man, and Cybernetics: Systems, Information Sciences, Applied Soft Computing, Soft Computing, Fuzzy Optimization and Decision Making, Journal of Intelligent and Fuzzy Systems, International Journal of Fuzzy Systems, Engineering Applications of Artificial Intelligence, Journal of Ambient Intelligence and Humanized Computing, International Journal of Machine Learning and Cybernetics, and Knowledge-Based Systems. He is also the Editor-in-Chief of the Journal Frontiers in Artificial Intelligence (Section Fuzzy Systems).</em></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Z 
          
         
           O 
          
         
           O 
          
         
           M 
          
         
        
          \rm ZOOM 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">Z</span><span class="mord mathrm">O</span><span class="mord mathrm">O</span><span class="mord mathrm">M</span></span></span></span></span></span>会议室<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           I 
          
         
           D 
          
         
        
          \rm ID 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">D</span></span></span></span></span></span>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           89845472509 
          
         
        
          89845472509 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span><span class="mord">9</span><span class="mord">8</span><span class="mord">4</span><span class="mord">5</span><span class="mord">4</span><span class="mord">7</span><span class="mord">2</span><span class="mord">5</span><span class="mord">0</span><span class="mord">9</span></span></span></span></span>（密码：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           647299 
          
         
        
          647299 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">6</span><span class="mord">4</span><span class="mord">7</span><span class="mord">2</span><span class="mord">9</span><span class="mord">9</span></span></span></span></span>）</li></ul> 
 <hr> 
 <p><em>This talk takes a brief tour through the main trends, studies, methodologies and models developed around the field of fuzzy decision-making in the last decades. Fuzzy decision making approaches allow to deal with real-world decision problems of varying complexity where humans exhibit vagueness and imprecision to assess information about decision alternatives, criteria, etc. Specifically, we address a triple goal in this talk. Firstly, we introduce the main representation paradigms that have arisen from fuzzy set theory to model assessment information at different levels of expressive richness and complexity. Secondly, we examine three core scenarios around which fuzzy decision-making methods have been developed: multi-criteria decision-making, group (and consensus-driven) decision-making, and multi-person multi-criteria decision-making. Lastly, we discuss new complex decision-making scenarios that emerged in recent years where decisions should be guided by the “wisdom of the crowd”, highlighting their challenges and reflecting on much needed key guidelines for future research in the field.</em></p> 
</blockquote> 
<blockquote> 
 <ul><li>讲座标题：<em>Designing Maximum Matchings in Sparse Random Graphs (with an Application in Alibaba Cainiao’s Logistics Network)</em></li><li>中文标题：<strong>稀疏随机图中的最大匹配设计（在阿里巴巴菜鸟物流网络中的应用）</strong></li><li>讲座时间：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2020/07/20 09:30-11:30(GMT+8) 
          
         
        
          \text{2020/07/20 09:30-11:30(GMT+8)} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">2020/07/20 09:30-11:30(GMT+8)</span></span></span></span></span></span></li><li>讲授者：辛林威</li><li>讲授者介绍：辛林威博士是美国芝加哥大学Booth商学院助理教授（运营管理方向）。他的主要研究方向是库存和供应链管理：为公司/政府/非营利性组织在各种不确定的情况下设计模型和算法以有效的达到 “供需平衡”。他利用渐进分析对随机库存模型的研究获得了多个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           INFORMS 
          
         
        
          \text{INFORMS} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">INFORMS</span></span></span></span></span></span>（运筹学和管理科学研究协会）论文奖项，包括应用概率学会颁发的最佳论文奖（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2019 
          
         
        
          2019 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">9</span></span></span></span></span>）、<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           George E. Nicholson 
          
         
        
          \text{George E. Nicholson} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">George E. Nicholson</span></span></span></span></span></span>最佳学生论文奖（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2015 
          
         
        
          2015 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">5</span></span></span></span></span>）、最佳青年学者论文奖第二名（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2015 
          
         
        
          2015 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">5</span></span></span></span></span>），以及生产与服务运作管理最佳学生论文入围奖（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2014 
          
         
        
          2014 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">4</span></span></span></span></span>）。他采取产学研相结合，与业界的广泛研究合作包括京东物流，阿里巴巴菜鸟，阿里巴巴达摩院，沃尔玛全球电子商务。他与京东物流在无人仓库机器人调度算法方面的工作被素有运筹和管理科学界“诺贝尔奖”之称的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           INFORMS Franz Edelman 
          
         
        
          \text{INFORMS Franz Edelman} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">INFORMS Franz Edelman</span></span></span></span></span></span>奖所认可（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2021 
          
         
        
          2021 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">1</span></span></span></span></span>），累计可为公司节省数十亿美元。他以沃尔玛线上超市的结账推荐系统为背景的研究获得了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2017 
          
         
        
          2017 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">1</span><span class="mord">7</span></span></span></span></span>年<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           CSAMSE 
          
         
        
          \text{CSAMSE} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">CSAMSE</span></span></span></span></span></span>（中国管理科学与工程学者协会）最佳论文奖。他与美国阿贡国家实验室对动态线路额定值的研究获得了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2020 
          
         
        
          2020 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">2</span><span class="mord">0</span></span></span></span></span>年<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           IEEE Transactions on Power Systems 
          
         
        
          \text{IEEE Transactions on Power Systems} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">IEEE Transactions on Power Systems</span></span></span></span></span></span>最佳论文奖。他的其他荣誉包括曾获得过美国国家自然科学基金资助。他的研究成果发表在《<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Operations Research 
          
         
        
          \text{Operations Research} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Operations Research</span></span></span></span></span></span>》和《<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Management Science 
          
         
        
          \text{Management Science} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Management Science</span></span></span></span></span></span>》等学术期刊上。他目前在芝加哥大学教授<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           MBA 
          
         
        
          \text{MBA} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">MBA</span></span></span></span></span></span>以及博士生课程。</li><li>腾讯会议<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           I 
          
         
           D 
          
         
        
          \rm ID 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">D</span></span></span></span></span></span>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           843214421 
          
         
        
          843214421 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span><span class="mord">4</span><span class="mord">3</span><span class="mord">2</span><span class="mord">1</span><span class="mord">4</span><span class="mord">4</span><span class="mord">2</span><span class="mord">1</span></span></span></span></span>（密码：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           123456 
          
         
        
          123456 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">3</span><span class="mord">4</span><span class="mord">5</span><span class="mord">6</span></span></span></span></span>）</li></ul> 
 <hr> 
 <p>本讲座是基于一项由阿里巴巴菜鸟研究基金支持的研究。我们研究的问题是如何设计一个稀疏图，能够支持随机节点中断的大型匹配。这是基于实践中电子商务平台的"中间一公里"运输问题。我们研究了三种图网络，并刻画了它们的理论性能。我们的理论结果表明，它们的性能可以接近于完整图的性能。我们并且通过菜鸟的真实数据评估了它们在"中间一公里"上的经验性能。文章的合作者包括<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Yifan Feng 
         
        
       
         \text{Yifan Feng} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Yifan Feng</span></span></span></span></span></span>（新加坡国立大学）、<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Ren 
         
         
         
           e 
          
         
           ˊ 
          
         
        
           Caldentey 
         
        
       
         \text{René Caldentey} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Ren</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord">e</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˊ</span></span></span></span></span></span><span class="mord"> Caldentey</span></span></span></span></span></span>（芝加哥大学）、<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Yuan Zhong 
         
        
       
         \text{Yuan Zhong} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Yuan Zhong</span></span></span></span></span></span>（芝加哥大学），<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Haoyuan Hu 
         
        
       
         \text{Haoyuan Hu} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Haoyuan Hu</span></span></span></span></span></span>（阿里巴巴菜鸟），<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Bing Wang 
         
        
       
         \text{Bing Wang} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Bing Wang</span></span></span></span></span></span>（阿里巴巴菜鸟）。</p> 
</blockquote> 
<blockquote> 
 <ul><li>讲座标题：<em>Data-Driven Hospital Management</em></li><li>中文标题：<strong>数据驱动的医院运营管理</strong></li><li>讲座时间：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2020/07/21 09:30-11:30(GMT+8) 
          
         
        
          \text{2020/07/21 09:30-11:30(GMT+8)} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">2020/07/21 09:30-11:30(GMT+8)</span></span></span></span></span></span></li><li>讲授者：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Yichuan Ding 
          
         
        
          \text{Yichuan Ding} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord text"><span class="mord">Yichuan Ding</span></span></span></span></span></span></li><li>讲授者介绍：<strong>Yichuan Ding’s</strong> <em>research interests include optimization, queueing, and statistics, as well as their applications in public sectors, including cadaver kidney exchange and allocation policies, affordable housing management, emergency department operations, outpatient and surgical scheduling, etc.</em></li><li>腾讯会议<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           I 
          
         
           D 
          
         
        
          \rm ID 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">D</span></span></span></span></span></span>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           895588024 
          
         
        
          895588024 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span><span class="mord">9</span><span class="mord">5</span><span class="mord">5</span><span class="mord">8</span><span class="mord">8</span><span class="mord">0</span><span class="mord">2</span><span class="mord">4</span></span></span></span></span>（密码：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           123456 
          
         
        
          123456 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">3</span><span class="mord">4</span><span class="mord">5</span><span class="mord">6</span></span></span></span></span>）</li></ul> 
 <hr> 
 <p><em>We will cover a few topics in hospital management, including the management of the outpatient department, the operation room, and the emergent department. We will introduce the cutting-edge techniques in improving the efficiency of the care delivery system, including queueing theory, optimization, and empirical methods. This seminar talk does not require much technical background, and is suitable for students at all levels with an interest in operations research and management sciences.</em></p> 
</blockquote> 
<blockquote> 
 <ul><li>讲座标题：<em>Recent Development in Data Privacy</em></li><li>中文标题：<strong>近期数据隐私性的发展</strong></li><li>讲座时间：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           2020/07/23 09:00-11:00(GMT+8) 
          
         
        
          \text{2020/07/23 09:00-11:00(GMT+8)} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">2020/07/23 09:00-11:00(GMT+8)</span></span></span></span></span></span></li><li>讲授者：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Xuan Bi 
          
         
        
          \text{Xuan Bi} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">Xuan Bi</span></span></span></span></span></span></li><li>讲授者介绍：<strong>Xuan Bi</strong> <em>is an Assistant Professor of Information and Decision Sciences in the Carlson School of Management, at the University of Minnesota. His general research goal is to design data-driven solutions and provide decision support to benefit organizations and individuals. His research mainly focuses on the interface of Statistics, Machine Learning, and Information Systems, which aims at creating and applying data-driven methodologies to address real-world, large-scale, business and scientific problems. Specifically, his works revolve around personalization, with a special interest in recommender systems and differential privacy.</em></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Z 
          
         
           O 
          
         
           O 
          
         
           M 
          
         
        
          \rm ZOOM 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">Z</span><span class="mord mathrm">O</span><span class="mord mathrm">O</span><span class="mord mathrm">M</span></span></span></span></span></span>会议室<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           I 
          
         
           D 
          
         
        
          \rm ID 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">D</span></span></span></span></span></span>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           88260819472 
          
         
        
          88260819472 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">8</span><span class="mord">8</span><span class="mord">2</span><span class="mord">6</span><span class="mord">0</span><span class="mord">8</span><span class="mord">1</span><span class="mord">9</span><span class="mord">4</span><span class="mord">7</span><span class="mord">2</span></span></span></span></span>（密码：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           123456 
          
         
        
          123456 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">3</span><span class="mord">4</span><span class="mord">5</span><span class="mord">6</span></span></span></span></span>）</li></ul> 
 <hr> 
 <p><em>Limited access to large-scale, high-quality, or multi-source data is one of the key obstacles to deploying modern machine learning models, which is partly due to the reluctance of information exchange out of privacy concerns. Recent studies have found that data privacy has the potential to grow into a 10+ billion industry, because of the increasing demand of data sharing, fast development of AI software and platforms, and the vast adoption of data-related regulations and policies. We will provide a broad overview of the state-of-the-art data protection techniques, including some of the key methods such as differential privacy and federated learning, as well as our recent works in these areas.</em></p> 
</blockquote> 
<h4><a id="0718_3540"></a>07-18</h4> 
<blockquote> 
 <ul><li>WXY去跑六盘水马拉松了，目标是破三，相当可怕的实力。才知道六盘水就在贵州，家门口的就有赛事也太舒服了。似乎受甘肃马拉松事故的影响，下半年的赛事很多都取消了，实在是很扫兴，现在还能期待一下的应该是南京、杭州这两场，上海的只能听着点消息。相对近一些，要不然就只能等到明年了唉。</li><li>这两天转练腰腹和深蹲，这次不敢硬犟，跑休个四五天也认。希望练稳核心和膝盖后能有提升，总归还是想把5k跑进20分的。</li><li>头疼，事情做不进去。</li></ul> 
</blockquote> 
<p><code>torch.sort</code>用法：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy 
<span class="token keyword">import</span> torch
tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>numpy<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">.3</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">,</span> <span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">.4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">.3</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">,</span> <span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">.4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>numpy<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span class="token punctuation">)</span>
sorted_tensor<span class="token punctuation">,</span> index <span class="token operator">=</span> torch<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> descending<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sorted_tensor<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>tensor<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Output:</span>
<span class="token triple-quoted-string string">"""
tensor([[0.4000, 0.3000, 0.2000, 0.1000],
		[0.4000, 0.3000, 0.2000, 0.1000]]) &lt;class 'torch.Tensor'&gt;
tensor([[3, 0, 1, 2],
		[3, 0, 1, 2]]) &lt;class 'torch.Tensor'&gt;
"""</span>
</code></pre> 
<h4><a id="0719_3562"></a>07-19</h4> 
<blockquote> 
 <ul><li>姑婆婆昨天上厕所时断气，93岁寿终正寝，一大早家里嘈杂得不行，还好昨晚睡得特别早（困死）。醒来下意识一弯腿，右小腿腹猛地一抽，疼好久，都两天没跑了还能抽筋。老舅就很郁闷，上周一送完姨父刚飞走，这周又得飞回来，大热天丧事成双。</li><li>小腿抽筋也要被老妈训斥。五月之后在校都没有大伤，这次回来没几天跑伤是给她到把柄了，再加上连续有人去世心情也不好，惹不起。反正我已经决定从明天开始接着晨跑，换条直的路线，休息三天状态基本也恢复得差不多了， 不过这几天感觉练了些新的动作也挺有趣，只是跑步确实还是太单调了。</li><li>下午讲的是语言模糊决策模型，其实算是NLP的一个非常重要的理论基础，所以是wyl来主持的，可惜这个西班牙人的口音实在是一言难尽，wyj还要我来写讲座回顾。</li><li>sxy最近好猛，每天都运动一两个小时，自律的人类真可怕。</li></ul> 
</blockquote> 
<p><strong>模糊数评估</strong>（<em>Fuzzy number assessments</em>）：</p> 
<blockquote> 
 <p><strong>定义</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          1 
         
        
       
         1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>：</p> 
 <p>设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
          : 
         
        
          R 
         
        
          → 
         
        
          [ 
         
        
          0 
         
        
          , 
         
        
          1 
         
        
          ] 
         
        
       
         A:\R\rightarrow[0,1] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>是实数轴上的一个<strong>模糊集</strong>，称<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
       
         A 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>是一个<strong>模糊数</strong>（<em>fuzzy number</em>），若满足一下性质：</p> 
 <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>是<strong>正态的</strong>（<em>normal</em>），即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∃ 
          
         
           x 
          
         
           ∈ 
          
         
           R 
          
         
        
          \exist x\in\R 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord">∃</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span></span></span></span></span>，使得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
           = 
          
         
           1 
          
         
        
          A(x)=1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>成立；</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>是<strong>模糊凸的</strong>（<em>fuzzy convex</em>），即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∀ 
          
         
           t 
          
         
           ∈ 
          
         
           [ 
          
         
           0 
          
         
           , 
          
         
           1 
          
         
           ] 
          
         
           , 
          
         
           x 
          
         
           ∈ 
          
         
           R 
          
         
           , 
          
         
           y 
          
         
           ∈ 
          
         
           R 
          
         
        
          \forall t\in [0,1],x\in\R,y\in\R 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord">∀</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88333em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathbb">R</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span></span></span></span></span>，使得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
           ( 
          
         
           t 
          
         
           x 
          
         
           + 
          
         
           ( 
          
         
           1 
          
         
           − 
          
         
           t 
          
         
           ) 
          
         
           y 
          
         
           ) 
          
         
           ≥ 
          
         
           min 
          
         
           ⁡ 
          
         
           { 
          
         
           A 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
           , 
          
         
           A 
          
         
           ( 
          
         
           y 
          
         
           ) 
          
         
           } 
          
         
        
          A(tx+(1-t)y)\ge\min\{A(x),A(y)\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">t</span><span class="mclose">)</span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">min</span><span class="mopen">{<!-- --></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mclose">)</span><span class="mclose">}</span></span></span></span></span>成立；</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>是<strong>上半连续的</strong>（<em>upper semicontinuous</em>），即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∀ 
          
         
           ϵ 
          
         
           &gt; 
          
         
           0 
          
         
           , 
          
          
          
            x 
           
          
            0 
           
          
         
           ∈ 
          
         
           R 
          
         
        
          \forall\epsilon&gt;0,x_0\in\R 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord">∀</span><span class="mord mathdefault">ϵ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∃ 
          
         
           δ 
          
         
           &gt; 
          
         
           0 
          
         
        
          \exist\delta&gt;0 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord">∃</span><span style="margin-right: 0.03785em;" class="mord mathdefault">δ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>，使得<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ∀ 
          
         
           x 
          
         
           ∈ 
          
         
           { 
          
         
           x 
          
         
           : 
          
         
           ∣ 
          
         
           x 
          
         
           − 
          
          
          
            x 
           
          
            0 
           
          
         
           ∣ 
          
         
           &lt; 
          
         
           δ 
          
         
           } 
          
         
        
          \forall x\in\{x:|x-x_0|&lt;\delta\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.73354em; vertical-align: -0.0391em;"></span><span class="mord">∀</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.03785em;" class="mord mathdefault">δ</span><span class="mclose">}</span></span></span></span></span>，有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
           − 
          
         
           A 
          
         
           ( 
          
          
          
            x 
           
          
            0 
           
          
         
           ) 
          
         
           &lt; 
          
         
           ϵ 
          
         
        
          A(x)-A(x_0)&lt;\epsilon 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span></span>成立；</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>是<strong>紧支的</strong>（<em>compactly supported</em>），即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           cl 
          
         
           { 
          
         
           x 
          
         
           ∈ 
          
         
           R 
          
         
           : 
          
         
           A 
          
         
           ( 
          
         
           x 
          
         
           ) 
          
         
           &gt; 
          
         
           0 
          
         
           } 
          
         
        
          \text{cl}\{x\in\R:A(x)&gt;0\} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">cl</span></span><span class="mopen">{<!-- --></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68889em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathbb">R</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">0</span><span class="mclose">}</span></span></span></span></span>是<strong>紧集</strong>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           cl 
          
         
        
          \text{cl} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord text"><span class="mord">cl</span></span></span></span></span></span>是<strong>闭包</strong>；</li></ul> 
</blockquote> 
<p>利用<strong>模糊数</strong>，专家无需提供精确的评估值，而是提供类似<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ≈ 
        
       
         0.6 
        
       
      
        \approx 0.6 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.48312em; vertical-align: 0em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span></span></span></span></span>这样的表达式来近似表达一个实数值（这往往是更实际的做法）。</p> 
<h4><a id="0720_3582"></a>07-20</h4> 
<blockquote> 
 <ul><li>早起先在跑步机上试了2km，身体很轻盈，感觉最好的状态回来了，特别高兴，或许每天坚持未必是最好的，适当的跑休是必要的。忽然发现家里的器材还挺全，哑铃，健腹轮，俯卧撑支架，跑步机，拉力弹簧都有，就是好多都上灰了… 中午参加完葬礼顶着最毒的太阳在S237省道上全力跑了2km，左髌骨还疼，其余没有异样，good。</li><li>早上的讲座是杨超林的老朋友的汇报，又是库存专题，自从离开杉数后，感觉做库存没前途，客户总是会有各种莫名其妙的规则，内部提供的dp也不准，搞不好还有各种版本，需求永远在变，各种蝴蝶效应导致最后实际效益会很差。而且这位老朋友贼糊弄，2小时的讲座用了不到1小时就讲完，超林看起来也没精神，总感觉院里的教授都太没精气神了，或者说对学生的事情很不上心，反而是刚来的年轻老师课讲得好，对学生也负责。唉，这就是社会的现状，既得利益者不思进取，底端卷成麻花。</li></ul> 
</blockquote> 
<p>livebot里的一些模块：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
 @Date  : 8/10/2018
 @Author: Shuming Ma
 @mail  : shumingma@pku.edu.cn 
 @homepage: shumingma.com
'''</span>
<span class="token triple-quoted-string string">'''
Originally from http://nlp.seas.harvard.edu/2018/04/03/attention.html
'''</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> math<span class="token punctuation">,</span> copy<span class="token punctuation">,</span> time
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable

BOS <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">class</span> <span class="token class-name">luong_attention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>luong_attention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hidden_size <span class="token operator">=</span> hidden_size
        self<span class="token punctuation">.</span>linear_in <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear_out <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>hidden_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Tanh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>softmax <span class="token operator">=</span> nn<span class="token punctuation">.</span>Softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">init_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>context <span class="token operator">=</span> context  <span class="token comment"># batch * seq1 * size</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># batch * seq2 * size</span>
        gamma_h <span class="token operator">=</span> self<span class="token punctuation">.</span>linear_in<span class="token punctuation">(</span>h<span class="token punctuation">)</span>   <span class="token comment">#    batch * seq2 * size</span>
        weights <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>gamma_h<span class="token punctuation">,</span> self<span class="token punctuation">.</span>context<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">#  batch * seq2 * seq1</span>
        weights <span class="token operator">=</span> self<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>weights<span class="token punctuation">)</span>   <span class="token comment">#   batch * seq2 * seq1</span>
        c_t <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> self<span class="token punctuation">.</span>context<span class="token punctuation">)</span> <span class="token comment"># batch * seq2 * size</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>linear_out<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>c_t<span class="token punctuation">,</span> h<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># batch * seq2 * size</span>

        <span class="token keyword">return</span> output


<span class="token keyword">class</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"Define standard linear + softmax generation step."</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> vocab<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Generator<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>proj <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> vocab<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>proj<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">VideoEncoder</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> n_block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>VideoEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layers <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>VideoBlock<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_block<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm <span class="token operator">=</span> LayerNorm<span class="token punctuation">(</span>d_model<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> layer <span class="token keyword">in</span> self<span class="token punctuation">.</span>layers<span class="token punctuation">:</span>
            x <span class="token operator">=</span> layer<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> n_block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TextEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layers <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>TextBlock<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_block<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm <span class="token operator">=</span> LayerNorm<span class="token punctuation">(</span>d_model<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> layer <span class="token keyword">in</span> self<span class="token punctuation">.</span>layers<span class="token punctuation">:</span>
            x <span class="token operator">=</span> layer<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">CommentDecoder</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> n_block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>CommentDecoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layers <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>DecoderBlock<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_block<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm <span class="token operator">=</span> LayerNorm<span class="token punctuation">(</span>d_model<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> layer <span class="token keyword">in</span> self<span class="token punctuation">.</span>layers<span class="token punctuation">:</span>
            x <span class="token operator">=</span> layer<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> mask<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">VideoBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>VideoBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>self_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>feed_forward <span class="token operator">=</span> PositionwiseFeedForward<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sublayer <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>SublayerConnection<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>self_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>feed_forward<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">TextBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TextBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>self_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>video_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>feed_forward <span class="token operator">=</span> PositionwiseFeedForward<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sublayer <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>SublayerConnection<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>self_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>video_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>feed_forward<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">DecoderBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> n_head<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>DecoderBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>self_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>video_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>text_attn <span class="token operator">=</span> MultiHeadedAttention<span class="token punctuation">(</span>n_head<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>feed_forward <span class="token operator">=</span> PositionwiseFeedForward<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sublayer <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>SublayerConnection<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>self_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>video_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m1<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> self<span class="token punctuation">.</span>text_attn<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>sublayer<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>feed_forward<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">LayerNorm</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> features<span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LayerNorm<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>a_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>b_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>eps <span class="token operator">=</span> eps

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mean <span class="token operator">=</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        std <span class="token operator">=</span> x<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a_2 <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>std <span class="token operator">+</span> self<span class="token punctuation">.</span>eps<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>b_2


<span class="token keyword">class</span> <span class="token class-name">SublayerConnection</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A residual connection followed by a layer norm.
    Note for code simplicity the norm is first as opposed to last.
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> size<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>SublayerConnection<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>norm <span class="token operator">=</span> LayerNorm<span class="token punctuation">(</span>size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> sublayer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>sublayer<span class="token punctuation">(</span>self<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MultiHeadedAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> h<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"Take in model size and number of heads."</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MultiHeadedAttention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> d_model <span class="token operator">%</span> h <span class="token operator">==</span> <span class="token number">0</span>
        <span class="token comment"># We assume d_v always equals d_k</span>
        self<span class="token punctuation">.</span>d_k <span class="token operator">=</span> d_model <span class="token operator">//</span> h
        self<span class="token punctuation">.</span>h <span class="token operator">=</span> h
        self<span class="token punctuation">.</span>linears <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>attn <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span>dropout<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">attention</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"Compute 'Scaled Dot Product Attention'"</span>
        d_k <span class="token operator">=</span> query<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        scores <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>query<span class="token punctuation">,</span> key<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>d_k<span class="token punctuation">)</span>
        <span class="token keyword">if</span> mask <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            scores <span class="token operator">=</span> scores<span class="token punctuation">.</span>masked_fill<span class="token punctuation">(</span>mask <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1e9</span><span class="token punctuation">)</span>
        p_attn <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>scores<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> dropout <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            p_attn <span class="token operator">=</span> dropout<span class="token punctuation">(</span>p_attn<span class="token punctuation">)</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>p_attn<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> p_attn

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> mask <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># Same mask applied to all h heads.</span>
            mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        nbatches <span class="token operator">=</span> query<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token comment"># 1) Do all the linear projections in batch from d_model =&gt; h x d_k</span>
        query<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value <span class="token operator">=</span> \
            <span class="token punctuation">[</span>l<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>nbatches<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>h<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
             <span class="token keyword">for</span> l<span class="token punctuation">,</span> x <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>linears<span class="token punctuation">,</span> <span class="token punctuation">(</span>query<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

        <span class="token comment"># 2) Apply attention on all the projected vectors in batch.</span>
        x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>attn <span class="token operator">=</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>query<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">,</span>
                                 dropout<span class="token operator">=</span>self<span class="token punctuation">.</span>dropout<span class="token punctuation">)</span>

        <span class="token comment"># 3) "Concat" using a view and apply a final linear.</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span> \
            <span class="token punctuation">.</span>view<span class="token punctuation">(</span>nbatches<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>h <span class="token operator">*</span> self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>linears<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Embeddings</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> vocab<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Embeddings<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lut <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>d_model <span class="token operator">=</span> d_model

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>lut<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PositionalEncoding</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"Implement the PE function."</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> max_len<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>PositionalEncoding<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span>dropout<span class="token punctuation">)</span>

        <span class="token comment"># Compute the positional encodings once in log space.</span>
        pe <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>max_len<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        position <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> max_len<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        div_term <span class="token operator">=</span> torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span>
                             <span class="token operator">-</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">10000.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> d_model<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>position <span class="token operator">*</span> div_term<span class="token punctuation">)</span>
        pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>position <span class="token operator">*</span> div_term<span class="token punctuation">)</span>
        pe <span class="token operator">=</span> pe<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>register_buffer<span class="token punctuation">(</span><span class="token string">'pe'</span><span class="token punctuation">,</span> pe<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> Variable<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PositionalEmb</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"Implement the PE function."</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> max_len<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>PositionalEmb<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span>dropout<span class="token punctuation">)</span>

        <span class="token comment"># Compute the positional encodings once in log space.</span>
        self<span class="token punctuation">.</span>pe <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>max_len<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> self<span class="token punctuation">.</span>pe<span class="token punctuation">(</span>Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PositionwiseFeedForward</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"Implements FFN equation."</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>PositionwiseFeedForward<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>w_1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_ff<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>w_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_ff<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>w_2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>w_1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">subsequent_mask</span><span class="token punctuation">(</span>batch<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"Mask out subsequent positions."</span>
    attn_shape <span class="token operator">=</span> <span class="token punctuation">(</span>batch<span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
    subsequent_mask <span class="token operator">=</span> np<span class="token punctuation">.</span>triu<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>attn_shape<span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'uint8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>subsequent_mask<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</code></pre> 
<h4><a id="0721_3861"></a>07-21</h4> 
<blockquote> 
 <ul><li>河南这次发大水好像真的麻烦了，郑州都淹成这样，其他地级市可能更难… 唉，对我来说洪涝还只是停留在书本上的东西，但愿这水能尽快退去，太难了。</li><li>WXY腰伤，看他最近拉胯得很，只能在4分半以上的配速在恢复。中午宴席结束继续在烈日下练抗乳酸跑，其实太阳很晒倒是不太影响，习惯了还挺舒服，只是喉咙干得太难受。</li><li>前天把进巨漫画从120话刷到139话完，其实我后来想想最终话也没那么糟糕，我觉得最后艾伦的那些看起来反差很大的话可能也算是与整个故事的开头呼应，返璞归真，临死前总归还是对最初和三笠、阿明纯情的友谊不舍的。至于为什么得出是艾伦操纵弑母的结论，我觉得jsc在设定上出现BUG了，仔细想想进巨的能力真的是预知未来么？难道不是操纵过去么？后任继承者会对前任造成影响，这意味着无穷远的未来的人能够对当前时间点产生影响，这本身就很BUG，因为颠倒了因果，会导致很多逻辑说不通，剧情设定上就无法自圆其说了。总之我觉得并不是那么一无是处吧，只是这个结局可能并不是最好的，但仍然是一个情理之中的结局（PS：很希望第五季是以剧场版的形式把120话之后的内容呈现出来，结尾稍加改编，最终始祖巨上的大战如果能画出来就太好了，望有生之年能看到真正的结局）</li></ul> 
</blockquote> 
<p>rar和zip的解压压缩解密操作记录：</p> 
<pre><code class="prism language-python">
<span class="token keyword">from</span> unrar <span class="token keyword">import</span> rarfile
 
path1 <span class="token operator">=</span> <span class="token string">"d:\\1.rar"</span>
path2 <span class="token operator">=</span> <span class="token string">"d:\\1"</span>
 
rf <span class="token operator">=</span> rarfile<span class="token punctuation">.</span>RarFile<span class="token punctuation">(</span>path1 <span class="token punctuation">,</span> pwd <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">)</span>
rf<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>path <span class="token operator">=</span> path2<span class="token punctuation">,</span> pwd <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
第一步：安装unrar模块,直接pip install unrar可能会找不到库，需要下载unrar library，也就是UnRAR.dll，下载地址为：http://www.rarlab.com/rar/UnRARDLL.exe；

第二步：将unrar安装路径添加到系统环境变量，64位操作系统的路径为C:\Program Files (x86)\UnrarDLL\x64，然后还需要将x64文件下的UnRAR64.lib和UnRAR64.dall重命名为unrar.lib和unrar.dall，因为unrar模块识别的文件是unrar.dll和unrar.lib；
'''</span>

<span class="token keyword">import</span> zipfile

zip_file <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">'./cache/.zip'</span><span class="token punctuation">)</span><span class="token comment">#文件的路径与文件名</span>
zip_list <span class="token operator">=</span> zip_file<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 得到压缩包里所有文件</span>
 
<span class="token keyword">for</span> f <span class="token keyword">in</span> zip_list<span class="token punctuation">:</span>
 zip_file<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">'./cache_F/'</span><span class="token punctuation">,</span>pwd<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 循环解压文件到指定目录</span>
  
zip_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭文件，必须有，释放内存</span>

zip_file <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">'./cache_F/.zip'</span><span class="token punctuation">)</span><span class="token comment">#文件的路径与文件名</span>
zip_list <span class="token operator">=</span> zip_file<span class="token punctuation">.</span>namelist<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 得到压缩包里所有文件</span>
 
<span class="token keyword">for</span> f <span class="token keyword">in</span> zip_list<span class="token punctuation">:</span>
 zip_file<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">'./cache/'</span><span class="token punctuation">,</span>pwd<span class="token operator">=</span><span class="token string">"mima"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 循环解压文件到指定目录</span>
zip_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭文件，必须有，释放内存</span>
</code></pre> 
<h4><a id="0722_3902"></a>07-22</h4> 
<blockquote> 
 <ul><li>灾情并不见好转，甚至蔓延到河北。有时就是如此无力，明明已经尽力，但是只能眼睁睁看着局势恶化，在郑州地铁中遇难的12人该是多么绝望。院里同级在河南的特别多，认识的就有三个，还都算是有过一些交集，困在郑州、许昌和安阳，住在高层的暂时还算安全，倒霉的yjy刚好坐车回家困在郑州站。总之千万别有致命的决堤溃坝，一切都会慢慢好起来的。</li><li>还是要学游泳，保命，也为了可以去参加铁三。感觉完赛个小铁（800m游泳+20km自行车+5km跑步）还是轻而易举的，标铁和大铁那真的反人类。前几天大铁（3.8km游泳+180km自行车+全马）世界纪录刷新到7小时27分（游泳44分钟，自行车时速46km，最后的全马仅用了2小时44分，中间没有休息，这是人能做到的…），太恐怖了，我记得去年在B站刷到一个去跑连云港大铁的上海大学学生，用了整整12小时，已经是男子组前30的精英选手。如果我去跑大铁，肯定已经淹死在第一段游泳的河里了…</li><li>看了一些龙胖蟒的集锦，又重燃去打乒乓球的热情，可惜球拍没带回来。这种酷暑天跑不动路，就该去文体中心吹着空调陪老大爷过两招。24号东奥乒赛开始，关注一下。</li><li>晚饭后2km（均配4’12"）+2.5km（均配4’23"）路跑间歇，为什么不晨跑了？因为真的起不来，这两天都七点多起，唉，自律真难。</li></ul> 
</blockquote> 
<p>下周三、四、五（7月28~30日）的短期课程非常有趣，是宾州沃顿商学院的Dr. Zongming Ma副教授来讲，主题是网络数据分析，主要是高维统计以及各种随机模型的高阶应用，我觉得会非常吸引人，跟邓琪教的内容会有交叉，值得关注，因为受中美关系影响，Dr. Zongming Ma不希望在公众号传播该课程，那我就“勉为其难”宣传一下啦</p> 
<p>时间表：<br> <img src="https://images2.imgbox.com/ca/9a/cVEC2cZf_o.png" alt="在这里插入图片描述">课程大纲：</p> 
<ol><li>Introduction to network data<br> (a) Examples of typical network data<br> (b) Important characteristics<br> (c) Main challenges: modeling, algorithm, theory<br> (d) This course: exchangeable network models, SBM / DCBM / latent space models</li><li>A short introduction to statistical decision theory<br> (a) Model, parameter, action space, loss, risk<br> (b) Statistical optimality: Cramer–Rao, Bayes, minimax, rate minimax<br> (c) Why the rate minimax viewpoint makes sense for complex decision problems<br> (d) Neyman-Pearson lemma<br> (e) Statistical optimality vs. computational efficiency</li><li>Stochastic block models (1)<br> (a) Data, model and parametrization<br> (b) Likelihood and mean structure<br> (c) To start with: planted partition model (balanced 2-block model)</li><li>Stochastic block models (2): Performance guarantee of spectral clustering<br> (a) Prelude: three different regimes for community detection<br> (b) l2 loss function<br> (c) l∞ loss function<br> (d) From spectral clustering to rate minimaxity</li></ol> 
<h4><a id="0724_3933"></a>07-24</h4> 
<blockquote> 
 <ul><li>早上的讲座本来是这周最不看好的一场，没想到Bi Xuan这么激情，讲得让人很振奋，关于数据安全这块院里老师做得很少，可能吕晨那边是有做，主要今天讲得内容跟去年吕晨课上我做得汇报很相关，听了很有启发，要学的东西太多了。</li><li>从说唱事件，到发布大碗宽面单曲，最后这次通报，wyf的风评人设多度反转，可是电鳗还是那条电鳗。每个人都在伪装，但非要立牌坊就恶心了，总归得有些自知之明。所以在这满是蟑螂的屋内，又有几人能保持清醒的记忆呢？都是随波逐流罢了。</li><li>M24，烂。望早日完结，免得晚节不保。虽然已经不怎么懂物理，但是八百里外能一枪命中犯人，还强行瞄准不打中要害，TM… 即便理论可行，答应别再这么秀了好么…</li><li>养精蓄锐，期待后天的暴雨。</li></ul> 
</blockquote> 
<p>各类浏览器Cookie保存路径：（PS：Firefox真的屏蔽掉了Flash，怎么也恢复不了支持了，哎，想回味童年已经不能了）</p> 
<p>在Windows系统上（这里以Win7为例）浏览器的Cookie<br> IE浏览器Cookie数据位于：%APPDATA%\Microsoft\Windows\Cookies\ 目录中的xxx.txt文件 （里面可能有很多个.txt Cookie文件）<br> 如：C:\Users\yren9\AppData\Roaming\Microsoft\Windows\Cookies\0WQ6YROK.txt</p> 
<p>在IE浏览器中，IE将各个站点的Cookie分别保存为一个XXX.txt这样的纯文本文件（文件个数可能很多，但文件大小都较小）；而Firefox和Chrome是将所有的Cookie都保存在一个文件中（文件大小较大），该文件的格式为SQLite3数据库格式的文件。</p> 
<p>Firefox的Cookie数据位于：%APPDATA%\Mozilla\Firefox\Profiles\ 目录中的xxx.default目录，名为cookies.sqlite的文件。<br> 如：C:\Users\jay\AppData\Roaming\Mozilla\Firefox\Profiles\ji4grfex.default\cookies.sqlite<br> 在Firefox中查看cookie, 可以选择”工具 &gt; 选项 &gt;” “隐私 &gt; 显示cookie”。</p> 
<p>Chrome的Cookie数据位于：%LOCALAPPDATA%\Google\Chrome\User Data\Default\ 目录中，名为Cookies的文件。<br> 如：C:\Users\jay\AppData\Local\Google\Chrome\User Data\Default\Cookies</p> 
<p>在Linux系统上（以Ubuntu 12.04 和 RHEL6.x 为例）浏览器的Cookie<br> Firefox的Cookie路径为：$HOME$/.mozilla/firefox/xxxx.default/目录下的cookie.sqlite文件。<br> View Code BASH<br> 1234master@jay-linux:~/.mozilla/firefox/tffagwsn.default$ ll cookies.sqlite-rw-r–r-- 1 master master 1572864 Apr 21 16:54 cookies.sqlitemaster@jay-linux:~/.mozilla/firefox/tffagwsn.default$ pwd/home/master/.mozilla/firefox/tffagwsn.default</p> 
<h4><a id="0724_3959"></a>07-24</h4> 
<blockquote> 
 <ul><li>女子十米气步枪最后一枪太刺激了，高压之下两个人都是大失误，还好对方失误得更离谱…</li><li>混双毫无悬念，常规让一追四。明晚可以打到半决赛，左半区应该不会有什么问题，不出意外肯定还是决赛打日本队。</li><li>举重绝对碾压，hzh抓举成绩就比大部分选手的挺举成绩还高，唯一的竞争对手也没有产生威胁，确实是赢得太轻松了。值得注意的是那个36岁的japan选手，真的特别悲情，挺举全部失败，抓举也只成功了第一次74kg（hzh抓举94kg），作为老将退役落幕之战实在是让人唏嘘不已。还有那个19岁的比利时小将，挺举99kg好不容易成功却被吹了两个红灯成绩作废，然后红着眼睛跪在台上，很让人触动。竞技体育真实残酷。</li></ul> 
</blockquote> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ϵ 
        
       
      
        \epsilon 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span></span>贪婪策略实现：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> exploration_strategies<span class="token punctuation">.</span>Base_Exploration_Strategy <span class="token keyword">import</span> Base_Exploration_Strategy
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> random
<span class="token keyword">import</span> torch

<span class="token keyword">class</span> <span class="token class-name">Epsilon_Greedy_Exploration</span><span class="token punctuation">(</span>Base_Exploration_Strategy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Implements an epsilon greedy exploration strategy"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>notified_that_exploration_turned_off <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> <span class="token string">"exploration_cycle_episodes_length"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Using a cyclical exploration strategy"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token operator">=</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"exploration_cycle_episodes_length"</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> <span class="token string">"random_episodes_to_run"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>random_episodes_to_run <span class="token operator">=</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"random_episodes_to_run"</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Running {} random episodes"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>random_episodes_to_run<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>random_episodes_to_run <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">perturb_action_for_exploration_purposes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Perturbs the action of the agent to encourage exploration"""</span>
        action_values <span class="token operator">=</span> action_info<span class="token punctuation">[</span><span class="token string">"action_values"</span><span class="token punctuation">]</span>
        turn_off_exploration <span class="token operator">=</span> action_info<span class="token punctuation">[</span><span class="token string">"turn_off_exploration"</span><span class="token punctuation">]</span>
        episode_number <span class="token operator">=</span> action_info<span class="token punctuation">[</span><span class="token string">"episode_number"</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> turn_off_exploration <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>notified_that_exploration_turned_off<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exploration has been turned OFF"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>notified_that_exploration_turned_off <span class="token operator">=</span> <span class="token boolean">True</span>
        epsilon <span class="token operator">=</span> self<span class="token punctuation">.</span>get_updated_epsilon_exploration<span class="token punctuation">(</span>action_info<span class="token punctuation">)</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> epsilon <span class="token keyword">or</span> turn_off_exploration<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>episode_number <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>random_episodes_to_run<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>action_values<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>  np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> action_values<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_updated_epsilon_exploration</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action_info<span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Gets the probability that we just pick a random action. This probability decays the more episodes we have seen"""</span>
        episode_number <span class="token operator">=</span> action_info<span class="token punctuation">[</span><span class="token string">"episode_number"</span><span class="token punctuation">]</span>
        epsilon_decay_denominator <span class="token operator">=</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"epsilon_decay_rate_denominator"</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            epsilon <span class="token operator">=</span> epsilon <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">+</span> <span class="token punctuation">(</span>episode_number <span class="token operator">/</span> epsilon_decay_denominator<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            epsilon <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_epsilon_with_cyclical_strategy<span class="token punctuation">(</span>episode_number<span class="token punctuation">)</span>
        <span class="token keyword">return</span> epsilon

    <span class="token keyword">def</span> <span class="token function">calculate_epsilon_with_cyclical_strategy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> episode_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculates epsilon according to a cyclical strategy"""</span>
        max_epsilon <span class="token operator">=</span> <span class="token number">0.5</span>
        min_epsilon <span class="token operator">=</span> <span class="token number">0.001</span>
        increment <span class="token operator">=</span> <span class="token punctuation">(</span>max_epsilon <span class="token operator">-</span> min_epsilon<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        cycle <span class="token operator">=</span> <span class="token punctuation">[</span>ix <span class="token keyword">for</span> ix <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span>ix <span class="token keyword">for</span> ix <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>
            <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>exploration_cycle_episodes_length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        cycle_ix <span class="token operator">=</span> episode_number <span class="token operator">%</span> self<span class="token punctuation">.</span>exploration_cycle_episodes_length
        epsilon <span class="token operator">=</span> max_epsilon <span class="token operator">-</span> cycle<span class="token punctuation">[</span>cycle_ix<span class="token punctuation">]</span> <span class="token operator">*</span> increment
        <span class="token keyword">return</span> epsilon

    <span class="token keyword">def</span> <span class="token function">add_exploration_rewards</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reward_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Actions intrinsic rewards to encourage exploration"""</span>
        <span class="token keyword">return</span> reward_info<span class="token punctuation">[</span><span class="token string">"reward"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Resets the noise process"""</span>
        <span class="token keyword">pass</span>

</code></pre> 
<h4><a id="0725_4038"></a>07-25</h4> 
<blockquote> 
 <ul><li>混双还是太碾压了，昨天4:1，今天两场4:0，昕雯毫无悬念进决赛。日本的水谷伊藤组合就特别搞笑，居然差点跪在1/4决赛，若不是抢七局奇迹般地从2:9反追到16:14，两人连半决赛都进不了。</li><li>膝痛未愈，雨中慢跑了五六公里，很惬意，最后冲刺了一段1km的直线，水平保持在3’40"左右。现在就是半养半练，一直回不到最好的状态。</li></ul> 
</blockquote> 
<p>policy gradient 学习</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> copy
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> torch <span class="token keyword">import</span> optim
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>Base_Agent <span class="token keyword">import</span> Base_Agent
<span class="token keyword">from</span> exploration_strategies<span class="token punctuation">.</span>Epsilon_Greedy_Exploration <span class="token keyword">import</span> Epsilon_Greedy_Exploration
<span class="token keyword">from</span> utilities<span class="token punctuation">.</span>Parallel_Experience_Generator <span class="token keyword">import</span> Parallel_Experience_Generator
<span class="token keyword">from</span> utilities<span class="token punctuation">.</span>Utility_Functions <span class="token keyword">import</span> normalise_rewards<span class="token punctuation">,</span> create_actor_distribution

<span class="token keyword">class</span> <span class="token class-name">PPO</span><span class="token punctuation">(</span>Base_Agent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Proximal Policy Optimization agent"""</span>
    agent_name <span class="token operator">=</span> <span class="token string">"PPO"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Base_Agent<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>policy_output_size <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_policy_output_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>policy_new <span class="token operator">=</span> self<span class="token punctuation">.</span>create_NN<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>state_size<span class="token punctuation">,</span> output_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>policy_output_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>policy_old <span class="token operator">=</span> self<span class="token punctuation">.</span>create_NN<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>state_size<span class="token punctuation">,</span> output_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>policy_output_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>policy_old<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_new<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>policy_new_optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_new<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"learning_rate"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>episode_number <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>many_episode_states <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>many_episode_actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>many_episode_rewards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>experience_generator <span class="token operator">=</span> Parallel_Experience_Generator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>environment<span class="token punctuation">,</span> self<span class="token punctuation">.</span>policy_new<span class="token punctuation">,</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>seed<span class="token punctuation">,</span>
                                                                  self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">,</span> self<span class="token punctuation">.</span>action_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>exploration_strategy <span class="token operator">=</span> Epsilon_Greedy_Exploration<span class="token punctuation">(</span>self<span class="token punctuation">.</span>config<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">calculate_policy_output_size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialises the policies"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>action_types <span class="token operator">==</span> <span class="token string">"DISCRETE"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>action_size
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>action_types <span class="token operator">==</span> <span class="token string">"CONTINUOUS"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>action_size <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">#Because we need 1 parameter for mean and 1 for std of distribution</span>

    <span class="token keyword">def</span> <span class="token function">step</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Runs a step for the PPO agent"""</span>
        exploration_epsilon <span class="token operator">=</span>  self<span class="token punctuation">.</span>exploration_strategy<span class="token punctuation">.</span>get_updated_epsilon_exploration<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"episode_number"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>episode_number<span class="token punctuation">}</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>many_episode_states<span class="token punctuation">,</span> self<span class="token punctuation">.</span>many_episode_actions<span class="token punctuation">,</span> self<span class="token punctuation">.</span>many_episode_rewards <span class="token operator">=</span> self<span class="token punctuation">.</span>experience_generator<span class="token punctuation">.</span>play_n_episodes<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"episodes_per_learning_round"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exploration_epsilon<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>episode_number <span class="token operator">+=</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"episodes_per_learning_round"</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>policy_learn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_learning_rate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"learning_rate"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>policy_new_optimizer<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>equalise_policies<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">policy_learn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""A learning iteration for the policy"""</span>
        all_discounted_returns <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_all_discounted_returns<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"normalise_rewards"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            all_discounted_returns <span class="token operator">=</span> normalise_rewards<span class="token punctuation">(</span>all_discounted_returns<span class="token punctuation">)</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"learning_iterations_per_round"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            all_ratio_of_policy_probabilities <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_all_ratio_of_policy_probabilities<span class="token punctuation">(</span><span class="token punctuation">)</span>
            loss <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_loss<span class="token punctuation">(</span><span class="token punctuation">[</span>all_ratio_of_policy_probabilities<span class="token punctuation">]</span><span class="token punctuation">,</span> all_discounted_returns<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>take_policy_new_optimisation_step<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">calculate_all_discounted_returns</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculates the cumulative discounted return for each episode which we will then use in a learning iteration"""</span>
        all_discounted_returns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> episode <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>many_episode_states<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            discounted_returns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> ix <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>many_episode_states<span class="token punctuation">[</span>episode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                return_value <span class="token operator">=</span> self<span class="token punctuation">.</span>many_episode_rewards<span class="token punctuation">[</span>episode<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span>ix <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"discount_rate"</span><span class="token punctuation">]</span><span class="token operator">*</span>discounted_returns<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                discounted_returns<span class="token punctuation">.</span>append<span class="token punctuation">(</span>return_value<span class="token punctuation">)</span>
            discounted_returns <span class="token operator">=</span> discounted_returns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            all_discounted_returns<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>discounted_returns<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> all_discounted_returns

    <span class="token keyword">def</span> <span class="token function">calculate_all_ratio_of_policy_probabilities</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""For each action calculates the ratio of the probability that the new policy would have picked the action vs.
         the probability the old policy would have picked it. This will then be used to inform the loss"""</span>
        all_states <span class="token operator">=</span> <span class="token punctuation">[</span>state <span class="token keyword">for</span> states <span class="token keyword">in</span> self<span class="token punctuation">.</span>many_episode_states <span class="token keyword">for</span> state <span class="token keyword">in</span> states<span class="token punctuation">]</span>
        all_actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>action<span class="token punctuation">]</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>action_types <span class="token operator">==</span> <span class="token string">"DISCRETE"</span> <span class="token keyword">else</span> action <span class="token keyword">for</span> actions <span class="token keyword">in</span> self<span class="token punctuation">.</span>many_episode_actions <span class="token keyword">for</span> action <span class="token keyword">in</span> actions <span class="token punctuation">]</span>
        all_states <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>states<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token keyword">for</span> states <span class="token keyword">in</span> all_states<span class="token punctuation">]</span><span class="token punctuation">)</span>

        all_actions <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token keyword">for</span> actions <span class="token keyword">in</span> all_actions<span class="token punctuation">]</span><span class="token punctuation">)</span>
        all_actions <span class="token operator">=</span> all_actions<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_states<span class="token punctuation">)</span><span class="token punctuation">)</span>

        new_policy_distribution_log_prob <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_log_probability_of_actions<span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_new<span class="token punctuation">,</span> all_states<span class="token punctuation">,</span> all_actions<span class="token punctuation">)</span>
        old_policy_distribution_log_prob <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_log_probability_of_actions<span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_old<span class="token punctuation">,</span> all_states<span class="token punctuation">,</span> all_actions<span class="token punctuation">)</span>
        ratio_of_policy_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>new_policy_distribution_log_prob<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>old_policy_distribution_log_prob<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ratio_of_policy_probabilities

    <span class="token keyword">def</span> <span class="token function">calculate_log_probability_of_actions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> policy<span class="token punctuation">,</span> states<span class="token punctuation">,</span> actions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculates the log probability of an action occuring given a policy and starting state"""</span>
        policy_output <span class="token operator">=</span> policy<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>states<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
        policy_distribution <span class="token operator">=</span> create_actor_distribution<span class="token punctuation">(</span>self<span class="token punctuation">.</span>action_types<span class="token punctuation">,</span> policy_output<span class="token punctuation">,</span> self<span class="token punctuation">.</span>action_size<span class="token punctuation">)</span>
        policy_distribution_log_prob <span class="token operator">=</span> policy_distribution<span class="token punctuation">.</span>log_prob<span class="token punctuation">(</span>actions<span class="token punctuation">)</span>
        <span class="token keyword">return</span> policy_distribution_log_prob

    <span class="token keyword">def</span> <span class="token function">calculate_loss</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> all_ratio_of_policy_probabilities<span class="token punctuation">,</span> all_discounted_returns<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculates the PPO loss"""</span>
        all_ratio_of_policy_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>all_ratio_of_policy_probabilities<span class="token punctuation">)</span><span class="token punctuation">)</span>
        all_ratio_of_policy_probabilities <span class="token operator">=</span> torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token operator">=</span>all_ratio_of_policy_probabilities<span class="token punctuation">,</span>
                                                        <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token operator">-</span>sys<span class="token punctuation">.</span>maxsize<span class="token punctuation">,</span>
                                                        <span class="token builtin">max</span> <span class="token operator">=</span> sys<span class="token punctuation">.</span>maxsize<span class="token punctuation">)</span>
        all_discounted_returns <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>all_discounted_returns<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>all_ratio_of_policy_probabilities<span class="token punctuation">)</span>
        potential_loss_value_1 <span class="token operator">=</span> all_discounted_returns <span class="token operator">*</span> all_ratio_of_policy_probabilities
        potential_loss_value_2 <span class="token operator">=</span> all_discounted_returns <span class="token operator">*</span> self<span class="token punctuation">.</span>clamp_probability_ratio<span class="token punctuation">(</span>all_ratio_of_policy_probabilities<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>potential_loss_value_1<span class="token punctuation">,</span> potential_loss_value_2<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> <span class="token operator">-</span>torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
        <span class="token keyword">return</span> loss

    <span class="token keyword">def</span> <span class="token function">clamp_probability_ratio</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clamps a value between a certain range determined by hyperparameter clip epsilon"""</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token operator">=</span>value<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token operator">=</span><span class="token number">1.0</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"clip_epsilon"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                  <span class="token builtin">max</span><span class="token operator">=</span><span class="token number">1.0</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"clip_epsilon"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">take_policy_new_optimisation_step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Takes an optimisation step for the new policy"""</span>
        self<span class="token punctuation">.</span>policy_new_optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># reset gradients to 0</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># this calculates the gradients</span>
        torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>clip_grad_norm_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_new<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span>
            <span class="token string">"gradient_clipping_norm"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># clip gradients to help stabilise training</span>
        self<span class="token punctuation">.</span>policy_new_optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># this applies the gradients</span>

    <span class="token keyword">def</span> <span class="token function">equalise_policies</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Sets the old policy's parameters equal to the new policy's parameters"""</span>
        <span class="token keyword">for</span> old_param<span class="token punctuation">,</span> new_param <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>policy_old<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>policy_new<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            old_param<span class="token punctuation">.</span>data<span class="token punctuation">.</span>copy_<span class="token punctuation">(</span>new_param<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">save_result</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Save the results seen by the agent in the most recent experiences"""</span>
        <span class="token keyword">for</span> ep <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>many_episode_rewards<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            total_reward <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>many_episode_rewards<span class="token punctuation">[</span>ep<span class="token punctuation">]</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>game_full_episode_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>total_reward<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>rolling_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>self<span class="token punctuation">.</span>game_full_episode_scores<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>rolling_score_window<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>save_max_result_seen<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0726_4176"></a>07-26</h4> 
<blockquote> 
 <ul><li>张本对林兆恒，林连续三局赛点被翻，太可惜了，没能看到精彩的爆冷。观赛感觉张本速度有余，力量不足，期待小胖拉爆他。</li><li>1/4赛水谷伊藤抢七局2:9死里逃生，昕雯却未能在抢七0:7，2:8的颓势下实现逆转，真的是越来越玄学了，这几天看下来rb队总是越战越勇，频频实现逆转，混双丢金，单打和团体一定要挺住啊。</li></ul> 
</blockquote> 
<p><s>混双输了，很难过，没心情写东西。</s><br> 不写不让过审，我可太难了。</p> 
<p>关于使用numba加速代码运行的一些装饰器写法：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> numba <span class="token keyword">import</span> jit
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time

<span class="token decorator annotation punctuation">@jit</span><span class="token punctuation">(</span>nopython<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">monte_carlo_pi</span><span class="token punctuation">(</span>nsamples<span class="token punctuation">)</span><span class="token punctuation">:</span>
	acc <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nsamples<span class="token punctuation">)</span><span class="token punctuation">:</span>
		x <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>
		y <span class="token operator">=</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">*</span>x<span class="token operator">+</span>y<span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">1.0</span><span class="token punctuation">:</span> acc <span class="token operator">+=</span> <span class="token number">1</span>
	<span class="token keyword">return</span> <span class="token number">4.0</span><span class="token operator">*</span>acc<span class="token operator">/</span>nsamples

<span class="token decorator annotation punctuation">@numba<span class="token punctuation">.</span>jit</span><span class="token punctuation">(</span>nopython<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>parallel<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logistic_regression</span><span class="token punctuation">(</span>Y<span class="token punctuation">,</span>X<span class="token punctuation">,</span>w<span class="token punctuation">,</span>iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
		w <span class="token operator">-=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">+</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>Y<span class="token operator">*</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token operator">*</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span>X<span class="token punctuation">)</span>
	<span class="token keyword">return</span> w

<span class="token keyword">def</span> <span class="token function">logistic_regression_</span><span class="token punctuation">(</span>Y<span class="token punctuation">,</span>X<span class="token punctuation">,</span>w<span class="token punctuation">,</span>iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>
		w <span class="token operator">-=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">+</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>Y<span class="token operator">*</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token operator">*</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span>X<span class="token punctuation">)</span>
	<span class="token keyword">return</span> w
</code></pre> 
<h4><a id="0727_4210"></a>07-27</h4> 
<blockquote> 
 <ul><li>回顾昨天的决赛，一方面昕雯前三场淘汰赛赢得太轻松，决赛先大比分赢了两局后有些轻敌了，另一方面前两局明显伊藤接不住许昕的反拉弧圈，许昕得分非常稳定，后来伊藤慢慢适应了许昕的力量后，许昕一板盖不死她。反观刘诗雯接伊藤发球稍显吃力，此消彼长，感觉就不对了。不管怎么说太遗憾，这应该是昕雯的退役之战，未能完满。客观地说，这次rb队的晋级夺冠之路真如小说情节般传奇，无论是对德国的死里逃生，还是决赛在2:0落后的情况下连扳三局逆转，真的是很精彩的表现。</li></ul> 
</blockquote> 
<p>单纯型法的简易实现：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> numpy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment">#标准型线性规划的单纯型tableu迭代算法实现</span>
<span class="token comment">#函数：计算差额成本</span>
<span class="token keyword">def</span> <span class="token function">calc_reduced_cost</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c_B<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>T <span class="token operator">-</span> c_B<span class="token punctuation">.</span>T <span class="token operator">*</span> B<span class="token punctuation">.</span>I <span class="token operator">*</span> A
<span class="token comment">#函数：计算目标函数值</span>
<span class="token keyword">def</span> <span class="token function">calc_object_value</span><span class="token punctuation">(</span>c_B<span class="token punctuation">,</span>B<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token operator">-</span>c_B<span class="token punctuation">.</span>T <span class="token operator">*</span> B<span class="token punctuation">.</span>I <span class="token operator">*</span> b
<span class="token comment">#函数：计算基解</span>
<span class="token keyword">def</span> <span class="token function">calc_BFS</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> B<span class="token punctuation">.</span>I <span class="token operator">*</span> b
<span class="token comment">#函数：计算基阵</span>
<span class="token keyword">def</span> <span class="token function">calc_Aex</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> B<span class="token punctuation">.</span>I <span class="token operator">*</span> A
tableau <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">#函数：创建迭代表</span>
<span class="token keyword">def</span> <span class="token function">create_tableau</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c_B<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
	C <span class="token operator">=</span> calc_reduced_cost<span class="token punctuation">(</span>c<span class="token punctuation">,</span>c_B<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">)</span>
	V <span class="token operator">=</span> calc_object_value<span class="token punctuation">(</span>c_B<span class="token punctuation">,</span>B<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
	X <span class="token operator">=</span> calc_BFS<span class="token punctuation">(</span>B<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
	A_<span class="token operator">=</span> calc_Aex<span class="token punctuation">(</span>B<span class="token punctuation">,</span>A<span class="token punctuation">)</span>
	table_1 <span class="token operator">=</span> hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#第一行</span>
	table_2 <span class="token operator">=</span> hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>A_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#其余行</span>
	table <span class="token operator">=</span> vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>table_1<span class="token punctuation">,</span>table_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> table
<span class="token comment">#函数：输出迭代表</span>
<span class="token keyword">def</span> <span class="token function">output_tableau</span><span class="token punctuation">(</span>tableau<span class="token punctuation">,</span>B_<span class="token punctuation">,</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment">#输出第一行x_1~x_n</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token operator">+</span><span class="token string">'\t'</span><span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x_"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
	<span class="token comment">#输出第二行V+C（对应tableau的第二行）</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n   "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>tableau<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
	<span class="token comment">#输出3~(m+2)行X+A_</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nx_"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>B_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span>tableau<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token comment">#simplex method算法实现（Bland选取法）</span>
<span class="token keyword">def</span> <span class="token function">simplex_method_algorithm</span><span class="token punctuation">(</span>tableau<span class="token punctuation">,</span>B_<span class="token punctuation">,</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	flag_1 <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment">#控制reduced cost</span>
	flag_2 <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment">#控制负reduced cost下的元素是否全负</span>
	pivot_col_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#储存可行的列数</span>
	pivot_row_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#储存可行的行数</span>
	index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token comment">#pivot_col的下标</span>
	<span class="token builtin">min</span> <span class="token operator">=</span> <span class="token number">999999</span>
	output_tableau<span class="token punctuation">(</span>tableau<span class="token punctuation">,</span>B_<span class="token punctuation">,</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>tableau<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			pivot_col_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			flag_1 <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">while</span> flag_1<span class="token punctuation">:</span>
		Q <span class="token operator">=</span> mat<span class="token punctuation">(</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#初等行变换的矩阵初始化</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">not</span> flag_2<span class="token punctuation">)</span><span class="token keyword">and</span><span class="token punctuation">(</span>index<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pivot_col_list<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			index <span class="token operator">+=</span> <span class="token number">1</span>
			pivot_col <span class="token operator">=</span> pivot_col_list<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
			<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">if</span> tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
					pivot_row_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
					flag_2 <span class="token operator">=</span> <span class="token boolean">True</span>
					
		<span class="token keyword">for</span> i <span class="token keyword">in</span> pivot_row_list<span class="token punctuation">:</span>
			<span class="token keyword">if</span> tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span>tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token builtin">min</span><span class="token punctuation">:</span>
				<span class="token builtin">min</span> <span class="token operator">=</span> tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span>tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span>
				pivot_row <span class="token operator">=</span> i
				
		B_<span class="token punctuation">[</span>pivot_row<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pivot_col<span class="token operator">-</span><span class="token number">1</span><span class="token comment">#修改基变量组</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> i<span class="token operator">==</span><span class="token punctuation">(</span>pivot_row<span class="token punctuation">)</span><span class="token punctuation">:</span>
				Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span>tableau<span class="token punctuation">[</span>pivot_row<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
				Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>pivot_row<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span><span class="token operator">/</span>tableau<span class="token punctuation">[</span>pivot_row<span class="token punctuation">,</span>pivot_col<span class="token punctuation">]</span>
		tableau <span class="token operator">=</span> Q <span class="token operator">*</span> tableau<span class="token comment">#对tablau初等行变换</span>
		<span class="token comment">#对tableau元素保留2位小数</span>
		tableau1 <span class="token operator">=</span> mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>tableau<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		flag_1 <span class="token operator">=</span> <span class="token boolean">False</span>
		flag_2 <span class="token operator">=</span> <span class="token boolean">False</span>
		pivot_col_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		pivot_row_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
		<span class="token builtin">min</span> <span class="token operator">=</span> <span class="token number">999999</span>
		output_tableau<span class="token punctuation">(</span>tableau1<span class="token punctuation">,</span>B_<span class="token punctuation">,</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>tableau<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				pivot_col_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
				flag_1 <span class="token operator">=</span> <span class="token boolean">True</span>
	
	<span class="token keyword">return</span> tableau
		
<span class="token comment">#获取问题规模</span>
n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入变量数目："</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#列数</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入约束条件数目："</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#行数</span>
<span class="token comment">#获取目标函数系数矩阵c</span>
tmp_list <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入目标函数系数矩阵：\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> tmp_list<span class="token punctuation">]</span>
c_mat <span class="token operator">=</span> mat<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c_mat<span class="token punctuation">)</span>
<span class="token comment">#获取线性等式约束系数矩阵A</span>
tmp_list <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入线性约束系数矩阵：\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span>
A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> tmp_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">]</span>
A_mat <span class="token operator">=</span> mat<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A_mat<span class="token punctuation">)</span>
<span class="token comment">#获取RHS矩阵b</span>
tmp_list <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入右值系数矩阵：\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> tmp_list<span class="token punctuation">]</span>
b_mat <span class="token operator">=</span> mat<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b_mat<span class="token punctuation">)</span>
<span class="token comment">#获取初始BFS基可行解x_0基变量的下标B_,初始基阵B,初始基目标函数阵c_B</span>
tmp_list <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入基可行解的下标："</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
B_ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> tmp_list<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>B_<span class="token punctuation">)</span>
B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> B_<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">]</span>
B_mat <span class="token operator">=</span> mat<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>B_mat<span class="token punctuation">)</span>
c_B <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> B_<span class="token punctuation">]</span>
c_B_mat <span class="token operator">=</span> mat<span class="token punctuation">(</span>c_B<span class="token punctuation">)</span>
<span class="token comment">#主程序</span>
tableau <span class="token operator">=</span> create_tableau<span class="token punctuation">(</span>c_mat<span class="token punctuation">.</span>T<span class="token punctuation">,</span>c_B_mat<span class="token punctuation">.</span>T<span class="token punctuation">,</span>B_mat<span class="token punctuation">,</span>A_mat<span class="token punctuation">,</span>b_mat<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
tableau <span class="token operator">=</span> simplex_method_algorithm<span class="token punctuation">(</span>tableau<span class="token punctuation">,</span>B_<span class="token punctuation">,</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0728_4342"></a>07-28</h4> 
<blockquote> 
 <ul><li>连日下雨导致马路上开始积水，而且邗江区出现病例，我们这边也要全员核酸，养个老日子都过得不安稳，烦得很。</li><li>早上的课很好，关于网络图的统计分析，值得关注。笔记见最新发布的博客。</li></ul> 
</blockquote> 
<ol start="2"><li> <p><strong>行为空间，损失函数与风险函数</strong></p> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           1 
          
         
           ) 
          
         
        
          (1) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> 理论框架：给定数据<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
        
          X 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span></span></span></span></span>，模型<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            F 
           
          
            θ 
           
          
         
        
          F_\theta 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathdefault">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，需要制定决策，如估计、检验以及预测。</p> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           2 
          
         
           ) 
          
         
        
          (2) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span> 行为空间：决策可以采取的所有<strong>值</strong>构成行为空间，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          \mathcal{A} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathcal">A</span></span></span></span></span></span>，我们需要得出某个映射<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           X 
          
         
           → 
          
         
           A 
          
         
        
          X\rightarrow\mathcal{A} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span style="margin-right: 0.07847em;" class="mord mathdefault">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathcal">A</span></span></span></span></span></span>。</p> 
  <ul><li>在检验中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            A 
           
          
            = 
           
          
            { 
           
          
            0 
           
          
            , 
           
          
            1 
           
          
            } 
           
          
         
           \mathcal{A}=\{0,1\} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathcal">A</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span></span>或<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            A 
           
          
            = 
           
          
            [ 
           
          
            0 
           
          
            , 
           
          
            1 
           
          
            ] 
           
          
         
           A=[0,1] 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>表示是否拒绝零假设或表示随机检验中拒绝零假设的概率。</li></ul> <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           3 
          
         
           ) 
          
         
        
          (3) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span> 损失函数：给定一个行动<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           a 
          
         
           ∈ 
          
         
           A 
          
         
        
          a\in A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span>，损失函数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           l 
          
         
           ( 
          
         
           a 
          
         
           , 
          
         
           θ 
          
         
           ) 
          
         
        
          l(a,\theta) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.01968em;" class="mord mathdefault">l</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="mclose">)</span></span></span></span></span>用于衡量该行为有多坏。</p> 
  <ul><li>确定检验中，一种合理的损失函数：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            l 
           
          
            ( 
           
          
            a 
           
          
            , 
           
          
            θ 
           
          
            ) 
           
          
            = 
           
           
           
             1 
            
            
            
              a 
             
            
              = 
             
            
              1 
             
            
           
          
            ⋅ 
           
           
           
             1 
            
            
            
              θ 
             
            
              ∈ 
             
             
             
               H 
              
             
               0 
              
             
            
           
          
            + 
           
           
           
             1 
            
            
            
              a 
             
            
              = 
             
            
              0 
             
            
           
          
            ⋅ 
           
           
           
             1 
            
            
            
              θ 
             
            
              ∈ 
             
             
             
               H 
              
             
               1 
              
             
            
           
          
         
           l(a,\theta)=\textbf{1}_{a=1}\cdot\textbf{1}_{\theta\in H_0}+\textbf{1}_{a=0}\cdot\textbf{1}_{\theta\in H_1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.01968em;" class="mord mathdefault">l</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.79444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.89454em; vertical-align: -0.2501em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">θ</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right: 0.08125em;" class="mord mathdefault mtight">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.08125em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.79444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.89454em; vertical-align: -0.2501em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">θ</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right: 0.08125em;" class="mord mathdefault mtight">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.08125em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span></span></span></span></span></li><li>随机检验中，一种合理的损失函数：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            l 
           
          
            ( 
           
          
            a 
           
          
            , 
           
          
            θ 
           
          
            ) 
           
          
            = 
           
          
            a 
           
          
            ⋅ 
           
           
           
             1 
            
            
            
              θ 
             
            
              ∈ 
             
             
             
               H 
              
             
               0 
              
             
            
           
          
            + 
           
          
            ( 
           
          
            1 
           
          
            − 
           
          
            a 
           
          
            ) 
           
          
            ⋅ 
           
           
           
             1 
            
            
            
              θ 
             
            
              ∈ 
             
             
             
               H 
              
             
               1 
              
             
            
           
          
         
           l(a,\theta)=a\cdot\textbf{1}_{\theta\in H_0}+(1-a)\cdot\textbf{1}_{\theta\in H_1} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.01968em;" class="mord mathdefault">l</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.44445em; vertical-align: 0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.89454em; vertical-align: -0.2501em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">θ</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right: 0.08125em;" class="mord mathdefault mtight">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.08125em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.89454em; vertical-align: -0.2501em;"></span><span class="mord"><span class="mord text"><span class="mord textbf">1</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02778em;" class="mord mathdefault mtight">θ</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right: 0.08125em;" class="mord mathdefault mtight">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.08125em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span></span></span></span></span></li></ul> </li></ol> 
<h4><a id="0729_4359"></a>07-29</h4> 
<blockquote> 
 <ul><li>屋漏偏逢连夜雨，积水更深，淹没电箱导致片区停电，一两天是修不好了。早上强撑着开热点听了3个小时，笔记更新。</li><li>七月跑量目前112km，下旬跑得很不规律。昨天试了跑步机5km，感觉稍有吃力，明早晨跑找状态。</li></ul> 
</blockquote> 
<p>DQN_HER的一个pytest测试脚本：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> random
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter

<span class="token keyword">import</span> pytest

<span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DQN_HER <span class="token keyword">import</span> DQN_HER
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DDQN <span class="token keyword">import</span> DDQN
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DDQN_With_Prioritised_Experience_Replay <span class="token keyword">import</span> DDQN_With_Prioritised_Experience_Replay
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DQN_With_Fixed_Q_Targets <span class="token keyword">import</span> DQN_With_Fixed_Q_Targets
<span class="token keyword">from</span> environments<span class="token punctuation">.</span>Bit_Flipping_Environment <span class="token keyword">import</span> Bit_Flipping_Environment
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>policy_gradient_agents<span class="token punctuation">.</span>PPO <span class="token keyword">import</span> PPO
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>Trainer <span class="token keyword">import</span> Trainer
<span class="token keyword">from</span> utilities<span class="token punctuation">.</span>data_structures<span class="token punctuation">.</span>Config <span class="token keyword">import</span> Config
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DQN <span class="token keyword">import</span> DQN
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch

random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

config <span class="token operator">=</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
config<span class="token punctuation">.</span>seed <span class="token operator">=</span> <span class="token number">1</span>
config<span class="token punctuation">.</span>environment <span class="token operator">=</span> Bit_Flipping_Environment<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
config<span class="token punctuation">.</span>num_episodes_to_run <span class="token operator">=</span> <span class="token number">1</span>
config<span class="token punctuation">.</span>file_to_save_data_results <span class="token operator">=</span> <span class="token boolean">None</span>
config<span class="token punctuation">.</span>file_to_save_results_graph <span class="token operator">=</span> <span class="token boolean">None</span>
config<span class="token punctuation">.</span>visualise_individual_results <span class="token operator">=</span> <span class="token boolean">False</span>
config<span class="token punctuation">.</span>visualise_overall_agent_results <span class="token operator">=</span> <span class="token boolean">False</span>
config<span class="token punctuation">.</span>randomise_random_seed <span class="token operator">=</span> <span class="token boolean">False</span>
config<span class="token punctuation">.</span>runs_per_agent <span class="token operator">=</span> <span class="token number">1</span>
config<span class="token punctuation">.</span>use_GPU <span class="token operator">=</span> <span class="token boolean">False</span>
config<span class="token punctuation">.</span>hyperparameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token string">"DQN_Agents"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>

        <span class="token string">"learning_rate"</span><span class="token punctuation">:</span> <span class="token number">0.005</span><span class="token punctuation">,</span>
        <span class="token string">"batch_size"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">"buffer_size"</span><span class="token punctuation">:</span> <span class="token number">40000</span><span class="token punctuation">,</span>
        <span class="token string">"epsilon"</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
        <span class="token string">"epsilon_decay_rate_denominator"</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token string">"discount_rate"</span><span class="token punctuation">:</span> <span class="token number">0.99</span><span class="token punctuation">,</span>
        <span class="token string">"tau"</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
        <span class="token string">"alpha_prioritised_replay"</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
        <span class="token string">"beta_prioritised_replay"</span><span class="token punctuation">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token string">"incremental_td_error"</span><span class="token punctuation">:</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token string">"update_every_n_steps"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">"linear_hidden_units"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"final_layer_activation"</span><span class="token punctuation">:</span> <span class="token string">"None"</span><span class="token punctuation">,</span>
        <span class="token string">"batch_norm"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
        <span class="token string">"gradient_clipping_norm"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token string">"HER_sample_proportion"</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
        <span class="token string">"clip_rewards"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


trainer <span class="token operator">=</span> Trainer<span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">[</span>DQN_HER<span class="token punctuation">]</span><span class="token punctuation">)</span>
config<span class="token punctuation">.</span>hyperparameters <span class="token operator">=</span> config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"DQN_Agents"</span><span class="token punctuation">]</span>
agent <span class="token operator">=</span> DQN_HER<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
agent<span class="token punctuation">.</span>reset_game<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test_initiation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Tests whether DQN_HER initiates correctly"""</span>
    config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"batch_size"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">64</span>
    agent <span class="token operator">=</span> DQN_HER<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    agent<span class="token punctuation">.</span>reset_game<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>ordinary_buffer_batch_size <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>HER_buffer_batch_size <span class="token operator">==</span> <span class="token number">64</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>q_network_local<span class="token punctuation">.</span>input_dim <span class="token operator">==</span> <span class="token number">8</span>
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>q_network_local<span class="token punctuation">.</span>output_layers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>out_features <span class="token operator">==</span> <span class="token number">4</span>

    <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>state_dict<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>observation<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span>
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>desired_goal<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span>
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>achieved_goal<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span>

    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>state<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span>
    <span class="token keyword">assert</span> <span class="token keyword">not</span> agent<span class="token punctuation">.</span>done
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>next_state <span class="token keyword">is</span> <span class="token boolean">None</span>
    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>reward <span class="token keyword">is</span> <span class="token boolean">None</span>

    config<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"batch_size"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">def</span> <span class="token function">test_action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Tests whether DQN_HER picks and conducts actions correctly"""</span>
    num_tries <span class="token operator">=</span> <span class="token number">1000</span>
    actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_tries<span class="token punctuation">)</span><span class="token punctuation">:</span>
        action <span class="token operator">=</span> agent<span class="token punctuation">.</span>pick_action<span class="token punctuation">(</span><span class="token punctuation">)</span>
        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>action<span class="token punctuation">)</span>

    actions_count <span class="token operator">=</span> Counter<span class="token punctuation">(</span>actions<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> actions_count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> num_tries<span class="token operator">*</span><span class="token number">0.1</span>
    <span class="token keyword">assert</span> actions_count<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> num_tries<span class="token operator">*</span><span class="token number">0.1</span>
    <span class="token keyword">assert</span> actions_count<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> num_tries<span class="token operator">*</span><span class="token number">0.1</span>
    <span class="token keyword">assert</span> actions_count<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> num_tries<span class="token operator">*</span><span class="token number">0.1</span>
    <span class="token keyword">assert</span> actions_count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> actions_count<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> actions_count<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> actions_count<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> num_tries

    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>next_state <span class="token keyword">is</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">test_tracks_changes_from_one_action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Tests that it tracks the changes as a result of actions correctly"""</span>

    previous_obs <span class="token operator">=</span> agent<span class="token punctuation">.</span>observation
    previous_desired_goal <span class="token operator">=</span> agent<span class="token punctuation">.</span>desired_goal
    previous_achieved_goal <span class="token operator">=</span> agent<span class="token punctuation">.</span>achieved_goal

    agent<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token number">0</span>
    agent<span class="token punctuation">.</span>conduct_action_in_changeable_goal_envs<span class="token punctuation">(</span>agent<span class="token punctuation">.</span>action<span class="token punctuation">)</span>

    <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>next_state<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span>
    <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>next_state_dict<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token keyword">not</span> <span class="token builtin">all</span> <span class="token punctuation">(</span>agent<span class="token punctuation">.</span>observation <span class="token operator">==</span> previous_obs<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>achieved_goal <span class="token operator">==</span> previous_achieved_goal<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token builtin">all</span> <span class="token punctuation">(</span>agent<span class="token punctuation">.</span>desired_goal <span class="token operator">==</span> previous_desired_goal<span class="token punctuation">)</span>

    agent<span class="token punctuation">.</span>track_changeable_goal_episodes_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
        agent<span class="token punctuation">.</span>HER_memory<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    agent<span class="token punctuation">.</span>save_alternative_experience<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sample <span class="token operator">=</span> agent<span class="token punctuation">.</span>HER_memory<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> sample<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> agent<span class="token punctuation">.</span>action
    <span class="token keyword">assert</span> sample<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span>

<span class="token keyword">def</span> <span class="token function">test_tracks_changes_from_multiple_actions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Tests that it tracks the changes as a result of actions correctly"""</span>

    agent <span class="token operator">=</span> DQN_HER<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    agent<span class="token punctuation">.</span>reset_game<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> ix <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        previous_obs <span class="token operator">=</span> agent<span class="token punctuation">.</span>observation
        previous_desired_goal <span class="token operator">=</span> agent<span class="token punctuation">.</span>desired_goal
        previous_achieved_goal <span class="token operator">=</span> agent<span class="token punctuation">.</span>achieved_goal

        agent<span class="token punctuation">.</span>action <span class="token operator">=</span> ix
        agent<span class="token punctuation">.</span>conduct_action_in_changeable_goal_envs<span class="token punctuation">(</span>agent<span class="token punctuation">.</span>action<span class="token punctuation">)</span>

        <span class="token keyword">assert</span> agent<span class="token punctuation">.</span>next_state<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">8</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>next_state_dict<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>observation <span class="token operator">==</span> previous_obs<span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>achieved_goal <span class="token operator">==</span> previous_achieved_goal<span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">all</span><span class="token punctuation">(</span>agent<span class="token punctuation">.</span>desired_goal <span class="token operator">==</span> previous_desired_goal<span class="token punctuation">)</span>

        agent<span class="token punctuation">.</span>track_changeable_goal_episodes_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
        agent<span class="token punctuation">.</span>save_experience<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> agent<span class="token punctuation">.</span>done<span class="token punctuation">:</span> agent<span class="token punctuation">.</span>save_alternative_experience<span class="token punctuation">(</span><span class="token punctuation">)</span>

        agent<span class="token punctuation">.</span>state_dict <span class="token operator">=</span> agent<span class="token punctuation">.</span>next_state_dict  <span class="token comment"># this is to set the state for the next iteration</span>
        agent<span class="token punctuation">.</span>state <span class="token operator">=</span> agent<span class="token punctuation">.</span>next_state

    states<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> rewards<span class="token punctuation">,</span> next_states<span class="token punctuation">,</span> dones <span class="token operator">=</span> agent<span class="token punctuation">.</span>HER_memory<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0730_4528"></a>07-30</h4> 
<blockquote> 
 <ul><li>在医院值班室过了一夜，早起晨跑发现医院门口已经开始排队查核酸。扬州四例确诊，到处都开始紧张起来，这个老太确实很坑，瞒报行程还到处乱跑偷绿码。有点担心开学回不了校，好在水已经退去，电也修好了。</li><li>WXY还是强，已经恢复到接近4分配的水平了。不过照这个态势，国内的马拉松估计又要受挫，至少南京马拉松肯定是没戏了，今年如果跑不了也是好事，多一些时间准备，上半年的比赛相对多一些，到时候争取练到能跑进一小时半，。其实跑步就是在不断受伤中寻求更好的跑法，从艰难到享受，跑得越久，体悟越深。</li><li>国乒无敌！</li></ul> 
</blockquote> 
<p>曹冲称象（给定若干石块及重量，给出称出大象重量所需的最少石块，有点类似集合划分问题）动态规划写法，感觉应该是要比穷举快不少的，这是前天有个同学来问我，不知道有没有更好的写法：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> random

N <span class="token operator">=</span> <span class="token number">10</span>
stones <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
stone_weight <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>stone<span class="token punctuation">:</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">for</span> stone <span class="token keyword">in</span> stones<span class="token punctuation">}</span>
elephant_weight <span class="token operator">=</span> <span class="token number">25</span>

memory <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token number">0</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stones<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

max_weight <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>stone_weight<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> weight <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> elephant_weight <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	memory<span class="token punctuation">[</span>weight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	
	<span class="token keyword">for</span> _weight <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>weight <span class="token operator">-</span> max_weight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>_used_stones<span class="token punctuation">,</span> _unused_stones<span class="token punctuation">)</span> <span class="token keyword">in</span> memory<span class="token punctuation">[</span>_weight<span class="token punctuation">]</span><span class="token punctuation">:</span>
			<span class="token keyword">for</span> _unused_stone <span class="token keyword">in</span> _unused_stones<span class="token punctuation">:</span>
				<span class="token keyword">if</span> _weight <span class="token operator">+</span> stone_weight<span class="token punctuation">[</span>_unused_stone<span class="token punctuation">]</span> <span class="token operator">==</span> weight<span class="token punctuation">:</span>
					used_stones <span class="token operator">=</span> _used_stones<span class="token punctuation">.</span>union<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>_unused_stone<span class="token punctuation">}</span><span class="token punctuation">)</span>
					unused_stones <span class="token operator">=</span> stones <span class="token operator">-</span> used_stones
					memory<span class="token punctuation">[</span>weight<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>used_stones<span class="token punctuation">,</span> unused_stones<span class="token punctuation">)</span><span class="token punctuation">)</span>

result <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> memory<span class="token punctuation">[</span>elephant_weight<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="0731_4568"></a>07-31</h4> 
<blockquote> 
 <ul><li>新增10例，成功晋级中风险地区，艹。</li><li>晚上老爸从邗江区没敢开车回家，试图骑共享电动车抄小路躲开封锁，结果半路上没电… 正在步行十公里回公司。江都公交停运，高速口封闭，怕是返校无望了，安心刷完暑期课的分罢。</li><li>七月跑量123.75km，运动总时长1511分钟，眼看着要练出腹肌了哈哈，这两天状态还不错。</li></ul> 
</blockquote> 
<p>PRover逻辑推理模型模块（一）：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pytorch_transformers <span class="token keyword">import</span> BertPreTrainedModel<span class="token punctuation">,</span> RobertaConfig<span class="token punctuation">,</span> \
    ROBERTA_PRETRAINED_MODEL_ARCHIVE_MAP<span class="token punctuation">,</span> RobertaModel
<span class="token keyword">from</span> pytorch_transformers<span class="token punctuation">.</span>modeling_roberta <span class="token keyword">import</span> RobertaClassificationHead
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> CrossEntropyLoss<span class="token punctuation">,</span> BCEWithLogitsLoss
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>rnn <span class="token keyword">import</span> pad_sequence

<span class="token keyword">class</span> <span class="token class-name">RobertaForRR</span><span class="token punctuation">(</span>BertPreTrainedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    config_class <span class="token operator">=</span> RobertaConfig
    pretrained_model_archive_map <span class="token operator">=</span> ROBERTA_PRETRAINED_MODEL_ARCHIVE_MAP
    base_model_prefix <span class="token operator">=</span> <span class="token string">"roberta"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>RobertaForRR<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> config<span class="token punctuation">.</span>num_labels
        self<span class="token punctuation">.</span>roberta <span class="token operator">=</span> RobertaModel<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier <span class="token operator">=</span> RobertaClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>init_weights<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> attention_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> position_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                head_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>roberta<span class="token punctuation">(</span>input_ids<span class="token punctuation">,</span> position_ids<span class="token operator">=</span>position_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">,</span>
                               attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> head_mask<span class="token operator">=</span>head_mask<span class="token punctuation">)</span>
        sequence_output <span class="token operator">=</span> outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>sequence_output<span class="token punctuation">)</span>

        outputs <span class="token operator">=</span> <span class="token punctuation">(</span>logits<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">+</span> outputs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> labels <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            loss_fct <span class="token operator">=</span> CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
            qa_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            outputs <span class="token operator">=</span> <span class="token punctuation">(</span>qa_loss<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">+</span> outputs

        <span class="token keyword">return</span> outputs  <span class="token comment"># qa_loss, logits, (hidden_states), (attentions)</span>
</code></pre> 
<h3><a id="August_2021_4613"></a>August 2021</h3> 
<h4><a id="0801_4614"></a>08-01</h4> 
<blockquote> 
 <ul><li>扬州围城。邗江区已经高风险了，目前所在的江都区通往主城（邗江区、广陵区）的通道是只出不进的，市场似乎有那么点恐慌，听说连鸡蛋都买不到了… 不过全国各地的情况都不是很好，几乎遍地开花，南京禄口这次难辞其咎，秋后算账罢。</li><li>下周抽空沿S237省道往高邮方向试一次长距离的公路越野，估摸着路上的车会越来越少。其实也是一件好事，想去年二三月份也是如此，清静的地方跑着最舒服了。</li></ul> 
</blockquote> 
<p>PRover逻辑推理模型模块（二）：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">RobertaForRRWithNodeLoss</span><span class="token punctuation">(</span>BertPreTrainedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    config_class <span class="token operator">=</span> RobertaConfig
    pretrained_model_archive_map <span class="token operator">=</span> ROBERTA_PRETRAINED_MODEL_ARCHIVE_MAP
    base_model_prefix <span class="token operator">=</span> <span class="token string">"roberta"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>RobertaForRRWithNodeLoss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> config<span class="token punctuation">.</span>num_labels
        self<span class="token punctuation">.</span>roberta <span class="token operator">=</span> RobertaModel<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier <span class="token operator">=</span> RobertaClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>naf_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier_node <span class="token operator">=</span> NodeClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>init_weights<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> attention_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> proof_offset<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> node_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                position_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> head_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>roberta<span class="token punctuation">(</span>input_ids<span class="token punctuation">,</span> position_ids<span class="token operator">=</span>position_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">,</span>
                            attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> head_mask<span class="token operator">=</span>head_mask<span class="token punctuation">)</span>
        sequence_output <span class="token operator">=</span> outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        cls_output <span class="token operator">=</span> sequence_output<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
        naf_output <span class="token operator">=</span> self<span class="token punctuation">.</span>naf_layer<span class="token punctuation">(</span>cls_output<span class="token punctuation">)</span>
        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>sequence_output<span class="token punctuation">)</span>

        max_node_length <span class="token operator">=</span> node_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        batch_size <span class="token operator">=</span> node_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        embedding_dim <span class="token operator">=</span> sequence_output<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

        batch_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> max_node_length<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> batch_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            prev_index <span class="token operator">=</span> <span class="token number">1</span>
            sample_node_embedding <span class="token operator">=</span> <span class="token boolean">None</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> offset <span class="token keyword">in</span> proof_offset<span class="token punctuation">[</span>batch_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> offset <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    rf_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sequence_output<span class="token punctuation">[</span>batch_index<span class="token punctuation">,</span> prev_index<span class="token punctuation">:</span><span class="token punctuation">(</span>offset<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                    prev_index <span class="token operator">=</span> offset<span class="token operator">+</span><span class="token number">1</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> sample_node_embedding <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                        sample_node_embedding <span class="token operator">=</span> rf_embedding
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span> rf_embedding<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            <span class="token comment"># Add the NAF output at the end</span>
            sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span> naf_output<span class="token punctuation">[</span>batch_index<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            <span class="token comment"># Append 0s at the end (these will be ignored for loss)</span>
            sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>max_node_length<span class="token operator">-</span>count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            batch_node_embedding<span class="token punctuation">[</span>batch_index<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> sample_node_embedding

        node_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier_node<span class="token punctuation">(</span>batch_node_embedding<span class="token punctuation">)</span>

        outputs <span class="token operator">=</span> <span class="token punctuation">(</span>logits<span class="token punctuation">,</span> node_logits<span class="token punctuation">)</span> <span class="token operator">+</span> outputs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> labels <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            loss_fct <span class="token operator">=</span> CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
            qa_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            node_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>node_logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> node_label<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            total_loss <span class="token operator">=</span> qa_loss <span class="token operator">+</span> node_loss
            outputs <span class="token operator">=</span> <span class="token punctuation">(</span>total_loss<span class="token punctuation">,</span> qa_loss<span class="token punctuation">,</span> node_loss<span class="token punctuation">)</span> <span class="token operator">+</span> outputs

        <span class="token keyword">return</span> outputs  <span class="token comment"># (total_loss), qa_loss, node_loss, logits, node_logits, (hidden_states), (attentions)</span>
</code></pre> 
<h4><a id="0802_4686"></a>08-02</h4> 
<blockquote> 
 <ul><li>邵伯镇进江都区主城的路也用泥土堵死了，高速关口两道板加特警把守，以前最严重的时候也没有这么紧张过。明天老妈开始去高速口轮值测核酸，城区全面停工停产。</li><li>老爸困在家里上不了班，不过好在前天还是连夜抄小路走回来，要不然现在困在邗江区就更糟糕了。</li><li>其实除了扬州城区，下辖的江都区、高邮市、仪征市、宝应县，目前都还没有确诊病例，这几天一直没有出门，也不知道外面情况怎么样，老妈也不让出去跑步。这次扬州棋牌室真的是全国出名了，真是好事不出门，糗事传千里。</li></ul> 
</blockquote> 
<p>DQN的HER版本：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> agents<span class="token punctuation">.</span>DQN_agents<span class="token punctuation">.</span>DQN <span class="token keyword">import</span> DQN
<span class="token keyword">from</span> agents<span class="token punctuation">.</span>HER_Base <span class="token keyword">import</span> HER_Base

<span class="token keyword">class</span> <span class="token class-name">DQN_HER</span><span class="token punctuation">(</span>HER_Base<span class="token punctuation">,</span> DQN<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""DQN algorithm with hindsight experience replay"""</span>
    agent_name <span class="token operator">=</span> <span class="token string">"DQN-HER"</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        DQN<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
        HER_Base<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"buffer_size"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"batch_size"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"HER_sample_proportion"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">step</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Runs a step within a game including a learning step if required"""</span>
        <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>done<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>action <span class="token operator">=</span> self<span class="token punctuation">.</span>pick_action<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>conduct_action_in_changeable_goal_envs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>action<span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>time_for_q_network_to_learn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>hyperparameters<span class="token punctuation">[</span><span class="token string">"learning_iterations"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>learn<span class="token punctuation">(</span>experiences<span class="token operator">=</span>self<span class="token punctuation">.</span>sample_from_HER_and_Ordinary_Buffer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>track_changeable_goal_episodes_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>save_experience<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>done<span class="token punctuation">:</span> self<span class="token punctuation">.</span>save_alternative_experience<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>state_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>next_state_dict  <span class="token comment"># this is to set the state for the next iteration</span>
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> self<span class="token punctuation">.</span>next_state
            self<span class="token punctuation">.</span>global_step_number <span class="token operator">+=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>episode_number <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">enough_experiences_to_learn_from</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Returns booleans indicating whether there are enough experiences in the two replay buffers to learn from"""</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>memory<span class="token punctuation">)</span> <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>ordinary_buffer_batch_size <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>HER_memory<span class="token punctuation">)</span> <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>HER_buffer_batch_size
</code></pre> 
<h4><a id="0803_4725"></a>08-03</h4> 
<blockquote> 
 <ul><li>全民核检第一天，老妈早上六点多就出门，中午回来了一个小时，然后要今天值班一个通宵不回来，真的累死。下午出去边走边跑了十几公里，热得不行，不带补给想跑高邮公路线还是太勉强。</li><li>全镇三个核检点，队伍长度加起来得有一公里多，在户外又热又闷，这毛老太真的是太可恶了，全扬州人跟着她一起倒霉，今天终于给抓起来了。</li></ul> 
</blockquote> 
<p>PRover逻辑推理模型模块（三）：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">RobertaForRRWithNodeEdgeLoss</span><span class="token punctuation">(</span>BertPreTrainedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    config_class <span class="token operator">=</span> RobertaConfig
    pretrained_model_archive_map <span class="token operator">=</span> ROBERTA_PRETRAINED_MODEL_ARCHIVE_MAP
    base_model_prefix <span class="token operator">=</span> <span class="token string">"roberta"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>RobertaForRRWithNodeEdgeLoss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> config<span class="token punctuation">.</span>num_labels
        self<span class="token punctuation">.</span>num_labels_edge <span class="token operator">=</span> <span class="token number">2</span>
        self<span class="token punctuation">.</span>roberta <span class="token operator">=</span> RobertaModel<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>naf_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier <span class="token operator">=</span> RobertaClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier_node <span class="token operator">=</span> NodeClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier_edge <span class="token operator">=</span> EdgeClassificationHead<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>init_weights<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> attention_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> proof_offset<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> node_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                edge_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> position_ids<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> head_mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>roberta<span class="token punctuation">(</span>input_ids<span class="token punctuation">,</span> position_ids<span class="token operator">=</span>position_ids<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">,</span>
                            attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> head_mask<span class="token operator">=</span>head_mask<span class="token punctuation">)</span>

        sequence_output <span class="token operator">=</span> outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        cls_output <span class="token operator">=</span> sequence_output<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
        naf_output <span class="token operator">=</span> self<span class="token punctuation">.</span>naf_layer<span class="token punctuation">(</span>cls_output<span class="token punctuation">)</span>
        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>sequence_output<span class="token punctuation">)</span>

        max_node_length <span class="token operator">=</span> node_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        max_edge_length <span class="token operator">=</span> edge_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        batch_size <span class="token operator">=</span> node_label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        embedding_dim <span class="token operator">=</span> sequence_output<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

        batch_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> max_node_length<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>
        batch_edge_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> max_edge_length<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> batch_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            prev_index <span class="token operator">=</span> <span class="token number">1</span>
            sample_node_embedding <span class="token operator">=</span> <span class="token boolean">None</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> offset <span class="token keyword">in</span> proof_offset<span class="token punctuation">[</span>batch_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> offset <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    rf_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sequence_output<span class="token punctuation">[</span>batch_index<span class="token punctuation">,</span> prev_index<span class="token punctuation">:</span><span class="token punctuation">(</span>offset<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                    prev_index <span class="token operator">=</span> offset<span class="token operator">+</span><span class="token number">1</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> sample_node_embedding <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                        sample_node_embedding <span class="token operator">=</span> rf_embedding
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span> rf_embedding<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            <span class="token comment"># Add the NAF output at the end</span>
            sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span> naf_output<span class="token punctuation">[</span>batch_index<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            repeat1 <span class="token operator">=</span> sample_node_embedding<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            repeat2 <span class="token operator">=</span> sample_node_embedding<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            sample_edge_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>repeat1<span class="token punctuation">,</span> repeat2<span class="token punctuation">,</span> <span class="token punctuation">(</span>repeat1<span class="token operator">-</span>repeat2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

            sample_edge_embedding <span class="token operator">=</span> sample_edge_embedding<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> sample_edge_embedding<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># Append 0s at the end (these will be ignored for loss)</span>
            sample_node_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_node_embedding<span class="token punctuation">,</span>
                                               torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>max_node_length<span class="token operator">-</span>count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            sample_edge_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>sample_edge_embedding<span class="token punctuation">,</span>
                                               torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>max_edge_length<span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>sample_edge_embedding<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>embedding_dim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            batch_node_embedding<span class="token punctuation">[</span>batch_index<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> sample_node_embedding
            batch_edge_embedding<span class="token punctuation">[</span>batch_index<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> sample_edge_embedding

        node_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier_node<span class="token punctuation">(</span>batch_node_embedding<span class="token punctuation">)</span>
        edge_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier_edge<span class="token punctuation">(</span>batch_edge_embedding<span class="token punctuation">)</span>

        outputs <span class="token operator">=</span> <span class="token punctuation">(</span>logits<span class="token punctuation">,</span> node_logits<span class="token punctuation">,</span> edge_logits<span class="token punctuation">)</span> <span class="token operator">+</span> outputs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> labels <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            loss_fct <span class="token operator">=</span> CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
            qa_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            node_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>node_logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span><span class="token punctuation">,</span> node_label<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            edge_loss <span class="token operator">=</span> loss_fct<span class="token punctuation">(</span>edge_logits<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_labels_edge<span class="token punctuation">)</span><span class="token punctuation">,</span> edge_label<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            total_loss <span class="token operator">=</span> qa_loss <span class="token operator">+</span> node_loss <span class="token operator">+</span> edge_loss
            outputs <span class="token operator">=</span> <span class="token punctuation">(</span>total_loss<span class="token punctuation">,</span> qa_loss<span class="token punctuation">,</span> node_loss<span class="token punctuation">,</span> edge_loss<span class="token punctuation">)</span> <span class="token operator">+</span> outputs

        <span class="token keyword">return</span> outputs  <span class="token comment"># (total_loss), qa_loss, node_loss, edge_loss, logits, node_logits, edge_logits, (hidden_states), (attentions)</span>
</code></pre> 
<h4><a id="0804_4817"></a>08-04</h4> 
<blockquote> 
 <ul><li>早上听讲座看到韩冬梅又是一激灵，想到期末作业还是没交，笑死我了，她不想要，我们也不想交，绝了。</li></ul> 
</blockquote> 
<p>PRover逻辑推理模型模块（四）：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">EdgeClassificationHead</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Head for sentence-level classification tasks."""</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>EdgeClassificationHead<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span>config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>config<span class="token punctuation">.</span>hidden_dropout_prob<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>out_proj <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> config<span class="token punctuation">.</span>num_labels<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> features<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>out_proj<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x
</code></pre> 
<h4><a id="0805_4841"></a>08-05</h4> 
<blockquote> 
 <ul><li>跑休，女团轻松夺冠。</li></ul> 
</blockquote> 
<p>PRover逻辑推理模型模块（五）：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">RRProcessorQA</span><span class="token punctuation">(</span>DataProcessor<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_train_examples</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_create_examples<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"train.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"meta-train.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_dev_examples</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Change these to test paths for test results</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_create_examples<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"dev.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"meta-dev.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token triple-quoted-string string">'''
        return self._create_examples_leave_one_out(
            self._read_jsonl(os.path.join(data_dir, "leave-one-out.jsonl"))
        )
        '''</span>

    <span class="token keyword">def</span> <span class="token function">get_test_examples</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_create_examples<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"test.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>_read_jsonl<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"meta-test.jsonl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_labels</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_create_examples</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> records<span class="token punctuation">,</span> meta_records<span class="token punctuation">)</span><span class="token punctuation">:</span>
        examples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span>record<span class="token punctuation">,</span> meta_record<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>records<span class="token punctuation">,</span> meta_records<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token keyword">assert</span> record<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">==</span> meta_record<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
            context <span class="token operator">=</span> record<span class="token punctuation">[</span><span class="token string">"context"</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token punctuation">,</span> question<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">"questions"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token builtin">id</span> <span class="token operator">=</span> question<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
                label <span class="token operator">=</span> question<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span>
                meta_data <span class="token operator">=</span> meta_record<span class="token punctuation">[</span><span class="token string">"questions"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Q"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                proofs <span class="token operator">=</span> meta_data<span class="token punctuation">[</span><span class="token string">"proofs"</span><span class="token punctuation">]</span>
                <span class="token comment">#if "CWA" in proofs:</span>
                <span class="token comment">#    continue</span>
                <span class="token comment">#if question["meta"]["QDep"] != 3:</span>
                <span class="token comment">#    continue</span>
                question <span class="token operator">=</span> question<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>

                examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>RRInputExampleQA<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span> question<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> examples

    <span class="token keyword">def</span> <span class="token function">_create_examples_leave_one_out</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">:</span>
        examples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> record <span class="token keyword">in</span> records<span class="token punctuation">:</span>
            examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>RRInputExampleQA<span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> record<span class="token punctuation">[</span><span class="token string">"context"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> record<span class="token punctuation">[</span><span class="token string">"question"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> record<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> examples
</code></pre> 
<hr> 
<h2><a id="_4901"></a>完篇记</h2> 
<p>差不多只有三个月时间就写到上限字数了，看来这三个月我的话是有些多。作为一个阶段性的结束，写些东西免得虎头蛇尾。</p> 
<p>最近状态不是很好，外婆好像突然生病了。老妈今晚又是将近十一点才回来，不过江都区的核检应该快要结束了，因为没有出大问题。我和老爸已经在家里关了快两周的禁闭，每天除了吃饭睡觉，就是跑步和码字，实在是没有什么事情可写。事实上也不太做得进去东西，连想静下心看点番的耐性都没有，前一阵子还能认真听完了前15场讲座，今天中午就直接挂机睡觉了，起来再看自己已经是会议室的主持人了[Facepalm]。不过最近还是有些灵感，在做一些有趣的工作，或许有空会再写点博客。</p> 
<p>这里先分享一个python写得截屏小脚本（因为最近把C盘WindowsApp文件夹清空掉之后，所有WIN10自带的软件都用不了了，包括计算器和截屏之类的。而且新机连微信都没装，只能手动写个截屏的凑合，要不然还得printscreen再到word里裁剪，实在是太蠢，这个脚本只要点一下需要截屏部分的左上角和右下角即可实现截屏，用的是pynput的鼠标事件监听来实现的）：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy
<span class="token keyword">import</span> pyautogui

<span class="token keyword">from</span> pynput<span class="token punctuation">.</span>mouse <span class="token keyword">import</span> Controller
<span class="token keyword">from</span> pynput <span class="token keyword">import</span> mouse

<span class="token keyword">def</span> <span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 	
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'temp/screenshot.log'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
		<span class="token keyword">pass</span>
	<span class="token keyword">global</span> count<span class="token punctuation">,</span> image
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Prepare for Screenshot ...'</span><span class="token punctuation">)</span>
	time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
	image <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
	image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>numpy<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
	count <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">def</span> <span class="token function">_on_move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">True</span>
	<span class="token keyword">def</span> <span class="token function">_on_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> button<span class="token punctuation">,</span> pressed<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">global</span> count<span class="token punctuation">,</span> image
		<span class="token keyword">if</span> pressed<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token boolean">True</span>
		count <span class="token operator">+=</span> <span class="token number">1</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'temp/screenshot.log'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">\t</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> count <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token boolean">True</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'temp/screenshot.log'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			lines <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
		x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	
		y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> lines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	
		image <span class="token operator">=</span> image<span class="token punctuation">[</span>x2<span class="token punctuation">:</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span> y1<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
		cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'temp/image-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d%H%M%S"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.png'</span></span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">False</span>
	<span class="token keyword">def</span> <span class="token function">_on_scroll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">True</span>
	<span class="token keyword">with</span> mouse<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_move<span class="token operator">=</span>_on_move<span class="token punctuation">,</span> on_click<span class="token operator">=</span>_on_click<span class="token punctuation">,</span> on_scroll<span class="token operator">=</span>_on_scroll<span class="token punctuation">)</span> <span class="token keyword">as</span> listener<span class="token punctuation">:</span>
		listener<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后顺便汇总一下python里截屏的所有方法，大概有三四种，截屏图片的channel次序稍有区别，用之前先确认一下。</p> 
<pre><code class="prism language-python"><span class="token comment"># 方法一</span>
<span class="token keyword">import</span> pyautogui
<span class="token keyword">import</span> cv2
 
img <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>region<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># x,y,w,h</span>
<span class="token comment"># img.save('screenshot.png')</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>

<span class="token comment"># 方法二</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> win32gui
<span class="token keyword">import</span> sys
 
hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'C:\Windows\system32\cmd.exe'</span><span class="token punctuation">)</span>
app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
screen <span class="token operator">=</span> QApplication<span class="token punctuation">.</span>primaryScreen<span class="token punctuation">(</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> screen<span class="token punctuation">.</span>grabWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">.</span>toImage<span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"screenshot.jpg"</span><span class="token punctuation">)</span>

<span class="token comment"># 方法三</span>
<span class="token keyword">import</span> win32gui
hwnd_title <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_all_hwnd</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>mouse<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> win32gui<span class="token punctuation">.</span>IsWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span> <span class="token keyword">and</span> win32gui<span class="token punctuation">.</span>IsWindowEnabled<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span> <span class="token keyword">and</span> win32gui<span class="token punctuation">.</span>IsWindowVisible<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    hwnd_title<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>hwnd<span class="token punctuation">:</span>win32gui<span class="token punctuation">.</span>GetWindowText<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 
win32gui<span class="token punctuation">.</span>EnumWindows<span class="token punctuation">(</span>get_all_hwnd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  
<span class="token keyword">for</span> h<span class="token punctuation">,</span>t <span class="token keyword">in</span> hwnd_title<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> t <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token string">""</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> t<span class="token punctuation">)</span>

<span class="token comment"># 方法四</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab
 
img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span>bbox<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">1141</span><span class="token punctuation">,</span> <span class="token number">610</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>img<span class="token punctuation">.</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>img<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<p>总是想出去走走，憋坏了。每天跑步机五公里，跑三休一，跑前跑后坚持拉伸，慢慢地腿已经恢复得很好了，看着外面空旷的街道心里总是痒痒的，自从回家后就再没有跑过10km以上的里程，今年的半马八成也泡汤了。也不知道这该死的疫情啥时候能过去，好像刘天浩也在扬州，不过他那儿是重灾区，估计比我的处境要惨，返校我们肯定都是逃不了要隔离的。</p> 
<p>虽然但是，还是说了很多废话，因为也不知道该写一些什么作为结束。总之在家还是有好处的，至少不需要想什么破事，就这样慢慢地生活，没有人来叨扰。生活本该如此，不温不火是日常，但应当保持内心始终在炽热，也许跑不到那么远，但是至少应当燃烧到最后一刻。</p> 
<blockquote> 
 <p>—— 永远奔跑，无论是否年轻。<br> 2021年8月12日 0:34 囚生<br> [本文完]<br> <font color="red">新篇发布于</font>：<a href="https://www.jianshu.com/p/a1623d2c757b" rel="nofollow">https://www.jianshu.com/p/a1623d2c757b</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7a918fc1e8e6ae1a6987f3e103db8c12/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">戴尔服务器装linux系统花屏,解决Virtual PC装Linux出现花屏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a3a5b94d03a387c49b6fb67c07d8a66/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在Mac上Topaz Gigapixel AI作为Photoshop插件未显示在“文件”-＞“自动”中的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>