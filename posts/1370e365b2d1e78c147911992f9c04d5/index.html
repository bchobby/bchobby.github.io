<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot Data中文文档 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot Data中文文档" />
<meta property="og:description" content="本文为官方文档直译版本。原文链接
Spring Boot Data中文文档 引言SQL 数据库配置数据源嵌入式数据库支持连接到生产数据库数据源配置支持的连接池连接到 JNDI 数据源 使用 JdbcTemplate使用 JdbcClientJPA 和 Spring Data JPA实体类Spring Data JPA RepositoriesSpring Data Envers Repositories创建和删除 JPA 数据库在视图中打开 EntityManager Spring Data JDBC使用 H2 的 Web 控制台更改 H2 控制台路径在安全应用程序中访问 H2 控制台 使用 jOOQ代码生成使用 DSLContextjOOQ SQL 语言自定义 jOOQ 使用 R2DBC嵌入式数据库支持使用 DatabaseClientSpring Data R2DBC Repositories 使用 NoSQL 技术Redis连接到 Redis MongoDB连接到 MongoDB 数据库MongoTemplateSpring Data MongoDB Repositories Neo4j连接到 Neo4j 数据库Spring Data Neo4j Repositories Elasticsearch使用 REST 客户端连接 Elasticsearch使用 RestClient 连接 Elasticsearch使用 ElasticsearchClient 连接到 Elasticsearch使用 ReactiveElasticsearchClient 连接到 Elasticsearch 使用 Spring Data 连接 ElasticsearchSpring Data Elasticsearch Repositories Cassandra连接到 CassandraSpring Data Cassandra Repositories Couchbase连接到 CouchbaseSpring Data Couchbase Repositories LDAP连接到 LDAP 服务器Spring Data LDAP Repositories嵌入式内存 LDAP 服务器 InfluxDB连接到 InfluxDB 引言 Spring Boot 集成了许多数据技术，包括 SQL 和 NoSQL。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/1370e365b2d1e78c147911992f9c04d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T09:52:45+08:00" />
<meta property="article:modified_time" content="2023-12-29T09:52:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot Data中文文档</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文为官方文档直译版本。<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/data.html#data" rel="nofollow">原文链接</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>Spring Boot Data中文文档</h4> 
 <ul><li><ul><li><a href="#_3" rel="nofollow">引言</a></li><li><a href="#SQL__5" rel="nofollow">SQL 数据库</a></li><li><ul><li><a href="#_7" rel="nofollow">配置数据源</a></li><li><ul><li><a href="#_11" rel="nofollow">嵌入式数据库支持</a></li><li><a href="#_34" rel="nofollow">连接到生产数据库</a></li><li><a href="#_36" rel="nofollow">数据源配置</a></li><li><a href="#_62" rel="nofollow">支持的连接池</a></li><li><a href="#_JNDI__82" rel="nofollow">连接到 JNDI 数据源</a></li></ul> 
    </li><li><a href="#_JdbcTemplate_90" rel="nofollow">使用 JdbcTemplate</a></li><li><a href="#_JdbcClient_120" rel="nofollow">使用 JdbcClient</a></li><li><a href="#JPA__Spring_Data_JPA_142" rel="nofollow">JPA 和 Spring Data JPA</a></li><li><ul><li><a href="#_150" rel="nofollow">实体类</a></li><li><a href="#Spring_Data_JPA_Repositories_200" rel="nofollow">Spring Data JPA Repositories</a></li><li><a href="#Spring_Data_Envers_Repositories_226" rel="nofollow">Spring Data Envers Repositories</a></li><li><a href="#_JPA__244" rel="nofollow">创建和删除 JPA 数据库</a></li><li><a href="#_EntityManager_262" rel="nofollow">在视图中打开 EntityManager</a></li></ul> 
    </li><li><a href="#Spring_Data_JDBC_264" rel="nofollow">Spring Data JDBC</a></li><li><a href="#_H2__Web__269" rel="nofollow">使用 H2 的 Web 控制台</a></li><li><ul><li><a href="#_H2__279" rel="nofollow">更改 H2 控制台路径</a></li><li><a href="#_H2__281" rel="nofollow">在安全应用程序中访问 H2 控制台</a></li></ul> 
    </li><li><a href="#_jOOQ_321" rel="nofollow">使用 jOOQ</a></li><li><ul><li><a href="#_323" rel="nofollow">代码生成</a></li><li><a href="#_DSLContext_350" rel="nofollow">使用 DSLContext</a></li><li><a href="#jOOQ_SQL__382" rel="nofollow">jOOQ SQL 语言</a></li><li><a href="#_jOOQ_386" rel="nofollow">自定义 jOOQ</a></li></ul> 
    </li><li><a href="#_R2DBC_389" rel="nofollow">使用 R2DBC</a></li><li><ul><li><a href="#_448" rel="nofollow">嵌入式数据库支持</a></li><li><a href="#_DatabaseClient_459" rel="nofollow">使用 DatabaseClient</a></li><li><a href="#Spring_Data_R2DBC_Repositories_484" rel="nofollow">Spring Data R2DBC Repositories</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_NoSQL__502" rel="nofollow">使用 NoSQL 技术</a></li><li><ul><li><a href="#Redis_516" rel="nofollow">Redis</a></li><li><ul><li><a href="#_Redis_521" rel="nofollow">连接到 Redis</a></li></ul> 
    </li><li><a href="#MongoDB_573" rel="nofollow">MongoDB</a></li><li><ul><li><a href="#_MongoDB__575" rel="nofollow">连接到 MongoDB 数据库</a></li><li><a href="#MongoTemplate_648" rel="nofollow">MongoTemplate</a></li><li><a href="#Spring_Data_MongoDB_Repositories_673" rel="nofollow">Spring Data MongoDB Repositories</a></li></ul> 
    </li><li><a href="#Neo4j_692" rel="nofollow">Neo4j</a></li><li><ul><li><a href="#_Neo4j__694" rel="nofollow">连接到 Neo4j 数据库</a></li><li><a href="#Spring_Data_Neo4j_Repositories_736" rel="nofollow">Spring Data Neo4j Repositories</a></li></ul> 
    </li><li><a href="#Elasticsearch_773" rel="nofollow">Elasticsearch</a></li><li><ul><li><a href="#_REST__Elasticsearch_782" rel="nofollow">使用 REST 客户端连接 Elasticsearch</a></li><li><ul><li><a href="#_RestClient__Elasticsearch_792" rel="nofollow">使用 RestClient 连接 Elasticsearch</a></li><li><a href="#_ElasticsearchClient__Elasticsearch_803" rel="nofollow">使用 ElasticsearchClient 连接到 Elasticsearch</a></li><li><a href="#_ReactiveElasticsearchClient__Elasticsearch_806" rel="nofollow">使用 ReactiveElasticsearchClient 连接到 Elasticsearch</a></li></ul> 
     </li><li><a href="#_Spring_Data__Elasticsearch_809" rel="nofollow">使用 Spring Data 连接 Elasticsearch</a></li><li><a href="#Spring_Data_Elasticsearch_Repositories_831" rel="nofollow">Spring Data Elasticsearch Repositories</a></li></ul> 
    </li><li><a href="#Cassandra_847" rel="nofollow">Cassandra</a></li><li><ul><li><a href="#_Cassandra_849" rel="nofollow">连接到 Cassandra</a></li><li><a href="#Spring_Data_Cassandra_Repositories_915" rel="nofollow">Spring Data Cassandra Repositories</a></li></ul> 
    </li><li><a href="#Couchbase_920" rel="nofollow">Couchbase</a></li><li><ul><li><a href="#_Couchbase_922" rel="nofollow">连接到 Couchbase</a></li><li><a href="#Spring_Data_Couchbase_Repositories_943" rel="nofollow">Spring Data Couchbase Repositories</a></li></ul> 
    </li><li><a href="#LDAP_999" rel="nofollow">LDAP</a></li><li><ul><li><a href="#_LDAP__1002" rel="nofollow">连接到 LDAP 服务器</a></li><li><a href="#Spring_Data_LDAP_Repositories_1013" rel="nofollow">Spring Data LDAP Repositories</a></li><li><a href="#_LDAP__1039" rel="nofollow">嵌入式内存 LDAP 服务器</a></li></ul> 
    </li><li><a href="#InfluxDB_1058" rel="nofollow">InfluxDB</a></li><li><ul><li><a href="#_InfluxDB_1062" rel="nofollow">连接到 InfluxDB</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_3"></a>引言</h3> 
<p>Spring Boot 集成了许多数据技术，包括 SQL 和 NoSQL。</p> 
<h3><a id="SQL__5"></a>SQL 数据库</h3> 
<p><a href="https://spring.io/projects/spring-framework" rel="nofollow">Spring Framework</a> 为使用 SQL 数据库提供了广泛的支持，从使用 <code>JdbcClient</code> 或 <code>JdbcTemplate</code> 的直接 JDBC 访问到完整的 “对象关系映射” 技术（如 Hibernate）。<a href="https://spring.io/projects/spring-data" rel="nofollow">Spring Data</a> 提供了额外的功能：直接从接口创建存储库实现，并使用约定从方法名称生成查询。</p> 
<h4><a id="_7"></a>配置数据源</h4> 
<p>Java 的 <code>javax.sql.DataSource</code> 接口提供了一种处理数据库连接的标准方法。传统上，数据源使用 URL 和一些凭证来建立数据库连接。</p> 
<blockquote> 
 <p>有关更多高级示例，请参阅 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-access.configure-custom-datasource" rel="nofollow">“操作方法” 部分</a>，通常可以完全控制数据源的配置。</p> 
</blockquote> 
<h5><a id="_11"></a>嵌入式数据库支持</h5> 
<p>使用嵌入式内存数据库开发应用程序通常很方便。显然，内存数据库不提供持久存储。您需要在应用程序启动时填充数据库，并做好在应用程序结束时丢弃数据的准备。</p> 
<blockquote> 
 <p>"操作方法"部分包括<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-initialization" rel="nofollow">如何初始化数据库</a>。</p> 
</blockquote> 
<p>Spring Boot 可以自动配置嵌入式 <a href="https://www.h2database.com/" rel="nofollow">H2</a>、<a href="https://hsqldb.org/" rel="nofollow">HSQL</a> 和 <a href="https://db.apache.org/derby/" rel="nofollow">Derby</a> 数据库。您无需提供任何连接 URL。您只需将构建依赖关系包含到您要使用的嵌入式数据库中。如果类路径上有多个嵌入式数据库，可设置 <code>spring.datasource.embedded-database-connection</code> 配置属性来控制使用哪个数据库。将该属性设置为 “none” 将禁用嵌入式数据库的自动配置。</p> 
<blockquote> 
 <p>如果您在测试中使用此功能，您可能会发现，无论您使用多少应用程序上下文，整个测试套件都会重复使用同一个数据库。如果要确保每个上下文都有独立的嵌入式数据库，则应将 <code>spring.datasource.generate-unique-name</code> 设置为 <code>true</code>。</p> 
</blockquote> 
<p>例如，典型的 POM 依赖关系如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>要自动配置嵌入式数据库，你需要依赖 <code>spring-jdbc</code>。在本例中，它是通过 <code>spring-boot-starter-data-jpa</code> 临时引入的。</p> 
</blockquote> 
<blockquote> 
 <p>无论出于何种原因，如果您确实为嵌入式数据库配置了连接 URL，请注意确保数据库的自动关机功能被禁用。如果使用 H2，则应使用 <code>DB_CLOSE_ON_EXIT=FALSE</code> 来关闭数据库。如果使用 HSQLDB，则应确保不使用 <code>shutdown=true</code>。禁用数据库自动关闭功能可让 Spring Boot 控制关闭数据库的时间，从而确保在不再需要访问数据库时关闭数据库。</p> 
</blockquote> 
<h5><a id="_34"></a>连接到生产数据库</h5> 
<p>生产数据库连接也可通过使用池<code>DataSource</code>进行自动配置。</p> 
<h5><a id="_36"></a>数据源配置</h5> 
<p>数据源配置由 <code>spring.datasource.*</code> 中的外部配置属性控制。例如，您可以在 <code>application.properties</code> 中声明以下部分：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"jdbc:mysql://localhost/test"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"dbuser"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"dbpass"</span>
</code></pre> 
<blockquote> 
 <p>至少应通过设置 <code>spring.datasource.url</code> 属性来指定 URL。否则，Spring Boot 会尝试自动配置嵌入式数据库。</p> 
</blockquote> 
<blockquote> 
 <p>Spring Boot 可以从 URL 推断出大多数数据库的 JDBC 驱动程序类。如果需要指定特定的类，可以使用 <code>spring.datasource.driver-class-name</code> 属性。</p> 
</blockquote> 
<blockquote> 
 <p>要创建池化数据源，我们需要验证是否存在有效的驱动程序类，因此我们在做任何事情之前都要检查这一点。换句话说，如果你设置了 <code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>，那么该类就必须是可加载的。</p> 
</blockquote> 
<p>有关支持选项的更多信息，请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.0/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java">DataSourceProperties</a>。这些都是标准选项，无论实际<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#data.sql.datasource.connection-pool" rel="nofollow">实现如何</a>，它们都能发挥作用。还可以通过使用各自的前缀（<code>spring.datasource.hikari.*</code>、<code>spring.datasource.tomcat.*</code>、<code>spring.datasource.dbcp2.*</code> 和 <code>spring.datasource.oracleucp.*</code>）来微调特定实现的设置。有关详细信息，请参阅您使用的连接池实现的文档。<br> 例如，如果您使用 <a href="https://tomcat.apache.org/tomcat-10.1-doc/jdbc-pool.html#Common_Attributes" rel="nofollow">Tomcat 连接池</a>，您可以自定义许多其他设置，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">tomcat</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">10000</span>
      <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">50</span>
      <span class="token key atrule">test-on-borrow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>这将使连接池在没有可用连接时等待 10000 毫秒才抛出异常，将最大连接数限制为 50，并在从连接池借用连接前验证连接。</p> 
<h5><a id="_62"></a>支持的连接池</h5> 
<p>Spring Boot 使用以下算法来选择特定的实现：</p> 
<ul><li>由于 <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> 的性能和并发性，我们更喜欢它。如果 HikariCP 可用，我们总是选择它。</li><li>否则，如果 Tomcat 池<code>DataSource</code>可用，我们就使用它。</li><li>否则，如果 <a href="https://commons.apache.org/proper/commons-dbcp/" rel="nofollow">Commons DBCP2</a> 可用，我们就使用它。</li><li>如果 HikariCP、Tomcat 和 DBCP2 都不可用，而 Oracle UCP 可用，我们就使用它。</li></ul> 
<blockquote> 
 <p>如果使用 <code>spring-boot-starter-jdbc</code> 或 <code>spring-boot-starter-data-jpa</code> “Starter”，就会自动获得 <code>HikariCP</code> 的依赖关系。</p> 
</blockquote> 
<p>您可以完全绕过这种算法，通过设置 <code>spring.datasource.type</code> 属性来指定要使用的连接池。如果在 Tomcat 容器中运行应用程序，这一点尤为重要，因为默认情况下提供的是 <code>tomcat-jdbc</code>。<br> 可以使用 <code>DataSourceBuilder</code> 手动配置其他连接池。如果您定义了自己的 <code>DataSource</code> Bean，则不会发生自动配置。<code>DataSourceBuilder</code> 支持以下连接池：</p> 
<ul><li>HikariCP</li><li>Tomcat pooling <code>Datasource</code></li><li>Commons DBCP2</li><li>Oracle UCP &amp; <code>OracleDataSource</code></li><li>Spring Framework’s <code>SimpleDriverDataSource</code></li><li>H2 JdbcDataSource</li><li>PostgreSQL <code>PGSimpleDataSource</code></li><li>C3P0</li></ul> 
<h5><a id="_JNDI__82"></a>连接到 JNDI 数据源</h5> 
<p>如果将 Spring Boot 应用程序部署到应用服务器，您可能希望使用应用服务器的内置功能配置和管理数据源，并使用 JNDI 对其进行访问。<br> <code>spring.datasource.jndi-name</code> 属性可替代 <code>spring.datasource.url</code>、<code>spring.datasource.username</code> 和 <code>spring.datasource.password</code> 属性，用于从特定 JNDI 位置访问数据源。例如，<code>application.properties</code> 中的以下部分展示了如何访问 JBoss AS 定义的数据源：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">jndi-name</span><span class="token punctuation">:</span> <span class="token string">"java:jboss/datasources/customers"</span>
</code></pre> 
<h4><a id="_JdbcTemplate_90"></a>使用 JdbcTemplate</h4> 
<p>Spring 的 <code>JdbcTemplate</code> 和 <code>NamedParameterJdbcTemplate</code> 类是自动配置的，你可以将它们直接 <code>@Autowire</code> 到自己的 Bean 中，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JdbcTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>您可以使用 <code>spring.jdbc.template.*</code> 属性自定义模板的某些属性，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
    <span class="token key atrule">template</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-rows</span><span class="token punctuation">:</span> <span class="token number">500</span>
</code></pre> 
<blockquote> 
 <p><code>NamedParameterJdbcTemplate</code> 在幕后重复使用同一个 <code>JdbcTemplate</code> 实例。如果定义了一个以上的 <code>JdbcTemplate</code>，且不存在主要候选 <code>JdbcTemplate</code>，则不会自动配置 <code>NamedParameterJdbcTemplate</code>。</p> 
</blockquote> 
<h4><a id="_JdbcClient_120"></a>使用 JdbcClient</h4> 
<p>Spring 的 JdbcClient 会根据 <code>NamedParameterJdbcTemplate</code> 的存在进行自动配置。您也可以将其直接注入自己的 Bean 中，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">JdbcClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcClient</span> jdbcClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JdbcClient</span> jdbcClient<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcClient <span class="token operator">=</span> jdbcClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcClient <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>如果依赖自动配置来创建底层 <code>JdbcTemplate</code>，客户端也会考虑到使用 <code>spring.jdbc.template.*</code> 属性进行的任何自定义。</p> 
<h4><a id="JPA__Spring_Data_JPA_142"></a>JPA 和 Spring Data JPA</h4> 
<p>Java Persistence API 是一种标准技术，可让您将对象 “映射” 到关系数据库。<code>spring-boot-starter-data-jpa</code> POM 提供了一种快速入门的方法。它提供了以下关键依赖项：</p> 
<ul><li>Hibernate： 最流行的 JPA 实现之一。</li><li>Spring Data JPA：帮助你实现基于 JPA 的存储库。</li><li>Spring ORM： Spring Framework 的核心 ORM 支持。</li></ul> 
<blockquote> 
 <p>我们在此不对 JPA 或 <a href="https://spring.io/projects/spring-data" rel="nofollow">Spring Data</a> 做太多详细介绍。您可以参考 <a href="https://spring.io/" rel="nofollow">spring.io</a> 提供的 <a href="https://spring.io/guides/gs/accessing-data-jpa/" rel="nofollow">“使用 JPA 访问数据”</a> 指南，并阅读 <a href="https://spring.io/projects/spring-data-jpa" rel="nofollow">Spring Data JPA</a> 和 <a href="https://hibernate.org/orm/documentation/" rel="nofollow">Hibernate</a> 参考文档。</p> 
</blockquote> 
<h5><a id="_150"></a>实体类</h5> 
<p>传统上，JPA “Entity” 类是在 <code>persistence.xml</code> 文件中指定的。在 Spring Boot 中，这个文件不是必需的，而是使用 “实体扫描”。默认情况下，会扫描自动配置包。<br> 任何注释为 <code>@Entity</code>、<code>@Embeddable</code> 或 <code>@MappedSuperclass</code> 的类都会被考虑。典型的实体类类似于下面的示例：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Column</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Entity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GeneratedValue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>

    <span class="token comment">// ... additional members, often include @OneToMany mappings</span>

    <span class="token keyword">protected</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// no-args constructor required by JPA spec</span>
        <span class="token comment">// this one is protected since it should not be used directly</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ... etc</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>您可以使用 <code>@EntityScan</code> 注解自定义实体扫描位置。请参阅 “<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-access.separate-entity-definitions-from-spring-configuration" rel="nofollow">howto.html</a>” 操作指南。</p> 
</blockquote> 
<h5><a id="Spring_Data_JPA_Repositories_200"></a>Spring Data JPA Repositories</h5> 
<p><a href="https://spring.io/projects/spring-data-jpa" rel="nofollow">Spring Data JPA</a> Repositories是您可以定义用于访问数据的接口。JPA 查询会根据方法名称自动创建。例如，<code>CityRepository</code> 接口可以声明 <code>findAllByState(String state)</code> 方法来查找给定状态下的所有城市。<br> 对于更复杂的查询，您可以使用 Spring Data 的 <a href="https://docs.spring.io/spring-data/jpa/docs/3.2.0/api/org/springframework/data/jpa/repository/Query.html" rel="nofollow">Query</a> 注解来注解您的方法。<br> Spring Data 资源库通常从 <a href="https://docs.spring.io/spring-data/commons/docs/3.2.0/api/org/springframework/data/repository/Repository.html" rel="nofollow">Repository</a> 或 <a href="https://docs.spring.io/spring-data/commons/docs/3.2.0/api/org/springframework/data/repository/CrudRepository.html" rel="nofollow">CrudRepository</a> 接口扩展而来。如果使用<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置</a>，则会在自动配置包中搜索资源库。</p> 
<blockquote> 
 <p>您可以使用 <code>@EnableJpaRepositories</code> 自定义查找软件源的位置。</p> 
</blockquote> 
<p>下面的示例显示了一个典型的 Spring Data Repositories接口定义：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>jpaandspringdata<span class="token punctuation">.</span>entityclasses<span class="token punctuation">.</span></span><span class="token class-name">City</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>Spring Data JPA Repositories支持三种不同的引导模式：默认、延迟和懒惰。要启用延迟或懒启动，请将 <code>spring.data.jpa.repositories.bootstrap-mode</code> 属性分别设置为<code>deferred</code> 或<code>lazy</code>。使用延迟或懒启动时，自动配置的 <code>EntityManagerFactoryBuilder</code> 将使用上下文的 <code>AsyncTaskExecutor</code>（如果有）作为启动执行器。如果存在多个执行器，则将使用名为 <code>applicationTaskExecutor</code> 的执行器。</p> 
<blockquote> 
 <p>在使用延迟或懒启动时，请确保在应用上下文启动阶段之后延迟对 JPA 基础架构的任何访问。您可以使用 <code>SmartInitializingSingleton</code> 来调用任何需要 JPA 基础架构的初始化。对于创建为 Spring Bean 的 JPA 组件（如转换器），如果存在依赖关系，请使用 <code>ObjectProvider</code> 来延迟依赖关系的解析。</p> 
</blockquote> 
<blockquote> 
 <p>我们对 Spring Data JPA 还只是浅尝辄止。有关完整的详细信息，请参阅 <a href="https://docs.spring.io/spring-data/jpa/reference/3.2.0/" rel="nofollow">Spring Data JPA 参考文档</a>。</p> 
</blockquote> 
<h5><a id="Spring_Data_Envers_Repositories_226"></a>Spring Data Envers Repositories</h5> 
<p>如果 <a href="https://spring.io/projects/spring-data-envers" rel="nofollow">Spring Data Envers</a> 可用，JPA 资源库会自动配置为支持典型的 Envers 查询。<br> 要使用 Spring Data Envers，请确保您的版本库是从 <code>RevisionRepository</code> 扩展而来，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>jpaandspringdata<span class="token punctuation">.</span>entityclasses<span class="token punctuation">.</span></span><span class="token class-name">Country</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">RevisionRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CountryRepository</span> <span class="token keyword">extends</span> <span class="token class-name">RevisionRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>有关详细信息，请查阅 <a href="https://docs.spring.io/spring-data/jpa/reference/3.2.0//#envers" rel="nofollow">Spring Data Envers 参考文档</a>。</p> 
</blockquote> 
<h5><a id="_JPA__244"></a>创建和删除 JPA 数据库</h5> 
<p>默认情况下，只有使用嵌入式数据库（H2、HSQL 或 Derby）时，才会自动创建 JPA 数据库。您可以使用 <code>spring.jpa.*</code> 属性显式配置 JPA 设置。例如，要创建和删除表，可以在 <code>application.properties</code> 中添加以下一行：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">hibernate.ddl-auto</span><span class="token punctuation">:</span> <span class="token string">"create-drop"</span>
</code></pre> 
<blockquote> 
 <p>Hibernate 自己的内部属性名称是 <code>hibernate.hbm2ddl.auto</code>（如果你还记得的话）。通过使用 <code>spring.jpa.properties.*</code>（在将它们添加到实体管理器之前会去掉前缀），你可以设置它以及其他 Hibernate 本机属性。下面一行是为 Hibernate 设置 JPA 属性的示例：</p> 
</blockquote> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">"globally_quoted_identifiers"</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
</code></pre> 
<p>上例中的一行将 <code>hibernate.globally_quoted_identifiers</code> 属性的 <code>true</code> 值传递给了 Hibernate 实体管理器。<br> 默认情况下，DDL 执行（或验证）会推迟到 <code>ApplicationContext</code> 启动后进行。还有一个 <code>spring.jpa.generate-ddl</code> 标志，但如果 Hibernate 自动配置处于活动状态，则不会使用该标志，因为 <code>ddl-auto</code> 设置更加精细。</p> 
<h5><a id="_EntityManager_262"></a>在视图中打开 EntityManager</h5> 
<p>如果运行的是 Web 应用程序，Spring Boot 默认会注册 <a href="https://docs.spring.io/spring-framework/docs/6.1.1/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html" rel="nofollow">OpenEntityManagerInViewInterceptor</a> 以应用 "Open EntityManager in View "模式，从而在 Web 视图中实现懒加载。如果不希望出现这种行为，则应在 <code>application.properties</code> 中将 <code>spring.jpa.open-in-view</code> 设置为 <code>false</code>。</p> 
<h4><a id="Spring_Data_JDBC_264"></a>Spring Data JDBC</h4> 
<p>Spring Data 包含对 JDBC 的存储库支持，并将为 <code>CrudRepository</code> 上的方法自动生成 SQL。对于更高级的查询，还提供了 <code>@Query</code> 注解。<br> 如果类路径上有必要的依赖项，Spring Boot 将自动配置 Spring Data 的 JDBC 资源库。只需依赖 <code>spring-boot-starter-data-jdbc</code> 即可将它们添加到项目中。如有必要，您可以在应用程序中添加 <code>@EnableJdbcRepositories</code> 注解或 <code>AbstractJdbConfiguration</code> 子类，从而控制 Spring Data JDBC 的配置。</p> 
<blockquote> 
 <p>有关 Spring Data JDBC 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/jdbc/docs/3.2.0/reference/html/" rel="nofollow">参考文档</a>。</p> 
</blockquote> 
<h4><a id="_H2__Web__269"></a>使用 H2 的 Web 控制台</h4> 
<p><a href="https://www.h2database.com/" rel="nofollow">H2 数据库</a>提供了一个<a href="https://www.h2database.com/html/quickstart.html#h2_console" rel="nofollow">基于浏览器的控制台</a>，Spring Boot 可以为您自动配置该控制台。满足以下条件时，控制台将自动配置：</p> 
<ul><li>您正在开发基于 servlet 的网络应用程序。</li><li><code>com.h2database:h2</code> 位于类路径上。</li><li>您正在使用 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools" rel="nofollow">Spring Boot 的开发者工具</a>。</li></ul> 
<blockquote> 
 <p>如果不使用 Spring Boot 的开发者工具，但仍想使用 H2 的控制台，可以将 <code>spring.h2.console.enabled</code> 属性配置为 <code>true</code>。</p> 
</blockquote> 
<blockquote> 
 <p>H2 控制台仅在开发过程中使用，因此在生产过程中应注意不要将 <code>spring.h2.console.enabled</code> 设为 <code>true</code>。</p> 
</blockquote> 
<h5><a id="_H2__279"></a>更改 H2 控制台路径</h5> 
<p>默认情况下，控制台位于 <code>/h2-console</code>。你可以使用 <code>spring.h2.console.path</code> 属性自定义控制台的路径。</p> 
<h5><a id="_H2__281"></a>在安全应用程序中访问 H2 控制台</h5> 
<p>H2 Console 使用框架，由于仅用于开发，因此不实施 CSRF 保护措施。如果您的应用程序使用 Spring Security，则需要将其配置为</p> 
<ul><li>对针对控制台的请求禁用 CSRF 保护、</li><li>将控制台响应的 <code>X-Frame-Options</code> 标头设置为 <code>SAMEORIGIN</code>。</li></ul> 
<p>有关<a href="https://docs.spring.io/spring-security/reference/6.2/features/exploits/csrf.html" rel="nofollow">CSRF</a> 和标头 <a href="https://docs.spring.io/spring-security/reference/6.2/features/exploits/headers.html#headers-frame-options" rel="nofollow">X-Frame-Options</a> 的更多信息，请参阅《Spring Security 参考指南》。<br> 在简单的设置中，可以使用类似下面的 <code>SecurityFilterChain</code>：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">PathRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Profile</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Customizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">"dev"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevProfileSecurityConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
    <span class="token class-name">SecurityFilterChain</span> <span class="token function">h2ConsoleSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">securityMatcher</span><span class="token punctuation">(</span><span class="token class-name">PathRequest</span><span class="token punctuation">.</span><span class="token function">toH2Console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token function">yourCustomAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>csrf<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> headers<span class="token punctuation">.</span><span class="token function">frameOptions</span><span class="token punctuation">(</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> frame<span class="token punctuation">.</span><span class="token function">sameOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>H2 控制台仅用于开发过程。在生产过程中，禁用 CSRF 保护或允许网站使用框架可能会带来严重的安全风险。</p> 
</blockquote> 
<blockquote> 
 <p>如果控制台路径已自定义，<code>PathRequest.toH2Console()</code> 也会返回正确的请求匹配器。</p> 
</blockquote> 
<h4><a id="_jOOQ_321"></a>使用 jOOQ</h4> 
<p>jOOQ Object Oriented Querying (<a href="https://www.jooq.org/" rel="nofollow">jOOQ</a>) 是 <a href="https://www.datageekery.com/" rel="nofollow">Data Geekery</a> 的一款流行产品，它能从数据库生成 Java 代码，让您通过流畅的 API 构建类型安全的 SQL 查询。商业版和开源版均可与 Spring Boot 配合使用。</p> 
<h5><a id="_323"></a>代码生成</h5> 
<p>为了使用 jOOQ 类型安全查询，您需要根据数据库模式生成 Java 类。您可以按照 <a href="https://www.jooq.org/doc/3.18.7/manual-single-page/#jooq-in-7-steps-step3" rel="nofollow">jOOQ 用户手册</a>中的说明进行操作。如果使用了 <code>jooq-codegen-maven</code> 插件，并且还使用了 <code>spring-boot-starter-parent</code> “parent POM”，就可以安全地省略插件的 <code>&lt;version&gt;</code> 标记。您还可以使用 Spring Boot 定义的版本变量（如 <code>h2.version</code>）来声明插件的数据库依赖关系。下面列出了一个示例：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jooq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jooq-codegen-maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${h2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span><span class="token punctuation">&gt;</span></span>org.h2.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>jdbc:h2:~/yourdatabase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generator</span><span class="token punctuation">&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="_DSLContext_350"></a>使用 DSLContext</h5> 
<p>jOOQ 提供的流畅 API 是通过 <code>org.jooq.DSLContext</code> 接口启动的。Spring Boot 会自动将 <code>DSLContext</code> 配置为 Spring Bean，并将其连接到应用程序的 <code>DataSource</code>。要使用 <code>DSLContext</code>，您可以注入它，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">GregorianCalendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span></span><span class="token class-name">DSLContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>docs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span>dslcontext<span class="token punctuation">.</span></span><span class="token class-name">Tables</span><span class="token punctuation">.</span><span class="token static">AUTHOR</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DSLContext</span> create<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">DSLContext</span> dslContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>create <span class="token operator">=</span> dslContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>jOOQ 手册倾向于使用名为 <code>create</code> 的变量来保存 <code>DSLContext</code>。</p> 
</blockquote> 
<p>然后，您就可以使用 <code>DSLContext</code> 构建查询，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GregorianCalendar</span><span class="token punctuation">&gt;</span></span> <span class="token function">authorsBornAfter1980</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>create<span class="token punctuation">.</span><span class="token function">selectFrom</span><span class="token punctuation">(</span><span class="token constant">AUTHOR</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token constant">AUTHOR</span><span class="token punctuation">.</span><span class="token constant">DATE_OF_BIRTH</span><span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token number">1980</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">AUTHOR</span><span class="token punctuation">.</span><span class="token constant">DATE_OF_BIRTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="jOOQ_SQL__382"></a>jOOQ SQL 语言</h5> 
<p>除非配置了 <code>spring.jooq.sql-dialect</code> 属性，否则 Spring Boot 会确定数据源要使用的 SQL 方言。如果 Spring Boot 无法检测到方言，则会使用 <code>DEFAULT</code>。</p> 
<blockquote> 
 <p>Spring Boot 只能自动配置开源版 jOOQ 支持的方言。</p> 
</blockquote> 
<h5><a id="_jOOQ_386"></a>自定义 jOOQ</h5> 
<p>您可以通过定义自己的 <code>DefaultConfigurationCustomizer</code> Bean 来实现更高级的自定义，该 Bean 将在创建 <code>org.jooq.Configuration</code> <code>@Bean</code> 之前被调用。这将优先于自动配置所应用的任何内容。<br> 如果你想完全控制 jOOQ 配置，也可以创建自己的 <code>org.jooq.Configuration</code> <code>@Bean</code>。</p> 
<h4><a id="_R2DBC_389"></a>使用 R2DBC</h4> 
<p>反应式关系数据库连接（<a href="https://r2dbc.io/" rel="nofollow">R2DBC</a>）项目为关系数据库带来了反应式编程 API。R2DBC 的 <code>io.r2dbc.spi.Connection</code> 提供了一种处理非阻塞数据库连接的标准方法。连接通过 <code>ConnectionFactory</code> 提供，类似于 jdbc 的 <code>DataSource</code>。<br> <code>ConnectionFactory</code> 的配置由 <code>spring.r2dbc.*</code> 中的外部配置属性控制。例如，您可以在 <code>application.properties</code> 中声明以下部分：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">r2dbc</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"r2dbc:postgresql://localhost/test"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"dbuser"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"dbpass"</span>
</code></pre> 
<blockquote> 
 <p>您无需指定驱动程序类名，因为 Spring Boot 会从 R2DBC 的 Connection Factory 发现中获取驱动程序。</p> 
</blockquote> 
<blockquote> 
 <p>至少应提供 URL。URL 中指定的信息优先于单个属性，即<code>name</code>、<code>username</code>、<code>password</code>和池选项。</p> 
</blockquote> 
<blockquote> 
 <p>"操作方法"部分包括<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-initialization.using-basic-sql-scripts" rel="nofollow">如何初始化数据库</a>。</p> 
</blockquote> 
<p>要自定义 <code>ConnectionFactory</code> 创建的连接，即设置不想（或不能）在中央数据库配置中配置的特定参数，可以使用 <code>ConnectionFactoryOptionsBuilderCustomizer</code> <code>@Bean</code>。下面的示例展示了如何手动覆盖数据库端口，而从应用程序配置中获取其余选项：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>r2dbc<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactoryOptions</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>r2dbc<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactoryOptionsBuilderCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyR2dbcConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConnectionFactoryOptionsBuilderCustomizer</span> <span class="token function">connectionFactoryPortCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>builder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> builder<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactoryOptions</span><span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token number">5432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>下面的示例展示了如何设置一些 PostgreSQL 连接选项：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>r2dbc<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span></span><span class="token class-name">PostgresqlConnectionFactoryProvider</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>r2dbc<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactoryOptionsBuilderCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPostgresR2dbcConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConnectionFactoryOptionsBuilderCustomizer</span> <span class="token function">postgresCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"lock_timeout"</span><span class="token punctuation">,</span> <span class="token string">"30s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"statement_timeout"</span><span class="token punctuation">,</span> <span class="token string">"60s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>builder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> builder<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">PostgresqlConnectionFactoryProvider</span><span class="token punctuation">.</span><span class="token constant">OPTIONS</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>当 <code>ConnectionFactory</code> Bean 可用时，常规的 JDBC 数据源自动配置就会退出。如果您想保留 JDBC 数据源自动配置，并愿意承担在反应式应用程序中使用阻塞 JDBC API 的风险，请在应用程序中的 <code>@Configuration</code> 类上添加 <code>@Import(DataSourceAutoConfiguration.class)</code> 以重新启用它。</p> 
<h5><a id="_448"></a>嵌入式数据库支持</h5> 
<p>与 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#data.sql.datasource.embedded" rel="nofollow">JDBC 支持</a>类似，Spring Boot 也能自动配置嵌入式数据库，以便进行反应式使用。您无需提供任何连接 URL。您只需将构建依赖关系包含到您要使用的嵌入式数据库中即可，如下例所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.r2dbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>r2dbc-h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p>如果在测试中使用此功能，您可能会发现，无论使用多少应用程序上下文，整个测试套件都会重复使用同一个数据库。如果要确保每个上下文都有独立的嵌入式数据库，则应将 <code>spring.r2dbc.generate-unique-name</code> 设置为 true。</p> 
</blockquote> 
<h5><a id="_DatabaseClient_459"></a>使用 DatabaseClient</h5> 
<p><code>DatabaseClient</code> Bean 是自动配置的，您可以将其直接 <code>@Autowire</code> 到自己的 Bean 中，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>r2dbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DatabaseClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DatabaseClient</span> databaseClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">DatabaseClient</span> databaseClient<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>databaseClient <span class="token operator">=</span> databaseClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>databaseClient<span class="token punctuation">.</span><span class="token function">sql</span><span class="token punctuation">(</span><span class="token string">"select * from user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Spring_Data_R2DBC_Repositories_484"></a>Spring Data R2DBC Repositories</h5> 
<p><a href="https://spring.io/projects/spring-data-r2dbc" rel="nofollow">Spring Data R2DBC</a> Repositories是您可以定义用于访问数据的接口。查询会根据方法名称自动创建。例如，<code>CityRepository</code> 接口可以声明 <code>findAllByState(String state)</code> 方法，用于查找给定状态下的所有城市。<br> 对于更复杂的查询，您可以使用 Spring Data 的 <a href="https://docs.spring.io/spring-data/r2dbc/docs/3.2.0/api/org/springframework/data/r2dbc/repository/Query.html" rel="nofollow">Query</a> 注解来注解您的方法。<br> Spring Data 资源库通常从 <a href="https://docs.spring.io/spring-data/commons/docs/3.2.0/api/org/springframework/data/repository/Repository.html" rel="nofollow">Repository</a> 或 <a href="https://docs.spring.io/spring-data/commons/docs/3.2.0/api/org/springframework/data/repository/CrudRepository.html" rel="nofollow">CrudRepository</a> 接口扩展而来。如果使用自动配置，则会在<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>中搜索存储库。<br> 下面的示例显示了一个典型的 Spring Data 资源库接口定义：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>我们只是对 Spring Data R2DBC 蜻蜓点水。有关完整的详细信息，请参阅 <a href="https://docs.spring.io/spring-data/r2dbc/docs/3.2.0/reference/html/" rel="nofollow">Spring Data R2DBC 参考文档</a>。</p> 
</blockquote> 
<h3><a id="_NoSQL__502"></a>使用 NoSQL 技术</h3> 
<p>Spring Data 还提供其他项目，帮助您访问各种 NoSQL 技术，包括：</p> 
<ul><li><a href="https://spring.io/projects/spring-data-cassandra" rel="nofollow">Cassandra</a></li><li><a href="https://spring.io/projects/spring-data-couchbase" rel="nofollow">Couchbase</a></li><li><a href="https://spring.io/projects/spring-data-elasticsearch" rel="nofollow">Elasticsearch</a></li><li><a href="https://spring.io/projects/spring-data-gemfire" rel="nofollow">GemFire</a> or <a href="https://spring.io/projects/spring-data-geode" rel="nofollow">Geode</a></li><li><a href="https://spring.io/projects/spring-data-ldap" rel="nofollow">LDAP</a></li><li><a href="https://spring.io/projects/spring-data-mongodb" rel="nofollow">MongoDB</a></li><li><a href="https://spring.io/projects/spring-data-neo4j" rel="nofollow">Neo4J</a></li><li><a href="https://spring.io/projects/spring-data-redis" rel="nofollow">Redis</a></li></ul> 
<p>其中，Spring Boot 可为 Cassandra、Couchbase、Elasticsearch、LDAP、MongoDB、Neo4J 和 Redis 提供自动配置。此外，<a href="https://github.com/spring-projects/spring-boot-data-geode">Spring Boot for Apache Geode</a> 还为 <a href="https://docs.spring.io/spring-boot-data-geode-build/2.0.x/reference/html5/#geode-repositories" rel="nofollow">Apache Geode 提供了自动配置</a>功能。您可以使用其他项目，但必须自行配置。请参见 <a href="https://spring.io/projects/spring-data" rel="nofollow">spring.io/projects/spring-data</a> 上的相应参考文档。<br> Spring Boot 还为 InfluxDB 客户端提供了自动配置功能，但该功能已被弃用，因为<a href="https://github.com/influxdata/influxdb-client-java">新的 InfluxDB Java 客户端</a>提供了自己的 Spring Boot 集成。</p> 
<h4><a id="Redis_516"></a>Redis</h4> 
<p><a href="https://redis.io/" rel="nofollow">Redis</a> 是一种缓存、消息代理和功能丰富的键值存储。Spring Boot 为 <a href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a> 和 <a href="https://github.com/xetorthio/jedis/">Jedis</a> 客户端库以及 <a href="https://github.com/spring-projects/spring-data-redis">Spring Data Redis</a> 在它们之上提供的抽象提供了基本的自动配置。<br> <code>spring-boot-starter-data-redis</code> "Starter"可以方便地收集依赖关系。默认情况下，它使用 Lettuce。该Starter既能处理传统应用程序，也能处理反应式应用程序。</p> 
<blockquote> 
 <p>我们还提供了 <code>spring-boot-starter-data-redis-reactive</code> “Starter”，以便与其他支持反应式的商店保持一致。</p> 
</blockquote> 
<h5><a id="_Redis_521"></a>连接到 Redis</h5> 
<p>您可以像注入其他 Spring Bean 一样，注入自动配置的 <code>RedisConnectionFactory</code>、<code>StringRedisTemplate</code> 或 vanilla <code>RedisTemplate</code> 实例。下面的列表显示了一个此类 Bean 的示例：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">StringRedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token string">"spring"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>默认情况下，实例会尝试连接到 <code>localhost:6379</code> 的 Redis 服务器。你可以使用 <code>spring.data.redis.*</code> 属性指定自定义连接细节，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"localhost"</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"user"</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<blockquote> 
 <p>您还可以注册任意数量的实现 <code>LettuceClientConfigurationBuilderCustomizer</code> 的 Bean，以进行更高级的定制。客户端资源也可以使用 <code>ClientResourcesBuilderCustomizer</code> 进行自定义。如果使用 Jedis，还可以使用 <code>JedisClientConfigurationBuilderCustomizer</code>。此外，您还可以注册 <code>RedisStandaloneConfiguration</code>、<code>RedisSentinelConfiguration</code> 或 <code>RedisClusterConfiguration</code> 类型的 Bean，以完全控制配置。</p> 
</blockquote> 
<p>如果您在任何自动配置类型中添加了自己的 <code>@Bean</code>，它将取代默认值（<code>RedisTemplate</code> 除外，因为排除是基于 bean 名称 <code>redisTemplate</code>，而不是其类型）。<br> 默认情况下，如果类路径上有 <code>commons-pool2</code>，则会自动配置池连接工厂。<br> 自动配置的 <code>RedisConnectionFactory</code> 可通过设置属性配置为使用 SSL 与服务器通信，如本示例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>自定义 SSL 信任材料可在 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.ssl" rel="nofollow">SSL bundle</a>中配置，并应用于 <code>RedisConnectionFactory</code>，如本例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
        <span class="token key atrule">bundle</span><span class="token punctuation">:</span> <span class="token string">"example"</span>
</code></pre> 
<h4><a id="MongoDB_573"></a>MongoDB</h4> 
<p><a href="https://www.mongodb.com/" rel="nofollow">MongoDB</a> 是一种开源 NoSQL 文档数据库，它使用类似 JSON 的模式来代替传统的基于表格的关系数据。Spring Boot 为使用 MongoDB 提供了多种便利，包括 <code>spring-boot-starter-data-mongodb</code> 和 <code>spring-boot-starter-data-mongodb-reactive</code> “Starters”。</p> 
<h5><a id="_MongoDB__575"></a>连接到 MongoDB 数据库</h5> 
<p>要访问 MongoDB 数据库，可以注入一个自动配置的 <code>org.springframework.data.mongodb.MongoDatabaseFactory</code>。默认情况下，实例会尝试连接到位于 <code>mongodb://localhost/test</code> 的 MongoDB 服务器。下面的示例展示了如何连接 MongoDB 数据库：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">MongoCollection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">MongoDatabase</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bson<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span></span><span class="token class-name">MongoDatabaseFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoDatabaseFactory</span> mongo<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoDatabaseFactory</span> mongo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mongo <span class="token operator">=</span> mongo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MongoCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span><span class="token punctuation">&gt;</span></span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MongoDatabase</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongo<span class="token punctuation">.</span><span class="token function">getMongoDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>如果您定义了自己的 <code>MongoClient</code>，它将用于自动配置合适的 <code>MongoDatabaseFactory</code>。<br> 自动配置的 <code>MongoClient</code> 是使用 <code>MongoClientSettings</code> Bean 创建的。如果已定义了自己的 <code>MongoClientSettings</code>，则无需修改即可使用，<code>spring.data.mongodb</code> 属性将被忽略。否则，<code>MongoClientSettings</code> 将自动配置并应用 <code>spring.data.mongodb</code> 属性。无论哪种情况，你都可以声明一个或多个 <code>MongoClientSettingsBuilderCustomizer</code> Bean 来微调 <code>MongoClientSettings</code> 配置。每个 Bean 都将与用于构建 <code>MongoClientSettings</code> 的 <code>MongoClientSettings</code>.Builder 一起被依次调用。<br> 您可以设置 <code>spring.data.mongodb.uri</code> 属性来更改 URL 和配置其他设置，如复制集，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"</span>
</code></pre> 
<p>或者，也可以使用离散属性指定连接细节。例如，您可以在 <code>application.properties</code> 中声明以下设置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"mongoserver1.example.com"</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">additional-hosts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"mongoserver2.example.com:23456"</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token string">"test"</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"user"</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<p>自动配置的 <code>MongoClient</code> 可通过设置属性配置为使用 SSL 与服务器通信，如本例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"</span>
      <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>可在 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.ssl" rel="nofollow">SSL bundle</a> 中配置自定义 SSL 信任材料，并应用于 <code>MongoClient</code>，如本例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"</span>
      <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
        <span class="token key atrule">bundle</span><span class="token punctuation">:</span> <span class="token string">"example"</span>
</code></pre> 
<blockquote> 
 <p>如果未指定 <code>spring.data.mongodb.port</code>，则使用默认的 <code>27017</code>。你可以删除前面示例中的这一行。<br> 也可以使用 <code>host:port</code> 语法将端口指定为主机地址的一部分。如果需要更改附加<code>additional-hosts</code>的端口，应使用这种格式。</p> 
</blockquote> 
<blockquote> 
 <p>如果不使用 Spring Data MongoDB，可以注入 <code>MongoClient</code> Bean，而不是使用 <code>MongoDatabaseFactory</code>。如果想完全控制 MongoDB 连接的建立，也可以声明自己的 <code>MongoDatabaseFactory</code> 或 <code>MongoClient</code> Bean。</p> 
</blockquote> 
<blockquote> 
 <p>如果使用反应式驱动程序，则 SSL 需要 Netty。如果 Netty 可用，且尚未自定义要使用的工厂，则自动配置会自动配置该工厂。</p> 
</blockquote> 
<h5><a id="MongoTemplate_648"></a>MongoTemplate</h5> 
<p><a href="https://spring.io/projects/spring-data-mongodb" rel="nofollow">Spring Data MongoDB</a> 提供了一个 <a href="https://docs.spring.io/spring-data/mongodb/docs/4.2.0/api/org/springframework/data/mongodb/core/MongoTemplate.html" rel="nofollow">MongoTemplate</a> 类，其设计与 Spring 的 <code>JdbcTemplate</code> 非常相似。与 <code>JdbcTemplate</code> 一样，Spring Boot 会自动为您配置一个 Bean 以注入模板，如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">MongoCollection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bson<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">MongoTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate <span class="token operator">=</span> mongoTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MongoCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span><span class="token punctuation">&gt;</span></span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>详情请查看 <a href="https://docs.spring.io/spring-data/mongodb/docs/4.2.0/api/org/springframework/data/mongodb/core/MongoOperations.html" rel="nofollow">MongoOperations Javadoc</a>。</p> 
<h5><a id="Spring_Data_MongoDB_Repositories_673"></a>Spring Data MongoDB Repositories</h5> 
<p>Spring Data 包含对 MongoDB Repositories的支持。与前面讨论的 JPA Repositories一样，基本原则是根据方法名称自动构建查询。<br> 事实上，Spring Data JPA 和 Spring Data MongoDB 共享相同的基础架构。您可以使用前面的 JPA 示例，假设 <code>City</code> 现在是一个 MongoDB 数据类，而不是 JPA <code>@Entity</code>，它的工作方式是一样的，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>存储库（Repositories）和文档（Document）是通过扫描找到的。默认情况下，会扫描<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>。您可以分别使用 <code>@EnableMongoRepositories</code> 和 <code>@EntityScan</code> 来自定义查找存储库和文档的位置。</p> 
<blockquote> 
 <p>有关 Spring Data MongoDB 的完整详细信息，包括其丰富的对象映射技术，请参阅其<a href="https://spring.io/projects/spring-data-mongodb" rel="nofollow">参考文档</a>。</p> 
</blockquote> 
<h4><a id="Neo4j_692"></a>Neo4j</h4> 
<p><a href="https://neo4j.com/" rel="nofollow">Neo4j</a> 是一个开源 NoSQL 图数据库，它使用由一级关系连接的节点组成的丰富数据模型，与传统的 RDBMS 方法相比，它更适合连接的大数据。Spring Boot 为使用 Neo4j 提供了多种便利，包括 <code>spring-boot-starter-data-neo4j</code> “Starter”。</p> 
<h5><a id="_Neo4j__694"></a>连接到 Neo4j 数据库</h5> 
<p>要访问 Neo4j 服务器，可以注入一个自动配置的 <code>org.neo4j.driver.Driver</code>。默认情况下，实例会尝试使用 Bolt 协议连接到 <code>localhost:7687</code> 上的 Neo4j 服务器。下面的示例展示了如何注入一个Neo4j驱动程序，从而访问会话：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>driver<span class="token punctuation">.</span></span><span class="token class-name">Driver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>driver<span class="token punctuation">.</span></span><span class="token class-name">Session</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>driver<span class="token punctuation">.</span></span><span class="token class-name">Values</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Driver</span> driver<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">Driver</span> driver<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>driver <span class="token operator">=</span> driver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>driver<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> session<span class="token punctuation">.</span><span class="token function">executeWrite</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span>transaction<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> transaction
                        <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">"CREATE (a:Greeting) SET a.message = $message RETURN a.message + ', from node ' + id(a)"</span><span class="token punctuation">,</span>
                                <span class="token class-name">Values</span><span class="token punctuation">.</span><span class="token function">parameters</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>你可以使用 <code>spring.neo4j.*</code> 属性配置驱动程序的各个方面。下面的示例展示了如何配置要使用的 uri 和凭据：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">neo4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"bolt://my-server:7687"</span>
    <span class="token key atrule">authentication</span><span class="token punctuation">:</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"neo4j"</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<p>自动配置的驱动程序是使用 <code>ConfigBuilder</code> 创建的。要对其配置进行微调，可声明一个或多个 <code>ConfigBuilderCustomizer</code> Bean。每个 Bean 将与用于创建驱动程序的 <code>ConfigBuilder</code> 一起依次被调用。</p> 
<h5><a id="Spring_Data_Neo4j_Repositories_736"></a>Spring Data Neo4j Repositories</h5> 
<p>Spring Data 包含对 Neo4j 的存储库支持。有关 Spring Data Neo4j 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/neo4j/docs/7.2.0/reference/html/" rel="nofollow">参考文档</a>。<br> 与许多其他 Spring Data 模块一样，Spring Data Neo4j 与 Spring Data JPA 共享通用基础架构。你可以参照前面的 JPA 示例，将 <code>City</code> 定义为 Spring Data Neo4j <code>@Node</code> 而不是 JPA <code>@Entity</code>，这样存储库抽象就能以同样的方式运行，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Neo4jRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Neo4jRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOneByNameAndState</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><code>spring-boot-starter-data-neo4j</code> “Starter” 支持存储库和事务管理。Spring Boot 使用 <code>Neo4jTemplate</code> 或 <code>ReactiveNeo4jTemplate</code> Bean 支持经典和反应式 Neo4j Repositories。当Project Reactor在类路径上可用时，反应式风格也会自动配置。<br> 通过扫描可找到Repositories和实体。默认情况下，会扫描<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>。您可以分别使用 <code>@EnableNeo4jRepositories</code> 和 <code>@EntityScan</code> 来自定义查找资源库和实体的位置。</p> 
<blockquote> 
 <p>在使用反应式风格的应用程序中，不会自动配置 <code>ReactiveTransactionManager</code>。要启用事务管理，必须在配置中定义以下 Bean：</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>driver<span class="token punctuation">.</span></span><span class="token class-name">Driver</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ReactiveDatabaseSelectionProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">ReactiveNeo4jTransactionManager</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNeo4jConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ReactiveNeo4jTransactionManager</span> <span class="token function">reactiveTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">Driver</span> driver<span class="token punctuation">,</span>
            <span class="token class-name">ReactiveDatabaseSelectionProvider</span> databaseNameProvider<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReactiveNeo4jTransactionManager</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> databaseNameProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Elasticsearch_773"></a>Elasticsearch</h4> 
<p><a href="https://www.elastic.co/products/elasticsearch" rel="nofollow">Elasticsearch</a> 是一个开源、分布式、RESTful 搜索和分析引擎。Spring Boot 为 Elasticsearch 客户端提供基本的自动配置。<br> Spring Boot 支持多种客户端：</p> 
<ul><li>官方低级 REST 客户端</li><li>官方 Java API 客户端</li><li>Spring Data Elasticsearch 提供的 <code>ReactiveElasticsearchClient</code></li></ul> 
<p>Spring Boot 提供了一个专用的 “Starter”，即 <code>spring-boot-starter-data-elasticsearch</code>。</p> 
<h5><a id="_REST__Elasticsearch_782"></a>使用 REST 客户端连接 Elasticsearch</h5> 
<p>Elasticsearch 提供两种不同的 REST 客户端，可用于查询群集：<code>org.elasticsearch.client:elasticsearch-rest-client</code> 模块中的<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/java-rest-low.html" rel="nofollow">底层客户端</a>和 <code>co.elastic.clients:elasticsearch-java</code> 模块中的 <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/index.html" rel="nofollow">Java API 客户端</a>。此外，Spring Boot 还支持来自 <code>org.springframework.data:spring-data-elasticsearch</code> 模块的反应式客户端。默认情况下，客户端的目标地址是 <code>localhost:9200</code>。您可以使用 <code>spring.elasticsearch.*</code> 属性进一步调整客户端的配置方式，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">uris</span><span class="token punctuation">:</span> <span class="token string">"https://search.example.com:9200"</span>
    <span class="token key atrule">socket-timeout</span><span class="token punctuation">:</span> <span class="token string">"10s"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"user"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<h6><a id="_RestClient__Elasticsearch_792"></a>使用 RestClient 连接 Elasticsearch</h6> 
<p>如果类路径上有<code>elasticsearch-rest-client</code>，Spring Boot就会自动配置并注册一个<code>RestClient</code> Bean。除了前面描述的属性外，要对 <code>RestClient</code> 进行微调，还可以注册任意数量的实现 <code>RestClientBuilderCustomizer</code> 的 Bean，以进行更高级的自定义。要完全控制客户端的配置，请定义一个 <code>RestClientBuilder</code> Bean。<br> 此外，如果类路径上有 <code>elasticsearch-rest-client-sniffer</code>，就会自动配置 <code>Sniffer</code>，以便自动从运行中的 Elasticsearch 集群中发现节点，并将它们设置到 <code>RestClient</code> Bean 上。您可以进一步调整 <code>Sniffer</code> 的配置方式，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">restclient</span><span class="token punctuation">:</span>
      <span class="token key atrule">sniffer</span><span class="token punctuation">:</span>
        <span class="token key atrule">interval</span><span class="token punctuation">:</span> <span class="token string">"10m"</span>
        <span class="token key atrule">delay-after-failure</span><span class="token punctuation">:</span> <span class="token string">"30s"</span>
</code></pre> 
<h6><a id="_ElasticsearchClient__Elasticsearch_803"></a>使用 ElasticsearchClient 连接到 Elasticsearch</h6> 
<p>如果您的类路径上有 <code>co.elastic.clients:elasticsearch-java</code>，Spring Boot 将自动配置并注册一个 <code>ElasticsearchClient</code> Bean。<br> <code>ElasticsearchClient</code> 使用的传输依赖于之前描述的 <code>RestClient</code>。因此，前面描述的属性可用于配置 <code>ElasticsearchClient</code>。此外，您还可以定义一个 <code>RestClientOptions</code> Bean 来进一步控制传输的行为。</p> 
<h6><a id="_ReactiveElasticsearchClient__Elasticsearch_806"></a>使用 ReactiveElasticsearchClient 连接到 Elasticsearch</h6> 
<p><a href="https://spring.io/projects/spring-data-elasticsearch" rel="nofollow">Spring Data Elasticsearch</a> 提供 <code>ReactiveElasticsearchClient</code>，用于以反应方式查询 Elasticsearch 实例。如果类路径上有Spring Data Elasticsearch和Reactor，Spring Boot就会自动配置和注册<code>ReactiveElasticsearchClient</code>。<br> <code>ReactiveElasticsearchclient</code> 使用的传输依赖于之前描述的 <code>RestClient</code>。因此，前面描述的属性可用于配置 <code>ReactiveElasticsearchClient</code>。此外，您还可以定义 <code>RestClientOptions</code> Bean 来进一步控制传输的行为。</p> 
<h5><a id="_Spring_Data__Elasticsearch_809"></a>使用 Spring Data 连接 Elasticsearch</h5> 
<p>要连接到 Elasticsearch，必须定义一个 <code>ElasticsearchClient</code> Bean，由 Spring Boot 自动配置或由应用程序手动提供（参见前面的章节）。有了这些配置，就可以像注入其他 Spring Bean 一样注入 <code>ElasticsearchTemplate</code>，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span>elc<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ElasticsearchTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ElasticsearchTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>有了 <code>spring-data-elasticsearch</code> 和 Reactor，Spring Boot 还可以自动配置 <code>ReactiveElasticsearchClient</code> 和 <code>ReactiveElasticsearchTemplate</code> 作为 Bean。它们相当于其他 REST 客户端的反应式客户端。</p> 
<h5><a id="Spring_Data_Elasticsearch_Repositories_831"></a>Spring Data Elasticsearch Repositories</h5> 
<p>Spring Data 包含对 Elasticsearch Repositories 的支持。与前面讨论的 JPA 资源库一样，其基本原理是根据方法名称自动为您构建查询。<br> 事实上，Spring Data JPA 和 Spring Data Elasticsearch 共享相同的基础架构。你可以参照前面的 JPA 示例，假设 <code>City</code> 现在是 <code>Elasticsearch</code> 的 <code>@Document</code> 类，而不是 JPA 的 <code>@Entity</code> 类，它的工作方式也是一样的。<br> 存储库和文档是通过扫描找到的。默认情况下，会扫描<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>。您可以分别使用 <code>@EnableElasticsearchRepositories</code> 和 <code>@EntityScan</code> 来自定义查找存储库和文档的位置。</p> 
<blockquote> 
 <p>有关 Spring Data Elasticsearch 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/" rel="nofollow">参考文档</a>。</p> 
</blockquote> 
<p>Spring Boot 使用 <code>ElasticsearchRestTemplate</code> 或 <code>ReactiveElasticsearchTemplate</code> Bean 支持传统和反应式 Elasticsearch Repositories。如果存在所需的依赖关系，Spring Boot 很可能会自动配置这些 Bean。<br> 如果您希望使用自己的模板来备份 Elasticsearch Repositories，您可以添加自己的 <code>ElasticsearchRestTemplate</code> 或 <code>ElasticsearchOperations</code> <code>@Bean</code>，只要将其命名为 “<code>elasticsearchTemplate</code>” 即可。这同样适用于 <code>ReactiveElasticsearchTemplate</code> 和 <code>ReactiveElasticsearchOperations</code>，Bean 名称为 “<code>reactiveElasticsearchTemplate</code>”。<br> 您可以选择使用以下属性禁用软件源支持：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
      <span class="token key atrule">repositories</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<h4><a id="Cassandra_847"></a>Cassandra</h4> 
<p><a href="https://cassandra.apache.org/" rel="nofollow">Cassandra</a> 是一个开源的分布式数据库管理系统，设计用于在许多商品服务器上处理大量数据。Spring Boot 为 Cassandra 以及 Spring Data Cassandra 在其之上提供的抽象提供自动配置。有一个 <code>spring-boot-starter-data-cassandra</code> “Starter”，可以方便地收集依赖关系。</p> 
<h5><a id="_Cassandra_849"></a>连接到 Cassandra</h5> 
<p>您可以注入一个自动配置的 <code>CassandraTemplate</code> 或 Cassandra <code>CqlSession</code> 实例，就像注入其他 Spring Bean 一样。<code>spring.cassandra.*</code> 属性可用于自定义连接。一般来说，您需要提供关键空间名称和联系点以及本地数据中心名称，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cassandra</span><span class="token punctuation">:</span>
    <span class="token key atrule">keyspace-name</span><span class="token punctuation">:</span> <span class="token string">"mykeyspace"</span>
    <span class="token key atrule">contact-points</span><span class="token punctuation">:</span> <span class="token string">"cassandrahost1:9042,cassandrahost2:9042"</span>
    <span class="token key atrule">local-datacenter</span><span class="token punctuation">:</span> <span class="token string">"datacenter1"</span>
</code></pre> 
<p>如果所有联络点的端口都相同，则可以使用快捷方式，只指定主机名，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cassandra</span><span class="token punctuation">:</span>
    <span class="token key atrule">keyspace-name</span><span class="token punctuation">:</span> <span class="token string">"mykeyspace"</span>
    <span class="token key atrule">contact-points</span><span class="token punctuation">:</span> <span class="token string">"cassandrahost1,cassandrahost2"</span>
    <span class="token key atrule">local-datacenter</span><span class="token punctuation">:</span> <span class="token string">"datacenter1"</span>
</code></pre> 
<blockquote> 
 <p>这两个示例完全相同，因为端口默认为 <code>9042</code>。如果需要配置端口，请使用 <code>spring.cassandra.port</code>。</p> 
</blockquote> 
<p>自动配置的 <code>CqlSession</code> 可通过设置属性配置为使用 SSL 与服务器通信，如本例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cassandra</span><span class="token punctuation">:</span>
    <span class="token key atrule">keyspace-name</span><span class="token punctuation">:</span> <span class="token string">"mykeyspace"</span>
    <span class="token key atrule">contact-points</span><span class="token punctuation">:</span> <span class="token string">"cassandrahost1,cassandrahost2"</span>
    <span class="token key atrule">local-datacenter</span><span class="token punctuation">:</span> <span class="token string">"datacenter1"</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>自定义 SSL 信任材料可在 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.ssl" rel="nofollow">SSL bundle</a> 中配置，并应用于 <code>CqlSession</code>，如本例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cassandra</span><span class="token punctuation">:</span>
    <span class="token key atrule">keyspace-name</span><span class="token punctuation">:</span> <span class="token string">"mykeyspace"</span>
    <span class="token key atrule">contact-points</span><span class="token punctuation">:</span> <span class="token string">"cassandrahost1,cassandrahost2"</span>
    <span class="token key atrule">local-datacenter</span><span class="token punctuation">:</span> <span class="token string">"datacenter1"</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
      <span class="token key atrule">bundle</span><span class="token punctuation">:</span> <span class="token string">"example"</span>
</code></pre> 
<blockquote> 
 <p>Cassandra 驱动程序有自己的配置基础架构，可在类路径根目录下加载 <code>application.conf</code>。<br> Spring Boot 默认不查找此类文件，但可以使用 <code>spring.cassandra.config</code> 加载此类文件。如果某个属性同时存在于 <code>spring.cassandra.*</code> 和配置文件中，则 <code>spring.cassandra.*</code> 中的值优先。<br> 对于更高级的驱动程序定制，您可以注册任意数量的实现 <code>DriverConfigLoaderBuilderCustomizer</code> 的 Bean。<code>CqlSession</code> 可通过 <code>CqlSessionBuilderCustomizer</code> 类型的 Bean 进行自定义。</p> 
</blockquote> 
<blockquote> 
 <p>如果使用 <code>CqlSessionBuilder</code> 创建多个 <code>CqlSession</code> Bean，请注意创建器是可变的，因此确保为每个会话注入一个新副本。</p> 
</blockquote> 
<p>下面的代码列表显示了如何注入 <code>Cassandra</code> Bean：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cassandra<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">CassandraTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>如果您添加了自己的 <code>CassandraTemplate</code> 类型的 <code>@Bean</code>，它将取代默认值。</p> 
<h5><a id="Spring_Data_Cassandra_Repositories_915"></a>Spring Data Cassandra Repositories</h5> 
<p>Spring Data 包含对 Cassandra 的基本存储库支持。目前，这种支持比前面讨论的 JPA 资源库更加有限，而且需要 <code>@Query</code> 注释的查找方法。<br> 存储库和实体是通过扫描找到的。默认情况下，会扫描<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>。你可以分别使用 <code>@EnableCassandraRepositories</code> 和 <code>@EntityScan</code> 来自定义查找资源库和实体的位置。</p> 
<blockquote> 
 <p>有关 Spring Data Cassandra 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/cassandra/docs/" rel="nofollow">参考文档</a>。</p> 
</blockquote> 
<h4><a id="Couchbase_920"></a>Couchbase</h4> 
<p><a href="https://www.couchbase.com/" rel="nofollow">Couchbase</a> 是一个开源、分布式、多模型、面向文档的 NoSQL 数据库，针对交互式应用程序进行了优化。Spring Boot 为 Couchbase 提供自动配置，并在其之上提供由 <a href="https://github.com/spring-projects/spring-data-couchbase">Spring Data Couchbase</a> 提供的抽象。有 <code>spring-boot-starter-data-couchbase</code> 和 <code>spring-boot-starter-data-couchbase-reactive</code> 两个 “Starter”，可方便地收集依赖关系。</p> 
<h5><a id="_Couchbase_922"></a>连接到 Couchbase</h5> 
<p>您可以通过添加 Couchbase SDK 和一些配置来获得一个集群。<code>spring.couchbase.*</code> 属性可用于自定义连接。一般来说，你需要提供<a href="https://github.com/couchbaselabs/sdk-rfcs/blob/master/rfc/0011-connection-string.md">连接字符串</a>、用户名和密码，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">couchbase</span><span class="token punctuation">:</span>
    <span class="token key atrule">connection-string</span><span class="token punctuation">:</span> <span class="token string">"couchbase://192.168.1.123"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"user"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<p>还可以自定义某些 <code>ClusterEnvironment</code> 设置。例如，以下配置更改了打开新 Bucket 的超时时间，并通过引用已配置的 SSL 捆绑程序启用了 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.ssl" rel="nofollow">SSL bundle</a>：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">couchbase</span><span class="token punctuation">:</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">timeouts</span><span class="token punctuation">:</span>
        <span class="token key atrule">connect</span><span class="token punctuation">:</span> <span class="token string">"3s"</span>
      <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
        <span class="token key atrule">bundle</span><span class="token punctuation">:</span> <span class="token string">"example"</span>
</code></pre> 
<blockquote> 
 <p>详情请查看 <code>spring.couchbase.env.*</code> 属性。要进行更多控制，可以使用一个或多个 <code>ClusterEnvironmentBuilderCustomizer</code> Bean。</p> 
</blockquote> 
<h5><a id="Spring_Data_Couchbase_Repositories_943"></a>Spring Data Couchbase Repositories</h5> 
<p>Spring Data 包含对 Couchbase 的存储库支持。<br> 存储库和文档是通过扫描找到的。默认情况下，会<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">扫描自动配置包</a>。您可以分别使用 <code>@EnableCouchbaseRepositories</code> 和 <code>@EntityScan</code> 来自定义查找存储库和文档的位置。<br> 有关 Spring Data Couchbase 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/couchbase/docs/5.2.0/reference/html/" rel="nofollow">参考文档</a>。<br> 只要有 <code>CouchbaseClientFactory</code> Bean，您就可以像注入其他 Spring Bean 一样注入自动配置的 <code>CouchbaseTemplate</code> 实例。如上所述，当<code>Cluster</code>可用并指定了一个桶名时，就会发生这种情况：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">couchbase</span><span class="token punctuation">:</span>
      <span class="token key atrule">bucket-name</span><span class="token punctuation">:</span> <span class="token string">"my-bucket"</span>
</code></pre> 
<p>以下示例展示了如何注入 <code>CouchbaseTemplate</code> Bean：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>couchbase<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">CouchbaseTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">getBucketName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>您可以在自己的配置中定义一些 Bean，以覆盖自动配置提供的 Bean：</p> 
<ul><li>一个名为 <code>CouchbaseMappingContext</code> <code>@Bean</code> 的 <code>CouchbaseMappingContext</code>。</li><li>一个名称为 <code>CouchbaseCustomConversions</code> 的自定义转换 <code>@Bean</code> 。</li><li>一个名为 <code>CouchbaseTemplate</code> 的 <code>CouchbaseTemplate</code> <code>@Bean</code> 。</li></ul> 
<p>为了避免在自己的配置中硬编码这些名称，你可以重复使用 Spring Data Couchbase 提供的 BeanNames。例如，你可以自定义要使用的转换器，如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>couchbase<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">BeanNames</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>couchbase<span class="token punctuation">.</span>core<span class="token punctuation">.</span>convert<span class="token punctuation">.</span></span><span class="token class-name">CouchbaseCustomConversions</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCouchbaseConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token class-name">BeanNames</span><span class="token punctuation">.</span><span class="token constant">COUCHBASE_CUSTOM_CONVERSIONS</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CouchbaseCustomConversions</span> <span class="token function">myCustomConversions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CouchbaseCustomConversions</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="LDAP_999"></a>LDAP</h4> 
<p><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" rel="nofollow">LDAP</a>（轻量级目录访问协议）是一种开放的、厂商中立的行业标准应用协议，用于通过 IP 网络访问和维护分布式目录信息服务。Spring Boot 为任何符合标准的 LDAP 服务器提供自动配置，并支持来自 <a href="https://ldap.com/unboundid-ldap-sdk-for-java/" rel="nofollow">UnboundID</a> 的嵌入式内存 LDAP 服务器。<br> LDAP 抽象由 Spring Data LDAP 提供。<code>spring-boot-starter-data-ldap</code> “Starter” 可以方便地收集依赖关系。</p> 
<h5><a id="_LDAP__1002"></a>连接到 LDAP 服务器</h5> 
<p>要连接到 LDAP 服务器，请确保声明对 <code>spring-boot-starter-data-ldap</code> “Starter” 或 <code>spring-ldap-core</code> 的依赖，然后在应用程序属性中声明服务器的 URL，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">urls</span><span class="token punctuation">:</span> <span class="token string">"ldap://myserver:1235"</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"admin"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<p>如果需要自定义连接设置，可以使用 <code>spring.ldap.base</code> 和 <code>spring.ldap.base-environment</code> 属性。<br> <code>LdapContextSource</code> 会根据这些设置自动配置。如果 <code>DirContextAuthenticationStrategy</code> Bean 可用，它将与自动配置的 <code>LdapContextSource</code> 关联。如果需要自定义，例如使用 <code>PooledContextSource</code>，仍可注入自动配置的 <code>LdapContextSource</code>。确保将自定义的 <code>ContextSource</code> 标记为 <code>@Primary</code>，以便自动配置的 <code>LdapTemplate</code> 使用它。</p> 
<h5><a id="Spring_Data_LDAP_Repositories_1013"></a>Spring Data LDAP Repositories</h5> 
<p>Spring Data 包含对 LDAP 的存储库支持。<br> 存储库（Repositories）和文档（Document）可通过扫描找到。默认情况下，会扫描<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration.packages" rel="nofollow">自动配置包</a>。您可以分别使用 @<code>EnableLdapRepositories</code> 和 <code>@EntityScan</code> 来自定义查找资源库和文档的位置。<br> 有关 Spring Data LDAP 的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/" rel="nofollow">参考文档</a>。<br> 您还可以注入一个自动配置的 <code>LdapTemplate</code> 实例，就像注入其他 Spring Bean 一样，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LdapTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LdapTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">LdapTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_LDAP__1039"></a>嵌入式内存 LDAP 服务器</h5> 
<p>出于测试目的，Spring Boot 支持自动配置来自 <a href="https://ldap.com/unboundid-ldap-sdk-for-java/" rel="nofollow">UnboundID</a> 的内存 LDAP 服务器。要配置服务器，请向 <code>com.unboundid:unboundid-ldapsdk</code> 添加依赖关系，并声明 <code>spring.ldap.embedded.base-dn</code> 属性，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">embedded</span><span class="token punctuation">:</span>
      <span class="token key atrule">base-dn</span><span class="token punctuation">:</span> <span class="token string">"dc=spring,dc=io"</span>
</code></pre> 
<blockquote> 
 <p>可以定义多个 base-dn 值，但由于区分名称通常包含逗号，因此必须使用正确的符号来定义。<br> 在 yaml 文件中，可以使用 yaml 列表符号。在属性文件中，必须将索引作为属性名称的一部分：</p> 
</blockquote> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring.ldap.embedded.base-dn</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"dc=spring,dc=io"</span>
  <span class="token punctuation">-</span> <span class="token string">"dc=vmware,dc=com"</span>
</code></pre> 
<p>默认情况下，服务器在随机端口启动，并触发常规 LDAP 支持。无需指定 <code>spring.ldap.urls</code> 属性。<br> 如果类路径中有<code>schema.ldif</code>文件，它将用于初始化服务器。如果想从其他资源加载初始化脚本，也可以使用 <code>spring.ldap.embedded.ldif</code> 属性。<br> 默认情况下，标准模式用于验证 LDIF 文件。你可以通过设置 <code>spring.ldap.embedded.validation.enabled</code> 属性完全关闭验证。如果有自定义属性，可以使用 <code>spring.ldap.embedded.validation.schema</code> 来定义自定义属性类型或对象类。</p> 
<h4><a id="InfluxDB_1058"></a>InfluxDB</h4> 
<blockquote> 
 <p>InfluxDB 的自动配置已被弃用，并计划在 Spring Boot 3.4 中删除，转而使用新的 InfluxDB Java 客户端，该客户端提供自己的 Spring Boot 集成。</p> 
</blockquote> 
<p><a href="https://www.influxdata.com/" rel="nofollow">InfluxDB</a> 是一个开源时间序列数据库，针对运营监控、应用指标、物联网传感器数据和实时分析等领域的时间序列数据的快速、高可用性存储和检索进行了优化。</p> 
<h5><a id="_InfluxDB_1062"></a>连接到 InfluxDB</h5> 
<p>只要类路径上有 <code>influxdb-java</code> 客户端，并使用 <code>spring.influx.url</code> 设置了数据库的 URL，Spring Boot 就会自动配置 <code>InfluxDB</code> 实例。<br> 如果连接 InfluxDB 需要用户和密码，可以相应设置 <code>spring.influx.user</code> 和 <code>spring.influx.password</code> 属性。<br> InfluxDB 依赖于 OkHttp。如果需要调整 <code>InfluxDB</code> 在幕后使用的 http 客户端，可以注册 <code>InfluxDbOkHttpClientBuilderProvider</code> Bean。<br> 如果您需要对配置进行更多控制，请考虑注册 <code>InfluxDbCustomizer</code> Bean。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c78ba76a5cbcb888d44da72c0198ccd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">普中STM32-PZ6806L开发板(HAL库函数实现-无源蜂鸣器响动)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b8cc67db849854c19577b8f5b476b2ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在web前端培训班怎样一步一步的来学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>