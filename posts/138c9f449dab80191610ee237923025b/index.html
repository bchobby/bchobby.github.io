<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SSM框架Demo: 简朴博客系统 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SSM框架Demo: 简朴博客系统" />
<meta property="og:description" content="文章目录 1. 前端页面效果2. 项目创建3. 前期配置3.1. 创建数据库数据表3.2. 配置文件 4. 创建实体类5. 统一处理5.1. 统一返回格式处理5.2. 统一异常处理 6. 全局变量7. Session工具类8. 登录拦截器9. 密码加盐加密10. 线程池组件11. dao层11.1. UserMapper11.2. ArticleMapper 12. 服务层service12.1. UserService12.2. ArticleService 13. 核心—控制层controller13.1. UserController13.1.1. 注册功能13.1.2. 登录功能13.1.3. 注销功能13.1.4. 判断当前用户是否登录 13.2. ArticleController13.2.1. 返回当前登录用户的文章列表13.2.2. 删除文章功能13.2.3. 查看文章详情功能13.2.4. 更新文章阅读量13.2.5. 添加文章13.2.6. 修改文章13.2.6.1. 页面初始化13.2.6.2. 发布修改后的文章 13.2.7. 根据分页来查询汇总列表 14. Session升级存储到Redis15. 项目部署16. 项目亮点 简朴博客系统：简单朴素… 1. 前端页面效果 ♨️注册页
包含以下用户信息：
用户名密码 ♨️登录页
包含以下用户信息：
用户名密码 ♨️文章详情页
登录状态下“登录”按钮变为“注销”按钮。
包含以下用户信息：
博文作者 id代码仓库链接文章总数 包含以下博文信息：
作者 id文章 id标题时间正文阅读量 ♨️个人博客列表页
包含以下博文信息：
标题时间摘要 ♨️文章汇总列表页" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/138c9f449dab80191610ee237923025b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-21T13:52:49+08:00" />
<meta property="article:modified_time" content="2023-11-21T13:52:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SSM框架Demo: 简朴博客系统</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1. 前端页面效果</a></li><li><a href="#2__81" rel="nofollow">2. 项目创建</a></li><li><a href="#3__103" rel="nofollow">3. 前期配置</a></li><li><ul><li><a href="#31__107" rel="nofollow">3.1. 创建数据库数据表</a></li><li><a href="#32__187" rel="nofollow">3.2. 配置文件</a></li></ul> 
  </li><li><a href="#4__218" rel="nofollow">4. 创建实体类</a></li><li><a href="#5__292" rel="nofollow">5. 统一处理</a></li><li><ul><li><a href="#51__296" rel="nofollow">5.1. 统一返回格式处理</a></li><li><a href="#52__407" rel="nofollow">5.2. 统一异常处理</a></li></ul> 
  </li><li><a href="#6__429" rel="nofollow">6. 全局变量</a></li><li><a href="#7_Session_449" rel="nofollow">7. Session工具类</a></li><li><a href="#8__484" rel="nofollow">8. 登录拦截器</a></li><li><a href="#9__560" rel="nofollow">9. 密码加盐加密</a></li><li><a href="#10__646" rel="nofollow">10. 线程池组件</a></li><li><a href="#11_dao_677" rel="nofollow">11. dao层</a></li><li><ul><li><a href="#111_UserMapper_679" rel="nofollow">11.1. UserMapper</a></li><li><a href="#112_ArticleMapper_710" rel="nofollow">11.2. ArticleMapper</a></li></ul> 
  </li><li><a href="#12_service_768" rel="nofollow">12. 服务层service</a></li><li><ul><li><a href="#121_UserService_770" rel="nofollow">12.1. UserService</a></li><li><a href="#122_ArticleService_805" rel="nofollow">12.2. ArticleService</a></li></ul> 
  </li><li><a href="#13_controller_875" rel="nofollow">13. 核心—控制层controller</a></li><li><ul><li><a href="#131_UserController_942" rel="nofollow">13.1. UserController</a></li><li><ul><li><a href="#1311__944" rel="nofollow">13.1.1. 注册功能</a></li><li><a href="#1312__1109" rel="nofollow">13.1.2. 登录功能</a></li><li><a href="#1313__1268" rel="nofollow">13.1.3. 注销功能</a></li><li><a href="#1314__1320" rel="nofollow">13.1.4. 判断当前用户是否登录</a></li></ul> 
   </li><li><a href="#132_ArticleController_1391" rel="nofollow">13.2. ArticleController</a></li><li><ul><li><a href="#1321__1393" rel="nofollow">13.2.1. 返回当前登录用户的文章列表</a></li><li><a href="#1322__1495" rel="nofollow">13.2.2. 删除文章功能</a></li><li><a href="#1323__1579" rel="nofollow">13.2.3. 查看文章详情功能</a></li><li><a href="#1324__1749" rel="nofollow">13.2.4. 更新文章阅读量</a></li><li><a href="#1325__1820" rel="nofollow">13.2.5. 添加文章</a></li><li><a href="#1326__1983" rel="nofollow">13.2.6. 修改文章</a></li><li><ul><li><a href="#13261__1985" rel="nofollow">13.2.6.1. 页面初始化</a></li><li><a href="#13262__2074" rel="nofollow">13.2.6.2. 发布修改后的文章</a></li></ul> 
    </li><li><a href="#1327__2170" rel="nofollow">13.2.7. 根据分页来查询汇总列表</a></li></ul> 
  </li></ul> 
  </li><li><a href="#14_SessionRedis_2374" rel="nofollow">14. Session升级存储到Redis</a></li><li><a href="#15__2400" rel="nofollow">15. 项目部署</a></li><li><a href="#16__2459" rel="nofollow">16. 项目亮点</a></li></ul> 
</div> 
<br> 简朴博客系统：简单朴素… 
<p></p> 
<h2><a id="1__2"></a>1. 前端页面效果</h2> 
<p>♨️<strong>注册页</strong></p> 
<p>包含以下用户信息：</p> 
<ol><li>用户名</li><li>密码</li></ol> 
<p><img src="https://images2.imgbox.com/b1/ed/8YIucAUd_o.png" alt="img"></p> 
<p>♨️<strong>登录页</strong></p> 
<p>包含以下用户信息：</p> 
<ol><li>用户名</li><li>密码</li></ol> 
<p><img src="https://images2.imgbox.com/66/a4/vBaNMYhP_o.png" alt="img"></p> 
<p>♨️<strong>文章详情页</strong></p> 
<p>登录状态下“登录”按钮变为“注销”按钮。</p> 
<p>包含以下用户信息：</p> 
<ol><li>博文作者 id</li><li>代码仓库链接</li><li>文章总数</li></ol> 
<p>包含以下博文信息：</p> 
<ol><li>作者 id</li><li>文章 id</li><li>标题</li><li>时间</li><li>正文</li><li>阅读量</li></ol> 
<p><img src="https://images2.imgbox.com/02/cb/xfD4xe6i_o.png" alt="img"></p> 
<p>♨️<strong>个人博客列表页</strong></p> 
<p>包含以下博文信息：</p> 
<ol><li>标题</li><li>时间</li><li>摘要</li></ol> 
<p><img src="https://images2.imgbox.com/ae/4e/JCEYposZ_o.png" alt="img"></p> 
<p>♨️<strong>文章汇总列表页</strong></p> 
<p>登录状态下“登录”按钮变为“注销”按钮。</p> 
<p>包含以下博文信息：</p> 
<ol><li>标题</li><li>时间</li><li>摘要</li></ol> 
<p><img src="https://images2.imgbox.com/40/fa/yA5NBOzp_o.png" alt="img"></p> 
<p>♨️<strong>博客编辑页</strong></p> 
<p>包含以下用户信息：</p> 
<ol><li>用户id</li></ol> 
<p>包含以下博文信息：</p> 
<ol><li>作者 id，即当前用户 id</li><li>标题</li><li>正文</li><li>创建时间，即提交时的时间</li><li>自动生成的文章 id</li></ol> 
<p><img src="https://images2.imgbox.com/3a/c7/plu7Cmxm_o.png" alt="img"></p> 
<h2><a id="2__81"></a>2. 项目创建</h2> 
<p>使用 Spring 全家桶 + MyBatis 框架进行开发。</p> 
<p><img src="https://images2.imgbox.com/fd/ca/uSbdRNZF_o.png" alt="img"></p> 
<p>创建项目目录：</p> 
<p>controller，前后端交互控制器，接收请求，处理请求，调用 service，将响应返回给前端。</p> 
<p>service，调用数据持久层 dao 层。</p> 
<p>dao，进行数据库操作。</p> 
<p>model，实体类。</p> 
<p>common，公共类，Utils 工具类。</p> 
<p>config，配置类。</p> 
<p><img src="https://images2.imgbox.com/b5/15/RzMBK1g8_o.png" alt="img"></p> 
<h2><a id="3__103"></a>3. 前期配置</h2> 
<p>当我们创建完一个 Spring 项目之后我们首先就是要准备好相关的配置文件以及创建好数据库。</p> 
<h3><a id="31__107"></a>3.1. 创建数据库数据表</h3> 
<p>创建数据库</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> 创建数据库
drop database <span class="token keyword">if</span> exists mycnblog<span class="token punctuation">;</span>
create database mycnblog <span class="token constant">DEFAULT</span> <span class="token constant">CHARACTER</span> <span class="token class-name">SET</span> utf8mb4<span class="token punctuation">;</span>
 
<span class="token operator">--</span> 选中数据库
use mycnblog<span class="token punctuation">;</span>
</code></pre> 
<p>包含以下两张表：</p> 
<ol><li>userinfo 用户表</li><li>articleinfo 文章表</li></ol> 
<p>🎯<code>userinfo</code>表</p> 
<ol><li>id，用户 id（主键）</li><li>username，用户名</li><li>password，密码</li><li>photo，头像</li><li>createtime，创建时间</li><li>updatetime，更新时间</li><li>state 状态（预留字段）</li></ol> 
<pre><code class="prism language-java"><span class="token operator">--</span> 创建表用户表
drop table <span class="token keyword">if</span> exists  userinfo<span class="token punctuation">;</span>
create table <span class="token function">userinfo</span><span class="token punctuation">(</span>
    id <span class="token keyword">int</span> primary key auto_increment<span class="token punctuation">,</span>
    username <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> not <span class="token keyword">null</span> unique<span class="token punctuation">,</span>
    password <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
    photo <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">default</span> ''<span class="token punctuation">,</span>
    createtime datetime <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime datetime <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    `state` <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span>
<span class="token punctuation">)</span> <span class="token keyword">default</span> charset 'utf8mb4'<span class="token punctuation">;</span>
</code></pre> 
<p>🎯<code>articleinfo</code>表</p> 
<ol><li>id，文章 id（自增主键）</li><li>title，标题</li><li>content，正文</li><li>createtime，创建时间</li><li>updatetime，更新时间</li><li>uid，用户 id</li><li>rcount，阅读量</li><li>state 状态（预留字段）</li></ol> 
<pre><code class="prism language-java"><span class="token operator">--</span> 创建文章表
drop table <span class="token keyword">if</span> exists  articleinfo<span class="token punctuation">;</span>
create table <span class="token function">articleinfo</span><span class="token punctuation">(</span>
    id <span class="token keyword">int</span> primary key auto_increment<span class="token punctuation">,</span>
    title <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
    content text not <span class="token keyword">null</span><span class="token punctuation">,</span>
    createtime datetime <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime datetime <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    uid <span class="token keyword">int</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
    rcount <span class="token keyword">int</span> not <span class="token keyword">null</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">,</span>
    `state` <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token keyword">default</span> charset 'utf8mb4'<span class="token punctuation">;</span>
</code></pre> 
<p>初始数据：</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> 添加一个用户信息
<span class="token constant">INSERT</span> <span class="token constant">INTO</span> `mycnblog`<span class="token punctuation">.</span>`userinfo` <span class="token punctuation">(</span>`id`<span class="token punctuation">,</span> `username`<span class="token punctuation">,</span> `password`<span class="token punctuation">,</span> `photo`<span class="token punctuation">,</span> `createtime`<span class="token punctuation">,</span> `updatetime`<span class="token punctuation">,</span> `state`<span class="token punctuation">)</span> <span class="token constant">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">'admin'</span><span class="token punctuation">,</span> <span class="token char">'admin'</span><span class="token punctuation">,</span> '<span class="token char">', '</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">48</span><span class="token char">', '</span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">48</span>'<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token operator">--</span> 文章添加测试数据
insert into <span class="token function">articleinfo</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>content<span class="token punctuation">,</span>uid<span class="token punctuation">)</span>
    <span class="token function">values</span><span class="token punctuation">(</span><span class="token char">'Java'</span><span class="token punctuation">,</span><span class="token char">'Java正文'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="32__187"></a>3.2. 配置文件</h3> 
<pre><code class="prism language-java"># 配置数据库的连接字符串
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>mycnblog2023<span class="token operator">?</span>characterEncoding<span class="token operator">=</span>utf8
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">111111</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>
# 配置打印 <span class="token class-name">MyBatis</span> 执行的 <span class="token constant">SQL</span>
mybatis<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>log<span class="token operator">-</span>impl<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span></span>StdOutImpl</span>
# 配置打印 <span class="token class-name">MyBatis</span> 执行的 <span class="token constant">SQL</span>
logging<span class="token punctuation">.</span>level<span class="token punctuation">.</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token operator">=</span>debug
# 设置时间格式
spring<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>date<span class="token operator">-</span>format<span class="token operator">=</span>yyyy<span class="token operator">-</span><span class="token constant">MM</span><span class="token operator">-</span>dd <span class="token constant">HH</span><span class="token operator">:</span>mm
spring<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>time<span class="token operator">-</span>zone<span class="token operator">=</span><span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">8</span>
# session 过期时间
server<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>session<span class="token punctuation">.</span>timeout<span class="token operator">=</span><span class="token number">1800</span>
spring<span class="token punctuation">.</span>session<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>flush<span class="token operator">-</span>mode<span class="token operator">=</span>on_save
spring<span class="token punctuation">.</span>session<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>namespace<span class="token operator">=</span>spring<span class="token operator">:</span>session
</code></pre> 
<p>接着将前端文件导入<code>static</code>中。</p> 
<p>获取链接：<a href="https://gitee.com/xin-xiangrong/java-ee-advanced/tree/master/myblog-sm/src/main/resources/static" rel="nofollow">链接</a></p> 
<p><img src="https://images2.imgbox.com/2c/31/XSQyRVNv_o.png" alt="img"></p> 
<p>此时就项目就创建完成并且连接上 Mysql 数据库了，接下来就是去实现相关的代码了。</p> 
<p><img src="https://images2.imgbox.com/11/e6/rzZpi9uz_o.png" alt="img"></p> 
<h2><a id="4__218"></a>4. 创建实体类</h2> 
<p>🍂model.<code>UserInfo</code>类，对应着数据库中的 userinfo 这张表。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">DigestUtils</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Userinfo</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> photo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createtime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updatetime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>🍂model.<code>ArticleInfo</code>类，对应着数据库中的 articleInfo 这张表。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Articleinfo</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd HH:mm"</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">"GMT+8"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createtime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updatetime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> uid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rcount<span class="token punctuation">;</span> <span class="token comment">// 文章阅读量</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>🍂model.vo.<code>UserInfoVO</code>扩展类，对于一些特殊情况，特殊处理，可以在这里面增加属性，不是增加在原类里，而数据库的表是没有变化的。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * userinfo 扩展类
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserinfoVO</span> <span class="token keyword">extends</span> <span class="token class-name">Userinfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> artCount<span class="token punctuation">;</span> <span class="token comment">// 用户文章数</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="5__292"></a>5. 统一处理</h2> 
<p>统一处理可以让代码更加低耦合，高内聚，更符合单一设计原则。</p> 
<h3><a id="51__296"></a>5.1. 统一返回格式处理</h3> 
<p>🍂<strong>统一格式类</strong> common.<code>ResultAjax</code></p> 
<p>该类实现了<code>Serializable</code>接口，实现了这个接口表示该类的对象可以通过序列化机制转换为字节流，并且可以在网络上传输、存储到文件中或在不同的 Java 虚拟机之间进行传递；序列化是将对象转换为字节序列的过程，反序列化则是将字节序列转换回对象的过程。</p> 
<ol><li>该类包括我们的状态码，状态码的描述信息，以及返回的数据。</li><li>该类重载了一些静态的返回方法分别表示我们返回成功或者返回失败的情况。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 前后端交互的统一数据格式对象
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultAjax</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span> <span class="token comment">// 状态码</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span> <span class="token comment">// 状态描述信息</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span> <span class="token comment">// 交互数据</span>

    <span class="token comment">// 成功</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultAjax</span> <span class="token function">succ</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ResultAjax</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultAjax</span> <span class="token function">succ</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ResultAjax</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 失败</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultAjax</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ResultAjax</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultAjax</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ResultAjax</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>🍂<strong>统一返回处理器</strong> common.<code>ResponseAdvice</code>。</p> 
<p>准备好了统一返回的类，为了以防止返回的数据不是规定格式（百密一疏的缺漏情况），可以写一个保底处理类，而正常写的时候，返回数据都是自己调用<code>ResultAjax</code>类的包装方法。</p> 
<ol><li>该类实现了<code>ResponseBodyAdvice</code>接口允许在返回数据之前对返回的数据进行校验和修改。</li><li>需要对<code>String</code>类型的数据进行了特殊的处理，String 类型不同与我们一般的类型，需要注入<code>ObjectMapper</code>对象手动将 String 类型转换成 json 格式。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonProcessingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">MethodParameter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ControllerAdvice</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBodyAdvice</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 保底统一返回值处理
 */</span>
<span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ResultAjax</span> resultAjax <span class="token operator">=</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>resultAjax<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="52__407"></a>5.2. 统一异常处理</h3> 
<p>🍂common.<code>ExceptionAdvice</code></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 统一异常处理
 */</span>
<span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">doException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="6__429"></a>6. 全局变量</h2> 
<p>🍂common.<code>AppVariable</code></p> 
<p>此类存放我们的全局变量，只放了一个固定的<code>session key</code>。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 全局变量
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppVariable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 用户 session key</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SESSION_USERINFO_KEY</span> <span class="token operator">=</span> <span class="token string">"SESSION_USERINFO"</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="7_Session_449"></a>7. Session工具类</h2> 
<p>🍂common.<code>SessionUtils</code></p> 
<p>该类主要是判断服务器是否存储了用户的<code>Session</code>，然后将此 Session 中的 userinfo 给取出来然后返回；这里用的是一个静态的方法这就方便我们的调用了，用的时候不需要去注入或者 new 了。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * session 工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionUtils</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 得到当前登录用户
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Userinfo</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">SESSION_USERINFO_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 登录状态</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Userinfo</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">SESSION_USERINFO_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="8__484"></a>8. 登录拦截器</h2> 
<p>在进入一个页面的时候可能需要用户的登录权限，所以应该对请求做一个拦截，对权限进行校验。</p> 
<p>拦截处理如下：</p> 
<p>我们首先需要获取当前的 Session，然后判断有没有存储指定的 Session，如果存在的话那就返回 true 意味着继续执行后续的代码，如果不是那就直接跳转到登录的页面，后续的代码自然也就不执行了返回 false。</p> 
<p>🍂<strong>拦截器</strong> config.<code>LoginIntercept</code>。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">AppVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">HandlerInterceptor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 用户拦截器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginIntercept</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">SESSION_USERINFO_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 用户已登录</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 登录页面</span>
        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>🍂<strong>拦截规则配置类</strong> config.<code>AppConfig</code>。</p> 
<p>拦截并不是对所有的请求都去进行拦截，我们会拦截部分的请求然后同样的也是会放开一些的请求，此类就是用来处理我们需要拦截哪些放开哪些东西，并且我们加入<code>Congiguration</code>的注解会随着框架的启动而生效。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">InterceptorRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurer</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 系统配置文件
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginIntercept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/reg"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/islogin"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/art/getlistbypage"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/art/detail"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/editor.md/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/art/increment_rcount"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/img/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/js/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/css/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/blog_list.html"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/blog_content.html"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/reg.html"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/login.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="9__560"></a>9. 密码加盐加密</h2> 
<p>🍁<strong>为什么要加密</strong></p> 
<p>如果密码没有进行加密一旦被拖库了是非常的危险的，用户信息特别是密码会全部被别人获取，想要防止密码被人看到就得对密码进行加密然后将加密后的密码存入数据库中去，这样即使数据库的密码被得到了也不能知道原密码是多少。</p> 
<p>🍁<strong>md5</strong></p> 
<p>md5 是一种比较常用的加密方式，它是将任意长度的输入通过一个算法然后生成一个 128 位的的二进制值输出，通常情况下是用 32 位的 16 进制来表示，其特点其加密是不可逆的，即加密之后不能通过加密值推测出原始值。</p> 
<p>🍁<strong>md5 缺点</strong></p> 
<p>md5 的加密虽然是不可逆的，但还是有一个问题是我们每次对同一个密码加密其得到的结果是固定的值，那么如果可以以穷举出所有的字符的话那么就可以推测出所有的密码了，这就是我们的彩虹表，彩虹表里面以类似键值对的方式将原始值以及 md5 的加密值存储起来然后不断的去完善这个彩虹表，这样对于绝大多数的密码我们都可以通过彩虹表来找到的，这就存在一定的风险了。</p> 
<p>🍁<strong>加盐加密原理</strong></p> 
<p>加盐算法可以解决 md5 被暴力破解的问题，在用 md5 算法对密码进行加密的时会给原密码加上一个全球不重复的随机的盐值（UUID），这样即使是同一个密码两次不同的加密在加盐之后生成的加密密码也是不一样的，就大大增加了密码破译的成本，更进一步保证了数据。</p> 
<p>🎯<strong>后端的盐值拼接约定</strong></p> 
<ol><li>盐值跟原始密码直接拼接后进行<code>md5</code>加密。</li><li>盐值跟生成的加密密码直接以<code>$</code>拼接<code>[salt]$[plus password]</code>保存到数据库。</li></ol> 
<p>🎯<strong>验密过程</strong></p> 
<ol><li>根据<code>$</code>分隔符获取到 [盐值] 和 [加密密码]。</li><li>[盐值] 和 [待验证的密码] 拼接后进行 md5 生成[待验证的加密密码]。</li><li>对比 [正确的加密密码] 和 [待验证的加密密码]。</li></ol> 
<p>🍂common.<code>PasswordUtils</code></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">DigestUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 密码工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordUtils</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 加盐加密
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 生成盐值</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 将盐值 + 密码进行 md5 加密得到最终密码</span>
        <span class="token class-name">String</span> finalPassword <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5DigestAsHex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>salt <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 将盐值和最终密码拼接成字符串 (以$分隔) 进行返回</span>
        <span class="token keyword">return</span> salt <span class="token operator">+</span> <span class="token string">"$"</span> <span class="token operator">+</span> finalPassword<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加盐验证
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> dbPassword<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>dbPassword<span class="token punctuation">)</span> <span class="token operator">||</span>
                dbPassword<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 1. 得到盐值</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dbPasswordArray <span class="token operator">=</span> dbPassword<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dbPasswordArray<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 盐值</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> dbPasswordArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 最终正确密码</span>
        <span class="token class-name">String</span> dbFinalPassword <span class="token operator">=</span> dbPasswordArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 加密待验证的密码</span>
        <span class="token class-name">String</span> finalPassword <span class="token operator">=</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5DigestAsHex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>salt <span class="token operator">+</span> password<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 对比验证</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>finalPassword<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>dbFinalPassword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="10__646"></a>10. 线程池组件</h2> 
<p>在容器中注入一个线程池，后续的业务逻辑可以使用线程提高执行效率。</p> 
<p>🍂config.<code>ThreadPoolConfig</code></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolTaskExecutor</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 线程池组件
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolConfig</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadPoolTaskExecutor</span> <span class="token function">taskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ThreadPoolTaskExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setMaxPoolSize</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setQueueCapacity</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setThreadNamePrefix</span><span class="token punctuation">(</span><span class="token string">"MyThread-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="11_dao_677"></a>11. dao层</h2> 
<h3><a id="111_UserMapper_679"></a>11.1. UserMapper</h3> 
<p>UserMapper 里面存放着关于 userinfo 表的接口，使用 mybatis 注解的方式实现 sql 的映射。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">UserinfoVO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Insert</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 将注册用户的密码保存到数据库中</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into userinfo(username,password) values(#{username},#{password})"</span><span class="token punctuation">)</span>
<span class="token comment">//    @Insert("insert into userinfo(username,password,updatetime) values(#{username},#{password},null)")</span>
    <span class="token keyword">int</span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">Userinfo</span> userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据用户名查询用户对象</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username=#{username}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Userinfo</span> <span class="token function">getUserByName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据用户 id 查询用户对象</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id=#{uid}"</span><span class="token punctuation">)</span>
    <span class="token class-name">UserinfoVO</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="112_ArticleMapper_710"></a>11.2. ArticleMapper</h3> 
<p>ArticleMapper 里面存放着关于 articleinfo 表的接口，使用 mybatis 注解的方式实现 sql 的映射。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Articleinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleMapper</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 根据用户 id 查询此用户发表的所有文章</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where uid=#{uid} order by id desc"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 判断文章的归属人+删除文章操作</span>
    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from articleinfo where id=#{aid} and uid=#{uid}"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> aid<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 添加文章到数据库</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into articleinfo(title,content,uid) values(#{title},#{content},#{uid})"</span><span class="token punctuation">)</span>
<span class="token comment">// @Insert("insert into articleinfo(title,content,uid,updatetime) values(#{title},#{content},#{uid},null)")</span>
    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 修改文章中间步骤: 查询自己发表的文章详情</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where id=#{aid} and uid=#{uid}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Articleinfo</span> <span class="token function">getArticleByIdAndUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 修改文章, 并效验归属人</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update articleinfo set title=#{title},content=#{content} where id=#{id} and uid=#{uid}"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据文章 id 查询文章对象</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where id=#{aid}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Articleinfo</span> <span class="token function">getDetailById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据 uid 查询用户发表的总文章数</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select count(*) from articleinfo where uid=#{uid}"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">getArtCountByUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新文章阅读量</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update articleinfo set rcount=rcount+1 where id=#{aid}"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">incrementRCount</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 查询一页的文章列表</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo order by id desc limit #{psize} offset #{offset}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"psize"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> psize<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"offset"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 查询文章表记录数</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select count(*) from articleinfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="12_service_768"></a>12. 服务层service</h2> 
<h3><a id="121_UserService_770"></a>12.1. UserService</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">UserinfoVO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token comment">// 将注册用户的密码保存到数据库中</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">Userinfo</span> userinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">reg</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根据用户名查询用户对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Userinfo</span> <span class="token function">getUserByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根据用户 id 查询用户对象</span>
    <span class="token keyword">public</span> <span class="token class-name">UserinfoVO</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="122_ArticleService_805"></a>12.2. ArticleService</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">ArticleMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Articleinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleMapper</span> articleMapper<span class="token punctuation">;</span>

    <span class="token comment">// 根据用户 id 查询此用户发表的所有文章</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByUid</span><span class="token punctuation">(</span><span class="token keyword">int</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getListByUid</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 判断文章的归属人+删除文章操作</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> aid<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span>aid<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 添加文章到数据库</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 修改文章中间步骤: 查询自己发表的文章详情</span>
    <span class="token keyword">public</span> <span class="token class-name">Articleinfo</span> <span class="token function">getArticleByIdAndUid</span><span class="token punctuation">(</span><span class="token keyword">int</span> aid<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getArticleByIdAndUid</span><span class="token punctuation">(</span>aid<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 修改文章, 并效验归属人</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根据文章 id 查询文章对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Articleinfo</span> <span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token keyword">int</span> aid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getDetailById</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根据 uid 查询用户发表的总文章数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getArtCountByUid</span><span class="token punctuation">(</span><span class="token keyword">int</span> uid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getArtCountByUid</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 更新文章阅读量</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">incrementRCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> aid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">incrementRCount</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询一页的文章列表</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> psize<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getListByPage</span><span class="token punctuation">(</span>psize<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询文章表记录数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleMapper<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="13_controller_875"></a>13. 核心—控制层controller</h2> 
<p>控制层是最为核心的一层，负责各种业务逻辑的处理。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">AppVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">PasswordUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">ResultAjax</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">UserinfoVO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">ResultAjax</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">SessionUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Articleinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Userinfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">UserinfoVO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ArticleService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Insert</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolTaskExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">FutureTask</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/art"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleService</span> articleService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _DESC_LENGTH <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span> <span class="token comment">// 文章简介的长度</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ThreadPoolTaskExecutor</span> taskExecutor<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="131_UserController_942"></a>13.1. UserController</h3> 
<h4><a id="1311__944"></a>13.1.1. 注册功能</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/user/reg</li><li>-1 非法参数 | 返回受影响行数</li></ol> 
<p>前端：</p> 
<ol><li>POST，json，/user/reg</li><li>data：username，password</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<ol><li>前端在经过一系列的校验之后会给传过来一组 json 数据。</li><li>我们用 UserinfoVO 接收然后将密码进行加密处理。</li><li>调用数据库然后将数据插入其中。</li></ol> 
<pre><code class="prism language-java"> <span class="token comment">/**
 * 注册功能接口
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/reg"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">UserinfoVO</span> userinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 效验参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 参数异常</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 密码加盐</span>
    userinfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">PasswordUtils</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 请求 service 进行添加操作</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">reg</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 将执行的结果返回给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 将注册用户及密码保存到数据库中</span>
<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into userinfo(username,password) values(#{username},#{password})"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">Userinfo</span> userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<p>不需要拦截，需要放开 URL。</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/reg"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<ol><li>用户名不能全为空，并且上传时空白符会被去除掉。</li><li>密码不能全为空，并且上传时空白符会被去除掉。</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span>注册页面<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/conmmon.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/reg.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 导航栏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"img/logo2.jpg"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>博客系统<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用来占据中间位置 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"spacer"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"blog_list.html"</span><span class="token operator">&gt;</span>博客广场<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"login.html"</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">&gt;</span>注销<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 版心 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"register-container"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 中间的注册框 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"register-dialog"</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">&gt;</span></span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>span<span class="token punctuation">&gt;</span></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> id<span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>span<span class="token punctuation">&gt;</span></span>密码<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> id<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>span<span class="token punctuation">&gt;</span></span>确认密码<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> id<span class="token operator">=</span><span class="token string">"password2"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"submit"</span> onclick<span class="token operator">=</span><span class="token string">"mysub()"</span><span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"login.html"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login"</span><span class="token operator">&gt;</span>已有账户？登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
    <span class="token comment">// 提交用户注册信息</span>
    function <span class="token function">mysub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 参数效验 (获取到数据和非空效验)</span>
        <span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> password2 <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#password2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入用户名! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入密码! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password2<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入确认密码! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password2<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 效验两次输入的密码是否一致</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> password2<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"两次密码不一致, 请先检查! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 将数据提交给后端</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/user/reg"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"username"</span><span class="token operator">:</span> username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"password"</span><span class="token operator">:</span> password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将后端返回的结果展示给用户</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 注册成功</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注册成功, 欢迎加入!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 调转到登录页</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 注册失败</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 注册失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="1312__1109"></a>13.1.2. 登录功能</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/user/login</li><li>-1 非法参数 | -2 用户名或密码错误 | 1</li></ol> 
<p>前端：</p> 
<ol><li>GET，query string，/user/login</li><li>data：username，password</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<ol><li>首先进行非空校验，判断用户名和密码是否为空。</li><li>使用用户名进行查询，看当前用户信息是否存在，存在拿到加密密码及 UUID</li><li>把拿到的用户信息中的加密密码与待验证密码进行对比。</li><li>验证成功将用户对象存储到 Session 中。</li></ol> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 登录功能接口
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">UserinfoVO</span> userinfoVO<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfoVO <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>userinfoVO<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>userinfoVO<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 非法登录</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 根据用户名查询对象</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>userinfoVO<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 不存在此用户</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"用户名或密码错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 使用对象中的密码和用户输入的密码进行比较</span>
    <span class="token comment">// 加盐解密</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">PasswordUtils</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>userinfoVO<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userinfo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 密码错误</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"用户名或密码错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 4. 比较成功之后，将对象存储到 session 中</span>
    <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">SESSION_USERINFO_KEY</span><span class="token punctuation">,</span> userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 将结果返回给用户</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 根据用户名查询用户对象</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username=#{username}"</span><span class="token punctuation">)</span>
<span class="token class-name">Userinfo</span> <span class="token function">getUserByName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<p>不需要拦截，需要放开 URL。</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span>登录页面<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/conmmon.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/login.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 导航栏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"img/logo2.jpg"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>博客系统<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用来占据中间位置 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"spacer"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"blog_list.html"</span><span class="token operator">&gt;</span>博客广场<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"reg.html"</span><span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 版心 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-container"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 中间的登录框 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-dialog"</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">&gt;</span></span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>span<span class="token punctuation">&gt;</span></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> id<span class="token operator">=</span><span class="token string">"username"</span> placeholder<span class="token operator">=</span><span class="token string">"手机号/邮箱"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>span<span class="token punctuation">&gt;</span></span>密码<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> id<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"submit"</span> onclick<span class="token operator">=</span><span class="token string">"doLogin()"</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"reg.html"</span><span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
    <span class="token comment">// 执行登录操作</span>
    function <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 效验参数</span>
        <span class="token comment">// 拿到用户和密码两个框的组件</span>
        <span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入用户名! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入密码! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 将数据提交给后端</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/user/login"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"username"</span><span class="token operator">:</span> username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"password"</span><span class="token operator">:</span> password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将结果展示给用户</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 登录成功</span>
                    <span class="token comment">// alert("恭喜: 登录成功！");</span>
                    <span class="token comment">// 跳转到我的文章管理页面</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 登录失败</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 登录失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="1313__1268"></a>13.1.3. 注销功能</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/user/logout</li><li>1</li></ol> 
<p>前端：</p> 
<ol><li>POST，/user/logout</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<p>直接将用户 Session 给删除即可。</p> 
<pre><code class="prism language-java"><span class="token comment">//注销功能</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p>在个人列表，汇总列表，博客详情页，博客编辑页的导航栏都有该事件的触发按钮。</p> 
<p><img src="https://images2.imgbox.com/35/63/M11fEpYd_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 注销功能 js</span>
function <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"是否确定注销? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 去后端删除 session 信息</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/user/logout"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 跳转到登录页面</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1314__1320"></a>13.1.4. 判断当前用户是否登录</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/user/islogin</li><li>true/false</li></ol> 
<p>前端：</p> 
<ol><li>GET，/user/islogin</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<p>判断用户 Session 是否存在即可。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 判断用户当前是否登录, 用来修改前端组建
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/islogin"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">islogin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AppVariable</span><span class="token punctuation">.</span><span class="token constant">SESSION_USERINFO_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<p>不需要拦截，需要放开 URL。</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/islogin"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p>后端返回 true，就将导航栏的 “登录” 按钮改为 “注销”。</p> 
<p>在汇总列表页和博客详情页登录状态会触发该事件，整合在两个页面初始化的过程中。</p> 
<p><img src="https://images2.imgbox.com/2d/9a/cei0Sy9O_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 判断用户是否登录，登录状态将 "登录" 按钮改为注销</span>
jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">"/user/islogin"</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 3. 将结果展示给用户</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 获取要修改的 &lt;a&gt; 元素</span>
            <span class="token keyword">var</span> linkElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"logoutLink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 修改 href 属性为 "javascript:logout()"</span>
            linkElement<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"javascript:logout()"</span><span class="token punctuation">;</span>

            <span class="token comment">// 修改文本内容为 "注销"</span>
            linkElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"注销"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="132_ArticleController_1391"></a>13.2. ArticleController</h3> 
<h4><a id="1321__1393"></a>13.2.1. 返回当前登录用户的文章列表</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/mylist</li><li>-1 | 返回博客列表信息</li></ol> 
<p>前端：</p> 
<ol><li>GET，/art/mylist</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<ol><li>通过 Session 获取到当前登录用户的 id，根据用户 id 去查询当前用户的所有文章。</li><li>对文章正文部分进行截取，得到摘要。</li></ol> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 得到当前登录用户的文章列表
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/mylist"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">myList</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 得到当前登录用户</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> <span class="token class-name">SessionUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"当前未登录: 请先注册/登录! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 根据用户 id 查询此用户发表的所有文章</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getListByUid</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理 list -&gt; 将文章正文变成简介</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 并行处理 list 集合</span>
        list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>art<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>art<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> _DESC_LENGTH<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 截取</span>
                art<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _DESC_LENGTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 返回给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 根据用户 id 查询此用户发表的所有文章</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where uid=#{uid} order by id desc"</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p><img src="https://images2.imgbox.com/b2/3a/roAnBpc5_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 初始化方法</span>
function <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token operator">:</span> <span class="token string">"/art/mylist"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 请求成功</span>
                <span class="token keyword">var</span> createHtml <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> artList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>artList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> artList<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 未发表文章</span>
                    createHtml <span class="token operator">+=</span> <span class="token string">"&lt;h3 style='margin-left:20px;margin-top:20px'&gt;暂无文章, 快去"</span> <span class="token operator">+</span>
                        <span class="token string">"&lt;a href='blog_add.html'&gt;创作&lt;/a&gt;吧! &lt;/h3&gt;"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> artList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">var</span> art <span class="token operator">=</span> artList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"blog"</span><span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>' <span class="token operator">+</span> art<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"date"</span><span class="token operator">&gt;</span>' <span class="token operator">+</span> art<span class="token punctuation">.</span>createtime <span class="token operator">+</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"desc"</span><span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> art<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> ' <span class="token operator">&lt;</span>a href<span class="token operator">=</span>"blog_content<span class="token punctuation">.</span>html<span class="token operator">?</span>aid<span class="token operator">=</span>' <span class="token operator">+</span>
                            art<span class="token punctuation">.</span>id <span class="token operator">+</span> '<span class="token string">" class="</span>detail"<span class="token operator">&gt;</span>查看全文<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>'<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>a href<span class="token operator">=</span>"blog_edit<span class="token punctuation">.</span>html<span class="token operator">?</span>aid<span class="token operator">=</span>' <span class="token operator">+</span>
                            art<span class="token punctuation">.</span>id <span class="token operator">+</span> '<span class="token string">" class="</span>detail"<span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>'<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> ' <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:del(' + art.id + ')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"detail"</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                        createHtml <span class="token operator">+=</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#artListDiv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>createHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1322__1495"></a>13.2.2. 删除文章功能</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/del</li><li>-1 | 受影响行数</li></ol> 
<p>前端：</p> 
<ol><li>POST，json，/art/del</li><li>data：aid（文章id)</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<p>删除时需要两个参数，一个是文章的 id 一个是当前登录用户的 id，当登录用户 id 和文章所属用户 id 要相同才能删除文章。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 删除文章
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/del"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> aid<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"参数错误! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 得到当前登录的用户</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> <span class="token class-name">SessionUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"当前未登录: 请先注册/登录! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 判断文章的归属人+删除操作 where id=aid and uid=uid</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span>aid<span class="token punctuation">,</span> userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 将结果返回给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 判断文章的归属人+删除文章操作</span>
<span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from articleinfo where id=#{aid} and uid=#{uid}"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> aid<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p><img src="https://images2.imgbox.com/2b/19/8VDmqQ9Y_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 根据文章 id 进行删除操作</span>
function <span class="token function">del</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"参数错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.将数据返回给后端进行删除操作</span>
    jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token operator">:</span> <span class="token string">"/art/del"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"aid"</span><span class="token operator">:</span> aid
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 3.将结果展示给用户</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章删除成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 刷新当前页面</span>
                location<span class="token punctuation">.</span>href <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 删除失败</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 删除失败, 请重新尝试! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1323__1579"></a>13.2.3. 查看文章详情功能</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/detail</li><li>user.count（文章数）&amp; user（用户） &amp; art（文章）</li></ol> 
<p>前端：</p> 
<ol><li>GET，quary string，/art/detail</li><li>data：aid</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<ol><li>根据文章 id 查询文章信息，看文章是否存在，文章存在，执行后续步骤。</li><li>注册根据 uid 查询用户总文章数的任务</li><li>注册根据 uid 查询用户信息的任务</li><li>线程池执行任务</li><li>构造响应数据，并返回</li></ol> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 查询文章详情页
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/detail"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">detail</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> aid<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 查询文章详情</span>
    <span class="token class-name">Articleinfo</span> articleinfo <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>articleinfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> articleinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3 和 4 是多线程同步查询</span>
    <span class="token comment">// 3. 根据 uid 查询用户的详情</span>
    <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserinfoVO</span><span class="token punctuation">&gt;</span></span> userTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>userTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 根据 uid 查询用户发表的总文章数</span>
    <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> artCountTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">getArtCountByUid</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>artCountTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5. 组装数据</span>
    <span class="token class-name">UserinfoVO</span> userinfoVO <span class="token operator">=</span> userTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待任务 (线程池) 执行完成</span>
    <span class="token keyword">int</span> artCount <span class="token operator">=</span> artCountTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待任务 (线程池) 执行完成</span>
    userinfoVO<span class="token punctuation">.</span><span class="token function">setArtCount</span><span class="token punctuation">(</span>artCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> userinfoVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"art"</span><span class="token punctuation">,</span> articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 6. 返回结果给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 根据文章 id 查询文章对象</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where id=#{aid}"</span><span class="token punctuation">)</span>
<span class="token class-name">Articleinfo</span> <span class="token function">getDetailById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据用户 id 查询用户对象</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id=#{uid}"</span><span class="token punctuation">)</span>
<span class="token class-name">UserinfoVO</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据 uid 查询用户发表的总文章数</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select count(*) from articleinfo where uid=#{uid}"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">getArtCountByUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<ol><li>该接口不需要拦截，需要放开 URL。</li><li>editor.md 是个目录，要放开整个目录才行，不然页面渲染就出问题了，其他地方不加能渲染是因为是登录状态，但详情页是不需要登录的。</li></ol> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/art/detail"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/editor.md/**"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p><img src="https://images2.imgbox.com/cf/b3/LEbOJ5Bl_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 获取查询字符串参数值: 根据 key 获取 url 中对应的 value</span>
function <span class="token function">getParamValue</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 得到当前url的参数部分</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
    <span class="token comment">// 2. 去除“?”</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        params <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 根据“&amp;”将参数分割成多个数组</span>
        <span class="token keyword">var</span> paramArray <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 循环对比 key, 并返回查询的 value</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>paramArray<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paramArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// key=value</span>
                <span class="token keyword">var</span> item <span class="token operator">=</span> paramArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
    <span class="token keyword">var</span> aid <span class="token operator">=</span> <span class="token function">getParamValue</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> editormd<span class="token punctuation">;</span>

    function <span class="token function">initEdit</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        editormd <span class="token operator">=</span> editormd<span class="token punctuation">.</span><span class="token function">markdownToHTML</span><span class="token punctuation">(</span><span class="token string">"editorDiv"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            markdown<span class="token operator">:</span> md<span class="token punctuation">,</span> <span class="token comment">// Also, you can dynamic set Markdown text</span>
            <span class="token comment">// htmlDecode : true,  // Enable / disable HTML tag encode.</span>
            <span class="token comment">// htmlDecode : "style,script,iframe",  // Note: If enabled, you should filter some dangerous HTML tags for website security.</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 初始化页面</span>
    function <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 效验参数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"参数有误! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 请求后端获取数据</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/art/detail"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"aid"</span><span class="token operator">:</span> aid
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将数据展示到前端</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">var</span> user <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
                    <span class="token keyword">var</span> art <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>art<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 给用户对象设置值</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>photo <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#photo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">att</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#artcount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>artCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用户发布的总文章数</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 查询失败,   请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>art <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#createtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span>createtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#rcount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span>rcount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阅读量</span>
                        <span class="token function">initEdit</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 查询失败,   请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 查询失败,   请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1324__1749"></a>13.2.4. 更新文章阅读量</h4> 
<p>♨️<strong>前后端接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/increment_rcount</li><li>-1 | 返回受影响行数</li></ol> 
<p>前端：</p> 
<ol><li>POST，json，/art/increment_rcount</li><li>data：aid</li></ol> 
<pre><code class="prism language-java"><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> 更新文章阅读量
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/increment_rcount"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">incrementRCount</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> aid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 效验参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"参数有误! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 更新数据库 update articleinfo set rcount=rcount+1 where aid=#{aid}</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">incrementRCount</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 返回结果</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-sql"><span class="token comment">// 更新文章阅读量</span>
<span class="token variable">@Update</span><span class="token punctuation">(</span><span class="token string">"update articleinfo set rcount=rcount+1 where id=#{aid}"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> incrementRCount<span class="token punctuation">(</span><span class="token variable">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<p>不需要拦截，需要放开 URL。</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/art/getlistbypage"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p>在查看文章详情页初始化模块中整合。</p> 
<pre><code class="prism language-java"><span class="token comment">// 访问量加 1</span>
function <span class="token function">incrementRCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token operator">:</span> <span class="token string">"/art/increment_rcount"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"aid"</span><span class="token operator">:</span> aid
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">incrementRCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="1325__1820"></a>13.2.5. 添加文章</h4> 
<p>♨️<strong>前后端接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/add</li><li>返回受影响行数</li></ol> 
<p>前端：</p> 
<ol><li>POST，json，/art/add</li><li>data：title，content</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<ol><li>通过 Session 得到当前登录用户的 id。</li><li>将用户 id 赋值到文章对象后插入到数据库。</li></ol> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 添加文章
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 效验参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>articleinfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 组装数据</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> <span class="token class-name">SessionUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"当前未登录: 请先注册/登录! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    articleinfo<span class="token punctuation">.</span><span class="token function">setUid</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 将数据入库</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 将结果返回给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 添加文章到数据库</span>
<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into articleinfo(title,content,uid) values(#{title},#{content},#{uid})"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">&gt;</span></span>博客添加<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入自己写的样式 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/conmmon.css"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/blog_edit.css"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入 editor<span class="token punctuation">.</span>md 的依赖 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"editor.md/css/editormd.min.css"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"editor.md/editormd.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/logout.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 导航栏 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"nav"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"img/logo2.jpg"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>博客系统<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用来占据中间位置 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"spacer"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"blog_list.html"</span><span class="token operator">&gt;</span>博客广场<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:logout()"</span><span class="token operator">&gt;</span>注销<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 编辑框容器 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"blog-edit-container"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 标题编辑区 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"title"</span> type<span class="token operator">=</span><span class="token string">"text"</span> placeholder<span class="token operator">=</span><span class="token string">"在这里写下文章标题"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">"mysub()"</span><span class="token operator">&gt;</span>发布文章<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 创建编辑器标签 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"editorDiv"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">"editor-markdown"</span> style<span class="token operator">=</span><span class="token string">"display:none;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
    <span class="token keyword">var</span> editor<span class="token punctuation">;</span>

    function <span class="token function">initEdit</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 编辑器设置</span>
        editor <span class="token operator">=</span> <span class="token function">editormd</span><span class="token punctuation">(</span><span class="token string">"editorDiv"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 这里的尺寸必须在这里设置. 设置样式会被 editormd 自动覆盖掉.</span>
            width<span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>
            <span class="token comment">// 高度 100% 意思是和父元素一样高. 要在父元素的基础上去掉标题编辑区的高度</span>
            height<span class="token operator">:</span> <span class="token string">"calc(100% - 50px)"</span><span class="token punctuation">,</span>
            <span class="token comment">// 编辑器中的初始内容</span>
            markdown<span class="token operator">:</span> md<span class="token punctuation">,</span>
            <span class="token comment">// 指定 editor.md 依赖的插件路径</span>
            path<span class="token operator">:</span> <span class="token string">"editor.md/lib/"</span><span class="token punctuation">,</span>
            saveHTMLToTextarea<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">initEdit</span><span class="token punctuation">(</span><span class="token string">"# 在这里写下一篇博客"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化编译器的值</span>
    <span class="token comment">// 提交</span>
    function <span class="token function">mysub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 非空效验</span>
        <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入标题! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            title<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入正文! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 将用户提交的数据传递给后端</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/art/add"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"title"</span><span class="token operator">:</span> title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"content"</span><span class="token operator">:</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将后端返回的结果展示给用户</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 文章添加成功</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"文章添加成功! 是否继续添加文章? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 刷新当前页面</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 跳转到个人文章管理页</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 文章添加失败</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 发布失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="1326__1983"></a>13.2.6. 修改文章</h4> 
<h5><a id="13261__1985"></a>13.2.6.1. 页面初始化</h5> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/update_init</li><li>-1 | 文章信息</li></ol> 
<p>前端：</p> 
<ol><li>GET，quary string，/art/update_init</li><li>data：aid</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 修改文章中间步骤: 查询自己发表的文章详情
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/update_init"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">updateInit</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> aid<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"参数有误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 得到当前登录用户 id</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> <span class="token class-name">SessionUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"当前未登录: 请先注册/登录! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 查询文章并效验权限 where id=#{aid} and uid=#{uid}</span>
    <span class="token class-name">Articleinfo</span> articleinfo <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getArticleByIdAndUid</span><span class="token punctuation">(</span>
            aid<span class="token punctuation">,</span> userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 将结果返回给前端</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">// 修改文章中间步骤: 查询自己发表的文章详情</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo where id=#{aid} and uid=#{uid}"</span><span class="token punctuation">)</span>
<span class="token class-name">Articleinfo</span> <span class="token function">getArticleByIdAndUid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> aid<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
	 <span class="token keyword">var</span> aid <span class="token operator">=</span> <span class="token function">getParamValue</span><span class="token punctuation">(</span><span class="token string">"aid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文章id</span>
	<span class="token comment">// 初始化页面的方法</span>
    function <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 效验 aid</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aid <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> aid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"非法参数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 查询文章详情</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/art/update_init"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"aid"</span><span class="token operator">:</span> aid
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将文章的详情信息展示到页面</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 查询到了文章信息</span>
                    <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">initEdit</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 操作失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 操作失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="13262__2074"></a>13.2.6.2. 发布修改后的文章</h5> 
<p>♨️<strong>前后端交互接口</strong><br> 后端：</p> 
<ol><li>/art/update</li><li>返回受影响行数</li></ol> 
<p>前端：</p> 
<ol><li>POST，json，/art/update</li><li>data：id（文章id），title，content</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 修改文章信息
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 参数效验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>articleinfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span>
            <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            articleinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"非法参数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 获取登录用户</span>
    <span class="token class-name">Userinfo</span> userinfo <span class="token operator">=</span> <span class="token class-name">SessionUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"当前未登录: 请先注册/登录! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    articleinfo<span class="token punctuation">.</span><span class="token function">setUid</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 修改文章, 并效验归属人</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. 返回结果</span>
    <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-java"> <span class="token comment">// 修改文章, 并效验归属人</span>
<span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update articleinfo set title=#{title},content=#{content} where id=#{id} and uid=#{uid}"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Articleinfo</span> articleinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：需要拦截。</p> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p><img src="https://images2.imgbox.com/3e/24/rFU2EYNm_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token comment">// 执行修改操作</span>
function <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 效验参数</span>
    <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入标题! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        title<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先输入正文! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 将结果提交给后端</span>
    jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token operator">:</span> <span class="token string">"/art/update"</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"id"</span><span class="token operator">:</span> aid<span class="token punctuation">,</span>
            <span class="token string">"title"</span><span class="token operator">:</span> title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"content"</span><span class="token operator">:</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 修改成功</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章修改成功! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 跳转到我的文章管理员</span>
                location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"当前未登录, 请在登录后操作! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 修改失败, 请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 将后端返回的结果展现给用户</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1327__2170"></a>13.2.7. 根据分页来查询汇总列表</h4> 
<p>♨️<strong>前后端交互接口</strong></p> 
<p>后端：</p> 
<ol><li>/art/getlistbypage</li><li>size（最大页码），list（一页的博客列表信息）</li></ol> 
<p>前端：</p> 
<ol><li>GET，quary string，/art/getlistbypage</li><li>data：pindex（页码）&amp; psize（页内最大博客数）</li></ol> 
<p>♨️<strong>后端实现</strong>：</p> 
<p>后端只要知道页码和一页多少条数据，就可以计算出要选取哪几条数据然后返回。</p> 
<p><code>psize</code>：一页几条数据，就是<code>limit</code>后面的值</p> 
<p><code>pindex</code>：根据这个值可以计算储偏移量为<code>psize × (pindex - 1)</code>，就是<code>offset</code>后面的值。</p> 
<p><code>所有博客数 / psize</code>，向上取整就是最大页码size，如果所有博客数为 0，则前端应该显示，当前在第 0 页，共 0 页。</p> 
<p><code>pindex</code>正常操作下是不会出错的，因为前端知道最大页码<code>size</code>，会做出判断。</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 查询所有博客: 分页查询
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/getlistbypage"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultAjax</span> <span class="token function">getListByPage</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> pindex<span class="token punctuation">,</span> <span class="token class-name">Integer</span> psize<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 参数矫正</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pindex <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pindex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 参数矫正</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>psize <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> psize <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            psize <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 参数矫正</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 并发进行文章列表和总页数的查询</span>
        <span class="token comment">// 2.1 查询分页列表数据</span>
        <span class="token keyword">int</span> finalOffset <span class="token operator">=</span> psize <span class="token operator">*</span> <span class="token punctuation">(</span>pindex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分页公式 (偏移位置, 即从第几条数据开始查)</span>
        <span class="token keyword">int</span> finalPSize <span class="token operator">=</span> psize<span class="token punctuation">;</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> listTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getListByPage</span><span class="token punctuation">(</span>finalPSize<span class="token punctuation">,</span> finalOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 并行处理 list 集合</span>
                list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>art<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>art<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> _DESC_LENGTH<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 截取</span>
                        art<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>art<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _DESC_LENGTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.2 查找总页数</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sizeTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 总条数</span>
            <span class="token keyword">int</span> totalCount <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> sizeTemp <span class="token operator">=</span> <span class="token punctuation">(</span>totalCount <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> finalPSize<span class="token punctuation">;</span>
            <span class="token comment">// 向上取整</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>sizeTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>listTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>sizeTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 组装数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Articleinfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> listTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> sizeTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 将结果返回给前端</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultAjax</span><span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>♨️<strong>涉及到的 sql 接口</strong>：</p> 
<pre><code class="prism language-sql"><span class="token comment">// 查询一页的文章列表</span>
<span class="token variable">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from articleinfo order by id desc limit #{psize} offset #{offset}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>Articleinfo<span class="token operator">&gt;</span> getListByPage<span class="token punctuation">(</span><span class="token variable">@Param</span><span class="token punctuation">(</span><span class="token string">"psize"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> psize<span class="token punctuation">,</span> <span class="token variable">@Param</span><span class="token punctuation">(</span><span class="token string">"offset"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> <span class="token keyword">offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查询文章表记录数</span>
<span class="token variable">@Select</span><span class="token punctuation">(</span><span class="token string">"select count(*) from articleinfo"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> getCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>♨️<strong>拦截器配置</strong>：</p> 
<p>不需要拦截，需要放开 URL。</p> 
<pre><code class="prism language-sql"><span class="token punctuation">.</span>excludePathPatterns<span class="token punctuation">(</span><span class="token string">"/art/getlistbypage"</span><span class="token punctuation">)</span>
</code></pre> 
<p>♨️<strong>前端逻辑及事件</strong>：</p> 
<p><img src="https://images2.imgbox.com/96/25/KHu5mrLS_o.png" alt="img"></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
    <span class="token keyword">var</span> psize <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每页显示条数</span>
    <span class="token keyword">var</span> pindex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 页码</span>
    <span class="token keyword">var</span> totalpage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 总共有多少页</span>
    <span class="token comment">// 初始化数据</span>
    function <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 处理分页参数</span>
        psize <span class="token operator">=</span> <span class="token function">getParamValue</span><span class="token punctuation">(</span><span class="token string">"psize"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>psize <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            psize <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每页显示条数</span>
        <span class="token punctuation">}</span>
        pindex <span class="token operator">=</span> <span class="token function">getParamValue</span><span class="token punctuation">(</span><span class="token string">"pindex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pindex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 页码</span>
        <span class="token punctuation">}</span>
        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#pindex"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>pindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 请求后端接口</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span> <span class="token string">"/art/getlistbypage"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"pindex"</span><span class="token operator">:</span> pindex<span class="token punctuation">,</span>
                <span class="token string">"psize"</span><span class="token operator">:</span> psize
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> function <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 3. 将结果展示给用户</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">var</span> createHtml <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 有文章</span>
                        totalpage <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#pszie"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>totalpage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> artlist <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> artlist<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">var</span> art <span class="token operator">=</span> artlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 文章对象</span>
                            createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"blog"</span> <span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                            createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span>' <span class="token operator">+</span> art<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"date"</span><span class="token operator">&gt;</span>' <span class="token operator">+</span> art<span class="token punctuation">.</span>createtime <span class="token operator">+</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"desc"</span><span class="token operator">&gt;</span>' <span class="token operator">+</span> art<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>a href<span class="token operator">=</span>"blog_content<span class="token punctuation">.</span>html<span class="token operator">?</span>aid<span class="token operator">=</span>' <span class="token operator">+</span>
                                art<span class="token punctuation">.</span>id <span class="token operator">+</span> '<span class="token string">" class="</span>detail"<span class="token operator">&gt;</span>查看全文<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                            createHtml <span class="token operator">+=</span> <span class="token char">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 暂无文章</span>
                        createHtml <span class="token operator">+=</span> '<span class="token operator">&lt;</span>h3 style<span class="token operator">=</span><span class="token string">"margin-top:20px;margin-left:20px;"</span><span class="token operator">&gt;</span>不好意思<span class="token punctuation">,</span> 暂无文章<span class="token operator">!</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>'<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#artListDiv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>createHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错了: 查询失败,  请重新操作! "</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 点击首页</span>
    function <span class="token function">doFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 判断是否在首页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"当前已经是第一页了哦! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 跳转到首页</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 点击末页</span>
    function <span class="token function">doLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 判断是否在末页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">&gt;=</span> totalpage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"当前已经是最后一页了哦! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 跳转到末页</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pindex="</span> <span class="token operator">+</span> totalpage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 点击 "上一页"</span>
    function <span class="token function">doBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 判断是否在首页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"当前已经是第一页了哦! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 跳转上一页</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pindex="</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pindex<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 点击 "下一页"</span>
    function <span class="token function">doNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 判断是否在末页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pindex <span class="token operator">&gt;=</span> totalpage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"当前已经是最后一页了哦! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. 跳转到下一页</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pindex="</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pindex<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="14_SessionRedis_2374"></a>14. Session升级存储到Redis</h2> 
<p>添加依赖：</p> 
<pre><code class="prism language-sql"><span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span><span class="token keyword">data</span><span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span><span class="token keyword">session</span><span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span><span class="token keyword">session</span><span class="token operator">-</span><span class="token keyword">data</span><span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>添加redis配置信息（properties）：</p> 
<pre><code class="prism language-sql"><span class="token comment"># redis 配置</span>
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">6379</span>
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>password<span class="token operator">=</span>
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span><span class="token keyword">database</span><span class="token operator">=</span><span class="token number">2</span>
spring<span class="token punctuation">.</span><span class="token keyword">session</span><span class="token punctuation">.</span>store<span class="token operator">-</span><span class="token keyword">type</span><span class="token operator">=</span>redis
</code></pre> 
<h2><a id="15__2400"></a>15. 项目部署</h2> 
<p>1️⃣<strong>Linux 中安装 Redis</strong></p> 
<p>使用以下命令，直接将 redis 安装到 linux 服务器：</p> 
<pre><code class="prism language-java">yum <span class="token operator">-</span>y install redis
</code></pre> 
<p>2️⃣<strong>设置 Redis 远程连接</strong></p> 
<p>这一步需要修改 Redis 中的一些配置</p> 
<ol><li>进入 redis 配置文件的编写模式，redis 配置文件就是 linux 下的 /etc/redis.conf。</li><li>将 redis.conf 中的 “bind 127.0.0.1” 注释掉。</li><li>将 redis.conf 中的 “protected-mode yes” 改为 “protected-mode no”。</li><li>保存并退出。</li><li>使用命令 “redis-cli shutdown” 先关闭 redis 服务，再使用 “redis-server /etc/redis.conf &amp;” 启动 redis 服务。</li><li>redis 在服务器的端口默认是 6379，配置防火墙或者安全组将这个端口开放。</li></ol> 
<p>3️⃣<strong>启动 Redis</strong></p> 
<p>使用以下命令，以后台运行方式启动 redis：</p> 
<pre><code class="prism language-java">redis<span class="token operator">-</span>server <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf <span class="token operator">&amp;</span>
</code></pre> 
<p>4️⃣<strong>打包上传项目</strong></p> 
<p>将程序打包为<code>.jar</code>包上传到云服务器。</p> 
<p>要注意，在打包项目的时候，⼀定要检查，确保数据库连接的是远程服务器的 MySQL，确保密码正确；确保 Rdeis 端口配置正确。</p> 
<p>5️⃣<strong>启动项目</strong></p> 
<p>使⽤以下命令启动 Spring Boot 项⽬并后台运行：</p> 
<pre><code class="prism language-java">nohup java <span class="token operator">-</span>jar xxx<span class="token punctuation">.</span>jar <span class="token operator">&amp;</span>
</code></pre> 
<p>6️⃣<strong>停止项目</strong></p> 
<p>停止 Spring Boot 项目需要两步：</p> 
<ol><li>查询出运行的 Spring Boot 的进程，使用命令:</li></ol> 
<pre><code class="prism language-java">ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep java
</code></pre> 
<ol start="2"><li>将 Spring Boot 的进程结束掉，使用命令：</li></ol> 
<pre><code class="prism language-java">kill <span class="token operator">-</span><span class="token number">9</span> 进程<span class="token constant">ID</span>
</code></pre> 
<h2><a id="16__2459"></a>16. 项目亮点</h2> 
<ol><li>应用到了多线程提高业务处理效率。</li><li>列表显示实现了一个分页功能。</li><li>密码的存储使用了自己写加盐加密算法。</li><li>用到了AOP编程，统一处理与拦截器。</li><li>Session 存储到 Redis，可以让多个服务器共享 Session 数据。</li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/707a486e9e90139e8b2c883aefe8a399/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ROS tf使用报错：ImportError: dynamic module does not define module export function (PyInit__tf2)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d01b61ad15b423b93511137f2057ea2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深度学习卫星遥感图像检测与识别 -opencv python 目标检测 计算机竞赛</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>