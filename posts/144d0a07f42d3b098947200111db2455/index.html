<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux服务器 部署飞书信息发送服务 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux服务器 部署飞书信息发送服务" />
<meta property="og:description" content="项目介绍： 飞书信息发送服务是指将飞书信息发送服务部署到一个Linux服务器上。飞书是一款企业级的即时通讯和协作工具，支持发送消息给飞书的功能。通过部署飞书信息发送服务，可以方便内网发送信息给外网飞书。
项目代码结构展示： 文件结构解释： common文件夹保存了一些基础运行文件。
api.py通过调用飞书开放平台的API获取租户访问令牌，其中调用了飞书的url接口。
logs.py将日志数据保存到文件夹logs中。
send_message.py实现使用飞书开放平台的API发送消息给指定用户。
logs文件夹保存的是消息传递过程中产生的日志信息。
other文件夹保存有可转换文件的部分程序，供后续开发使用。
static文件夹保存有html文件需要调用的css、js和json文件等配置文件。
templates文件夹保存有index.html文件，即网页运行文件。
app.py文件是整个项目的运行文件，实现了一个简单的web应用程序，用户可以通过表单提交消息，并将消息发送给另一个模块进行处理。同时，在后台记录了用户的IP地址、ID、消息和用户名等信息。 项目代码解释： 1. api.py代码解释： &#39;&#39;&#39; 该代码的作用是使用飞书开放平台的 API 获取应用的访问令牌（tenant_access_token），并将其打印出来。 该代码通过发送HTTP POST请求，获取飞书应用的访问令牌，并将结果打印出来，以便后续使用该令牌来访问飞书开放平台的其他API。 &#39;&#39;&#39; # 导入requests模块。 import requests # 飞书信息传入接口 # 定义了请求的URL，该URL用于获取应用的访问令牌。 url = &#39;https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal&#39; # 定义了请求的头部，指定Content-Type为application/json。 headers = { &#39;Content-Type&#39;: &#39;application/json&#39; } # 定义了请求的数据，包括应用的app_id和app_secret。 # 得从飞书集成平台上创建一个飞书服务，从而获得其中的参数 data = { # 请求参数（从飞书内部app获得） &#34;app_id&#34;: &#34;cli_a5cb1xxxxxxxxxxxxx&#34;, &#34;app_secret&#34;: &#34;qNFmmFTQqexxxxxxxxxxxxxxxxxxxxxxx&#34; } # 发送POST请求，将URL、头部和数据传递给requests.post()函数，并将返回的响应对象保存在response变量中。 response = requests.post(url, headers=headers, json=data) # 检查响应的状态码，如果状态码为200，则表示请求成功，继续执行下一步；否则打印请求失败的提示信息。 if response.status_code == 200: # 请求成功 # 将响应的内容解析为JSON格式，保存在result变量中。 result = response." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/144d0a07f42d3b098947200111db2455/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T13:27:01+08:00" />
<meta property="article:modified_time" content="2023-12-21T13:27:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux服务器 部署飞书信息发送服务</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>项目介绍：</h2> 
<blockquote> 
 <p>飞书信息发送服务是指将飞书信息发送服务部署到一个Linux服务器上。飞书是一款企业级的即时通讯和协作工具，支持发送消息给飞书的功能。通过部署飞书信息发送服务，可以方便内网发送信息给外网飞书。</p> 
</blockquote> 
<h2>项目代码结构展示：</h2> 
<p><img alt="" height="516" src="https://images2.imgbox.com/7d/81/uk3oTKhl_o.png" width="469"></p> 
<h3>文件结构解释：</h3> 
<blockquote> 
 <ul><li> <p><strong>common文件夹</strong>保存了一些基础运行文件。</p> </li><li> <p>api.py通过调用飞书开放平台的API获取租户访问令牌，其中调用了飞书的url接口。</p> </li><li> <p>logs.py将日志数据保存到文件夹logs中。</p> </li><li> <p>send_message.py实现使用飞书开放平台的API发送消息给指定用户。</p> </li><li> <p><strong>logs文件夹</strong>保存的是消息传递过程中产生的日志信息。</p> </li><li> <p><strong>other文件夹</strong>保存有可转换文件的部分程序，供后续开发使用。</p> </li><li> <p><strong>static文件夹</strong>保存有html文件需要调用的css、js和json文件等配置文件。</p> </li><li> <p><strong>templates文件夹</strong>保存有index.html文件，即网页运行文件。</p> </li><li> <p><strong>app.py文件</strong>是整个项目的运行文件，实现了一个简单的web应用程序，用户可以通过表单提交消息，并将消息发送给另一个模块进行处理。同时，在后台记录了用户的IP地址、ID、消息和用户名等信息。 </p> </li></ul> 
</blockquote> 
<h2>项目代码解释：</h2> 
<h3>1. api.py代码解释：</h3> 
<pre><code>'''
    该代码的作用是使用飞书开放平台的 API 获取应用的访问令牌（tenant_access_token），并将其打印出来。
    该代码通过发送HTTP POST请求，获取飞书应用的访问令牌，并将结果打印出来，以便后续使用该令牌来访问飞书开放平台的其他API。
'''

# 导入requests模块。
import requests

# 飞书信息传入接口
# 定义了请求的URL，该URL用于获取应用的访问令牌。
url = 'https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal'

# 定义了请求的头部，指定Content-Type为application/json。
headers = {
    'Content-Type': 'application/json'
}

# 定义了请求的数据，包括应用的app_id和app_secret。
# 得从飞书集成平台上创建一个飞书服务，从而获得其中的参数
data = {
    # 请求参数（从飞书内部app获得）
    "app_id": "cli_a5cb1xxxxxxxxxxxxx",
    "app_secret": "qNFmmFTQqexxxxxxxxxxxxxxxxxxxxxxx"
}

# 发送POST请求，将URL、头部和数据传递给requests.post()函数，并将返回的响应对象保存在response变量中。
response = requests.post(url, headers=headers, json=data)

# 检查响应的状态码，如果状态码为200，则表示请求成功，继续执行下一步；否则打印请求失败的提示信息。
if response.status_code == 200:
    # 请求成功
    # 将响应的内容解析为JSON格式，保存在result变量中。
    result = response.json()
    # 处理返回结果
    print(result)
else:
    # 请求失败
    print('请求失败：', response.status_code)</code></pre> 
<h3>2. logs.py代码解释：</h3> 
<pre><code>'''
    该代码是一个日志收集的函数。函数名为log，接受四个参数：ip、user_id、message和username。
    代码的作用是将传入的日志信息保存到以年份为文件名的文件夹中的以日期为文件名的文件中。
'''
import os
import datetime

# log 日志收集
def log(ip,user_id,message,username):

    # 获取当前时间，格式为小时-分钟-秒钟，保存到变量date中。
    date = datetime.datetime.now().strftime("%H-%M-%S")
    data = f"ip:{ip}, username:{username}, user_id:{user_id}, date:{date}, message:{message}\n"

    # 创建保存年文件夹的文件夹
    # 根据当前时间获取年份，并创建保存年份文件夹的文件夹路径，保存到变量year_folder_name中。
    year_folder_name = f"./logs/"+datetime.datetime.now().strftime("%Y")
    # 创建保存数据的文件夹和文件名
    # 根据当前时间获取日期，并创建保存数据的文件夹路径，保存到变量folder_name中。
    folder_name = f"./{year_folder_name}/"+datetime.datetime.now().strftime("%m-%d")

    # 如果年份文件夹路径不存在，则创建年份文件夹。
    if not os.path.exists(year_folder_name):
        os.makedirs(year_folder_name, exist_ok=True)

    # 如果数据文件夹路径不存在，则创建数据文件夹。
    if not os.path.exists(folder_name):
        os.makedirs(folder_name, exist_ok=True)

    # 根据当前时间获取文件名，并将文件路径保存到变量filepath中。
    file_name = datetime.datetime.now().strftime("%H-%M") + ".txt"

    # 检查文件是否存在
    #    - 如果存在，则以追加模式打开文件，并将日志信息写入文件中。
    #    - 如果不存在，则以写入模式创建新文件，并将日志信息写入文件中。
    filepath = os.path.join(folder_name, file_name)
    if os.path.exists(filepath):
        with open(filepath, "a") as file:
            file.write(data)
    else:
        with open(filepath, "w") as file:
            file.write(data)</code></pre> 
<h3>3. send_message.py代码解释：</h3> 
<pre><code>'''
    该代码实现了使用飞书开放平台的API发送消息给指定用户。
'''

import json
import requests

# `get_access_token`函数用于获取tenant_access_token，即应用的访问令牌，通过传入应用的app_id和app_secret作为参数，向飞书的API发送请求并返回响应结果。
def get_access_token(app_id, app_secret):
    """
    自建应用获取 tenant_access_token
    https://open.feishu.cn/document/server-docs/authentication-management/access-token/tenant_access_token_internal
    :param app_id: 应用唯一标识
    :param app_secret: 应用秘钥
    :return:
    {
        "code": 0,
        "msg": "success",
        "tenant_access_token": "t-xxx",
        "expire": 7140
    }
    """
    url = 'https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal'
    params = {
        'app_id': app_id,
        'app_secret': app_secret
    }

    res = requests.post(url, params=params)
    return res.json()


# `send_message`函数用于发送消息，通过传入访问令牌、消息体和查询参数作为参数，向飞书的API发送请求并返回响应结果。
def send_message(access_token, body, params):
    """
    发送消息
    https://open.feishu.cn/document/server-docs/im-v1/message/create
    :param access_token:
    :param body: 消息体
    :param params: 查询参数 {"receive_id_type":"open_id"}
    :return:
    """
    url = 'https://open.feishu.cn/open-apis/im/v1/messages'

    headers = {
        'Authorization': 'Bearer ' + access_token
    }

    res = requests.post(url, params=params, headers=headers, json=body)
    return res.json()

# `run`函数是主函数，用于执行发送消息的操作。首先获取访问令牌，然后设置查询参数为"user_id"，接下来构造消息体，包含接收消息的用户ID和消息内容。最后调用`send_message`函数发送消息，并输出响应结果。
def run(message,user_id):
    # App ID
    app_id = 'cli_a5cb1xxxxxxxxxxxxxxxx'

    # App Secret
    app_secret = 'qNFmmFTQqecZtgjbxxxxxxxxxxxxxxx'
    token = get_access_token(app_id, app_secret)
    params = {"receive_id_type": "user_id"}

    # 发送接口消息
    payload = {
        "receive_id": user_id,
        "msg_type": "text",
        "content": json.dumps({
            "text": message
        })
    }
    # 获取tenant_access_token
    res = send_message(token['tenant_access_token'], payload, params)
    print(res)


</code></pre> 
<h3>4. app.py代码解释：</h3> 
<pre><code>'''
    该代码是一个简单的Flask应用程序，用于接收用户的表单数据，记录日志并发送消息给用户。用户可以通过根路径访问一个包含表单的页面，并填写表单后，提交数据到/process路径。服务器接收到数据后记录日志，并向用户发送消息。
'''
from flask import Flask, request, render_template
from common import send_message, logs

# - Flask：用于创建Web应用程序的框架。
# - request：用于处理HTTP请求的模块。
# - render_template：用于渲染模板的模块。
# - send_message：自定义的模块，用于发送消息。
# - logs：自定义的模块，用于记录日志。

# 定义全局变量
user_id = ''
message = ''
# 创建Flask应用程序实例：
app = Flask(__name__)

# 定义路由和视图函数：
#  - 定义根路径'/'的视图函数index。
#  - 使用render_template函数渲染名为index.html的模板，并传递icon_path参数。
@app.route('/')
def index():
    icon_path = '/static/icon.ico'
    return render_template("index.html", icon_path=icon_path)

# 定义/process路由和视图函数：
#  - 定义/process路径的视图函数process。
#  - 通过request.form.get方法获取POST请求中的字段值。
#  - 获取用户ID、消息内容、用户名和IP地址。
#  - 调用logs.log方法记录日志。
#  - 调用send_message.run方法发送消息。
#  - 返回收到的用户ID、消息内容和IP地址。
@app.route("/process", methods=['POST'])
def process():
    user_id = request.form.get('user_id')
    message = request.form.get('message')
    username = request.form.get('username')
    ip = request.remote_addr
    logs.log(ip,user_id,message,username)
    send_message.run(message, user_id)

    return f'Received: {user_id},{message},{ip}'

# 启动应用程序：
#  - 判断当前模块是否为主模块。
#  - 如果是主模块，则调用app.run方法启动应用程序，监听0.0.0.0:80地址。
#  - 0.0.0.0表示监听所有的IP地址，80为端口号。
if __name__ == '__main__':
    app.run(host="0.0.0.0", port=80)

</code></pre> 
<h3>5. excel_to_json.py代码解释</h3> 
<pre><code>import openpyxl
import json
import io
# excel表格转json文件
def excel_to_json(excel_file, json_file_name):
    # 加载工作薄
    book = openpyxl.load_workbook(excel_file)
    # 获取sheet页
    sheet = book["文件名xxxxxxxxx"]
    # 行数
    max_row = sheet.max_row
    # 列数
    max_column = sheet.max_column
    print("max_row: %d, max_column: %d" % (max_row, max_column))
    # 结果，数组存储
    result = []
    heads = []
    # 解析表头
    for column in range(max_column):
        # 读取的话行列是从（1，1）开始
        heads.append(sheet.cell(1, column + 1).value)
    # 遍历每一行
    for row in range(max_row):
        if row == 0:
            continue
        one_line = {}
        for column in range(max_column):
            # 读取第二行开始每一个数据
            k = heads[column]
            cell = sheet.cell(row + 1, column + 1)
            value = cell.value
            one_line[k] = value
        print(one_line)
        new_one_line = {
    '人员ID': one_line['人员ID'],
    '工号': one_line['工号'],
    '员工类型':one_line['员工类型'],
    '人员姓名': one_line['人员姓名'],
    '职务':one_line['职务']
}
    result.append(new_one_line)
    book.close()

    # 将result通过大括号包裹起来
    result_json = {'data': result}

    # 将json保存为文件
    save_json_file(result_json, json_file_name)

# 将json保存为文件
def save_json_file(jd, json_file_name):
    file = io.open(json_file_name, 'w', encoding='utf-8')
    # 把对象转化为json对象
    # indent: 参数根据数据格式缩进显示，读起来更加清晰
    # ensure_ascii = True：默认输出ASCII码，如果把这个该成False, 就可以输出中文。
    txt = json.dumps(jd, indent=2, ensure_ascii=False)
    file.write(txt)
    file.close()

if '__main__' == __name__:
    # 运行该程序使Excel文件内容转换为json文件
     excel_to_json(u'Excel文件.xlsx', '../static/json/result.json')

</code></pre> 
<h3>6. index.css代码解释</h3> 
<pre><code>这段代码实现了一个基于弹性布局的聊天界面。代码中使用了CSS样式来设置页面的布局和样式。
`padding`和`box-sizing`为`border-box`来统一元素的盒模型。
`.text`类来设置文本的样式，包括字体大小、字重、字体样式和颜色。
`.box`类来设置聊天界面的背景样式和弹性布局。背景采用了渐变色，并设置了背景动画。同时设置了最小高度和居中对齐。
`@keyframes`规则来设置背景动画的关键帧。
`.box h2`类来设置标题样式。
`.chat-message`类来设置聊天消息框的样式，包括宽高、边框样式、背景样式、字体大小和颜色等。
`.chat-message .new-message`类来设置新消息框的样式，包括外边距、内边距、背景样式、字体大小和颜色等。
`.chat-message .new-message .daytime`和`.chat-message .new-message .messagebox`类来设置新消息框中的日期和消息内容的样式。
`.inputBox`类来设置输入框的样式，包括宽度和位置。
`.inputBox textarea`类来设置文本输入框的样式，包括宽高、边框样式、背景样式、字体大小和颜色等。
`.inputBox span`类来设置输入框中的提示文字的样式。
`:valid`和`:focus`来设置输入框验证状态下的样式。
`.buttonBox button`类来设置按钮的样式，包括内边距、边框样式、背景样式、字体大小和颜色等。
`:hover`来设置鼠标悬停状态下按钮的样式。
`.selectBox`类来设置下拉选框的样式，包括字体大小、边框样式和颜色等。
*{
    padding: 0;
    box-sizing: border-box;
}
.text {
    font-size: 20px;
    font-weight: 100;
    font-style: italic;
    color:rgb(136, 204, 244);
    padding-bottom: 3px;
}
/* 弹性布局 水平+垂直居中 */
.box{
    background-image: linear-gradient(
        125deg,
        #0d98d3,
        #27ae60,
        #1782ca,
        #a720e0,
        #e74c3c
    );
    background-size: 400%;
    animation: bgmove 30s infinite;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    user-select: none;
    padding: 1.5rem;
    gap: 15px;
}

@keyframes bgmove {
    0%{
            background-position: 0% 50%;
    }
    50%{
        background-position: 100% 50%;
    }
    100%{
        background-position: 0% 50%;
    }
    50%{
        background-position: 100% 50%;
    }
    0%{
        background-position: 0% 50%;
    }
}

.box h2{
    color: rgb(136, 204, 244);
    font-style: oblique;
    font-size: 30px;
    padding-top: 60px;
}

.chat-message {
    width: 700px; /* 设置宽度 */
    height: 400px; /* 设置高度 */
    border: 2px solid rgba(255, 255, 255, 0.5);
    background: #ffffff00;
    border: 5px;
    outline: none;
    font-size: 1em;
    color: white;
    box-shadow: 0px 0px 10px #b3bed3 inset;
    font-family: Arial, sans-serif; /* 字体 */
    border-radius: 5px; /* 边框圆角 */
    transform: translateX(20px); /* 将div元素向右移动50像素 */
    overflow: auto;
}

.chat-message .new-message{
    margin: 10px;
    padding: 3px;
    margin-top: 20px;
    margin-bottom: 23px;
    width: fit-content;
    background: #ffffff00;
    border: 5px;
    outline: none;
    font-size: 1em;
    color: white;
    font-family: Arial, sans-serif; /* 字体 */
    border-radius: 5px; /* 边框圆角 */
    -webkit-user-select: text; /* Safari */
    -moz-user-select: text; /* Firefox */
    -ms-user-select: text; /* IE10+/Edge */
    user-select: text; /* Standard */
    position: relative;
}

.chat-message .new-message .daytime{
    font-size: 13px;
    position: absolute;
    top: -15px; /* 上移10像素 */
}

.chat-message .new-message .messagebox{
    font-size: 21px;
}

.inputBox{
    position: relative;
    width: 300px;
}

.inputBox textarea {
    width: 700px; /* 设置宽度 */
    height: 200px; /* 设置高度 */
    resize: none; /* 禁止拖拽改变大小 */
    border: 2px solid rgba(255, 255, 255, 0.5);
    background: #ffffff00;
    border: 5px;
    outline: none;
    font-size: 1em;
    transition: 0.3s;
    color: white;
    box-shadow: 0px 0px 10px #b3bed3 inset;
    font-family: Arial, sans-serif; /* 字体 */
    border-radius: 5px; /* 边框圆角 */
    margin-left: -180px;
  }

.inputBox span{
    position: relative;
    top: -10px;
    position: absolute;
    left: -180px;
    padding: 20px;
    pointer-events: none;
    font-size: 1em;
    color: #fefefefe;
    text-transform: uppercase;
    transition: 0.3s;
}

.inputBox textarea:valid~span,
.inputBox textarea:focus~span{
    color: #15dede;
    transform: translateX(15px) translateY(-7px);
    font-size: 0.65em;
    padding: 0 5px;
    background: #15acde5c;
    letter-spacing: 0.1em;
}

.inputBox textarea:valid,
.inputBox textarea:focus{
    border: 1px solid #20bdce00;
}

/* 按钮样式 */
.buttonBox button{
    padding: 10px;
    border-radius: 5px;
    background: rgba(13, 98, 132, 0);
    font-size: 1em;
    color: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.5);
    font-weight: 600;
    box-shadow: 0px 0px 10px #dadfeb inset;

}

.buttonBox button:hover{
    color: #d5dede;
    border: 1px solid #50c9c3;
}

.selectBox{
    color: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.5);
    letter-spacing: 0.1em;
    font-size: 1em;
    border: 5px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}

.selectBox span{
    font-size: 20px;
    color: white;
    margin: 13px -5px 0px 20px;
}

.selectBox .select{
    font-size: 1em;
    background-color: rgba(254, 254, 254, 0.055);
    color: #f9f7c7;
    width: 160px;
    height: 35px;
    margin: 10px 0 0 10px;
    padding-left: 10px;
    border: none;
    box-shadow: 0px 0px 10px #b4c0d6 inset;
    font-family: Arial, sans-serif; /* 字体 */
    border-radius: 5px; /* 边框圆角 */
}

.selectBox option {
    background-color: #3ebaef;
}</code></pre> 
<h3>7. result.json代码解释</h3> 
<p><strong>目的是用于保存发送人员数据信息</strong></p> 
<pre><code>{
  "data": [
    {
      "人员ID": "417xxx",
      "工号": "22xx",
      "部门列表": "xx",
      "直属上级": "xx",
      "职务": "xxxx"
    }
  ]
}</code></pre> 
<h2>实现飞书信息发送服务在Linux服务器上部署</h2> 
<h3><strong>1. 准备环境：确保你的Linux服务器满足以下系统要求：</strong></h3> 
<blockquote> 
 <ul><li> <p>系统：CentOS 7.x 或更高版本</p> </li><li> <p>内存：4GB 以上</p> </li><li> <p>存储：至少 1GB 可用硬盘空间</p> </li><li> <p>网络：能够访问互联网（目的是能够访问飞书接口，可以是外网虚拟机）</p> </li></ul> 
</blockquote> 
<h3 style="background-color:transparent;"><strong>2. Linux配置项目环境：</strong></h3> 
<h4>检查是否已安装Python 3.6：</h4> 
<pre><code>$ python3 --version</code></pre> 
<p>如果返回<code>Python 3.6.x</code>的版本信息，说明已安装Python 3.6。</p> 
<h4>如果未安装Python 3.6，可使用以下命令来安装：</h4> 
<pre><code>$ sudo apt update

$ sudo apt install python3.6</code></pre> 
<h4>检查是否安装成功：</h4> 
<pre><code>$ python3.6 --version</code></pre> 
<h4>确认Python安装路径：</h4> 
<pre><code>$ which python3.6</code></pre> 
<p>默认路径为:<code>/usr/bin/python3.6</code>。</p> 
<h4>安装Python包管理工具pip：</h4> 
<pre><code>$ sudo apt install python3-pip</code></pre> 
<h4>检查是否安装成功： </h4> 
<pre><code>$ pip3 --version</code></pre> 
<p>现在，Python 3.6环境已在Linux系统上安装完毕。</p> 
<p><strong>您可以使用<code>python3.6</code>命令来启动Python 3.6解释器，并使用<code>pip3</code>来安装/管理Python包。</strong></p> 
<h4>项目依赖需求导入</h4> 
<p>将项目所需的依赖需求导入<code>requirements.txt</code>文件中，方便后续在Linux环境下下载配置（在终端运行）</p> 
<pre><code>pip freeze &gt; requirements.txt</code></pre> 
<blockquote> 
 <p>该命令可以将当前pycharm使用的（也可以在linux系统中使用）： python解释器中的依赖包全部收集到requements.txt 文件中，为了避免收集无用的依赖包，建议给 目标项目使用虚拟环境解释器，这样就只会收集到当前项目的依赖包了。（最好在哪里创建项目就在那里使用）</p> 
</blockquote> 
<h3 style="background-color:transparent;">3.项目部署</h3> 
<h4 style="background-color:transparent;">通过Xshell连接Linux虚拟机，再通过Xftp传输文件到Linux虚拟机上去：</h4> 
<p>Xshell官方下载网站：https://www.xshell.com/zh/all-downloads/</p> 
<p>（Xshell通过ssh的方式连接的，Xftp通过ftp的方式连接的，可以在网上下载使用，也可用其他软件替代）</p> 
<p>将项目移动到指定项目文件夹，可以使用mv命令来实现</p> 
<pre><code>mv python_Project /usr/local/feishuconnect/</code></pre> 
<p>查看效果：</p> 
<pre><code>[root@proxy-cuhnj-local admin]# ls /usr/local/feishuconnect/
python_Project</code></pre> 
<h4>项目Linux环境依赖安装：</h4> 
<ul><li> <p>安装项目的依赖包（requements.txt为项目收集的依赖包地址）</p> </li></ul> 
<pre><code>pip install -r requements.txt </code></pre> 
<blockquote> 
 <p>如果对应的Linux环境中未配置国内镜像源，导致依赖包安装缓慢，可以通过命令</p> 
 <p>pip install -i 国内镜像源地址 -r requements.txt 安装项目依赖包</p> 
</blockquote> 
<ul><li> <p>国内比较常用的镜像：</p> </li></ul> 
<blockquote> 
 <p>pip 默认源：<a href="https://pypi.python.org/simple" rel="nofollow" title="https://pypi.python.org/simple">https://pypi.python.org/simple</a></p> 
 <p>1.豆瓣(douban) <a class="has-card" href="https://pypi.douban.com/simple" rel="nofollow" title="Simple Index"><span class="link-card-box"><span class="link-title">Simple Index</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ff/ef/dIeHF2D0_o.png" alt="icon-default.png?t=N7T8">https://pypi.douban.com/simple</span></span></a> 2.清华大学 <a class="has-card" href="https://pypi.tuna.tsinghua.edu.cn/simple" rel="nofollow" title="Simple Index"><span class="link-card-box"><span class="link-title">Simple Index</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/b7/40/lL4eorp9_o.png" alt="icon-default.png?t=N7T8">https://pypi.tuna.tsinghua.edu.cn/simple</span></span></a> 3.阿里云 <a class="has-card" href="https://mirrors.aliyun.com/pypi/simple" rel="nofollow" title="Simple Index"><span class="link-card-box"><span class="link-title">Simple Index</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/5d/2f/wMZkfCKF_o.png" alt="icon-default.png?t=N7T8">https://mirrors.aliyun.com/pypi/simple</span></span></a> 4.中国科技大学 <a class="has-card" href="https://pypi.mirrors.ustc.edu.cn/simple" rel="nofollow" title="Simple Index"><span class="link-card-box"><span class="link-title">Simple Index</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/7c/fc/W2B9ttUY_o.png" alt="icon-default.png?t=N7T8">https://pypi.mirrors.ustc.edu.cn/simple</span></span></a></p> 
</blockquote> 
<h4>项目依赖安装完成后，打开防火墙并运行测试效果</h4> 
<p>打开服务器的防火墙8081端口</p> 
<pre><code>Sudo firewall-cmd --add-port=443/tcp --permanent  # 打开服务器8081端口
sudo firewall-cmd --reload         # 刷新防火墙策略
sudo firewall-cmd --list-all       # 查看 firewall 防火墙允许访问端口列表
Sudo firewall-cmd --remove-port=443/tcp --permanent   # 关闭服务器8081端口</code></pre> 
<p>通过python3 app.py命令来测试效果：</p> 
<pre><code>python3  app.py    # 运行程序测试效果</code></pre> 
<p>展示如上效果，并且没有报错，则为运行成功，如果报错，可以查看系统日志文件找出错误：</p> 
<pre><code>journalctl -xe   #查看系统日志信息</code></pre> 
<p>查看项目进程信息，运行状态：</p> 
<pre><code>netstat -anpult|grep python</code></pre> 
<h4>项目Service服务配置：</h4> 
<ul><li> <p>创建一个Systemd服务配置文件:</p> </li></ul> 
<pre><code>sudo vim /etc/systemd/system/feishuconnect.service</code></pre> 
<ul><li> <p>在该文件中添加以下内容：</p> </li></ul> 
<pre><code>[admin@proxy-cuhnj-local python_Project]$ cat /etc/systemd/system/feishuconnect.service
[Unit]
Description=My FeishuConnect Server

[Service]
ExecStart=/usr/bin/python3 /usr/local/feishuconnect/python_Project/app.py
WorkingDirectory=/usr/local/feishuconnect/python_Project/
Restart=always
User=admin
Group=admin

[Install]
WantedBy=multi-user.target
[admin@proxy-cuhnj-local python_Project]$ </code></pre> 
<ul><li> <p>保存并关闭文件</p> </li><li> <p>使用以下命令来启用并启动Systemd服务：</p> </li></ul> 
<pre><code>sudo systemctl enable feishuconnect.service 

sudo systemctl start feishuconnect.service</code></pre> 
<p>这将使您的FeishuConnect服务器在系统启动时自动启动，并且您可以使用Systemd命令来管理它，例如启动、停止、重启或查看状态。</p> 
<pre><code>sudo systemctl stop feishuconnect.service # 停止服务 
sudo systemctl restart feishuconnect.service # 重启服务 
sudo systemctl status feishuconnect.service # 查看服务状态</code></pre> 
<h4><strong>修改：将Service服务修改为80端口</strong></h4> 
<p>首先先停止Service服务</p> 
<pre><code>sudo systemctl stop feishuconnect.service # 停止服务</code></pre> 
<p>修改项目内的运行程序app.py (将端口port 修改为 80 端口) </p> 
<p><img alt="" height="786" src="https://images2.imgbox.com/43/ec/Ei7WJqJf_o.png" width="935"></p> 
<p>修改Service服务的权限</p> 
<blockquote> 
 <p>由于将服务端口修改为了80（host="<a href="http://0.0.0.0" rel="nofollow" title="0.0.0.0">0.0.0.0</a>"，port=80），而80端口只有特权用户（例如root用户）才能占用。这是因为在低于1024的端口上进行绑定时，只有root用户才有权限。</p> 
</blockquote> 
<p><img alt="" height="381" src="https://images2.imgbox.com/c8/5b/NqO1VfVP_o.png" width="1200"></p> 
<p>刷新Service服务，查看Service服务状态</p> 
<pre><code>sudo systemctl daemon-reload # 更新Service配置 
sudo systemctl restart feishuconnect.service # 重启服务 
sudo systemctl status feishuconnect.service # 查看服务状态</code></pre> 
<h4>测试项目效果：</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a1/a0/AYX1pO45_o.png" width="1200"></p> 
<h2>项目代码下载：</h2> 
<blockquote> 
 <p>链接：https://pan.baidu.com/s/1B7H_3ZZA100aqJnI6p1DwA?pwd=fwvg <br> 提取码：fwvg</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1fcd299ebeb5127c7caea20b3b5ce0ec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Boot Web中文文档</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b37bbb13dedea58f0a370ee2d8be8a26/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot的自动配置原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>