<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>各类配置文件格式简介(ini,yaml,conf,xml...)和nb的Viper - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="各类配置文件格式简介(ini,yaml,conf,xml...)和nb的Viper" />
<meta property="og:description" content="目录 配置文件ini介绍语法demo库 json语法demo库 xml介绍语法&amp;demo yamldemo tomlpropertiesHOCONplist(plist 是捆上了手脚的 xml) Viper（22k star）安装why viperSet默认值读取配置文件写入配置文件监控配置文件从io.Reader读取配置覆盖设置注册和使用别名使用环境变量使用Flagsflag接口 远程Key/Value存储支持远程Key/Value存储示例-未加密（etcd)远程Key/Value存储示例-加密(etcd)监控etcd中的更改-未加密从Viper获取值访问嵌套的键提取子树反序列化序列化成字符串单例viper使用多个viper实例使用Viper示例使用结构体变量保存配置信息 配置文件 适合人类编写：ini &gt; toml &gt; yaml &gt; json &gt; xml &gt; plist
可以存储的数据复杂度：xml &gt; yaml &gt; toml ~ json ~ plist &gt; ini
ini 介绍 ini文件是一个无固定标准格式的配置文件。它以简单的文字与简单的结构组成，常常使用在Windows操作系统。ini文件的命名来源，是取自英文“初始（Initial）”的首字缩写，正与它的用途——初始化程序相应。
语法 一个ini文件是由多个section（段）组成。每个段中都包含多个option（数据项），以key=vlaue形式存储数据；注释 以 # 或者 ; 开头。 demo # config.ini [user_info] name = zhangsan age = 18 gender = 男 is_admin = true [connect] host = 127.0.0.1 user = db password = 123456 port = 1521 db = zet 库 python使用内置包 configparser对ini文件进行操作，不需要安装依赖包。 json JSON（JavaScript Object Notation）是一种轻量级的数据交换语言，以文字为基础，且易于让人阅读。尽管JSON是Javascript的一个子集，但JSON是独立于语言的文本格式，并且采用了类似于C语言家族的一些习惯。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/16ab5efb40d5d0f0454505695eda6b4e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-10T15:57:08+08:00" />
<meta property="article:modified_time" content="2023-02-10T15:57:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">各类配置文件格式简介(ini,yaml,conf,xml...)和nb的Viper</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">配置文件</a></li><li><ul><li><a href="#ini_4" rel="nofollow">ini</a></li><li><ul><li><a href="#_5" rel="nofollow">介绍</a></li><li><a href="#_8" rel="nofollow">语法</a></li><li><a href="#demo_13" rel="nofollow">demo</a></li><li><a href="#_31" rel="nofollow">库</a></li></ul> 
   </li><li><a href="#json_34" rel="nofollow">json</a></li><li><ul><li><a href="#_39" rel="nofollow">语法</a></li><li><a href="#demo_47" rel="nofollow">demo</a></li><li><a href="#_73" rel="nofollow">库</a></li></ul> 
   </li><li><a href="#xml_77" rel="nofollow">xml</a></li><li><ul><li><a href="#_78" rel="nofollow">介绍</a></li><li><a href="#demo_82" rel="nofollow">语法&amp;demo</a></li></ul> 
   </li><li><a href="#yaml_105" rel="nofollow">yaml</a></li><li><ul><li><a href="#demo_108" rel="nofollow">demo</a></li></ul> 
   </li><li><a href="#toml_136" rel="nofollow">toml</a></li><li><a href="#properties_179" rel="nofollow">properties</a></li><li><a href="#HOCON_205" rel="nofollow">HOCON</a></li><li><a href="#plistplist__xml_223" rel="nofollow">plist(plist 是捆上了手脚的 xml)</a></li></ul> 
  </li><li><a href="#Viperhttpsgithubcomspf13viper22k_star_254" rel="nofollow">Viper（22k star）</a></li><li><ul><li><a href="#_258" rel="nofollow">安装</a></li><li><a href="#why_viper_261" rel="nofollow">why viper</a></li><li><a href="#Set_282" rel="nofollow">Set默认值</a></li><li><a href="#_289" rel="nofollow">读取配置文件</a></li><li><a href="#_320" rel="nofollow">写入配置文件</a></li><li><a href="#_336" rel="nofollow">监控配置文件</a></li><li><a href="#ioReader_351" rel="nofollow">从io.Reader读取配置</a></li><li><a href="#_376" rel="nofollow">覆盖设置</a></li><li><a href="#_382" rel="nofollow">注册和使用别名</a></li><li><a href="#_392" rel="nofollow">使用环境变量</a></li><li><a href="#Flags_424" rel="nofollow">使用Flags</a></li><li><ul><li><a href="#flag_469" rel="nofollow">flag接口</a></li></ul> 
   </li><li><a href="#KeyValue_506" rel="nofollow">远程Key/Value存储支持</a></li><li><a href="#KeyValueetcd_528" rel="nofollow">远程Key/Value存储示例-未加密（etcd)</a></li><li><a href="#KeyValueetcd_534" rel="nofollow">远程Key/Value存储示例-加密(etcd)</a></li><li><a href="#etcd_541" rel="nofollow">监控etcd中的更改-未加密</a></li><li><a href="#Viper_573" rel="nofollow">从Viper获取值</a></li><li><a href="#_597" rel="nofollow">访问嵌套的键</a></li><li><a href="#_652" rel="nofollow">提取子树</a></li><li><a href="#_674" rel="nofollow">反序列化</a></li><li><a href="#_756" rel="nofollow">序列化成字符串</a></li><li><a href="#viper_774" rel="nofollow">单例viper</a></li><li><ul><li><a href="#viper_779" rel="nofollow">使用多个viper实例</a></li><li><a href="#Viper_791" rel="nofollow">使用Viper示例</a></li><li><a href="#_826" rel="nofollow">使用结构体变量保存配置信息</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>配置文件</h2> 
<p>适合人类编写：ini &gt; toml &gt; yaml &gt; json &gt; xml &gt; plist<br> 可以存储的数据复杂度：xml &gt; yaml &gt; toml ~ json ~ plist &gt; ini</p> 
<h3><a id="ini_4"></a>ini</h3> 
<h4><a id="_5"></a>介绍</h4> 
<p>ini文件是一个无固定标准格式的配置文件。它以简单的文字与简单的结构组成，常常使用在Windows操作系统。ini文件的命名来源，是取自英文“初始（Initial）”的首字缩写，正与它的用途——初始化程序相应。</p> 
<h4><a id="_8"></a>语法</h4> 
<ol><li>一个ini文件是由多个section（段）组成。</li><li>每个段中都包含多个option（数据项），以key=vlaue形式存储数据；</li><li>注释 以 # 或者 ; 开头。</li></ol> 
<h4><a id="demo_13"></a>demo</h4> 
<pre><code class="prism language-bash"><span class="token comment"># config.ini</span>

<span class="token punctuation">[</span>user_info<span class="token punctuation">]</span>  
name <span class="token operator">=</span> zhangsan
age <span class="token operator">=</span> <span class="token number">18</span>
gender <span class="token operator">=</span> 男
is_admin <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token punctuation">[</span>connect<span class="token punctuation">]</span>
<span class="token function">host</span> <span class="token operator">=</span> <span class="token number">127.0</span>.0.1
user <span class="token operator">=</span> db
password <span class="token operator">=</span> <span class="token number">123456</span>
port <span class="token operator">=</span> <span class="token number">1521</span>
db <span class="token operator">=</span> zet
</code></pre> 
<h4><a id="_31"></a>库</h4> 
<ol><li>python使用内置包 configparser对ini文件进行操作，不需要安装依赖包。</li></ol> 
<h3><a id="json_34"></a>json</h3> 
<p>JSON（JavaScript Object Notation）是一种轻量级的数据交换语言，以文字为基础，且易于让人阅读。尽管JSON是Javascript的一个子集，但JSON是独立于语言的文本格式，并且采用了类似于C语言家族的一些习惯。</p> 
<p>JSON 数据格式与语言无关，脱胎于 JavaScript，但目前很多编程语言都支持 JSON 格式数据的生成和解析, 所以也常常用作配置文件。</p> 
<h4><a id="_39"></a>语法</h4> 
<ol><li>对象（object）：一个对象以 { 开始，并以 } 结束。一个对象包含一系列非排序的名称／值对，每个名称／值对之间使用 , 分区</li><li>名称／值（collection）：名称和值之间使用 ： 隔开，一般的形式是： {name:value}</li><li>值的有序列表（Array）：一个或者多个值用,分区后，使用 [，] 括起来就形成了这样的列表</li><li>字符串：以””括起来的一串字符。</li><li>数值：一系列0-9的数字组合，可以为负数或者小数。还可以用e或者E表示为指数形式。</li><li>布尔值：表示为true或者false。</li></ol> 
<h4><a id="demo_47"></a>demo</h4> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"listener"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"tcp"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"address"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1:443"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"cluster_cipher_suites"</span><span class="token operator">:</span> <span class="token string">"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA"</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"storage"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"consul"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"foo"</span><span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span> 
            <span class="token string-property property">"disable_clustering"</span><span class="token operator">:</span> <span class="token string">"true"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"telemetry"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"statsite_address"</span><span class="token operator">:</span> <span class="token string">"baz"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"max_lease_ttl"</span><span class="token operator">:</span> <span class="token string">"10h"</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"default_lease_ttl"</span><span class="token operator">:</span> <span class="token string">"10h"</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"cluster_name"</span><span class="token operator">:</span> <span class="token string">"testcluster"</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"ui"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_73"></a>库</h4> 
<ol><li>python json</li><li>go encoding/json，jsoniter</li></ol> 
<h3><a id="xml_77"></a>xml</h3> 
<h4><a id="_78"></a>介绍</h4> 
<ol><li>可扩展标记语言，标准通用标记语言的子集，是一种用于标记电子文件使其具有结构性的标记语言。</li><li>XML设计用来传送及携带数据信息，所以也经常用来做配置文件。</li></ol> 
<h4><a id="demo_82"></a>语法&amp;demo</h4> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
 <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
 <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>
 <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
 ${config.uri}/company.properties,
 classpath:product.properties,
 ${config.uri}/${product.name}/${product.version}/common.properties,
 ${config.uri}/${product.name}/${product.version}/${config.stage}/stage.properties,
 ${config.uri}/${product.name}/${product.version}/${config.stage}/${config.node}/node.properties<span class="token punctuation">"</span></span>
 <span class="token attr-name">system-properties-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FALLBACK<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spring<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="yaml_105"></a>yaml</h3> 
<p>YAML的语法和其他高级语言类似，并且可以简单表达清单、散列表，标量等数据形态。它使用空白符号缩进和大量依赖外观的特色， 比较适合用来表达层次结构式的数据结构。</p> 
<h4><a id="demo_108"></a>demo</h4> 
<pre><code class="prism language-yaml"><span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">scheme</span><span class="token punctuation">:</span> https
      <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">"1.2.3.4:9093"</span>
            <span class="token punctuation">-</span> <span class="token string">"1.2.3.5:9093"</span>
            <span class="token punctuation">-</span> <span class="token string">"1.2.3.6:9093"</span>

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">tsdb</span><span class="token punctuation">:</span>
    <span class="token key atrule">out_of_order_time_window</span><span class="token punctuation">:</span> 30m

<span class="token key atrule">tracing</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> <span class="token string">"localhost:4317"</span>
  <span class="token key atrule">client_type</span><span class="token punctuation">:</span> <span class="token string">"grpc"</span>
  <span class="token key atrule">headers</span><span class="token punctuation">:</span>
    <span class="token key atrule">foo</span><span class="token punctuation">:</span> <span class="token string">"bar"</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 5s
  <span class="token key atrule">compression</span><span class="token punctuation">:</span> <span class="token string">"gzip"</span>
  <span class="token key atrule">tls_config</span><span class="token punctuation">:</span>
    <span class="token key atrule">cert_file</span><span class="token punctuation">:</span> valid_cert_file
    <span class="token key atrule">key_file</span><span class="token punctuation">:</span> valid_key_file
    <span class="token key atrule">insecure_skip_verify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<h3><a id="toml_136"></a>toml</h3> 
<ol><li> <p>TOML是一种旨在成为一个小规模、易于使用的语义化的配置文件格式，它被设计为可以无二义性的转换为一个哈希表。</p> </li><li> <p>TOML的语法广泛地由 key = “value” 、 [节名] 与 #注释 构成。</p> </li><li> <p>它支持以下数据类型：字符串、整形、浮点型、布尔型、日期时间、数组和图表。</p> </li></ol> 
<pre><code class="prism language-toml"># This is a TOML document.

title = "TOML Example"

[owner]
name = "Tom Preston-Werner"
dob = 1979-05-27T07:32:00-08:00 # First class dates

[database]
server = "192.168.1.1"
ports = [ 8001, 8001, 8002 ]
connection_max = 5000
enabled = true

[servers]

# Indentation (tabs and/or spaces) is allowed but not required
[servers.alpha]
ip = "10.0.0.1"
dc = "eqdc10"

[servers.beta]
ip = "10.0.0.2"
dc = "eqdc10"

[clients]
data = [ ["gamma", "delta"], [1, 2] ]

# Line breaks are OK when inside arrays
hosts = [
  "alpha",
  "omega"
]
</code></pre> 
<h3><a id="properties_179"></a>properties</h3> 
<ol><li> <p>properties是一种主要在Java相关技术中用来存储应用程序的可配置参数的文件的文件扩展名。它们也可以存储用于国际化和本地化的字符串，这种文件被称为属性资源包（Property Resource Bundles）。</p> </li><li> <p>每个参数被存储为一对字符串：一个存储名称参数（被称为“键”），另一个存储值。</p> </li><li> <p>每个properties 文件中的行通常存储单个属性。对于每一行可能有这么几种格式，包括键=值，键 = 值，键:值，以及键 值。</p> </li></ol> 
<pre><code class="prism language-propertites"># ===============================
# = DATA SOURCE
# ===============================

# Set here configurations for the database connection

# Connection url for the database "netgloo_blog"
spring.datasource.url = jdbc:mysql://localhost:3306/netgloo_blog?useSSL=false

# Username and password
spring.datasource.username = root
spring.datasource.password = root

# Keep the connection alive if idle for a long time (needed in production)
spring.datasource.testWhileIdle = true
spring.datasource.validationQuery = SELECT 1
</code></pre> 
<h3><a id="HOCON_205"></a>HOCON</h3> 
<p>HOCON，全称Human-Optimized Config Object Notation（人性化配置对象表示法）是一种人类可读的数据格式，并是JSON和properties的一个超集。它由Lightbend(用Scala开发的人都知道)开发，主要与Play框架结合使用。它也在Puppet中作为配置格式使用。</p> 
<pre><code class="prism language-hocon">play.http.secret.key = "changeme"

play.modules {
 # Disable built-in i18n module
 disabled += play.api.i18n.I18nModule

 # Enable Hocon module
 enabled += com.marcospereira.play.i18n.HoconI18nModule
}

play.i18n {
 langs = [ "en" ]
}
</code></pre> 
<h3><a id="plistplist__xml_223"></a>plist(plist 是捆上了手脚的 xml)</h3> 
<ol><li> <p>苹果的属性列表（Property List）文件是一种用来存储序列化后的对象的文件。属性列表文件的文件扩展名为.plist，因此通常被称为plist文件。</p> </li><li> <p>Plist文件通常用于储存用户设置，也可以用于存储捆绑的信息，该功能在旧式的Mac OS中是由资源分支提供的。</p> </li></ol> 
<pre><code class="prism language-plist">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"
 "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;Label&lt;/key&gt;
&lt;string&gt;com.plex.pms&lt;/string&gt;
&lt;key&gt;KeepAlive&lt;/key&gt;
&lt;true/&gt;
&lt;key&gt;ProgramArguments&lt;/key&gt;
&lt;array&gt;
&lt;string&gt;/Applications/Plex\ Media\ Server.app/Contents/MacOS/Plex\ Media\ Server&lt;/string&gt;
&lt;/array&gt;
&lt;key&gt;RunAtLoad&lt;/key&gt;
&lt;true/&gt;
&lt;key&gt;UserName&lt;/key&gt;
&lt;string&gt;__USERNAME__&lt;/string&gt;
&lt;key&gt;WorkingDirectory&lt;/key&gt;
&lt;string&gt;/Applications&lt;/string&gt;
&lt;key&gt;ServiceDescription&lt;/key&gt;
&lt;string&gt;PMS&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre> 
<h2><a id="Viperhttpsgithubcomspf13viper22k_star_254"></a><a href="https://github.com/spf13/viper">Viper</a>（22k star）</h2> 
<p>Viper是适用于Go应用程序的完整配置解决方案。</p> 
<p><img src="https://images2.imgbox.com/8f/bb/ximGXaJm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_258"></a>安装</h3> 
<p><code>go get github.com/spf13/viper</code></p> 
<h3><a id="why_viper_261"></a>why viper</h3> 
<p>它支持以下特性：</p> 
<ol><li>设置默认值</li><li>从JSON、TOML、YAML、HCL、envfile和Java properties格式的配置文件读取配置信息</li><li>实时监控和重新读取配置文件（可选）</li><li>从环境变量中读取</li><li>从远程配置系统（etcd或Consul）读取并监控配置变化</li><li>从命令行参数读取配置</li><li>从buffer读取配置</li><li>显式配置值</li></ol> 
<p>Viper会按照下面的优先级。每个项目的优先级都高于它下面的项目:</p> 
<ul><li>显示调用Set设置值</li><li>命令行参数（flag）</li><li>环境变量</li><li>配置文件</li><li>key/value存储</li><li>默认值</li></ul> 
<h3><a id="Set_282"></a>Set默认值</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"ContentDir"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"LayoutDir"</span><span class="token punctuation">,</span> <span class="token string">"layouts"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"Taxonomies"</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"tag"</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token punctuation">,</span> <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_289"></a>读取配置文件</h3> 
<ol><li>Viper需要至少要知道在哪里查找配置文件的配置。</li><li>Viper支持JSON、TOML、YAML、HCL、envfile和Java properties格式的配置文件。</li><li>Viper可以搜索多个路径，但目前单个Viper实例只支持单个配置文件。</li><li>Viper不默认任何配置搜索路径，将默认决策留给应用程序。</li></ol> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token string">"./config.yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 指定配置文件路径</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigName</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span> <span class="token comment">// 配置文件名称(无扩展名)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 如果配置文件的名称中没有扩展名，则需要配置此项</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"/etc/appname/"</span><span class="token punctuation">)</span>   <span class="token comment">// 查找配置文件所在的路径</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"$HOME/.appname"</span><span class="token punctuation">)</span>  <span class="token comment">// 多次调用以添加多个搜索路径</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>               <span class="token comment">// 还可以在工作目录中查找配置</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 查找并读取配置文件</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 处理读取配置文件的错误</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>You can handle the specific case where no config file is found like this:</p> 
<pre><code class="prism language-go"><span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span>ConfigFileNotFoundError<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// Config file not found; ignore error if desired</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// Config file was found but another error was produced</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Config file found and successfully parsed</span>
</code></pre> 
<h3><a id="_320"></a>写入配置文件</h3> 
<p>从配置文件中读取配置文件是有用的，但是有时你想要存储在运行时所做的所有修改。为此，可以使用下面一组命令，每个命令都有自己的用途:</p> 
<ol><li>WriteConfig - 将当前的viper配置写入预定义的路径并覆盖（如果存在的话）。如果没有预定义的路径，则报错。</li><li>SafeWriteConfig - 将当前的viper配置写入预定义的路径。如果没有预定义的路径，则报错。如果存在，将不会覆盖当前的配置文件。</li><li>WriteConfigAs - 将当前的viper配置写入给定的文件路径。将覆盖给定的文件(如果它存在的话)。</li><li>SafeWriteConfigAs - 将当前的viper配置写入给定的文件路径。不会覆盖给定的文件(如果它存在的话)。</li><li>标记为safe的所有方法都不会覆盖任何文件，而是直接创建（如果不存在），而默认行为是创建或截断。</li></ol> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">WriteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 将当前配置写入“viper.AddConfigPath()”和“viper.SetConfigName”设置的预定义路径</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">WriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.config"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.config"</span><span class="token punctuation">)</span> <span class="token comment">// 因为该配置文件写入过，所以会报错</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.other_config"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_336"></a>监控配置文件</h3> 
<p>Viper支持在运行时实时读取配置文件的功能。</p> 
<p>需要重新启动服务器以使配置生效的日子已经一去不复返了，viper驱动的应用程序可以在运行时读取配置文件的更新，而不会错过任何消息。</p> 
<p>只需告诉viper实例watchConfig。可选地，你可以为Viper提供一个回调函数，以便在每次发生更改时运行。</p> 
<pre><code class="prism language-go"><span class="token comment">// 确保在调用WatchConfig()之前添加了所有的配置路径。</span>
viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">OnConfigChange</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e fsnotify<span class="token punctuation">.</span>Event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 配置文件发生变更之后会调用的回调函数</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Config file changed:"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="ioReader_351"></a>从io.Reader读取配置</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 或者 viper.SetConfigType("YAML")</span>

<span class="token comment">// 任何需要将此配置添加到程序中的方法。</span>
<span class="token keyword">var</span> yamlExample <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">`
Hacker: true
name: steve
hobbies:
- skateboarding
- snowboarding
- go
clothing:
  jacket: leather
  trousers: denim
age: 35
eyes : brown
beard: true
`</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">ReadConfig</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>yamlExample<span class="token punctuation">)</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token comment">// 这里会得到 "steve"</span>
</code></pre> 
<h3><a id="_376"></a>覆盖设置</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Verbose"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"LogFile"</span><span class="token punctuation">,</span> LogFile<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_382"></a>注册和使用别名</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">RegisterAlias</span><span class="token punctuation">(</span><span class="token string">"loud"</span><span class="token punctuation">,</span> <span class="token string">"Verbose"</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"verbose"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> 
viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"loud"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">"loud"</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">"verbose"</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> 
<h3><a id="_392"></a>使用环境变量</h3> 
<p>Viper完全支持环境变量。</p> 
<ol><li>AutomaticEnv()</li><li>BindEnv(string…) : error</li><li>SetEnvPrefix(string)</li><li>SetEnvKeyReplacer(string…) *strings.Replacer</li><li>AllowEmptyEnv(bool)</li></ol> 
<p>使用ENV变量时，务必要意识到Viper将ENV变量视为区分大小写。</p> 
<p>Viper提供了一种机制来确保ENV变量是惟一的。通过使用<code>SetEnvPrefix</code>，你可以告诉Viper在读取环境变量时使用前缀。<code>BindEnv</code>和<code>AutomaticEnv</code>都将使用这个前缀。</p> 
<p><code>BindEnv</code>使用一个或两个参数。第一个参数是键名称，第二个是环境变量的名称。环境变量的名称区分大小写。如果没有提供ENV变量名，那么Viper将自动假设ENV变量与以下格式匹配：前缀+ “_” +键名全部大写。当你显式提供ENV变量名（第二个参数）时，它 不会 自动添加前缀。例如，如果第二个参数是“id”，Viper将查找环境变量“ID”。</p> 
<p>在使用ENV变量时，需要注意的一件重要事情是，每次访问该值时都将读取它。Viper在调用BindEnv时不固定该值。</p> 
<p><code>AutomaticEnv</code>是一个强大的助手，尤其是与<code>SetEnvPrefix</code>结合使用时。调用时，Viper会在发出viper.Get请求时随时检查环境变量。它将应用以下规则。它将检查环境变量的名称是否与键匹配（如果设置了EnvPrefix）。</p> 
<p><code>SetEnvKeyReplacer</code>允许你使用<code>strings.Replacer</code>对象在一定程度上重写 Env 键。如果你希望在Get()调用中使用-或者其他什么符号，但是环境变量里使用_分隔符，那么这个功能是非常有用的。可以在viper_test.go中找到它的使用示例。</p> 
<p>或者，你可以使用带有<code>NewWithOptions</code>工厂函数的<code>EnvKeyReplacer</code>。与<code>SetEnvKeyReplacer</code>不同，它接受<code>StringReplacer</code>接口，允许你编写自定义字符串替换逻辑。</p> 
<p>默认情况下，空环境变量被认为是未设置的，并将返回到下一个配置源。若要将空环境变量视为已设置，请使用<code>AllowEmptyEnv</code>方法。</p> 
<pre><code class="prism language-go"><span class="token function">SetEnvPrefix</span><span class="token punctuation">(</span><span class="token string">"spf"</span><span class="token punctuation">)</span> <span class="token comment">// 将自动转为大写</span>
<span class="token function">BindEnv</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span>

os<span class="token punctuation">.</span><span class="token function">Setenv</span><span class="token punctuation">(</span><span class="token string">"SPF_ID"</span><span class="token punctuation">,</span> <span class="token string">"13"</span><span class="token punctuation">)</span> <span class="token comment">// 通常是在应用程序之外完成的</span>

id <span class="token operator">:=</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token comment">// 13</span>
</code></pre> 
<h3><a id="Flags_424"></a>使用Flags</h3> 
<p>Viper 具有绑定到标志的能力。具体来说，Viper支持Cobra库中使用的Pflag。</p> 
<p>与BindEnv类似，该值不是在调用绑定方法时设置的，而是在访问该方法时设置的。这意味着你可以根据需要尽早进行绑定，即使在init()函数中也是如此。</p> 
<p>对于单个标志，BindPFlag()方法提供此功能。</p> 
<pre><code class="prism language-go">serverCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">,</span> <span class="token number">1138</span><span class="token punctuation">,</span> <span class="token string">"Port to run Application server on"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">BindPFlag</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">,</span> serverCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>你还可以绑定一组现有的pflags （pflag.FlagSet）：</p> 
<pre><code class="prism language-go">pflag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">"help message for flagname"</span><span class="token punctuation">)</span>

pflag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">BindPFlags</span><span class="token punctuation">(</span>pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>

i <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">)</span> <span class="token comment">// 从viper而不是从pflag检索值</span>
</code></pre> 
<p>在 Viper 中使用 pflag 并不阻碍其他包中使用标准库中的 flag 包。pflag 包可以通过导入这些 flags 来处理flag包定义的flags。这是通过调用pflag包提供的便利函数AddGoFlagSet()来实现的。</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"flag"</span>
	<span class="token string">"github.com/spf13/pflag"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// 使用标准库 "flag" 包</span>
	flag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">"help message for flagname"</span><span class="token punctuation">)</span>

	pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">AddGoFlagSet</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>
	pflag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	viper<span class="token punctuation">.</span><span class="token function">BindPFlags</span><span class="token punctuation">(</span>pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>

	i <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">"flagname"</span><span class="token punctuation">)</span> <span class="token comment">// 从 viper 检索值</span>

	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="flag_469"></a>flag接口</h4> 
<p>如果你不使用Pflag，Viper 提供了两个Go接口来绑定其他 flag 系统。</p> 
<p>FlagValue表示单个flag。这是一个关于如何实现这个接口的非常简单的例子：</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> myFlag <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">HasChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token string">"my-flag-name"</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">ValueString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token string">"my-flag-value"</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">ValueType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token string">"string"</span> <span class="token punctuation">}</span>
</code></pre> 
<p>一旦你的 flag 实现了这个接口，你可以很方便地告诉Viper绑定它：</p> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">BindFlagValue</span><span class="token punctuation">(</span><span class="token string">"my-flag-name"</span><span class="token punctuation">,</span> myFlag<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>FlagValueSet代表一组 flags 。这是一个关于如何实现这个接口的非常简单的例子:</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> myFlagSet <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	flags <span class="token punctuation">[</span><span class="token punctuation">]</span>myFlag
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlagSet<span class="token punctuation">)</span> <span class="token function">VisitAll</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>FlagValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> flag <span class="token operator">:=</span> <span class="token keyword">range</span> flags <span class="token punctuation">{<!-- --></span>
		<span class="token function">fn</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>一旦你的flag set实现了这个接口，你就可以很方便地告诉Viper绑定它：</p> 
<pre><code class="prism language-go">fSet <span class="token operator">:=</span> myFlagSet<span class="token punctuation">{<!-- --></span>
	flags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>myFlag<span class="token punctuation">{<!-- --></span>myFlag<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> myFlag<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
viper<span class="token punctuation">.</span><span class="token function">BindFlagValues</span><span class="token punctuation">(</span><span class="token string">"my-flags"</span><span class="token punctuation">,</span> fSet<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="KeyValue_506"></a>远程Key/Value存储支持</h3> 
<p>在Viper中启用远程支持，需要在代码中匿名导入viper/remote这个包。</p> 
<p>import _ “github.com/spf13/viper/remote”</p> 
<p>Viper将读取从Key/Value存储（例如etcd或Consul）中的路径检索到的配置字符串（如JSON、TOML、YAML、HCL、envfile和Java properties格式）。这些值的优先级高于默认值，但是会被从磁盘、flag或环境变量检索到的配置值覆盖。（译注：也就是说Viper加载配置值的优先级为：磁盘上的配置文件&gt;命令行标志位&gt;环境变量&gt;远程Key/Value存储&gt;默认值。）</p> 
<p>Viper使用crypt从K/V存储中检索配置，这意味着如果你有正确的gpg密匙，你可以将配置值加密存储并自动解密。加密是可选的。</p> 
<p>你可以将远程配置与本地配置结合使用，也可以独立使用。</p> 
<p>crypt有一个命令行助手，你可以使用它将配置放入K/V存储中。crypt默认使用在http://127.0.0.1:4001的etcd。</p> 
<pre><code class="prism language-go">$ <span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>bketelsen<span class="token operator">/</span>crypt<span class="token operator">/</span>bin<span class="token operator">/</span>crypt
$ crypt set <span class="token operator">-</span>plaintext <span class="token operator">/</span>config<span class="token operator">/</span>hugo<span class="token punctuation">.</span>json <span class="token operator">/</span>Users<span class="token operator">/</span>hugo<span class="token operator">/</span>settings<span class="token operator">/</span>config<span class="token punctuation">.</span>json
</code></pre> 
<p>确认值已经设置：</p> 
<pre><code class="prism language-go">$ crypt get <span class="token operator">-</span>plaintext <span class="token operator">/</span>config<span class="token operator">/</span>hugo<span class="token punctuation">.</span>json
</code></pre> 
<h3><a id="KeyValueetcd_528"></a>远程Key/Value存储示例-未加密（etcd)</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">AddRemoteProvider</span><span class="token punctuation">(</span><span class="token string">"etcd"</span><span class="token punctuation">,</span> <span class="token string">"http://127.0.0.1:4001"</span><span class="token punctuation">,</span><span class="token string">"/config/hugo.json"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token comment">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 "json", "toml", "yaml", "yml", "properties", "props", "prop", "env", "dotenv"</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="KeyValueetcd_534"></a>远程Key/Value存储示例-加密(etcd)</h3> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">AddSecureRemoteProvider</span><span class="token punctuation">(</span><span class="token string">"etcd"</span><span class="token punctuation">,</span><span class="token string">"http://127.0.0.1:4001"</span><span class="token punctuation">,</span><span class="token string">"/config/hugo.json"</span><span class="token punctuation">,</span><span class="token string">"/etc/secrets/mykeyring.gpg"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token comment">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 "json", "toml", "yaml", "yml", "properties", "props", "prop", "env", "dotenv"</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="etcd_541"></a>监控etcd中的更改-未加密</h3> 
<pre><code class="prism language-go"><span class="token comment">// 或者你可以创建一个新的viper实例</span>
<span class="token keyword">var</span> runtime_viper <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

runtime_viper<span class="token punctuation">.</span><span class="token function">AddRemoteProvider</span><span class="token punctuation">(</span><span class="token string">"etcd"</span><span class="token punctuation">,</span> <span class="token string">"http://127.0.0.1:4001"</span><span class="token punctuation">,</span> <span class="token string">"/config/hugo.yml"</span><span class="token punctuation">)</span>
runtime_viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 "json", "toml", "yaml", "yml", "properties", "props", "prop", "env", "dotenv"</span>

<span class="token comment">// 第一次从远程读取配置</span>
err <span class="token operator">:=</span> runtime_viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 反序列化</span>
runtime_viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>runtime_conf<span class="token punctuation">)</span>

<span class="token comment">// 开启一个单独的goroutine一直监控远端的变更</span>
<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
	    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 每次请求后延迟一下</span>

	    <span class="token comment">// 目前只测试了etcd支持</span>
	    err <span class="token operator">:=</span> runtime_viper<span class="token punctuation">.</span><span class="token function">WatchRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	        log<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"unable to read remote config: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	        <span class="token keyword">continue</span>
	    <span class="token punctuation">}</span>

	    <span class="token comment">// 将新配置反序列化到我们运行时的配置结构体中。你还可以借助channel实现一个通知系统更改的信号</span>
	    runtime_viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>runtime_conf<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Viper_573"></a>从Viper获取值</h3> 
<ol><li>Get(key string) : interface{}</li><li>GetBool(key string) : bool</li><li>GetFloat64(key string) : float64</li><li>GetInt(key string) : int</li><li>GetIntSlice(key string) : []int</li><li>GetString(key string) : string</li><li>GetStringMap(key string) : map[string]interface{}</li><li>GetStringMapString(key string) : map[string]string</li><li>GetStringSlice(key string) : []string</li><li>GetTime(key string) : time.Time</li><li>GetDuration(key string) : time.Duration</li><li>IsSet(key string) : bool</li><li>AllSettings() : map[string]interface{}</li></ol> 
<p>需要认识到的一件重要事情是，每一个Get方法在找不到值的时候都会返回零值。为了检查给定的键是否存在，提供了IsSet()方法。</p> 
<pre><code class="prism language-go">viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"logfile"</span><span class="token punctuation">)</span> <span class="token comment">// 不区分大小写的设置和获取</span>
<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">"verbose"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"verbose enabled"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_597"></a>访问嵌套的键</h3> 
<pre><code class="prism language-yaml"><span class="token punctuation">{<!-- --></span>
    <span class="token key atrule">"host"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"address"</span><span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"port"</span><span class="token punctuation">:</span> <span class="token number">5799</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">"datastore"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"metric"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token key atrule">"host"</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token key atrule">"port"</span><span class="token punctuation">:</span> <span class="token number">3099</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"warehouse"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token key atrule">"host"</span><span class="token punctuation">:</span> <span class="token string">"198.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token key atrule">"port"</span><span class="token punctuation">:</span> <span class="token number">2112</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Viper可以通过传入.分隔的路径来访问嵌套字段：</p> 
<pre><code class="prism language-go"><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"datastore.metric.host"</span><span class="token punctuation">)</span> <span class="token comment">// (返回 "127.0.0.1")</span>
</code></pre> 
<p>这遵守上面建立的优先规则；搜索路径将遍历其余配置注册表，直到找到为止。(译注：因为Viper支持从多种配置来源，例如磁盘上的配置文件&gt;命令行标志位&gt;环境变量&gt;远程Key/Value存储&gt;默认值，我们在查找一个配置的时候如果在当前配置源中没找到，就会继续从后续的配置源查找，直到找到为止。)</p> 
<p>例如，在给定此配置文件的情况下，datastore.metric.host和datastore.metric.port均已定义（并且可以被覆盖）。如果另外在默认值中定义了datastore.metric.protocol，Viper也会找到它。</p> 
<p>然而，如果datastore.metric被直接赋值覆盖（被flag，环境变量，set()方法等等…），那么datastore.metric的所有子键都将变为未定义状态，它们被高优先级配置级别“遮蔽”（shadowed）了。</p> 
<p>最后，如果存在与分隔的键路径匹配的键，则返回其值。例如：</p> 
<pre><code class="prism language-go"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"datastore.metric.host"</span><span class="token punctuation">:</span> <span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span>
    <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"address"</span><span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        <span class="token string">"port"</span><span class="token punctuation">:</span> <span class="token number">5799</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"datastore"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"metric"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token string">"port"</span><span class="token punctuation">:</span> <span class="token number">3099</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"warehouse"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"198.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token string">"port"</span><span class="token punctuation">:</span> <span class="token number">2112</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"datastore.metric.host"</span><span class="token punctuation">)</span> <span class="token comment">// 返回 "0.0.0.0"</span>
</code></pre> 
<h3><a id="_652"></a>提取子树</h3> 
<p>从Viper中提取子树。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">app</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache1</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-items</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">item-size</span><span class="token punctuation">:</span> <span class="token number">64</span>
  <span class="token key atrule">cache2</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-items</span><span class="token punctuation">:</span> <span class="token number">200</span>
    <span class="token key atrule">item-size</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> 
<p>执行后：</p> 
<pre><code class="prism language-go">subv <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">"app.cache1"</span><span class="token punctuation">)</span>
</code></pre> 
<p>subv现在就代表：</p> 
<pre><code class="prism language-go">max<span class="token operator">-</span>items<span class="token punctuation">:</span> <span class="token number">100</span>
item<span class="token operator">-</span>size<span class="token punctuation">:</span> <span class="token number">64</span>
</code></pre> 
<h3><a id="_674"></a>反序列化</h3> 
<p>你还可以选择将所有或特定的值解析到结构体、map等。</p> 
<p>有两种方法可以做到这一点：</p> 
<pre><code class="prism language-go"><span class="token function">Unmarshal</span><span class="token punctuation">(</span>rawVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token builtin">error</span>
<span class="token function">UnmarshalKey</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> rawVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token builtin">error</span>
</code></pre> 
<pre><code class="prism language-go"><span class="token keyword">type</span> config <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Port <span class="token builtin">int</span>
	Name <span class="token builtin">string</span>
	PathMap <span class="token builtin">string</span> <span class="token string">`mapstructure:"path_map"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> C config

err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>C<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"unable to decode into struct, %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果你想要解析那些键本身就包含.(默认的键分隔符）的配置，你需要修改分隔符：</p> 
<pre><code class="prism language-go">v <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">NewWithOptions</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">KeyDelimiter</span><span class="token punctuation">(</span><span class="token string">"::"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

v<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"chart::values"</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">"ingress"</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"annotations"</span><span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"traefik.frontend.rule.type"</span><span class="token punctuation">:</span>                 <span class="token string">"PathPrefix"</span><span class="token punctuation">,</span>
            <span class="token string">"traefik.ingress.kubernetes.io/ssl-redirect"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> config <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Chart <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
        Values <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> C config

v<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>C<span class="token punctuation">)</span>
</code></pre> 
<p>Viper还支持解析到嵌入的结构体：</p> 
<pre><code class="prism language-go"><span class="token comment">/*
Example config:

module:
    enabled: true
    token: 89h3f98hbwf987h3f98wenf89ehf
*/</span>
<span class="token keyword">type</span> config <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Module <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
		Enabled <span class="token builtin">bool</span>

		moduleConfig <span class="token string">`mapstructure:",squash"`</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// moduleConfig could be in a module specific package</span>
<span class="token keyword">type</span> moduleConfig <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Token <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> C config

err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>C<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"unable to decode into struct, %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Viper在后台使用github.com/mitchellh/mapstructure来解析值，其默认情况下使用mapstructuretag。</p> 
<p>注意 当需要将viper读取的配置反序列到我们定义的结构体变量中时，一定要使用mapstructuretag！</p> 
<h3><a id="_756"></a>序列化成字符串</h3> 
<p>你可能需要将viper中保存的所有设置序列化到一个字符串中，而不是将它们写入到一个文件中。你可以将自己喜欢的格式的序列化器与AllSettings()返回的配置一起使用。</p> 
<pre><code class="prism language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
    yaml <span class="token string">"gopkg.in/yaml.v2"</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">yamlStringSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    c <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">AllSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    bs<span class="token punctuation">,</span> err <span class="token operator">:=</span> yaml<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"unable to marshal config to YAML: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="viper_774"></a>单例viper</h3> 
<p>Viper是开箱即用的。你不需要配置或初始化即可开始使用Viper。由于大多数应用程序都希望使用单个中央存储库管理它们的配置信息，所以viper包提供了这个功能。它类似于单例模式。</p> 
<p>在上面的所有示例中，它们都以其单例风格的方法演示了如何使用viper。</p> 
<h4><a id="viper_779"></a>使用多个viper实例</h4> 
<p>还可以在应用程序中创建许多不同的viper实例。每个都有自己独特的一组配置和值。每个人都可以从不同的配置文件，key value存储区等读取数据。每个都可以从不同的配置文件、键值存储等中读取。viper包支持的所有功能都被镜像为viper实例的方法。</p> 
<pre><code class="prism language-go">x <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

x<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"ContentDir"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">)</span>
y<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"ContentDir"</span><span class="token punctuation">,</span> <span class="token string">"foobar"</span><span class="token punctuation">)</span>

<span class="token comment">//...</span>
</code></pre> 
<h4><a id="Viper_791"></a>使用Viper示例</h4> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/spf13/viper"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token string">"./conf/config.yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 指定配置文件路径</span>
	err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// 读取配置信息</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>                    <span class="token comment">// 读取配置信息失败</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 监控配置文件变化</span>
	viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 访问/version的返回值会随配置文件的变化而变化</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/version"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>
		fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">":%d"</span><span class="token punctuation">,</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_826"></a>使用结构体变量保存配置信息</h4> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/fsnotify/fsnotify"</span>

	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/spf13/viper"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Port    <span class="token builtin">int</span>    <span class="token string">`mapstructure:"port"`</span>
	Version <span class="token builtin">string</span> <span class="token string">`mapstructure:"version"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> Conf <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token string">"./conf/config.yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 指定配置文件路径</span>
	err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment">// 读取配置信息</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>                           <span class="token comment">// 读取配置信息失败</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 将读取的配置信息保存至全局变量Conf</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>Conf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"unmarshal conf failed, err:%s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 监控配置文件变化</span>
	viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 注意！！！配置文件发生变化后要同步到全局变量Conf</span>
	viper<span class="token punctuation">.</span><span class="token function">OnConfigChange</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>in fsnotify<span class="token punctuation">.</span>Event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"夭寿啦~配置文件被人修改啦..."</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>Conf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"unmarshal conf failed, err:%s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 访问/version的返回值会随配置文件的变化而变化</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/version"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> Conf<span class="token punctuation">.</span>Version<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">":%d"</span><span class="token punctuation">,</span> Conf<span class="token punctuation">.</span>Port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a5016b99faa7e0b1f357a1fec833f55/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">doris和starrocks的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d2a417b97f43dff962511bed83d7230/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">three.js学习笔记（一）：THREE.Materail五种基础材质的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>