<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FATE使用手册 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FATE使用手册" />
<meta property="og:description" content="FATE简介 FATE（Federated AI Technology Enabler）是微众银行AI部门发起的一个开源项目，旨在提供一个安全的计算框架来支持联邦AI生态系统。它实现了基于同态加密和多方计算（MPC）的安全计算协议。它支持联邦学习架构和各种机器学习算法的安全计算，包括逻辑回归、基于树的算法、深度学习和迁移学习。
FATE技术框架 FederatedML ​ 算法功能组件，包括常见机器学习算法联邦化实现。所有模块均采用模块化的解耦的方式进行开发，从而增强可扩展性。
FATE_Flow ​ FATE-Flow是联邦学习框架FATE的作业调度系统，实现联邦学习作业生命周期的完整管理，其中包括数据输入、训练作业调度、指标追踪、模型中心等功能。
FATE-Board ​ 联邦学习建模的可视化工具，为终端用户可视化和度量模型训练的全过程。支持对模型训练过程全流程的跟踪、统计和监控等，并为模型运行状态、模型输出、日志追踪等提供了丰富的可视化呈现，帮助用户简单而高效地深入探索模型与理解模型。
FATE-Serving ​ 高性能可扩展的联邦学习在线模型服务。
角色 Guest ​ Guest表示数据应用方，在纵向算法中，Guest往往是有标签y的一方。一般是由Guest发起建模流程。
Host ​ Host是数据提供方。
arbiter ​ arbiter是用来辅助多方完成联合建模的，主要的作用是用来聚合梯度或者模型,比如纵向lr里面,各方将自己一半的梯度发送给arbiter，然后arbiter再联合优化等等,arbiter还参与以及分发公私钥，进行加解密服务等等。
FATE环境部署指南 单机部署 参考：https://fate.readthedocs.io/en/latest/_build_temp/standalone-deploy/README.html#install-fate-using-docker-recommended，包括使用 Docker 安装 FATE*(推荐)*和在主机中安装 FATE
集群部署 参考：https://fate.readthedocs.io/en/latest/_build_temp/cluster-deploy/README.html
主机进入到docker FATE镜像命令 主机ip:192.168.1.75
FATE版本为1.6.0，主机执行以下命令
CONTAINER_ID=`docker ps -aqf &#34;name=fate&#34;` docker exec -t -i ${CONTAINER_ID} bash 快速启动 FATE 的一般指南 参考：https://fate.readthedocs.io/en/latest/_build_temp/examples/pipeline/README.html
由于FATE已经启动，以下命令不需要执行
（可选）创建虚拟环境
python -m venv venv source venv/bin/activate pip install -U pip 安装FATE客户端
pip install fate_client pipeline init --help 提供部署的 FATE-Flow 的服务器 ip/port 信息" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/2367d44846979f20869fc8ef724331c8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-19T14:29:33+08:00" />
<meta property="article:modified_time" content="2021-09-19T14:29:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FATE使用手册</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="FATE_0"></a>FATE简介</h3> 
<p>FATE（Federated AI Technology Enabler）是微众银行AI部门发起的一个开源项目，旨在提供一个安全的计算框架来支持联邦AI生态系统。它实现了基于同态加密和多方计算（MPC）的安全计算协议。它支持联邦学习架构和各种机器学习算法的安全计算，包括逻辑回归、基于树的算法、深度学习和迁移学习。</p> 
<h3><a id="FATE_3"></a>FATE技术框架</h3> 
<h5><a id="FederatedML_5"></a>FederatedML</h5> 
<p>​ 算法功能组件，包括常见机器学习算法联邦化实现。所有模块均采用模块化的解耦的方式进行开发，从而增强可扩展性。</p> 
<h5><a id="FATE_Flow_9"></a>FATE_Flow</h5> 
<p>​ FATE-Flow是联邦学习框架FATE的作业调度系统，实现联邦学习作业生命周期的完整管理，其中包括数据输入、训练作业调度、指标追踪、模型中心等功能。</p> 
<h5><a id="FATEBoard_13"></a>FATE-Board</h5> 
<p>​ 联邦学习建模的可视化工具，为终端用户可视化和度量模型训练的全过程。支持对模型训练过程全流程的跟踪、统计和监控等，并为模型运行状态、模型输出、日志追踪等提供了丰富的可视化呈现，帮助用户简单而高效地深入探索模型与理解模型。</p> 
<h5><a id="FATEServing_17"></a>FATE-Serving</h5> 
<p>​ 高性能可扩展的联邦学习在线模型服务。</p> 
<h3><a id="_21"></a>角色</h3> 
<h5><a id="Guest_23"></a>Guest</h5> 
<p>​ Guest表示数据应用方，在纵向算法中，Guest往往是有标签y的一方。一般是由Guest发起建模流程。</p> 
<h5><a id="Host_27"></a>Host</h5> 
<p>​ Host是数据提供方。</p> 
<h5><a id="arbiter_31"></a>arbiter</h5> 
<p>​ arbiter是用来辅助多方完成联合建模的，主要的作用是用来聚合梯度或者模型,比如纵向lr里面,各方将自己一半的梯度发送给arbiter，然后arbiter再联合优化等等,arbiter还参与以及分发公私钥，进行加解密服务等等。</p> 
<h3><a id="FATE_35"></a>FATE环境部署指南</h3> 
<h4><a id="_37"></a>单机部署</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/standalone-deploy/README.html#install-fate-using-docker-recommended，包括<a href="https://fate.readthedocs.io/en/latest/_build_temp/standalone-deploy/README.html#install-fate-using-docker-recommended" rel="nofollow">使用 Docker 安装 FATE*(推荐)*</a>和<a href="https://fate.readthedocs.io/en/latest/_build_temp/standalone-deploy/README.html#install-fate-in-host" rel="nofollow">在主机中安装 FATE</a></p> 
<h4><a id="_41"></a>集群部署</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/cluster-deploy/README.html</p> 
<h4><a id="docker_FATE_45"></a>主机进入到docker FATE镜像命令</h4> 
<p>主机ip:192.168.1.75</p> 
<p>FATE版本为1.6.0，主机执行以下命令</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">CONTAINER_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>docker <span class="token function">ps</span> -aqf <span class="token string">"name=fate"</span><span class="token variable">`</span></span>
docker <span class="token builtin class-name">exec</span> -t -i <span class="token variable">${CONTAINER_ID}</span> <span class="token function">bash</span>
</code></pre> 
<h4><a id="_FATE__56"></a>快速启动 FATE 的一般指南</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/examples/pipeline/README.html</p> 
<p><strong>由于FATE已经启动，以下命令不需要执行</strong></p> 
<ol><li> <p>（可选）创建虚拟环境</p> <pre><code>python -m venv venv
source venv/bin/activate
pip install -U pip
</code></pre> </li><li> <p>安装FATE客户端</p> <pre><code>pip install fate_client
pipeline init --help
</code></pre> </li><li> <p>提供部署的 FATE-Flow 的服务器 ip/port 信息</p> <pre><code># fate-flow server初始化 pipeline的ip和端口. 默认 ip：port 是127.0.0.1:8080.
pipeline init --ip 127.0.0.1 --port 9380
# 可选，设置Pipeline目录
pipeline init --ip 127.0.0.1 --port 9380 --log-directory {desired log path}
</code></pre> </li><li> <p>使用 FATE-Pipeline 上传数据</p> <p>在开始建模任务之前，应上传要使用的数据。通常，一方通常是包含多个节点的集群。因此，当我们上传这些数据时，数据将分配给这些节点。</p> <p>参考此文档测试用例1内容。</p> </li></ol> 
<h3><a id="FATE_92"></a>FATE使用预备知识</h3> 
<h4><a id="_94"></a>上传数据指南</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/upload_data_guide_zh.html</p> 
<h5><a id="_98"></a>接受的数据类型</h5> 
<p>Dense、svm-light、tag、tag:value</p> 
<h5><a id="_102"></a>定义上传数据配置文件</h5> 
<pre><code>{
  "file": "examples/data/breast_hetero_guest.csv",
  "table_name": "hetero_breast_guest",
  "namespace": "experiment",
  "head": 1,
  "partition": 8,
  "work_mode": 0,
  "backend": 0
}
</code></pre> 
<p>字段说明：</p> 
<ol><li> <p>file: 文件路径</p> </li><li> <p>table_name&amp;namespace: 存储数据表的标识符号</p> </li><li> <p>head: 指定数据文件是否包含表头</p> </li><li> <p>partition: 指定用于存储数据的分区数</p> </li><li> <p>work_mode: 指定工作模式，0代表单机版，1代表集群版</p> </li><li> <p>backend: 指定后端，0代表EGGROLL， 1代表SPARK加RabbitMQ， 2代表SPARK加Pulsar</p> </li></ol> 
<h5><a id="_126"></a>上传命令</h5> 
<p><strong>每个提供数据的集群（即guest和host）都需执行此步骤</strong></p> 
<p>1.使用fate-flow上传数据：</p> 
<pre><code class="prism language-bash">flow data upload -c dsl_test/upload_data.json
</code></pre> 
<p>upload_data.json内容：</p> 
<pre><code>{
    "file": "examples/data/breast_hetero_guest.csv",
    "head": 1,
    "partition": 16,
    "work_mode": 0,
    "table_name": "breast_hetero_guest",
    "namespace": "experiment"
}
</code></pre> 
<p>2.使用旧版python脚本上传数据：</p> 
<pre><code class="prism language-python">python <span class="token operator">/</span>fate<span class="token operator">/</span>python<span class="token operator">/</span>fate_flow<span class="token operator">/</span>fate_flow_client<span class="token punctuation">.</span>py <span class="token operator">-</span>f upload <span class="token operator">-</span>c <span class="token operator">/</span>fate<span class="token operator">/</span>examples<span class="token operator">/</span>dsl<span class="token operator">/</span>v1<span class="token operator">/</span>upload_data<span class="token punctuation">.</span>json
</code></pre> 
<p>3.使用python脚本上传数据：参考测试用例1</p> 
<h4><a id="DSL__Task_Submit_Runtime_Conf_SettingV2_157"></a>任务配置与运行配置（DSL &amp; Task Submit Runtime Conf Setting）V2</h4> 
<p>​ 为了让任务模型的构建更加灵活，目前 FATE 使用了一套自定的领域特定语言 (DSL) 来描述任务。在 DSL 中，各种模块（例如数据读写 data_io，特征工程 feature-engineering， 回归 regression，分类 classification）可以通向一个有向无环图 （DAG） 组织起来。通过各种方式，用户可以根据自身的需要，<strong>灵活地组合各种算法模块。</strong></p> 
<p>​ 除此之外，每个模块都有不同的参数需要配置，不同的 party 对于同一个模块的参数也可能有所区别。为了简化这种情况，对于每一个模块，FATE 会将<strong>所有 party 的不同参数保存到同一个运行配置文件</strong>（Submit Runtime Conf）中，并且所有的 party 都将共用这个配置文件。这个指南将会告诉你如何创建一个 DSL 配置文件。</p> 
<p>V2配置参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html</p> 
<h5><a id="DSL_165"></a>DSL配置说明</h5> 
<h6><a id="1_167"></a>1.概述</h6> 
<p>​ DSL 的配置文件采用 json 格式，实际上，整个配置文件就是一个 json 对象 （dict）。</p> 
<h6><a id="2Components_171"></a>2.Components</h6> 
<p>​ 在这个 dict 的第一级是 “components”，用来表示这个任务将会使用到的各个模块，每个独立的模块定义在 “components” 之下，<strong>所有数据需要通过Reader模块从数据存储拿取数据</strong>，注意Reader模块仅有输出<code>output</code></p> 
<h6><a id="3module_175"></a>3.module</h6> 
<p>​ 用来指定使用的模块。模块名参考FATE ML算法列表（https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html），与/fate/python/federatedml/conf/setting_conf 下各个模块的文件名保持一致（不包括 .json 后缀）。</p> 
<h6><a id="4input_179"></a>4.input</h6> 
<p>​ 分为两种输入类型，分别是 Data和 Model。</p> 
<h6><a id="Data_183"></a>Data输入</h6> 
<p>分为三种输入类型：</p> 
<blockquote> 
 <ol><li>data: 一般被用于 data_io 模块, feature_engineering 模块或者 evaluation 模块</li><li>train_data: 一般被用于 homo_lr, hetero_lr 和 secure_boost 模块。如果出现了 train_data 字段，那么这个任务将会被识别为一个 fit 任务</li><li>validate_data： 如果存在 train_data 字段，那么该字段是可选的。如果选择保留该字段，则指向的数据将会作为 validation set</li><li>test_data: 用作预测数据，如提供，需同时提供model输入。</li></ol> 
</blockquote> 
<h6><a id="Model_192"></a>Model输入</h6> 
<p>分为两种输入类型</p> 
<p>​ 1.model: 用于同种类型组件的模型输入。</p> 
<p>​ 2.isometric_model: 用于指定继承上游组件的模型输入</p> 
<h6><a id="5output_202"></a>5.output</h6> 
<h6><a id="_204"></a>数据输出</h6> 
<p>分为四种输出类型：</p> 
<ol><li>data: 常规模块数据输出</li><li>train_data: 仅用于Data Split</li><li>validate_data: 仅用于Data Split</li><li>test_data： 仅用于Data Split</li></ol> 
<h6><a id="_213"></a>模型输出</h6> 
<p>仅使用model</p> 
<h6><a id="DSL_219"></a>DSL配置示例</h6> 
<p>训练模式，用户可以使用其他算法模块替代HeteroSecureBoost，注意模块名hetero_secureboost_0也要一起更改</p> 
<pre><code class="prism language-python"> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"components"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"reader_0"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"Reader"</span><span class="token punctuation">,</span>
            <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"data"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"dataio_0"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"DataIO"</span><span class="token punctuation">,</span>
            <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"reader_0.data"</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"data"</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"model"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"model"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"intersection_0"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"Intersection"</span><span class="token punctuation">,</span>
            <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"dataio_0.data"</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"data"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"hetero_secureboost_0"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"HeteroSecureBoost"</span><span class="token punctuation">,</span>
            <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"train_data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"intersection_0.data"</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"data"</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"model"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"model"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"evaluation_0"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"Evaluation"</span><span class="token punctuation">,</span>
            <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"hetero_secureboost_0.data"</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"data"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Submit_Runtime_Conf_304"></a>创建配置文件Submit Runtime Conf</h4> 
<p>针对1.5.x版本新格式，<strong>Job Runtime Conf用于设置各个参与方的信息, 作业的参数及各个组件的参数。</strong> 内容包括如下</p> 
<h6><a id="1_DSL_308"></a>1. DSL版本</h6> 
<p>配置版本，默认不配置为1，建议配置为2</p> 
<pre><code class="prism language-json"><span class="token string">"dsl_version"</span><span class="token operator">:</span> <span class="token string">"2"</span>
</code></pre> 
<h6><a id="2_Job_Participants_316"></a>2. Job Participants（作业参与方）</h6> 
<p>用户需要定义 initiator。</p> 
<p>1.发起方,包括：任务发起方的role和party_id,例如：</p> 
<pre><code class="prism language-json"><span class="token string">"initiator"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"role"</span><span class="token operator">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span>
    <span class="token string">"party_id"</span><span class="token operator">:</span> <span class="token number">9999</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2.所有参与方：包含各参与方信息， 在 role 字段中，每一个元素代表一种角色以及承担这个角色的 party_id。每个角色的 party_id 以列表形式存在，因为一个任务可能涉及到多个 party 担任同一种角色。例如：</p> 
<pre><code class="prism language-json"><span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">9999</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"host"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"arbiter"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3algorithm_parameters_339"></a>3.algorithm_parameters（系统运行参数）</h6> 
<p>配置作业运行时的主要系统参数</p> 
<h6><a id="_343"></a>参数应用范围策略设置</h6> 
<ul><li> <p>应用于所有参与方，使用common范围标识符</p> </li><li> <p>仅应用于某参与方，使用role范围标识符，使用role:party_index定位被指定的参与方，直接指定的参数优先级高于common参数</p> <pre><code class="prism language-json"><span class="token string">"common"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<p>其中common下的参数应用于所有参与方，role-guest-0配置下的参数应用于guest角色0号下标的参与方 .注意，当前版本系统运行参数未对仅应用于某参与方做严格测试，建议<strong>优先选用common</strong></p> 
<h6><a id="_365"></a>支持的系统参数</h6> 
<table><thead><tr><th align="center">配置项</th><th>默认值</th><th>支持值</th><th>说明</th></tr></thead><tbody><tr><td align="center">job_type</td><td>train</td><td>train, predict</td><td>任务类型</td></tr><tr><td align="center">work_mode</td><td>0</td><td>0, 1</td><td>0代表单方单机版，1代表多方分布式版本</td></tr><tr><td align="center">backend</td><td>0</td><td>0, 1, 2</td><td>0代表EGGROLL，1代表SPARK加RabbitMQ，2代表SPARK加Pulsar</td></tr><tr><td align="center">model_id</td><td>-</td><td>-</td><td>模型id，预测任务需要填入</td></tr><tr><td align="center">model_version</td><td>-</td><td>-</td><td>模型version，预测任务需要填入</td></tr><tr><td align="center">task_cores</td><td>4</td><td>正整数</td><td>作业申请的总cpu核数</td></tr><tr><td align="center">task_parallelism</td><td>1</td><td>正整数</td><td>task并行度</td></tr><tr><td align="center">computing_partitions</td><td>task所分配到的cpu核数</td><td>正整数</td><td>计算时数据表的分区数</td></tr><tr><td align="center">eggroll_run</td><td>无</td><td>processors_per_node等</td><td>eggroll计算引擎相关配置参数，一般无须配置，由task_cores自动计算得到，若配置则task_cores参数不生效</td></tr><tr><td align="center">spark_run</td><td>无</td><td>num-executors, executor-cores等</td><td>spark计算引擎相关配置参数，一般无须配置，由task_cores自动计算得到，若配置则task_cores参数不生效</td></tr><tr><td align="center">rabbitmq_run</td><td>无</td><td>queue, exchange等</td><td>rabbitmq创建queue、exchange的相关配置参数，一般无须配置，采取系统默认值</td></tr><tr><td align="center">pulsar_run</td><td>无</td><td>producer, consumer等</td><td>pulsar创建producer和consumer时候的相关配置，一般无需配置。</td></tr><tr><td align="center">federated_status_collect_type</td><td>PUSH</td><td>PUSH, PULL</td><td>多方运行状态收集模式，PUSH表示每个参与方主动上报到发起方，PULL表示发起方定期向各个参与方拉取</td></tr><tr><td align="center">timeout</td><td>259200 (3天)</td><td>正整数</td><td>任务超时时间,单位秒</td></tr></tbody></table> 
<ol><li>三大类引擎具有一定的支持依赖关系，例如Spark计算引擎当前仅支持使用HDFS作为中间数据存储引擎</li><li>work_mode + backend会自动依据支持依赖关系，产生对应的三大引擎配置computing、storage、federation</li><li>开发者可自行实现适配的引擎，并在runtime config配置引擎</li></ol> 
<h6><a id="_390"></a>未开放的参数</h6> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html#id17</p> 
<h6><a id="_394"></a>参考配置</h6> 
<p>共有四种</p> 
<ol><li> <p>使用eggroll作为backend，采取默认cpu分配计算策略时的配置</p> </li><li> <p>使用eggroll作为backend，采取直接指定cpu等参数时的配置</p> </li><li> <p>使用spark加rabbitMQ作为backend，采取直接指定cpu等参数时的配置</p> <pre><code class="prism language-json"><span class="token string">"job_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"common"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"job_type"</span><span class="token operator">:</span> <span class="token string">"train"</span><span class="token punctuation">,</span>
    <span class="token string">"work_mode"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"backend"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"spark_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"num-executors"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token string">"executor-cores"</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"task_parallelism"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">"computing_partitions"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token string">"timeout"</span><span class="token operator">:</span> <span class="token number">36000</span><span class="token punctuation">,</span>
    <span class="token string">"rabbitmq_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"queue"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"durable"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"connection"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"heartbeat"</span><span class="token operator">:</span> <span class="token number">10000</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>使用spark加pulsar作为backend</p> </li></ol> 
<p>详情，参考https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html</p> 
<h6><a id="_433"></a>资源管理详细说明</h6> 
<p>​ 1.5.0版本开始，为了进一步管理资源，fateflow启用更细粒度的cpu cores管理策略，去除早前版本直接通过限制同时运行作业个数的策略。</p> 
<p>包括：总资源配置、运行资源计算、资源调度，详情参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html#id19</p> 
<h6><a id="4__441"></a>4. 组件运行参数</h6> 
<p>详情参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html#id23</p> 
<h6><a id="_445"></a>参数应用范围策略设置</h6> 
<ul><li>应用于所有参与方，使用common范围标识符</li><li>仅应用于某参与方，使用role范围标识符，使用role:party_index定位被指定的参与方，直接指定的参数优先级高于common参数</li></ul> 
<pre><code class="prism language-json"><span class="token string">"commom"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中common配置下的参数应用于所有参与方，role-guest-0配置下的参数表示应用于guest角色0号下标的参与方 注意，当前版本组件运行参数已支持两种应用范围策略</p> 
<h6><a id="_464"></a>参考配置</h6> 
<ul><li><code>intersection_0</code>与<code>hetero_lr_0</code>两个组件的运行参数，放在common范围下，应用于所有参与方</li><li>对于<code>reader_0</code>与<code>dataio_0</code>两个组件的运行参数，依据不同的参与方进行特定配置，这是因为通常不同参与方的输入参数并不一致，所有通常这两个组件一般按参与方设置</li></ul> 
<p>上述组件名称是在DSL配置文件中定义</p> 
<pre><code class="prism language-json"><span class="token string">"component_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">"common"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"intersection_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"intersect_method"</span><span class="token operator">:</span> <span class="token string">"raw"</span><span class="token punctuation">,</span>
      <span class="token string">"sync_intersect_ids"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string">"only_output_key"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"hetero_lr_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"penalty"</span><span class="token operator">:</span> <span class="token string">"L2"</span><span class="token punctuation">,</span>
      <span class="token string">"optimizer"</span><span class="token operator">:</span> <span class="token string">"rmsprop"</span><span class="token punctuation">,</span>
      <span class="token string">"alpha"</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
      <span class="token string">"max_iter"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token string">"batch_size"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
      <span class="token string">"learning_rate"</span><span class="token operator">:</span> <span class="token number">0.15</span><span class="token punctuation">,</span>
      <span class="token string">"init_param"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"init_method"</span><span class="token operator">:</span> <span class="token string">"random_uniform"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"reader_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"table"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token operator">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"dataio_0"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
          <span class="token string">"with_label"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"label_name"</span><span class="token operator">:</span> <span class="token string">"y"</span><span class="token punctuation">,</span>
          <span class="token string">"label_type"</span><span class="token operator">:</span> <span class="token string">"int"</span><span class="token punctuation">,</span>
          <span class="token string">"output_format"</span><span class="token operator">:</span> <span class="token string">"dense"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"host"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"reader_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"table"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token operator">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"dataio_0"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
          <span class="token string">"with_label"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token string">"output_format"</span><span class="token operator">:</span> <span class="token string">"dense"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Host__522"></a>多Host 配置</h6> 
<p>包括多Host任务应在role下列举所有host信息、各host不同的配置应在各自对应模块下分别列举，详情参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/dsl_conf_v2_setting_guide_zh.html#host</p> 
<h6><a id="_526"></a>预测任务配置</h6> 
<p><strong>DSL V2不会自动为训练任务生成预测dsl</strong>。 用户需要首先使用<code>Flow Client</code>部署所需模型中模块。 详细命令说明请参考<code>FATE-Flow document &lt;/fate/python/fate_client/flow_client/README_zh.rst 的deploy模块&gt;</code></p> 
<p>命令如下：</p> 
<pre><code class="prism language-bash">flow model deploy 
--model-id <span class="token variable">$model_id</span> <span class="token comment">#模型ID 必填</span>
--model-version <span class="token variable">$model_version</span> <span class="token comment">#模型版本 必填</span>
<span class="token comment"># --cpn-list ... 组件列表，非必要参数</span>
</code></pre> 
<h6><a id="5FATEFLOWjob_541"></a>5.FATE-FLOW运行job基本原理</h6> 
<ol><li>提交作业后，fateflow获取job dsl与job config，存于数据库<code>t_job</code>表对应字段以及/fate/jobs/$jobid/目录,</li><li>解析job dsl与job config，依据合并参数生成细粒度参数(如上述所说的backend&amp;work_mode对应会生成三个引擎参数), 以及处理参数默认值</li><li>将共同配置分发到各参与方并存储，依据参与方的实际信息，生成<strong>job_runtime_on_party_conf</strong></li><li>每个参与方接收到任务时，均依据<strong>job_runtime_on_party_conf</strong>执行</li></ol> 
<p>$jobid目录包括文件：</p> 
<pre><code>job_dsl.json  job_runtime_conf.json  local  pipeline_dsl.json  train_runtime_conf.json
</code></pre> 
<h5><a id="Submit_Runtime_Conf_556"></a>Submit Runtime Conf配置示例</h5> 
<p>训练、验证模型 dsl样例</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"dsl_version"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">"initiator"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"role"</span><span class="token operator">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span>
        <span class="token string">"party_id"</span><span class="token operator">:</span> <span class="token number">9999</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"host"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token number">10000</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token number">9999</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"job_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"job_type"</span><span class="token operator">:</span> <span class="token string">"train"</span><span class="token punctuation">,</span>
        <span class="token string">"work_mode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"backend"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"computing_engine"</span><span class="token operator">:</span> <span class="token string">"STANDALONE"</span><span class="token punctuation">,</span>
        <span class="token string">"federation_engine"</span><span class="token operator">:</span> <span class="token string">"STANDALONE"</span><span class="token punctuation">,</span>
        <span class="token string">"storage_engine"</span><span class="token operator">:</span> <span class="token string">"STANDALONE"</span><span class="token punctuation">,</span>
        <span class="token string">"engines_address"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"computing"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"nodes"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"cores_per_node"</span><span class="token operator">:</span> <span class="token number">20</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"federation"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"nodes"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"cores_per_node"</span><span class="token operator">:</span> <span class="token number">20</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"storage"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"nodes"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"cores_per_node"</span><span class="token operator">:</span> <span class="token number">20</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"federated_mode"</span><span class="token operator">:</span> <span class="token string">"SINGLE"</span><span class="token punctuation">,</span>
        <span class="token string">"task_parallelism"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"computing_partitions"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">"federated_status_collect_type"</span><span class="token operator">:</span> <span class="token string">"PULL"</span><span class="token punctuation">,</span>
        <span class="token string">"model_id"</span><span class="token operator">:</span> <span class="token string">"guest-9999#host-10000#model"</span><span class="token punctuation">,</span>
        <span class="token string">"model_version"</span><span class="token operator">:</span> <span class="token string">"202108310831349550536"</span><span class="token punctuation">,</span>
        <span class="token string">"eggroll_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"eggroll.session.processors.per.node"</span><span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"spark_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"rabbitmq_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"pulsar_run"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"adaptation_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"task_nodes"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">"task_cores_per_node"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string">"task_memory_per_node"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"request_task_cores"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token string">"if_initiator_baseline"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"component_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"role"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"guest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"reader_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"table"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span>
                            <span class="token string">"namespace"</span><span class="token operator">:</span> <span class="token string">"experiment"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"host"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"reader_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"table"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span>
                            <span class="token string">"namespace"</span><span class="token operator">:</span> <span class="token string">"experiment"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">"dataio_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"with_label"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"common"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"dataio_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"with_label"</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"hetero_secureboost_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"task_type"</span><span class="token operator">:</span> <span class="token string">"classification"</span><span class="token punctuation">,</span>
                <span class="token string">"objective_param"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"objective"</span><span class="token operator">:</span> <span class="token string">"cross_entropy"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"num_trees"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token string">"bin_num"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                <span class="token string">"encrypt_param"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"method"</span><span class="token operator">:</span> <span class="token string">"iterativeAffine"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"tree_param"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"max_depth"</span><span class="token operator">:</span> <span class="token number">3</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"evaluation_0"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"eval_type"</span><span class="token operator">:</span> <span class="token string">"binary"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_670"></a>算法</h3> 
<h4><a id="FATE_ML_672"></a>FATE ML</h4> 
<p>FATE目前支持三种类型联邦学习算法：横向联邦学习、纵向联邦学习以及迁移学习。</p> 
<ul><li> <p>横向联邦学习:在两个数据集的用户特征重叠较多而用户重叠较少的情况下</p> </li><li> <p>纵向联邦学习:在两个数据集的用户重叠较多而用户特征重叠较少的情况下</p> </li><li> <p>联邦迁移学习:在两个数据集的用户与用户特征重叠都较少的情况下，不对数据进行切分，而可以利用迁移学习来克服数据或标签不足的情况</p> </li></ul> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html</p> 
<p>FederatedML 在联邦学习上实现许多常见的机器学习算法。所有模块均采用解耦模块化方法开发，以增强可扩展性。FederatedML 提供：</p> 
<ol><li>联合统计：PSI、Union（并集计算）、Pearson Correlation（皮尔逊系数） 等。</li><li>联合特征工程：包括联邦采样，联邦特征分箱，联邦特征选择等。</li><li>联合机器学习算法：包括横向和纵向的联邦LR, GBDT， DNN，迁移学习等。</li><li>模型评估：提供对二分类，多分类，回归评估，聚类评估，联邦和单边对比评估。</li><li>安全协议：提供了多种安全协议，以进行更安全的多方交互计算。</li></ol> 
<p>联邦机器学习框架：参考https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html#id4</p> 
<h5><a id="_696"></a>算法清单</h5> 
<p>测试用例会用到的算法列表：</p> 
<table><thead><tr><th>算法</th><th>模块名</th><th>描述</th><th>数据输入</th><th>数据输出</th><th>模型输入</th><th>模型输出</th></tr></thead><tbody><tr><td>Reader</td><td>Reader</td><td>当输入数据的存储引擎当前计算引擎不支持时，会自动转存到FATE集群适配计算引擎的组件输出存储引擎；当输入数据的存储格式非FATE支持存储格式时，会自动转换格式，并存储到FATE集群的组件输出存储引擎</td><td>用户原始存储数据</td><td>转换后原始数据</td><td></td><td></td></tr><tr><td><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/util/README.html" rel="nofollow">DataIO</a></td><td>DataIO</td><td>该组件将原始数据转换为Instance对象(FATE-v1.7后会逐步弃用，使用DataTransform)。</td><td>Table，值为原始数据</td><td>转换后的数据表，值为在 : federatedml/feature/instance.py 中定义的Data Instance的实例</td><td></td><td>DataIO模型</td></tr><tr><td><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html#id6" rel="nofollow"><code>DataTransform</code>_</a></td><td>DataTransform</td><td>该组件将原始数据转换为Instance对象。</td><td>Table，值为原始数据</td><td>转换后的数据表，值为在 : federatedml/feature/instance.py 中定义的Data Instance的实例</td><td></td><td>DataTransform模型</td></tr><tr><td><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/statistic/intersect/README.html" rel="nofollow">Intersect</a></td><td>Intersection</td><td>计算两方的相交数据集，而不会泄漏任何差异数据集的信息。主要用于纵向任务。</td><td>Table</td><td>两方Table中相交的部分</td><td></td><td>Intersect模型</td></tr><tr><td><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/ensemble/README.html" rel="nofollow">Hetero Secure Boosting</a></td><td>HeteroSecureBoost</td><td>通过多方构建纵向Secure Boost模块。</td><td>Table，值为Instance</td><td></td><td></td><td>SecureBoost模型，由模型本身和模型参数组成</td></tr></tbody></table> 
<p>详细算法清单见：https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html#id2</p> 
<h5><a id="_712"></a>安全协议</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html#id3</p> 
<h5><a id="_716"></a>参数</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README_zh.html#module-federatedml.param</p> 
<h3><a id="_720"></a>示例</h3> 
<p>详情见：https://fate.readthedocs.io/en/latest/_build_temp/examples/README.html</p> 
<h4><a id="_724"></a>示例使用指南</h4> 
<p>即本文档的测试用例2，3</p> 
<h3><a id="FATEFLOW_730"></a>FATE-FLOW</h3> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/README_zh.html</p> 
<p>FATE-Flow是联邦学习框架FATE的作业调度系统，实现联邦学习作业生命周期的完整管理，其中包括数据输入、训练作业调度、指标追踪、模型中心等功能.</p> 
<h4><a id="FATEFlow_736"></a>FATE-Flow关键点</h4> 
<ul><li>使用DAG定义Pipeline；</li><li>使用 JSON 格式的 FATE-DSL 描述DAG, 支持系统自动化对接；</li><li>先进的调度框架，基于全局状态和乐观锁调度，单方DAG调度，多方协调调度，并支持多调度器</li><li>灵活的调度策略，支持启动/停止/重跑等</li><li>细粒度的资源调度能力，依据不同计算引擎支持核数、内存、工作节点策略</li><li>实时追踪器，运行期间实时跟踪数据, 参数, 模型和指标</li><li>联邦模型中心, 模型管理、联邦一致性、导入导出、集群间迁移</li><li>提供CLI、HTTP API、Python SDK</li></ul> 
<h4><a id="_749"></a>架构</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/README_zh.html#id3</p> 
<h4><a id="_753"></a>部署</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/README_zh.html#id4</p> 
<h4><a id="_757"></a>用法</h4> 
<h5><a id="FATEFlow_Client_759"></a>FATE-Flow Client命令行</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/flow_client/README_zh.html</p> 
<p>在新版的FATE Flow命令行控制台中，将命令拆分成了多个类，包括 <em>job</em>, <em>data</em>, <em>model</em>, <em>component</em> 等等。所有的命令将有一个共有调用入口</p> 
<pre><code>[IN]
flow

[OUT]
Usage: flow [OPTIONS] COMMAND [ARGS]...

  Fate Flow Client

Options:
  -h, --help  Show this message and exit.

Commands:
  component   Component Operations
  data        Data Operations
  job         Job Operations
  model       Model Operations
  queue       Queue Operations
  table       Table Operations
  task        Task Operations
</code></pre> 
<p>FATE-Flow 命令行接口参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/doc/fate_flow_cli.html</p> 
<pre><code class="prism language-bash">python fate_flow_client.py -f <span class="token variable">$command</span>
<span class="token comment"># </span>
<span class="token comment">#cd /fate/python/fate_flow/</span>
<span class="token comment">#python fate_flow_client.py -f submit_job -c /fate/python/fate_flow/examples/test_hetero_lr_job_conf.json -d /fate/python/fate_flow/examples/test_hetero_lr_job_dsl.json</span>
</code></pre> 
<h5><a id="FATEFlow_Client_SDK_796"></a>FATE-Flow Client SDK指南</h5> 
<p>详情参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/flow_sdk/README_zh.html</p> 
<p>包含</p> 
<ul><li> <p>Job 操作</p> </li><li> <p>Component 操作</p> </li><li> <p>Data操作</p> </li><li> <p>Task操作</p> </li><li> <p>Model 操作</p> </li><li> <p>Tag 操作</p> </li><li> <p>Table 操作</p> </li><li> <p>Queue 操作</p> </li></ul> 
<p>用法类似：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flow_sdk<span class="token punctuation">.</span>client <span class="token keyword">import</span> FlowClient
<span class="token comment"># use real ip address to initialize SDK</span>
client <span class="token operator">=</span> FlowClient<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">,</span> <span class="token string">'v1'</span><span class="token punctuation">)</span>
 
<span class="token comment">#client.job.submit(conf_path, dsl_path)</span>
</code></pre> 
<h5><a id="FATEFlow_REST_API_830"></a>FATE-Flow REST API</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/doc/fate_flow_http_api.html</p> 
<h5><a id="FATE_834"></a>FATE模型发布及在线联邦推理指南</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/model_publish_with_serving_guide_zh.html</p> 
<h4><a id="FATE_Pipeline_838"></a>FATE Pipeline使用</h4> 
<p>Pipeline介绍参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/README.html</p> 
<p>​ Pipeline 是一个高级 Python API，允许用户以顺序方式设计、启动和查询 FATE 作业。FATE Pipeline 设计为用户友好且与 FATE 命令行工具的行为一致。用户可以通过向管道添加组件来自定义作业工作流，然后通过一次调用启动作业。此外，Pipeline 提供了在拟合管道后运行预测和查询信息的功能。</p> 
<h5><a id="FATE_Job__844"></a>一个FATE Job 是一个有向无环图</h5> 
<p>​ FATE 作业是由算法组件节点组成的 dag。FATE 管道提供易于使用的工具来配置任务的顺序和设置。</p> 
<p>​ FATE 以模块化风格编写。模块被设计为具有输入和输出数据和模型。因此，当一个模块的输出设置为另一个模块的输入时，两个模块连接在一起。通过跟踪一个数据集是如何通过 FATE 模块处理的，可以看到一个 FATE 作业实际上是由一系列子任务组成的。</p> 
<h5><a id="pipeline_850"></a>pipeline接口</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/README.html#interface-of-pipeline</p> 
<h6><a id="Component_854"></a>Component</h6> 
<p>FATE 模块被封装<code>component</code>在 Pipeline API 中。每个组件都可以接收和输出<code>Data</code>和<code>Model</code>。组件的参数可以在初始化时方便的设置。未指定的参数将采用默认值。所有组件都有一个 <code>name</code>，可以任意设置。组件的名称是它的标识符，因此它在Pipeline 必须是唯一的。我们建议每个组件名称都包含一个编号作为后缀，以便于跟踪。</p> 
<p>每个组件都可能具有输入和/或输出<code>Data</code>和/或<code>Model</code>。有关如何使用组件的详细信息，请参阅本 <a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/component/README.html" rel="nofollow">指南</a>。</p> 
<p>使用指定参数值初始化组件的示例：</p> 
<pre><code>hetero_lr_0 = HeteroLR(name="hetero_lr_0", early_stop="weight_diff", max_iter=10,
                       early_stopping_rounds=2, validation_freqs=2)
</code></pre> 
<h6><a id="Input_867"></a>Input</h6> 
<p><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/component/README.html" rel="nofollow">Input</a>封装了一个组件的所有输入，包括 <code>Data</code>和<code>Model</code>输入。要访问<code>input</code>组件，请引用其<code>input</code>属性：</p> 
<pre><code>input_all = dataio_0.input
</code></pre> 
<h6><a id="Output_875"></a>Output</h6> 
<p><a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/component/README.html" rel="nofollow">输出</a>封装的部件，其中包括的所有输出结果 <code>Data</code>，并<code>Model</code>输出。要从<code>Output</code>组件访问，请引用其<code>output</code>属性：</p> 
<pre><code>output_all = dataio_0.output
</code></pre> 
<h6><a id="Data_883"></a>Data</h6> 
<p><code>Data</code>包装组件的所有数据类型输入和输出。FATE Pipeline 包括五种类型<code>data</code>，每种类型用于不同的场景。有关更多信息，请参阅<a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/component/README.html" rel="nofollow">此处</a></p> 
<h6><a id="Model_887"></a>Model</h6> 
<p><code>Model</code>定义组件的模型输入和输出。与 类似<code>Data</code>，这两种类型<code>models</code>用于不同的目的。有关更多信息，请参阅<a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/component/README.html" rel="nofollow">此处</a>。</p> 
<h5><a id="pipeline_891"></a>构建pipeline</h5> 
<p>初始化管道后，应指定作业参与者和发起者。以下是管道初始设置的示例：</p> 
<pre><code class="prism language-python">pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>set_initiator<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>set_roles<span class="token punctuation">(</span>guest<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> arbiter<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>Reader</code>需要读入数据源，以便其他组件可以处理数据。定义一个<code>Reader</code>组件：</p> 
<pre><code class="prism language-python">reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
</code></pre> 
<p>在大多数情况下，<code>DataIO</code>如下<code>Reader</code>将数据转换为DataInstance格式，然后可以用于数据工程和模型训练。某些组件（例如<code>Union</code>和<code>Intersection</code>）可以直接在非 DataInstance 表上运行。</p> 
<p>可以通过设置为不同的角色单独配置所有管道组件<code>get_party_instance</code>。例如，<code>DataIO</code> 可以像这样专门为guest配置组件：</p> 
<pre><code class="prism language-python">dataio_0 <span class="token operator">=</span> DataIO<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataio_0"</span><span class="token punctuation">)</span>
guest_component_instance <span class="token operator">=</span> dataio_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span>
guest_component_instance<span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>with_label<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> output_format<span class="token operator">=</span><span class="token string">"dense"</span><span class="token punctuation">)</span>
</code></pre> 
<p>要在管道中包含组件，请使用<code>add_component</code>. 要将<code>DataIO</code>组件添加 到先前创建的管道，请尝试以下操作：</p> 
<pre><code class="prism language-python">pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>dataio_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_Keras__Fate_NN__923"></a>以 Keras 风格构建 Fate NN 模型</h6> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/pipeline/README.html#build-fate-nn-model-in-keras-style</p> 
<h5><a id="_927"></a>初始化运行时作业参数</h5> 
<p>为了拟合或预测，用户需要初始化运行时环境，如“backend”和“work_mode”，</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters
job_parameters <span class="token operator">=</span> JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="pipeline_936"></a>运行pipeline</h5> 
<p>添加所有组件后，用户需要在运行设计的作业之前首先编译管道。编译后，可以使用适当的<code>Backend</code>和来拟合（运行训练作业）管道<code>WorkMode</code>。</p> 
<pre><code class="prism language-python">pipeline<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>job_parameters<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_945"></a>任务查询</h5> 
<p>FATE Pipeline 提供 API 来查询组件信息，包括数据、模型和摘要。所有查询 API 都具有与<a href="https://fate.readthedocs.io/en/latest/_build_temp/python/fate_client/flow_sdk" rel="nofollow">FlowPy</a>匹配的名称 ，而 Pipeline 检索查询结果并将其直接返回给用户。</p> 
<pre><code class="prism language-python">summary <span class="token operator">=</span> pipeline<span class="token punctuation">.</span>get_component<span class="token punctuation">(</span><span class="token string">"hetero_lr_0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_953"></a>部署组件</h5> 
<p>一旦pipeline 拟合完成，就可以在新数据集上运行预测。在预测之前，需要首先部署必要的组件。此步骤标记要由预测管道使用的选定组件。</p> 
<pre><code class="prism language-python"><span class="token comment"># deploy select components</span>
pipeline<span class="token punctuation">.</span>deploy_component<span class="token punctuation">(</span><span class="token punctuation">[</span>dataio_0<span class="token punctuation">,</span> hetero_lr_0<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># deploy all components</span>
<span class="token comment"># note that Reader component cannot be deployed. Always deploy pipeline with Reader by specified component list.</span>
pipeline<span class="token punctuation">.</span>deploy_component<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="pipeline_965"></a>使用pipeline进行预测</h5> 
<p>首先，启动一个新的管道，然后指定用于预测的数据源。</p> 
<pre><code class="prism language-python">predict_pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>
                               data<span class="token operator">=</span>Data<span class="token punctuation">(</span>predict_input<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>pipeline<span class="token punctuation">.</span>dataio_0<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">.</span>data<span class="token punctuation">:</span> reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后可以在新pipeline上启动预测。</p> 
<pre><code class="prism language-python">predict_pipeline<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>job_parameters<span class="token punctuation">)</span>
</code></pre> 
<p>此外，由于pipeline是模块化的，用户可以在运行预测之前向原始pipeline添加新组件。</p> 
<pre><code class="prism language-python">predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>evaluation_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>pipeline<span class="token punctuation">.</span>hetero_lr_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
predict_pipeline<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>job_parameters<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="pipeline_989"></a>pipeline的保存和恢复</h5> 
<p>要保存管道，只需使用<strong>转储</strong>接口。</p> 
<pre><code>pipeline.dump("pipeline_saved.pkl")
</code></pre> 
<p>要恢复管道，请使用<strong>load_model_from_file</strong>接口。</p> 
<pre><code>from pipeline.backend.pipeline import PineLine
PipeLine.load_model_from_file("pipeline_saved.pkl")
</code></pre> 
<h5><a id="pipeline_1004"></a>pipeline汇总信息</h5> 
<p>要获取管道的详细信息，请使用<strong>describe</strong>接口，它会打印“创建时间”拟合或预测状态以及构建的 dsl（如果存在）。</p> 
<pre><code>pipeline.describe()
</code></pre> 
<h5><a id="_CLI_1012"></a>管道与 CLI</h5> 
<p>在过去的版本中，用户通过命令行界面与 FATE 交互，通常使用手动配置的 conf 和 dsl json 文件。手动配置既乏味又容易出错。FATE Pipeline 在编译时自动形成任务配置文件，允许快速尝试任务设计。</p> 
<h4><a id="_1016"></a>日志</h4> 
<p>FATE-Flow服务日志：/fate/logs/fate_flow/</p> 
<p>任务日志:/fate/logs/$job_id/</p> 
<h4><a id="_1022"></a>常见问题</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_flow/README_zh.html#id10</p> 
<h3><a id="_1028"></a>测试样例</h3> 
<p>FATE Board任务查看界面:http://192.168.1.75:8080/#/history</p> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/examples/experiment_template/user_usage/dsl_v2_predict_tutorial.html</p> 
<h4><a id="1_1034"></a>测试用例1-上传文件</h4> 
<pre><code class="prism language-bash">python /fate/examples/pipeline/demo/pipeline-upload.py --base  /fate
</code></pre> 
<p>pipeline-upload.py内容如下：</p> 
<p>将examples/data/breast_hetero_guest.csv改为自己想上传的文件</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> argparse

<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine

<span class="token comment"># path to data</span>
<span class="token comment"># default fate installation path</span>
DATA_BASE <span class="token operator">=</span> <span class="token string">"/data/projects/fate"</span>

<span class="token comment"># site-package ver</span>
<span class="token comment"># import site</span>
<span class="token comment"># DATA_BASE = site.getsitepackages()[0]</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>data_base<span class="token operator">=</span>DATA_BASE<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># parties config</span>
    guest <span class="token operator">=</span> <span class="token number">9999</span>
    <span class="token comment"># 0 for eggroll, 1 for spark</span>
    backend <span class="token operator">=</span> Backend<span class="token punctuation">.</span>EGGROLL
    <span class="token comment"># 0 for standalone, 1 for cluster</span>
    work_mode <span class="token operator">=</span> WorkMode<span class="token punctuation">.</span>STANDALONE
    <span class="token comment"># use the work mode below for cluster deployment</span>
    <span class="token comment"># work_mode = WorkMode.CLUSTER</span>

    <span class="token comment"># partition for data storage</span>
    partition <span class="token operator">=</span> <span class="token number">4</span>

    <span class="token comment"># table name and namespace, used in FATE job configuration</span>
    dense_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"experiment"</span></span><span class="token punctuation">}</span>
    tag_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"experiment"</span></span><span class="token punctuation">}</span>

    pipeline_upload <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_initiator<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span>guest<span class="token punctuation">)</span><span class="token punctuation">.</span>set_roles<span class="token punctuation">(</span>guest<span class="token operator">=</span>guest<span class="token punctuation">)</span>
    <span class="token comment"># add upload data info</span>
    <span class="token comment"># path to csv file(s) to be uploaded, modify to upload designated data</span>
    pipeline_upload<span class="token punctuation">.</span>add_upload_data<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base<span class="token punctuation">,</span> <span class="token string">"examples/data/breast_hetero_guest.csv"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    table_name<span class="token operator">=</span>dense_data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token comment"># table name</span>
                                    namespace<span class="token operator">=</span>dense_data<span class="token punctuation">[</span><span class="token string">"namespace"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token comment"># namespace</span>
                                    head<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> partition<span class="token operator">=</span>partition<span class="token punctuation">)</span>               <span class="token comment"># data info</span>

    pipeline_upload<span class="token punctuation">.</span>add_upload_data<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_base<span class="token punctuation">,</span> <span class="token string">"examples/data/breast_hetero_host.csv"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    table_name<span class="token operator">=</span>tag_data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    namespace<span class="token operator">=</span>tag_data<span class="token punctuation">[</span><span class="token string">"namespace"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    head<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> partition<span class="token operator">=</span>partition<span class="token punctuation">)</span>

    <span class="token comment"># upload data</span>
    pipeline_upload<span class="token punctuation">.</span>upload<span class="token punctuation">(</span>work_mode<span class="token operator">=</span>work_mode<span class="token punctuation">,</span> backend<span class="token operator">=</span>backend<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token string">"PIPELINE DEMO"</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--base"</span><span class="token punctuation">,</span> <span class="token string">"-b"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"data base, path to directory that contains examples/data"</span><span class="token punctuation">)</span>

    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>base <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span>args<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2_1106"></a>测试用例2-训练和评估模型</h4> 
<p>pipeline搭建：</p> 
<pre><code class="prism language-python">python <span class="token operator">/</span>fate<span class="token operator">/</span>examples<span class="token operator">/</span>pipeline<span class="token operator">/</span>demo<span class="token operator">/</span>pipeline<span class="token operator">-</span>quick<span class="token operator">-</span>demo<span class="token punctuation">.</span>py
</code></pre> 
<p>pipeline-quick-demo.py内容如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>component <span class="token keyword">import</span> Reader<span class="token punctuation">,</span> DataIO<span class="token punctuation">,</span> Intersection<span class="token punctuation">,</span> HeteroSecureBoost<span class="token punctuation">,</span> Evaluation
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>interface <span class="token keyword">import</span> Data
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters

<span class="token comment"># table name &amp; namespace in data storage</span>
<span class="token comment"># data should be uploaded before running modeling task</span>
guest_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
host_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>

<span class="token comment"># initialize pipeline</span>
pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_initiator<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_roles<span class="token punctuation">(</span>guest<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>

<span class="token comment"># define components</span>
reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>guest_train_data<span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>host_train_data<span class="token punctuation">)</span>
dataio_0 <span class="token operator">=</span> DataIO<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataio_0"</span><span class="token punctuation">,</span> with_label<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
dataio_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>with_label<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
intersect_0 <span class="token operator">=</span> Intersection<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"intersection_0"</span><span class="token punctuation">)</span>
hetero_secureboost_0 <span class="token operator">=</span> HeteroSecureBoost<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"hetero_secureboost_0"</span><span class="token punctuation">,</span>
                                         num_trees<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
                                         bin_num<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>
                                         task_type<span class="token operator">=</span><span class="token string">"classification"</span><span class="token punctuation">,</span>
                                         objective_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"objective"</span><span class="token punctuation">:</span> <span class="token string">"cross_entropy"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                         encrypt_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"iterativeAffine"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                         tree_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"max_depth"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
evaluation_0 <span class="token operator">=</span> Evaluation<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"evaluation_0"</span><span class="token punctuation">,</span> eval_type<span class="token operator">=</span><span class="token string">"binary"</span><span class="token punctuation">)</span>

<span class="token comment"># add components to pipeline, in order of task execution</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>\
    <span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>dataio_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\
    <span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>intersect_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>dataio_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\
    <span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>hetero_secureboost_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>train_data<span class="token operator">=</span>intersect_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\
    <span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>evaluation_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>hetero_secureboost_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compile &amp; fit pipeline</span>
pipeline<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># to run this task with cluster deployment, use the following setting instead</span>
<span class="token comment"># may change data engine backend according to actual environment</span>
<span class="token comment"># pipeline.compile().fit(JobParameters(backend=Backend.EGGROLL, work_mode=WorkMode.CLUSTER))</span>


<span class="token comment"># query component summary</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Evaluation summary:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>pipeline<span class="token punctuation">.</span>get_component<span class="token punctuation">(</span><span class="token string">'evaluation_0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_summary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>fate flow搭建:</p> 
<p>(用户可以到/fate/examples/dsl/v2/寻找合适的算法和配置文件替换)</p> 
<pre><code class="prism language-bash">flow job submit -c /fate/examples/dsl/v2/hetero_secureboost/test_secureboost_train_complete_secure_conf.json -d /fate/examples/dsl/v2/hetero_secureboost/test_secureboost_train_dsl.json
</code></pre> 
<h4><a id="3_1176"></a>测试用例3-模型训练、部署及预测</h4> 
<p>搭建一个hetero secureboost 模型，并使用模型预测</p> 
<h5><a id="pipeline_1180"></a><strong>pipeline搭建</strong></h5> 
<p>pipeline</p> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/examples/experiment_template/user_usage/pipeline_predict_tutorial.html</p> 
<p>1.上传文件(测试用例1已经上传了)</p> 
<p>2.主机环境下创建文件：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /home/docker_standalone_fate_1.6.0/fate_job/
<span class="token function">vim</span> fit_Hetero_SecureBoost_model.py
</code></pre> 
<p>文件内容如下：（用户可参照/fate/examples/pipeline/中对应算法，将代码与算法列表https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/README.html#algorithm-list对应算法介绍结合有助于理解）</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode <span class="token comment"># configs</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine <span class="token comment"># Pipeline </span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>component <span class="token keyword">import</span> Reader<span class="token punctuation">,</span> DataIO<span class="token punctuation">,</span> Intersection<span class="token punctuation">,</span> HeteroSecureBoost <span class="token comment"># fate components</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>interface <span class="token keyword">import</span> Data  <span class="token comment"># data flow</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters <span class="token comment"># parameter class</span>

<span class="token comment"># define dataset name and namespace</span>
guest_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
host_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>

<span class="token comment"># initialize pipeline, set guest as initiator and set guest/host party id</span>
pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_initiator<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_roles<span class="token punctuation">(</span>guest<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>

<span class="token comment"># define components</span>
<span class="token comment"># reader read raw data </span>
reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>guest_train_data<span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>host_train_data<span class="token punctuation">)</span>
<span class="token comment"># data_io transform data</span>
dataio_0 <span class="token operator">=</span> DataIO<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataio_0"</span><span class="token punctuation">,</span> with_label<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
dataio_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>with_label<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># find sample intersection using Intersection components</span>
intersect_0 <span class="token operator">=</span> Intersection<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"intersection_0"</span><span class="token punctuation">)</span>
<span class="token comment"># hetero secureboost components, setting algorithm parameters</span>
hetero_secureboost_0 <span class="token operator">=</span> HeteroSecureBoost<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"hetero_secureboost_0"</span><span class="token punctuation">,</span>
				     num_trees<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
				     bin_num<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>
				     task_type<span class="token operator">=</span><span class="token string">"classification"</span><span class="token punctuation">,</span>
				     objective_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"objective"</span><span class="token punctuation">:</span> <span class="token string">"cross_entropy"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				     encrypt_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"iterativeAffine"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				     tree_param<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"max_depth"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># add components to pipeline, in the order of task execution</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>\
<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>dataio_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\
<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>intersect_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>dataio_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\
<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>hetero_secureboost_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>train_data<span class="token operator">=</span>intersect_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compile &amp; fit pipeline</span>
pipeline<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># save train pipeline</span>
pipeline<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"pipeline_saved.pkl"</span><span class="token punctuation">)</span>
</code></pre> 
<p>docker环境下执行：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span>  /fate/fate_job
python fit_Hetero_SecureBoost_model.py
</code></pre> 
<p>3.主机环境下创建文件</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> predict_instances_by_Hetero_SecureBoost_model.py
</code></pre> 
<p>文件内容如下：（用户自行将breast_hetero_guest改成上传的表名）</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>component<span class="token punctuation">.</span>reader <span class="token keyword">import</span> Reader
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>interface<span class="token punctuation">.</span>data <span class="token keyword">import</span> Data
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode <span class="token comment"># configs</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters <span class="token comment"># parameter class</span>

<span class="token comment"># load train pipeline</span>
pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">.</span>load_model_from_file<span class="token punctuation">(</span><span class="token string">'pipeline_saved.pkl'</span><span class="token punctuation">)</span>
<span class="token comment"># deploy components in training step</span>
pipeline<span class="token punctuation">.</span>deploy_component<span class="token punctuation">(</span><span class="token punctuation">[</span>pipeline<span class="token punctuation">.</span>dataio_0<span class="token punctuation">,</span> pipeline<span class="token punctuation">.</span>intersection_0<span class="token punctuation">,</span> pipeline<span class="token punctuation">.</span>
                           hetero_secureboost_0<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># set new instances to predict</span>
<span class="token comment"># new dataset</span>
guest_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
host_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"breast_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>

<span class="token comment"># set new reader</span>
reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>guest_train_data<span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>host_train_data<span class="token punctuation">)</span>

<span class="token comment"># new predict pipeline</span>
predict_pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># update reader</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>
<span class="token comment"># add selected components from train pipeline onto predict pipeline</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>data<span class="token operator">=</span>Data<span class="token punctuation">(</span>predict_input<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>pipeline<span class="token punctuation">.</span>dataio_0<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">.</span>data<span class="token punctuation">:</span> reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># run predict model</span>
predict_pipeline<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>docker环境下执行，FATE Board查看结果</p> 
<pre><code class="prism language-bash">python predict_instances_by_Hetero_SecureBoost_model.py
</code></pre> 
<h5><a id="flow_1298"></a>flow命令搭建</h5> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/examples/experiment_template/user_usage/dsl_v2_predict_tutorial.html</p> 
<p>(1).训练模型</p> 
<pre><code>cd /fate/examples/
</code></pre> 
<pre><code>flow job submit -c dsl/v2/hetero_secureboost/test_secureboost_train_binary_conf.json -d dsl/v2/hetero_secureboost/test_secureboost_train_dsl.json
</code></pre> 
<p>(2).使用 flow_client 来部署预测任务中需要的组件</p> 
<p><strong>记得修改model-id，model-version</strong></p> 
<pre><code>flow model deploy --model-id guest-9999#host-9998#model --model-version 2021090109322084026031 --cpn-list "reader_0, dataio_0, intersection_0, hetero_secure_boost_0"
</code></pre> 
<p>如果执行返回：</p> 
<pre><code>{
    "retcode": 100,
    "retmsg": "'Pipeline'"
}
</code></pre> 
<p>是因为模型还没有搭建完成，可以到board里面查看，等完成后再执行部署</p> 
<p>(3).预测文件</p> 
<p>用部署文件返回的model_id 、model_version、数据集名字替换 **/fate/examples/dsl/v2/**hetero_secureboost/test_predict_conf.json 内容中的 model_id 、model_version ，替换后的内容保存到 /fate/fate_job/new_test_predict_conf.json（新建文件）</p> 
<p>执行</p> 
<pre><code class="prism language-bash">flow job submit -c /fate/fate_job/lxy/new_test_predict_conf.json
</code></pre> 
<p>如果返回以下内容，是因为host,guest party_id与上传文件host,guest party_id的不一致</p> 
<pre><code>{
	'data':'No such file or directory',
	'retcode':100,
	'retmsg':"2"
}
</code></pre> 
<p>如果提交任务返回如下内容，是因为没有执行部署操作：</p> 
<pre><code>{
    "retcode": 100,
    "retmsg": "Model arbiter-10000#guest-9999#host-10000#model 20210908033432743389158 has not been deployed yet."
}
</code></pre> 
<h4><a id="4pipeline_1362"></a>测试用例4-独立使用pipeline搭建模型</h4> 
<h5><a id="1_1364"></a>1.选定合适的算法和数据集</h5> 
<p>下载FATE源码</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/FederatedAI/FATE.git
</code></pre> 
<p>打开examples目录下的data/READMA.md文件，查看测试数据集信息，使用线性回归模型HeteroLinR，和标签是连续值的student_hetero数据集</p> 
<h5><a id="2_1374"></a>2.上传数据集</h5> 
<p>参考测试用例1</p> 
<h5><a id="3pipeline_1378"></a>3.编写训练和验证pipeline代码</h5> 
<p>在测试用例3 pipeline代码基础上修改，</p> 
<p>可以结合HeteroLinR算法详情https://fate.readthedocs.io/en/latest/_build_temp/python/federatedml/linear_model/linear_regression/README.html还有源码FATE/FATE-master/examples/pipeline/hetero_linear_regression/pipeline-hetero-linr.py两个文件理解该算法。</p> 
<p>发现HeteroLinR pipeline搭建与测试用例3 HeteroSecureBoost模型搭建相比，需要多配置一个arbiter，其他需要改的操作有：修改数据集名称，HeteroLinR模型可以参数可以参考pipeline-hetero-linr.py里模型参数，此处只设置名字</p> 
<p>创建linr_model_train_and_evaluation.py文件</p> 
<p>代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode <span class="token comment"># configs</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine <span class="token comment"># Pipeline</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>component <span class="token keyword">import</span> Reader<span class="token punctuation">,</span> DataIO<span class="token punctuation">,</span> Intersection<span class="token punctuation">,</span> HeteroSecureBoost<span class="token punctuation">,</span> HeteroLinR <span class="token punctuation">,</span>Evaluation<span class="token comment"># fate components</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>interface <span class="token keyword">import</span> Data  <span class="token comment"># data flow</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters <span class="token comment"># parameter class</span>

<span class="token comment"># define dataset name and namespace</span>
guest_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"student_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
host_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"student_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>

<span class="token comment"># initialize pipeline, set guest as initiator and set guest/host party id</span>
pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_initiator<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_roles<span class="token punctuation">(</span>guest<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> arbiter<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>
reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>guest_train_data<span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'host'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>host_train_data<span class="token punctuation">)</span>

dataio_0 <span class="token operator">=</span> DataIO<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataio_0"</span><span class="token punctuation">)</span>
dataio_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>with_label<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> label_name<span class="token operator">=</span><span class="token string">"y"</span><span class="token punctuation">,</span>
																		 label_type<span class="token operator">=</span><span class="token string">"int"</span><span class="token punctuation">,</span> output_format<span class="token operator">=</span><span class="token string">"dense"</span><span class="token punctuation">)</span>
dataio_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">'host'</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>with_label<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

intersection_0 <span class="token operator">=</span> Intersection<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"intersection_0"</span><span class="token punctuation">)</span>
hetero_linr_0 <span class="token operator">=</span> HeteroLinR<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"hetero_linr_0"</span><span class="token punctuation">)</span>

evaluation_0 <span class="token operator">=</span> Evaluation<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"evaluation_0"</span><span class="token punctuation">,</span> eval_type<span class="token operator">=</span><span class="token string">"regression"</span><span class="token punctuation">,</span> pos_label<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
 
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>dataio_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>intersection_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>dataio_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>hetero_linr_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>train_data<span class="token operator">=</span>intersection_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>evaluation_0<span class="token punctuation">,</span> data<span class="token operator">=</span>Data<span class="token punctuation">(</span>data<span class="token operator">=</span>hetero_linr_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

pipeline<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

job_parameters <span class="token operator">=</span> JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>job_parameters<span class="token punctuation">)</span>

pipeline<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"/fate/fate_job/lxy/hetero_linr_pipeline_saved.pkl"</span><span class="token punctuation">)</span><span class="token comment">#保存模型</span>
</code></pre> 
<p>docker执行该文件：</p> 
<pre><code>cd /fate/fate_job/lxy
python linr_model_train_and_evaluation.py
</code></pre> 
<h5><a id="4_pipeline_1438"></a>4.编写预测 pipeline代码</h5> 
<p>创建linr_model_predict.py文件，在测试用例3 pipeline代码基础上修改，只需要修改表名和模型名即可.</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>pipeline <span class="token keyword">import</span> PipeLine
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>component<span class="token punctuation">.</span>reader <span class="token keyword">import</span> Reader
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>interface<span class="token punctuation">.</span>data <span class="token keyword">import</span> Data
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>config <span class="token keyword">import</span> Backend<span class="token punctuation">,</span> WorkMode <span class="token comment"># configs</span>
<span class="token keyword">from</span> pipeline<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>entity <span class="token keyword">import</span> JobParameters <span class="token comment"># parameter class</span>

<span class="token comment"># load train pipeline</span>
pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">.</span>load_model_from_file<span class="token punctuation">(</span><span class="token string">'/fate/fate_job/lxy/hetero_linr_pipeline_saved.pkl'</span><span class="token punctuation">)</span>
<span class="token comment"># deploy components in training step</span>
pipeline<span class="token punctuation">.</span>deploy_component<span class="token punctuation">(</span><span class="token punctuation">[</span>pipeline<span class="token punctuation">.</span>dataio_0<span class="token punctuation">,</span> pipeline<span class="token punctuation">.</span>intersection_0<span class="token punctuation">,</span> pipeline<span class="token punctuation">.</span>
                           hetero_linr_0<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># set new instances to predict</span>
<span class="token comment"># new dataset</span>
guest_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"student_hetero_guest"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>
host_train_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"student_hetero_host"</span><span class="token punctuation">,</span> <span class="token string">"namespace"</span><span class="token punctuation">:</span> <span class="token string">"experiment"</span><span class="token punctuation">}</span>

<span class="token comment"># set new reader</span>
reader_0 <span class="token operator">=</span> Reader<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"reader_0"</span><span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>guest_train_data<span class="token punctuation">)</span>
reader_0<span class="token punctuation">.</span>get_party_instance<span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"host"</span><span class="token punctuation">,</span> party_id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>component_param<span class="token punctuation">(</span>table<span class="token operator">=</span>host_train_data<span class="token punctuation">)</span>

<span class="token comment"># new predict pipeline</span>
predict_pipeline <span class="token operator">=</span> PipeLine<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># update reader</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>reader_0<span class="token punctuation">)</span>
<span class="token comment"># add selected components from train pipeline onto predict pipeline</span>
predict_pipeline<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>data<span class="token operator">=</span>Data<span class="token punctuation">(</span>predict_input<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>pipeline<span class="token punctuation">.</span>dataio_0<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">.</span>data<span class="token punctuation">:</span> reader_0<span class="token punctuation">.</span>output<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># run predict model</span>
predict_pipeline<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>JobParameters<span class="token punctuation">(</span>backend<span class="token operator">=</span>Backend<span class="token punctuation">.</span>EGGROLL<span class="token punctuation">,</span> work_mode<span class="token operator">=</span>WorkMode<span class="token punctuation">.</span>STANDALONE<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="FATE_TEST_1476"></a>FATE TEST</h3> 
<p>运行 FATE 测试的有用工具的集合。</p> 
<h4><a id="quick_start_1480"></a>quick start</h4> 
<p>参考：https://fate.readthedocs.io/en/latest/_build_temp/python/fate_test/README.html#quick-start</p> 
<h5><a id="_fat_test_configyaml_1484"></a>编辑默认的 fat_test_config.yaml</h5> 
<p>更改 /usr/local/lib/python3.6/site-packages/fate_test/fate_test_config.yaml文件，</p> 
<pre><code>data_base_dir: path(FATE)
</code></pre> 
<p>更改为</p> 
<pre><code>data_base_dir: /fate/
</code></pre> 
<h5><a id="_fate_test__1498"></a>运行 fate_test 套件</h5> 
<p>套件：用于运行测试套件，收集 FATE 作业，Testsuite测试套件 用于按顺序运行一组作业。用于作业的数据可以在提交作业之前上传，也可以在作业完成后进行清理。这个工具对于 FATE 的发布测试很有用。</p> 
<pre><code class="prism language-bash"><span class="token comment">#fate_test suite -i &lt;path contains *testsuite.json&gt;</span>
fate_test suite -i /fate/examples/dsl/v1/homo_nn/testsuite.json
<span class="token comment">#fate_test suite -i /fate/examples/dsl/v1/hetero_pearson/testsuite.json</span>
</code></pre> 
<h5><a id="_fate_test__1508"></a>运行一些 fate_test 基准测试</h5> 
<p>用于比较 FATE 和其他机器学习系统之间的建模质量的 benchmark-quality</p> 
<pre><code class="prism language-bash"><span class="token comment">#fate_test benchmark-quality -i &lt;path contains *benchmark.json&gt;</span>
fate_test benchmark-quality -i /fate/examples/benchmark_quality/hetero_linear_regression/hetero_linr_benchmark.json
</code></pre> 
<h3><a id="_1517"></a>开发指南</h3> 
<p>开发算法模块，详情参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/develop_guide_zh.html</p> 
<p>要开发模块，需要执行以下 5 个步骤。</p> 
<ol><li> <p>定义将在此模块中使用的 python 参数对象。</p> </li><li> <p>定义模块的 Setting conf json 配置文件。</p> </li><li> <p>如果模块需要联邦，则需定义传输变量配置文件。</p> </li><li> <p>您的算法模块需要继承model_base类，并完成几个指定的函数。</p> </li><li> <p>定义模型保存所需的protobuf文件。</p> </li><li> <p>若希望通过python脚本直接启动组件，需要在fate_client中定义Pipeline组件。</p> </li></ol> 
<h3><a id="API_1537"></a>API</h3> 
<h4><a id="API_1539"></a>计算API</h4> 
<p>初始化一个计算会话（computing session），参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/api/computing.html</p> 
<h3><a id="API_1543"></a>联邦API</h3> 
<p>包括低级API<a href="https://fate.readthedocs.io/en/latest/_build_temp/doc/api/federation.html#fate_arch.abc._federation.FederationABC" rel="nofollow"><code>FederationABC</code></a>()和用户接口secure_add_example_transfer_variable，参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/api/federation.html</p> 
<h4><a id="_1547"></a>参数</h4> 
<p>类的参数详情参考：https://fate.readthedocs.io/en/latest/_build_temp/doc/api/params.html</p> 
<h4><a id="_1551"></a>遇到过的报错信息和解决方案</h4> 
<h5><a id="Federated_schedule_error_Please_check_rollSite_and_fateflow_1553"></a>Federated schedule error, Please check rollSite and fateflow</h5> 
<p>报错信息：Federated schedule error, Please check rollSite and fateflow network connectivityrpc request error: &lt;_InactiveRpcError of RPC that terminated…</p> 
<p>原因：集群通信问题</p> 
<p>解决方案：查看配置文件的 work mode设置与fate部署方式对应（单机 or 集群）</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/835177f058b9b50113f49923ed2c238b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言——打印菱形</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e607fdf0583c3ddad8b481556eb4f15e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java实现两个整数的加减乘除运算</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>