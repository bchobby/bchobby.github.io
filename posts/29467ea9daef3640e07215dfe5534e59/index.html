<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>redis主从同步和哨兵模式 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="redis主从同步和哨兵模式" />
<meta property="og:description" content="Memcached&amp;Redis构建缓存数据库 前言 许多Web应用都将数据保存到关系型数据库( RDBMS)中，应用服务器从中读取数据并在浏览器中显示。但随着数据量的增大、访问的集中，就会出现RDBMS的负担加重、数据库响应恶化、 网站显示延迟等重大影响。Memcached/redis是高性能的分布式内存缓存服务器,通过缓存数据库查询结果，减少对关系型数据库访问次数，以提高动态Web等应用的速度、 提高可靠性。
RDBMS即关系数据库管理系统(Relational Database Management System)
1、简介 1、nosql产品: redis,mongodb,memcached. NOSQL名词解释：非关系型数据库
1.以键值对的方式存储数据—（Key-Value）的形式
2.缓存数据库
2、NoSQL的优点/缺点 优点: - 高可扩展性 - 分布式计算 - 低成本 - 架构的灵活性 - 没有复杂的关系 缺点: - 没有标准化 - 有限的查询功能（到目前为止） 缓存服务器作用: 加快访问速度 ,缓解关系型数据库的读压力
3、关系型数据库与非关系型数据库的区别：---------面试高频率问题 1.首先了解一下 什么是关系型数据库？ 关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织。 优点： 1、易于维护：都是使用表结构，格式一致； 2、使用方便：SQL语言通用，可用于复杂查询； 3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。 缺点： 1、读写性能比较差，尤其是海量数据的高效率读写； 2、固定的表结构，灵活度稍欠； 3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈； 二 非关系型数据库 什么非关系型数据库呢？ 非关系型数据是一种数据结构化存储方法的集合，可以是文档或者键值对等 优点： 1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。 2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘； 3、高扩展性； 4、成本低：nosql数据库部署简单，基本都是开源软件。 缺点： 1、不提供sql支持，学习和使用成本较高； 2、无事务处理； 3、数据结构相对复杂，复杂查询方面稍欠。 2、Memcached 1、特点 1.内置内存存储方式-----------为了提高性能，memcached中保存的数据都存储在memcache内置的内存存储空间中。由于数据仅存在于内存中，重启操作系统会导致全部数据消失 2.简单key/value存储---------------服务器不关心数据本身的意义及结构，只要是可序列化数据即可。存储项由“键、过期时间、可选的标志及数据”四个部分组成； 2、服务框架 原理
1、检查客户端的请求数据是否在memcached中，如有，直接把请求数据返回，不再对数据库进行任何操作，路径操作为①②③⑦。
2、如果请求的数据不在memcached中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到memcached中（memcached客户端不负责，需要程序明确实现），路径操作为①②④⑤⑦⑥。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/29467ea9daef3640e07215dfe5534e59/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-14T07:50:25+08:00" />
<meta property="article:modified_time" content="2023-07-14T07:50:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">redis主从同步和哨兵模式</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MemcachedRedis_0"></a>Memcached&amp;Redis构建缓存数据库</h2> 
<h3><a id="_4"></a><strong>前言</strong></h3> 
<p>许多Web应用都将数据保存到关系型数据库( RDBMS)中，应用服务器从中读取数据并在浏览器中显示。但随着数据量的增大、访问的集中，就会出现RDBMS的负担加重、数据库响应恶化、 网站显示延迟等重大影响。<strong>Memcached/redis是高性能的分布式内存缓存服务器,通过缓存数据库查询结果，减少对关系型数据库访问次数，以提高动态Web等应用的速度、 提高可靠性。</strong></p> 
<p>RDBMS即关系数据库管理系统(Relational Database Management System)</p> 
<h5><a id="1_16"></a><strong>1、简介</strong></h5> 
<h6><a id="1nosql_redismongodbmemcached_20"></a><strong>1、nosql产品: redis,mongodb,memcached.</strong></h6> 
<p>NOSQL名词解释：非关系型数据库</p> 
<p><strong>1.以键值对的方式存储数据—（<strong>Key-Value</strong>）的形式</strong></p> 
<p><strong>2.缓存数据库</strong></p> 
<h6><a id="2NoSQL_36"></a>2、NoSQL的优点/缺点</h6> 
<pre><code class="prism language-shell">优点:
- 高可扩展性
- 分布式计算
- 低成本
- 架构的灵活性
- 没有复杂的关系

缺点:
- 没有标准化
- 有限的查询功能（到目前为止）
</code></pre> 
<p><strong>缓存服务器作用: 加快访问速度 ,缓解关系型数据库的读压力</strong></p> 
<h6><a id="3_59"></a>3、关系型数据库与非关系型数据库的区别：---------面试高频率问题</h6> 
<pre><code class="prism language-plain">1.首先了解一下 什么是关系型数据库？
关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织。

优点：
1、易于维护：都是使用表结构，格式一致；
2、使用方便：SQL语言通用，可用于复杂查询；
3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。
缺点：
1、读写性能比较差，尤其是海量数据的高效率读写；
2、固定的表结构，灵活度稍欠；
3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈；

二 非关系型数据库
什么非关系型数据库呢？

非关系型数据是一种数据结构化存储方法的集合，可以是文档或者键值对等

优点：
1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。
2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；
3、高扩展性；
4、成本低：nosql数据库部署简单，基本都是开源软件。

缺点：
1、不提供sql支持，学习和使用成本较高；
2、无事务处理；
3、数据结构相对复杂，复杂查询方面稍欠。
</code></pre> 
<h3><a id="2Memcached_95"></a>2、Memcached</h3> 
<h5><a id="1_99"></a>1、特点</h5> 
<pre><code class="prism language-shell"><span class="token number">1</span>.内置内存存储方式-----------为了提高性能，memcached中保存的数据都存储在memcache内置的内存存储空间中。由于数据仅存在于内存中，重启操作系统会导致全部数据消失
<span class="token number">2</span>.简单key/value存储---------------服务器不关心数据本身的意义及结构，只要是可序列化数据即可。存储项由“键、过期时间、可选的标志及数据”四个部分组成；
</code></pre> 
<p><img src="https://images2.imgbox.com/94/fd/AQ9lgNQv_o.png" alt="img"></p> 
<h5><a id="2_114"></a><strong>2、服务框架</strong></h5> 
<p><img src="https://images2.imgbox.com/21/3b/izS2Qt1d_o.png" alt="img"></p> 
<p><strong>原理</strong></p> 
<p>1、检查客户端的请求数据是否在memcached中，如有，直接把请求数据返回，不再对数据库进行任何操作，路径操作为①②③⑦。<br> 2、如果请求的数据不在memcached中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到memcached中（memcached客户端不负责，需要程序明确实现），路径操作为①②④⑤⑦⑥。</p> 
<p>3、保持缓存的“新鲜性”，每当数据发生变化的时候（比如，数据有被修改，或被删除的情况下），要同步更新的缓存信息，确保用户不会在缓存取到旧的数据。</p> 
<h5><a id="3Memcached_135"></a>3、配置安装Memcached</h5> 
<p>memcache能存放多少数据，取决于服务器本身的内存有多大。</p> 
<pre><code class="prism language-shell"><span class="token number">1</span>.安装----准备一台服务器
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install memcached -y</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># systemctl start memcached  #启动</span>
<span class="token number">2</span>.修改配置文件
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/memcached</span>
<span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token string">"11211"</span>    ---监听的端口，默认11211.可以修改
<span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token string">"memcached"</span>  -----用户
<span class="token assign-left variable">MAXCONN</span><span class="token operator">=</span><span class="token string">"1024"</span>   -----默认并发，可以修改
<span class="token assign-left variable">CACHESIZE</span><span class="token operator">=</span><span class="token string">"64"</span>    ------给的内存。默认是M
<span class="token assign-left variable">OPTIONS</span><span class="token operator">=</span><span class="token string">""</span>       ----监听的网络地址
然后把ip地址发给开发人员，开发的会使用api接口连接memcached.
测试：
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install -y telnet   #安装telent</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># telnet 192.168.246.188 11211</span>
Trying <span class="token number">192.168</span>.246.188<span class="token punctuation">..</span>.
Connected to <span class="token number">192.168</span>.246.188.
Escape character is <span class="token string">'^]'</span><span class="token builtin class-name">.</span>
<span class="token builtin class-name">set</span> name <span class="token number">0</span> <span class="token number">60</span> <span class="token number">9</span>    <span class="token comment">#设置名称为name的key      key   标记位(id号)   过期时间 大小</span>
helloword        <span class="token comment">#给name的值</span>
STORED         <span class="token comment">#出现stoped表示已经存储成功。</span>
get name       <span class="token comment">#查询key值</span>
VALUE name <span class="token number">0</span> <span class="token number">9</span>
helloword
END
quit   ---退出
参数解释:
name：key的名字 自己定义
<span class="token number">0</span>：key的id号，需要和其他的key不一样
<span class="token number">60</span>：缓存过期时间,单位为秒，0为永远
<span class="token number">9</span>：字符串最大长度

不用它的原因：存储的数据类型单一，而且数据只能存储在内存中。无法实现数据的持久化，服务器重启，数据将消失。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
扩展:安装php支持memcached的扩展模块:
安装php7.0
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-mysql.x86_64 php70w-pdo.x86_64 php70w-devel zlib-devel  -y</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum -y install php70w-fpm</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install -y make gcc zlib-devel libmemcached-devel git</span>
下载PHP Memcache 扩展包
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install libmemcached -y</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum install php70w-pecl-memcached -y</span>
</code></pre> 
<pre><code class="prism language-shell">安装nginx略，配置nginx的yum源。测试访问php的页面。
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># yum -y install nginx</span>
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/nginx/conf.d/nginx.conf</span>
server <span class="token punctuation">{<!-- --></span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        root           /usr/share/nginx/html<span class="token punctuation">;</span>
        fastcgi_pass   <span class="token number">127.0</span>.0.1:9000<span class="token punctuation">;</span>
        fastcgi_index  index.php<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        include        fastcgi_params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
编辑php页面
<span class="token punctuation">[</span>root@memcached ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/share/nginx/html/</span>
<span class="token punctuation">[</span>root@memcached html<span class="token punctuation">]</span><span class="token comment"># vi index.php</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
启动nginx与php-fpm即可
浏览器访问
</code></pre> 
<p><img src="https://images2.imgbox.com/01/68/Ayjb3Dzu_o.png" alt="img"></p> 
<h3><a id="3Redis_223"></a>3、Redis服务</h3> 
<h4><a id="1_227"></a>1、介绍</h4> 
<p><strong>redis是一个开源的、使用C语言编写的、支持网络交互的、可基于内存也可持久化的Key-Value数据库</strong></p> 
<p>**redis的官网：**redis.io<br> 注:域名后缀io属于国家域名，是british Indian Ocean territory，即英属印度洋领地</p> 
<h5><a id="1redis_240"></a>1、redis的特点:</h5> 
<pre><code class="prism language-shell"><span class="token number">1</span>.丰富的数据结构  -----String,list,set,hash等数据结构的存储
<span class="token number">2</span>.支持持久化
<span class="token number">3</span>.支持事务   ---------------事务是指“一个完整的动作，要么全部执行，要么什么也没有做”。
<span class="token number">4</span>.支持主从
</code></pre> 
<h5><a id="2_253"></a>2、区别</h5> 
<pre><code class="prism language-shell">redis和memcached比较 
<span class="token number">1</span><span class="token punctuation">)</span>.Redis不仅仅支持简单的k/v类型的数据,同时还提供了list,set,zset,hash等数据结构的存储 
<span class="token number">2</span><span class="token punctuation">)</span>.Redis支持master-slave<span class="token punctuation">(</span>主-从<span class="token punctuation">)</span>模式应用 
<span class="token number">3</span><span class="token punctuation">)</span>.Redis支持数据的持久化
</code></pre> 
<h3><a id="4Redis_266"></a>4、安装Redis</h3> 
<h5><a id="1redis_270"></a>1、安装单机版redis</h5> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@redis-master ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /data/application     ---创建工作目录</span>
<span class="token punctuation">[</span>root@redis-master ~<span class="token punctuation">]</span><span class="token comment"># wget https://download.redis.io/releases/redis-6.2.7.tar.gz   ---下载redis</span>
<span class="token punctuation">[</span>root@redis-master ~<span class="token punctuation">]</span><span class="token comment"># tar xzf redis-6.2.7.tar.gz -C /data/application/    ---解压</span>
<span class="token punctuation">[</span>root@redis-master ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/</span>
<span class="token punctuation">[</span>root@redis-master application<span class="token punctuation">]</span><span class="token comment"># mv redis-6.2.7/ redis</span>
<span class="token punctuation">[</span>root@redis-master application<span class="token punctuation">]</span><span class="token comment"># cd redis/</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># yum install -y gcc make  #安装编译工具</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># make</span>
注：如果报错请将刚才解压的安装包删除掉，再次重新解压并进行make安装即可。
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># mv redis.conf redis.conf.bak</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf     ---修改如下</span>
<span class="token builtin class-name">bind</span> <span class="token number">192.168</span>.246.202　　<span class="token comment">#只监听内网IP</span>
daemonize <span class="token function">yes</span>　　　　　<span class="token comment">#开启后台模式将no改为yes</span>
port <span class="token number">6379</span>                      <span class="token comment">#端口号</span>
<span class="token function">dir</span> /data/application/redis/data　　<span class="token comment">#本地数据库存放持久化数据的目录该目录-----需要存在</span>
创建存放数据的目录
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># mkdir /data/application/redis/data</span>
配置redis为systemctl启动
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># cd /lib/systemd/system</span>
<span class="token punctuation">[</span>root@redis-master system<span class="token punctuation">]</span><span class="token comment"># vim redis.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Redis
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/data/application/redis/src/redis-server /data/application/redis/redis.conf  <span class="token parameter variable">--daemonize</span> no
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/data/application/redis/src/redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token function">shutdown</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
参数详解:
• <span class="token punctuation">[</span>Unit<span class="token punctuation">]</span> 表示这是基础信息 
• Description 是描述
• After 是在那个服务后面启动，一般是网络服务启动后启动

• <span class="token punctuation">[</span>Service<span class="token punctuation">]</span> 表示这里是服务信息 
• ExecStart 是启动服务的命令
• ExecStop 是停止服务的指令

• <span class="token punctuation">[</span>Install<span class="token punctuation">]</span> 表示这是是安装相关信息 
• WantedBy 是以哪种方式启动：multi-user.target表明当系统以多用户方式（默认的运行级别）启动时，这个服务需要被自动运行。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token number">8</span>.启动服务:
<span class="token punctuation">[</span>root@redis-master system<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload  #重新加载</span>
<span class="token punctuation">[</span>root@redis-master system<span class="token punctuation">]</span><span class="token comment"># systemctl start redis.service</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/0d/a4kbdjHJ_o.png" alt="img"></p> 
<pre><code class="prism language-shell">登陆redis
<span class="token punctuation">[</span>root@redis-master system<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/src/</span>
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># ./redis-cli -h 192.168.246.202 -p 6379</span>
<span class="token number">192.168</span>.246.202:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>     ---测试redis是否可以用
PONG
<span class="token number">192.168</span>.246.202:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name xiaoming    <span class="token comment">#设置key--name，并设置值</span>
OK
<span class="token number">192.168</span>.246.202:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name    <span class="token comment">#获取到key</span>
<span class="token string">"xiaoming"</span>
<span class="token number">192.168</span>.246.202:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
单机版redis已经部署完成。将ip和端口发给开发就可以了。

<span class="token number">192.168</span>.246.202:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> key value <span class="token punctuation">[</span>EX seconds<span class="token punctuation">]</span> <span class="token punctuation">[</span>PX milliseconds<span class="token punctuation">]</span> <span class="token punctuation">[</span>NX<span class="token operator">|</span>XX<span class="token punctuation">]</span>
EX seconds ： 将键的过期时间设置为 seconds 秒。 执行 SET key value EX seconds 的效果等同于执行 SETEX key seconds value。
PX milliseconds ： 将键的过期时间设置为 milliseconds 毫秒。 执行 SET key value PX milliseconds 的效果等同于执行 PSETEX key milliseconds value。
NX ： 只在键不存在时， 才对键进行设置操作。
XX ： 只在键已经存在时， 才对键进行设置操作。

使用 EX 选项：
<span class="token punctuation">[</span>root@localhost src<span class="token punctuation">]</span><span class="token comment"># ./redis-cli -h 192.168.62.231 -p 6379</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name1 xiaohong EX <span class="token number">10</span>
OK
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name1
<span class="token string">"xiaohong"</span>
等待10s，再次查看
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name1
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>

使用 PX 选项：
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name2 xiaohong PX <span class="token number">3233</span>
OK
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name2
<span class="token string">"xiaohong"</span>
等待3s，再次查看
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name2
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>

使用 NX 选项：
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> class <span class="token number">2204</span> NX
OK <span class="token comment"># 键不存在，设置成功</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get class
<span class="token string">"2204"</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> class <span class="token number">2205</span> NX
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>  <span class="token comment"># 键已经存在，设置失败</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get class
<span class="token string">"2204"</span>  <span class="token comment"># 维持原值不变</span>

使用 XX 选项：
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> home taikang XX
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>  <span class="token comment"># 因为键不存在，设置失败</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> home taikang
OK <span class="token comment"># 先给键设置一个值</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> home zhengzhou XX
OK <span class="token comment"># 设置新值成功</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get home
<span class="token string">"zhengzhou"</span>

删除：
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del class
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">192.168</span>.62.231:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get class
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre> 
<h6><a id="redis_396"></a><strong>redis的相关工具</strong></h6> 
<pre><code class="prism language-shell">./redis-cli           <span class="token comment">#redis的客户端</span>
./redis-server        <span class="token comment">#redis的服务端</span>
./redis-check-aof     <span class="token comment">#用于修复出问题的AOF文件</span>
./redis-sentinel      <span class="token comment">#用于集群管理</span>
</code></pre> 
<h4><a id="5_409"></a>5、数据持久化</h4> 
<p>即把数据保存到可永久保存的存储设备中（如磁盘）。</p> 
<h6><a id="1redis___417"></a><strong>1、redis持久化 – 两种方式</strong></h6> 
<pre><code class="prism language-shell">一、redis提供了两种持久化的方式，分别是RDB（Redis DataBase）和AOF（Append Only File）。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
RDB（Redis DataBase）：是在不同的时间点，将redis存储的数据生成快照并存储到磁盘等介质上；
特点:
<span class="token number">1</span>.周期性
<span class="token number">2</span>.不影响数据写入  <span class="token comment">#RDB会启动子进程，备份所有数据。当前进程，继续提供数据的读写。当备份完成，才替换老的备份文件。</span>
<span class="token number">3</span>.高效     <span class="token comment">#一次性还原所有数据</span>
<span class="token number">4</span>.完整性较差 <span class="token comment">#故障点到上一次备份，之间的数据无法恢复。</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
AOF（Append Only File）则是换了一个角度来实现持久化，那就是将redis执行过的所有写指令记录下来，在下次redis重新启动时，只要把这些写指令从前到后再重复执行一遍，就可以实现数据恢复了。
特点:
<span class="token number">1</span>.实时性
<span class="token number">2</span>.完整性较好
<span class="token number">3</span>.体积大  <span class="token comment">#记录数据的指令，删除数据的指令都会被记录下来。</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
二、RDB和AOF两种方式也可以同时使用，在这种情况下，如果redis重启的话，则会优先采用AOF方式来进行数据恢复，这是因为AOF方式的数据恢复完整度更高。
三、如何选择方式？
缓存：不用开启任何持久方式
双开:因RDB数据不实时，但同时使用两者时服务器只会找AOF文件,所以RDB留作以防万一的手段。
官方的建议是两个同时使用。这样可以提供更可靠的持久化方案。
写入速度快 ------------AOF
写入速度慢 ------------RDB
</code></pre> 
<h6><a id="2_448"></a>2、持久化配置</h6> 
<pre><code class="prism language-shell"><span class="token number">1</span>、RDB默认开启：
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf</span>
<span class="token comment">#dbfilename：持久化数据存储在本地的文件</span>
dbfilename dump.rdb
<span class="token comment">#dir：持久化数据存储在本地的路径</span>
<span class="token function">dir</span> /data/application/redis/data
<span class="token comment">##snapshot触发的时机，save &lt;seconds&gt; &lt;changes&gt; </span>
<span class="token comment">##如下为900秒后，至少有一个变更操作，才会snapshot  </span>
<span class="token comment">##对于此值的设置，需要谨慎，评估系统的变更操作密集程度  </span>
<span class="token comment">##可以通过save “”来关闭snapshot功能  </span>
<span class="token comment">#save时间，以下分别表示更改了1个key时间隔900s进行持久化存储；更改了10个key300s进行存储；更改10000个key60s进行存储。</span>
save <span class="token number">900</span> <span class="token number">1</span>
save <span class="token number">300</span> <span class="token number">10</span>
save <span class="token number">60</span> <span class="token number">10000</span> 
<span class="token comment">##yes代表当使用bgsave命令持久化出错时候停止写RDB快照文件,no表明忽略错误继续写文件，“错误”可能因为磁盘已满/磁盘故障/OS级别异常等</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>
<span class="token comment">##是否启用rdb文件压缩，默认为“yes”，压缩往往意味着“额外的cpu消耗”，同时也意味着较短的网络传输时间  </span>
rdbcompression <span class="token function">yes</span> 
注意:每次快照持久化都是将内存数据完整写入到磁盘一次，如果数据量大的话，而且写操作比较多，必然会引起大量的磁盘io操作，可能会严重影响性能。
</code></pre> 
<pre><code class="prism language-shell"><span class="token number">3</span>、AOF默认关闭--开启
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf</span>
修改如下:
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/2b/4K6yrlZr_o.png" alt="img"></p> 
<pre><code class="prism language-shell"><span class="token number">1</span>、此选项为aof功能的开关，默认为“no”，可以通过“yes”来开启aof功能,只有在“yes”下，aof重写/文件同步等特性才会生效
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">2</span>、指定aof文件名称
appendfilename appendonly.aof  
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">3</span>、指定aof操作中文件同步策略，有三个合法值：always everysec no,默认为everysec
appendfsync everysec
always     <span class="token comment">#每次有数据修改发生时都会写入AOF文件</span>
everysec   <span class="token comment">#每秒钟同步一次，该策略为AOF的缺省策略/默认策略</span>
no         <span class="token comment">#从不同步。高效但是数据不会被持久化</span>
</code></pre> 
<p><strong>开启持久化功能后，重启redis后，数据会自动通过持久化文件恢复</strong></p> 
<p>拓展RDB快照备份恢复：</p> 
<p>redis数据库备份与恢复（dump.rdb快照方式），两台机器</p> 
<pre><code class="prism language-plain">做备份机器的redis.conf配置文件内容：
bind 0.0.0.0
dbfilename dump.rdb
dir /data/application/redis/data
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
</code></pre> 
<pre><code class="prism language-plain">备份数据：
[root@redis-slave-1 redis]# src/redis-cli 
127.0.0.1:6379&gt; set name3 qianfeng
OK
127.0.0.1:6379&gt; set name4 tianyun
OK
127.0.0.1:6379&gt; BGSAVE   执行备份，或者敲SAVE
[root@redis-slave-1 redis]# ls data/
dump.rdb

[root@redis-slave-1 redis]# scp data/dump.rdb 192.168.62.135:/usr/local/redis/data/
</code></pre> 
<pre><code class="prism language-plain">恢复数据的机器：
修改redis.conf配置文件
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/fd/KxzwbkUB_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/c3/dc/TwU9uHc4_o.png" alt="img"></p> 
<pre><code class="prism language-shell">将dump.rdb数据文件存放到配置文件制定的目录下，直接启动即可
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># src/redis-server redis.conf &amp;</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># src/redis-cli</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name3
<span class="token string">"qianfeng"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name4
<span class="token string">"tianyun"</span>
</code></pre> 
<h5><a id="6Redis_575"></a>6、Redis主从配置</h5> 
<h5><a id="_579"></a>主从简介</h5> 
<h6><a id="1___583"></a><strong>1、主从 – 用法</strong></h6> 
<p>像MySQL一样，redis是支持主从同步的，而且也支持一主多从以及多级从结构。</p> 
<p>主从结构，一是为了纯粹的冗余备份，二是为了提升读性能，比如很消耗性能的操作就可以由从服务器来处理。<br> redis的主从同步是异步进行的，这意味着主从同步不会影响主逻辑，也不会降低redis的处理性能。<br> <strong>主从架构中，可以考虑关闭主服务器的数据持久化功能，只让从服务器进行持久化，这样可以提高主服务器的处理性能。</strong></p> 
<h6><a id="2_597"></a><strong>2、主从同步原理</strong></h6> 
<pre><code class="prism language-shell">主从 – 同步原理
从服务器会向主服务器发出SYNC指令，当主服务器接到此命令后，就会调用BGSAVE指令来创建一个子进程专门进行数据持久化工作，也就是将主服务器的数据写入RDB文件中。在数据持久化期间，主服务器将执行的写指令都缓存在内存中。

在BGSAVE指令执行完成后，主服务器会将持久化好的RDB文件发送给从服务器，从服务器接到此文件后会将其存储到磁盘上，然后再将其读取到内存中。这个动作完成后，主服务器会将这段时间缓存的写指令再以redis协议的格式发送给从服务器。


另外，要说的一点是，即使有多个从服务器同时发来SYNC指令，主服务器也只会执行一次BGSAVE，然后把持久化好的RDB文件发给多个从服务器。

而在2.8版本之后，redis支持了效率更高的增量同步策略，这大大降低了连接断开的恢复成本。主服务器会在内存中维护一个缓冲区，缓冲区中存储着将要发给从服务器的内容。从服务器在与主服务器出现网络瞬断之后，从服务器会尝试再次与主服务器连接，一旦连接成功，主服务器就会向从服务器发送增量内容。

增量同步功能，需要服务器端支持全新的PSYNC指令。这个指令，只有在redis-2.8之后才具有。
</code></pre> 
<p>了解</p> 
<pre><code class="prism language-shell">BGSAVE指令:
在后台异步<span class="token punctuation">(</span>Asynchronously<span class="token punctuation">)</span>保存当前数据库的数据到磁盘。
BGSAVE 命令执行之后立即返回 OK ，然后 Redis fork 出一个新子进程，原来的 Redis 进程<span class="token punctuation">(</span>父进程<span class="token punctuation">)</span>继续处理客户端请求，而子进程则负责将数据保存到磁盘，然后退出。
</code></pre> 
<h6><a id="3Redis_629"></a>3、部署三台机器Redis—主从同步</h6> 
<pre><code class="prism language-shell">redis-master----192.168.246.202
redis-slave-1-----192.168.246.203
redis-slave-2-----192.168.246.204
<span class="token number">1</span>.首先三台服务器将redis部署完成。
<span class="token number">2</span>.编辑master的redis配置文件:
<span class="token punctuation">[</span>root@redis-master ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/13/5d/XkVL4jLB_o.png" alt="img"></p> 
<p>关闭protected-mode模式，此时外部网络可以直接访问</p> 
<p>开启protected-mode保护模式，需配置bind ip或者设置访问密码</p> 
<pre><code class="prism language-shell"><span class="token number">3</span>.启动主节点redis服务
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/src</span>
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># ./redis-server ../redis.conf &amp;   会加载此文件中的配置信息</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token number">4</span>.修改slave1的配置文件：
<span class="token punctuation">[</span>root@redis-slave-1 ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/</span>
<span class="token punctuation">[</span>root@redis-slave-1 redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf      ---修改如下：</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/c6/5veSA9cB_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/60/9e/jlGErkyc_o.png" alt="img"></p> 
<pre><code class="prism language-shell"><span class="token number">5</span>.启动从节点1的redis服务
<span class="token punctuation">[</span>root@redis-slave-1 ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/src/</span>
<span class="token punctuation">[</span>root@redis-slave-1 src<span class="token punctuation">]</span><span class="token comment"># ./redis-server ../redis.conf &amp;</span>
</code></pre> 
<pre><code class="prism language-shell"><span class="token number">6</span>.修改slave2的配置文件
<span class="token punctuation">[</span>root@redis-slave-2 ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/</span>
<span class="token punctuation">[</span>root@redis-slave-2 redis<span class="token punctuation">]</span><span class="token comment"># vim redis.conf       ---修改如下</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/df/Rc5Ft4mB_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/fe/82/xNZdak1Z_o.png" alt="img"></p> 
<pre><code class="prism language-shell"><span class="token number">7</span>.启动从节点2的redis服务
<span class="token punctuation">[</span>root@ansible-web2 ~<span class="token punctuation">]</span><span class="token comment"># cd /data/application/redis/src/</span>
<span class="token punctuation">[</span>root@ansible-web2 src<span class="token punctuation">]</span><span class="token comment"># ./redis-server ../redis.conf &amp;</span>
</code></pre> 
<pre><code class="prism language-shell">或者，配置到了系统管理工具里面直接可以以下操作
<span class="token number">8</span>.重启三台redis
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># systemctl restart redis.service</span>
<span class="token punctuation">[</span>root@redis-slave-1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart redis.service</span>
<span class="token punctuation">[</span>root@redis-slave-2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart redis.service</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9e/80/lhg7Wq0W_o.png" alt="img"></p> 
<pre><code class="prism language-shell"><span class="token number">9</span>.测试主从
<span class="token number">1</span>.在master上面执行
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># cd src/</span>
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># ./redis-cli </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name jack
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"jack"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>

<span class="token number">2</span>.分别在slave-1和slave-2上面执行:
<span class="token punctuation">[</span>root@redis-slave-1 redis<span class="token punctuation">]</span><span class="token comment"># cd src/</span>
<span class="token punctuation">[</span>root@redis-slave-1 src<span class="token punctuation">]</span><span class="token comment"># ./redis-cli </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"jack"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
<span class="token punctuation">[</span>root@redis-slave-2 src<span class="token punctuation">]</span><span class="token comment"># ./redis-cli </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"jack"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
查看复制状态
master执行：
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">192.168</span>.246.203,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">490</span>,lag<span class="token operator">=</span><span class="token number">0</span>
slave1:ip<span class="token operator">=</span><span class="token number">192.168</span>.246.204,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">490</span>,lag<span class="token operator">=</span><span class="token number">1</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
slave上面执行：
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:192.168.246.202
master_port:6379
master_link_status:up
</code></pre> 
<p>注意：从服务器一般默认禁止写入操作：slave-read-only yes</p> 
<p><strong>主从同步部署完成！</strong></p> 
<h3><a id="7Redissentinel_782"></a><strong>7.Redis-sentinel—哨兵模式</strong></h3> 
<h6><a id="1Redis_Sentinel_786"></a>1、哨兵简介:Redis Sentinel</h6> 
<p><strong>Sentinel(哨兵)是用于监控Redis集群中Master状态的工具</strong>，其已经被集成在redis2.4+的版本中是Redis官方推荐的高可用性(HA)解决方案。</p> 
<h6><a id="2_796"></a>2、作用</h6> 
<p>1)：Master状态检测<br> 2)：如果Master异常，则会进行Master-Slave切换，将其中一个Slave作为Master，将之前的Master作为Slave<br> 3)：Master-Slave切换后，sentinel.conf的监控目标会随之调换</p> 
<h6><a id="3_806"></a>3、工作模式</h6> 
<p>1)：每个Sentinel以每秒钟一次的频率向它所知的Master，Slave以及其他 Sentinel 实例发送一个 PING 命令</p> 
<p>2)：如果一个实例（instance）距离最后一次有效回复 PING 命令的时间超过 down-after-milliseconds 选项所指定的值， 则这个实例会被 Sentinel 标记为主观下线。</p> 
<p>3)：如果一个Master被标记为主观下线，则正在监视这个Master的所有 Sentinel 要以每秒一次的频率确认Master的确进入了主观下线状态。</p> 
<p>4)：当有足够数量的 Sentinel（大于等于配置文件指定的值）在指定的时间范围内确认Master的确进入了主观下线状态， 则Master会被标记为客观下线 。</p> 
<p>5): 主从切换</p> 
<h6><a id="4_828"></a>4、主观下线和客观下线</h6> 
<p>主观下线：Subjectively Down，简称 SDOWN，指的是当前一个Sentinel 实例对某个redis服务器做出的下线判断。<br> 客观下线：Objectively Down， 简称 ODOWN，指的是多个 Sentinel 实例在对Master Server做出 SDOWN 判断，并且通过 SENTINEL is-master-down-by-addr 命令互相交流之后，得出的Master Server下线判断，然后开启failover/故障转移</p> 
<h6><a id="5_837"></a>5、配置哨兵模式</h6> 
<pre><code class="prism language-shell"><span class="token number">1</span>.每台机器上修改redis主配置文件redis.conf文件设置：bind <span class="token number">0.0</span>.0.0   ---已经操作
<span class="token number">2</span>.每台机器上修改sentinel.conf配置文件：修改如下配置
<span class="token punctuation">[</span>root@redis-master src<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># vim sentinel.conf</span>
sentinel monitor mymaster <span class="token number">10.0</span>.0.137 <span class="token number">6379</span> <span class="token number">2</span> <span class="token comment">#当集群中有2个sentinel认为master死了时，才能真正认为该master已经不可用了。 (slave上面写的是master的ip，master写自己ip)</span>
sentinel down-after-milliseconds mymaster <span class="token number">3000</span>   <span class="token comment">#单位毫秒</span>
sentinel failover-timeout mymaster <span class="token number">10000</span>   <span class="token comment">#若sentinel在该配置值内未能完成failover(故障转移)操作（即故障时master/slave自动切换），则认为本次failover失败。</span>
protected-mode no  <span class="token comment">#关闭加密模式--新添加到sentinel配置文件中</span>
<span class="token number">3</span>.每台机器启动哨兵服务：
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># ./src/redis-sentinel sentinel.conf </span>
注意:在生产环境下将哨兵模式启动放到后台执行:     ./src/redis-sentinel sentinel.conf <span class="token operator">&amp;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/08/cwmmwipJ_o.png" alt="img"></p> 
<p>将master的哨兵模式退出（Crtl+c），再将redis服务stop了，在两台slave上面查看其中一台是否切换为master:(没有优先级，为随机切换)</p> 
<pre><code class="prism language-shell">^C4854:signal-handler <span class="token punctuation">(</span><span class="token number">1564349039</span><span class="token punctuation">)</span> Received SIGINT scheduling shutdown<span class="token punctuation">..</span>.
<span class="token number">4854</span>:X <span class="token number">29</span> Jul 05:23:59.592 <span class="token comment"># User requested shutdown...</span>
<span class="token number">4854</span>:X <span class="token number">29</span> Jul 05:23:59.592 <span class="token comment"># Sentinel is now ready to exit, bye bye...</span>
<span class="token punctuation">[</span>root@redis-master redis<span class="token punctuation">]</span><span class="token comment"># systemctl stop redis.service</span>
或者用kill命令杀死
</code></pre> 
<p>在slave机器上面查看:</p> 
<p><img src="https://images2.imgbox.com/2d/ae/zxT06YR9_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/01/c4/YbF6MgoA_o.png" alt="img"></p> 
<p>扩展：php安装redis的模块</p> 
<pre><code class="prism language-shell"><span class="token number">1</span>.安装php7.0
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># yum install php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-mysql.x86_64 php70w-pdo.x86_64 php70w-devel zlib-devel php70w-fpm  -y</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># yum install -y make gcc zlib-devel libmemcached-devel git</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># wget http://pecl.php.net/get/redis-4.0.0RC2.tgz #下载扩展</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># tar xzf redis-4.0.0RC2.tgz</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># cd redis-4.0.0RC2</span>
<span class="token punctuation">[</span>root@redis redis-4.0.0RC2<span class="token punctuation">]</span><span class="token comment"># /usr/bin/phpize   #---生成./configure 这个配置文件</span>
<span class="token punctuation">[</span>root@redis redis-4.0.0RC2<span class="token punctuation">]</span><span class="token comment"># ./configure -with-php-config=/usr/bin/php-config</span>
<span class="token punctuation">..</span>.
configure: creating ./config.status
config.status: creating config.h
config.status: executing libtool commands
<span class="token punctuation">[</span>root@ansible-web3 redis-4.0.0RC2<span class="token punctuation">]</span><span class="token comment"># make &amp;&amp; make install  #编译，最后显示如下表示成功</span>
Build complete.
Don<span class="token string">'t forget to run '</span><span class="token function">make</span> test'.
Installing shared extensions:     /usr/lib64/php/modules/
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/php.ini #添加扩展</span>
搜索: <span class="token punctuation">\</span>.so
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/54/0PcwANKy_o.png" alt="img"></p> 
<pre><code class="prism language-shell"><span class="token number">2</span>.安装nginx，配置nginx的yum源--略
配置nginx连接php
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/nginx/conf.d/nginx.conf</span>
server <span class="token punctuation">{<!-- --></span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        root           /usr/share/nginx/html<span class="token punctuation">;</span>
        fastcgi_pass   <span class="token number">127.0</span>.0.1:9000<span class="token punctuation">;</span>
        fastcgi_index  index.php<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        include        fastcgi_params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
编辑php页面
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/share/nginx/html/</span>
<span class="token punctuation">[</span>root@redis html<span class="token punctuation">]</span><span class="token comment"># vi index.php</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
启动nginx与php
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># systemctl start nginx</span>
<span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># systemctl start php-fpm</span>
</code></pre> 
<p>访问：</p> 
<p><img src="https://images2.imgbox.com/9c/89/MnzYbZC0_o.png" alt="img"></p> 
<p>安装扩展完成！</p> 
<h3><a id="_964"></a>面试:</h3> 
<pre><code class="prism language-shell">redis有哪些优点
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 速度快，因为数据存在内存中。
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 支持丰富数据类型，支持string，list，set，hash等
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> 支持事务，操作都是原子性，就是对数据的更改要么全部执行，要么全部不执行
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> 丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除

redis相比memcached有哪些优势
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> redis可以持久化其数据

redis常见性能问题和解决方案
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> 为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> 尽量避免在压力很大的主库上增加从库
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> 主从复制不要用树状结构，用单向链表结构更为稳定，即：Master（写） <span class="token operator">&lt;</span>- Slave1（读） <span class="token operator">&lt;</span>- Slave2（读） <span class="token operator">&lt;</span>- Slave3（读）<span class="token punctuation">..</span>.
这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。
redis集群的工作原理
主多从+哨兵模式
</code></pre> 
<p>了解:</p> 
<p>redis–快照</p> 
<pre><code class="prism language-shell">快照，主要涉及的是redis的RDB持久化相关的配置

用如下的指令来让数据保存到磁盘上，即控制RDB快照功能：

save <span class="token operator">&lt;</span>seconds<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>changes<span class="token operator">&gt;</span>

举例
save <span class="token number">900</span> <span class="token number">1</span> //表示每15分钟且至少有1个key改变，就触发一次持久化
save <span class="token number">300</span> <span class="token number">10</span> //表示每5分钟且至少有10个key改变，就触发一次持久化
save <span class="token number">60</span> <span class="token number">10000</span> //表示每60秒至少有10000个key改变，就触发一次持久化

如果想禁用RDB持久化的策略，只要不设置任何save指令就可以，或者给save传入一个空字符串参数也可以达到相同效果，就像这样：

save <span class="token string">""</span>
</code></pre> 
<p>安全:为redis加密：</p> 
<pre><code class="prism language-shell">可以要求redis客户端在向redis-server发送请求之前，先进行密码验证。当你的redis-server处于一个不太可信的网络环境中时，相信你会用上这个功能。由于redis性能非常高，所以每秒钟可以完成多达15万次的密码尝试，所以你最好设置一个足够复杂的密码，否则很容易被黑客破解。

requirepass <span class="token number">123456</span>

这里我们通过requirepass将密码设置成“123456”。
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d820bf53863cfa8dd70de9ba76018983/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows10安装MySQL数据库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07fe495cd6e65e9caaeb86daa8dc6b36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023大数据面试总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>