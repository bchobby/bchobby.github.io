<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring boot应用p6spy监控sql - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="spring boot应用p6spy监控sql" />
<meta property="og:description" content="Spring boot中使用p6spy监控hibernate sql语句值 开发环境 开发工具：IDEA开发环境：spring mvc、spring boot、spring data数据库:mysql 具体步骤如下： pom.xml中添加p6spy包依赖： &lt;dependency&gt; &lt;groupId&gt;p6spy&lt;/groupId&gt; &lt;artifactId&gt;p6spy&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;/dependency&gt; application.yml配置中： (1). url中必须增加p6spy,才能对SQL进行拦截：
jdbc:p6spy:mysql://192.0.6.116:3066/testdb
(2). driver-class需替换为：
com.p6spy.engine.spy.P6SpyDriver
具体如下：
spring: datasource: url: jdbc:p6spy:mysql://192.0.6.116:3066/testdb #driver-class-name: com.mysql.jdbc.Driver driver-class-name: com.p6spy.engine.spy.P6SpyDriver username: root password: xxxxxx 将spy.properties放到resources根目录下 spy.properties文件内容参考如下：
### # #%L # P6Spy # %% # Copyright (C) 2013 P6Spy # %% # Licensed under the Apache License, Version 2.0 (the &#34;License&#34;); # you may not use this file except in compliance with the License." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/2fdbe061b8db1ed6b8e6a18e3b0afa29/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-14T16:34:07+08:00" />
<meta property="article:modified_time" content="2017-07-14T16:34:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring boot应用p6spy监控sql</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5 id="spring-boot中使用p6spy监控hibernate-sql语句值">Spring boot中使用p6spy监控hibernate sql语句值</h5> 
<h5 id="开发环境">开发环境</h5> 
<ul><li>开发工具：IDEA</li><li>开发环境：spring mvc、spring boot、spring data</li><li>数据库:mysql</li></ul> 
<h5 id="具体步骤如下">具体步骤如下：</h5> 
<ul><li>pom.xml中添加p6spy包依赖：</li></ul> 
<pre class="prettyprint"><code class="language-xml hljs ">        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>p6spy<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>p6spy<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre> 
<ul><li>application.yml配置中：</li></ul> 
<p>(1). url中必须增加p6spy,才能对SQL进行拦截：</p> 
<blockquote> 
 <p>jdbc:<font color="red">p6spy</font>:mysql://192.0.6.116:3066/testdb</p> 
</blockquote> 
<p>(2). driver-class需替换为：</p> 
<blockquote> 
 <p>com.p6spy.engine.spy.P6SpyDriver</p> 
</blockquote> 
<p>具体如下：</p> 
<pre class="prettyprint"><code class="language-txt hljs avrasm"><span class="hljs-label">spring:</span>
  datasource:
    url: jdbc:p6spy:mysql://<span class="hljs-number">192.0</span><span class="hljs-number">.6</span><span class="hljs-number">.116</span>:<span class="hljs-number">3066</span>/testdb
    <span class="hljs-preprocessor">#driver-class-name: com.mysql.jdbc.Driver</span>
    driver-class-name: <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.p</span>6spy<span class="hljs-preprocessor">.engine</span><span class="hljs-preprocessor">.spy</span><span class="hljs-preprocessor">.P</span>6SpyDriver
    username: root
    password: xxxxxx</code></pre> 
<ul><li>将spy.properties放到resources根目录下</li></ul> 
<p>spy.properties文件内容参考如下：</p> 
<pre class="prettyprint"><code class="language-txt hljs vala"><span class="hljs-preprocessor">###</span>
<span class="hljs-preprocessor"># #%L</span>
<span class="hljs-preprocessor"># P6Spy</span>
<span class="hljs-preprocessor"># %%</span>
<span class="hljs-preprocessor"># Copyright (C) 2013 P6Spy</span>
<span class="hljs-preprocessor"># %%</span>
<span class="hljs-preprocessor"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="hljs-preprocessor"># you may not use this file except in compliance with the License.</span>
<span class="hljs-preprocessor"># You may obtain a copy of the License at</span>
<span class="hljs-preprocessor"># </span>
<span class="hljs-preprocessor">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="hljs-preprocessor"># </span>
<span class="hljs-preprocessor"># Unless required by applicable law or agreed to in writing, software</span>
<span class="hljs-preprocessor"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="hljs-preprocessor"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="hljs-preprocessor"># See the License for the specific language governing permissions and</span>
<span class="hljs-preprocessor"># limitations under the License.</span>
<span class="hljs-preprocessor"># #L%</span>
<span class="hljs-preprocessor">###</span>

<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor"># P6Spy Options File                                            #</span>
<span class="hljs-preprocessor"># See documentation for detailed instructions                   #</span>
<span class="hljs-preprocessor"># http://p6spy.github.io/p6spy/2.0/configandusage.html          #</span>
<span class="hljs-preprocessor">#################################################################</span>

<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor"># MODULES                                                       #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># Module list adapts the modular functionality of P6Spy.        #</span>
<span class="hljs-preprocessor"># Only modules listed are active.                               #</span>
<span class="hljs-preprocessor"># (default is com.p6spy.engine.logging.P6LogFactory and         #</span>
<span class="hljs-preprocessor"># com.p6spy.engine.spy.P6SpyFactory)                            #</span>
<span class="hljs-preprocessor"># Please note that the core module (P6SpyFactory) can't be      # </span>
<span class="hljs-preprocessor"># deactivated.                                                  #</span>
<span class="hljs-preprocessor"># Unlike the other properties, activation of the changes on     #</span>
<span class="hljs-preprocessor"># this one requires reload.                                     #</span>
<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor">#modulelist=com.p6spy.engine.spy.P6SpyFactory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory</span>
modulelist=com.p6spy.engine.spy.P6SpyFactory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory
<span class="hljs-preprocessor">################################################################</span>
<span class="hljs-preprocessor"># CORE (P6SPY) PROPERTIES                                      #</span>
<span class="hljs-preprocessor">################################################################</span>

<span class="hljs-preprocessor"># A comma separated list of JDBC drivers to load and register.</span>
<span class="hljs-preprocessor"># (default is empty)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note: This is normally only needed when using P6Spy in an</span>
<span class="hljs-preprocessor"># application server environment with a JNDI data source or when</span>
<span class="hljs-preprocessor"># using a JDBC driver that does not implement the JDBC 4.0 API</span>
<span class="hljs-preprocessor"># (specifically automatic registration).</span>
<span class="hljs-preprocessor">#driverlist=</span>
<span class="hljs-preprocessor">#url="jdbc:p6spy:oracle:thin:@localhost:1521:orcl" 其中的p6spy必须要，因为这样才会被拦截</span>
<span class="hljs-preprocessor">#drive=com.p6spy.engine.spy.P6SpyDriver</span>
<span class="hljs-preprocessor">#driverlist=oracle.jdbc.driver.OracleDriver</span>
driverlist=com.mysql.jdbc.Driver
<span class="hljs-preprocessor"># for flushing per statement</span>
<span class="hljs-preprocessor"># (default is false)</span>
<span class="hljs-preprocessor">#autoflush = false</span>


<span class="hljs-preprocessor"># prints a stack trace for every statement logged</span>
<span class="hljs-preprocessor">#stacktrace=false</span>
<span class="hljs-preprocessor"># if stacktrace=true, specifies the stack trace to print</span>
<span class="hljs-preprocessor">#stacktraceclass=</span>

<span class="hljs-preprocessor"># determines if property file should be reloaded</span>
<span class="hljs-preprocessor"># Please note: reload means forgetting all the previously set</span>
<span class="hljs-preprocessor"># settings (even those set during runtime - via JMX)</span>
<span class="hljs-preprocessor"># and starting with the clean table </span>
<span class="hljs-preprocessor"># (default is false)</span>
<span class="hljs-preprocessor">#reloadproperties=false</span>

<span class="hljs-preprocessor"># determines how often should be reloaded in seconds</span>
<span class="hljs-preprocessor"># (default is 60)</span>
<span class="hljs-preprocessor">#reloadpropertiesinterval=60</span>

<span class="hljs-preprocessor"># specifies the appender to use for logging</span>
<span class="hljs-preprocessor"># Please note: reload means forgetting all the previously set</span>
<span class="hljs-preprocessor"># settings (even those set during runtime - via JMX)</span>
<span class="hljs-preprocessor"># and starting with the clean table </span>
<span class="hljs-preprocessor"># (only the properties read from the configuration file)</span>
<span class="hljs-preprocessor"># (default is com.p6spy.engine.spy.appender.FileLogger)</span>
<span class="hljs-preprocessor">#appender=com.p6spy.engine.spy.appender.Slf4JLogger</span>
<span class="hljs-preprocessor">#appender=com.p6spy.engine.spy.appender.StdoutLogger</span>
appender=com.p6spy.engine.spy.appender.FileLogger

<span class="hljs-preprocessor"># name of logfile to use, note Windows users should make sure to use forward slashes in their pathname (e:/test/spy.log) </span>
<span class="hljs-preprocessor"># (used for com.p6spy.engine.spy.appender.FileLogger only)</span>
<span class="hljs-preprocessor"># (default is spy.log)</span>
<span class="hljs-preprocessor">#logfile = spy.log</span>
<span class="hljs-preprocessor">#windows 用户请用 C:/spy.log 格式，不要用\</span>
logfile =d:/spy.log

<span class="hljs-preprocessor"># append to the p6spy log file. if this is set to false the</span>
<span class="hljs-preprocessor"># log file is truncated every time. (file logger only)</span>
<span class="hljs-preprocessor"># (default is true)</span>
<span class="hljs-preprocessor">#追加到 p6spy 日志文件。如果设置为false</span>
<span class="hljs-preprocessor">#日志文件被截断每次。 （只限于文件记录器）</span>
<span class="hljs-preprocessor">#（默认为true）</span>
<span class="hljs-preprocessor">#append=true</span>

<span class="hljs-preprocessor"># class to use for formatting log messages (default is: com.p6spy.engine.spy.appender.SingleLineFormat)</span>
<span class="hljs-preprocessor">#多行输出为 com.p6spy.engine.spy.appender.MultiLineFormat</span>
<span class="hljs-preprocessor">#行的时间格式化配置在 dateformat 设定</span>
<span class="hljs-preprocessor">#current time|execution time|category|connection id|statement SQL String|effective SQL string</span>
<span class="hljs-preprocessor">#日志格式为 当前时间戳|执行语句花费的时间|调用的类别|connectionId|声明SQL字符串|有效的SQL字符串</span>
<span class="hljs-preprocessor">#logMessageFormat=com.p6spy.engine.spy.appender.SingleLineFormat</span>

<span class="hljs-preprocessor"># format that is used for logging of the date/time/... (has to be compatible with java.text.SimpleDateFormat)</span>
<span class="hljs-preprocessor"># (default is dd-MMM-yy)</span>
databaseDialectDateFormat=yyyy-MM-dd HH:mm:ss

<span class="hljs-preprocessor"># sets the date format using Java's SimpleDateFormat routine. </span>
<span class="hljs-preprocessor"># In case property is not set, miliseconds since 1.1.1970 (unix time) is used (default is empty)</span>
<span class="hljs-preprocessor">#dateformat=</span>
dateformat=yyyy-MM-dd HH:mm:ss

<span class="hljs-preprocessor"># whether to expose options via JMX or not</span>
<span class="hljs-preprocessor"># (default is true)</span>
<span class="hljs-preprocessor">#jmx=true</span>

<span class="hljs-preprocessor"># if exposing options via jmx (see option: jmx), what should be the prefix used?</span>
<span class="hljs-preprocessor"># jmx naming pattern constructed is: com.p6spy(.&lt;jmxPrefix&gt;)?:name=&lt;optionsClassName&gt;</span>
<span class="hljs-preprocessor"># please note, if there is already such a name in use it would be unregistered first (the last registered wins)</span>
<span class="hljs-preprocessor"># (default is none)</span>
<span class="hljs-preprocessor">#jmxPrefix=</span>

<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor"># DataSource replacement                                        #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># Replace the real DataSource class in your application server  #</span>
<span class="hljs-preprocessor"># configuration with the name com.p6spy.engine.spy.P6DataSource #</span>
<span class="hljs-preprocessor"># (that provides also connection pooling and xa support).       #</span>
<span class="hljs-preprocessor"># then add the JNDI name and class name of the real             #</span>
<span class="hljs-preprocessor"># DataSource here                                               #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># Values set in this item cannot be reloaded using the          #</span>
<span class="hljs-preprocessor"># reloadproperties variable. Once it is loaded, it remains      #</span>
<span class="hljs-preprocessor"># in memory until the application is restarted.                 #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor">#realdatasource=/RealMySqlDS</span>
<span class="hljs-preprocessor">#realdatasourceclass=com.mysql.jdbc.jdbc2.optional.MysqlDataSource</span>

<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor"># DataSource properties                                         #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># If you are using the DataSource support to intercept calls    #</span>
<span class="hljs-preprocessor"># to a DataSource that requires properties for proper setup,    #</span>
<span class="hljs-preprocessor"># define those properties here. Use name value pairs, separate  #</span>
<span class="hljs-preprocessor"># the name and value with a semicolon, and separate the         #</span>
<span class="hljs-preprocessor"># pairs with commas.                                            #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># The example shown here is for mysql                           #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor">#realdatasourceproperties=port;3306,serverName;myhost,databaseName;jbossdb,foo;bar</span>

<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor"># JNDI DataSource lookup                                        #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># If you are using the DataSource support outside of an app     #</span>
<span class="hljs-preprocessor"># server, you will probably need to define the JNDI Context     #</span>
<span class="hljs-preprocessor"># environment.                                                  #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># If the P6Spy code will be executing inside an app server then #</span>
<span class="hljs-preprocessor"># do not use these properties, and the DataSource lookup will   #</span>
<span class="hljs-preprocessor"># use the naming context defined by the app server.             #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># The two standard elements of the naming environment are       #</span>
<span class="hljs-preprocessor"># jndicontextfactory and jndicontextproviderurl. If you need    #</span>
<span class="hljs-preprocessor"># additional elements, use the jndicontextcustom property.      #</span>
<span class="hljs-preprocessor"># You can define multiple properties in jndicontextcustom,      #</span>
<span class="hljs-preprocessor"># in name value pairs. Separate the name and value with a       #</span>
<span class="hljs-preprocessor"># semicolon, and separate the pairs with commas.                #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># The example shown here is for a standalone program running on #</span>
<span class="hljs-preprocessor"># a machine that is also running JBoss, so the JDNI context     #</span>
<span class="hljs-preprocessor"># is configured for JBoss (3.0.4).                              #</span>
<span class="hljs-preprocessor">#                                                               #</span>
<span class="hljs-preprocessor"># (by default all these are empty)                              #</span>
<span class="hljs-preprocessor">#################################################################</span>
<span class="hljs-preprocessor">#jndicontextfactory=org.jnp.interfaces.NamingContextFactory</span>
<span class="hljs-preprocessor">#jndicontextproviderurl=localhost:1099</span>
<span class="hljs-preprocessor">#jndicontextcustom=java.naming.factory.url.pkgs;org.jboss.nameing:org.jnp.interfaces</span>

<span class="hljs-preprocessor">#jndicontextfactory=com.ibm.websphere.naming.WsnInitialContextFactory</span>
<span class="hljs-preprocessor">#jndicontextproviderurl=iiop://localhost:900</span>

<span class="hljs-preprocessor">################################################################</span>
<span class="hljs-preprocessor"># P6 LOGGING SPECIFIC PROPERTIES                               #</span>
<span class="hljs-preprocessor">################################################################</span>

<span class="hljs-preprocessor"># filter what is logged</span>
<span class="hljs-preprocessor"># please note this is a precondition for usage of: include/exclude/sqlexpression</span>
<span class="hljs-preprocessor"># (default is false)</span>
<span class="hljs-preprocessor">#filter=false</span>

<span class="hljs-preprocessor"># comma separated list of strings to include</span>
<span class="hljs-preprocessor"># please note that special characters escaping (used in java) has to be done for the provided regular expression</span>
<span class="hljs-preprocessor"># (default is empty)</span>
<span class="hljs-preprocessor">#include =</span>
<span class="hljs-preprocessor"># comma separated list of strings to exclude</span>
<span class="hljs-preprocessor"># (default is empty)</span>
<span class="hljs-preprocessor">#exclude =</span>

<span class="hljs-preprocessor"># sql expression to evaluate if using regex</span>
<span class="hljs-preprocessor"># please note that special characters escaping (used in java) has to be done for the provided regular expression</span>
<span class="hljs-preprocessor"># (default is empty)</span>
<span class="hljs-preprocessor">#sqlexpression = </span>

<span class="hljs-preprocessor">#list of categories to exclude: error, info, batch, debug, statement,</span>
<span class="hljs-preprocessor">#commit, rollback and result are valid values</span>
<span class="hljs-preprocessor"># (default is info,debug,result,resultset,batch)</span>
<span class="hljs-preprocessor">#excludecategories=info,debug,result,resultset,batch</span>

<span class="hljs-preprocessor"># Execution threshold applies to the standard logging of P6Spy.       </span>
<span class="hljs-preprocessor"># While the standard logging logs out every statement          </span>
<span class="hljs-preprocessor"># regardless of its execution time, this feature puts a time   </span>
<span class="hljs-preprocessor"># condition on that logging. Only statements that have taken   </span>
<span class="hljs-preprocessor"># longer than the time specified (in milliseconds) will be     </span>
<span class="hljs-preprocessor"># logged. This way it is possible to see only statements that  </span>
<span class="hljs-preprocessor"># have exceeded some high water mark.                          </span>
<span class="hljs-preprocessor"># This time is reloadable.                                     </span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># executionThreshold=integer time (milliseconds)</span>
<span class="hljs-preprocessor"># (default is 0)</span>
<span class="hljs-preprocessor">#executionThreshold=</span>

<span class="hljs-preprocessor">################################################################</span>
<span class="hljs-preprocessor"># P6 OUTAGE SPECIFIC PROPERTIES                                #</span>
<span class="hljs-preprocessor">################################################################</span>
<span class="hljs-preprocessor"># Outage Detection</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># This feature detects long-running statements that may be indicative of</span>
<span class="hljs-preprocessor"># a database outage problem. If this feature is turned on, it will log any</span>
<span class="hljs-preprocessor"># statement that surpasses the configurable time boundary during its execution.</span>
<span class="hljs-preprocessor"># When this feature is enabled, no other statements are logged except the long</span>
<span class="hljs-preprocessor"># running statements. The interval property is the boundary time set in seconds.</span>
<span class="hljs-preprocessor"># For example, if this is set to 2, then any statement requiring at least 2</span>
<span class="hljs-preprocessor"># seconds will be logged. Note that the same statement will continue to be logged</span>
<span class="hljs-preprocessor"># for as long as it executes. So if the interval is set to 2, and the query takes</span>
<span class="hljs-preprocessor"># 11 seconds, it will be logged 5 times (at the 2, 4, 6, 8, 10 second intervals).</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># outagedetection=true|false</span>
<span class="hljs-preprocessor"># outagedetectioninterval=integer time (seconds)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># (default is false)</span>
<span class="hljs-preprocessor">#outagedetection=false</span>
<span class="hljs-preprocessor"># (default is 60)</span>
<span class="hljs-preprocessor">#outagedetectioninterval=30</span>
</code></pre> 
<p><strong>其中spy.properties文件中的logMessageFormat可以使用自定义类，自定义输出格式：</strong></p> 
<blockquote> 
 <p>logMessageFormat=com.aellelib.common.utils.P6LogFormat</p> 
</blockquote> 
<p>P6LogFormat类代码如下：</p> 
<pre class="prettyprint"><code class="language-java hljs ">
<span class="hljs-keyword">package</span> com.aellelib.common.utils;

<span class="hljs-keyword">import</span> com.p6spy.engine.common.P6Util;
<span class="hljs-keyword">import</span> com.p6spy.engine.spy.appender.SingleLineFormat;
<span class="hljs-keyword">import</span> org.hibernate.engine.jdbc.internal.BasicFormatterImpl;

<span class="hljs-javadoc">/**
 * Created by aelle on 2017/7/12.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">P6LogFormat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SingleLineFormat</span> {<!-- --></span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> BasicFormatterImpl formatter = <span class="hljs-keyword">new</span> BasicFormatterImpl();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">formatMessage</span>(<span class="hljs-keyword">int</span> connectionId, String now, <span class="hljs-keyword">long</span> elapsed, String category, String prepared, String sql) {
        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
            i++;
            <span class="hljs-keyword">return</span> now + <span class="hljs-string">"|"</span> + <span class="hljs-string">""</span> + elapsed + <span class="hljs-string">"|"</span>  + <span class="hljs-string">""</span> + category + <span class="hljs-string">"|connection "</span> + <span class="hljs-string">""</span> + connectionId + <span class="hljs-string">"|"</span> + <span class="hljs-string">"\nAfter Prepared SQL:"</span> +
            formatter.format(P6Util.singleLine(prepared)) + <span class="hljs-string">"\nBefore Prepared SQL:"</span> + formatter.format(P6Util.singleLine(sql));
        } <span class="hljs-keyword">else</span> {
            i =  <span class="hljs-number">0</span>;
            <span class="hljs-keyword">return</span> now + <span class="hljs-string">"|"</span> + category + <span class="hljs-string">"|"</span> + <span class="hljs-string">"Time Consumin:"</span> + elapsed + <span class="hljs-string">"ms"</span>;
        }
    }
}


</code></pre> 
<p>注：本文参考了如下内容：</p> 
<p><a href="http://shoukaiseki.blog.163.com/blog/static/19285614920163129817280/" rel="nofollow">http://shoukaiseki.blog.163.com/blog/static/19285614920163129817280/</a></p> 
<p><a href="http://blog.csdn.net/qq_36224522/article/details/68059460">http://blog.csdn.net/qq_36224522/article/details/68059460</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a19a06ecfa89532ef98aaab3864d951a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">你所不知道的快速排序（js实现）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0c2fe94b85477f19f3ce5d6831e628f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jquery中each()方法的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>