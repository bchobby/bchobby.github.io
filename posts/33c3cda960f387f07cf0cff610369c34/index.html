<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解" />
<meta property="og:description" content="文章转载：https://blog.51cto.com/itwish/2160492
pache HTTP Server（简称Apache或httpd）是Apache软件基金会的一个开放源代码的网页服务器软件，旨在为unix，windows等操作系统中提供开源httpd服务。由于其安全性、高效性及可扩展性，被广泛使用，自1996年4月以来，Apache一直是Internet上最流行的HTTP服务器。它快速、可靠并且可通过简单的API扩充，将Perl／Python等解释器等编译到httpd的相关模块中。
HTTPD特性及功能 Apache支持许多特性，大部分通过编译的模块实现，这些特性从服务器端的编程语言支持到身份认证方案。通用的语言接口支持Perl，Python，Tcl 和 PHP；流行的认证模块包括mod_access，mod_auth和mod_digest；其他的有SSL和TLS支持（mod_ssl），代理服务器（proxy）模块，很有用的URL重写（由mod_rewrite实现），定制日志文件（mod_log_config），以及过滤支持（mod_include和mod_ext_filter）等。主要特性如下：
高度模块化设计： core &#43; modules 支持DSO：Dynamic Shared Object ，动态共享库 支持MPM模块：Multipath Processing Modules，多道处理模块 。 同时支持以下功能：虚拟主机 virtual host ；CGI：Common Gateway Interface，通用网关接口；丰富的用户认证机制：basic；digest；用户站点等。
MPM包含的机制 prefork机制：预先生成进程，服务器启动时会生产多个进程，并且每一个进程处理一个请求，比较稳定，任何一个进程崩溃了都不会影响到其他的进程 。如：select（）函数
worker机制：这是一种基于线程来工作，服务器启动时生成多个进程，每一个进程要生成多个线程，一个线程用来处理一个请求
event机制：基于事件驱动机制来工作的，这种机制可以使用一个进程来响应多个请求。它的并发能力是最强的。它在httpd-2.4以后得到支持。如event-driven ——事件驱动
Httpd yum安装与编译安装
1）Installing on CentOS6.x , yum源安装
yum install httpd -y 安装 chkconfig --add httpd 加入启动服务 chkconfig httpd on 默认启动级别自启动 service httpd start 启动httpd服务 httpd相关配置文件： 主配置文件：/etc/httpd/conf/httd.conf ，这个是httpd最主要的配置文档
扩展配置文件：/etc/httpd/conf.d/*.conf ，这个是httpd的额外配置文档
文档根目录： /var/www/html ，这个是apache 首页的文档目录 ，即输入http://127.0.0.1 显示页面所在的目录
服务脚本：/etc/rc.d/init.d/httpd
错误目录：/var/www/error ，服务器设定错误，请求的资源错误或浏览器访问出现错误等错误文件的存储目录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/33c3cda960f387f07cf0cff610369c34/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-12T16:04:55+08:00" />
<meta property="article:modified_time" content="2019-07-12T16:04:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>文章转载：<a href="https://blog.51cto.com/itwish/2160492" rel="nofollow">https://blog.51cto.com/itwish/2160492</a></strong></p> 
<p>pache HTTP Server（简称Apache或httpd）是Apache软件基金会的一个开放源代码的网页服务器软件，旨在为unix，windows等操作系统中提供开源httpd服务。由于其安全性、高效性及可扩展性，被广泛使用，自1996年4月以来，Apache一直是Internet上最流行的HTTP服务器。它快速、可靠并且可通过简单的API扩充，将Perl／Python等解释器等编译到httpd的相关模块中。</p> 
<pre><code>HTTPD特性及功能
</code></pre> 
<p>Apache支持许多特性，大部分通过编译的模块实现，这些特性从服务器端的编程语言支持到身份认证方案。通用的语言接口支持Perl，Python，Tcl 和 PHP；流行的认证模块包括mod_access，mod_auth和mod_digest；其他的有SSL和TLS支持（mod_ssl），代理服务器（proxy）模块，很有用的URL重写（由mod_rewrite实现），定制日志文件（mod_log_config），以及过滤支持（mod_include和mod_ext_filter）等。主要特性如下：</p> 
<pre><code>高度模块化设计： core + modules

支持DSO：Dynamic Shared Object ，动态共享库

支持MPM模块：Multipath Processing Modules，多道处理模块 。
</code></pre> 
<p>同时支持以下功能：虚拟主机 virtual host ；CGI：Common Gateway Interface，通用网关接口；丰富的用户认证机制：basic；digest；用户站点等。</p> 
<pre><code>MPM包含的机制
</code></pre> 
<p>prefork机制：预先生成进程，服务器启动时会生产多个进程，并且每一个进程处理一个请求，比较稳定，任何一个进程崩溃了都不会影响到其他的进程 。如：select（）函数</p> 
<p>worker机制：这是一种基于线程来工作，服务器启动时生成多个进程，每一个进程要生成多个线程，一个线程用来处理一个请求</p> 
<p>event机制：基于事件驱动机制来工作的，这种机制可以使用一个进程来响应多个请求。它的并发能力是最强的。它在httpd-2.4以后得到支持。如event-driven ——事件驱动</p> 
<p>Httpd yum安装与编译安装</p> 
<p>1）Installing on CentOS6.x , yum源安装</p> 
<h2><a id="yum_install_httpd_y____30"></a>yum install httpd -y 安装</h2> 
<h2><a id="chkconfig_add_httpd______31"></a>chkconfig --add httpd 加入启动服务</h2> 
<h2><a id="chkconfig_httpd_on	_32"></a>chkconfig httpd on 默认启动级别自启动</h2> 
<h2><a id="service_httpd_start	httpd_33"></a>service httpd start 启动httpd服务</h2> 
<pre><code>httpd相关配置文件：
</code></pre> 
<p>主配置文件：/etc/httpd/conf/httd.conf ，这个是httpd最主要的配置文档</p> 
<p>扩展配置文件：/etc/httpd/conf.d/*.conf ，这个是httpd的额外配置文档</p> 
<p>文档根目录： /var/www/html ，这个是apache 首页的文档目录 ，即输入http://127.0.0.1 显示页面所在的目录</p> 
<p>服务脚本：/etc/rc.d/init.d/httpd</p> 
<p>错误目录：/var/www/error ，服务器设定错误，请求的资源错误或浏览器访问出现错误等错误文件的存储目录</p> 
<p>CGI目录： /var/www/cgi-bin/ ，预设为CGI运行脚本的存储目录</p> 
<p>日志目录：/var/log/httpd ，client端登录httpd时，记录的登录日志等信息存储目录</p> 
<p>脚本配置文件： /etc/sysconfig/httpd</p> 
<p>Listen端口：80/tcp ,443/tcp</p> 
<p>命令执行文件：/usr/sbin/apachectl ，/usr/sbin/httpd，/usr/bin/htpasswd</p> 
<p>PID文件：/var/run/httpd/httpd.pid</p> 
<pre><code>Apache相关命令及参数
</code></pre> 
<h2><a id="httpd____d_serverroot___f_config____k_startrestartgracefulstopgracefulstop___Web_61"></a>httpd [ -d serverroot ] [ -f config ] [ -k start|restart|graceful|stop|graceful-stop ] ，用以启动、关闭和重新启动Web服务器进程</h2> 
<pre><code>-f &lt;设定文件&gt;  ：指定配置文件

-d &lt;服务器根目录&gt;： 指定服务器的根目录

-l ：显示服务器编译时所包含的模块

-t ：测试配置文件的语法是否正确

-M ：显示所有httpd 加载的模块
</code></pre> 
<h2><a id="apachctl___httpdargument____apachectlhttpd_73"></a>apachctl [ httpd-argument ] ，apachectl与httpd命令选项类似，不同之处可直接与下列项组合：</h2> 
<pre><code>fullstatus：显示服务器完整的状态信息；

graceful：重新启动Apache服务器，但不会中断原有的连接；

help：显示帮助信息；

restart：重新启动Apache服务器；

start：启动Apache服务器；

status：显示服务器摘要的状态信息；

stop：停止Apache服务器。
</code></pre> 
<h2><a id="htpasswdcimBdpsDv__passwordfile_username_89"></a>htpasswd[-cimBdpsDv] passwordfile username，用于创建和更新储存用户名、域和用户基本认证的密码文件。</h2> 
<pre><code>-c：创建一个加密文件；只在第一次添加用户时使用

-n：不更新加密文件，只将加密后的用户名密码显示在屏幕上；

-m：默认采用MD5算法对密码进行加密；

-s：采用SHA算法对密码进行加密；

-b：在命令行中一并输入用户名和密码而不是根据提示输入密码；

-D：删除指定的用户。

实现httpd启动、关闭、重启方法
</code></pre> 
<h2><a id="service_httpd_stop__start__restart_105"></a>service httpd stop | start | restart</h2> 
<h2><a id="httpd_k_stop__start__restart__graceful_107"></a>httpd -k stop | start | restart | graceful</h2> 
<h2><a id="apachectl_stop__start__restart__graceful____httpdapachectlgraceful__109"></a>apachectl stop | start | restart | graceful 生产环境中重启httpd服务，建议使用apachectl命令，使用graceful 选项</h2> 
<p>[root@VM ~]# yum install httpd -y<br> Dependency Installed: # 自动解决依赖关系，依赖apr 和 apr-util<br> apr.x86_64 0:1.3.9-5.el6_9.1 apr-util.x86_64 0:1.3.9-3.el6_0.1<br> apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1 httpd-tools.x86_64 0:2.2.15-69.el6.centos<br> mailcap.noarch 0:2.1.31-2.el6</p> 
<p>Complete!</p> 
<p>[root@VM ~]# rpm -ql httpd # 查看httpd安装列表<br> /etc/httpd<br> /etc/httpd/conf<br> /etc/httpd/conf.d<br> /etc/httpd/conf/httpd.conf<br> /etc/httpd/run<br> /etc/rc.d/init.d/httpd<br> /etc/sysconfig/httpd<br> /usr/sbin/apachectl<br> /usr/sbin/htcacheclean<br> /usr/sbin/httpd<br> /usr/sbin/httpd.event<br> /usr/sbin/httpd.worker<br> /var/run/httpd<br> /var/www/cgi-bin<br> /var/www/html</p> 
<p>[root@VM ~]# chkconfig --add httpd<br> [root@VM ~]# chkconfig httpd on<br> [root@VM ~]# service httpd start # 启动httpd服务<br> Starting httpd: [ OK ]</p> 
<p>[root@VM ~]# ss -tunl | grep 80 # 验证服务启动正常与否<br> tcp LISTEN 0 128 :::80 ::?</p> 
<p>[root@VM ~]# httpd -v # 查看httpd 版本<br> Server version: Apache/2.2.15 (Unix)</p> 
<p>[root@VM ~]# httpd -t # 验证httpd配置文件语法是否正确<br> Syntax OK</p> 
<p>[root@VM ~]# httpd -l # 查看httpd加载的模块<br> Compiled in modules:<br> core.c<br> prefork.c<br> http_core.c<br> mod_so.c</p> 
<p>[root@VM ~]# httpd -k start # httpd 启动<br> [root@VM ~]# ss -tunl<br> Netid State Recv-Q Send-Q Local Address:Port<br> tcp LISTEN 0 128 :::80</p> 
<p>[root@VM ~]# httpd -k stop<br> [root@VM ~]# ss -tunl | grep 80 # 验证httpd被关闭</p> 
<p>[root@VM ~]# apachectl start # 启动httpd服务<br> httpd (pid 3545) already running</p> 
<p>[root@VM ~]# apachectl graceful #重启httpd服务，但不中断原有连接</p> 
<p>2）Installing from source , 源码安装</p> 
<p>apr ，apr-util ，gcc ，gcc-c++ ，pcre 相关环境准备<br> Download the latest release form <a href="http://httpd.apache.org/download.cgi" rel="nofollow">http://httpd.apache.org/download.cgi</a> 下载</p> 
<h2><a id="gzip_httpdNNtargz	_175"></a>gzip httpd-NN.tar.gz 提取</h2> 
<h2><a id="tar_xvf_httpdNNtar_176"></a>tar xvf httpd-NN.tar</h2> 
<h2><a id="cd_httpdNN_177"></a>cd httpd-NN</h2> 
<h2><a id="configure_prefixPREFIX_othervariable___178"></a>./configure --prefix=PREFIX ‘–other-variable ’ 配置</h2> 
<h2><a id="make__make_install	_179"></a>make &amp;&amp; make install 编译安装</h2> 
<h2><a id="vim_PREFIXconfhttpdconf	_180"></a>vim PREFIX/conf/httpd.conf 预设功能</h2> 
<h2><a id="PREFIXbinapachectl_k_start	_181"></a>PREFIX/bin/apachectl -k start 测试</h2> 
<h2><a id="PREFIXbinapachectl_k_stop_182"></a>PREFIX/bin/apachectl -k stop</h2> 
<pre><code>编译安装Apache需要以下需求
</code></pre> 
<p>APR和APR-Util：此库是必需的，确保系统上已安装APR和APR-Util 。<a href="http://apr.apache.org/download.cgi" rel="nofollow">http://apr.apache.org/download.cgi</a></p> 
<p>PCRE：此库是必需的，但不再与httpd捆绑在一起，建议源码安装 # yum install pcre pcre-devel -y</p> 
<p>GCC：确保安装了ANSI-C编译器 gcc 和 gcc-c++</p> 
<p>Perl 5：该项为可选项，对于某些支持脚本，如apsx或dbmmanage（用Perl编写），需要Perl 5解释器</p> 
<pre><code>./configure常用选项及功能介绍
</code></pre> 
<h2><a id="configure_help__196"></a>./configure --help ：查看相关命令帮助，查看相关支持的选项参数及功能</h2> 
<pre><code>--prefix=PREFIX ：指定默认安装目录

--bindir=DIR：指定二进制可执行文件安装目录

--sbindir=DIR：指定可执行文件安装目录

--includedir=DIR：指定头文件安装目录 

--enable-so   ：   启用DSO动态加载模块支持，需要什么功能模块可动态加载

--enable--ssl  ：SSL/TLS support (mod_ssl)

--enable-cgi   ：支持CGI脚本功能

--enable-rewrite ： 启用网页地址重写功能，实现伪静态   

--with-z=DIR：安装zlib库

--with-pcre=DIR ：使用扩展的pcre lib库

--with-apr=DIR ：指向apr安装路径

--with-apr-util=DIR ：指向apr-util 安装路径

--enable-modules=most ：指定安装DSO动态库用来通信

--with-mpm=prefork|worker|event ：指定服务器默认支持的一种MPM模块

--enable-mpms-shared=all  ：当前平台选择MPM加载动态模块并以DSO动态库方式进行创建
</code></pre> 
<p>configure的各项参数及功能介绍，可参照官方文档https://httpd.apache.org/docs/2.4/en/programs/configure.html</p> 
<pre><code>多模处理模块MPM
</code></pre> 
<p>默认MPM：在unix平台端，支持prefork 、worker、event模块</p> 
<p>构建MPM为静态模块： --with-mpm=prefork|event|worker ，如果要改变 MPM，必须重新构建。</p> 
<p>构建MPM为动态模块： --enable-mpms-shared=all ，所有此平台支持的 MPM 模块都会被安装 ，然后出现在生成的服务器配置文件中。 编辑 LoadModule 指令内容可以选择不同的 MPM模块。</p> 
<pre><code>实现httpd启动、关闭、重启方法
</code></pre> 
<h2><a id="usrlocalapachebinapachectl_f_etchttpdhttpdconf__httpd_240"></a>/usr/local/apache/bin/apachectl -f /etc/httpd/httpd.conf ：启动httpd进程，并指定启动配置文件</h2> 
<h2><a id="kill_TERMUSR1__cat_usrlocalapachelogshttpdpid____httpdkillhttpd_242"></a>kill -TERM|USR1 <code>cat /usr/local/apache/logs/httpd.pid</code> ：关闭httpd进程，通过kill命令向httpd进程发送信令</h2> 
<h2><a id="apachectl_stop__start__restart__graceful_apachectlhttpd_244"></a>apachectl stop | start | restart | graceful ：apachectl命令实现httpd进程停止、启动、重启等功能</h2> 
<h2><a id="httpd_apr_aprutil_246"></a>下载httpd ，apr ，apr-util源码包</h2> 
<p>[root@VM ~]# wget <a href="http://mirror.olnevhost.net/pub/apache//apr/apr-1.6.3.tar.gz" rel="nofollow">http://mirror.olnevhost.net/pub/apache//apr/apr-1.6.3.tar.gz</a><br> [root@VM ~]# wget <a href="http://mirror.olnevhost.net/pub/apache//apr/apr-util-1.6.1.tar.gz" rel="nofollow">http://mirror.olnevhost.net/pub/apache//apr/apr-util-1.6.1.tar.gz</a><br> [root@VM ~]# wget <a href="http://mirror.cc.columbia.edu/pub/software/apache//httpd/httpd-2.4.34.tar.gz" rel="nofollow">http://mirror.cc.columbia.edu/pub/software/apache//httpd/httpd-2.4.34.tar.gz</a></p> 
<p>[root@VM ~]# ls<br> anaconda-ks.cfg apr-util-1.6.1.tar.gz install.log<br> apr-1.6.3.tar.gz httpd-2.4.34.tar.gz install.log.syslog</p> 
<p>[root@VM ~]# tar xf apr-1.6.3.tar.gz # 解压文件<br> [root@VM ~]# tar xf apr-util-1.6.1.tar.gz<br> [root@VM ~]# tar xf httpd-2.4.34.tar.gz</p> 
<p>[root@VM ~]# yum install gcc gcc-c++ pcre pcre-devel # 安装httpd依赖需求<br> [root@VM ~]# yum groupinstall “Development tools” # 安装包组开发工具<br> [root@VM ~]# yum groupinstall “Server Platform Development” # 安装包组服务开发环境</p> 
<p>[root@VM ~]# cd apr-1.6.3 # 编译安装apr<br> [root@VM apr-1.6.3]# ./configure --prefix=/usr/local/apr<br> [root@VM apr-1.6.3]# make &amp;&amp; make install</p> 
<p>[root@VM ~]# cd apr-util-1.6.1 # 编译安装apr-util<br> [root@VM apr-util-1.6.1]# ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr/<br> [root@VM apr-util-1.6.1]# make &amp;&amp; make install</p> 
<p>[root@VM ~]# cd httpd-2.4.34 # 编译安装httpd<br> [root@VM httpd-2.4.34]# ./configure --prefix=/usr/local/apache --sysconfdir=/etc/httpd --enable-so --enable–ssl --enable-cgi --enable-rewrite<br> –with-zlib --with-pcre --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util/ --enable-modeles=most --enable-mpms-shared=all --with-mpm=event<br> [root@VM httpd-2.4.34]# make &amp;&amp; make install</p> 
<p>[root@VM bin]# vi /etc/profile.d/http.sh # 配置环境变量<br> export PATH=/usr/local/apache/bin:$PATH<br> [root@VM bin]# . /etc/profile.d/http.sh #使能环境变量生效<br> [root@VM bin]# echo $PATH<br> /usr/local/apache/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</p> 
<p>[root@VM apache]# ln -sv /usr/local/apache/include/ /usr/include/httpd # 配置httpd include头文件<br> <code>/usr/include/httpd' -&gt;</code>/usr/local/apache/include/’<br> [root@VM apache]# ls -l /usr/include/ | grep httpd<br> lrwxrwxrwx 1 root root 26 Aug 11 20:35 httpd -&gt; /usr/local/apache/include/</p> 
<p>[root@VM apache]# vi /etc/man.config # 配置httpd man帮助文件<br> MANPATH /usr/local/apache/man # 添加该行，httpd man文件地址</p> 
<p>[root@VM apache]# apachectl start # 启动httpd服务<br> [root@VM apache]# ss -tunl | grep 80 # 验证80端口是否处于侦听状态<br> Netid State Recv-Q Send-Q<br> tcp LISTEN 0 128<br> [root@VM ~]# kill -TERM <code>cat /usr/local/apache/logs/httpd.pid</code> #停止httpd进程</p> 
<p>[root@VM ~]# apachectl -f /etc/httpd/httpd.conf #启动httpd进程，并指定httpd启动配置文件</p> 
<p>Apache配置文件介绍</p> 
<pre><code>主配置文件
</code></pre> 
<p>通过将指令放在纯文本配置文件中来配置Apache HTTP Server 。通常调用主配置文件 httpd.conf ，此外，可以使用该Include 指令添加其他配置文件，并且可以使用通配符包含许多配置文件。</p> 
<pre><code>image.png

image.png

配置文件的语法
</code></pre> 
<p>httpd配置文件每行包含一个指令。反斜杠“\”可以用作一行上的最后一个字符，表示该指令继续到下一行。反斜杠和行尾之间不能有其他字符或空格。</p> 
<p>指令的参数由空格分隔。如果参数包含空格，则必须将该参数括在引号中</p> 
<p>配置文件中的指令不区分大小写，但指令的参数通常区分大小写。以“＃”开头的行被视为注释行，可被忽略。</p> 
<p>可使用apachectl configtest 或 apachectl -t命令行检查配置文件中的语法错误，而无需启动服务器。</p> 
<pre><code>模块化设计 
</code></pre> 
<p>httpd是一个模块化服务器，只包含最基本的核心功能；可以通过加载到httpd模块的方式提供扩展功能。 包含指令 和 </p> 
<pre><code>image.png    

image.png

指令范围
</code></pre> 
<p>通过配置文件中的指令来限定作用范围，包含指令，，，，， ，等</p> 
<p>httpd可以同时为许多不同的网站提供服务。这称为虚拟主机。指令也可以通过将它们放在 部分中来限定范围。</p> 
<pre><code>image.png

image.png

image.png

.htaccess 文件
</code></pre> 
<p>httpd允许通过放置在Web树中的特殊文件来分散管理配置。通常会调用特殊文件.htaccess，这些.htaccess文件遵循与主配置文件相同的语法。包括指令 </p> 
<pre><code>image.png
</code></pre> 
<p>注：绝大多数配置修改后，可以通过 service httpd reload 来生效；如果修改了监听的地址或端口，必须重启服务才能生效</p> 
<p>以httpd.2.4 版本为例，Httpd.conf 配置文件相关指令详解<br> 1、Listen指令 及 PidFile 指令</p> 
<p>Listen指令是为了设置监听套接字 。PidFile指令是为了指定httpd的PidFile文件。</p> 
<pre><code>语法：Listen [IP-address:]portnumber [protocol]

语法2：PidFile filename   
</code></pre> 
<p>Listen 80 # 设置侦听端口<br> Listen 127.0.0.1:80 # 设置侦听ip 及 端口<br> Listen 192.168.4.150:8000<br> Listen 192.168.4.150:8443 https # 侦听 ip 192.168.4.150 8443端口 https 协议</p> 
<p>&lt;IfModule !mpm_netware_module&gt;<br> PidFile “/var/run/httpd/httpd.pid” # 指定PidFile文件为 /var/run/httpd/httpd.pid<br> </p> 
<p>2、ServerRoot指令</p> 
<p>该指令设置httpd的安装位置，编译安装时可通过"–prefix"选项指定，如–prefix=/usr/local/apache ；不建议安装完成后，变更不同的路径 ：因为在配置文件中，部分指令路径是依赖该httpd的根路径的相对路径。</p> 
<pre><code>语法：ServerRoot directory-path
</code></pre> 
<p>ServerRoot “/usr/local/apache” # httpd 安装目录</p> 
<p>3、DocumentRoot 指令及根目录页面访问属性</p> 
<p>指定server站点的根目录。使用rpm包安装的httpd的DocumentRoot默认值为"/var/www/html"；编译安装的httpd时，其DocumentRoot默认为"$ServerRoot/htdocs"</p> 
<pre><code>语法：DocumentRoot directory-path

Options指令选项：

Indexes：缺少指定的页面时，允许将目录中的所有文件列举出来；除非是提供文件下载，否则出于安全考虑，这个选项是强烈建议关闭的

FollowSymLinks ：允许跟随符号链接所指向的原始文件；出于安全考虑，这个选项建议关闭

ExecCGI：允许使用mod_cgi 模块执行CGI脚本

Includes：允许使用mod_include模块实现服务器端包含（SGI）

MultiViews：允许使用mod_negotiation实现内容协商

SymLinksIfOwnerMatch：在链接文件属主属组域原始文件属主属组相同时，允许跟随符号链接所指向的原始文件

AllowOverride 指令选项：用于控制是否读取".htaccess"配置文件。

all：启用AllowOverride特性

none：禁用AllowOverride特性。

AuthConfig：基于用户认证时设置该值，此时将可以使用AuthGroupFile, AuthName, AuthType, AuthUserFile，Require等认证相关指令。

FileInfo： 控制文档类型时使用该值，此时将可以使用ErrorDocument, SetHandler,以及一些URL重写的指令。

Indexes：控制目录索引时使用该值，此时可以使用AddIcon, DirectoryIndex。

Limit：是否允许使用order、allow、deny指令，这三个指令已经废弃，目前还存在是为了兼容老版本。

Require指令选项：实现对用户访问限制

Require all granted  ：所有用户允许访问

Require all dined     ：所有用户禁止访问

Require  Valid-user  ：仅允许有效用户进行访问

Require user  userid [userid] ...    仅允许userid用户进行访问

Require group Group-name [group-name] ...      仅允许Group-name组内用户进行访问

Order 指令: 实现对用户的访问限制

Order Allow，Deny      # 定义权限，先允许 ，后拒绝  ；在规则中，若二者都匹配或二者都不匹配，则以Order 命令中的第二项为准；否则，则匹配到相关项为准 

Allow  From  IP | network    # 允许的ip 或 network

Deny  From   IP | network    # 拒绝的ip 或 network       

实现用户访问限制方法：以下两个选项二选一 ，不建议同时使用

1、Require all  [ granted | dined ]     允许 或 拒绝 所有用户访问

2、通过Order 与 Allow 或Deny 的指令组合来实现。    
</code></pre> 
<p>DocumentRoot “/usr/local/apache/htdocs”<br> #指定server 站点的根目录 ，可改变该路径地址，实现把其他目录作为server根目录</p> 
<p>&lt;Directory “/usr/local/apache/htdocs”&gt; # 定义目录属性<br> Options Indexes FollowSymLinks<br> # 配置目录中可用的功能，包括Indexes ，FollowSymLinks ，None ，All ，ExecCGI等</p> 
<pre><code>AllowOverride None    # 不允许存在于.htaccess文件中的指令类型

Require all granted | denied    # 允许或拒绝 所有用户访问

Order allow,deny    # 先允许，在禁止 顺序匹配 ，定义限制用户
Allow from IP | network 
Deny from IP | network 
</code></pre> 
<p>4、DirectoryIndex指令</p> 
<p>httpd服务器端将DorectoryIndex指令所指定的文件响应给客户端。如访问 <a href="http://www.itwish.cn/" rel="nofollow">http://www.itwish.cn/</a> ，将自动把$Document下的index.html 文件内容返回给客户端 。</p> 
<pre><code>语法：DirectoryIndex disabled | local-url [local-url]
</code></pre> DirectoryIndex index.html index.php /cgi-bin/index.pl #从左至右依次查找 ，先查找index.html 文件 ，若没有就查找index.php 文件 ，再没有就查找/cgi-bin/index.pl 文件 
<p>5、Keepalive指令</p> 
<p>KeepAlive指令用于开启和关闭持久连接功能。在没有开启持久连接时，客户端每请求一个资源都需重新建立一次TCP连接，而使用了持久连接后，客户端只需在最初请求一次TCP连接，之后就可以使用同一个TCP连接发送其他的http请求；但长连接自身的缺陷是会一直占用着连接不释放，所以必须得给出一个长连接的超时时间，这个超时时间由KeepAliveTimeout指令控制；还可以通过指令MaxKeepAliveRequests控制每个长连接下的TCP连接的能接受的最大请求数。无疑，这个值应该设置的大一些，设置为0表示无限制。</p> 
<pre><code>语法1：KeepAlive On|Off   

语法2：KeepAliveTimeout num[ms]

语法3：MaxKeepAliveRequests number
</code></pre> 
<p>[root@VM httpd]# vi /etc/httpd/httpd.conf</p> 
<h2><a id="Various_default_settings_474"></a>Various default settings</h2> 
<p>Include /etc/httpd/extra/httpd-default.conf # 启用扩展配置文件httpd-default.conf</p> 
<p>[root@VM extra]# vi httpd-default.conf<br> KeepAlive On # 启用HTTP持久连接功能<br> KeepAliveTimeout 5 # 关闭连接之前等待后续请求的秒数 ，通过添加ms的后缀，表示可设置为毫秒<br> MaxKeepAliveRequests 50 # 限制打开时每个连接允许的请求数，若为0 ，则不限制</p> 
<p>6、DSO 动态共享库加载指令</p> 
<p>Apache HTTP Server是一个模块化程序，管理员可以通过加载不同的模块组来选择要包含在服务器中的功能。在编译安装时，通过选项–enable-so 来加载DSO（动态共享对象）功能。通过LoadModule命令来实现关闭或开启功能模块 。</p> 
<pre><code>语法：LoadModule status_module "modules/mod_status.so"
</code></pre> 
<p>[root@vm ~]# vi /etc/httpd/httpd.conf<br> #LoadModule mpm_event_module modules/mod_mpm_event.so<br> LoadModule mpm_prefork_module modules/mod_mpm_prefork.so<br> #LoadModule mpm_worker_module modules/mod_mpm_worker.so<br> LoadModule authn_file_module modules/mod_authn_file.so<br> #LoadModule authn_dbm_module modules/mod_authn_dbm.so<br> #LoadModule authn_anon_module modules/mod_authn_anon.so<br> #LoadModule authn_dbd_module modules/mod_authn_dbd.so<br> #LoadModule authn_socache_module modules/mod_authn_socache.so<br> LoadModule authn_core_module modules/mod_authn_core.so<br> LoadModule authz_host_module modules/mod_authz_host.so<br> LoadModule authz_groupfile_module modules/mod_authz_groupfile.so<br> LoadModule authz_user_module modules/mod_authz_user.so</p> 
<p>7、MPM多道处理模块配置指令 及 Include 指令</p> 
<p>Apache HTTP 服务器 2.0 扩展此模块化设计到最基本的 web 服务器功能，它提供了可以选择的多处理模块(MPM)，可在编译时使用–with-mpm选项来决定apache的工作模式。MPM 很像其它 Apache httpd 模块，主要是区别是任何时间内必须有一个且只能有一个 MPM 模块需加载到服务器中，可用的MPM模块包括prefork ，event ，worker等。可以通过httpd -M命令列出apache的所有模块，查看相应其工作方式。</p> 
<p>Include 指令是用于在httpd启动时，使用include指令来包含其他配置文件，在解析配置文件时会把主配置文件httpd.conf 与include 包含的文件进行配置合并 ，实现整体对 httpd 的配置调节。</p> 
<pre><code>语法：Include file-path|directory-path|wildcard   
</code></pre> 
<p>[root@vm ~]# vi /etc/httpd/httpd.conf<br> LoadModule mpm_event_module modules/mod_mpm_event.so # 手动加载的mod_mpm模块<br> #LoadModule mpm_prefork_module modules/mod_mpm_prefork.so # 若更改mpm_prefork或mpm_worker模块，其余两种模块行注释<br> #LoadModule mpm_worker_module modules/mod_mpm_worker.so</p> 
<h2><a id="Serverpool_management_MPM_specific_515"></a>Server-pool management (MPM specific)</h2> 
<p>Include /etc/httpd/extra/httpd-mpm.conf # 启动httpd-mpm.conf 扩展配置文件</p> 
<p>[root@vm ~]# vi /etc/httpd/extra/httpd-mpm.conf</p> StartServers 5 # 开机启动的工作进程数 MinSpareServers 5 # 保留备用的最小工作进程数 MaxSpareServers 10 # 保留备用的最大工作进程数 MaxRequestWorkers 250 # httpd启动时开启的最大工作进程数 MaxConnectionsPerChild 0 # 服务器进程所服务的最大连接数，0代表不限制 StartServers 3 # 启动的子进程的个数 MinSpareThreads 75 # 保留备用的最小工作线程数 MaxSpareThreads 250 # 保留备用的最大工作线程数 ThreadsPerChild 25 # 服务器进程的工作线程数 MaxRequestWorkers 400 # 服务器最大工作线程数 MaxConnectionsPerChild 0 # 服务器的最大进程连接数 ，0代表不做限制 StartServers 3 # 启动的子进程的个数 MinSpareThreads 75 # 保留备用的最小工作线程数 MaxSpareThreads 250 # 保留备用的最大工作线程数 ThreadsPerChild 25 # 服务器进程的工作线程数 MaxRequestWorkers 400 # 服务器最大工作线程数 MaxConnectionsPerChild 0 # 服务器的最大进程连接数 ，0代表不做限制 
<p>8、ServerName，ServerAdmin及ServerAlias</p> 
<p>ServerName用于唯一标识提供web服务的主机名，只有在基于名称的虚拟主机中该指令才是必须的 。ServerAlias用于定义ServerName的别名。 ServerAdmin 是用于定义管理邮箱地址。</p> 
<pre><code>语法1：ServerName [scheme://]domain-name|ip-address[:port]   

语法2：ServerAdmin email-address|URL        

语法3：ServerAlias hostname [hostname]         
</code></pre> 
<p>[root@VM httpd]# vi httpd.conf</p> 
<h2><a id="ServerAdmin_Your_address_where_problems_with_the_server_should_be_559"></a>ServerAdmin: Your address, where problems with the server should be</h2> 
<h2><a id="emailed__This_address_appears_on_some_servergenerated_pages_such_560"></a>e-mailed. This address appears on some server-generated pages, such</h2> 
<h2><a id="as_error_documents__eg_adminyourdomaincom_561"></a>as error documents. e.g. <a href="mailto:admin@your-domain.com" rel="nofollow">admin@your-domain.com</a></h2> 
<h2><a id="_562"></a></h2> 
<p>ServerAdmin <a href="mailto:web@itwish.cn" rel="nofollow">web@itwish.cn</a> # 定义Server管理员邮箱地址</p> 
<h2><a id="_564"></a></h2> 
<h2><a id="ServerName_gives_the_name_and_port_that_the_server_uses_to_identify_itself_565"></a>ServerName gives the name and port that the server uses to identify itself.</h2> 
<h2><a id="This_can_often_be_determined_automatically_but_we_recommend_you_specify_566"></a>This can often be determined automatically, but we recommend you specify</h2> 
<h2><a id="it_explicitly_to_prevent_problems_during_startup_567"></a>it explicitly to prevent problems during startup.</h2> 
<h2><a id="_568"></a></h2> 
<h2><a id="If_your_host_doesnt_have_a_registered_DNS_name_enter_its_IP_address_here_569"></a>If your host doesn’t have a registered DNS name, enter its IP address here.</h2> 
<h2><a id="_570"></a></h2> 
<p>ServerName <a href="http://www.itwish.cn:80" rel="nofollow">www.itwish.cn:80</a> # 定义主机名称</p> 
<p>[root@VM httpd]# vi extra/httpd-vhosts.conf<br> &lt;VirtualHost *:80&gt;<br> ServerAdmin <a href="mailto:webmaster@itwish.cn" rel="nofollow">webmaster@itwish.cn</a> # 定义Server管理员邮箱地址<br> ServerName <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a> # 定义主机名称<br> ServerAlias www # 定义主机别名<br> </p> 
<p>9、Userdir指令，配置用户目录</p> 
<p>允许每个用户使用该UserDir指令在其主目录中拥有一个网站。可通过http://example.com/~username/ 进行访问 ，注：务必要为用户的家目录赋予运行httpd进程的用户daemon拥有执行权限</p> 
<pre><code>语法：UserDir directory-filename [directory-filename] ...
</code></pre> 
<p>[root@VM httpd]# vi /etc/httpd/httpd.conf<br> LoadModule authz_host_module modules/mod_authz_host.so # 加载userdir 依赖的动态DSO文件 ，取消注释“#” 即可实现加载。<br> LoadModule authz_core_module modules/mod_authz_core.so<br> LoadModule userdir_module modules/mod_userdir.so</p> 
<h2><a id="User_home_directories_592"></a>User home directories</h2> 
<pre><code>Include /etc/httpd/extra/httpd-userdir.conf        # 包含扩展文件 httpd-userdir.conf 
</code></pre> 
<p>[root@VM httpd]# vi extra/httpd-userdir.conf</p> 
<h2><a id="Required_module_mod_authz_core_mod_authz_host_mod_userdir_597"></a>Required module: mod_authz_core, mod_authz_host, mod_userdir</h2> 
<h2><a id="DSO__mod_authz_coremod_authz_host_mod_userdir_598"></a>该功能依赖DSO 动态模块 mod_authz_core，mod_authz_host, mod_userdir</h2> 
<p>UserDir public_html # 定义用户访问目录名称</p> 
<h2><a id="public_htmlurl_httpexamplecomusername_601"></a>public_html是用户家目录下的目录名称，所有位于此目录中的文件均可通过url <a href="http://example.com/~username%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE" rel="nofollow">http://example.com/~username进行访问</a></h2> 
<p>&lt;Directory “/home/*/public_html”&gt; # 定义目录页面属性<br> AllowOverride FileInfo AuthConfig Limit Indexes # 配置AllowOverride 指令<br> Options Indexes FollowSymlinks # 配置Options 指令<br> Require all granted # 配置Require 指令<br> </p> 
<p>[root@VM httpd]# useradd itwish # 添加用户及配置密码<br> [root@VM httpd]# passwd itwish</p> 
<p>[root@VM itwish]# mkdir /home/itwish/public_html # 在用户家目录下创建Userdir 定义的目录文件<br> [root@VM itwishl]# touch /home/itwish/public_html/{a,b,c}</p> 
<p>[root@VM itwish]# setfacl -m u:daemon:x /home/itwish/ # 注：务必要为用户家目录配置httpd启动用户daemon的执行权限</p> 
<p>测试itwish用户的个人网站：</p> 
<pre><code> image.png   
</code></pre> 
<p>10、ScriptAlias 指令，配置脚本执行目录</p> 
<p>将URL映射到文件系统位置，并将目标指定为CGI脚本。例：Script Alias “cgi-bin” “/usr/local/apache/cgi-bin/” 表示访问 <a href="http://www.itwish.cn/cgi-bin/test" rel="nofollow">http://www.itwish.cn/cgi-bin/test</a> 时，目录映射地址为 /usr/local/apache/cgi-bin/test</p> 
<pre><code>语法1：ScriptAlias [URL-path] file-path|directory-path    
</code></pre> 
<h2><a id="cgibin__webcgibin__12__627"></a>定义/cgi-bin/ 目录映射到 /web/cgi-bin/ 目录 ，1)功能等同于2) ，注意结尾的"/"</h2> 
<p>1）<br> ScriptAlias “/cgi-bin/” “/web/cgi-bin/”<br> 2）<br> Alias “/cgi-bin/” “/web/cgi-bin/”<br> &lt;Location “/cgi-bin”&gt;<br> SetHandler cgi-script<br> Options +ExecCGI<br> </p> 
<p>[root@VM httpd]# vi extra/httpd-vhosts.conf # 调整配置文件<br> <br> #<br> ScriptAlias /cgi-bin/ “/usr/local/apache/cgi-bin/”<br> # 定义目录/cgi-bin/ 目录映射到 /usr/local/apache/cgi-bin/ 目录<br> </p> 
<p>&lt;Directory “/usr/local/apache/cgi-bin”&gt; # 定义目录属性<br> AllowOverride none<br> Options none<br> Require all granted<br> </p> 
<p>[root@VM cgi-bin]# vi test1 # 在cgi-bin目录中创建test1 bash 脚本<br> #!/bin/bash<br> cat &lt;&lt; EOF<br> Content-Type: text/html<br> # 注意改行为空行</p> 
<pre><h2>The hostname is `hostname`. </h2>     # 显示主机名 ，使用bash命令 hostname 实现 
The time is `date`.                    # 显示当前访问日期 ，使用bash命令 date 实现
</pre> 
<pre><code>                        # 改行为空行 
</code></pre> 
<p>EOF</p> 
<p>[root@VM cgi-bin]# vi test2 # 在cgi-bin目录中创建test2 perl 脚本<br> #!/usr/bin/perl<br> print “content-type: text/html”,"\n\n";<br> print “”,"\n";<br> print “”,"\n";<br> print “</p><title>Perl</title>”,"\n";<br> print “”,"\n";<br> print “”,"\n";<br> print “ 
<h2>Hello World</h2>”,"\n"; 
<br> print “”,"\n"; 
<br> print “”,"\n"; 
<p></p> 
<p>[root@VM ]# chmod o+x /usr/local/apache/cgi-bin/{test1,test2} # 注意 ，一定要给与脚本执行权限</p> 
<p>[root@VM cgi-bin]# curl <a href="http://192.168.4.160/cgi-bin/test1" rel="nofollow">http://192.168.4.160/cgi-bin/test1</a> # 测试 test1 脚本执行状况</p> 
<pre><h2>The hostname is VM. </h2>
The time is Wed Aug 15 19:26:56 CST 2018.
</pre> 
<p>[root@VM cgi-bin]# curl <a href="http://192.168.4.160/cgi-bin/test2" rel="nofollow">http://192.168.4.160/cgi-bin/test2</a> # 测试test2 perl脚本执行状况</p> 
<title>Perl</title> 
<h2>Hello World</h2> 
<p>windows测试：</p> 
<pre><code>image.png

image.png
</code></pre> 
<p>11、VirtualHost指令 ，虚拟主机配置</p> 
<p>及用于包含一组仅适用于特定虚拟主机的指令。当服务器在特定虚拟主机上收到对文档的请求时，它将使用该 部分中包含的配置指令。</p> 
<pre><code>语法：&lt;VirtualHost addr[:port] [addr[:port]] ...&gt; ... &lt;/VirtualHost&gt;

addr可以是以下任何一个，可选地后跟冒号和端口号（或*）：

虚拟主机的IP地址 ；

虚拟主机IP地址的完全限定域名（不推荐）;

字符 * ，充当通配符并匹配任何IP地址；

字符串"_default_"，是"*"的别名
</code></pre> 
<p>[root@VM httpd]# vi /etc/httpd/httpd.conf # 调整httpd.conf 主配置文件<br> #DocumentRoot “/usr/local/apache/htdocs” # 注释掉web站点的根目录 ，行首加 “#”。<br> Include /etc/httpd/extra/httpd-vhosts.conf # 取消行首的注释“#” ，使能httpd-vhosts.conf 文件</p> 
<p>[root@VM httpd]# vi extra/httpd-vhosts.conf</p> 
<p>&lt;VirtualHost 192.168.4.160:80&gt; # 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a><br> ServerAdmin <a href="mailto:webmaster@itwish.cn" rel="nofollow">webmaster@itwish.cn</a> # 定义主机管理邮箱地址<br> DocumentRoot “/usr/local/apache/htdocs/itwish.cn” # 定义该虚拟主机的根目录<br> ServerName <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a> # 定义虚拟主机名称<br> ServerAlias <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a> # 定义Servername 的别名<br> ErrorLog “logs/itwish.cn-error_log” # 定义错误日志路径<br> CustomLog “logs/itwish.cn-access_log” common # 定义访问日志目录<br> &lt;Directory “/usr/local/apache/docs/itwish.cn”&gt; # 对根目录设置页面访问属性 ，定义Directory 指令开始范围<br> Options Indexes FollowSymlinks<br> AllowOverride None<br> Require all granted<br> # 定义Directory 指令结束范围<br> # 定义VirtualHost 指令的结束范围</p> 
<p>&lt;VirtualHost 192.168.4.170:80&gt; # 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a><br> ServerAdmin <a href="mailto:webmaster@itwish.org" rel="nofollow">webmaster@itwish.org</a><br> DocumentRoot “/usr/local/apache/htdocs/itwish.org”<br> ServerName <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a><br> ServerAlias <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a><br> ErrorLog “logs/itwish.org-error_log”<br> CustomLog “logs/itwish.org-access_log” common<br> &lt;Directory “/usr/local/apache/docs/itwish.org”&gt;<br> Options Indexes FollowSymlinks<br> AllowOverride None<br> Require all granted<br> <br> </p> 
<p>[root@VM httpd]# mkdir /usr/local/apache/htdocs/{<!-- --><a href="http://itwish.cn" rel="nofollow">itwish.cn</a>,<a href="http://itwish.org" rel="nofollow">itwish.org</a>} # 创建虚拟主机的根目录</p> 
<p>[root@VM httpd]# cd /usr/local/apache/htdocs/</p> 
<p>[root@VM htdocs]# ls<br> index.html <a href="http://itwish.cn" rel="nofollow">itwish.cn</a> <a href="http://itwish.org" rel="nofollow">itwish.org</a></p> 
<p>[root@VM htdocs]# vi <a href="http://itwish.cn/index.html" rel="nofollow">itwish.cn/index.html</a> # 编辑虚拟主机 <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a> 访问主页</p> 
<h2>www.itwish.cn works!</h2> 
<p>[root@VM htdocs]# vi <a href="http://itwish.org/index.html" rel="nofollow">itwish.org/index.html</a> # 编辑虚拟主机 <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a> 访问主页</p> 
<h2>itwish.org works!</h2> 
<p>[root@VM httpd]# vi /etc/hosts # 添加以下虚拟主机域名解析 地址<br> 192.168.4.160 <a href="http://vm.itwish.cn" rel="nofollow">vm.itwish.cn</a> vm <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a><br> 192.168.4.170 <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a></p> 
<p>[root@VM htdocs]# curl <a href="http://www.itwish.cn" rel="nofollow">http://www.itwish.cn</a> # 测试 ，主页面显示正常</p> 
<h2>www.itwish.cn works!</h2> 
<p>[root@VM htdocs]# curl <a href="http://www.itwish.org" rel="nofollow">http://www.itwish.org</a> # 测试 ，主页面显示正常</p> 
<h2>itwish.org works!</h2> 
<p>windows 主机测试，简要实现 ，未配置域名解析 ，直接通过ip进行访问：</p> 
<p>image.png image.png</p> 
<p>12、ErrorLog 与 LogFormat 指令，定义web访问 Log日志</p> 
<p>定义web访问日志路径及日志格式</p> 
<pre><code>语法1：ErrorLog file-path|syslog[:[facility][:tag]]   

语法2：LogFormat format|nickname [nickname]

语法3：CustomLog file|pipe format|nickname [env=[!]environment-variable| expr=expression] 

定义日志格式各项参数涵义，请参考官网文档：https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats 

%h：客户端地址

%l：远程的登录名，通常为-

%u：认证时的远程用户名，通常为-

%t：接收到的请求时的时间，为标准英文格式时间+时区

\" ：斜杠时为后面内容做转义

%r：请求报文的起始行

%&gt;s：响应状态码，

%b：以字节响应报文的长度，不包含http报文

%{Header_Name}i：记录指定请求报文首部的内容（value）

%u：请求的URL

常用日志格式：

通用日志格式（CLF）： "%h %l %u %t \"%r\" %&gt;s %b"

虚拟主机的通用日志格式："%v %h %l %u %t \"%r\" %&gt;s %b"

NCSA扩展/组合日志格式 ："%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-agent}i\""

引用日志格式 ："%{Referer}i -&gt; %U"

代理（浏览器）日志格式： "%{User-agent}i" 
</code></pre> 
<p>[root@VM httpd]# vi /etc/httpd/httpd.conf # 调整httpd.conf 主配置文件<br> ErrorLog “logs/error_log” # 错误日志路径<br> LogLevel warn # 日志等级warn<br> <br> #<br> LogFormat “%h %l %u %t “%r” %&gt;s %b “%{Referer}i” “%{User-Agent}i”” combined<br> # 定义日志格式，格式名称定义为变量 combined<br> LogFormat “%h %l %u %t “%r” %&gt;s %b” common<br> # 定义日志格式，格式名称定义为变量 common</p> 
<pre><code>&lt;IfModule logio_module&gt;
  # You need to enable mod_logio.c to use %I and %O
  LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
&lt;/IfModule&gt;

   CustomLog "logs/access_log"  common    
   # 该CustomLog指令用于将请求记录到服务器。指定了日志路径，并且选择使用环境变量common作为日志的显示格式。
</code></pre> 
<p>[root@VM httpd]# vi extra/httpd-vhosts.conf</p> 
<p>&lt;VirtualHost 192.168.4.160:80&gt;<br> ErrorLog “logs/itwish.cn-error_log”<br> CustomLog “logs/itwish.cn-access_log” combined # 把日志格式变量从common 改为 combined<br> 或者<br> CustomLog “logs/itwish.cn-access_log” “%v %h %l %u %t “%r” %&gt;s %b”<br> </p> 
<p>[root@VM httpd]# vi /usr/local/apache/logs/itwish.cn-access_log</p> 
<h2><a id="__common__combined__848"></a>查看访问日志 ，通过日志显示内容对比 common变量格式 与 combined 变量格式的不同</h2> 
<p>192.168.4.160 - - [15/Aug/2018:15:56:40 +0800] “HEAD / HTTP/1.1” 200 -<br> 192.168.4.160 - - [15/Aug/2018:15:56:52 +0800] “GET / HTTP/1.1” 200 105<br> 192.168.4.201 - - [15/Aug/2018:16:00:13 +0800] “GET /favicon.ico HTTP/1.1” 404 209<br> 192.168.4.201 - - [15/Aug/2018:16:00:17 +0800] “GET /favicon.ico HTTP/1.1” 404 209<br> 192.168.4.201 - - [15/Aug/2018:17:20:01 +0800] “GET / HTTP/1.1” 304 - “-” “Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3<br> 396.99 Safari/537.36”<br> 192.168.4.201 - - [15/Aug/2018:17:20:06 +0800] “GET / HTTP/1.1” 200 57 “-” “Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.<br> 3282.140 Safari/537.36 Edge/17.17134”</p> 
<p>13、httpd网页认证</p> 
<p>httpd对web身份认证的支持很丰富，提供的控制也非常细致。见http://httpd.apache.org/docs/2.4/mod/</p> 
<pre><code>认证方式

httpd服务器支持使用摘要认证(Digest)和基本认证(Basic)两种方式

Digest：使用摘要认证需要在编译httpd之前添加"--enable-auth-digest"选项，但并不是所有的浏览器都支持摘要认证，不推荐使用;

Basic：基本认证是htpd服务的基本功能，不需要预先配置特别的选项（安全性没有摘要认证高，但支持所有的浏览器）

通过用户名和密码形式限制访问方式：   

AllowOverride Authconfig       # 启用用户认证    

AuthName "Auth Direcrory"   # 指定认证名称，登录的时候会通过登录窗口显示

AuthType Basic | Digest          # 指定认证方式 Basic 或 Digest

AuthUserFile /usr/local/apache/.htpasspwd   # 指定授权用户数据文件，由htpasswd命令生成。

AuthGroupFile file-path  # 指定组认证文件，文件中分组格式为"mygroup: Jon Bob "。如果文件路径为相对路径，则相对于ServerRoot

Require valid-user    # 授权给合法用户，合法用户在.htpasspwd文件中  
</code></pre> 
<p>[root@VM httpd]# vi /etc/httpd/httpd.conf # 调整httpd.conf 主配置文件<br> #DocumentRoot “/usr/local/apache/htdocs” # 注释掉web站点的根目录 ，行首加 “#”。<br> Include /etc/httpd/extra/httpd-vhosts.conf # 取消行首的注释“#” ，使能httpd-vhosts.conf 文件</p> 
<p>[root@VM httpd]# vi extra/httpd-vhosts.conf</p> 
<p>&lt;VirtualHost 192.168.4.170:80&gt; # 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 <a href="http://www.itwish.cn" rel="nofollow">www.itwish.cn</a><br> ServerAdmin <a href="mailto:webmaster@itwish.org" rel="nofollow">webmaster@itwish.org</a><br> DocumentRoot “/usr/local/apache/htdocs/itwish.org” # 定义该虚拟主机的根目录<br> ServerName <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a><br> ServerAlias <a href="http://www.itwish.org" rel="nofollow">www.itwish.org</a><br> ErrorLog “logs/itwish.org-error_log” # 定义错误日志路径<br> CustomLog “logs/itwish.org-access_log” common # 定义web访问日志目录及日志格式<br> &lt;Directory “/usr/local/apache/htdocs/itwish.org”&gt; # 对根目录设置页面访问属性 ，定义Directory 指令开始范围<br> Options Indexes FollowSymlinks<br> AllowOverride Authconfig # 定义用户访问认证<br> AuthType Basic<br> AuthName “Input Your name and password”<br> AuthUserFile “/usr/local/apache/.htpasspwd” # 用户认证文件<br> AuthGroupFile “/usr/local/apache/.group” # 组认证文件<br> Require Valid-user # 或者直接使用 Require user itwish,tom<br> Require group Auth # 允许<br> # 定义Directory 指令结束范围<br> # 定义VirtualHost 指令的结束范围</p> 
<p>[root@VM httpd]# htpasswd -cb /usr/local/apache/.htpasspwd itwish itwish # 添加认证用户并指定认证文件<br> Adding password for user itwish</p> 
<p>[root@VM httpd]# htpasswd -b /usr/local/apache/.htpasspwd tom tom # 添加认证用户<br> Adding password for user tom</p> 
<p>[root@VM httpd]# echo “Auth:tom” &gt;&gt; /usr/local/apache/.groupname # 添加用户到认证组Auth<br> [root@VM httpd]# vi /usr/local/apache/.groupname<br> Auth:tom</p> 
<p>windows客户端测试：分别测试用户名itwish 和 tom 都可正常访问主页 Index.html</p> 
<pre><code>image.png
</code></pre> 
<p>14、 指令 ，SetHandler 指令 ，配置主页stauts 页面</p> 
<p>该指令通过URL限制所附指令的范围。它与 指令类似 ，并启动一个以指令终止的子节 .</p> 
<p>[root@VM httpd]# vi httpd.conf # 配置httpd.conf主文件，并加载以下DSO模块<br> LoadModule authz_host_module modules/mod_authz_host.so<br> LoadModule authz_core_module modules/mod_authz_core.so<br> LoadModule status_module modules/mod_status.so<br> LoadModule info_module modules/mod_info.so</p> 
<h2><a id="Realtime_info_on_requests_and_configuration_932"></a>Real-time info on requests and configuration</h2> 
<p>Include /etc/httpd/extra/httpd-info.conf # 启用扩展文件</p> 
<p>[root@VM extra]# vi httpd-info.conf # 配置httpd-info.conf文件，建议指定用户访问。</p> 
<h2><a id="_936"></a></h2> 
<h2><a id="Get_information_about_the_requests_being_processed_by_the_server_937"></a>Get information about the requests being processed by the server</h2> 
<h2><a id="and_the_configuration_of_the_server_938"></a>and the configuration of the server.</h2> 
<h2><a id="_939"></a></h2> 
<h2><a id="Required_modules_mod_authz_core_mod_authz_host______940"></a>Required modules: mod_authz_core, mod_authz_host, # 依赖指定的模块</h2> 
<h2><a id="mod_info_for_the_serverinfo_handler_941"></a>mod_info (for the server-info handler),</h2> 
<h2><a id="mod_status_for_the_serverstatus_handler_942"></a>mod_status (for the server-status handler</h2> 
<p>&lt;Location /server-status&gt;<br> SetHandler server-status<br> AllowOverride Authconfig # 配置用户认证<br> Authtype Basic<br> AuthName “Input The message”<br> AuthUserFile “/usr/local/apache/.htpasspwd”<br> Require Valid-user<br> </p> 
<p>windows 测试：</p> 
<pre><code>image.png
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57fe2e3ce5fd3ef15ee37e1fae95d728/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">verilog之门级相关知识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2dc9e56874f1fcb2c3bb992f622b2a8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">百度网盘打不开解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>