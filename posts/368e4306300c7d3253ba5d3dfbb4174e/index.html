<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在C/C&#43;&#43;程序里打印调用栈信息 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在C/C&#43;&#43;程序里打印调用栈信息" />
<meta property="og:description" content="我们知道，GDB的backtrace命令可以查看堆栈信息。但很多时候，GDB根本用不上。比如说，在线上环境中可能没有GDB，即使有，也不太可能让我们直接在上面调试。如果能让程序自己输出调用栈，那是最好不过了。本文介绍和调用椎栈相关的几个函数。
NAME
backtrace, backtrace_symbols, backtrace_symbols_fd - support for application self-debugging
SYNOPSIS
#include &lt;execinfo.h&gt;
int backtrace(void **buffer, int size);
char **backtrace_symbols(void *const *buffer, int size);
void backtrace_symbols_fd(void *const *buffer, int size, int fd);
以上内容源自这几个函数的man手册。
先简单介绍一下这几个函数的功能：
l backtrace：获取当前的调用栈信息，结果存储在buffer中，返回值为栈的深度，参数size限制栈的最大深度，即最大取size步的栈信息。
l backtrace_symbols：把backtrace获取的栈信息转化为字符串，以字符指针数组的形式返回，参数size限定转换的深度，一般用backtrace调用的返回值。
l backtrace_symbols_fd：它的功能和backtrace_symbols差不多，只不过它不把转换结果返回给调用方，而是写入fd指定的文件描述符。
Man手册里，给出了一个简单的实例，我们看一下：
#include&lt;execinfo.h&gt;
#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;unistd.h&gt;
void
myfunc3(void)
{
int j, nptrs;
#define SIZE 100
void *buffer[100];
char **strings;
nptrs = backtrace(buffer, SIZE);
printf(&#34;backtrace() returned %d addresses\n&#34;, nptrs);
/* The call backtrace_symbols_fd(buffer, nptrs, STDOUT_FILENO)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/368e4306300c7d3253ba5d3dfbb4174e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-07-18T14:58:01+08:00" />
<meta property="article:modified_time" content="2012-07-18T14:58:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在C/C&#43;&#43;程序里打印调用栈信息</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">我们知道，</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">GDB</span></span><span style="font-family:宋体; font-size:12pt">的</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace</span></span><span style="font-family:宋体; font-size:12pt">命令可以查看堆栈信息。但很多时候，</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">GDB</span></span><span style="font-family:宋体; font-size:12pt">根本用不上。比如说，在线上环境中可能没有</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">GDB</span></span><span style="font-family:宋体; font-size:12pt">，即使有，也不太可能让我们直接在上面调试。如果能让程序自己输出调用栈，那是最好不过了。本文介绍和调用椎栈相关的几个函数。</span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" width="567" style="border-bottom:medium none; border-left:medium none; margin:auto auto auto -1.7pt; width:425.3pt; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="567" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:425.3pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">NAME<br> <span style="">       </span>backtrace, backtrace_symbols, backtrace_symbols_fd - support for application self-debugging<br> <br> SYNOPSIS<br> <span style="">       </span>#include &lt;execinfo.h&gt;<br> <br> <span style="">       </span>int backtrace(void **buffer, int size);<br> <br> <span style="">       </span>char **backtrace_symbols(void *const *buffer, int size);<br> <br> <span style="">       </span>void backtrace_symbols_fd(void *const *buffer, int size, int fd);</span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">以上内容源自这几个函数的</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">man</span></span><span style="font-family:宋体; font-size:12pt">手册。</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">先简单介绍一下这几个函数的功能：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoListParagraph" style="text-indent:-21pt; margin:0cm 0cm 0pt 45pt"><span lang="EN-US" style="font-family:Wingdings; font-size:12pt"><span style="">l<span style="font:7pt 'Times New Roman'"> </span></span></span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace</span></span><span style="font-family:宋体; font-size:12pt">：获取当前的调用栈信息，结果存储在</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">buffer</span></span><span style="font-family:宋体; font-size:12pt">中，返回值为栈的深度，参数</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">size</span></span><span style="font-family:宋体; font-size:12pt">限制栈的最大深度，即最大取</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">size</span></span><span style="font-family:宋体; font-size:12pt">步的栈信息。</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoListParagraph" style="text-indent:-21pt; margin:0cm 0cm 0pt 45pt"><span lang="EN-US" style="font-family:Wingdings; font-size:12pt"><span style="">l<span style="font:7pt 'Times New Roman'"> </span></span></span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace_symbols</span></span><span style="font-family:宋体; font-size:12pt">：把</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace</span></span><span style="font-family:宋体; font-size:12pt">获取的栈信息转化为字符串，以字符指针数组的形式返回，参数</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">size</span></span><span style="font-family:宋体; font-size:12pt">限定转换的深度，一般用</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace</span></span><span style="font-family:宋体; font-size:12pt">调用的返回值。</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoListParagraph" style="text-indent:-21pt; margin:0cm 0cm 0pt 45pt"><span lang="EN-US" style="font-family:Wingdings; font-size:12pt"><span style="">l<span style="font:7pt 'Times New Roman'"> </span></span></span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace_symbols_fd</span></span><span style="font-family:宋体; font-size:12pt">：它的功能和</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace_symbols</span></span><span style="font-family:宋体; font-size:12pt">差不多，只不过它不把转换结果返回给调用方，而是写入</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">fd</span></span><span style="font-family:宋体; font-size:12pt">指定的文件描述符。</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">Man</span></span><span style="font-family:宋体; font-size:12pt">手册里，给出了一个简单的实例，我们看一下：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">#include</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="color:#a31515">&lt;execinfo.h&gt;</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">#include</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="color:#a31515">&lt;stdio.h&gt;</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">#include</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="color:#a31515">&lt;stdlib.h&gt;</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">#include</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="color:#a31515">&lt;unistd.h&gt;</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">void</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">myfunc3(<span style="color:blue">void</span>)</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">{<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">int</span> j, nptrs;</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">#define</span> SIZE 100</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">void</span> *buffer[100];</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">char</span> **strings;</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>nptrs = backtrace(buffer, SIZE);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>printf(<span style="color:#a31515">"backtrace() returned %d addresses\n"</span>, nptrs);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:green">/* The call backtrace_symbols_fd(buffer, nptrs, STDOUT_FILENO)</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:green; font-size:9.5pt"><span style="">    </span>*<span style="">  </span>would produce similar output to the following: */</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"> </span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>strings = backtrace_symbols(buffer, nptrs);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">if</span> (strings == NULL) {<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>perror(<span style="color:#a31515">"backtrace_symbols"</span>);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>exit(EXIT_FAILURE);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>}</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"> </span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">for</span> (j = 0; j &lt; nptrs; j++)</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>printf(<span style="color:#a31515">"%s\n"</span>, strings[j]);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>free(strings);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">}</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"> </span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">static</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="color:blue">void</span><span style="">  </span><span style="color:green">/* "static" means don't export the symbol... */</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">myfunc2(<span style="color:blue">void</span>)</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">{<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>myfunc3();</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">}</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"> </span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">void</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">myfunc(<span style="color:blue">int</span> ncalls)</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">{<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">if</span> (ncalls &gt; 1)</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>myfunc(ncalls - 1);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">else</span></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>myfunc2();</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">}</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"> </span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; color:blue; font-size:9.5pt">int</span><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">main(<span style="color:blue">int</span> argc,<span style="color:blue">char</span> *argv[])</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">{<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span><span style="color:blue">if</span> (argc != 2) {<!-- --></span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>fprintf(stderr,<span style="color:#a31515">"%s num-calls\n"</span>, argv[0]);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">       </span>exit(EXIT_FAILURE);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>}</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>myfunc(atoi(argv[1]));</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt"><span style="">   </span>exit(EXIT_SUCCESS);</span></p> <p class="MsoNormal" align="left" style="text-align:left; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-family:NSimSun; font-size:9.5pt">}</span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">编译</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">:</span></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span style=""><span style=""><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"># cc prog.c -o prog</span></span></span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">运行：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"># ./prog 0<br> backtrace() returned 6 addresses<br> ./prog() [0x80485a3]<br> ./prog() [0x8048630]<br> ./prog() [0x8048653]<br> ./prog() [0x80486a7]</span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">这样，是输出了调用栈，不过只是以十六进制输出函数地址而已，可读性很差。仔细看下</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">man</span></span><span style="font-family:宋体; font-size:12pt">手册，原来很简单，编译时加上个参数：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">重新编译：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#bfbfbf; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span style="font-family:Calibri"><span style=""><span style=""><span lang="EN-US" style="font-size:12pt"># cc -<span style="color:red">rdynamic  </span>prog.c -o prog</span></span></span><span lang="EN-US" style="font-size:12pt"></span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">通过</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">gcc</span></span><span style="font-family:宋体; font-size:12pt">手册，我们可以也解下参数的说明</span><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">:</span></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">-rdynamic<br> <span style="">           </span>Pass the flag -export-dynamic to the ELF linker, on targets that support it. This instructs the linker to add all symbols, not only used ones, to the dynamic symbol table. This option is needed for some uses of "dlopen" or to allow obtaining backtraces from within a program.</span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">再执行：</span><span lang="EN-US" style="font-size:12pt"></span></p> 
<table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" style="border-bottom:medium none; border-left:medium none; border-collapse:collapse; background:#d9d9d9; border-top:medium none; border-right:medium none"><tbody><tr style=""><td width="568" style="border-bottom:windowtext 1pt solid; border-left:windowtext 1pt solid; padding-bottom:0cm; background-color:transparent; padding-left:5.4pt; width:426.1pt; padding-right:5.4pt; border-top:windowtext 1pt solid; border-right:windowtext 1pt solid; padding-top:0cm"> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"># ./prog 0</span></span></p> <p class="MsoNormal" style="margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri">backtrace() returned 6 addresses<br> ./prog(myfunc3+0x1f) [0x8048763]<br> ./prog() [0x80487f0]<br> ./prog(myfunc+0x21) [0x8048813]<br> ./prog(main+0x52) [0x8048867]<br> /lib/libc.so.6(__libc_start_main+0xe6) [0xaf9cc6]<br> ./prog() [0x80486b1]</span></span></p> </td></tr></tbody></table> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span lang="EN-US" style="font-size:12pt"><span style="font-family:Calibri"> </span></span></p> 
<p class="MsoNormal" style="text-indent:24pt; margin:0cm 0cm 0pt"><span style="font-family:宋体; font-size:12pt">这回，可以看到函数名了。是不是很酷呢？把它封装到你的调试代码中吧。</span><span lang="EN-US" style="font-size:12pt"></span></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4dff0e85e7e32c45eab572f38d4e3eb2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SOCKS5 Server</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d7d42846cac794161a2344ff2e9b290/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">50Hz工频干扰消除</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>