<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>拥抱变化，面向Java17，Java8-18全系列特性详解 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="拥抱变化，面向Java17，Java8-18全系列特性详解" />
<meta property="og:description" content="文章目录：
Java 8 新特性Java 9 新特性Java 10 新特性Java 11 新特性Java 12 新特性Java 13 新特性Java 14 新特性Java 15 新特性Java 16 新特性Java 17 新特性Java 18 新特性 💡 文章较长，建议点赞、收藏、评论后慢慢看，合理利用 “只看目录功能”
前言 当我们大部分Javaer还沉浸在Java 8 的特性中时，Java 19 预计在2022年9月20号发布，现在半年发布一次的节奏真让人应接不暇，况且Spring Boot 3.0开始最低版本为Java 17，Spring Security、KafKa等也都宣布在后期版本最低需要Java 17 ，所以我们恶补一下Java 8-18的特性很有必要。
Java 8 新特性 Java 8 带来了大量的新特性。主要分为以下几个方面：语言、它的编译器、库、工具和 JVM（Java 虚拟机）。
这个教程包含Java开发者经常面对的几类问题：
语言编译器库工具运行时（JVM） 感兴趣的话，可以看下官网的描述：
https://docs.oracle.com/en/java/javase/index.html
语言新特性 Lambda表达式和函数式接口 一个概念：函数式接口：只有一个方法的接口。
Lambda表达式（也称为闭包）是Java 8中最大和最令人期待的语言改变。
它允许我们将函数当成参数传递给某个方法，或者把代码本身当作数据处理：函数式开发者非常熟悉这些概念。很多JVM平台上的语言（Groovy、Scala等）从诞生之日就支持Lambda表达式，但是Java开发者没有选择，只能使用匿名内部类代替Lambda表达式。
Lambda的设计耗费了很多时间和很大的社区力量，最终找到一种折中的实现方案，可以实现简洁而紧凑的语言结构。最简单的Lambda表达式可由逗号分隔的参数列表、-&gt; 符号和语句块组成。
示例1：
Arrays.asList( &#34;a&#34;, &#34;b&#34;, &#34;d&#34; ).forEach( e -&gt; System.out.println( e ) ); 在上面这个代码中的参数e的类型是由编译器推理得出的，你也可以显式指定该参数的类型，例如：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/384892fabd0139f55667ed0affcabaca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-23T08:44:08+08:00" />
<meta property="article:modified_time" content="2022-08-23T08:44:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">拥抱变化，面向Java17，Java8-18全系列特性详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><strong>文章目录：</strong></p> 
 <ol><li><a href="#8" rel="nofollow">Java 8 新特性</a></li><li><a href="#9" rel="nofollow">Java 9 新特性</a></li><li><a href="#10" rel="nofollow">Java 10 新特性</a></li><li><a href="#11" rel="nofollow">Java 11 新特性</a></li><li><a href="#12" rel="nofollow">Java 12 新特性</a></li><li><a href="#13" rel="nofollow">Java 13 新特性</a></li><li><a href="#14" rel="nofollow">Java 14 新特性</a></li><li><a href="#15" rel="nofollow">Java 15 新特性</a></li><li><a href="#16" rel="nofollow">Java 16 新特性</a></li><li><a href="#17" rel="nofollow">Java 17 新特性</a></li><li><a href="#18" rel="nofollow">Java 18 新特性</a></li></ol> 
</blockquote> 
<blockquote> 
 <p>💡 文章较长，建议点赞、收藏、评论后慢慢看，合理利用 “<strong>只看目录功能</strong>”</p> 
</blockquote> 
<h2><a id="_15"></a>前言</h2> 
<p>当我们大部分Javaer还沉浸在Java 8 的特性中时，Java 19 预计在2022年9月20号发布，现在半年发布一次的节奏真让人应接不暇，况且Spring Boot 3.0开始最低版本为Java 17，Spring Security、KafKa等也都宣布在后期版本最低需要Java 17 ，所以我们恶补一下Java 8-18的特性很有必要。</p> 
<h2><a id="h1_id8Java_8__17"></a></h2> 
<h2 id="8">Java 8 新特性</h2> 
<p>Java 8 带来了大量的新特性。主要分为以下几个方面：语言、它的编译器、库、工具和 JVM（Java 虚拟机）。<br> 这个教程包含Java开发者经常面对的几类问题：</p> 
<ul><li>语言</li><li>编译器</li><li>库</li><li>工具</li><li>运行时（JVM）</li></ul> 
<p>感兴趣的话，可以看下官网的描述：<br> <a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">https://docs.oracle.com/en/java/javase/index.html</a></p> 
<h3><a id="_30"></a>语言新特性</h3> 
<h4><a id="Lambda_31"></a>Lambda表达式和函数式接口</h4> 
<p>一个概念：函数式接口：只有一个方法的接口。<br> Lambda表达式（也称为闭包）是Java 8中最大和最令人期待的语言改变。<br> 它允许我们将函数当成参数传递给某个方法，或者把代码本身当作数据处理：<a href="http://www.javacodegeeks.com/2014/03/functional-programming-with-java-8-lambda-expressions-monads.html" rel="nofollow">函数式开发者</a>非常熟悉这些概念。很多JVM平台上的语言（Groovy、Scala等）从诞生之日就支持Lambda表达式，但是Java开发者没有选择，只能使用匿名内部类代替Lambda表达式。<br> Lambda的设计耗费了很多时间和很大的社区力量，最终找到一种折中的实现方案，可以实现简洁而紧凑的语言结构。最简单的Lambda表达式可由逗号分隔的参数列表、-&gt; 符号和语句块组成。</p> 
<p><strong>示例1：</strong></p> 
<pre><code class="prism language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> e <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> e <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在上面这个代码中的参数e的类型是由编译器推理得出的，你也可以显式指定该参数的类型，例如：</p> 
<pre><code class="prism language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token class-name">String</span> e <span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> e <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例2：</strong><br> 如果Lambda表达式需要更复杂的语句块，则可以使用花括号将该语句块括起来，类似于Java中的函数体，例如</p> 
<pre><code class="prism language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> e <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> e <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例3：</strong><br> Lambda表达式可以引用类成员和局部变量（会将这些变量隐式得转换成final的），例如下列两个代码块的效果完全相同：</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> separator <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> 
    <span class="token punctuation">(</span> <span class="token class-name">String</span> e <span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> e <span class="token operator">+</span> separator <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>和</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">String</span> separator <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">;</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> 
    <span class="token punctuation">(</span> <span class="token class-name">String</span> e <span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> e <span class="token operator">+</span> separator <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>示例4：</strong><br> Lambda表达式有返回值，返回值的类型也由编译器推理得出。如果Lambda表达式中的语句块只有一行，则可以不用使用return语句，下列两个代码片段效果相同：</p> 
<pre><code class="prism language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> e1<span class="token punctuation">,</span> e2 <span class="token punctuation">)</span> <span class="token operator">-&gt;</span> e1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span> e2 <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>和</p> 
<pre><code class="prism language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> e1<span class="token punctuation">,</span> e2 <span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> e1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span> e2 <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>Lambda的设计者们为了让现有的功能与Lambda表达式良好兼容，考虑了很多方法，于是产生了 <a href="http://www.javacodegeeks.com/2013/03/introduction-to-functional-interfaces-a-concept-recreated-in-java-8.html" rel="nofollow">函数接口</a> 这个概念。<br> 函数接口指的是只有一个函数的接口，这样的接口可以隐式转换为Lambda表达式。<strong>java.lang.Runnable</strong>和<strong>java.util.concurrent.Callable</strong>是函数式接口的最佳例子。<br> 在实践中，函数式接口非常脆弱：只要某个开发者在该接口中添加一个函数，则该接口就不再是函数式接口进而导致编译失败。<br> 为了克服这种代码层面的脆弱性，并显式说明某个接口是函数式接口，Java 8 提供了一个特殊的注解 <strong>@FunctionalInterface</strong>（Java 库中的所有相关接口都已经带有这个注解了），举个简单的函数式接口的定义：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Functional</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Lambda表达式作为Java 8的最大卖点，它有潜力吸引更多的开发者加入到JVM平台，并在纯Java编程中使用函数式编程的概念。如果你需要了解更多Lambda表达式的细节，可以<a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html" rel="nofollow">参考官方文档</a>。</p> 
<h4><a id="_90"></a>接口默认方法和静态方法</h4> 
<p>Java 8使用两个新概念扩展了接口的含义：默认方法和静态方法。<br> <strong>接口中可用定义默认方法</strong><br> 默认方法使得接口有点类似traits，不过要实现的目标不一样。默认方法使得开发者可以在不破坏二进制兼容性的前提下，往现存接口中添加新的方法，即不强制那些实现了该接口的类也同时实现这个新加的方法。<br> 默认方法和抽象方法之间的区别在于抽象方法需要实现，而默认方法不需要。接口提供的默认方法会被接口的实现类继承或者覆写，例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">interface</span> <span class="token class-name">Defaulable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Interfaces now allow default methods, the implementer may or </span>
    <span class="token comment">// may not implement (override) them.</span>
    <span class="token keyword">default</span> <span class="token class-name">String</span> <span class="token function">notRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">return</span> <span class="token string">"Default implementation"</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>
 
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DefaultableImpl</span> <span class="token keyword">implements</span> <span class="token class-name">Defaulable</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
 
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OverridableImpl</span> <span class="token keyword">implements</span> <span class="token class-name">Defaulable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">notRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Overridden implementation"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>Defaulable接口使用关键字default定义了一个默认方法notRequired()。<br> DefaultableImpl类实现了这个接口，同时默认继承了这个接口中的默认方法；<br> OverridableImpl类也实现了这个接口，但覆写了该接口的默认方法，并提供了一个不同的实现。</p> 
<p><strong>接口中可用定义静态方法</strong><br> Java 8带来的另一个有趣的特性是在接口中可以定义静态方法，例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">interface</span> <span class="token class-name">DefaulableFactory</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Interfaces now allow static methods</span>
    <span class="token keyword">static</span> <span class="token class-name">Defaulable</span> <span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Defaulable</span><span class="token punctuation">&gt;</span></span> supplier <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面的代码片段整合了默认方法和静态方法的使用场景：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Defaulable</span> defaulable <span class="token operator">=</span> <span class="token class-name">DefaulableFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">DefaultableImpl</span><span class="token operator">::</span><span class="token keyword">new</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> defaulable<span class="token punctuation">.</span><span class="token function">notRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    defaulable <span class="token operator">=</span> <span class="token class-name">DefaulableFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">OverridableImpl</span><span class="token operator">::</span><span class="token keyword">new</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> defaulable<span class="token punctuation">.</span><span class="token function">notRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这段代码的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Default</span> implementation
<span class="token class-name">Overridden</span> implementation
</code></pre> 
<p>由于JVM上的默认方法的实现在字节码层面提供了支持，因此效率非常高。默认方法允许在不打破现有继承体系的基础上改进接口。该特性在官方库中的应用是：给java.util.Collection接口添加新方法，如stream()、parallelStream()、**forEach()和removeIf()**等等。<br> 尽管默认方法有这么多好处，但在实际开发中应该谨慎使用：在复杂的继承体系中，默认方法可能引起歧义和编译错误。如果你想了解更多细节，可以参考<a href="http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html" rel="nofollow">官方文档</a>。</p> 
<h4><a id="_146"></a>方法引用</h4> 
<p>方法引用使得开发者可以直接引用现存的方法、Java类的构造方法或者实例对象。方法引用和Lambda表达式配合使用，使得java类的构造方法看起来紧凑而简洁，没有很多复杂的模板代码。<br> 下面的例子中，<strong>Car</strong>类是不同方法引用的例子，可以帮助读者区分四种类型的方法引用。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Car</span> <span class="token function">create</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Car</span><span class="token punctuation">&gt;</span></span> supplier <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>              
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">collide</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Car</span> car <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Collided "</span> <span class="token operator">+</span> car<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">follow</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Car</span> another <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Following the "</span> <span class="token operator">+</span> another<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">repair</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Repaired "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>第一种方法引用的类型是构造器引用，语法是<strong>Class::new</strong>，或者更一般的形式：<strong>Class&lt; T&gt;::new</strong>。注意：这个构造器没有参数。</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">Car</span> car <span class="token operator">=</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">Car</span><span class="token operator">::</span><span class="token keyword">new</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Car</span><span class="token punctuation">&gt;</span></span> cars <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span> car <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>第二种方法引用的类型是静态方法引用，语法是<strong>Class::static_method</strong>。注意：这个方法接受一个Car类型的参数。</p> 
<pre><code class="prism language-java">cars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token class-name">Car</span><span class="token operator">::</span><span class="token function">collide</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>第三种方法引用的类型是某个类的成员方法的引用，语法是<strong>Class::method</strong>，注意，这个方法没有定义入参：</p> 
<pre><code class="prism language-java">cars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token class-name">Car</span><span class="token operator">::</span><span class="token function">repair</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>第四种方法引用的类型是某个实例对象的成员方法的引用，语法是<strong>instance::method</strong>。注意：这个方法接受一个Car类型的参数：</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">Car</span> police <span class="token operator">=</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">Car</span><span class="token operator">::</span><span class="token keyword">new</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
cars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> police<span class="token operator">::</span><span class="token function">follow</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行上述例子，可以在控制台看到如下输出（Car实例可能不同）：</p> 
<pre><code class="prism language-java"><span class="token class-name">Collided</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>method<span class="token punctuation">.</span>references<span class="token punctuation">.</span></span>MethodReferences</span>$<span class="token class-name">Car</span><span class="token annotation punctuation">@7a81197d</span>
<span class="token class-name">Repaired</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>method<span class="token punctuation">.</span>references<span class="token punctuation">.</span></span>MethodReferences</span>$<span class="token class-name">Car</span><span class="token annotation punctuation">@7a81197d</span>
<span class="token class-name">Following</span> the <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>method<span class="token punctuation">.</span>references<span class="token punctuation">.</span></span>MethodReferences</span>$<span class="token class-name">Car</span><span class="token annotation punctuation">@7a81197d</span>
</code></pre> 
<h4><a id="_193"></a>重复注解</h4> 
<p>自从Java 5中引入注解以来，这个特性开始变得非常流行，并在各个框架和项目中被广泛使用。不过，注解有一个很大的限制是：在同一个地方不能多次使用同一个注解。Java 8打破了这个限制，引入了重复注解的概念，允许在同一个地方多次使用同一个注解。<br> 在Java 8中使用**@Repeatable**注解定义重复注解，实际上，这并不是语言层面的改进，而是编译器做的一个trick，底层的技术仍然相同。可以利用下面的代码说明：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>repeatable<span class="token punctuation">.</span>annotations</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Repeatable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RepeatingAnnotations</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span> <span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Filters</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span> <span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span> <span class="token class-name">Filters</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Filter</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span> <span class="token string">"filter1"</span> <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span> <span class="token string">"filter2"</span> <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Filterable</span> <span class="token punctuation">{<!-- --></span>        
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token class-name">Filter</span> filter<span class="token operator">:</span> <span class="token class-name">Filterable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getAnnotationsByType</span><span class="token punctuation">(</span> <span class="token class-name">Filter</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> filter<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>正如我们所见，这里的<strong>Filter</strong>类使用**@Repeatable(Filters.class)<strong>注解修饰，而</strong>Filters<strong>是存放</strong>Filter<strong>注解的容器，编译器尽量对开发者屏蔽这些细节。这样，<strong>Filterable</strong>接口可以用两个</strong>Filter<strong>注解注释（这里并没有提到任何关于</strong>Filters**的信息）。<br> 另外，反射API提供了一个新的方法：<strong>getAnnotationsByType()</strong>，可以返回某个类型的重复注解，例如<code>Filterable.class.getAnnoation(Filters.class)</code>将返回两个Filter实例，输出到控制台的内容如下所示：</p> 
<pre><code class="prism language-java">filter1
filter2
</code></pre> 
<p>如果你希望了解更多内容，可以参考<a href="http://docs.oracle.com/javase/tutorial/java/annotations/repeating.html" rel="nofollow">官方文档</a>。</p> 
<h4><a id="_239"></a>更好的类型推断</h4> 
<p>Java 8编译器在类型推断方面有很大的提升，在很多场景下编译器可以推导出某个参数的数据类型，从而使得代码更为简洁。例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>type<span class="token punctuation">.</span>inference</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Value</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultValue <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token operator">?</span> value <span class="token operator">:</span> defaultValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下列代码是 <strong>Value&lt; String&gt;</strong> 类型的应用：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>type<span class="token punctuation">.</span>inference</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeInference</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">Value</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Value</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">"22"</span><span class="token punctuation">,</span> <span class="token class-name">Value</span><span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>参数 <strong>Value.defaultValue()</strong> 的类型由编译器推导得出，不需要显式指明。在Java 7中这段代码会有编译错误，除非使用Value.defaultValue()。</p> 
<h4><a id="_266"></a>拓宽注解的应用场景</h4> 
<p>Java 8拓宽了注解的应用场景。现在，注解几乎可以使用在任何元素上：局部变量、接口类型、超类和接口实现类，甚至可以用在函数的异常定义上。下面是一些例子：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>annotations</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Annotations</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span> <span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_USE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_PARAMETER <span class="token punctuation">}</span> <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">NonEmpty</span> <span class="token punctuation">{<!-- --></span>        
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Holder</span><span class="token operator">&lt;</span> <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">T</span> <span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">Object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span> <span class="token string">"unused"</span> <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">String</span> <span class="token punctuation">&gt;</span></span> holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">String</span> <span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">Collection</span><span class="token operator">&lt;</span> <span class="token annotation punctuation">@NonEmpty</span> <span class="token class-name">String</span> <span class="token operator">&gt;</span> strings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>ElementType.TYPE_USER</strong> 和 <strong>ElementType.TYPE_PARAMETER</strong> 是Java 8新增的两个注解，用于描述注解的使用场景。Java 语言也做了对应的改变，以识别这些新增的注解。</p> 
<h3><a id="_297"></a>编译器的新特性</h3> 
<h4><a id="_298"></a>参数名称</h4> 
<p><strong>在运行时获得Java程序中方法的参数名称</strong><br> 为了在运行时获得Java程序中方法的参数名称，老一辈的Java程序员必须使用不同方法，例如Paranamer liberary。Java 8终于将这个特性规范化，在语言层面（使用反射API和 Parameter.getName()方法 ）和字节码层面（使用新的javac编译器以及 -parameters 参数）提供支持。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>names</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Parameter</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParameterNames</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">ParameterNames</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Parameter</span> parameter<span class="token operator">:</span> method<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Parameter: "</span> <span class="token operator">+</span> parameter<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在Java 8中这个特性是默认关闭的，因此如果不带 <strong>-parameters</strong> 参数编译上述代码并运行，则会输出如下结果：</p> 
<pre><code class="prism language-java"><span class="token class-name">Parameter</span><span class="token operator">:</span> arg0
</code></pre> 
<p>如果带 <strong>-parameters</strong> 参数，则会输出如下结果（正确的结果）：</p> 
<pre><code class="prism language-java"><span class="token class-name">Parameter</span><span class="token operator">:</span> args
</code></pre> 
<p>如果你使用Maven进行项目管理，则可以在 <strong>maven-compiler-plugin</strong> 编译器的配置项中配置**-parameters**参数：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>compilerArgument</span><span class="token punctuation">&gt;</span></span>-parameters<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>compilerArgument</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_337"></a>官方库的新特性</h3> 
<h4><a id="Optional_338"></a>Optional</h4> 
<p>Java应用中最常见的bug就是<strong>空值异常</strong>。在Java 8之前，Google Guava引入了<strong>Optionals</strong>类来解决<strong>NullPointerException</strong>，从而避免源码被各种null检查污染，以便开发者写出更加整洁的代码。<br> Java 8也将Optional加入了官方库。<br> Optional仅仅是一个功能：存放T类型的值或者null。它提供了一些有用的接口来避免显式的null检查，可以参考Java 8官方文档了解更多细节。<br> 接下来看一点使用Optional的例子：可能为空的值或者某个类型的值：</p> 
<pre><code class="prism language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> fullName <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Full Name is set? "</span> <span class="token operator">+</span> fullName<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Full Name: "</span> <span class="token operator">+</span> fullName<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"[none]"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> fullName<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> s <span class="token operator">-&gt;</span> <span class="token string">"Hey "</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">"!"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span> <span class="token string">"Hey Stranger!"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果**Optional **实例持有一个非空值，则 **isPresent() **方法返回true，否则返回false；<br> **orElseGet() **方法，**Optional **实例持有null，则可以接受一个lambda表达式生成的默认值；<br> **map() **方法可以将现有的 **Opetional **实例的值转换成新的值；<br> <strong>orElse()</strong> 方法与 **orElseGet() **方法类似，但是在持有null的时候返回传入的默认值。<br> 上述代码的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Full</span> <span class="token class-name">Name</span> is set<span class="token operator">?</span> <span class="token boolean">false</span>
<span class="token class-name">Full</span> <span class="token class-name">Name</span><span class="token operator">:</span> <span class="token punctuation">[</span>none<span class="token punctuation">]</span>
<span class="token class-name">Hey</span> <span class="token class-name">Stranger</span><span class="token operator">!</span>
</code></pre> 
<p>再看下另一个简单的例子：</p> 
<pre><code class="prism language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> firstName <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span> <span class="token string">"Tom"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"First Name is set? "</span> <span class="token operator">+</span> firstName<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"First Name: "</span> <span class="token operator">+</span> firstName<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"[none]"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> firstName<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token string">"Hey "</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">"!"</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span> <span class="token string">"Hey Stranger!"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个例子的输出是：</p> 
<pre><code class="prism language-java"><span class="token class-name">First</span> <span class="token class-name">Name</span> is set<span class="token operator">?</span> <span class="token boolean">true</span>
<span class="token class-name">First</span> <span class="token class-name">Name</span><span class="token operator">:</span> <span class="token class-name">Tom</span>
<span class="token class-name">Hey</span> <span class="token class-name">Tom</span><span class="token operator">!</span>
</code></pre> 
<p>如果想了解更多的细节，请参考<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Optional.html" rel="nofollow">官方文档</a>。<br> <strong>Optional源码</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Function</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Predicate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Supplier</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A container object which may or may not contain a non-null value.
 * If a value is present, {@code isPresent()} will return {@code true} and
 * {@code get()} will return the value.
 *
 * &lt;p&gt;Additional methods that depend on the presence or absence of a contained
 * value are provided, such as {@link #orElse(java.lang.Object) orElse()}
 * (return a default value if value not present) and
 * {@link #ifPresent(java.util.function.Consumer) ifPresent()} (execute a block
 * of code if the value is present).
 *
 * &lt;p&gt;This is a &lt;a href="../lang/doc-files/ValueBased.html"&gt;value-based&lt;/a&gt;
 * class; use of identity-sensitive operations (including reference equality
 * ({@code ==}), identity hash code, or synchronization) on instances of
 * {@code Optional} may have unpredictable results and should be avoided.
 *
 * @since 1.8
 */</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * Common instance for {@code empty()}.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> EMPTY <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * If non-null, the value; if null, indicates no value is present
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">T</span> value<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Constructs an empty instance.
     *
     * @implNote Generally only one empty instance, {@link Optional#EMPTY},
     * should exist per VM.
     * 
     * 无参构造
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns an empty {@code Optional} instance.  No value is present for this
     * Optional.
     *
     * @apiNote Though it may be tempting to do so, avoid testing if an object
     * is empty by comparing with {@code ==} against instances returned by
     * {@code Option.empty()}. There is no guarantee that it is a singleton.
     * Instead, use {@link #isPresent()}.
     *
     * @param &lt;T&gt; Type of the non-existent value
     * @return an empty {@code Optional}
     * 
     *  返回一个空Optional实例。
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> EMPTY<span class="token punctuation">;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Constructs an instance with the value present.
     *
     * @param value the non-null value to be present
     * @throws NullPointerException if value is null
     *
     * 有参构造
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Optional</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns an {@code Optional} with the specified present non-null value.
     *
     * @param &lt;T&gt; the class of the value
     * @param value the value to be present, which must be non-null
     * @return an {@code Optional} with the value present
     * @throws NullPointerException if value is null
     *
     * 返回一个具有指定当前非空值的Optional实例。
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns an {@code Optional} describing the specified value, if non-null,
     * otherwise returns an empty {@code Optional}.
     *
     * @param &lt;T&gt; the class of the value
     * @param value the possibly-null value to describe
     * @return an {@code Optional} with a present value if the specified value
     * is non-null, otherwise an empty {@code Optional}
     *
     * 如果非空，返回一个指定值Optional实例，否则返回一个空Optional。
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * If a value is present in this {@code Optional}, returns the value,
     * otherwise throws {@code NoSuchElementException}.
     *
     * @return the non-null value held by this {@code Optional}
     * @throws NoSuchElementException if there is no value present
     *
     * @see Optional#isPresent()
     *
     * 如果 this 中存在Optional值，则返回该值，否则抛出NoSuchElementException。
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token string">"No value present"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Return {@code true} if there is a value present, otherwise {@code false}.
     *
     * @return {@code true} if there is a value present, otherwise {@code false}
     *
     * 如果存在值（不为null）则返回true，否则返回false。
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * If a value is present, invoke the specified consumer with the value,
     * otherwise do nothing.
     *
     * @param consumer block to be executed if a value is present
     * @throws NullPointerException if value is present and {@code consumer} is
     * null
     *
     * 如果存在值，则使用该值调用指定的使用者，否则不执行任何操作。
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * If a value is present, and the value matches the given predicate,
     * return an {@code Optional} describing the value, otherwise return an
     * empty {@code Optional}.
     *
     * @param predicate a predicate to apply to the value, if present
     * @return an {@code Optional} describing the value of this {@code Optional}
     * if a value is present and the value matches the given predicate,
     * otherwise an empty {@code Optional}
     * @throws NullPointerException if the predicate is null
     *
     * 如果存在一个值，并且该值与给定的谓词匹配，则返回一个Optional描述该值的值，否则返回一个空值Optional。
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> predicate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>predicate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * If a value is present, apply the provided mapping function to it,
     * and if the result is non-null, return an {@code Optional} describing the
     * result.  Otherwise return an empty {@code Optional}.
     *
     * @apiNote This method supports post-processing on optional values, without
     * the need to explicitly check for a return status.  For example, the
     * following code traverses a stream of file names, selects one that has
     * not yet been processed, and then opens that file, returning an
     * {@code Optional&lt;FileInputStream&gt;}:
     *
     * &lt;pre&gt;{@code
     *     Optional&lt;FileInputStream&gt; fis =
     *         names.stream().filter(name -&gt; !isProcessedYet(name))
     *                       .findFirst()
     *                       .map(name -&gt; new FileInputStream(name));
     * }&lt;/pre&gt;
     *
     * Here, {@code findFirst} returns an {@code Optional&lt;String&gt;}, and then
     * {@code map} returns an {@code Optional&lt;FileInputStream&gt;} for the desired
     * file if one exists.
     *
     * @param &lt;U&gt; The type of the result of the mapping function
     * @param mapper a mapping function to apply to the value, if present
     * @return an {@code Optional} describing the result of applying a mapping
     * function to the value of this {@code Optional}, if a value is present,
     * otherwise an empty {@code Optional}
     * @throws NullPointerException if the mapping function is null
     *
     * 如果存在值，则对其应用提供的映射函数，如果结果为非 null，则返回Optional描述结果。
     */</span>
    <span class="token keyword">public</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * If a value is present, apply the provided {@code Optional}-bearing
     * mapping function to it, return that result, otherwise return an empty
     * {@code Optional}.  This method is similar to {@link #map(Function)},
     * but the provided mapper is one whose result is already an {@code Optional},
     * and if invoked, {@code flatMap} does not wrap it with an additional
     * {@code Optional}.
     *
     * @param &lt;U&gt; The type parameter to the {@code Optional} returned by
     * @param mapper a mapping function to apply to the value, if present
     *           the mapping function
     * @return the result of applying an {@code Optional}-bearing mapping
     * function to the value of this {@code Optional}, if a value is present,
     * otherwise an empty {@code Optional}
     * @throws NullPointerException if the mapping function is null or returns
     * a null result
     *
     * 如果存在值，则将提供的Optional-bearing 映射函数应用于它，返回该结果，否则返回空 Optional。
     */</span>
    <span class="token keyword">public</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Optional</span><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Return the value if present, otherwise return {@code other}.
     *
     * @param other the value to be returned if there is no value present, may
     * be null
     * @return the value, if present, otherwise {@code other}
     *
     * 对自身判断，如果存在则返回自身，否则返回other。
     * 对自身判断，如果不为null则返回自身，否则返回一个指定的值。
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Return the value if present, otherwise invoke {@code other} and return
     * the result of that invocation.
     *
     * @param other a {@code Supplier} whose result is returned if no value
     * is present
     * @return the value if present otherwise the result of {@code other.get()}
     * @throws NullPointerException if value is not present and {@code other} is
     * null
     *
     * 如果存在则返回该值，否则调用other并返回该调用的结果。
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Return the contained value, if present, otherwise throw an exception
     * to be created by the provided supplier.
     *
     * @apiNote A method reference to the exception constructor with an empty
     * argument list can be used as the supplier. For example,
     * {@code IllegalStateException::new}
     *
     * @param &lt;X&gt; Type of the exception to be thrown
     * @param exceptionSupplier The supplier which will return the exception to
     * be thrown
     * @return the present value
     * @throws X if there is no value present
     * @throws NullPointerException if no value is present and
     * {@code exceptionSupplier} is null
     *
     * 如果存在（不为null），则返回该值，否则抛出由提供的供应商创建的异常。
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> exceptionSupplier<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">X</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> exceptionSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Indicates whether some other object is "equal to" this Optional. The
     * other object is considered equal if:
     * &lt;ul&gt;
     * &lt;li&gt;it is also an {@code Optional} and;
     * &lt;li&gt;both instances have no value present or;
     * &lt;li&gt;the present values are "equal to" each other via {@code equals()}.
     * &lt;/ul&gt;
     *
     * @param obj an object to be tested for equality
     * @return {code true} if the other object is "equal to" this object
     * otherwise {@code false}
     *
     * 判断某个其他对象是否“等于”此 Optional。 相等返回true，不想等返回false
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Optional</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> other<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns the hash code value of the present value, if any, or 0 (zero) if
     * no value is present.
     *
     * @return hash code value of the present value or 0 if no value is present
     *
     * 返回当前值的哈希码值（如果有）；如果不存在值，则返回 0（零）。
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns a non-empty string representation of this Optional suitable for
     * debugging. The exact presentation format is unspecified and may vary
     * between implementations and versions.
     *
     * @implSpec If a value is present the result must include its string
     * representation in the result. Empty and present Optionals must be
     * unambiguously differentiable.
     *
     * @return the string representation of this instance
     *
     * 返回此 Optional 适合调试的非空字符串表示形式。
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Optional[%s]"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token string">"Optional.empty"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Stream_737"></a>Stream</h4> 
<p>新增的Stream API（java.util.stream）将生成环境的函数式编程引入了Java库中。这是目前为止最大的一次对Java库的完善，以便开发者能够写出更加有效、更加简洁和紧凑的代码。<br> Steam API极大得简化了集合操作（后面我们会看到不止是集合），首先看下这个叫Task的类：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Streams</span>  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">enum</span> <span class="token class-name">Status</span> <span class="token punctuation">{<!-- --></span>
        OPEN<span class="token punctuation">,</span> CLOSED
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Status</span> status<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> points<span class="token punctuation">;</span>
 
        <span class="token class-name">Task</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">Status</span> status<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> points <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>points <span class="token operator">=</span> points<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> points<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">public</span> <span class="token class-name">Status</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> status<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span> <span class="token string">"[%s, %d]"</span><span class="token punctuation">,</span> status<span class="token punctuation">,</span> points <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Task类有一个分数（或伪复杂度）的概念，另外还有两种状态：OPEN或者CLOSED。现在假设有一个task集合：</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">Task</span> <span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span> <span class="token class-name">Status</span><span class="token punctuation">.</span>OPEN<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span> <span class="token class-name">Status</span><span class="token punctuation">.</span>OPEN<span class="token punctuation">,</span> <span class="token number">13</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span> <span class="token class-name">Status</span><span class="token punctuation">.</span>CLOSED<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>首先看一个问题：在这个task集合中一共有多少个OPEN状态的点？<br> 在Java 8之前，要解决这个问题，则需要使用 <strong>foreach</strong> 循环遍历task集合；<br> 但是在Java 8中可以利用steams解决：包括一系列元素的列表，并且支持顺序和并行处理。</p> 
<pre><code class="prism language-java"><span class="token comment">// Calculate total points of all active tasks using sum()</span>
<span class="token keyword">final</span> <span class="token keyword">long</span> totalPointsOfOpenTasks <span class="token operator">=</span> tasks
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span> task <span class="token operator">-&gt;</span> task<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Status</span><span class="token punctuation">.</span>OPEN <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span> <span class="token class-name">Task</span><span class="token operator">::</span><span class="token function">getPoints</span> <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Total points: "</span> <span class="token operator">+</span> totalPointsOfOpenTasks <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行这个方法的控制台输出是：</p> 
<pre><code class="prism language-java"><span class="token class-name">Total</span> points<span class="token operator">:</span> <span class="token number">18</span>
</code></pre> 
<p>这里有很多知识点值得说。</p> 
<ul><li>首先，tasks集合被转换成steam表示；</li><li>其次，在steam上的 filter 操作会过滤掉所有CLOSED的task；</li><li>第三，mapToInt 操作基于每个task实例的 Task::getPoints 方法将task流转换成Integer集合；</li><li>最后，通过sum方法计算总和，得出最后的结果。</li></ul> 
<p>在学习下一个例子之前，还需要记住一些steams（<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#StreamOps" rel="nofollow">点此更多细节</a>）的知识点。Steam之上的操作可分为中间操作和终止操作。详情可参考：Stream API<br> 中间操作会返回一个新的steam——执行一个中间操作（例如 <strong>filter</strong> ）并不会执行实际的过滤操作，而是创建一个新的steam，并将原steam中符合条件的元素放入新创建的steam。<br> 终止操作（例如 <strong>forEach</strong> 或者 <strong>sum</strong> ），会遍历steam并得出结果或者附带结果；在执行终止操作之后，steam处理线已经处理完毕，就不能使用了。在几乎所有情况下，终止操作都是立刻对steam进行遍历。<br> steam的另一个价值是创造性地支持并行处理（parallel processing）。对于上述的tasks集合，我们可以用下面的代码计算所有任务的点数之和：</p> 
<pre><code class="prism language-java"><span class="token comment">// Calculate total points of all tasks</span>
<span class="token keyword">final</span> <span class="token keyword">double</span> totalPoints <span class="token operator">=</span> tasks
   <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> task <span class="token operator">-&gt;</span> task<span class="token punctuation">.</span><span class="token function">getPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// or map( Task::getPoints ) </span>
   <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Total points (all tasks): "</span> <span class="token operator">+</span> totalPoints <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们使用<strong>parallel</strong>方法并行处理所有的task，并使用<strong>reduce</strong>方法计算最终的结果。控制台输出如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Total</span> points（all tasks）<span class="token operator">:</span> <span class="token number">26.0</span>
</code></pre> 
<p>对于一个集合，经常需要根据某些条件对其中的元素分组。利用steam提供的API可以很快完成这类任务，代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// Group tasks by their status</span>
<span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">Status</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span> <span class="token class-name">Task</span> <span class="token punctuation">&gt;</span> <span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> tasks
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span> <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Task</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> map <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>控制台的输出如下：</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>CLOSED<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span>CLOSED<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> OPEN<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span>OPEN<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>OPEN<span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> 
<p>最后一个关于tasks集合的例子问题是：如何计算集合中每个任务的点数在集合中所占的比重，具体处理的代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// Calculate the weight of each tasks (as percent of total points) </span>
<span class="token keyword">final</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">String</span> <span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> tasks
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                        <span class="token comment">// Stream&lt; String &gt;</span>
    <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span> <span class="token class-name">Task</span><span class="token operator">::</span><span class="token function">getPoints</span> <span class="token punctuation">)</span>                     <span class="token comment">// IntStream</span>
    <span class="token punctuation">.</span><span class="token function">asLongStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                  <span class="token comment">// LongStream</span>
    <span class="token punctuation">.</span><span class="token function">mapToDouble</span><span class="token punctuation">(</span> points <span class="token operator">-&gt;</span> points <span class="token operator">/</span> totalPoints <span class="token punctuation">)</span>   <span class="token comment">// DoubleStream</span>
    <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                         <span class="token comment">// Stream&lt; Double &gt;</span>
    <span class="token punctuation">.</span><span class="token function">mapToLong</span><span class="token punctuation">(</span> weigth <span class="token operator">-&gt;</span> <span class="token punctuation">(</span> <span class="token keyword">long</span> <span class="token punctuation">)</span><span class="token punctuation">(</span> weigth <span class="token operator">*</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// LongStream</span>
    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span> percentage <span class="token operator">-&gt;</span> percentage <span class="token operator">+</span> <span class="token string">"%"</span> <span class="token punctuation">)</span>      <span class="token comment">// Stream&lt; String&gt; </span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span> <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// List&lt; String &gt; </span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> result <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>控制台输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token number">19</span><span class="token operator">%</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token operator">%</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token operator">%</span><span class="token punctuation">]</span>
</code></pre> 
<p>最后，正如之前所说，Steam API不仅可以作用于Java集合，传统的IO操作（从文件或者网络一行一行得读取数据）可以受益于steam处理，这里有一个小例子：</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span> filename <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">(</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    lines<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Done!"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Stream的方法 onClose 返回一个等价的有额外句柄的Stream，当Stream的 close() 方法被调用的时候这个句柄会被执行。<br> Stream API、Lambda表达式还有接口默认方法和静态方法支持的方法引用，是Java 8对软件开发的现代范式的响应。<br> Stream流与Lambda表达式、方法引用等结合使用，效果还是比较不错的，可以多加练习。</p> 
<h4><a id="DateTime_APIJSR_310_861"></a>Date/Time API(JSR 310)</h4> 
<p>Java 8引入了<a href="https://jcp.org/en/jsr/detail?id=310" rel="nofollow">新的Date-Time API(JSR 310)</a>来改进时间、日期的处理。时间和日期的管理一直是最令Java开发者痛苦的问题。<strong>java.util.Date</strong>和后来的<strong>java.util.Calendar</strong>一直没有解决这个问题（甚至令开发者更加迷茫）。<br> 因为上面这些原因，诞生了第三方库Joda-Time，可以替代Java的时间管理API。Java 8中新的时间和日期管理API深受Joda-Time影响，并吸收了很多Joda-Time的精华。新的java.time包包含了所有关于日期、时间、时区、Instant（跟日期类似但是精确到纳秒）、duration（持续时间）和时钟操作的类。新设计的API认真考虑了这些类的不变性（从java.util.Calendar吸取的教训），如果某个实例需要修改，则返回一个新的对象。<br> 我们接下来看看java.time包中的关键类和各自的使用例子。首先，<strong>Clock</strong> 类使用时区来返回当前的纳秒时间和日期。<strong>Clock</strong> 可以替代 <strong>System.currentTimeMillis()</strong> 和 <strong>TimeZone.getDefault()</strong> 。</p> 
<pre><code class="prism language-java"><span class="token comment">// Get the system clock as UTC offset </span>
<span class="token keyword">final</span> <span class="token class-name">Clock</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemUTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> clock<span class="token punctuation">.</span><span class="token function">instant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> clock<span class="token punctuation">.</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个例子的输出结果是：</p> 
<pre><code class="prism language-java"><span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T15<span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">29.282</span>Z
<span class="token number">1397315969360</span>
</code></pre> 
<p>第二，关注下 <strong>LocalDate</strong> 和 <strong>LocalTime</strong> 类。<strong>LocalDate</strong> 仅仅包含ISO-8601日历系统中的日期部分；<strong>LocalTime</strong>则仅仅包含该日历系统中的时间部分。这两个类的对象都可以使用Clock对象构建得到。</p> 
<pre><code class="prism language-java"><span class="token comment">// Get the local date and local time</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDate</span> date <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDate</span> dateFromClock <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span> clock <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> date <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> dateFromClock <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Get the local date and local time</span>
<span class="token keyword">final</span> <span class="token class-name">LocalTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">LocalTime</span> timeFromClock <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span> clock <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> time <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> timeFromClock <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述例子的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>
<span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">25</span><span class="token operator">:</span><span class="token number">54.568</span>
<span class="token number">15</span><span class="token operator">:</span><span class="token number">25</span><span class="token operator">:</span><span class="token number">54.568</span>
</code></pre> 
<p><strong>LocalDateTime</strong> 类包含了LocalDate和LocalTime的信息，但是不包含ISO-8601日历系统中的时区信息。这里有一些<a href="https://www.javacodegeeks.com/2014/04/java-8-date-time-api-tutorial-localdatetime.html" rel="nofollow">关于LocalDate和LocalTime的例子</a>：</p> 
<pre><code class="prism language-java"><span class="token comment">// Get the local date/time</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDateTime</span> datetime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDateTime</span> datetimeFromClock <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span> clock <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> datetime <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> datetimeFromClock <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述这个例子的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T11<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">52.309</span>
<span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T15<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">52.309</span>
</code></pre> 
<p>如果你需要特定时区的data/time信息，则可以使用<strong>ZoneDateTime</strong>，它保存有ISO-8601日期系统的日期和时间，而且有时区信息。下面是一些使用不同时区的例子：</p> 
<pre><code class="prism language-java"><span class="token comment">// Get the zoned date/time</span>
<span class="token keyword">final</span> <span class="token class-name">ZonedDateTime</span> zonedDatetime <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">ZonedDateTime</span> zonedDatetimeFromClock <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span> clock <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">ZonedDateTime</span> zonedDatetimeFromZone <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span> <span class="token string">"America/Los_Angeles"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> zonedDatetime <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> zonedDatetimeFromClock <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> zonedDatetimeFromZone <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个例子的输出结果是：</p> 
<pre><code class="prism language-java"><span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T11<span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">01.017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">[</span><span class="token class-name">America</span><span class="token operator">/</span><span class="token class-name">New_York</span><span class="token punctuation">]</span>
<span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T15<span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">01.017</span>Z
<span class="token number">2014</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>T08<span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">01.017</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">[</span><span class="token class-name">America</span><span class="token operator">/</span><span class="token class-name">Los_Angeles</span><span class="token punctuation">]</span>
</code></pre> 
<p>最后看下<strong>Duration</strong>类，它持有的时间精确到秒和纳秒。这使得我们可以很容易得计算两个日期之间的不同，例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// Get duration between two dates</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDateTime</span> from <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span> <span class="token number">2014</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>APRIL<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">LocalDateTime</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span> <span class="token number">2015</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>APRIL<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">final</span> <span class="token class-name">Duration</span> duration <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span> from<span class="token punctuation">,</span> <span class="token keyword">to</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Duration in days: "</span> <span class="token operator">+</span> duration<span class="token punctuation">.</span><span class="token function">toDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Duration in hours: "</span> <span class="token operator">+</span> duration<span class="token punctuation">.</span><span class="token function">toHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个例子用于计算2014年4月16日和2015年4月16日之间的天数和小时数，输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Duration</span> in days<span class="token operator">:</span> <span class="token number">365</span>
<span class="token class-name">Duration</span> in hours<span class="token operator">:</span> <span class="token number">8783</span>
</code></pre> 
<p>对于Java 8的新日期时间的总体印象还是比较积极的，一部分是因为Joda-Time的积极影响，另一部分是因为官方终于听取了开发人员的需求。如果希望了解更多细节，可以参考<a href="http://docs.oracle.com/javase/tutorial/datetime/index.html" rel="nofollow">官方文档</a>。</p> 
<h4><a id="Nashorn_JavaScript_946"></a>Nashorn JavaScript引擎</h4> 
<p>Java 8提供了新的<a href="http://www.javacodegeeks.com/2014/02/java-8-compiling-lambda-expressions-in-the-new-nashorn-js-engine.html" rel="nofollow">Nashorn JavaScript</a>引擎，使得我们可以在JVM上开发和运行JS应用。Nashorn JavaScript引擎是javax.script.ScriptEngine的另一个实现版本，这类Script引擎遵循相同的规则，允许Java和JavaScript交互使用，例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">ScriptEngineManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ScriptEngine</span> engine <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span> <span class="token string">"JavaScript"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> engine<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Result:"</span> <span class="token operator">+</span> engine<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span> <span class="token string">"function f() { return 1; }; f() + 1;"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个代码的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">jdk<span class="token punctuation">.</span>nashorn<span class="token punctuation">.</span>api<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span></span>NashornScriptEngine</span>
<span class="token class-name">Result</span><span class="token operator">:</span> <span class="token number">2</span>
</code></pre> 
<h4><a id="Base64_959"></a>Base64</h4> 
<p><a href="http://www.javacodegeeks.com/2014/04/base64-in-java-8-its-not-too-late-to-join-in-the-fun.html" rel="nofollow">对Base64编码的支持</a>已经被加入到Java 8官方库中，这样不需要使用第三方库就可以进行Base64编码，例子代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>base64</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Base64s</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"Base64 finally in Java 8!"</span><span class="token punctuation">;</span>
 
        <span class="token keyword">final</span> <span class="token class-name">String</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span>
            <span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8 <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> encoded <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">final</span> <span class="token class-name">String</span> decoded <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span> 
            <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span> encoded <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8 <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> decoded <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个例子的输出结果如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">QmFzZTY0IGZpbmFsbHkgaW4gSmF2YSA4IQ</span><span class="token operator">==</span>
<span class="token class-name">Base64</span> <span class="token keyword">finally</span> in <span class="token class-name">Java</span> <span class="token number">8</span><span class="token operator">!</span>
</code></pre> 
<p>新的Base64API也支持URL和MINE的编码解码。<br> (<strong>Base64.<em>getUrlEncoder</em>()</strong> / <strong>Base64.<em>getUrlDecoder</em>()</strong>, <strong>Base64.<em>getMimeEncoder</em>()</strong> / <strong>Base64.<em>getMimeDecoder</em>()</strong>)。</p> 
<h4><a id="_990"></a>并行数组</h4> 
<p>Java8版本新增了很多新的方法，用于支持并行数组处理。最重要的方法是 <strong>parallelSort()</strong> ，可以显著加快多核机器上的数组排序。下面的例子论证了<strong>parallexXxx</strong> 系列的方法：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javacodegeeks<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>parallel<span class="token punctuation">.</span>arrays</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelArrays</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfLong <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">long</span> <span class="token punctuation">[</span> <span class="token number">20000</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>        
 
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelSetAll</span><span class="token punctuation">(</span> arrayOfLong<span class="token punctuation">,</span> 
            index <span class="token operator">-&gt;</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span> <span class="token number">1000000</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span> arrayOfLong <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> 
            i <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token string">" "</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelSort</span><span class="token punctuation">(</span> arrayOfLong <span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span> arrayOfLong <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> 
            i <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token string">" "</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述这些代码使用**parallelSetAll()<strong>方法生成20000个随机数，然后使用</strong>parallelSort()**方法进行排序。这个程序会输出乱序数组和排序数组的前10个元素。上述例子的代码输出的结果是：</p> 
<pre><code class="prism language-java"><span class="token class-name">Unsorted</span><span class="token operator">:</span> <span class="token number">591217</span> <span class="token number">891976</span> <span class="token number">443951</span> <span class="token number">424479</span> <span class="token number">766825</span> <span class="token number">351964</span> <span class="token number">242997</span> <span class="token number">642839</span> <span class="token number">119108</span> <span class="token number">552378</span> 
<span class="token class-name">Sorted</span><span class="token operator">:</span> <span class="token number">39</span> <span class="token number">220</span> <span class="token number">263</span> <span class="token number">268</span> <span class="token number">325</span> <span class="token number">607</span> <span class="token number">655</span> <span class="token number">678</span> <span class="token number">723</span> <span class="token number">793</span>
</code></pre> 
<h4><a id="_1020"></a>并发性</h4> 
<p>基于新增的lambda表达式和steam特性，为Java 8中为<strong>java.util.concurrent.ConcurrentHashMap</strong> 类添加了新的方法来支持聚焦操作；另外，也为<strong>java.util.concurrentForkJoinPool <strong>类添加了新的方法来支持通用线程池操作（更多内容可以参考<a href="http://academy.javacodegeeks.com/course/java-concurrency-essentials/" rel="nofollow">并发编程</a>）。<br> Java 8还添加了新的</strong>java.util.concurrent.locks.StampedLock</strong> 类，用于支持基于容量的锁——该锁有三个模型用于支持读写操作（可以把这个锁当做是<strong>java.util.concurrent.locks.ReadWriteLock</strong> 的替代者）。<br> 在**java.util.concurrent.atomic **包中也新增了不少工具类，列举如下：</p> 
<ul><li>DoubleAccumulator</li><li>DoubleAdder</li><li>LongAccumulator</li><li>LongAdder</li></ul> 
<h3><a id="Java_1029"></a>新的Java工具</h3> 
<h4><a id="Nashornjjs_1030"></a>Nashorn引擎：jjs</h4> 
<p><strong>jjs</strong>是一个基于标准Nashorn引擎的命令行工具，可以接受js源码并执行。例如，我们写一个<strong>func.js</strong>文件，内容如下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
     <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
 
<span class="token function">print</span><span class="token punctuation">(</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>可以在命令行中执行这个命令：jjs func.js，控制台输出结果是：</p> 
<pre><code class="prism language-javascript"><span class="token number">2</span>
</code></pre> 
<p>如果需要了解细节，可以参考<a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jjs.html" rel="nofollow">官方文档</a>。</p> 
<h4><a id="jdeps_1045"></a>类依赖分析器：jdeps</h4> 
<p><strong>jdeps</strong>是一个相当棒的命令行工具，它可以展示包层级和类层级的Java类依赖关系，它以**.class**文件、目录或者Jar文件为输入，然后会把依赖关系输出到控制台。<br> 我们可以利用jedps分析下Spring Framework库，为了让结果少一点，仅仅分析一个JAR文件：org.springframework.core-3.0.5.RELEASE.jar。</p> 
<pre><code class="prism language-javascript">jdeps org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">.</span>jar
</code></pre> 
<p>这个命令会输出很多结果，我们仅看下其中的一部分：依赖关系按照包分组，如果在classpath上找不到依赖，则显示"not found".</p> 
<pre><code class="prism language-javascript">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">.</span>jar <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token constant">C</span><span class="token operator">:</span>\Program Files\Java\jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>\jre\lib\rt<span class="token punctuation">.</span>jar
   org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span><span class="token function">core</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">.</span>jar<span class="token punctuation">)</span>
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>io                                            
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang                                          
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation                               
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref                                      
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect                                  
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>util                                          
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent                               
      <span class="token operator">-</span><span class="token operator">&gt;</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging                         not found
      <span class="token operator">-</span><span class="token operator">&gt;</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>asm                            not found
      <span class="token operator">-</span><span class="token operator">&gt;</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>commons                    not found
   org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">annotation</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">.</span>jar<span class="token punctuation">)</span>
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang                                          
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation                               
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect                                  
      <span class="token operator">-</span><span class="token operator">&gt;</span> java<span class="token punctuation">.</span>util
</code></pre> 
<p>更多的细节可以参考<a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jdeps.html" rel="nofollow">官方文档</a>。</p> 
<h3><a id="JVM_1074"></a>JVM的新特性</h3> 
<p>使用 Metaspace （<a href="http://openjdk.java.net/jeps/122" rel="nofollow">JEP 122</a>）代替持久代（PermGen space）。<br> 在JVM参数方面，使用 <strong>-XX:MetaSpaceSize</strong>和 <strong>-XX:MaxMetaspaceSize</strong> 代替原来的 <strong>-XX:PermSize</strong> 和 <strong>-XX:MaxPermSize</strong>。</p> 
<h2><a id="h1_id9Java_9__1078"></a></h2> 
<h2 id="9">Java 9 新特性</h2> 
<p>Java9 是Java8后一个比较大的更新，包含新特性比较多，此篇文章只总结下Java 9 版本的一些重要的新特性。并不完全。<br> Java 9 全部的新特性，请看官网：<a href="https://docs.oracle.com/javase/9/whatsnew/toc.htm#JSNEW-GUID-C23AFD78-C777-460B-8ACE-58BE5EA681F6" rel="nofollow">Java 平台，标准版 Oracle JDK 9 中的新增功能</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="_1083"></a>模块化</h3> 
<p>Java 9 中的模块化是对 Java 的一次重大改进。但是模块化并不是最近才提出来的，我们经常使用的 maven 构建工具，就是典型的模块化构建工具。模块化不仅让模块命名清晰，写出高内聚低耦合的代码，更可以方便处理模块之间的调用关系。<br> module 是新增的Java代码访问权限级别，每个module可以包含多个package。<br> 通过<strong>module-info.java</strong>文件来声明该文件夹及其子文件夹为一个模块，**exports **关键字可以用来控制模块内哪些包对外暴露。</p> 
<pre><code class="prism language-java"> <span class="token keyword">module</span> <span class="token namespace">store<span class="token punctuation">.</span>api</span><span class="token punctuation">{<!-- --></span>
   <span class="token keyword">exports</span> <span class="token namespace">com<span class="token punctuation">.</span>dingtalk<span class="token punctuation">.</span>store<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>使用module后，即使包中的类是public的，如果未通过exports显式导出其程序包，则外部模块是不可调用的。<br> 如果一个模块想要使用被另一个模块导出的package包中的类，可以用<strong>requires</strong>关键字在其module-info.java文件中来导入（读取）目标模块的package包。</p> 
<pre><code class="prism language-java"> <span class="token keyword">module</span> <span class="token namespace">store<span class="token punctuation">.</span>service</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">requires</span> <span class="token namespace">com<span class="token punctuation">.</span>dingtalk<span class="token punctuation">.</span>store<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>Java9 module 与Maven module 很像，但功能完全不一样，后者是作为依赖构建来方便管理应用代码，而Java Module是在于安全性、访问性控制，通过exports/requires 控制模块内需要暴露和依赖的具体包。</p> 
<h3><a id="_1100"></a>接口支持定义私有方法</h3> 
<p>在 Java 8 中增加了默认方法，在 Java 9 中又增加了私有方法，这时开始接口中不仅仅有了定义，还具有了行为。我想这是出于代码构造上的考虑，如果没有私有方法，那么当多个默认方法的行为一样时，就要写多个相同的代码。而有了私有方法，事情就变得不一样了。<br> 举个例子：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Jdk9Interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ChinaPeople</span> chinaPeople <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChinaPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chinaPeople<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chinaPeople<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chinaPeople<span class="token punctuation">.</span><span class="token function">doXxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ChinaPeople</span> <span class="token keyword">implements</span> <span class="token class-name">People</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"躺着睡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">People</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">doXxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"喝水"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>例子中的接口 people 中的 eat() 和 doXxx() 默认行为一致，使用私有方法可以方便的抽取一个方法出来。<br> 输出结果：</p> 
<pre><code class="prism language-java">躺着睡
喝水
喝水
</code></pre> 
<h3><a id="_1144"></a>集合工厂方法</h3> 
<p>在 Java 9 中为集合的创建增加了静态工厂创建方式，也就是 of 方法，通过静态工厂 of 方法创建的集合是<strong>只读集合</strong>，里面的对象<strong>不可改变</strong>。并且<strong>不能存在 null 值</strong>，对于 set 和 map 集合，也<strong>不能存在 key 值重复</strong>。这样不仅<strong>线程安全</strong>，而且<strong>消耗的内存也更小</strong>。</p> 
<pre><code class="prism language-java"><span class="token comment">// 工厂方法创建集合</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringList <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringSet <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stringIntegerMap <span class="token operator">=</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stringIntegerMap2 <span class="token operator">=</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">ofEntries</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 集合输出</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringIntegerMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringIntegerMap2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">]</span>
<span class="token punctuation">[</span>d<span class="token punctuation">,</span> a<span class="token punctuation">,</span> c<span class="token punctuation">,</span> b<span class="token punctuation">]</span>
<span class="token punctuation">{<!-- --></span>key2<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> key1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> key3<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span>key2<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> key1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span>
</code></pre> 
<p>这种只读集合在 Java 9 之前创建是通过 Collections.unmodifiableList 修改集合操作权限实现的。</p> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"CSDN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"阿提说说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置为只读集合</span>
arrayList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>arrayList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>静态工厂 of 方法创建的集合还有一个特性，就是<strong>工厂内部会自由复用已有实例或者创建新的实例</strong>，所以应该避免对 of 创建的集合进行判等或者 haseCode 比较等操作。</p> 
<pre><code class="prism language-java"><span class="token comment">// 工厂可以自由创建新的实例或者复用现有实例，所以 使用 of 创建的集合，避免 == 或者 hashCode 判断操作</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringList <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringList2 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringList<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringList2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出结果</span>
<span class="token comment">// 3910595</span>
<span class="token comment">// 3910595</span>
</code></pre> 
<h3><a id="StreamAPI_1186"></a>增强流（Stream）API</h3> 
<p>Stream 流操作自从 Java 8 引入以来，一直广受好评。<br> 当然，学习 Stream 之前要先学习 Lambda ，也是Java 8的内容。<br> 在 Java 9 中，又对 Stream 进行了增强，主要增加了 4 个新的操作方法：dropWhile，takeWhile，ofNullable，iterate。<br> 1、takeWhile: 从头开始<strong>筛选</strong>，遇到不满足的就结束</p> 
<pre><code class="prism language-java"><span class="token comment">// takeWhile ,从头开始筛选，遇到不满足的就结束了</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listResult <span class="token operator">=</span> list1<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">takeWhile</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>listResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// takeWhile ,从头开始筛选，遇到不满足的就结束</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listResult2 <span class="token operator">=</span> list2<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">takeWhile</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>listResult2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
输出结果：
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
</code></pre> 
<p>2、dropWhile: 从头开始<strong>删除</strong>，遇到不满足的就结束</p> 
<pre><code class="prism language-java"><span class="token comment">// dropWhile ,从头开始删除，遇到不满足的就结束</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listResult <span class="token operator">=</span> list1<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dropWhile</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>listResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// dropWhile ,从头开始删除，遇到不满足的就结束</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listResult2 <span class="token operator">=</span> list2<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dropWhile</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>listResult2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
输出结果：
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<p>3、ofNullable: 创建支持全 null 的 Stream</p> 
<pre><code class="prism language-java"><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 空指针异常</span>
<span class="token comment">// stream = Stream.of(null);</span>
stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
输出结果：
<span class="token number">12</span>null
</code></pre> 
<p>4、iterate: 可以重载迭代器。</p> 
<pre><code class="prism language-java"><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
输出结果：
<span class="token number">0123456789</span>
</code></pre> 
<p>在 Stream 增强之外，还增强了 Optional ，Optional 增加了可以转换成 Stream 的方法。</p> 
<pre><code class="prism language-java"><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="HTTP__2_Client_1252"></a>HTTP / 2 Client</h3> 
<p>Java 9 内置了新的 HTTP/2 客户端，请求更加方便。<br> 随便访问一个不存在的网页。</p> 
<pre><code class="prism language-java"><span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">URI</span> uri <span class="token operator">=</span> URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HttpRequest</span> req <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HttpResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resp <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandler</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> body <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出得到的结果，这里是这个网站的报错信息。</p> 
<pre><code class="prism language-java"><span class="token class-name">There</span> is no method xxxAction in <span class="token class-name">ApiController</span>
</code></pre> 
<h3><a id="Java_REPL__JShell_1267"></a>Java REPL - JShell</h3> 
<p>交互式的编程环境在其他语言如 Python 上早就有了，而 Java 上的交互式语言只到 Java 9 才出现。交互式的编程可以让开发者在输入代码的时候就获取到程序的运行结果，而不用像之前一样新建文件、创建类、导包、测试一系列流程。<br> JShell 中支持 tab 补全代码以及自动添加分号，下面通过一个例子演示 JShell 的使用。<br> 1、进入 JShell. 查看帮助文档</p> 
<pre><code class="prism language-java"><span class="token class-name">C</span><span class="token operator">:</span>\<span class="token class-name">Users</span><span class="token operator">&gt;</span>jshell
<span class="token operator">|</span>  欢迎使用 <span class="token class-name">JShell</span> <span class="token operator">--</span> 版本 <span class="token number">9</span>
<span class="token operator">|</span>  要大致了解该版本<span class="token punctuation">,</span> 请键入<span class="token operator">:</span> <span class="token operator">/</span>help intro
jshell<span class="token operator">&gt;</span> <span class="token operator">/</span>help
<span class="token operator">|</span>  键入 <span class="token class-name">Java</span> 语言表达式<span class="token punctuation">,</span> 语句或声明。
<span class="token operator">|</span>  或者键入以下命令之一<span class="token operator">:</span>
<span class="token operator">|</span>  <span class="token operator">/</span>list <span class="token punctuation">[</span><span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">-</span>all<span class="token operator">|</span><span class="token operator">-</span>start<span class="token punctuation">]</span>
<span class="token operator">|</span>       列出您键入的源
<span class="token operator">|</span>  <span class="token operator">/</span>edit <span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span>
<span class="token operator">|</span>       编辑按名称或 id 引用的源条目
<span class="token operator">|</span>  <span class="token operator">/</span>drop <span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span>
<span class="token operator">|</span>       删除按名称或 id 引用的源条目
<span class="token operator">|</span>  <span class="token operator">/</span>save <span class="token punctuation">[</span><span class="token operator">-</span>all<span class="token operator">|</span><span class="token operator">-</span>history<span class="token operator">|</span><span class="token operator">-</span>start<span class="token punctuation">]</span> <span class="token operator">&lt;</span>文件<span class="token operator">&gt;</span>
<span class="token operator">|</span>       将片段源保存到文件。
<span class="token operator">|</span>  <span class="token operator">/</span><span class="token keyword">open</span> <span class="token generics"><span class="token punctuation">&lt;</span>file<span class="token punctuation">&gt;</span></span>
<span class="token operator">|</span>       打开文件作为源输入
<span class="token operator">|</span>  <span class="token operator">/</span>vars <span class="token punctuation">[</span><span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">-</span>all<span class="token operator">|</span><span class="token operator">-</span>start<span class="token punctuation">]</span>
<span class="token operator">|</span>       列出已声明变量及其值
<span class="token operator">|</span>  <span class="token operator">/</span>methods <span class="token punctuation">[</span><span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">-</span>all<span class="token operator">|</span><span class="token operator">-</span>start<span class="token punctuation">]</span>
<span class="token operator">|</span>       列出已声明方法及其签名
<span class="token operator">|</span>  <span class="token operator">/</span>types <span class="token punctuation">[</span><span class="token operator">&lt;</span>名称或 id<span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">-</span>all<span class="token operator">|</span><span class="token operator">-</span>start<span class="token punctuation">]</span>
<span class="token operator">|</span>       列出已声明的类型
<span class="token operator">|</span>  <span class="token operator">/</span>imports
<span class="token operator">|</span>       列出导入的项
<span class="token operator">|</span>  <span class="token operator">/</span>exit
<span class="token operator">|</span>       退出 jshell
<span class="token operator">|</span>  <span class="token operator">/</span>env <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>add<span class="token operator">-</span>modules <span class="token operator">&lt;</span>模块<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span>       查看或更改评估上下文
<span class="token operator">|</span>  <span class="token operator">/</span>reset <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>add<span class="token operator">-</span>modules <span class="token operator">&lt;</span>模块<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span>       重启 jshell
<span class="token operator">|</span>  <span class="token operator">/</span>reload <span class="token punctuation">[</span><span class="token operator">-</span>restore<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>quiet<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>path <span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span>       重置和重放相关历史记录 <span class="token operator">--</span> 当前历史记录或上一个历史记录 <span class="token punctuation">(</span><span class="token operator">-</span>restore<span class="token punctuation">)</span>
<span class="token operator">|</span>  <span class="token operator">/</span>history
<span class="token operator">|</span>       您键入的内容的历史记录
<span class="token operator">|</span>  <span class="token operator">/</span>help <span class="token punctuation">[</span><span class="token generics"><span class="token punctuation">&lt;</span>command<span class="token punctuation">&gt;</span></span><span class="token operator">|</span><span class="token generics"><span class="token punctuation">&lt;</span>subject<span class="token punctuation">&gt;</span></span><span class="token punctuation">]</span>
<span class="token operator">|</span>       获取 jshell 的相关信息
<span class="token operator">|</span>  <span class="token operator">/</span>set editor<span class="token operator">|</span>start<span class="token operator">|</span>feedback<span class="token operator">|</span>mode<span class="token operator">|</span>prompt<span class="token operator">|</span>truncation<span class="token operator">|</span>format <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span>       设置 jshell 配置信息
<span class="token operator">|</span>  <span class="token operator">/</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token generics"><span class="token punctuation">&lt;</span>command<span class="token punctuation">&gt;</span></span><span class="token operator">|</span><span class="token generics"><span class="token punctuation">&lt;</span>subject<span class="token punctuation">&gt;</span></span><span class="token punctuation">]</span>
<span class="token operator">|</span>       获取 jshell 的相关信息
<span class="token operator">|</span>  <span class="token operator">/</span><span class="token operator">!</span>
<span class="token operator">|</span>       重新运行上一个片段
<span class="token operator">|</span>  <span class="token operator">/</span><span class="token generics"><span class="token punctuation">&lt;</span>id<span class="token punctuation">&gt;</span></span>
<span class="token operator">|</span>       按 id 重新运行片段
<span class="token operator">|</span>  <span class="token operator">/</span><span class="token operator">-</span><span class="token generics"><span class="token punctuation">&lt;</span>n<span class="token punctuation">&gt;</span></span>
<span class="token operator">|</span>       重新运行前面的第 n 个片段
<span class="token operator">|</span>
<span class="token operator">|</span>  有关详细信息<span class="token punctuation">,</span> 请键入 <span class="token char">'/help'</span><span class="token punctuation">,</span> 后跟
<span class="token operator">|</span>  命令或主题的名称。
<span class="token operator">|</span>  例如 '<span class="token operator">/</span>help <span class="token operator">/</span>list<span class="token char">' 或 '</span><span class="token operator">/</span>help intro'。主题<span class="token operator">:</span>
<span class="token operator">|</span>
<span class="token operator">|</span>  intro
<span class="token operator">|</span>       jshell 工具的简介
<span class="token operator">|</span>  shortcuts
<span class="token operator">|</span>       片段和命令输入提示<span class="token punctuation">,</span> 信息访问以及
<span class="token operator">|</span>       自动代码生成的按键说明
<span class="token operator">|</span>  context
<span class="token operator">|</span>       <span class="token operator">/</span>env <span class="token operator">/</span>reload 和 <span class="token operator">/</span>reset 的评估上下文选项

jshell<span class="token operator">&gt;</span>
</code></pre> 
<p>2、定义一个变量：a = 10，遍历从 0 到 a 的数字</p> 
<pre><code class="prism language-java">jshell<span class="token operator">&gt;</span> <span class="token keyword">int</span> a <span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
a <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token number">10</span>
jshell<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>a<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token number">6</span>
<span class="token number">7</span>
<span class="token number">8</span>
<span class="token number">9</span>
</code></pre> 
<p>3、定义一个集合，赋值 1,2,3,4,5。然后输出集合</p> 
<pre><code class="prism language-java">jshell<span class="token operator">&gt;</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
jshell<span class="token operator">&gt;</span> list
list <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre> 
<p>4、查看输入过的代码</p> 
<pre><code class="prism language-java">jshell<span class="token operator">&gt;</span> <span class="token operator">/</span>list
   <span class="token number">1</span> <span class="token operator">:</span> <span class="token keyword">int</span> a <span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
   <span class="token number">2</span> <span class="token operator">:</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>a<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
   <span class="token number">3</span> <span class="token operator">:</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token number">4</span> <span class="token operator">:</span> list
</code></pre> 
<p>5、列出导入的包</p> 
<pre><code class="prism language-java">jshell<span class="token operator">&gt;</span> <span class="token operator">/</span>imports
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token operator">*</span>
<span class="token operator">|</span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span>
</code></pre> 
<p>6、将代码保存到文件并退出</p> 
<pre><code class="prism language-java">jshell<span class="token operator">&gt;</span> <span class="token operator">/</span>save d<span class="token operator">:</span><span class="token operator">/</span><span class="token class-name">JShell</span><span class="token punctuation">.</span>java
jshell<span class="token operator">&gt;</span> <span class="token operator">/</span>exit
  再见
</code></pre> 
<p>在 D 盘看到的保存的代码片段。</p> 
<h3><a id="JVM__1385"></a>JVM 调优的新特性</h3> 
<p>第一个：删除 JDK 8 中已弃用的垃圾收集器 (GC) 组合</p> 
<ul><li> <p>这意味着以下 GC 组合不再存在：</p> 
  <ul><li>DefNew + CMS</li><li>ParNew + SerialOld</li><li>增量CMS</li></ul> </li><li> <p>并发标记扫描 (CMS) 的“前台”模式也已被删除。以下命令行标志已被删除：</p> 
  <ul><li>-Xincgc</li><li>-XX:+CMSIncrementalMode</li><li>-XX:+UseCMSCompactAtFullCollection</li><li>-XX:+CMSFullGCsBeforeCompaction</li><li>-XX:+UseCMSCollectionPassing</li></ul> </li><li> <p>命令行标志-XX:+UseParNewGC不再有效。ParNew 只能与 CMS 一起使用，而 CMS 需要 ParNew。因此，该-XX:+UseParNewGC标志已被弃用，并且可能会在未来的版本中被删除。</p> </li></ul> 
<p>第二个：使 G1 成为默认垃圾收集器</p> 
<ul><li>使垃圾优先 (G1) 成为 32 位和 64 位服务器配置上的默认垃圾收集器 (GC)。对于大多数用户来说，使用低暂停收集器（例如 G1）比以前默认的面向吞吐量的收集器（例如 Parallel GC）提供更好的整体体验。</li><li>增强垃圾优先 (G1) 垃圾收集器以自动确定几个重要的内存回收设置。以前必须手动设置这些设置以获得最佳结果。此外，修复了 G1 垃圾收集器的可用性、确定性和性能问题。</li><li>请参阅Java 平台中的 Garbage-First Garbage Collector ，标准版 HotSpot 虚拟机垃圾收集调优指南</li></ul> 
<p>第三个：弃用并发标记扫描 (CMS) 垃圾收集器</p> 
<ul><li>弃用并发标记扫描 (CMS) 垃圾收集器。-XX:+UseConcMarkSweepGC使用该选项在命令行上请求时会发出警告消息。Garbage-First (G1) 垃圾收集器旨在替代 CMS 的大多数用途。</li></ul> 
<h3><a id="_1410"></a>其他更新</h3> 
<p>Java 9 中增加或者优化的功能远不止这些，上面只是列举了常用的一些新特性，更多的新特性如：</p> 
<ul><li>不能使用下划线 _ 作为变量名，因为它是一个关键字。</li><li>Javadoc 支持 HTML5 并且支持搜索功能。</li><li>Nashorn 引擎升级，更好的支持 Javascript.</li><li>String 存储结构变更从 char -&gt; byte</li><li>多Jdk版本共存jar：在同一个Jar包可以包含多个Java版本的class文件，在不同Jdk环境下使用对应该 jdk 版本的 jar。（这对算是用户很友好的功能）</li><li>…</li></ul> 
<p>新特性很多，感兴趣的可以自己了解下。<br> Java 9 全部的新特性，请看官网：[Java 平台，标准版 Oracle JDK 9 中的新增功能](Java 平台，标准版 Oracle JDK 9 中的新增功能)</p> 
<h2><a id="h1_id10Java_10__1423"></a></h2> 
<h2 id="10">Java 10 新特性</h2> 
<p>自从 Java 9 开始，Oracle 调整了 Java 版本的发布策略，不再是之前的 N 年一个大版本，取而代之的是 6 个月一个小版本，三年一个大版本，这样可以让 Java 的最新改变迅速上线，而小版本的维护周期缩短到下个版本发布之前，大版本的维护周期则是 3 年之久。而 10 就是这么一个小版本，因为 Java 的后续版本基本都会包含之前新特性，所以还是把 Java 10 带来的改变单独写一写（不全）。<br> Java 10 全部的新特性，请看官网：JDK 10 发行说明<br> Java各个版本的文档入口：Java平台，标准版文档<br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="_1428"></a>基于时间的版本号</h3> 
<p>就像上面说的，Java 调整了发布策略，为了适应这种发布节奏，随着改变的还有 Java 版本号的记录方式。<br> 版本号的新模式是：<strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          F 
         
        
          E 
         
        
          A 
         
        
          T 
         
        
          U 
         
        
          R 
         
        
          E 
         
        
          . 
         
        
       
         FEATURE. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">FE</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mord mathnormal" style="margin-right: 0.0576em;">RE</span><span class="mord">.</span></span></span></span></span>INTERIM.<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          U 
         
        
          P 
         
        
          D 
         
        
          A 
         
        
          T 
         
        
          E 
         
        
          . 
         
        
       
         UPDATE. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right: 0.0576em;">TE</span><span class="mord">.</span></span></span></span></span>PATCH</strong></p> 
<ul><li>$FEATURE ：基于发布版本，如 Java 10 的 10 。</li><li>$INTERIM ：问题修复和功能增强时 + 1，默认是 0 。</li><li>$UPDATE ：在进行兼容更新，修复新功能安全问题时 +1。</li><li>$PATCH ：特殊问题修复时 +1。</li></ul> 
<p>查看自己的 Java 10 版本。</p> 
<pre><code class="prism language-java">$ java <span class="token operator">-</span>version
java version <span class="token string">"10.0.1"</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">17</span>
<span class="token class-name">Java</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE <span class="token class-name">Runtime</span> <span class="token class-name">Environment</span> <span class="token number">18.3</span> <span class="token punctuation">(</span>build <span class="token number">10.0</span><span class="token number">.1</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token class-name">Java</span> <span class="token class-name">HotSpot</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span><span class="token class-name">Bit</span> <span class="token class-name">Server</span> VM <span class="token number">18.3</span> <span class="token punctuation">(</span>build <span class="token number">10.0</span><span class="token number">.1</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> mixed mode<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_1444"></a>局部类型推断</h3> 
<p>JEP 286 提案让 Java 增加了局部类型推断（Local-Variable Type Inference）功能，这让 Java 可以像 Js 里的 var 或者其他语言的 auto 一样可以自动推断数据类型。这其实只是一个新的语法糖，底层并没有变化，在编译时就已经把 var 转化成具体的数据类型了，但是这样可以减少代码的编写。<br> 你可以像下面这样使用 var 语法。</p> 
<pre><code class="prism language-java"><span class="token keyword">var</span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"CSDN"</span><span class="token punctuation">,</span><span class="token string">"阿提说说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> string <span class="token operator">=</span> <span class="token string">"hello java 10"</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果你反编译编译后的这段代码，你会发现还是熟悉的代码片段。</p> 
<pre><code class="prism language-java"><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"微信"</span><span class="token punctuation">,</span> <span class="token string">"wlw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token string">"hello java 10"</span><span class="token punctuation">;</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>var 看似好用，其实也有很多限制，官方介绍了 var 只能用于下面的几种情况。</p> 
<ol><li>仅限带有初始化的程序的局部变量。</li><li>for 循环或者增强for 循环中。</li><li>for 循环中的声明。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 情况1，没有初始化会报错</span>
    <span class="token comment">// var list;</span>
    <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// 情况2</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> integer <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// 情况3</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>尽管对 var 的使用场景增加了很多限制，但在实际使用时你还是要注意，就像下面的代码，你可能一眼并不能看出 result 的数据类型。</p> 
<pre><code class="prism language-java"><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token string">"xxx"</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> dbUtil<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_Java__JIT__1489"></a>基于 Java 的 JIT 编译器（实验性）</h3> 
<p>这个功能让基于 Java 开发的 JIT 编译器 **Graal **结合 Java 10 用在 Linux /x64 平台上，这是一个实验性的 JIT 编译器，有人说这也是 Java 10 中最具有未来感的引入。Graal 其实在 Java 9 中就已经引入了，它带来了 Java 中的 AOT （Ahead Of Time）编译，还支持多种语言，如 Js、Python、Ruby、R、以及其他基于 JVM （如 Java、Kotlin）的和基于 LLVM （如 C、C++）的语言。<br> 想切换到 Graal 可以使用下面的 jvm 参数。</p> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UnlockExperimentalVMOptions</span> <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseJVMCICompiler</span>
</code></pre> 
<p>这里面有一点我觉得很有意思，看这个图。<br> <img src="https://images2.imgbox.com/ea/bf/8Qtpfxhr_o.png" alt="image.png"><br> 这就很有意思了，Graal 是 Java 语言编写的，用 Java 编写的编译器，然后用来将 Java 字节码编译机器代码。<br> Graal 官网：<a href="https://www.graalvm.org/" rel="nofollow">https://www.graalvm.org/(opens new window)</a></p> 
<h3><a id="_1499"></a>类数据共享</h3> 
<p>JVM 启动时有一步是需要在内存中加载类，而如果有多个 jar，加载第一个 jar 的速度是最慢的。这就延长了程序的启动时间，为了减少这个时间，Java 10 引入了应用程序类数据共享（CDS）机制，它可以把你想共享的类共享在程序之间，使不同的 Java 进程之间共享这个类来减少这个类占用的空间以及加载速度。</p> 
<h3><a id="G1GC_1501"></a>G1并行全GC</h3> 
<p>早在 Java 9 时就已经引入了 G1 垃圾收集器，G1 的优点很多。而在 Java 10 中还是做了小小调整，当 G1 的并发收集线程不能快速的完成全 GC 时，就会自动切换到<strong>并行</strong>收集，这可以减少在最坏情况下的 GC 速度。</p> 
<h3><a id="Unicode__1503"></a>Unicode 语言标签扩展</h3> 
<p>这个提案让 JDK 实现了最新的 <a href="http://www.unicode.org/reports/tr35/tr35.html#Locale_Extension_Key_and_Type_Data" rel="nofollow">LDML 规范 (opens new window)</a>中指定的更多的扩展。<br> 主要增加了下面几个扩展方法。</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token punctuation">.</span></span>WeekFields</span><span class="token operator">::</span><span class="token function">of</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Calendar</span><span class="token operator">::</span><span class="token punctuation">{<!-- --></span>getFirstDayOfWeek<span class="token punctuation">,</span>getMinimalDaysInWeek<span class="token punctuation">}</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Currency</span><span class="token operator">::</span><span class="token function">getInstance</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Locale</span><span class="token operator">::</span><span class="token function">getDisplayName</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span>LocaleNameProvider</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DateFormat</span><span class="token operator">::</span><span class="token function">get</span><span class="token operator">*</span><span class="token class-name">Instance</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DateFormatSymbols</span><span class="token operator">::</span><span class="token function">getInstance</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DecimalFormatSymbols</span><span class="token operator">::</span><span class="token function">getInstance</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>NumberFormat</span><span class="token operator">::</span><span class="token function">get</span><span class="token operator">*</span><span class="token class-name">Instance</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span>DateTimeFormatter</span><span class="token operator">::</span><span class="token function">localizedBy</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span>DateTimeFormatterBuilder</span><span class="token operator">::</span><span class="token function">getLocalizedDateTimePattern</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span>DecimalStyle</span><span class="token operator">::</span><span class="token function">of</span>
</code></pre> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token class-name">Currency</span> chinaCurrency <span class="token operator">=</span> <span class="token class-name">Currency</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>CHINA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Currency</span> usCurrency <span class="token operator">=</span> <span class="token class-name">Currency</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本地货币："</span> <span class="token operator">+</span> chinaCurrency<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"US.货币："</span> <span class="token operator">+</span> usCurrency<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> displayName <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> displayLanguage <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> displayCountry <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本地名称："</span> <span class="token operator">+</span> displayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本地语言："</span> <span class="token operator">+</span> displayLanguage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本地国家："</span> <span class="token operator">+</span> displayCountry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> firstDayOfWeek <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本地每周第一天："</span> <span class="token operator">+</span> firstDayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-java">本地货币：CNY
US<span class="token punctuation">.</span>货币：USD
本地名称：中文 <span class="token punctuation">(</span>中国<span class="token punctuation">)</span>
本地语言：中文
本地国家：中国
本地每周第一天：<span class="token number">1</span>
</code></pre> 
<h3><a id="API_1545"></a>API更新</h3> 
<p>Java 10 删除了部分 API，也增加了一些实用方法。比如可以通过 Collection.copyOf 复制得到一个不可改变集合，即使原来的集合元素发生了变化也不会有影响。</p> 
<pre><code class="prism language-java"><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"wechat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"wlw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> copyList <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>copyList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// result</span>
<span class="token comment">// [wechat, wn8398]</span>
</code></pre> 
<p>也为 Optional 增加了一个新的方法 orElseThrow。调用这个方法也可以获取到 optional 中的 value , 但是如果 value 为 null ，就会抛出异常。<br> 另外在 Stream 最后收集数据的时候，Collectors 可以直接指定收集的集合为不可变集合，像下面这样。</p> 
<pre><code class="prism language-java">list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toUnmodifiableList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toUnmodifiableSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_1563"></a>其他更新</h3> 
<p>Java 10 的更新内容不止这些，上面只是列举了常用的以及比较有意思的新特性。还有部分更新如：<br> 1、JEP 312：Thread-Local Handshakes，JVM 内部功能，可以提高 JVM 性能。<br> 2、JEP 313：删除了 javah 工具，说是删除，其实功能已经包含在 Java 8 中的 javac 里。<br> 3、JEP 316：让 JVM 可以在备用的存储设备（如 NV-DIMM）上分配堆内存，而不用更改程序代码。<br> 4、JEP 319：在 JDK 中提供一组默认的根证书颁发机构（CA）证书。</p> 
<p>Java 10 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/10-relnote-issues.html" rel="nofollow">JDK 10 发行说明</a></p> 
<h2><a id="h1_id11Java_11__1571"></a></h2> 
<h2 id="11">Java 11 新特性</h2> 
<p>Java 11 是 Java 8 之后的第一个 LTS 版本，但是也自从 Java 11 开始， Oracle JDK 不再可以免费的用于商业用途，当然如果你是个人使用，或者是使用 Open JDK ，那么还是可以免费使用的。</p> 
<p>Java 11 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/11-relnote-issues.html#NewFeature" rel="nofollow">JDK 11 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="String_API_1577"></a>String API改动</h3> 
<p>字符串绝对是 Java 中最常用的一个类了，String 类的方法使用率也都非常的高，在 Java 11 中又为 String 类带来了一系列的好用操作。</p> 
<ol><li>isBlank()判空</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// 判空，blank里我放入了全角空格，半角空格，TAB</span>
<span class="token class-name">String</span> blank <span class="token operator">=</span> <span class="token string">"　　  "</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blank<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出</span>
<span class="token comment">// true</span>
</code></pre> 
<ol start="2"><li>lines()分割获取字符串流</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// lines 返回一个 Stream</span>
<span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token string">"a\nb\nc"</span><span class="token punctuation">;</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 lambda 遍历</span>
lines<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>
<span class="token comment">// c</span>
</code></pre> 
<ol start="3"><li>repeat()复制字符串</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// 复制字符串</span>
<span class="token class-name">String</span> repeat <span class="token operator">=</span> <span class="token string">"CSDN/WX-阿提说说"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> repeat3 <span class="token operator">=</span> repeat<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>repeat3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出</span>
<span class="token comment">// CSDN/WX-阿提说说CSDN/WX-阿提说说CSDN/WX-阿提说说</span>
</code></pre> 
<ol start="4"><li>strip()去除前后空白字符</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// 去除前后空白</span>
<span class="token class-name">String</span> strip <span class="token operator">=</span> <span class="token string">"   　 https://www.baidu.com 　"</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=="</span> <span class="token operator">+</span> strip<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 去除前后空白字符，如全角空格，TAB</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=="</span> <span class="token operator">+</span> strip<span class="token punctuation">.</span><span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 去前面空白字符，如全角空格，TAB</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=="</span> <span class="token operator">+</span> strip<span class="token punctuation">.</span><span class="token function">stripLeading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 去后面空白字符，如全角空格，TAB</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=="</span> <span class="token operator">+</span> strip<span class="token punctuation">.</span><span class="token function">stripTrailing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出</span>
<span class="token comment">// ==　 https://www.baidu.com 　==</span>
<span class="token comment">// ==https://www.baidu.com==</span>
<span class="token comment">// ==https://www.baidu.com 　==</span>
<span class="token comment">// ==   　 https://www.baidu.com==</span>
</code></pre> 
<h3><a id="File_API_1634"></a>File API改动</h3> 
<p>读写文件变得更加方便</p> 
<pre><code class="prism language-java"><span class="token comment">// 创建临时文件</span>
<span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">".txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 读取文件</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 结果</span>
<span class="token comment">//C:\Users\ADMINI~1\AppData\Local\Temp\test10960104919895436673.txt</span>
<span class="token comment">//https://www.baidu.com</span>
</code></pre> 
<h3><a id="HTTP_Client_1649"></a>HTTP Client</h3> 
<p>在 Java 11 中 Http Client API 得到了标准化的支持。且支持 HTTP/1.1 和 HTTP/2 ，也支持 websockets。<br> 你可以像这样发起一个请求:</p> 
<pre><code class="prism language-java"><span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"https://www.hao123.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 异步</span>
client<span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandlers</span><span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token operator">::</span><span class="token function">body</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 同步</span>
<span class="token class-name">HttpResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandlers</span><span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>更多的如同步异步请求，并发访问，设置代理等方式，可以参考 OpenJDK 官方文档：<br> <a href="http://openjdk.java.net/groups/net/httpclient/recipes-incubating.html" rel="nofollow">http://openjdk.java.net/groups/net/httpclient/recipes-incubating.html(opens new window)</a></p> 
<h3><a id="Lambda__1669"></a>Lambda 局部变量推断</h3> 
<p>在 Java 10 中引入了 var 语法，可以自动推断变量类型。在 Java 11 中这个语法糖可以在 Lambda 表达式中使用了。</p> 
<pre><code class="prism language-java"><span class="token keyword">var</span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"CSDN"</span><span class="token punctuation">,</span> <span class="token string">"阿提说说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token string">"https://blog.csdn.net/weixin_40972073"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">var</span> k<span class="token punctuation">,</span> <span class="token keyword">var</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输出</span>
<span class="token comment">//website: https://blog.csdn.net/weixin_40972073</span>
<span class="token comment">//CSDN: 阿提说说</span>
</code></pre> 
<p>这里需要注意的是，(var k,var v) 中，k 和 v 的类型要么都用 var ，要么都不写，要么都写正确的变量类型。而不能 var 和其他变量类型混用。<br> <img src="https://images2.imgbox.com/da/15/OB8DWHHZ_o.png" alt="image.png"></p> 
<h3><a id="Java_1684"></a>单命令运行Java</h3> 
<p>自从学习 Java 的第一天，我们就知道运行一个 Java 文件，要先用 javac 命令编译，再用 java 命令运行，而现在只要一个 java 命令就可以运行了。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CSDN: 阿提说说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//java -Dfile.encoding=UTF-8  MainTest.java</span>
<span class="token comment">//CSDN: 阿提说说</span>
</code></pre> 
<h3><a id="_1696"></a>免费的飞行记录器</h3> 
<p>商业版 JDK 中一直有一款低开销的事件信息收集工具，也就是飞行记录器（Java Flight Recorder），它可以对 JVM 进行检查、分析、记录等。当出现未知异常时可以通过记录进行故障分析。这个好用的工具在 Java 11 中将开源免费。所有人都可以使用这个功能了。</p> 
<h3><a id="_1698"></a>其他更新</h3> 
<ol><li>JEP 309 - 添加动态文件常量。</li><li>JEP 318 - 添加 Epsilon 垃圾收集器。</li><li>JEP 320 - 删除 Java EE 和 corba 模块（java.xml.ws, java.xml.bind, java.activation, java.xml.ws.annotation, java.corba, java.transaction, java.se.ee, jdk.xml.ws, jdk.xml.bind）。</li><li>JEP 329 - 增加加密算法 chacha20,poly1305 的实现。</li><li>JEP 333 - 引入实验性的 ZGC 垃圾收集器，保证停摆时间不会超过 10ms。</li><li>JEP 335 - 废弃 Nashorn JavaScript 引擎</li></ol> 
<p>Java 11 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/11-relnote-issues.html#NewFeature" rel="nofollow">JDK 11 发行说明</a></p> 
<h2><a id="h1_id12Java_12__1708"></a></h2> 
<h2 id="12">Java 12 新特性</h2> 
<p>Java 12 早在 2019 年 3 月 19 日发布，它不是一个长久支持（LTS）版本。此篇文章写一下部分Java 12的新特性。<br> Java 12 全部的新特性，请看官网：JDK 12 发行说明<br> Java各个版本的文档入口：Java平台，标准版文档<br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="Switch___1713"></a>Switch 表达式 改进</h3> 
<p>在 Java 12 中，对 <strong>Switch</strong> 表达式的写法进行了改进，虽然是一个语法糖的改进，也让 <strong>Switch</strong> 的代码编写变得更加优雅。先看一下在 Java 12 之前的 <strong>Switch</strong> 的写法。<br> 由于 Switch 表达式在 Java 12 中并不是一个正式发布的功能，还处于预览测试阶段，所以想要使用 Java 12 去编译运行就需要打开功能预览参数，当然，如果你使用的是 Java 14 以及更高版本，就可以直接跳过这个部分了。</p> 
<pre><code class="prism language-java"># 编译时
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>javac <span class="token operator">--</span>enable<span class="token operator">-</span>preview <span class="token operator">-</span>source <span class="token number">12</span> <span class="token punctuation">.</span>/<span class="token class-name">Xxx</span><span class="token punctuation">.</span>java
# 运行时
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>java <span class="token operator">--</span>enable<span class="token operator">-</span>preview <span class="token class-name">Xxx</span>
</code></pre> 
<p>Java 12以前的switch写法</p> 
<pre><code class="prism language-java"><span class="token comment">// 通过传入月份，输出月份所属的季节</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">switchJava12Before</span><span class="token punctuation">(</span><span class="token class-name">String</span> day<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>day<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"april"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"may"</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"春天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"july"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"august"</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"夏天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"october"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"november"</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"秋天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"january"</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">"february"</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"冬天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Java 12的写法</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">switchJava12</span><span class="token punctuation">(</span><span class="token class-name">String</span> day<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>day<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token punctuation">,</span> <span class="token string">"april"</span><span class="token punctuation">,</span> <span class="token string">"may"</span>            <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"春天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token punctuation">,</span> <span class="token string">"july"</span><span class="token punctuation">,</span> <span class="token string">"august"</span>           <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"夏天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token punctuation">,</span> <span class="token string">"october"</span><span class="token punctuation">,</span> <span class="token string">"november"</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"秋天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token punctuation">,</span> <span class="token string">"january"</span><span class="token punctuation">,</span> <span class="token string">"february"</span>  <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"冬天"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>另外还可使用返回值赋值</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> season <span class="token operator">=</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>day<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token punctuation">,</span> <span class="token string">"april"</span><span class="token punctuation">,</span> <span class="token string">"may"</span>            <span class="token operator">-&gt;</span> <span class="token string">"春天"</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token punctuation">,</span> <span class="token string">"july"</span><span class="token punctuation">,</span> <span class="token string">"august"</span>           <span class="token operator">-&gt;</span> <span class="token string">"夏天"</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token punctuation">,</span> <span class="token string">"october"</span><span class="token punctuation">,</span> <span class="token string">"november"</span> <span class="token operator">-&gt;</span> <span class="token string">"秋天"</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token punctuation">,</span> <span class="token string">"january"</span><span class="token punctuation">,</span> <span class="token string">"february"</span>  <span class="token operator">-&gt;</span> <span class="token string">"冬天"</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//throw new RuntimeException("day error")</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"day error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span> <span class="token string">"day error"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前季节是:"</span> <span class="token operator">+</span> season<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_Filesmismatch_1776"></a>文件对比 Files.mismatch</h3> 
<p>在 Java 中对于文件的操作已经在 Java 11 中进行了一次增强，这次 Java 12 又带来了文件对比功能。<br> 对比两个文件，如果内容一致，会返回 -1 ，如果内容不同，会返回不同的字节开始位置。</p> 
<pre><code class="prism language-java"><span class="token comment">// 创建两个文件</span>
<span class="token class-name">Path</span> pathA <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span> pathB <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createFile</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"b.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写入相同内容</span>
<span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pathA<span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span>WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pathB<span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span>WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> mismatch <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">mismatch</span><span class="token punctuation">(</span>pathA<span class="token punctuation">,</span> pathB<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mismatch<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 追加不同内容</span>
<span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pathA<span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span>APPEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pathB<span class="token punctuation">,</span><span class="token string">"321"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span>APPEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
mismatch <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">mismatch</span><span class="token punctuation">(</span>pathA<span class="token punctuation">,</span> pathB<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mismatch<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 删除创建的文件</span>
pathA<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteOnExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pathB<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteOnExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// RESULT</span>
<span class="token comment">// -1</span>
<span class="token comment">// 3</span>
</code></pre> 
<h3><a id="Compact_Number_1804"></a>Compact Number</h3> 
<p>简化的数字格式可以直接转换数字显示格式，比如 1000 -&gt; 1K，1000000 -&gt; 1M 。</p> 
<pre><code class="prism language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Compact Formatting is:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">NumberFormat</span> upvotes <span class="token operator">=</span> <span class="token class-name">NumberFormat</span><span class="token punctuation">.</span><span class="token function">getCompactNumberInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span><span class="token string">"en"</span><span class="token punctuation">,</span> <span class="token string">"US"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Style</span><span class="token punctuation">.</span>SHORT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置小数位数</span>
upvotes<span class="token punctuation">.</span><span class="token function">setMaximumFractionDigits</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upvotes<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12345678</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token number">100</span>
<span class="token number">1</span>K
<span class="token number">10</span>K
<span class="token number">100</span>K
<span class="token number">1</span>M
<span class="token number">1.2</span>K
<span class="token number">123.5</span>K
<span class="token number">12.3</span>M
</code></pre> 
<h3><a id="JVM__1833"></a>JVM 相关更新</h3> 
<p><strong>Shenandoah 垃圾收集器</strong><br> Java 12 增加了 Shenandoah 一个低停顿的垃圾收集器，它可以和 Java 应用程序中的执行线程同时进行，用来收集垃圾进行内容回收，这样就可以让停顿时间更少。<br> 更多关于 Shenandoah 垃圾收集器的介绍可以查看文档：Shenandoah GC 介绍 (opens new window)。<br> <strong>ZGC 并发类卸载</strong><br> Z 垃圾收集器现在支持类卸载，通过卸载不使用的类来释放这些类相关的数据结构，从而减少应用程序的总体占用空间。因为是并发执行，所以不会停止 Java 应用程序线程的执行，也因此对 GC 的暂停时间影响微乎其微。默认情况下启用此功能，但可以使用命令行选项禁用** -XX:-ClassUnloading**。<br> <strong>JVM 常量 API</strong><br> 在包** java.lang.invoke.constant** 中定义了一系列的基于值的符号引用，可以用来描述各种可加载常量。可以更容易的对关键类文件和运行时构建的名义描述进行建模，特别是对那些从常量池中加载的常量，也让开发者可以更简单标准的处理可加载常量。<br> <strong>默认使用类数据共享（CDS）</strong><br> 这已经不是 JDK 第一次改进 CDS（Class Data Sharing） 功能了，CDS 可以让 JVM 在同一台机器或虚拟机上启动多个应用的速度速度大大增加。原理是在启动应用时共享一些类加载信息，这样启动新进程时就可以使用共享的数据。在 Java 12 之前此功能需要手动开启，Java 12 调整为默认开启。<br> <strong>微基准套件</strong><br> Java 12 中添加一套新的基于 JMH 的基本的微基准测试套件。<br> JMH 的使用，可以参考文章 JMH - Java 代码性能测试的终极利器 (opens new window)。</p> 
<h3><a id="_1846"></a>其他更新</h3> 
<p>在 Java 11 支持了 Unicode 10 之后， Java 12 支持了 Unicode 11，支持操作更多的表情、符号。</p> 
<h2><a id="h1_id13Java_13__1848"></a></h2> 
<h2 id="13">Java 13 新特性</h2> 
<p>Java 13 早在 2019 年 9 月就已经发布，虽然不是长久支持版本，但是也带来了不少新功能。此篇文章写一下部分Java 13的新特性。<br> Java 13 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/13-relnote-issues.html#NewFeature" rel="nofollow">JDK 13 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="Switch___1853"></a>Switch 表达式 (二次预览)</h3> 
<p>在Java 12 中对 Switch 进行了一次增强，这次又对Switch进行了增强。<br> 在 Java 13 中，又对 switch 表达式进行了增强，增加了 yield 关键词用于返回值，相比 break ，语义更加明确了。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">switchJava13</span><span class="token punctuation">(</span><span class="token class-name">String</span> month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token punctuation">,</span> <span class="token string">"april"</span><span class="token punctuation">,</span> <span class="token string">"may"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"春天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token punctuation">,</span> <span class="token string">"july"</span><span class="token punctuation">,</span> <span class="token string">"august"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"夏天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token punctuation">,</span> <span class="token string">"october"</span><span class="token punctuation">,</span> <span class="token string">"november"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"秋天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token punctuation">,</span> <span class="token string">"january"</span><span class="token punctuation">,</span> <span class="token string">"february"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"冬天"</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"month error"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_CDS__1872"></a>动态 CDS 存档</h3> 
<p>JVM 启动时有一步是需要在内存中加载类，而如果有多个 jar，加载第一个 jar 的速度是最慢的。这就延长了程序的启动时间，为了减少这个时间，Java 10 引入了应用程序类数据共享（CDS）机制，它可以把你想共享的类共享在程序之间，使不同的 Java 进程之间共享这个类来减少这个类占用的空间以及加载速度。不过 Java 10 中使用这个功能的步骤比较繁琐。<br> 而 Java 13 中的 AppCDS，允许 Java 应用在程序执行结束时（如果 JVM 没有崩溃）进行动态存档；存储的内容包括所有加载的应用类型类和使用的类库，这些存储的类库本来并不存在于默认的 CDS 存档中。使用这个功能非常简单，只需要在程序启动时增加启动参数 。</p> 
<pre><code class="prism language-java"># <span class="token class-name">ArchiveClassesAtExit</span>，程序结束时动态存档
bin<span class="token operator">/</span>java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">ArchiveClassesAtExit</span><span class="token operator">=</span>hello<span class="token punctuation">.</span>jsa <span class="token operator">-</span>cp hello<span class="token punctuation">.</span>jar <span class="token class-name">Hello</span>
# <span class="token class-name">SharedArchiveFile</span>，使用指定存档启动
bin<span class="token operator">/</span>java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">SharedArchiveFile</span><span class="token operator">=</span>hello<span class="token punctuation">.</span>jsa <span class="token operator">-</span>cp hello<span class="token punctuation">.</span>jar <span class="token class-name">Hello</span>
</code></pre> 
<h3><a id="ZGC__1881"></a>ZGC，归还未使用的内存 (实验性)</h3> 
<p>在 Java 13 之前，ZGC 虽然在清理内存时导致的停顿时间非常少，但是即使内存已经长时间没有使用，ZGC 也不会将内存返还给操作系统，这对那些十分关注内存占用的应用程序非常不友好。<br> 比如：</p> 
<ul><li>资源按使用量付费的云上容器环境。</li><li>应用虽然长时间闲置，但是占用了内存，导致运行的其他程序内存紧张。</li></ul> 
<p>而新增的这个功能，可以让 ZGC 归还长时间没有使用的内存给操作系统，这对某些用户来说十分友好。</p> 
<h3><a id="_Socket_API_1889"></a>重新实现 Socket API</h3> 
<p>java.net.Socket 和 java.net.ServerSocket 类早在 Java 1.0 时就已经引入了，它们的实现的 Java 代码和 C 语言代码的混合，维护和调试都十分不易；而且这个实现还存在并发问题，有时候排查起来也很困难。<br> 因此，在 Java 13 中引入了新的实现方式，使用了新的实现 NioSocketImpl 来代替老旧的 PlainSocketImpl 实现。虽然功能相同，但是老的方式在当前以及未来几个版本内不会删除，用户随时可以通过 -Djdk.net.usePlainSocketImpl 参数切换回老的实现方式，以兼容意外情况。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">boolean</span> running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>running<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Socket</span> clientSocket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//do something with clientSocket</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用 Java 13 运行，通过参数 -XX:+TraceClassLoading 追踪加载的类，日志中可以看到 NioSocketImpl。</p> 
<pre><code class="prism language-java">➜  develop <span class="token punctuation">.</span>/jdk<span class="token operator">-</span><span class="token number">13.0</span><span class="token number">.2</span><span class="token punctuation">.</span>jdk<span class="token operator">/</span><span class="token class-name">Contents</span><span class="token operator">/</span><span class="token class-name">Home</span><span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">TraceClassLoading</span> <span class="token class-name">Test</span><span class="token punctuation">.</span>java <span class="token operator">|</span> grep <span class="token class-name">SocketImpl</span>
<span class="token punctuation">[</span><span class="token number">0.699</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.699</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketImpl</span>$$<span class="token class-name">Lambda</span>$<span class="token number">173</span><span class="token operator">/</span><span class="token number">0x0000000800c37440</span> source<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketImpl</span>
<span class="token punctuation">[</span><span class="token number">0.702</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>PlatformSocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.702</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span></span>NioSocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.713</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span></span>NioSocketImpl</span>$<span class="token class-name">FileDescriptorCloser</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
</code></pre> 
<p>但在 Java 12 并不是 NioSocketImpl</p> 
<pre><code class="prism language-java">➜  develop <span class="token punctuation">.</span>/jdk<span class="token operator">-</span><span class="token number">12.0</span><span class="token number">.2</span><span class="token punctuation">.</span>jdk<span class="token operator">/</span><span class="token class-name">Contents</span><span class="token operator">/</span><span class="token class-name">Home</span><span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">TraceClassLoading</span> <span class="token class-name">Test</span><span class="token punctuation">.</span>java <span class="token operator">|</span> grep <span class="token class-name">SocketImpl</span>
<span class="token punctuation">[</span><span class="token number">0.665</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.665</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>AbstractPlainSocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.665</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>PlainSocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.665</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocksSocketImpl</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
<span class="token punctuation">[</span><span class="token number">0.666</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>info   <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">class</span><span class="token punctuation">,</span>load<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>AbstractPlainSocketImpl</span>$<span class="token number">1</span> source<span class="token operator">:</span> jrt<span class="token operator">:</span><span class="token operator">/</span>java<span class="token punctuation">.</span>base
</code></pre> 
<h3><a id="__1928"></a>文本块 (预览)</h3> 
<p>在这之前，如果我们把一个 JSON 赋值给字符串：</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"{\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"upperSummary\": null,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"sensitiveTypeList\": null,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"gmtModified\": \"2022-08-23 10:50:09\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"lowerGraph\": null,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"signature\": \"\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"appName\": \"xxx\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"lowerSummary\": null,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"gmtCreate\": \"2022-08-23 10:50:09\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"type\": \"CALL\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"name\": \"xxxx\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"subType\": \"yyy\",\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"id\": 1,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"projectId\": 1,\n"</span>
    <span class="token operator">+</span> <span class="token string">"    \"status\": 1\n"</span>
    <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">;</span>
</code></pre> 
<p>终于不用写丑陋的长字符串了，从 Java 13 开始你可以使用文本块的方式定义字符串了。</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> content2 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
        {
        "upperSummary": null,
        "sensitiveTypeList": null,
        "gmtModified": "2022-08-23 10:50:09",
        "lowerGraph": null,
        "signature": "",
        "appName": "xxx",
        "lowerSummary": null,
        "gmtCreate": "2022-08-23 10:50:09",
        "type": "CALL",
        "name": "xxxx",
        "subType": "yyy",
        "id": 1,
        "projectId": 1,
        "status": 1
    }
                 """</span><span class="token punctuation">;</span>
</code></pre> 
<p>不过这是一个预览功能，如果你要是在 Java 13 中使用需要手动开启预览功能，这个功能在 Java 15 中正式发布。</p> 
<h2><a id="h1_id14Java_14__1970"></a></h2> 
<h2 id="14">Java 14 新特性</h2> 
<p>Java 14早在 2019 年 9 月就已经发布，虽然不是长久支持版本，但是也带来了不少新功能。此篇文章写一下部分Java 14的新特性。<br> Java 14全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/14-relnote-issues.html#NewFeature" rel="nofollow">JDK 14 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="instanceof__1975"></a>instanceof 类型判断（预览）</h3> 
<p>在 Java 14 之前，使用 instanceof 进行类型判断之后，需要进行对象类型转换后才能使用。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java14BeaforInstanceof</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">ArrayList</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ArrayList</span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>而在 Java 14 中，可以在判断类型时指定变量名称进行类型转换，方便了使用。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java14Instanceof</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">ArrayList</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在使用 instanceof 判断类型成立后，会自动强制转换类型为指定类型。</p> 
<h3><a id="_2004"></a>打包工具（孵化）</h3> 
<p>在 Java 14 中，引入了打包工具，命令是 jpackage，使用 jpackage 命令可以把 JAR 包打包成不同操作系统支持的软件格式。</p> 
<pre><code class="prism language-java">jpackage <span class="token operator">--</span>name myapp <span class="token operator">--</span>input lib <span class="token operator">--</span>main<span class="token operator">-</span>jar main<span class="token punctuation">.</span>jar <span class="token operator">--</span>main<span class="token operator">-</span><span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">myapp<span class="token punctuation">.</span></span>Main</span>
</code></pre> 
<p>常见平台格式如下：</p> 
<ol><li>Linux: deb and rpm</li><li>macOS: pkg and dmg</li><li>Windows: msi and exe</li></ol> 
<p>要注意的是，jpackage 不支持交叉编译，也就是说在 windows 平台上是不能打包成 macOS 或者 Linux 系统的软件格式的。</p> 
<h3><a id="G1__NUMA_2016"></a>G1 支持 NUMA（非统一内存访问）</h3> 
<p>G1 收集器现在可以感知 NUMA 内存分配方式，以提高 G1 的性能，可以使用 +XX:+UseNUMA 启用这项功能。<br> 更多阅读文档：<a href="https://openjdk.java.net/jeps/345" rel="nofollow">https://openjdk.java.net/jeps/345</a></p> 
<h3><a id="_NullPointerExceptions_2019"></a>更有用的 NullPointerExceptions</h3> 
<p>NullPointerException 一直都是一个比较常见的异常，但是在 Java 14 之前，如果一行有多个表达式时，这时报了空指针后，单纯的从报错信息来看，可能并不知道是哪个对象为 NULL 。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java14NullPointerExceptions</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> content1 <span class="token operator">=</span> <span class="token string">"www.baidu.com"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> content2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> content1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> content2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 Java 14 之前，从下面的报错中我们只能得到错误出现的行数，但是并不能确定是 conteng1 还是 content2 为 null。</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">other<span class="token punctuation">.</span></span>Other</span><span class="token punctuation">.</span><span class="token function">java14NullPointerExceptions</span><span class="token punctuation">(</span><span class="token class-name">Other</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">88</span><span class="token punctuation">)</span>
</code></pre> 
<p>但是在 Java 14 中，会清晰的告诉你 because “content2” is null 。</p> 
<h3><a id="Records__2038"></a>Records (预览)</h3> 
<p>record 是一种全新的类型，它本质上是一个 final 类，同时所有的属性都是 final 修饰，它会自动编译出 public get hashcode 、equals、toString 等方法，减少了代码编写量。<br> 示例：编写一个 Dog record 类，定义 name 和 age 属性。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用</p> 
<pre><code class="prism language-java"><span class="token class-name">Dog</span> dog1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"牧羊犬"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> dog2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"田园犬"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> dog3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"哈士奇"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token class-name">Dog</span><span class="token punctuation">[</span>name<span class="token operator">=</span>牧羊犬<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token class-name">Dog</span><span class="token punctuation">[</span>name<span class="token operator">=</span>田园犬<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token class-name">Dog</span><span class="token punctuation">[</span>name<span class="token operator">=</span>哈士奇<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre> 
<p>这个功能在 Java 15 中进行二次预览，在 Java 16 中正式发布。</p> 
<h3><a id="Switch___2061"></a>Switch 表达式 (标准)</h3> 
<p>Switch 表达式改进从 Java 12 就已经开始了，Java 12 让 switch 支持了 case L-&gt; 语法，Java 13 引入了 yield 关键词用于返回结果，但是在 Java 12 和 13 中功能都是预览版的，而在 Java 14 中，正式转正。</p> 
<pre><code class="prism language-java"><span class="token comment">// 通过传入月份，输出月份所属的季节</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">switchJava12</span><span class="token punctuation">(</span><span class="token class-name">String</span> month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token punctuation">,</span> <span class="token string">"april"</span><span class="token punctuation">,</span> <span class="token string">"may"</span>            <span class="token operator">-&gt;</span> <span class="token string">"春天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token punctuation">,</span> <span class="token string">"july"</span><span class="token punctuation">,</span> <span class="token string">"august"</span>           <span class="token operator">-&gt;</span> <span class="token string">"夏天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token punctuation">,</span> <span class="token string">"october"</span><span class="token punctuation">,</span> <span class="token string">"november"</span> <span class="token operator">-&gt;</span> <span class="token string">"秋天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token punctuation">,</span> <span class="token string">"january"</span><span class="token punctuation">,</span> <span class="token string">"february"</span>  <span class="token operator">-&gt;</span> <span class="token string">"冬天"</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token string">"month erro"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 通过传入月份，输出月份所属的季节</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">switchJava13</span><span class="token punctuation">(</span><span class="token class-name">String</span> month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"march"</span><span class="token punctuation">,</span> <span class="token string">"april"</span><span class="token punctuation">,</span> <span class="token string">"may"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"春天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"june"</span><span class="token punctuation">,</span> <span class="token string">"july"</span><span class="token punctuation">,</span> <span class="token string">"august"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"夏天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"september"</span><span class="token punctuation">,</span> <span class="token string">"october"</span><span class="token punctuation">,</span> <span class="token string">"november"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"秋天"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"december"</span><span class="token punctuation">,</span> <span class="token string">"january"</span><span class="token punctuation">,</span> <span class="token string">"february"</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"冬天"</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token string">"month error"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_2090"></a>文本块（二次预览）</h3> 
<p>文本块是 Java 13 引入的语法，在 Java 14 中对其进行了增强。文本块依旧是预览功能，这次更新增加了两个转义符。</p> 
<ol><li>\ 结尾不换行</li><li>\s 表示一个空格</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">""</span>"
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">"upperSummary"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\
            <span class="token string">"sensitiveTypeList"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">"gmtModified"</span><span class="token operator">:</span> <span class="token string">"2022-08-23\s10:50:09"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
         <span class="token string">""</span>"<span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"upperSummary"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token string">"sensitiveTypeList"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">"gmtModified"</span><span class="token operator">:</span> <span class="token string">"2022-08-23 10:50:09"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>文本块功能在 Java 15 中正式发布。</p> 
<h3><a id="_2114"></a>其他更新</h3> 
<ol><li>JEP 362：废弃对 Solaris 和 SPARC 端口支持从 Java 14 开始，放弃对 Solaris/SPARC, Solaris/x64, 和 Linux/SPARC 端口的支持，放弃一部分开发这势必会加快 Java 整体的开发节奏。</li></ol> 
<blockquote> 
 <p>相关阅读：<a href="https://openjdk.java.net/jeps/362" rel="nofollow">https://openjdk.java.net/jeps/362</a></p> 
</blockquote> 
<ol start="2"><li>JEP 363： 移除 CMS 垃圾收集器</li></ol> 
<p>移除对 CMS（Concurrent Mark Sweep） 垃圾收集器的支持，其实早在 Java 9 就开始移除 CMS 垃圾收集器了，只不过在 Java 14 中被正式删除。</p> 
<ol start="3"><li>JEP 364：macOS 上的 ZGC（实验性）</li></ol> 
<p>Java 11 在 Linux 上引入了 Z 垃圾收集器 (ZGC)，现在它可以移植到 macOS。</p> 
<ol start="4"><li>JEP 365：Windows 上的 ZGC（实验性）</li></ol> 
<p>Java 11 在 Linux 上引入了 Z 垃圾收集器 (ZGC)，现在它可以移植到 Windows 上（版本大于 1803）。</p> 
<ol start="5"><li>JEP 366：弃用 ParallelScavenge + SerialOld GC 组合</li></ol> 
<p>由于使用场景不多，维护工作太大，废弃之。相关阅读：<a href="https://openjdk.java.net/jeps/366" rel="nofollow">https://openjdk.java.net/jeps/366</a></p> 
<ol start="6"><li>JEP 367：删除 Pack200 工具和 API</li></ol> 
<h2><a id="h1_id15Java_15__2138"></a></h2> 
<h2 id="15">Java 15 新特性</h2> 
<p>Java 15 在 2020 年 9 月发布。<br> Java 15 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/15-relnote-issues.html#NewFeature" rel="nofollow">JDK 15 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="EdDSA_2143"></a>爱德华曲线算法（EdDSA）</h3> 
<p>Java 15 中增加了一个新的密码学算法，爱德华曲线算法（EdDSA）签名算法。它是由 Schnorr 算法发展而来，在 RFC8032 中被定义实现。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyPair</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyPairGenerator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">Signature</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">SignatureException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> JEP339 <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span><span class="token punctuation">,</span> <span class="token class-name">SignatureException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">KeyPairGenerator</span> kpg <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"Ed25519"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyPair</span> kp <span class="token operator">=</span> kpg<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> msg <span class="token operator">=</span> <span class="token string">"www.baidu.com"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Signature</span> sig <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"Ed25519"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sig<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>kp<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sig<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> sig<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果</p> 
<pre><code class="prism language-java"><span class="token class-name">VXlpxapU</span><span class="token operator">+</span><span class="token class-name">LSWjVQ0QNJvdpUh6VI6PjSwOQ2pHu65bCfnLR13OyWKunlc9rc</span><span class="token operator">+</span><span class="token number">7</span>SMxCh2Mnqf7TmC<span class="token operator">/</span>iOG8oimbAw<span class="token operator">==</span>
</code></pre> 
<h3><a id="Sealed_Classes_2173"></a>Sealed Classes（密封类）预览</h3> 
<p>在 Java 中如果想让一个类不能被继承和修改，这时我们应该使用 final 关键字对类进行修饰。不过这种要么可以继承，要么不能继承的机制不够灵活，有些时候我们可能想让某个类可以被某些类型继承，但是又不能随意继承，是做不到的。Java 15 尝试解决这个问题，引入了 **sealed <strong>类，被 sealed 修饰的类可以指定子类。这样这个类就只能被指定的类继承。<br> 而且 <strong>sealed <strong>修饰的类的机制具有传递性，它的</strong>子类</strong>必须使用指定的关键字进行修饰，且只能是</strong> final、sealed、non-sealed **三者之一。</p> 
<p>示例：犬类（Dog）只能被牧羊犬（Collie）和田园犬（TuGou）继承，使用 sealed 关键字。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">Dog</span> <span class="token keyword">permits</span> <span class="token class-name">Collie</span><span class="token punctuation">,</span> <span class="token class-name">TuGou</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>牧羊犬（Collie）只能被边境牧羊犬（BorderCollie）继承。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Collie</span> <span class="token keyword">implements</span> <span class="token class-name">Dog</span> <span class="token keyword">permits</span> <span class="token class-name">BorderCollie</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre> 
<p>边境牧羊犬（BorderCollie）不能被继承，使用 final 关键字。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">BorderCollie</span> <span class="token keyword">extends</span> <span class="token class-name">Collie</span><span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>田园犬（ToGou）可以被任意继承，使用 non-sealed 关键字。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">non-sealed</span> <span class="token keyword">class</span> <span class="token class-name">TuGou</span> <span class="token keyword">implements</span> <span class="token class-name">Dog</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Hidden_Classes_2199"></a>Hidden Classes（隐藏类）</h3> 
<p>这个特性让开发者可以引入一个无法被其他地方发现使用，且类的生命周期有限的类。这对运行时动态生成类的使用方式十分有利，可以减少内存占用，下面是一个使用示例。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JEP371Test</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token string">"www.baidu.com"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>把类 JEP371Test 编译后的 Class 转换成 Base64，然后使用 Java 15 新特性加载调用类中的 lookup 方法。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>invoke<span class="token punctuation">.</span></span><span class="token class-name">MethodHandle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>invoke<span class="token punctuation">.</span></span><span class="token class-name">MethodHandles</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>invoke<span class="token punctuation">.</span></span><span class="token class-name">MethodType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> JEP371 <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> CLASS_INFO <span class="token operator">=</span> <span class="token string">"yv66vgAAADQAFAoAAgADBwAEDAAFAAYBABBqYXZhL2xhbmcvT2JqZWN0AQAGPGluaXQ+AQADKClWCAAIAQAOd3d3LndkYnl0ZS5jb20HAAoBABVjb20vd2RieXRlL0pFUDM3MVRlc3QBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAF0xjb20vd2RieXRlL0pFUDM3MVRlc3Q7AQAGbG9va3VwAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAApTb3VyY2VGaWxlAQAPSkVQMzcxVGVzdC5qYXZhACEACQACAAAAAAACAAEABQAGAAEACwAAAC8AAQABAAAABSq3AAGxAAAAAgAMAAAABgABAAAAAwANAAAADAABAAAABQAOAA8AAAAJABAAEQABAAsAAAAbAAEAAAAAAAMSB7AAAAABAAwAAAAGAAEAAAAEAAEAEgAAAAIAEw=="</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classInBytes <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>CLASS_INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> proxy <span class="token operator">=</span> <span class="token class-name">MethodHandles</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">defineHiddenClass</span><span class="token punctuation">(</span>classInBytes<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token class-name">MethodHandles<span class="token punctuation">.</span>Lookup<span class="token punctuation">.</span>ClassOption</span><span class="token punctuation">.</span>NESTMATE<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">lookupClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MethodHandle</span> mh <span class="token operator">=</span> <span class="token class-name">MethodHandles</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findStatic</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">"lookup"</span><span class="token punctuation">,</span> <span class="token class-name">MethodType</span><span class="token punctuation">.</span><span class="token function">methodType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> mh<span class="token punctuation">.</span><span class="token function">invokeExact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span></span>JEP371Test</span><span class="token operator">/</span><span class="token number">0x0000000800c01800</span>
www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
</code></pre> 
<h3><a id="_Nashorn_JavaScript__2237"></a>移除 Nashorn JavaScript 引擎</h3> 
<p>Nashorn JavaScript 引擎在 Java 8 中被引入，在 Java 11 中被标记为废弃。由于 ECMAScript 语言发展很快，维护 Nashorn JavaScript 的成本过于高昂，在 Java 15 中被彻底删除。</p> 
<blockquote> 
 <p>阅读：<a href="https://openjdk.java.net/jeps/174" rel="nofollow">Nashorn JavaScript Engine (opens new window)</a>，<a href="https://openjdk.java.net/jeps/335" rel="nofollow">Deprecate the Nashorn JavaScript Engine(opens new window)</a></p> 
</blockquote> 
<h3><a id="_DatagramSocket_API_2241"></a>重新实现 DatagramSocket API</h3> 
<p>Java 13 中重新实现了旧的 Socket API，在介绍 Java 13 时还有一部分做了这方面的介绍。<br> 现在，Java 15 重新实现了遗留的 DatagramSocket</p> 
<h3><a id="Biased_Locking_2244"></a>禁用和废弃偏向锁（Biased Locking）</h3> 
<p>在之前，JVM 在处理同步操作，如使用 <strong>synchronized</strong> 同步时，有一套锁的升级机制，其中有一个锁机制就是偏向锁。然而通过目前的 Java 开发环境来看，使用这些被 synchronized 同步的类的机会并不多，如开发者更喜欢使用 **HashMap **或者 **ArrayList **而非 <strong>HashTable <strong>和 <strong>Vector</strong>。<br> 即使换个角度，当初使用偏向锁是为了提高性能，如今看来性能提升的程度和使用次数都不太有用。而偏向锁的引入增加了 JVM 的复杂性。<br> 所以现在偏向锁被默认禁用，在不久的将来将会彻底删除，对于 Java 15，我们仍然可以使用</strong> -XX:+UseBiasedLocking</strong> 启用偏向锁定，但它会提示 这是一个已弃用的 API。</p> 
<h3><a id="instanceof___2248"></a>instanceof 类型匹配 (二次预览)</h3> 
<p>instanceof 类型匹配在 Java 14 中已经改进，这次仅仅再次预览，没有任何改动，用于接受更多的使用反馈。这个特性在 Java 16 中成为正式特性。<br> 在之前，使用 instanceof 进行类型判断之后，需要进行对象类型转换后才能使用。</p> 
<h3><a id="ZGC__2251"></a>ZGC: 可扩展低延迟垃圾收集器（正式发布）</h3> 
<p>ZGC 垃圾收集器在 Java 11 中被引入，但是因为收集器的复杂性，当初决定逐渐引入。然后不断的听取用户的反馈建议修复问题。而现在，已经很久没有收到用户的问题反馈了，ZGC 是时候投入正式使用阶段了。所以在 Java 15 中 ZGC 正式发布，可以使用下面的参数启用 ZGC。</p> 
<pre><code class="prism language-java"> java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseZGC</span> className
</code></pre> 
<h3><a id="_2256"></a>文本块</h3> 
<p>文本块在 Java 12 <a href="https://openjdk.java.net/jeps/326" rel="nofollow">JEP 326 原始字符串文字 (opens new window)</a>中引入，<br> 在 Java 13 JEP 355：<a href="https://openjdk.java.net/jeps/355" rel="nofollow">文本块（预览） (opens new window)</a>中开始预览，<br> 在 Java 14 JEP 368：<a href="https://openjdk.java.net/jeps/368" rel="nofollow">文本块（第二次预览） (opens new window)</a>，<br> 而现在，在 Java 15 ，文本块是正式的功能特性了。</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">""</span>"
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">"upperSummary"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\
            <span class="token string">"sensitiveTypeList"</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">"gmtModified"</span><span class="token operator">:</span> <span class="token string">"2022-08-23\s10:50:09"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
         <span class="token string">""</span>"<span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="Shenandoah__2272"></a>Shenandoah: 低停顿时间的垃圾收集器</h3> 
<p>Shenandoah 垃圾收集器在 Java 12 中开始引入，Java 15 中成为了正式功能的一部分，可以使用下面的参数启用 Shenandoah 垃圾收集器。</p> 
<pre><code class="prism language-java">java <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseShenandoahGC</span>
</code></pre> 
<p>但是 openJDK 15 中默认是没有 Shenandoah 收集器，想要使用此功能可以下载 <a href="https://adoptopenjdk.net/" rel="nofollow">AdoptOpenJDK (opens new window)</a>。</p> 
<blockquote> 
 <p>为什么 openJDK 中没有 Shenandoah 垃圾收集器？<br> Shenandoah 是一个高性能、低暂停时间的垃圾收集器，它是 Red Hat 主导的项目。当 Red Hat 第一次提议将 Shenandoah 贡献给 OpenJDK 时，Oracle 明确表示不想支持它，OpenJDK 作为一个免费软件，不想支持 Red Hat 的 Shenandoah 完全没有问题。<br> 最后 Red Hat 选择和 Oracle 合作设计一个真正干净的可插拔垃圾收集器接口，允许任何人轻松选择垃圾收集器以包含在他们的构建中。最终 Shenandoah 进入了 JDK 12，但是没有构建进 OpenJDK。</p> 
</blockquote> 
<h3><a id="Records_2282"></a>Records（二次预览）</h3> 
<p>在 Java 14 中引入了 Record 类，Java 15 中对 Record 进行了增强。使它可以支持密封类型、Record 注解以及相关的反射 API 等。<br> 示例：Record 支持密封（sealed）类型。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">DataBase</span> <span class="token keyword">permits</span> <span class="token class-name">DataBaseSelect</span><span class="token punctuation">,</span> <span class="token class-name">DataBaseUpdate</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">final</span> <span class="token keyword">record</span> <span class="token class-name">DataBaseSelect</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Deprecated</span> <span class="token class-name">String</span> table<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">DataBase</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">final</span> <span class="token keyword">record</span> <span class="token class-name">DataBaseUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">DataBase</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 java.lang.Class 增加了两个公共方法用于获取 Record 类信息：</p> 
<ol><li>RecordComponent[] getRecordComponents()</li><li>boolean isRecord()</li></ol> 
<h3><a id="_2299"></a>其他更新</h3> 
<ol><li>JEP 381：删除 Solaris 和 SPARC 端口</li></ol> 
<p>Java 14 JEP 362 (opens new window)弃用了 Solaris/SPARC、Solaris/x64 和 Linux/SPARC 端口，现在它在 Java 15 中被正式删除。</p> 
<ol start="2"><li>JEP 383：外部内存访问 API（第二个孵化器）</li><li>JEP 385：废弃 RMI 激活机制</li></ol> 
<p>只是废弃 RMI 激活机制，不影响 RMI 其他功能。</p> 
<h2><a id="h1_id16Java_16__2309"></a></h2> 
<h2 id="16">Java 16 新特性</h2> 
<p>Java 16 在 2021 年 3 月 16 日正式发布，在语法上的新特性更新比较多，主要是一些之前版本引入的预览特性正式发布。比如Java14中的打包工具、instanceof、Record类。<br> Java 16 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/16all-relnotes.html" rel="nofollow">JDK 16 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="instanceof__2314"></a>instanceof 模式匹配</h3> 
<p>改进 instanceof 在 Java 14 中已经提出，在 Java 15 中继续预览，而现在，在 Java 16 中成为正式功能。<br> 在之前，使用 instanceof 需要如下操作：</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>    <span class="token comment">// grr...</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>多余的类型强制转换，而现在</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Let pattern matching do the work!</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Records_2330"></a>Records</h3> 
<p>Record 成为 Java 16 的正式功能，下面是介绍 Java 14 时关于 Record 的介绍。<br> record 是一种全新的类型，它本质上是一个 final 类，同时所有的属性都是 final 修饰，它会自动编译出 public get hashcode 、equals、toString 等方法，减少了代码编写量。</p> 
<pre><code class="prism language-java"><span class="token class-name">Dog</span> dog1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"牧羊犬"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> dog2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"田园犬"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> dog3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">"哈士奇"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="Sealed_Classes_2341"></a>Sealed Classes（密封类）预览</h3> 
<p>Sealed Classes 再次预览，在 Java 15 新特性介绍文章里已经介绍过相关功能，并且给出了详细的使用演示，这里不再重复介绍。<br> 下面是一段引用：<br> 我们都知道，在 Java 中如果想让一个类不能被继承和修改，这时我们应该使用 final 关键字对类进行修饰。不过这种要么可以继承，要么不能继承的机制不够灵活，有些时候我们可能想让某个类可以被某些类型继承，但是又不能随意继承，是做不到的。<strong>Java 15 尝试解决这个问题，引入了 sealed 类，被 sealed 修饰的类可以指定子类</strong>。这样这个类就只能被指定的类继承。<br> 而且 sealed 修饰的类的机制具有传递性，它的子类必须使用指定的关键字进行修饰，且只能是 <strong>final、sealed、non-sealed</strong> 三者之一。</p> 
<h2><a id="h1_id17Java_17__2346"></a></h2> 
<h2 id="17">Java 17 新特性</h2> 
<p>Java 17 在 2021 年 9 月 14 日正式发布，Java 17 是一个长期支持（LTS）版本。来看几个重要的。<br> Java 17 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/17-relnote-issues.html#NewFeature" rel="nofollow">JDK 17 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a><br> <img src="https://images2.imgbox.com/85/b7/0ODPfeug_o.png" alt="image.png"></p> 
<h3><a id="_2352"></a>恢复严格的浮点语义</h3> 
<p>既然是恢复严格的浮点语义，那么说明在某个时间点之前，是始终严格的浮点语义的。其实在 Java SE 1.2 之前，所有的浮点计算都是严格的，但是以当初的情况来看，过于严格的浮点计算在当初流行的 x86 架构和 x87 浮点协议处理器上运行，需要大量的额外的指令开销，所以在 Java SE 1.2 开始，需要手动使用关键字 strictfp（strict float point） 才能启用严格的浮点计算。<br> 但是在 2021 年的今天，硬件早已发生巨变，当初的问题已经不存在了，所以从 Java 17 开始，恢复了始终严格的浮点语义这一特性。<br> 扩展：strictfp 是 Java 中的一个关键字，大多数人可能没有注意过它，它可以用在<strong>类、接口或者方法</strong>上，被 strictfp 修饰的部分中的 float 和 double 表达式会进行严格浮点计算。</p> 
<p>下面是一个示例，其中的 testStrictfp() 被 strictfp 修饰。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">testStrictfp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">strictfp</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testStrictfp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> aFloat <span class="token operator">=</span> <span class="token number">0.6666666666666666666f</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> aDouble <span class="token operator">=</span> <span class="token number">0.88888888888888888d</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> sum <span class="token operator">=</span> aFloat <span class="token operator">+</span> aDouble<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sum: "</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_2370"></a>增强的伪随机数生成器</h3> 
<p>为伪随机数生成器 RPNG（pseudorandom number generator）增加了新的接口类型和实现，让在代码中使用各种 PRNG 算法变得容易许多。<br> 这次增加了 **RandomGenerator **接口，为所有的 PRNG 算法提供统一的 API，并且可以获取不同类型的 PRNG 对象流。同时也提供了一个新类 **RandomGeneratorFactory **用于构造各种 **RandomGenerator **实例，在 **RandomGeneratorFactory **中使用 **ServiceLoader.provider **来加载各种 PRNG 实现。<br> 下面是一个使用示例：随便选择一个 PRNG 算法生成 5 个 10 以内的随机数。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>random<span class="token punctuation">.</span></span><span class="token class-name">RandomGenerator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>random<span class="token punctuation">.</span></span><span class="token class-name">RandomGeneratorFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Stream</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> JEP356 <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomGeneratorFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomGenerator</span><span class="token punctuation">&gt;</span></span> l128X256MixRandom <span class="token operator">=</span> <span class="token class-name">RandomGeneratorFactory</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"L128X256MixRandom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用时间戳作为随机数种子</span>
        <span class="token class-name">RandomGenerator</span> randomGenerator <span class="token operator">=</span> l128X256MixRandom<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>randomGenerator<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token number">7</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">6</span>
</code></pre> 
<p>你也可以遍历出所有的 PRNG 算法。</p> 
<pre><code class="prism language-java"><span class="token class-name">RandomGeneratorFactory</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>factory <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> factory<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java">LXM<span class="token operator">:</span><span class="token class-name">L32X64MixRandom</span>
LXM<span class="token operator">:</span><span class="token class-name">L128X128MixRandom</span>
LXM<span class="token operator">:</span><span class="token class-name">L64X128MixRandom</span>
<span class="token class-name">Legacy</span><span class="token operator">:</span><span class="token class-name">SecureRandom</span>
LXM<span class="token operator">:</span><span class="token class-name">L128X1024MixRandom</span>
LXM<span class="token operator">:</span><span class="token class-name">L64X128StarStarRandom</span>
<span class="token class-name">Xoshiro</span><span class="token operator">:</span><span class="token class-name">Xoshiro256PlusPlus</span>
LXM<span class="token operator">:</span><span class="token class-name">L64X256MixRandom</span>
<span class="token class-name">Legacy</span><span class="token operator">:</span><span class="token class-name">Random</span>
<span class="token class-name">Xoroshiro</span><span class="token operator">:</span><span class="token class-name">Xoroshiro128PlusPlus</span>
LXM<span class="token operator">:</span><span class="token class-name">L128X256MixRandom</span>
<span class="token class-name">Legacy</span><span class="token operator">:</span><span class="token class-name">SplittableRandom</span>
LXM<span class="token operator">:</span><span class="token class-name">L64X1024MixRandom</span>
</code></pre> 
<p>可以看到 Legacy:Random 也在其中，新的 API 兼容了老的 Random 方式，所以你也可以使用新的 API 调用 Random 类生成随机数。</p> 
<pre><code class="prism language-java"><span class="token comment">// 使用 Random</span>
<span class="token class-name">RandomGeneratorFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomGenerator</span><span class="token punctuation">&gt;</span></span> l128X256MixRandom <span class="token operator">=</span> <span class="token class-name">RandomGeneratorFactory</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Random"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用时间戳作为随机数种子</span>
<span class="token class-name">RandomGenerator</span> randomGenerator <span class="token operator">=</span> l128X256MixRandom<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>randomGenerator<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_macOS__2433"></a>使用新的 macOS 渲染库</h3> 
<p>macOS 为了提高图形的渲染性能，在 2018 年 9 月抛弃了之前的 OpenGL 渲染库 ，而使用了 Apple Metal 进行代替。Java 17 这次更新开始支持 Apple Metal，不过对于 API 没有任何改变，这一些都是内部修改。</p> 
<h3><a id="_macOSAArch64__2435"></a>支持 macOS/AArch64 架构</h3> 
<p>起因是 Apple 在 2020 年 6 月的 WWDC 演讲中宣布，将开启一项长期的将 Macintosh 计算机系列从 x64 过度到 AArch64 的长期计划，因此需要尽快的让 JDK 支持 macOS/AArch64 。<br> Linux 上的 AArch64 支持以及在 Java 16 时已经支持。</p> 
<h3><a id="_Applet_API_2438"></a>删除已弃用的 Applet API</h3> 
<p>Applet 是使用 Java 编写的可以嵌入到 HTML 中的小应用程序，嵌入方式是通过普通的 HTML 标记语法，由于早已过时，几乎没有场景在使用了。</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>applet code<span class="token operator">=</span><span class="token string">"Hello.class"</span> height<span class="token operator">=</span><span class="token number">200</span> width<span class="token operator">=</span><span class="token number">200</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>applet<span class="token operator">&gt;</span>
</code></pre> 
<p>Applet API 在 Java 9 时已经标记了废弃，现在 Java 17 中将彻底删除。</p> 
<h3><a id="_JDK__2444"></a>更强的 JDK 内部封装</h3> 
<p>如 Java 16 的 JEP 396 中描述的一样，为了提高 JDK 的安全性，使 --illegal-access 选项的默认模式从允许更改为拒绝。通过此更改，JDK 的内部包和 API（<a href="https://openjdk.java.net/jeps/260#Description" rel="nofollow">关键内部 API (opens new window)</a>除外）将不再默认打开。<br> 但是在 Java 17 中，除了 sun.misc.Unsafe ，使用 --illegal-access 命令也不能打开 JDK 内部的强封装模式了，除了 sun.misc.Unsafe API 。<br> 在 Java 17 中使用 --illegal-access 选项将会得到一个命令已经移除的警告。</p> 
<pre><code class="prism language-java">➜  bin <span class="token punctuation">.</span>/java <span class="token operator">-</span>version
openjdk version <span class="token string">"17"</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">14</span>
<span class="token class-name">OpenJDK</span> <span class="token class-name">Runtime</span> <span class="token class-name">Environment</span> <span class="token punctuation">(</span>build <span class="token number">17</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">-</span><span class="token number">2724</span><span class="token punctuation">)</span>
<span class="token class-name">OpenJDK</span> <span class="token number">64</span><span class="token operator">-</span><span class="token class-name">Bit</span> <span class="token class-name">Server</span> VM <span class="token punctuation">(</span>build <span class="token number">17</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">-</span><span class="token number">2724</span><span class="token punctuation">,</span> mixed mode<span class="token punctuation">,</span> sharing<span class="token punctuation">)</span>
➜  bin <span class="token punctuation">.</span>/java <span class="token operator">--</span>illegal<span class="token operator">-</span>access<span class="token operator">=</span>warn
<span class="token class-name">OpenJDK</span> <span class="token number">64</span><span class="token operator">-</span><span class="token class-name">Bit</span> <span class="token class-name">Server</span> VM warning<span class="token operator">:</span> <span class="token class-name">Ignoring</span> option <span class="token operator">--</span>illegal<span class="token operator">-</span>access<span class="token operator">=</span>warn<span class="token punctuation">;</span> support was removed in <span class="token number">17.0</span>
</code></pre> 
<h3><a id="switch__2456"></a>switch 的类型匹配（预览）</h3> 
<p>如 instanceof 一样，为 switch 也增加了类型匹配自动转换功能。<br> 在之前，使用 instanceof 需要如下操作：</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>    <span class="token comment">// grr...</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>多余的类型强制转换，而现在：</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Let pattern matching do the work!</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>也可以使用如下的方式：</p> 
<pre><code class="prism language-java"><span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatterPatternSwitch</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token class-name">Integer</span> i <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"int %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Long</span> l    <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"long %d"</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Double</span> d  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"double %f"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">String</span> s  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"String %s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>        <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对<strong>null</strong>也有新的方式：</p> 
<pre><code class="prism language-java"><span class="token comment">// Java 17 之前</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testFooBar</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"oops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> <span class="token string">"Bar"</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Great"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>           <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Java 17</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testFooBar</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token keyword">null</span>         <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Oops"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> <span class="token string">"Bar"</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Great"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>           <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_RMI_Activation_2506"></a>移除 RMI Activation</h3> 
<p>移除了在 JEP 385 中被标记废除的 RMI（Remote Method Invocation）Activation，但是 RMI 其他部分不会受影响。<br> RMI Activation 在 Java 15 中的 JEP 385 已经被标记为过时废弃，至今没有收到不良反馈，因此决定在 Java 17 中正式移除。</p> 
<h3><a id="Sealed_Classes_2509"></a>密封类（Sealed Classes）</h3> 
<p><strong>Sealed Classes</strong> 在 Java 15 中的 JEP 360 中提出，在 Java 16 中的 JEP 397 再次预览，现在 Java 17 中成为正式的功能，相比 Java 16 并没有功能变化，这里不再重复介绍，想了解的可以参考之前章节。</p> 
<h3><a id="_AOT__JIT__2511"></a>移除实验性的 AOT 和 JIT 编译器</h3> 
<p>在 Java 9 的 JEP 295 中，引入了实验性的提前编译 jaotc 工具，但是这个特性自从引入依赖用处都不太大，而且需要大量的维护工作，所以在 Java 17 中决定删除这个特性。</p> 
<p>主要移除了三个 JDK 模块：</p> 
<ul><li>jdk.aot - jaotc 工具。</li><li>Jdk.internal.vm.compiler - Graal 编译器。</li><li>jdk.internal.vm.compiler.management</li></ul> 
<p>同时也移除了部分与 AOT 编译相关的 HotSpot 代码：</p> 
<ul><li>src/hotspot/share/aot — dumps and loads AOT code</li><li>Additional code guarded by #if INCLUDE_AOT</li></ul> 
<h3><a id="_Security_Manager_2524"></a>弃用 Security Manager</h3> 
<p><strong>Security Manager</strong> 在 JDK 1.0 时就已经引入，但是它一直都不是保护服务端以及客户端 Java 代码的主要手段，为了 Java 的继续发展，决定弃用 Security Manager，在不久的未来进行删除。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Deprecated</span><span class="token punctuation">(</span>since<span class="token operator">=</span><span class="token string">"17"</span><span class="token punctuation">,</span> forRemoval<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityManager</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_API__2532"></a>外部函数和内存 API （孵化）</h3> 
<p>新的 API 允许 Java 开发者与 JVM 之外的代码和数据进行交互，通过调用外部函数，可以在不使用 JNI 的情况下调用本地库。<br> <em>这是一个孵化功能；需要添加 --add-modules jdk.incubator.foreign 来编译和运行 Java 代码。</em></p> 
<ul><li>Java 14 <a href="https://openjdk.java.net/jeps/370" rel="nofollow">JEP 370 (opens new window)</a>引入了外部内存访问 API（孵化器）</li><li>Java 15 <a href="https://openjdk.java.net/jeps/383" rel="nofollow">JEP 383 (opens new window)</a>引入了外部内存访问 API（第二孵化器）</li><li>Java 16 <a href="https://openjdk.java.net/jeps/389" rel="nofollow">JEP 389 (opens new window)</a>引入了外部链接器 API（孵化器）</li><li>Java 16 <a href="https://openjdk.java.net/jeps/393" rel="nofollow">JEP 393 (opens new window)</a>引入了外部内存访问 API（第三孵化器）</li><li>Java 17 <a href="https://openjdk.java.net/jeps/412" rel="nofollow">JEP 412 (opens new window)</a>引入了外部函数和内存 API（孵化器）</li></ul> 
<h3><a id="Vector_API_2541"></a>Vector API（二次孵化）</h3> 
<p>在 Java 16 中引入一个新的 API 来进行向量计算，它可以在运行时可靠的编译为支持的 CPU 架构，从而实现更优的计算能力。<br> 现在 Java 17 中改进了 Vector API 性能，增强了例如对字符的操作、字节向量与布尔数组之间的相互转换等功能。</p> 
<h3><a id="_2544"></a>指定上下文的反序列化过滤器</h3> 
<p>Java 中的序列化一直都是非常重要的功能，如果没有序列化功能，Java 可能都不会占据开发语言的主导地位，序列化让远程处理变得容易和透明，同时也促进了 Java EE 的成功。<br> 但是 Java 序列化的问题也很多，它几乎会犯下所有的可以想象的错误，为开发者带来持续的维护工作。但是要说明的是序列化的概念是没有错的，把对象转换为可以在 JVM 之间自由传输，并且可以在另一端重新构建的能力是完全合理的想法，问题在于 Java 中的序列化设计存在风险，以至于爆出过很多和序列化相关的漏洞。<br> 反序列化危险的一个原因是，有时候我们不好验证将要进行反序列化的内容是否存在风险，而传入的数据流可以自由引用对象，很有可能这个数据流就是攻击者精心构造的恶意代码。<br> 所以，JEP 415 允许在反序列化时，通过一个过滤配置，来告知本次反序列化允许或者禁止操作的类，反序列化时碰到被禁止的类，则会反序列化失败。</p> 
<blockquote> 
 <p>扩展阅读：<a href="https://openjdk.org/jeps/415" rel="nofollow">https://openjdk.org/jeps/415</a></p> 
</blockquote> 
<h2><a id="h1_id18Java_18__2552"></a></h2> 
<h2 id="18">Java 18 新特性</h2> 
<p>Java 18 在 2022 年 3 月 22 日正式发布，Java 18 不是一个长期支持版本，这次更新共带来 9 个新功能。<br> Java 18 全部的新特性，请看官网：<a href="https://www.oracle.com/java/technologies/javase/18-relnote-issues.html#NewFeature" rel="nofollow">JDK 18 发行说明</a><br> Java各个版本的文档入口：<a href="https://docs.oracle.com/en/java/javase/index.html" rel="nofollow">Java平台，标准版文档</a><br> Java各个版本下载：<a href="https://jdk.java.net/archive/" rel="nofollow">https://jdk.java.net/archive/</a></p> 
<h3><a id="UTF8_2557"></a>默认UTF-8字符编码</h3> 
<p>JDK 一直都是支持 UTF-8 字符编码，这次是把 UTF-8 设置为了默认编码，也就是在不加任何指定的情况下，默认所有需要用到编码的 JDK API都使用 UTF-8 编码，这样就可以避免因为不同系统，不同地区，不同环境之间产生的编码问题。<br> 使用下面的命令可以输出 JDK 的当前编码。</p> 
<pre><code class="prism language-java"># <span class="token class-name">Mac</span> 系统，默认 UTF<span class="token operator">-</span><span class="token number">8</span>
➜  <span class="token operator">~</span> java <span class="token operator">-</span><span class="token class-name">XshowSettings</span><span class="token operator">:</span>properties <span class="token operator">-</span>version <span class="token number">2</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> grep file<span class="token punctuation">.</span>encoding
    file<span class="token punctuation">.</span>encoding <span class="token operator">=</span> UTF<span class="token operator">-</span><span class="token number">8</span>
    file<span class="token punctuation">.</span>encoding<span class="token punctuation">.</span>pkg <span class="token operator">=</span> sun<span class="token punctuation">.</span>io
➜  <span class="token operator">~</span>
</code></pre> 
<h3><a id="_Web__2567"></a>简单的 Web 服务器</h3> 
<p>在 Java 18 中，提供了一个新命令 jwebserver，运行这个命令可以启动一个简单的 、最小化的静态 Web 服务器，它不支持 CGI 和 Servlet，所以最好的使用场景是用来测试、教育、演示等需求。<br> 其实在如 Python、Ruby、PHP、Erlang 等许多平台都提供了开箱即用的 Web 服务器，可见一个简单的 Web 服务器是一个常见的需求，Java 一直没有这方面的支持，现在可以了。<br> 在 Java 18 中，使用 jwebserver 启动一个 Web 服务器，默认发布的是当前目录。</p> 
<p>在当前目录创建一个网页文件 index.html</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"Content-Type"</span> content<span class="token operator">=</span><span class="token string">"text/html; charset=utf-8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span>CSDN<span class="token operator">-</span>阿提说说<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>启动 jwebserver</p> 
<pre><code class="prism language-java"><span class="token class-name">Binding</span> <span class="token keyword">to</span> <span class="token namespace">loopback</span> by <span class="token class-name"><span class="token namespace">default<span class="token punctuation">.</span></span> For</span> all interfaces use <span class="token string">"-b 0.0.0.0"</span> or <span class="token string">"-b ::"</span><span class="token punctuation">.</span>
<span class="token class-name">Serving</span> <span class="token class-name">D</span><span class="token operator">:</span>\javaprojects\java18<span class="token operator">-</span>example\src\test\java\other and subdirectories on
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> port <span class="token number">8000</span>
URL http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8000</span><span class="token operator">/</span>
</code></pre> 
<p>通过 help 参数可以查看 jwebserver 支持的参数。</p> 
<pre><code class="prism language-java">➜  bin <span class="token punctuation">.</span>/jwebserver <span class="token operator">--</span>help
<span class="token class-name">Usage</span><span class="token operator">:</span> jwebserver <span class="token punctuation">[</span><span class="token operator">-</span>b bind address<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>p port<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>d directory<span class="token punctuation">]</span>
                  <span class="token punctuation">[</span><span class="token operator">-</span>o none<span class="token operator">|</span>info<span class="token operator">|</span>verbose<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>h <span class="token keyword">to</span> <span class="token namespace">show</span> options<span class="token punctuation">]</span>
                  <span class="token punctuation">[</span><span class="token operator">-</span>version <span class="token keyword">to</span> <span class="token namespace">show</span> version information<span class="token punctuation">]</span>
<span class="token class-name">Options</span><span class="token operator">:</span>
<span class="token operator">-</span>b<span class="token punctuation">,</span> <span class="token operator">--</span>bind<span class="token operator">-</span>address    <span class="token operator">-</span> 绑定地址<span class="token punctuation">.</span> <span class="token class-name">Default</span><span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token punctuation">(</span>loopback<span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token class-name">For</span> all interfaces use <span class="token string">"-b 0.0.0.0"</span> or <span class="token string">"-b ::"</span><span class="token punctuation">.</span>
<span class="token operator">-</span>d<span class="token punctuation">,</span> <span class="token operator">--</span>directory       <span class="token operator">-</span> 指定目录<span class="token punctuation">.</span> <span class="token class-name">Default</span><span class="token operator">:</span> current directory<span class="token punctuation">.</span>
<span class="token operator">-</span>o<span class="token punctuation">,</span> <span class="token operator">--</span>output          <span class="token operator">-</span> <span class="token class-name">Output</span> format<span class="token punctuation">.</span> none<span class="token operator">|</span>info<span class="token operator">|</span><span class="token class-name"><span class="token namespace">verbose<span class="token punctuation">.</span></span> Default</span><span class="token operator">:</span> info<span class="token punctuation">.</span>
<span class="token operator">-</span>p<span class="token punctuation">,</span> <span class="token operator">--</span>port            <span class="token operator">-</span> 绑定端口<span class="token punctuation">.</span> <span class="token class-name">Default</span><span class="token operator">:</span> <span class="token number">8000.</span>
<span class="token operator">-</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">--</span>help        <span class="token operator">-</span> <span class="token class-name">Prints</span> <span class="token keyword">this</span> help message and exits<span class="token punctuation">.</span>
<span class="token operator">-</span>version<span class="token punctuation">,</span> <span class="token operator">--</span>version   <span class="token operator">-</span> <span class="token class-name">Prints</span> version information and <span class="token class-name"><span class="token namespace">exits<span class="token punctuation">.</span></span>
To</span> stop the server<span class="token punctuation">,</span> press <span class="token class-name">Ctrl</span> <span class="token operator">+</span> <span class="token class-name">C</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="Javadoc__2606"></a>Javadoc 中支持代码片段</h3> 
<p>在 Java 18 之前，已经支持在 Javadoc 中引入代码片段，这样可以在某些场景下更好的展示描述信息，但是之前的支持功能有限，比如我想高亮代码片段中的某一段代码是无能为力的。现在 Java 18 优化了这个问题，增加了 <strong>@snippet</strong> 来引入更高级的代码片段。<br> 在 Java 18 之前，使用 </p> 
<pre>{@code …}</pre> 来引入代码片段。 
<p></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 在 Java 18 之后可以使用新的方式
 * 下面的代码演示如何使用 {@code Optional.isPresent}:
 * {@snippet :
 * if (v.isPresent()) {
 *     System.out.println("v: " + v.get());
 * }
 * }
 *
 * 高亮显示 println
 *
 * {@snippet :
 * class HelloWorld {
 *     public static void main(String... args) {
 *         System.out.println("Hello World!");      // @highlight substring="println"
 *     }
 * }
 * }
 *
 */</span>
</code></pre> 
<p>显示效果：<br> <img src="https://images2.imgbox.com/1b/58/iT6VKqyN_o.png" alt="image.png"></p> 
<h3><a id="_2634"></a>使用方法句柄重新实现反射核心功能</h3> 
<p>Java 18 改进了** java.lang.reflect.Method**、**Constructor **的实现逻辑，使之性能更好，速度更快。这项改动不会改动相关 API ，这意味着开发中不需要改动反射相关代码，就可以体验到性能更好反射。<br> OpenJDK 官方给出了新老实现的反射性能基准测试结果。<br> Java 18 之前：</p> 
<pre><code class="prism language-java"><span class="token class-name">Benchmark</span>                                     <span class="token class-name">Mode</span>  <span class="token class-name">Cnt</span>   <span class="token class-name">Score</span>  <span class="token class-name">Error</span>  <span class="token class-name">Units</span>
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorConst     avgt   <span class="token number">10</span>  <span class="token number">68.049</span> ± <span class="token number">0.872</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorPoly      avgt   <span class="token number">10</span>  <span class="token number">94.132</span> ± <span class="token number">1.805</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorVar       avgt   <span class="token number">10</span>  <span class="token number">64.543</span> ± <span class="token number">0.799</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldConst   avgt   <span class="token number">10</span>  <span class="token number">35.361</span> ± <span class="token number">0.492</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldPoly    avgt   <span class="token number">10</span>  <span class="token number">67.089</span> ± <span class="token number">3.288</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldVar     avgt   <span class="token number">10</span>  <span class="token number">35.745</span> ± <span class="token number">0.554</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodConst  avgt   <span class="token number">10</span>  <span class="token number">77.925</span> ± <span class="token number">2.026</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodPoly   avgt   <span class="token number">10</span>  <span class="token number">96.094</span> ± <span class="token number">2.269</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodVar    avgt   <span class="token number">10</span>  <span class="token number">80.002</span> ± <span class="token number">4.267</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldConst     avgt   <span class="token number">10</span>  <span class="token number">33.442</span> ± <span class="token number">2.659</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldPoly      avgt   <span class="token number">10</span>  <span class="token number">51.918</span> ± <span class="token number">1.522</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldVar       avgt   <span class="token number">10</span>  <span class="token number">33.967</span> ± <span class="token number">0.451</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodConst    avgt   <span class="token number">10</span>  <span class="token number">75.380</span> ± <span class="token number">1.660</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodPoly     avgt   <span class="token number">10</span>  <span class="token number">93.553</span> ± <span class="token number">1.037</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodVar      avgt   <span class="token number">10</span>  <span class="token number">76.728</span> ± <span class="token number">1.614</span>  ns<span class="token operator">/</span>op
</code></pre> 
<p>Java 18 的新实现:</p> 
<pre><code class="prism language-java"><span class="token class-name">Benchmark</span>                                     <span class="token class-name">Mode</span>  <span class="token class-name">Cnt</span>    <span class="token class-name">Score</span>   <span class="token class-name">Error</span>  <span class="token class-name">Units</span>
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorConst     avgt   <span class="token number">10</span>   <span class="token number">32.392</span> ± <span class="token number">0.473</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorPoly      avgt   <span class="token number">10</span>  <span class="token number">113.947</span> ± <span class="token number">1.205</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>constructorVar       avgt   <span class="token number">10</span>   <span class="token number">76.885</span> ± <span class="token number">1.128</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldConst   avgt   <span class="token number">10</span>   <span class="token number">18.569</span> ± <span class="token number">0.161</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldPoly    avgt   <span class="token number">10</span>   <span class="token number">98.671</span> ± <span class="token number">2.015</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceFieldVar     avgt   <span class="token number">10</span>   <span class="token number">54.193</span> ± <span class="token number">3.510</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodConst  avgt   <span class="token number">10</span>   <span class="token number">33.421</span> ± <span class="token number">0.406</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodPoly   avgt   <span class="token number">10</span>  <span class="token number">109.129</span> ± <span class="token number">1.959</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>instanceMethodVar    avgt   <span class="token number">10</span>   <span class="token number">90.420</span> ± <span class="token number">2.187</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldConst     avgt   <span class="token number">10</span>   <span class="token number">19.080</span> ± <span class="token number">0.179</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldPoly      avgt   <span class="token number">10</span>   <span class="token number">92.130</span> ± <span class="token number">2.729</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticFieldVar       avgt   <span class="token number">10</span>   <span class="token number">53.899</span> ± <span class="token number">1.051</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodConst    avgt   <span class="token number">10</span>   <span class="token number">35.907</span> ± <span class="token number">0.456</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodPoly     avgt   <span class="token number">10</span>  <span class="token number">102.895</span> ± <span class="token number">1.604</span>  ns<span class="token operator">/</span>op
<span class="token class-name">ReflectionSpeedBenchmark</span><span class="token punctuation">.</span>staticMethodVar      avgt   <span class="token number">10</span>   <span class="token number">82.123</span> ± <span class="token number">0.629</span>  ns<span class="token operator">/</span>op
</code></pre> 
<h3><a id="Vector_API_2675"></a>Vector API（三次孵化）</h3> 
<p>在 Java 16 中引入一个新的 API 来进行向量计算，它可以在运行时可靠的编译为支持的 CPU 架构，从而实现更优的计算能力。<br> 在 Java 17 中改进了 Vector API 性能，增强了例如对字符的操作、字节向量与布尔数组之间的相互转换等功能。<br> 现在在 JDK 18 中将继续优化其性能。</p> 
<h3><a id="_SPI_2679"></a>互联网地址解析 SPI</h3> 
<p>对于互联网地址解析 SPI，为主机地址和域名地址解析定义一个 SPI，以便 java.net.InetAddress 可以使用平台内置解析器以外的解析器。</p> 
<pre><code class="prism language-java"><span class="token class-name">InetAddress</span> inetAddress <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">"www.csdn.net"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>inetAddress<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//39.106.226.142</span>
</code></pre> 
<h3><a id="_2687"></a>其他更新</h3> 
<ol><li>JEP 419 <a href="https://openjdk.java.net/jeps/419" rel="nofollow">Foreign Function &amp; Memory API (二次孵化)(opens new window)</a></li><li>JEP 420 <a href="https://openjdk.java.net/jeps/420" rel="nofollow">switch 模式匹配（二次预览）(opens new window)</a></li><li>JEP 421 <a href="https://openjdk.java.net/jeps/421" rel="nofollow">弃用完成删除(opens new window)</a></li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31e9fa595afad5b907e7ead5f293f7e2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">分类、目标检测、语义分割、实例分割的区别【搬运】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/af6efcc7de830bc386cfed2101743ca6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信第三方平台uni-app配置ext.json</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>