<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手把手 Flutter 混合开发 -- 基于 FlutterBoost 实现 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="手把手 Flutter 混合开发 -- 基于 FlutterBoost 实现" />
<meta property="og:description" content="目录
1.FlutterBoost 简介
2.FlutterBoost 集成 ( 版本 1.17.1 )
2.1 Flutter 端集成
2.2 Android 端集成
3.FlutterBoost 使用
3.1 FlutterBoost 初始化
3.2 Native 传参启动 Flutter 页面，并接收返回结果
3.3 Flutter 传参启动 Native / Flutter 页面，并接收返回结果
4.最后
本文未提供 iOS 端集成与使用示例
当一个成熟的产品/项目，想要开始 Flutter 开发，同时又不想从零开始全面使用 Flutter 开发，最后选择保留原有 Native 项目代码和功能，在新业务或变动上使用 Flutter 进行开发，这种以 既有原生，又有 Flutter 的开发模式就称之为 Flutter 混合开发模式。该开发模式的好处体现在，不用全面推翻 APP 项目的原有积累， Native 端就可以无感接入 Flutter ，开始 Flutter 开发，拥抱 Flutter 的特性特点。
1.FlutterBoost 简介 FlutterBoost 是阿里系闲鱼技术团队开源的 Flutter 插件，它可以轻松为现有原生应用程序提供 Flutter 混合集成方案。其理念是将 Flutter 像 WebView 那样来使用。FlutterBoost 帮开发者处理 Native 与 Flutter 页面的映射和跳转，开发者只需关心页面的名字和参数即可 ( 通常可以是 URL ) 。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/3f1078c88331c97533691a0715440245/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-28T11:12:45+08:00" />
<meta property="article:modified_time" content="2021-01-28T11:12:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手把手 Flutter 混合开发 -- 基于 FlutterBoost 实现</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.FlutterBoost%20%E7%AE%80%E4%BB%8B-toc" style="margin-left:0px;"><a href="#1.FlutterBoost%20%E7%AE%80%E4%BB%8B" rel="nofollow" title="1.FlutterBoost 简介">1.FlutterBoost 简介</a></p> 
<p id="2.FlutterBoost%20%E9%9B%86%E6%88%90%20(%20%E7%89%88%E6%9C%AC%201.17.1%20)-toc" style="margin-left:0px;"><a href="#2.FlutterBoost%20%E9%9B%86%E6%88%90%20%28%20%E7%89%88%E6%9C%AC%201.17.1%20%29" rel="nofollow" title="2.FlutterBoost 集成 ( 版本 1.17.1 )">2.FlutterBoost 集成 ( 版本 1.17.1 )</a></p> 
<p id="2.1%20Flutter%20%E7%AB%AF%E9%9B%86%E6%88%90-toc" style="margin-left:40px;"><a href="#2.1%20Flutter%20%E7%AB%AF%E9%9B%86%E6%88%90" rel="nofollow" title="2.1 Flutter 端集成">2.1 Flutter 端集成</a></p> 
<p id="2.2%20Android%20%E7%AB%AF%E9%9B%86%E6%88%90-toc" style="margin-left:40px;"><a href="#2.2%20Android%20%E7%AB%AF%E9%9B%86%E6%88%90" rel="nofollow" title="2.2 Android 端集成">2.2 Android 端集成</a></p> 
<p id="3.FlutterBoost%20%E4%BD%BF%E7%94%A8-toc" style="margin-left:0px;"><a href="#3.FlutterBoost%20%E4%BD%BF%E7%94%A8" rel="nofollow" title="3.FlutterBoost 使用">3.FlutterBoost 使用</a></p> 
<p id="3.1%20FlutterBoost%20%E5%88%9D%E5%A7%8B%E5%8C%96-toc" style="margin-left:40px;"><a href="#3.1%20FlutterBoost%20%E5%88%9D%E5%A7%8B%E5%8C%96" rel="nofollow" title="3.1 FlutterBoost 初始化">3.1 FlutterBoost 初始化</a></p> 
<p id="3.2%20Native%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Flutter%20%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C-toc" style="margin-left:40px;"><a href="#3.2%20Native%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Flutter%20%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C" rel="nofollow" title="3.2 Native 传参启动 Flutter 页面，并接收返回结果">3.2 Native 传参启动 Flutter 页面，并接收返回结果</a></p> 
<p id="3.3%20Flutter%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Native%20%2F%20Flutter%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C-toc" style="margin-left:40px;"><a href="#3.3%20Flutter%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Native%20%2F%20Flutter%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C" rel="nofollow" title="3.3 Flutter 传参启动 Native / Flutter 页面，并接收返回结果">3.3 Flutter 传参启动 Native / Flutter 页面，并接收返回结果</a></p> 
<p id="4.%E6%9C%80%E5%90%8E-toc" style="margin-left:0px;"><a href="#4.%E6%9C%80%E5%90%8E" rel="nofollow" title="4.最后">4.最后</a></p> 
<hr id="hr-toc"> 
<p><em>本文未提供 iOS 端集成与使用示例</em></p> 
<blockquote> 
 <p>        当一个成熟的产品/项目，想要开始 Flutter 开发，同时又不想从零开始全面使用 Flutter 开发，最后选择保留原有 Native 项目代码和功能，在新业务或变动上使用 Flutter 进行开发，这种以 <strong>既有原生，又有 Flutter</strong> 的开发模式就称之为 Flutter 混合开发模式。该开发模式的好处体现在，不用全面推翻 APP 项目的原有积累， Native 端就可以无感接入 Flutter ，开始 Flutter 开发，拥抱 Flutter 的特性特点。</p> 
</blockquote> 
<h2 id="1.FlutterBoost%20%E7%AE%80%E4%BB%8B">1.FlutterBoost 简介</h2> 
<p>        <strong><a href="https://github.com/alibaba/flutter_boost" title="FlutterBoost">FlutterBoost</a></strong> 是阿里系闲鱼技术团队开源的 Flutter 插件，它可以轻松为现有原生应用程序提供 <strong>Flutter 混合集成方案</strong>。其理念是将 Flutter 像 WebView 那样来使用。FlutterBoost 帮开发者处理 Native 与 Flutter 页面的映射和跳转，开发者只需关心页面的名字和参数即可 ( 通常可以是 URL ) 。</p> 
<blockquote> 
 <p><strong>FlutterBoost 的优点</strong></p> 
 <ul><li>官方的集成方案有诸多弊病，eg：日志不能输出到原生端、存在内存泄漏的问题、资源冗余……</li><li>FlutterBoost 的通道的封装使得 Native 调用 Flutter 、Flutter 调用 Native 的开发更加简便</li><li>FlutterBoost 对于页面生命周期的管理，也梳理的比较整齐</li><li>FlutterBoost 为阿里出品，已在闲鱼生产环境中使用，正稳定为亿级用户提供服务</li></ul> 
</blockquote> 
<h2></h2> 
<h2 id="2.FlutterBoost%20%E9%9B%86%E6%88%90%20(%20%E7%89%88%E6%9C%AC%201.17.1%20)">2.FlutterBoost 集成 ( 版本 1.17.1 )</h2> 
<h3 id="2.1%20Flutter%20%E7%AB%AF%E9%9B%86%E6%88%90">2.1 Flutter 端集成</h3> 
<p>        通过 <strong>IDE </strong>创建 <strong>Flutter Module</strong> ，命名为 <strong>flutter_module</strong> ( 本示例使用的是 <strong>Android Studio </strong>，也可以通过别的 IDE 或命令台方式创建 Flutter Module ) </p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" src="https://images2.imgbox.com/75/3b/Jj3dVrxb_o.png"> 
  <figcaption>
    2.1-1 通过 Android Studio 创建 Flutter Module 
  </figcaption> 
 </figure> 
</div> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" src="https://images2.imgbox.com/b0/b5/FUKmnN2J_o.png" width="582"> 
  <figcaption>
    2.1-2 通过 Android Studio 创建 Flutter Module 
  </figcaption> 
 </figure> 
</div> 
<p>        使用 IDE 打开上面步骤创建的 Flutter Module，在根目录 <strong>pubspec.yaml</strong> 文件中的 <strong>dependencies :</strong> 下添加 <strong>FlutterBoost</strong> 依赖  <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/flutter_module/pubspec.yaml" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<pre><code class="language-html">#闲鱼 flutter_boost
flutter_boost:
  git:
    url: 'https://github.com/alibaba/flutter_boost.git'
    ref: '1.17.1'</code></pre> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="500" src="https://images2.imgbox.com/c9/b6/tUkFZw4l_o.png" width="900"> 
  <figcaption>
    2.1-3 添加 FlutterBoost 依赖 
  </figcaption> 
 </figure> 
</div> 
<p>        通过命令 <strong>flutter build apk</strong> 来检查是否完成 FlutterBoost 的依赖，成功示意图如下</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="334" src="https://images2.imgbox.com/96/64/WerPzx4Q_o.png" width="900"> 
  <figcaption>
    2.1-4 测试是否集成成功 
  </figcaption> 
 </figure> 
</div> 
<h3 id="2.2%20Android%20%E7%AB%AF%E9%9B%86%E6%88%90">2.2 Android 端集成</h3> 
<p>        新建 Android 项目或在原有 Android 项目（本示例中的 Android 项目名为 <strong>AndroidDemo</strong> ）的根目录中的 <strong>settings.gradle</strong> 内引用上一个步骤创建的 <strong>Flutter Module</strong> ，代码如下 ( PS ：文件名与路径请视实际情况调整 ) <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/settings.gradle" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<pre><code class="language-Groovy">//引用 Flutter 模块
setBinding(new Binding([gradle:this]))
evaluate(new File('../flutter_module/.android/include_flutter.groovy'))
include ':flutter_module'
project(':flutter_module').projectDir = new File('../flutter_module')</code></pre> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="367" src="https://images2.imgbox.com/cb/e1/xi0kcqpa_o.png" width="900"> 
  <figcaption>
    2.2-1 Androud 端引用 Flutter Module 
  </figcaption> 
 </figure> 
</div> 
<p>        本示例中对应的文件路径/层级关系如下图</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="179" src="https://images2.imgbox.com/7b/19/7P0DvBg7_o.png" width="445"> 
  <figcaption>
    2.2-2 文件路径/层级关系 
  </figcaption> 
 </figure> 
</div> 
<p>        添加完成后编译项目，<strong>sync now</strong>，完成后得到如下项目结构，项目中多出了 flutter、flutter_boost 和 flutter_module</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="324" src="https://images2.imgbox.com/8a/52/drTR35Ig_o.png" width="900"> 
  <figcaption>
    2.2-3 编译后的项目结构 
  </figcaption> 
 </figure> 
</div> 
<p>        接着完成 Android 端 FlutterBoost 的依赖，在 <strong>app</strong> 下的 <strong>build.gradle</strong> 中的 <strong>dependencies</strong> 下添加 <strong>FlutterBoost</strong> 依赖并同步 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/build.gradle" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="489" src="https://images2.imgbox.com/47/a3/50eIVpIw_o.png" width="900"> 
  <figcaption>
    2.2-4 Android 端依赖 FlutterBoost 
  </figcaption> 
 </figure> 
</div> 
<p>        以上操作就完成了Android 端 Flutter Module 和 FlutterBoost 的引用和依赖，因为 iOS 端的引用需要在 macOS 上操作，故在此不做演示 。</p> 
<p></p> 
<h2 id="3.FlutterBoost%20%E4%BD%BF%E7%94%A8">3.FlutterBoost 使用</h2> 
<p><em>        只介绍 Android 端和 Flutter 端的相互调用，因当前操作系统为 Windows 而非 macOS 所以未包含 iOS 端。</em></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="667" src="https://images2.imgbox.com/a0/3a/Dm4MmCZH_o.gif" width="300"> 
  <figcaption>
    3. 效果演示 
  </figcaption> 
 </figure> 
</div> 
<p>主要讲解如下功能点的实现：</p> 
<ul><li><strong>FlutterBoost 的初始化</strong></li><li><strong>基于 FlutterBoost 实现 Native 启动 Flutter 页面，携带请求参数并接收返回结果</strong></li><li><strong>基于 FlutterBoost 实现 Flutter 启动 Native 页面，携带请求参数并接收返回结果</strong></li><li><strong>基于 FlutterBoost 实现 Flutter 启动 Flutter 页面，携带请求参数并接收返回结果</strong></li></ul> 
<h3 id="3.1%20FlutterBoost%20%E5%88%9D%E5%A7%8B%E5%8C%96">3.1 FlutterBoost 初始化</h3> 
<h4 id="3.1.1%20Android%20%E7%AB%AF%E5%88%9D%E5%A7%8B%E5%8C%96">3.1.1 Android 端初始化</h4> 
<p>        1.在 <strong>AndroidManifest.xml</strong> 中添加配置 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/AndroidManifest.xml" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<pre><code class="language-XML">&lt;!-- FlutterBoost 配置 --&gt;
&lt;meta-data
    android:name="flutterEmbedding"
    android:value="2" /&gt;</code></pre> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="448" src="https://images2.imgbox.com/b8/4a/thki6PfO_o.png" width="900"> 
  <figcaption>
    3.1.1-1 Android 端添加 FlutterBoost 配置 
  </figcaption> 
 </figure> 
</div> 
<p>        2.自定义 <strong>Application</strong> ，并在 <strong>onCreate</strong> 方法中初始化 <strong>FlutterBoost</strong> <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/java/com/ziwenl/androiddemo/base/BaseApplication.kt" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a>  </p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="621" src="https://images2.imgbox.com/fd/d6/FdBttBuO_o.png" width="900"> 
  <figcaption>
    3.1.1-2 Android 端初始化 FlutterBoost 
  </figcaption> 
 </figure> 
</div> 
<h4 id="3.1.2%20Flutter%20%E7%AB%AF%E5%88%9D%E5%A7%8B%E5%8C%96">3.1.2 Flutter 端初始化</h4> 
<p>        1.在 <strong>main.dart</strong> 中 <strong>AppWidget</strong> 的 <strong>State</strong> 的 <strong>initState ()</strong> 方法中注册 <strong>FlutterBoost</strong> ，并在 <strong>build</strong> 方法中初始化 <strong>FlutterBoost </strong><a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/flutter_module/lib/main.dart" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a> </p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="580" src="https://images2.imgbox.com/69/0e/1qQNFhbo_o.png" width="900"> 
  <figcaption>
    3.1.2-1 Flutter 端注册 FlutterBoost 并初始化 
  </figcaption> 
 </figure> 
</div> 
<h3 id="3.2%20Native%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Flutter%20%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C">3.2 Native 传参启动 Flutter 页面，并接收返回结果</h3> 
<p>        启动 <strong>Flutter</strong> 页面需要一个 <strong>Activity</strong> 作为载体，该载体应为 <strong>BoostFlutterActivity</strong> 或其子类，所以有两种方式启动 Flutter 页面。</p> 
<p>1.单纯通过 <strong>BoostFlutterActivity</strong> 启动 <strong>Flutter</strong> 页面</p> 
<p>       1.1 在 <strong>AndroidManifest.xml</strong> 注册 <strong>BoostFlutterActivity</strong> <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/AndroidManifest.xml" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="170" src="https://images2.imgbox.com/89/12/VbarFUlb_o.png" width="900"> 
  <figcaption>
    3.2.1-1 注册 BoostFlutterActivity 
  </figcaption> 
 </figure> 
</div> 
<p>       1.2 根据设定的 <strong>路由地址( 该地址应与 Flutter Module 中设定的保持一致 )</strong> 跳转启动 <strong>Flutter</strong> 页面，这里封装成方法 <strong>openPageByUrl</strong> <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/java/com/ziwenl/androiddemo/router/PageRouter.kt" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<pre><code class="language-Kotlin">                    //跳转 Flutter 页面
                    val intent =
                        BoostFlutterActivity.withNewEngine().url(url)
                            .params(requestParams ?: mutableMapOf())
                            .backgroundMode(BoostFlutterActivity.BackgroundMode.opaque)
                            .build(context)
                    if (context is Activity) {
                        context.startActivityForResult(intent, requestCode)
                    } else {
                        context.startActivity(intent)
                    }</code></pre> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="592" src="https://images2.imgbox.com/eb/40/pgvYxVf2_o.png" width="900"> 
  <figcaption>
    3.2.1-2 启动 Flutter 页面 
  </figcaption> 
 </figure> 
</div> 
<p>       1.3 在启动 <strong>openPageByUrl</strong> 方法的 <strong>Activity</strong> 上重写 <strong>onActivityResult</strong> 方法接收回调</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="258" src="https://images2.imgbox.com/2b/55/L2PmLsMV_o.png" width="900"> 
  <figcaption>
    3.2.1-3 注册回调监听 
  </figcaption> 
 </figure> 
</div> 
<p>2.通过自定义 <strong>Activity</strong> 继承 <strong>BoostFlutterActivity</strong> 为载体启动 <strong>Flutter</strong> 页面</p> 
<p>       2.1 自定义 <strong>FlutterPageActivity</strong> 继承 <strong>BoostFlutterActivity</strong> 并重写 <strong>getContainerUrlParams ()</strong> 、 <strong>getContainerUrl ()</strong> 和 <strong>onActivityResult</strong> 方法 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/java/com/ziwenl/androiddemo/FlutterPageActivity.kt" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="572" src="https://images2.imgbox.com/b4/e7/mqihjY4P_o.png" width="900"> 
  <figcaption>
    3.2.2-1 自定义 BoostFlutterActivity 
  </figcaption> 
 </figure> 
</div> 
<p>       2.2 启动 <strong>FlutterPageActivity</strong> ( 别忘了在 <strong>AndroidManifest.xml</strong> 中注册该 Activity )</p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="95" src="https://images2.imgbox.com/16/7e/H19Bz3E8_o.png" width="900"> 
  <figcaption>
    3.2.2-2 启动自定义 BoostFlutterActivity 
  </figcaption> 
 </figure> 
</div> 
<p>3.Flutter 端进行相应配置</p> 
<p>       3.1 在 <strong>main.adrt</strong> 的 <strong>FlutterBoost.singleton.registerPageBuilders</strong> 方法中注册 <strong>路由地址 ( 该地址应与 Native 层的保持一致 ) </strong>与其 <strong>对应的 Widget</strong> 并接收 <strong>请求数据 params </strong><a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/flutter_module/lib/main.dart" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a></p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="616" src="https://images2.imgbox.com/e0/2c/qrcmloPf_o.png" width="900"> 
  <figcaption>
    3.2.3-1 Flutter 端注册路由地址与其对应的页面 
  </figcaption> 
 </figure> 
</div> 
<p>       3.2 <strong>Widget </strong>中调用 <strong>FlutterBoost</strong> 提供的 <strong>closeCurrent</strong> 方法关闭当前 <strong>Flutter</strong> 页面并返回数据给上一个页面 <strong>( Flutter / Native )</strong>  </p> 
<div style="text-align:center;"> 
 <figure class="image"> 
  <img alt="" height="728" src="https://images2.imgbox.com/fd/90/y45gyavr_o.png" width="900"> 
  <figcaption>
    3.2.3-2 关闭当前 Flutter 页面并返回数据 
  </figcaption> 
 </figure> 
</div> 
<h3 id="3.3%20Flutter%20%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%20Native%20%2F%20Flutter%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%B9%B6%E6%8E%A5%E6%94%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C">3.3 Flutter 传参启动 Native / Flutter 页面，并接收返回结果</h3> 
<blockquote> 
 <p>当 Flutter 端通过 FlutterBoost 启动新的页面时，无论要启动的目标页面属于 Native 页面还是 Flutter 页面，其都只是触发 Native 端 ( 以 Android 端为例 ) <strong>INativeRouter</strong> 接口的 <strong>openContainer</strong> 回调，然后 Native 端在该回调方法中接收请求参数 <strong>urlParams </strong>，并根据 <strong>url </strong>控制是否启动及启动哪一个新页面。 </p> 
</blockquote> 
<h4 id="3.3.1%20Flutter%20%E7%AB%AF%E4%BC%A0%E5%8F%82%E5%90%AF%E5%8A%A8%E6%96%B0%E9%A1%B5%E9%9D%A2">3.3.1 Flutter 端传参启动新页面</h4> 
<p>1.Flutter 端启动新页面 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/flutter_module/lib/main.dart" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a> </p> 
<pre><code class="language-Kotlin">                  //启动新页面带请求参数和回调监听
                  Map&lt;String, dynamic&gt; requestParams = Map();
                  requestParams[HasRequestParamsNative.EXTRA_KEY_NATIVE] = "Hello native";
                  FlutterBoost.singleton
                      .open(Test.PAGE_NATIVE_HAS_RESULT,
                          urlParams: requestParams)
                      .then((Map&lt;dynamic, dynamic&gt; value) {
                    //TODO 回调监听 value 则是新页面返回的数据
                    
                  });</code></pre> 
<p> 2.Android 端在 FlutterBoost 初始化的时候，注册路由跳转监听，并在回调方法中判断启动新页面 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/java/com/ziwenl/androiddemo/base/BaseApplication.kt" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a> </p> 
<pre><code class="language-Kotlin">        //路由跳转监听
        val router = INativeRouter { context, url, urlParams, requestCode, exts -&gt;
            /**
             * 当 Flutter 中使用 FlutterBoost 启动新页面 (Flutter/Native) 时，触发该回调
             * 如果需要启动 Native 页面，则通过 context.startActivity 启动指定页面
             * 如果需要启动 Flutter 页面，则通过 FlutterBoost 启动指定页面
             */
            //TODO 判断启动新页面
            //PageRouter.openPageByUrl(context, url, urlParams, requestCode)
        }

        val platform = FlutterBoost.ConfigBuilder(this, router)
            .isDebug(true)
            .whenEngineStart(FlutterBoost.ConfigBuilder.ANY_ACTIVITY_CREATED)
            .renderMode(FlutterView.RenderMode.texture)
            .lifecycleListener(boostLifecycleListener)
            .build()
        FlutterBoost.instance().init(platform)</code></pre> 
<h4 id="3.3.2%20Android%20%E7%AB%AF%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E7%BB%99%E4%B8%8A%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2%C2%A0(%20%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%AC%E6%9F%A5%E7%9C%8B%E6%BA%90%E7%A0%81%20)%C2%A0">3.3.2 Android 端返回数据给上一个页面 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/AndroidDemo/app/src/main/java/com/ziwenl/androiddemo/router/PageRouter.kt" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a> </h4> 
<pre><code class="language-Kotlin">        /**
         * 关闭当前页面并返回数据至 Flutter 页面
         * @param resultData 返回数据
         */
        fun finishAndResult(activity: Activity, resultData: MutableMap&lt;String, Any&gt;? = null) {
            val intent = Intent()
            val bundle = Bundle()
            bundle.putSerializable(
                IFlutterViewContainer.RESULT_KEY,
                (resultData ?: mutableMapOf()) as Serializable
            )
            intent.putExtras(bundle)
            activity.setResult(0, intent)
            activity.finish()
        }</code></pre> 
<h4 id="3.3.3%20Flutter%20%E7%AB%AF%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E7%BB%99%E4%B8%8A%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2%C2%A0(%20%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%AC%E6%9F%A5%E7%9C%8B%E6%BA%90%E7%A0%81%20)%C2%A0">3.3.3 Flutter 端返回数据给上一个页面 <a href="https://github.com/ziwenL/FlutterBoostDemo/blob/main/flutter_module/lib/main.dart" title="( 点击跳转查看源码 )">( 点击跳转查看源码 )</a> </h4> 
<pre><code class="language-Kotlin">                  // FlutterBoost 关闭当前页面并回调数据给上一个页面
                  var resultMap = Map&lt;String, dynamic&gt;();
                  resultMap[HasResult.EXTRA_KEY_NAME] = "张先生";
                  resultMap[HasResult.EXTRA_KEY_AGE] = 26;
                  FlutterBoost.singleton.closeCurrent(result: resultMap);</code></pre> 
<h2></h2> 
<h2 id="4.%E6%9C%80%E5%90%8E">4.最后</h2> 
<p>        因为发现现阶段 FlutterBoost 的集成与使用文档较少或较旧，所以本文主要讲原生项目如何借助 FlutterBoost 集成 Flutter 开始混合开发，基于 FlutterBoost 的 Flutter 与 Native 的基础交互也已详细交代清楚。</p> 
<p>        针对那些还对 Flutter 开发持观望态度的开发人员来说，建议可以借着 FlutterBoost 的简洁便利，试着把项目从原生项目开始尝试 Flutter 开发，同时让自己从原生开发人员开始兼职 Flutter 开发人员，拥抱和体验 " 新 " 技术。</p> 
<ul><li>源码及 Demo 地址：<a href="https://github.com/ziwenL/FlutterBoostDemo" title="GitHub - ziwenL/FlutterBoostDemo: 闲鱼 FlutterBoost 的集成与基本使用示例">GitHub - ziwenL/FlutterBoostDemo: 闲鱼 FlutterBoost 的集成与基本使用示例</a></li><li>如有更好的见解或建议，欢迎留言</li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d89a60881a28a0124bb3cac622e19d30/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">element ui中改变某一行或者单元格的颜色</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4af94a2af0c56a8632580b4f0976e4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux下无人值守安装脚本kickstart</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>