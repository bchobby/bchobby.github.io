<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gitlab&#43;jenkins持续集成CICD服务部署详细篇 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gitlab&#43;jenkins持续集成CICD服务部署详细篇" />
<meta property="og:description" content="gitlab安装 GitLab简介
GitLab 是一个用于仓库管理系统的开源项目。使用Git作为代码管理工具，并在此基础上搭建起来的web服务。可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wal1)进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用。常用的网站:
官网:GitLab最新版下载安装_GitLab中文免费版-极狐GitLab中文官方网站
国内镜像:https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/安装环境:
1、Centos 6或者7
2、2G内存(实验)生产(至少4G)
3、 安装包:gitlab-ce-10.2.2-ce 4 、禁用防火墙，关闭selinux
1. 安装和配置必须的依赖项
在 CentOS 7上，下面的命令也会在系统防火墙中打开 HTTP、HTTPS 和 SSH 访问。这是一个可选步骤，如果您打算仅从本地网络访问极狐GitLab，则可以跳过它。
sudo yum install -y curl policycoreutils-python openssh-server perl #上面这个是最重要的 sudo systemctl enable sshd sudo systemctl start sshd sudo firewall-cmd --permanent --add-service=http sudo firewall-cmd --permanent --add-service=https sudo systemctl reload firewalld 2.（可选）下一步，安装 Postfix 以发送电子邮件通知。如果您想使用其他解决方案发送电子邮件，请跳过此步骤并在安装极狐GitLab 后配置外部 SMTP 服务器。
sudo yum install postfix sudo systemctl enable postfix sudo systemctl start postfix 在安装 Postfix 的过程中可能会出现一个配置界面，在该界面中选择“Internet Site”并按下回车。把“mail name”设置为您服务器的外部 DNS 域名并按下回车。如果还有其它配置界面出现，继续按下回车以接受默认配置。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/440056f87c3877a01c9a061e7b4bb546/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-20T11:16:45+08:00" />
<meta property="article:modified_time" content="2022-07-20T11:16:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gitlab&#43;jenkins持续集成CICD服务部署详细篇</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><strong>gitlab安装</strong></h2> 
<p>GitLab简介<br> GitLab 是一个用于仓库管理系统的开源项目。使用Git作为代码管理工具，并在此基础上搭建起来的web服务。可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wal1)进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用。常用的网站:<br> 官网:<a href="https://gitlab.cn/install/" rel="nofollow" title="GitLab最新版下载安装_GitLab中文免费版-极狐GitLab中文官方网站">GitLab最新版下载安装_GitLab中文免费版-极狐GitLab中文官方网站</a><br> 国内镜像:https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/安装环境:<br> 1、Centos 6或者7<br> 2、2G内存(实验)生产(至少4G)<br> 3、 安装包:gitlab-ce-10.2.2-ce <br> 4 、禁用防火墙，关闭selinux<img alt="" height="642" src="https://images2.imgbox.com/2d/3c/KUhIrTW9_o.png" width="1200"></p> 
<p>1. 安装和配置必须的依赖项</p> 
<p>在 CentOS 7上，下面的命令也会在系统防火墙中打开 HTTP、HTTPS 和 SSH 访问。这是一个可选步骤，如果您打算仅从本地网络访问极狐GitLab，则可以跳过它。</p> 
<pre><code class="language-bash">sudo yum install -y curl policycoreutils-python openssh-server perl
#上面这个是最重要的
sudo systemctl enable sshd
sudo systemctl start sshd
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo systemctl reload firewalld</code></pre> 
<p>2.（可选）下一步，安装 Postfix 以发送电子邮件通知。如果您想使用其他解决方案发送电子邮件，请跳过此步骤并在安装极狐GitLab 后<a href="https://docs.gitlab.cn/omnibus/settings/smtp.html" rel="nofollow" title="配置外部 SMTP 服务器">配置外部 SMTP 服务器</a>。</p> 
<pre><code class="language-bash">sudo yum install postfix
sudo systemctl enable postfix
sudo systemctl start postfix</code></pre> 
<p>在安装 Postfix 的过程中可能会出现一个配置界面，在该界面中选择“Internet Site”并按下回车。把“mail name”设置为您服务器的外部 DNS 域名并按下回车。如果还有其它配置界面出现，继续按下回车以接受默认配置。</p> 
<p>3. 下载/安装极狐GitLab</p> 
<p>配置极狐GitLab 软件源镜像。</p> 
<pre><code class="language-bash">curl -fsSL https://packages.gitlab.cn/repository/raw/scripts/setup.sh | /bin/bash</code></pre> 
<p>4.接下来，安装极狐GitLab。确保您已正确<a href="https://docs.gitlab.cn/omnibus/settings/dns.html" rel="nofollow" title="设置您的 DNS">设置您的 DNS</a>，并更改 https://gitlab.example.com 为您要访问极狐GitLab 实例的 URL。安装包将在该 URL 上自动配置和启动极狐GitLab。</p> 
<p>对于 <code>https</code> 站点，极狐GitLab 将使用 Let's Encrypt 自动请求 SSL 证书，这需要有效的主机名和入站 HTTP 访问。您也可以使用自己的证书或仅使用 <code>http://</code>（不带<code>s</code>）。</p> 
<p>如果您想为初始管理员用户(<code>root</code>)指定自定义密码，请查看<a href="https://docs.gitlab.cn/omnibus/installation/index.html#%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%AF%86%E7%A0%81" rel="nofollow" title="文档">文档</a>。如果未指定密码，将自动生成随机密码。</p> 
<p>执行如下命令开始安装：</p> 
<pre><code class="language-bash">sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-jh
#可要可不要，我在安装的时候没输出</code></pre> 
<p>根据上面操作完后，检查一下依赖包得安装是否成功</p> 
<pre><code class="language-bash">rpm -qa|egrep "policycoreutils-python|openssh-server|curl"</code></pre> 
<p><img alt="" height="92" src="https://images2.imgbox.com/1d/9b/IGsTy5s7_o.png" width="564"></p> 
<p> 然后在修改一下它得配置文件，这里可以更改一下地址www.wjk.com，我这里使用的是域名，也可以使用IP地址看个人喜欢，但是后面需要去hosts解析一下</p> 
<pre><code class="language-bash">vim /etc/gitlab/gitlab.rb</code></pre> 
<p><img alt="" height="381" src="https://images2.imgbox.com/d4/64/lReQwYac_o.png" width="589"></p> 
<p>进入到自己电脑里面的hosts<img alt="" height="679" src="https://images2.imgbox.com/42/6e/zALBjDFl_o.png" width="1200"></p> 
<p>完成之后我们现在再来安装gitlab-ce，官网<a href="https://packages.gitlab.com/gitlab/gitlab-ce" rel="nofollow" title="gitlab/gitlab-ce - Packages · packages.gitlab.com">gitlab/gitlab-ce - Packages · packages.gitlab.com</a></p> 
<p>点击你要选择得版本，我这里选择的是14.10.5，成功后会得到一个狐狸头这样的</p> 
<pre><code class="language-bash">wget --content-disposition https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-14.10.5-ce.0.el7.x86_64.rpm/download.rpm</code></pre> 
<p>在解压</p> 
<pre><code class="language-bash">rpm -i gitlab-ce-14.10.5-ce.0.el7.x86_64.rpm</code></pre> 
<p><img alt="" height="565" src="https://images2.imgbox.com/de/bf/wUZMNo2i_o.png" width="672"></p> 
<p>紧接着在敲，这个就是重新配置的结果图</p> 
<pre><code class="language-bash">gitlab-ctl reconfigure ---重新配置得

gitlab-ctl status ---先查看状态</code></pre> 
<p><img alt="" height="391" src="https://images2.imgbox.com/d3/08/qb3ipz9j_o.png" width="606"></p> 
<p> 然后点开我们刚刚配置的域名:我配置的是www.wjk.com</p> 
<p><img alt="" height="555" src="https://images2.imgbox.com/78/e5/cht0my6K_o.png" width="1200"></p> 
<p> 这里账号我是默认root密码可以去cd /etc/gitlab查看文件是init开头的里面会有一个随机密码，不过只会保留24小时我这里已经过期了所以没有显示<img alt="" height="50" src="https://images2.imgbox.com/31/18/JlNXCz6g_o.png" width="364"></p> 
<p> 知识点：</p> 
<p>下载好的gitlab都放在/opt/gitlab</p> 
<p>这里是各个存放数据得点<img alt="" height="381" src="https://images2.imgbox.com/45/01/0u9PVp9n_o.png" width="1098"></p> 
<p><img alt="" height="228" src="https://images2.imgbox.com/4e/34/582qCCgb_o.png" width="499"> </p> 
<p>输入刚刚修改得gitlab配置文件得地址www.wjk.com打开后输入一个账号密码</p> 
<p>也可以进行汉化<img alt="" height="370" src="https://images2.imgbox.com/05/cd/QPPPH00c_o.png" width="1010"></p> 
<h2></h2> 
<h2> gitlab使用</h2> 
<p>进入以后点击这个Admin </p> 
<p><img alt="" height="879" src="https://images2.imgbox.com/b3/45/MB3jgOxU_o.png" width="1200"></p> 
<p>进去公司如果没有gitlab就要先创建组，组里面有人员，再把项目添加到组里面，那这个组里面的所有人就可以访问这个项目了<img alt="" height="254" src="https://images2.imgbox.com/05/39/avuFgxQo_o.png" width="595"></p> 
<p><img alt="" height="704" src="https://images2.imgbox.com/40/6e/5PK2lkq5_o.png" width="1200"> 按照要求输入名称和描述，再点击保存即可<img alt="" height="902" src="https://images2.imgbox.com/b6/2d/tKDkmJep_o.png" width="1200"></p> 
<p> 这个时候在点击我们的项目，这里面可以把我们创建的组添加到项目里面，就相当于你在公司要组建一个项目肯定需要小组，组员等，这里我们就直接部署与jenkins的小项目<img alt="" height="707" src="https://images2.imgbox.com/50/59/TbfwrfwG_o.png" width="1200"></p> 
<p> 点击这里导入</p> 
<p> <img alt="" height="756" src="https://images2.imgbox.com/3c/15/n7XqoZqK_o.png" width="1200"></p> 
<p> 这里我们按照步骤进行项目导入</p> 
<pre><code class="language-bash">https://gitee.com/skips/game.git</code></pre> 
<p><img alt="" height="886" src="https://images2.imgbox.com/cf/43/qtdOzrmc_o.png" width="1200"></p> 
<p>然后就开始加载了 </p> 
<p><img alt="" height="782" src="https://images2.imgbox.com/0e/54/6vlYGdQ6_o.png" width="1200"></p> 
<p> 如果你放的是test的组那这里就是test<img alt="" height="845" src="https://images2.imgbox.com/77/d7/qtJZII3E_o.png" width="1200"></p> 
<p>配置jenkins的公钥，进入账号根下<img alt="" height="354" src="https://images2.imgbox.com/f3/cb/STLWSmPI_o.png" width="723"></p> 
<p><img alt="" height="151" src="https://images2.imgbox.com/3e/ea/nwmnjdtp_o.png" width="173"> </p> 
<p>在这输入jenkins这台服务器上的公钥，可以先进入cd .ssh然后使用cat id_dsa.pub进行查看</p> 
<p><img alt="" height="785" src="https://images2.imgbox.com/92/41/wtY6pnoZ_o.png" width="1200"></p> 
<p><img alt="" height="153" src="https://images2.imgbox.com/d5/cb/sjG3jMAX_o.png" width="607"></p> 
<p> <strong>上面在gitlab的部署就已经完成了，下面的是补充一下gitlab的一些知识点</strong></p> 
<p></p> 
<p>1.秘钥远程登录服务器实现免密登录实战</p> 
<p>想要打通的过去的这台主机：</p> 
<p>1）dsa建立私钥和公钥（一直回车）</p> 
<pre><code class="language-bash">ssh-keygen -t</code></pre> 
<p>2）创建ssh目录:</p> 
<pre><code class="language-bash">mkdir /ssh 
#在
cd .ssh</code></pre> 
<p>3）</p> 
<pre><code class="language-bash">ssh-copy-id -i /root/.ssh/id_dsa.pub root@192.168.174.138</code></pre> 
<p>4）检查一下是否打通ssh 192.168.174.138<img alt="" height="225" src="https://images2.imgbox.com/51/d6/cJMQPOoJ_o.png" width="557"></p> 
<p>需要被打通的主机：</p> 
<p>1）需要在第3把打通过去之前新建文件：</p> 
<pre><code class="language-bash">mkdir .ssh</code></pre> 
<p>2）新建文件：</p> 
<pre><code class="language-bash">touch authorized_keys</code></pre> 
<p>3）附加权限：</p> 
<pre><code class="language-bash">chmod 600 authorized_keys</code></pre> 
<p>4）建立私钥公钥：</p> 
<pre><code class="language-bash">ssh-keygen -t dsa</code></pre> 
<p> 2.然后我们还可以在gitlab里面改一下密码，防止那个系统密码过了24小时就自动消失<img alt="" height="548" src="https://images2.imgbox.com/4d/bd/EDkdjYek_o.png" width="1200"></p> 
<p> 这里输入你的账号密码即可<img alt="" height="525" src="https://images2.imgbox.com/9f/b6/OgaZXzXW_o.png" width="1198"></p> 
<p>3.假如你们开发或者其他人想加入到你这个项目里面来，你要怎么给他附赠权限呢<img alt="" height="753" src="https://images2.imgbox.com/d2/59/Mt5nXY9D_o.png" width="1200"></p> 
<p> 这里输入三段，创建完成后在进入到组里面给他权限<img alt="" height="896" src="https://images2.imgbox.com/dc/fd/0tRxdbKq_o.png" width="1200"></p> 
<p> <img alt="" height="907" src="https://images2.imgbox.com/19/6d/wVnn1xWM_o.png" width="1200"></p> 
<p>在这里选择权限添加即可<img alt="" height="708" src="https://images2.imgbox.com/24/92/wgfpYItB_o.png" width="1200"> 上面就是gitlab的全部内容了，总结一下：</p> 
<p>首先在我们本地服务器上搭建gitlab，这个gitlab服务器要想使用，必须要把自己的这台服务器上的管理员root的公钥放在SSH key里面它就可以下载了，如果开发想使用，就单独开用户，比如dev用户，这个属于gitlab的普通用户，当我们写好新的功能，或者代码就要网gitlab上进行推送，那gitlab有两个分支，一个是master一个是dev分支，我们的开发一般都把功能上传到专门的dev分支上，master都是上传我们最新版本的，类环境的，dev自己把有权限的代码拽到本地，再用checkout -b在分支上创建一个新的分支，再到分支上写入新的功能，在提交，在申请一个和并请求，申请到master。</p> 
<p></p> 
<h2>jenkins安装</h2> 
<p> </p> 
<p>官网<a href="https://www.jenkins.io/zh/" rel="nofollow" title="Jenkins">Jenkins</a>是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。</p> 
<p>1.安装准备</p> 
<p>装备两台服务器 关闭selinux和防火墙内存2G 50G+硬盘，这里面jenkins和gitlab不要放在同一台服务器上，同时它的内存是2G以上哈</p> 
<p>jenkins 10.0.0.201</p> 
<p>nexus 10.0.0.202</p> 
<p>开始安装</p> 
<p>1.安装 epel-release</p> 
<pre><code class="language-bash"> yum  -y install epel-release</code></pre> 
<p>2.安装 daemonize</p> 
<pre><code class="language-bash">yum -y install daemonize</code></pre> 
<p>3.清华源直接下载rpm包安装即可,下载地址如下：</p> 
<p>https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat/</p> 
<p>这里是链接：https://pan.baidu.com/s/1E1cY3Ptkl-4IB5m3d3DJBA <br> 提取码：fs7m <br> 然后安装好以后拖进来可以在root下，如果脱不进来可以使用安装lrzsz</p> 
<pre><code class="language-bash">yum install -y lrzsz</code></pre> 
<p>然后在解压</p> 
<pre><code class="language-bash">rpm -ivh jenkins-2.315-1.1.noarch.rpm</code></pre> 
<h3>安装jdk</h3> 
<pre><code class="language-bash">yum install java-11-openjdk</code></pre> 
<p>配置使用root账号运行</p> 
<pre><code class="language-bash">vim /etc/sysconfig/jenkins
JENKINS_USER="root"</code></pre> 
<p>启动：</p> 
<pre><code class="language-bash">systemctl start jenkins</code></pre> 
<p>这个文件是jenkins的war包所以以后升级直接把文件丢在这里就好了</p> 
<pre><code class="language-bash">[root@138 ~]# ll /usr/lib/jenkins/
total 70460
-rw-r--r--. 1 root root 72148539 Oct  7  2021 jenkins.war</code></pre> 
<p>2.jenkins主要的目录</p> 
<p>/usr/lib/jenkins/:jenkins安装目录，WAR包会放在这里</p> 
<p>/etc/sysconfig/ienkins:jenkins配置文件“端口”“JENKINS HOME”等都可以在这里配置</p> 
<p>/var/lib/jerkins/:默认的JENKINS HOME</p> 
<p>/var/log/jenkins/jenkins.log:Jenkins日志文件</p> 
<p></p> 
<h2>jenkins使用</h2> 
<h3>第1章 解锁Jenkins</h3> 
<p><img alt="" height="553" src="https://images2.imgbox.com/38/12/c5wcZr5Y_o.png" width="1200"></p> 
<p>把上面那段代码复制下来 </p> 
<h3>修改admin密码<img alt="" height="912" src="https://images2.imgbox.com/90/21/VN5ZXJHc_o.png" width="1200"></h3> 
<h3>使用清华源作为插件地址</h3> 
<p>清华源地址：</p> 
<pre><code class="language-bash">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></pre> 
<p> 配置步骤：<img alt="" height="585" src="https://images2.imgbox.com/05/e5/elQSvWu0_o.png" width="659"></p> 
<p><img alt="" height="349" src="https://images2.imgbox.com/80/6c/f8TDwygP_o.png" width="624"> </p> 
<h3>使用离线安装插件</h3> 
<p>我们可以将插件提前下好，然后只需要解压到jenkins对应的目录即可</p> 
<p>链接：https://pan.baidu.com/s/1ELWPbZleTTSmQRlR3u4e6A <br> 提取码：nila </p> 
<pre><code class="language-bash">tar zxf jenkins_plugins.tar.gz -C /var/lib/jenkins/
ll /var/lib/jenkins/plugins/</code></pre> 
<p>重启jenkins：</p> 
<pre><code class="language-bash">systemctl restart jenkins</code></pre> 
<h2>第2章 在jenkins中关联gitlab的h5game项目</h2> 
<h3> 创建新项目<img alt="" height="718" src="https://images2.imgbox.com/27/9b/IL41LBHw_o.png" width="1200"></h3> 
<p> <img alt="" height="433" src="https://images2.imgbox.com/9e/a1/ivTe5tMg_o.png" width="1163"></p> 
<p> </p> 
<h4>填写仓库地址</h4> 
<p>选择源码管理，然后填写gitlab仓库信息<img alt="" height="895" src="https://images2.imgbox.com/8a/06/SuJBq1Z3_o.png" width="1200"></p> 
<p> 但是如果我们发现报错了，因为jenkins没有拉取gitlab项目的权限。如果没有就不用管直接创建就好<img alt="" height="903" src="https://images2.imgbox.com/df/f2/Jq3cbCiw_o.png" width="1200"></p> 
<h3>3.配置jenkins访问gitlab的权限</h3> 
<h4>1 部署公钥解释和步骤</h4> 
<p> 解释</p> 
<pre><code>1.如果我们想让jenkins从gitlab上拉取代码，那么需要将jenkins的公钥信息放在gitlab上。
2.gitlab针对这种情况有一个专门的功能，叫做部署部署公钥。
3.部署公钥的作用是不需要创建虚拟用户和组，直接在需要拉取的项目里关联部署公钥即可。</code></pre> 
<p>步骤</p> 
<pre><code>1.获取jenkins公钥信息
2.将jenkins公钥信息填写到gitlab的部署公钥里
3.由项目管理员操作，在需要jenkins拉取的项目里关联部署公钥
4.jenkins配置私钥凭证，部署项目时关联凭证</code></pre> 
<h4>获取jenkins服务器的SSH公钥信息</h4> 
<pre><code>[root@jenkins-201 ~]# cat .ssh/id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCg8+DQFOjR+gl1Xw83CIyGJ50vI4DBeTaMRFdu5+5pT/IMnYq1iS7/lRS6JxXLYvVeNMDUfDxA1sOL70okyA3npjASXgJPGE1FsbpqzWjsN0TAGoZkR1VWuP9Yn0CrH7dA4lhZQfUUVjvqzFBZK8N9iZMzIu6KOiSY/aD4Ol59vbDS4kO0rTG1DYQNnjZzMPNlIiJ+0EVkfuYRwABRFA8fmL+6btqZqhjGY29EHuIfzIMTDTysrtCTGxQn2ql1zwjReGiNXzmFncwvyy92DAuMbnOQiE1YNn72wThy2oWSHsCwKdIvcNHqY2xBvFnkZ9Ltga7PgR33kbJ7Gl8tjiZF root@jenkins-201</code></pre> 
<h4>gitlab添加部署公钥（前面做了这里可以不要）<img alt="" height="909" src="https://images2.imgbox.com/5e/99/ff28KBSs_o.png" width="1200"></h4> 
<p><img alt="" height="839" src="https://images2.imgbox.com/2b/b0/iyYSbVF6_o.png" width="1200"> </p> 
<p><img alt="" height="541" src="https://images2.imgbox.com/ae/f2/9WJO7f4O_o.png" width="1200"> </p> 
<p>gitlab项目关联部署公钥 </p> 
<p><img alt="" height="695" src="https://images2.imgbox.com/bc/55/UqiI3PL7_o.png" width="1200"></p> 
<p> </p> 
<p><img alt="" height="922" src="https://images2.imgbox.com/5f/04/m1P2fHxI_o.png" width="1200"></p> 
<p> <img alt="" height="365" src="https://images2.imgbox.com/7e/a4/KWUxmhHq_o.png" width="1200"></p> 
<h4>jenkins配置私钥凭证</h4> 
<p><img alt="" height="791" src="https://images2.imgbox.com/6a/5b/Co89qadP_o.png" width="1200"></p> 
<p>通过cat id_rsa查看私钥</p> 
<p> <img alt="" height="370" src="https://images2.imgbox.com/b0/ca/ezyA8DEV_o.png" width="475"></p> 
<p><img alt="" height="765" src="https://images2.imgbox.com/62/c2/KapCX6t3_o.png" width="1200"></p> 
<p><img alt="" height="850" src="https://images2.imgbox.com/05/70/bh8T5I0u_o.png" width="1200"></p> 
<h4>测试获取代码</h4> 
<p><img alt="" height="724" src="https://images2.imgbox.com/8f/fd/twLC6RLi_o.png" width="1200"></p> 
<p><img alt="" height="755" src="https://images2.imgbox.com/b2/48/mbeF3vV6_o.png" width="801"> </p> 
<p><img alt="" height="410" src="https://images2.imgbox.com/c9/4e/7XMJguKG_o.png" width="635"> </p> 
<p>查看拉取的代码：</p> 
<pre><code>[root@jenkins-201 ~]# ll /var/lib/jenkins/workspace/h5game
总用量 16
drwxr-xr-x 4 jenkins jenkins   47 8月   6 09:37 game
-rw-r--r-- 1 jenkins jenkins 9349 8月   6 09:37 LICENSE
-rw-r--r-- 1 jenkins jenkins  937 8月   6 09:37 README.md</code></pre> 
<h3>编写部署脚本</h3> 
<p>其中这里面的IP地址是你要拉取的目标</p> 
<pre><code>#创建目录
mkdir -p /scripts/jenkins/

#编写脚本
cat &gt; /scripts/jenkins/deploy.sh &lt;&lt; 'EOF'
#!/bin/bash

PATH_CODE=/var/lib/jenkins/workspace/h5game/
PATH_WEB=/usr/share/nginx
TIME=$(date +%Y%m%d-%H%M)
IP=10.0.0.7

#打包代码
cd ${PATH_CODE} 
tar zcf /opt/${TIME}-web.tar.gz ./*

#拷贝打包好的代码发送到web服务器代码目录
ssh ${IP} "mkdir ${PATH_WEB}/${TIME}-web -p"
scp /opt/${TIME}-web.tar.gz ${IP}:${PATH_WEB}/${TIME}-web

#web服务器解压代码
ssh ${IP} "cd ${PATH_WEB}/${TIME}-web &amp;&amp; tar xf ${TIME}-web.tar.gz &amp;&amp; rm -rf ${TIME}-web.tar.gz"
ssh ${IP} "cd ${PATH_WEB} &amp;&amp; rm -rf html &amp;&amp; ln -s ${TIME}-web html"
EOF

#添加可执行权限
chmod +x /scripts/jenkins/deploy.sh</code></pre> 
<h3>jenkins调用构建脚本</h3> 
<p>在构建的位置填写执行shell脚本的命令<img alt="" height="932" src="https://images2.imgbox.com/e1/35/tYpRFjAF_o.png" width="1044"></p> 
<p>然后立即构建，发现报错了，提示权限不足：<img alt="" height="686" src="https://images2.imgbox.com/be/ef/n1i8yJeF_o.png" width="923"> 报错原因是因为jenkins是以jenkins用户运行的，所以提示权限不足，我们可以修改jenkins为root用户运行。</p> 
<pre><code>[root@jenkins-201 ~]# vim /etc/sysconfig/jenkins 
[root@jenkins-201 ~]# grep "USER" /etc/sysconfig/jenkins 
JENKINS_USER="root"
[root@jenkins-201 ~]# systemctl restart jenkins</code></pre> 
<p> 重启好之后我们重新构建一下：<img alt="" height="348" src="https://images2.imgbox.com/05/ca/T7YoCFfj_o.png" width="649"></p> 
<p>查看一下web服务器的代码目录 </p> 
<pre><code>[root@web-7 ~]# ll /usr/share/nginx/
总用量 0
drwxr-xr-x 3 root root 50 8月   6 10:13 20200806-1013-web
lrwxrwxrwx 1 root root 17 8月   6 10:13 html -&gt; 20200806-1013-web</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f90c26fe6411ccd93f4cd8e19f66b526/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux批量删除指定名称的文件夹</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b003b2a169992ee611478e9df278e7b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nacos 集群连接报错： Nacos cluster is running with 1.X mode</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>