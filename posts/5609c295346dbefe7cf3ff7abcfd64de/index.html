<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HIVE 0.14 Cost Based Optimizer (CBO) Technical Overview - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HIVE 0.14 Cost Based Optimizer (CBO) Technical Overview" />
<meta property="og:description" content="Analysts and data scientists⎯not to mention business executives⎯want Big Data not for the sake of the data itself, but for the ability to work with and learn from that data. As other users become more savvy, they also want more access. But too many inefficient queries can create a bottleneck in the system.
The good news is that Apache™ Hive 0.14—the standard SQL interface for processing, accessing and analyzing Apache Hadoop® data sets—is now powered by Apache Calcite." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/5609c295346dbefe7cf3ff7abcfd64de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-02-16T13:27:16+08:00" />
<meta property="article:modified_time" content="2016-02-16T13:27:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HIVE 0.14 Cost Based Optimizer (CBO) Technical Overview</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Analysts and data scientists⎯not to mention business executives⎯want Big Data not for the sake of the data itself, but for the ability to work with and learn from that data. As other users become more savvy, they also want more access. But too many inefficient queries can create a bottleneck in the system.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The good news is that <a target="_blank" href="http://hortonworks.com/hadoop/hive" rel="nofollow noopener noreferrer" title="apache hive" style="color:rgb(89,139,166)">Apache™ Hive 0.14</a>—the standard SQL interface for processing, accessing and analyzing Apache Hadoop® data sets—is now powered by <a target="_blank" href="http://calcite.incubator.apache.org/" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">Apache Calcite</a>. Calcite is an open source, enterprise-grade Cost-Based Logical Optimizer (CBO) and query execution framework.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The main goal of a CBO is to generate efficient execution plans by examining the tables and conditions specified in the query, ultimately cutting down on query execution time and reducing resource utilization. Calcite has an efficient plan pruner that can select the cheapest query plan. All SQL queries are converted by Hive to a physical operator tree, optimized and converted to Tez/MapReduce jobs, then executed on the Hadoop cluster. This conversion includes SQL parsing and transforming, as well as operator-tree optimization.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Query optimizers tend to have the biggest performance impact in a data warehouse system, since generating the right (or wrong) execution plan could mean the difference of seconds, minutes, or even hours in query execution time.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> <a target="_blank" href="http://hortonworks.com/blog/cost-based-optimizer-makes-apache-hive-0-14-more-than-2-5x-faster/" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)">Performance testing of Hive 0.14 shows an average speedup of 2.5 times</a> for TPC-DS benchmarked queries against a 30TB TPC-DS dataset. In our tests, total workload runtime shrank from 20.6 to 9 hours. In the current world of cloud computing, this improved performance directly translates into reduced operating costs.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> In this post, we will dig into how this CBO works, including the background and challenges of query optimization, such as cardinality estimation and join ordering. We’ll also provide in-depth analysis of TPC-DS 30TB results.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> The process of query optimization</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Within a CBO, a query undergoes four distinct phases of examination and evaluation:</p> 
<ol style="padding-left:20px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"><li style="margin-bottom:10px"><span style="">Parse and validate query</span> <p style="">The query is parsed, assuming the query is valid; the output of this phase is a logical tree (abstract syntax tree) that represents the operations that the query must perform, such as reading a particular table or performing an inner join.</p> </li><li style="margin-bottom:10px"><span style="">Generate possible execution plans</span> <p style="">Using the logical tree created in step one, the CBO will produce other logically equivalent plans that can also get to the answers you’re looking for, by applying equivalence rules. The current model favors bushy plans (for reasons explained in more detail below) and is execution-engine agnostic.</p> </li><li style="margin-bottom:10px"><span style="">For each logically equivalent plan, assign a cost</span> <p style="">The CBO will use number of distinct values-based heuristics to estimate selectivity and cardinality of each operator (to diminish the impact of inaccurate estimates during optimization) to calculate cost.</p> </li><li style="margin-bottom:10px"><span style="">Select the plan with the lowest estimated cost</span></li></ol> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Query optimizer challenges</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Two of the biggest difficulties to overcome in creating an efficient query are join optimization and table size when using <span style="">table</span> and <span style="">column statistics</span>. First, some definitions—then we’ll look at how Hive 0.14 CBO deals with these issues.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> A <span style="">join</span> combines rows from two tables by using the values of fields common to each of them. The order used to join tables greatly influences the intermediary data set size, which impacts performance. The number of possible join orders increases exponentially with the number of tables involved. Coming up with all possible join orders is not practically feasible. Hence, one of the main benefits of the query optimizer is the ability to find the most efficient join order. The join order in the execution plan is not defined by the order of the tables in the query.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The query optimizer considers two different types of trees: <span style="">left deep </span>and <span style="">bushy</span><br style=""> <span style="">Left deep:</span> All internal nodes of a left-deep tree have at least one leaf as a child. This is simple to implement, but doesn’t produce efficient plans for <a target="_blank" href="http://en.wikipedia.org/wiki/Snowflake_schema" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">snowflake schemas</a>.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_1.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/27/d6/R1CSFHDd_o.png" alt="cbo_1" width="392" height="367" class="aligncenter size-full wp-image-68045" style="border:0px; max-width:100%; vertical-align:middle; margin:10px 0px; height:auto"></a></p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> <span style="">Bushy trees:</span> When a join operates on two results of joins, as opposed to always having one table scan as input, you get a bushy tree. The join tree can take any shape. It is useful for snowflake schemas, as its search space is a lot bigger compared to left-deep trees. Bushy join trees also tend to contain subtrees that reduce intermediary data set size, and their joins with other subtrees tend to be more efficient than joins in the left-deep tree.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_2.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/f4/00/wE3PctG0_o.png" alt="cbo_2" width="466" height="314" class="aligncenter size-full wp-image-68046" style="border:0px; max-width:100%; vertical-align:middle; margin:10px 0px; height:auto"></a></p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The CBO uses column and table statistics stored in the Hive metastore to create query plans that improve query performance. Statistics for the CBO are objects that contain information about the columns and partitions of a table. The CBO uses these statistics to estimate the cardinality and number of distinct values, etc. These estimates then help generate highly efficient query plans.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Currently, the CBO uses and maintains table cardinality and boundary statistics: min, max, avg, and number of distinct values. In the absence of histograms, cardinality can be assumed to follow uniform distribution.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Plans generated by the CBO are only as good as the quality of the statistics, so having up-to-date statistics is crucial. In Hive 0.14, the statistics creation DDL (data definition language) has been simplified and performance has vastly<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/Column+Statistics+in+Hive" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">improved</a>.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> New CBO optimization in Hive 0.14</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> In Hive 0.14, we introduced new query optimization. Let’s take a look at these techniques and their impact on query optimization.</p> 
<ol style="padding-left:20px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"><li style="margin-bottom:10px">Join ordering optimization</li><li style="margin-bottom:10px">Bushy join support</li><li style="margin-bottom:10px">Join simplification</li></ol> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> 1. Join ordering optimization</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Join ordering optimization plays a central role in the processing of relational database queries. Our goal is to find a join order with the lowest cost. The initial step is for the CBO to find the join order that results in the biggest reduction of intermediary rows as early as possible in the plan tree.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> In Hive 0.14, the CBO uses boundary statistics to compute operator cardinality and join selectivity. Based on this information, the most efficient join order is selected.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> To better understand the impact of join ordering, let’s look at TPC-DS Q3:<br style=""> [code language=”SQL”]<br style=""> select<br style=""> dt.d_year,<br style=""> item.i_brand_id brand_id,<br style=""> item.i_brand brand,<br style=""> sum(ss_ext_sales_price) sum_agg<br style=""> from<br style=""> date_dim dt,<br style=""> store_sales,<br style=""> item<br style=""> where<br style=""> dt.d_date_sk = store_sales.ss_sold_date_sk<br style=""> and store_sales.ss_item_sk = item.i_item_sk<br style=""> and item.i_manufact_id = 436<br style=""> and dt.d_moy = 12<br style=""> group by dt.d_year , item.i_brand , item.i_brand_id<br style=""> order by dt.d_year , sum_agg desc , brand_id<br style=""> limit 10<br style=""> [/code]</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The query above involves an equi-join between a fact table—store_sales (82B)—and two dimension tables, date_dim (73K) and item (462K). Each of the dimension tables has a filter, achieving the goal of reducing intermediary data as early as possible. The CBO should first join with the table that is most likely to reduce rows.</p> 
<div id="attachment_68047" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:590px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_3.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/cc/fa/wxQdhhAm_o.png" alt="Graph 1: join graph for TPC-DS Q3" width="580" height="195" class="size-full wp-image-68047" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 1: join graph for TPC-DS Q3</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> By analyzing min, max, number of distinct values (NDV) and row count for the join columns, the CBO is able to deduce that the joins involved are one-to-many joins⎯and that selectivity on the dimension table is likely to translate to a similar reduction of rows when joined with the fact table. Using that information, the CBO will order joins based on the estimated selectivity.</p> 
<div id="attachment_68048" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:926px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-02-at-8.39.12-AM.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/c4/58/NeVR6WNM_o.png" alt="Table 1: dimension table cardinality and selectivity for TPC-DS Q3" width="916" height="168" class="size-full wp-image-68048" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Table 1: dimension table cardinality and selectivity for TPC-DS Q3</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Table 1 lists various statistics: the cardinality of each dimension table, the cardinality after applying filters, and selectivity, which is calculated by dividing the row count after filter by the row count before filter.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Join ordering optimization: results</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The join trees in Graph 2 reflect the join tree generated by the Hive Explain Plan.</p> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO ON</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The CBO analyzes the join selectivity of item and date_dim. Using statistics, the CBO is able to deduce that joining store_sales with the item is more selective than joining store_sales with date_dim.</p> 
<div id="attachment_68054" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:665px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_4.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/83/3b/GlfWWDDo_o.png" alt="Graph 2: join tree for TPC-DS Q3 with CBO ON" width="655" height="376" class="size-full wp-image-68054" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 2: join tree for TPC-DS Q3 with CBO ON</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> As a result, the join reduces the number of rows coming out of store_sales from 82 billion to 82 million. Next, a join with date_dim follows this join, with the less selective join.</p> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO OFF</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> When the CBO is turned off, the following join tree is produced:</p> 
<div id="attachment_68056" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:665px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_5.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/50/38/1hEfV4lH_o.png" alt="Graph 3: join tree for TPC-DS Q3 with CBO OFF" width="655" height="341" class="size-full wp-image-68056" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 3: join tree for TPC-DS Q3 with CBO OFF</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> In this case, the join order follows the order of tables in the query, and the join tree joins store_sales with date_dim first, which is the least selective join in the query. As a result, we end up with 14 billion rows of intermediary data without the CBO, compared to 82 million with the CBO enabled.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Join ordering optimization: interpreting the results</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> To understand the impact of the change in join order, the same query was run with CBO ON and then with CBO OFF. The results showed that the execution plan created by the CBO resulted in a 60% improvement in response time and CPU utilization.</p> 
<div id="attachment_68057" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:995px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_6.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/b6/18/rQjjrUsn_o.png" alt="Graph 4: elapsed time and CPU for TPC-DS Q3 with CBO ON vs. OFF" width="985" height="445" class="size-full wp-image-68057" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 4: elapsed time and CPU for TPC-DS Q3 with CBO ON vs. OFF</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Table 2 shows how optimal join ordering impacts query execution, in which CPU response time is cut by 50% and intermediary rows are reduced 161 times.</p> 
<div id="attachment_68058" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:1382px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-02-at-8.58.36-AM.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/05/72/D3MTMm1t_o.png" alt="Table 2: elapsed time and CPU for TPC-DS Q3 with CBO ON vs. OFF" width="1372" height="186" class="size-full wp-image-68058" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Table 2: elapsed time and CPU for TPC-DS Q3 with CBO ON vs. OFF</p> 
</div> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> 2. Bushy join support</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> <a target="_blank" href="http://www.google.com/url?q=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FStar_schema&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNG9YMbr5o-9RHQZSACJC6HZjgMJMg" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">Star</a> and <a target="_blank" href="http://www.google.com/url?q=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSnowflake_schema&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGdxmEci1MXtzL9vmgKlo1gAObG2A" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">snowflake</a> schemas are often found in data warehousing systems. These schemas are represented by centralized fact tables connected to multiple dimensions, splitting up data into dimension tables and avoiding redundancy by moving commonly repeating groups of data into new tables. The tradeoff is additional complexity in source query joins.</p> 
<div id="attachment_68059" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:995px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_7.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/dd/b2/waCaqGl7_o.png" alt="Image 1: snowflake schema example" width="985" height="599" class="size-full wp-image-68059" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Image 1: snowflake schema example</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> For such schemas, there are two reasons a bushy tree outperforms any linear “deep” tree:</p> 
<ol style="padding-left:20px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"><li style="margin-bottom:10px">Parallel execution of independent plan fragments</li><li style="margin-bottom:10px">Reduced intermediary data size</li></ol> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> To better understand the impact of join ordering, consider TPC-DS query 17:<br style=""> [code language=”SQL”]<br style=""> select<br style=""> i_item_id,<br style=""> i_item_desc,<br style=""> s_state,<br style=""> count(ss_quantity) as store_sales_quantitycount,<br style=""> avg(ss_quantity) as store_sales_quantityave,<br style=""> stddev_samp(ss_quantity) as store_sales_quantitystdev,<br style=""> stddev_samp(ss_quantity) / avg(ss_quantity) as store_sales_quantitycov,<br style=""> count(sr_return_quantity) as store_returns_quantitycount,<br style=""> avg(sr_return_quantity) as store_returns_quantityave,<br style=""> stddev_samp(sr_return_quantity) as store_returns_quantitystdev,<br style=""> stddev_samp(sr_return_quantity) / avg(sr_return_quantity) as store_returns_quantitycov,<br style=""> count(cs_quantity) as catalog_sales_quantitycount,<br style=""> avg(cs_quantity) as catalog_sales_quantityave,<br style=""> stddev_samp(cs_quantity) / avg(cs_quantity) as catalog_sales_quantitystdev,<br style=""> stddev_samp(cs_quantity) / avg(cs_quantity) as catalog_sales_quantitycov<br style=""> from<br style=""> store_sales,<br style=""> store_returns,<br style=""> catalog_sales,<br style=""> date_dim d1,<br style=""> date_dim d2,<br style=""> date_dim d3,<br style=""> store,<br style=""> item<br style=""> where<br style=""> d1.d_quarter_name = ‘2000Q1’<br style=""> and d1.d_date_sk = ss_sold_date_sk<br style=""> and i_item_sk = ss_item_sk<br style=""> and s_store_sk = ss_store_sk<br style=""> and ss_customer_sk = sr_customer_sk<br style=""> and ss_item_sk = sr_item_sk<br style=""> and ss_ticket_number = sr_ticket_number<br style=""> and sr_returned_date_sk = d2.d_date_sk<br style=""> and d2.d_quarter_name in (‘2000Q1’ , ‘2000Q2’, ‘2000Q3’)<br style=""> and sr_customer_sk = cs_bill_customer_sk<br style=""> and sr_item_sk = cs_item_sk<br style=""> and cs_sold_date_sk = d3.d_date_sk<br style=""> and d3.d_quarter_name in (‘2000Q1’ , ‘2000Q2’, ‘2000Q3’)<br style=""> group by i_item_id , i_item_desc , s_state<br style=""> order by i_item_id , i_item_desc , s_state<br style=""> limit 100;<br style=""> [/code]</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The query above involves three fact tables: store_sales (82B), store_returns (8B) and catalog_sales (43B). It also involves five dimension tables: date_dim d1 (73K), date_dim d2 (73K), date_dim d3 (73K), store (1.7K) and item (462K).</p> 
<div id="attachment_68060" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:647px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_8.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/d5/22/3xXoUXaY_o.png" alt="Graph 5: join graph for TPC-DS Q17" width="637" height="257" class="size-full wp-image-68060" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 5: join graph for TPC-DS Q17</p> 
</div> 
<div id="attachment_68061" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:962px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-02-at-9.05.52-AM.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/6a/96/F3eHrqJd_o.png" alt="Table 3: dimension table cardinality and selectivity for TPC-DS Q17" width="952" height="326" class="size-full wp-image-68061" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Table 3: dimension table cardinality and selectivity for TPC-DS Q17</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> From Table 3, it is clear that joining date_dim d1, d2 and d3 should result in a reduction of intermediary rows in the plan, while dimension tables of store and item will provide no reduction in rows, as they have a selectivity of one (1).</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Bushy join support: results</h4> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO ON</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Similar to our join ordering optimization scenario, the CBO creates an optimal join graph that reduces intermediary data size. But, in this case, it is able to create a bushy tree instead of a left-deep tree.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The join tree below shows the CBO will join the fact tables with their corresponding date_dim table first, before completing any fact-to-fact joins. The CBO is also able to delay the join of store_sales with the store and item tables. Since the joins with both tables have a selectivity of one (1), the CBO will order the joins such that the selective joins are handled first, followed by the less selective ones.</p> 
<div id="attachment_68062" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:934px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_9.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/3d/b1/qmFzFJ1m_o.png" alt="Graph 6: join tree for TPC-DS Q17 with CBO ON" width="924" height="692" class="size-full wp-image-68062" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 6: join tree for TPC-DS Q17 with CBO ON</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The join tree in Graph 6 shows how the CBO joins each of the fact tables with the most selective corresponding table. This avoids large fact-to-fact joins, which require expensive shuffles. Even after joining with date_dim, the CBO is able to order joins efficiently—as seen in Join #4, which reduces 2.5 billion + 1.2 billion to just 55 million rows.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Store and item tables have a selectivity of one (1), so they are joined last.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> There is no point in needing to pass billions of rows through a join operator that will qualify all of the rows.</p> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO OFF</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Graph 7 shows the join tree with the CBO OFF. Notice how the join tree resembles a left-deep tree. Joins #1 and #2 are large fact-to-fact joins⎯so store_sales, store_returns and catalog_sales are joined together, producing lots of intermediate data. Joins #1 and #2 are executed as shuffle joins when both relations are shuffled on the join keys.</p> 
<div id="attachment_68063" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:934px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_10.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/c9/77/BYgeHvpj_o.png" alt="Graph 7: join tree for TPC-DS Q17 with CBO OFF" width="924" height="711" class="size-full wp-image-68063" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 7: join tree for TPC-DS Q17 with CBO OFF</p> 
</div> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Bushy join support: interpreting the results</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The CBO generates a bushy tree that reduces intermediary data set size. The efficient join order produced by the CBO allows the physical optimizer to reduce the number of rows involved in shuffle joins. This is achieved by creating a map join of the fact table with the corresponding date_dim table, before doing the joins between store_sales, store_returns and catalog_sales.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Table 4 summarizes the impact of the efficient join tree produced by the CBO. It shows a roughly sevenfold speedup in response time, plus a sevenfold reduction in CPU utilization, while the data shuffled over the network is reduced from 1.3 TB to just 78 GB.</p> 
<div id="attachment_68064" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:1628px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-02-at-9.13.47-AM.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/c1/6b/Ec4izTx7_o.png" alt="Table 4: elapsed time, intermediate rows and CPU for TPC-DS Q17 with CBO ON vs. OFF" width="1618" height="166" class="size-full wp-image-68064" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Table 4: elapsed time, intermediate rows and CPU for TPC-DS Q17 with CBO ON vs. OFF</p> 
</div> 
<div id="attachment_68065" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:1096px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_11.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/8c/e6/bqtEBGbm_o.png" alt="Graph 8: elapsed time and CPU for TPC-DS Q17 with CBO ON vs. OFF" width="1086" height="394" class="size-full wp-image-68065" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 8: elapsed time and CPU for TPC-DS Q17 with CBO ON vs. OFF</p> 
</div> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> 3. Join simplification</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> Among the new features offered by Hive 0.14 CBO is join predicate simplification. The CBO is able to identify common join predicates from the conjunction and disjunction clause, plus create an implied join predicate, avoiding costly cross-product joins.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> An example for this optimization is TPC-DS Q48, which clearly illustrates this issue. Notice the join predicates in bold between customer_demographics x store_sales and store_sales x customer_address.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> [code language=”SQL”]<br style=""> select<br style=""> sum(ss_quantity)<br style=""> from<br style=""> store_sales,<br style=""> store,<br style=""> customer_demographics,<br style=""> customer_address,<br style=""> date_dim<br style=""> where<br style=""> store.s_store_sk = store_sales.ss_store_sk<br style=""> and store_sales.ss_sold_date_sk = date_dim.d_date_sk<br style=""> and d_year = 1998<br style=""> and ((<br style=""> customer_demographics.cd_demo_sk = store_sales.ss_cdemo_sk<br style=""> and cd_marital_status = ‘M’<br style=""> and cd_education_status = ‘4 yr Degree’<br style=""> and ss_sales_price between 100.00 and 150.00)<br style=""> or (<br style=""> customer_demographics.cd_demo_sk = store_sales.ss_cdemo_sk<br style=""> and cd_marital_status = ‘M’<br style=""> and cd_education_status = ‘4 yr Degree’<br style=""> and ss_sales_price between 50.00 and 100.00)<br style=""> or (<br style=""> customer_demographics.cd_demo_sk = store_sales.ss_cdemo_sk<br style=""> and cd_marital_status = ‘M’<br style=""> and cd_education_status = ‘4 yr Degree’<br style=""> and ss_sales_price between 150.00 and 200.00))<br style=""> and ((<br style=""> store_sales.ss_addr_sk = customer_address.ca_address_sk<br style=""> and ca_country = ‘United States’<br style=""> and ca_state in (‘KY’ , ‘GA’, ‘NM’)<br style=""> and ss_net_profit between 0 and 2000)<br style=""> or (<br style=""> store_sales.ss_addr_sk = customer_address.ca_address_sk<br style=""> and ca_country = ‘United States’<br style=""> and ca_state in (‘MT’ , ‘OR’, ‘IN’)<br style=""> and ss_net_profit between 150 and 3000)<br style=""> or (<br style=""> store_sales.ss_addr_sk = customer_address.ca_address_sk<br style=""> and ca_country = ‘United States’<br style=""> and ca_state in (‘WI’ , ‘MO’, ‘WV’)<br style=""> and ss_net_profit between 50 and 25000))<br style=""> [/code]</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Join simplification: results and interpretation</h4> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO ON</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The CBO is able to identify that the join predicates (customer_demographics x store_sales and store_sales x customer_address) are duplicated in the three disjunctions. The CBO also simplifies the join tree, avoiding a cross product.<br style=""> Additionally, the CBO improves performance by simplifying some of the table predicates, while also pushing them down to scan further and reducing the intermediary data size.</p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> </p> 
<div id="attachment_68066" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:1652px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/Screen-Shot-2015-03-02-at-9.18.44-AM.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/a2/f2/rEmebffV_o.png" alt="Table 5: table cardinality and selectivity after simplifying and pushing down the column predicates for Q48 with CBO ON" width="1642" height="422" class="size-full wp-image-68066" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Table 5: table cardinality and selectivity after simplifying and pushing down the column predicates for Q48 with CBO ON</p> 
</div> 
<div id="attachment_68067" class="wp-caption aligncenter" style="font-weight:bold; font-size:13.6px; color:rgb(153,153,153); border:0px; max-width:96%; padding:5px 3px 10px; text-align:center; font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; width:934px"> 
 <a target="_blank" href="http://hortonworks.com/wp-content/uploads/2015/03/cbo_12.png" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)"><img src="https://images2.imgbox.com/e0/e5/RrO4FpAT_o.png" alt="Graph 9: join tree for TPC-DS Q48 with CBO ON" width="924" height="565" class="size-full wp-image-68067" style="border:0px none; max-width:100%; vertical-align:middle; height:auto; margin:10px 0px; padding:0px; width:auto"></a> 
 <p class="wp-caption-text" style="">Graph 9: join tree for TPC-DS Q48 with CBO ON</p> 
</div> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> </p> 
<p style="color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> The CBO is able to order joins efficiently while avoiding a cross-product join.</p> 
<h5 style="margin-top:10px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> CBO OFF</h5> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> With the CBO disabled, a cross product generated for store_sales x customer_demographics x customer_address (without any filters) translates to 805 billion x 1.9 million x 40 million = 6.1903E+24 rows. Obviously, this query is not going to finish in a reasonable amount of time.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Conclusion</h4> 
<p style="margin-top:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"> In this post, we’ve highlighted some of the new query optimizations introduced in Hive 0.14 via Calcite, covering join ordering optimization, bushy join trees, and cross-product elimination. It’s clear that users can expect striking performance gains in query planning by leveraging the Cost-Based Logical Optimizer in Hive 0.14.</p> 
<h4 style="font-size:23.2px; margin:40px 0px 10px; font-family:Cabin,'Helvetica Neue',Arial,Helvetica,'Lucida Grande',sans-serif; font-weight:300; color:rgb(51,51,51)"> Learn More</h4> 
<ul style="padding-left:2em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"><li style="margin-bottom:10px">For more in-depth understanding of the CBO internals in Hive 0.14, check out <a target="_blank" href="https://issues.apache.org/jira/browse/HIVE-5775" rel="nofollow noopener noreferrer" class="ext-link" style="color:rgb(89,139,166); padding-right:12px">HIVE-5775</a>.</li></ul> 
<p></p> 
<ul style="padding-left:2em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'Open Sans','Lucida Grande',sans-serif; font-size:16px; line-height:24px"><li style="margin-bottom:10px">Read Blog: <a target="_blank" href="http://hortonworks.com/blog/cost-based-optimizer-makes-apache-hive-0-14-more-than-2-5x-faster/" rel="nofollow noopener noreferrer" style="color:rgb(89,139,166)">Cost-Based Optimizer Makes Apache Hive 0.14 More Than 2.5X Faster</a></li></ul> 
<div> 
 <span style="font-family:Helvetica Neue,Helvetica,Arial,Open Sans,Lucida Grande,sans-serif; color:#333333"><span style="font-size:16px; line-height:24px">Ref: http://zh.hortonworks.com/blog/hive-0-14-cost-based-optimizer-cbo-technical-overview/?utm_source=tuicool&amp;utm_medium=referral</span></span> 
</div> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a7f526d545eec7c2c2dfb579965813db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">shell脚本之sed使用----替换、变量、转义字符</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2342ef65908a05356f7fa48538d0a9e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">上古卷轴5附魔挣钱方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>