<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java学习笔记 - 微服务的链路追踪 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java学习笔记 - 微服务的链路追踪" />
<meta property="og:description" content="Java学习笔记 - 微服务的链路追踪 1、微服务架构下的问题2、Spring Cloud Sleuth2.1 Sleuth简介2.2 相关概念2.3 链路追踪Sleuth入门案例 3、Zipkin的概述4、Zipkin Server的部署和配置5、客户端Zipkin&#43;Sleuth整合6、基于消息中间件收集数据6.1 RabbitMQ的安装与启动6.2 服务端启动6.3 客户端配置 7、存储跟踪数据7.1 准备数据库7.2 配置启动服务端 1、微服务架构下的问题 在大型系统的微服务化构建中，一个系统会被拆分成许多模块。这些模块负责不同的功能，组合成系统，最终可以提供丰富的功能。在这种架构中，一次请求往往需要涉及到多个服务。互联网应用构建在不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能部署在了几千台服务器，横跨多个不同的数据中心，也就意味着这种架构形式也会存在一些问题：
如何快速发现问题？如何判断故障影响范围？如何梳理服务依赖以及依赖的合理性？如何分析链路性能问题以及实时容量规划？ 分布式链路追踪（Distributed Tracing） 就是将一次分布式请求还原成调用链路，进行日志记录、性能监控，并将一次分布式请求的调用情况集中展示。比如各个服务节点上的耗时、请求具体到达哪台机器上、每个服务节点的请求状态等等。
目前业界比较流行的链路追踪系统如：Twitter的Zipkin、阿里的鹰眼、美团的Mtrace、大众点评的cat等，大部分都是基于google发表的Dapper（http://bigbully.github.io/Dapper-translation/）。Dapper阐述了分布式系统，特别是微服务架构中链路追踪的概念、数据表示、埋点、传递、收集、存储与展示等技术细节。
2、Spring Cloud Sleuth 2.1 Sleuth简介 Spring Cloud Sleuth 主要功能就是在分布式系统中提供追踪解决方案，并且兼容支持了 zipkin，只需要在pom文件中引入相应的依赖即可。
2.2 相关概念 Spring Cloud Sleuth 为Spring Cloud提供了分布式追踪的解决方案，它大量借用了Google Dapper的设计。
先来了解一下Sleuth中的术语和相关概念，Spring Cloud Sleuth采用的是Google的开源项目Dapper的专业术语。
Span：基本工作单元，例如，在一个新建的span中发送一个RPC等同于发送一个回应请求给RPC，span通过一个64位ID唯一标识，trace以另一个64位ID表示，span还有其他数据信息，比如摘要、时间戳事件、关键值注释(tags)、span的ID、以及进度ID(通常是IP地址)，span在不断的启动和停止同时记录了时间信息，当你创建了一个span，你必须在未来的某个时刻停止它。
Trace：一系列spans组成的一个树状结构，例如，如果你正在跑一个分布式大数据工程，你可能需要创建一个trace。
Annotation：用来及时记录一个事件的存在，一些核心annotations用来定义一个请求的开始和结束。
Annotation介绍：
cs - Client Sent：客户端发起一个请求，这个annotion描述了这个span的开始。sr - Server Received：服务端获得请求并准备开始处理它，如果将其sr减去cs时间戳便可得到网络延迟。ss - Server Sent：注解表明请求处理的完成(当请求返回客户端)，如果ss减去sr时间戳便可得到服务端需要的处理请求时间。cr - Client Received：表明span的结束，客户端成功接收到服务端的回复，如果cr减去cs时间戳便可得到客户端从服务端获取回复的所有所需时间。 2.3 链路追踪Sleuth入门案例 接下来通过之前博客中的项目案例整合Sleuth，完成入门案例的编写。
（1） 配置依赖
修改相关微服务工程的pom.xml引入Sleuth依赖。
&lt;!--sleuth链路追踪--&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/5bc1bdd1b977f0350f30b4640fec7748/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-14T23:12:23+08:00" />
<meta property="article:modified_time" content="2021-12-14T23:12:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java学习笔记 - 微服务的链路追踪</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Java学习笔记 - 微服务的链路追踪</h4> 
 <ul><li><a href="#1_2" rel="nofollow">1、微服务架构下的问题</a></li><li><a href="#2Spring_Cloud_Sleuth_14" rel="nofollow">2、Spring Cloud Sleuth</a></li><li><ul><li><a href="#21_Sleuth_15" rel="nofollow">2.1 Sleuth简介</a></li><li><a href="#22__17" rel="nofollow">2.2 相关概念</a></li><li><a href="#23_Sleuth_35" rel="nofollow">2.3 链路追踪Sleuth入门案例</a></li></ul> 
  </li><li><a href="#3Zipkin_63" rel="nofollow">3、Zipkin的概述</a></li><li><a href="#4Zipkin_Server_85" rel="nofollow">4、Zipkin Server的部署和配置</a></li><li><a href="#5ZipkinSleuth_94" rel="nofollow">5、客户端Zipkin+Sleuth整合</a></li><li><a href="#6_130" rel="nofollow">6、基于消息中间件收集数据</a></li><li><ul><li><a href="#61_RabbitMQ_135" rel="nofollow">6.1 RabbitMQ的安装与启动</a></li><li><a href="#62__160" rel="nofollow">6.2 服务端启动</a></li><li><a href="#63__171" rel="nofollow">6.3 客户端配置</a></li></ul> 
  </li><li><a href="#7_232" rel="nofollow">7、存储跟踪数据</a></li><li><ul><li><a href="#71__235" rel="nofollow">7.1 准备数据库</a></li><li><a href="#72__327" rel="nofollow">7.2 配置启动服务端</a></li></ul> 
 </li></ul> 
</div> 
<br>   
<p></p> 
<h2><a id="1_2"></a>1、微服务架构下的问题</h2> 
<p>在大型系统的微服务化构建中，一个系统会被拆分成许多模块。这些模块负责不同的功能，组合成系统，最终可以提供丰富的功能。在这种架构中，一次请求往往需要涉及到多个服务。互联网应用构建在不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能部署在了几千台服务器，横跨多个不同的数据中心，也就意味着这种架构形式也会存在一些问题：</p> 
<ul><li>如何快速发现问题？</li><li>如何判断故障影响范围？</li><li>如何梳理服务依赖以及依赖的合理性？</li><li>如何分析链路性能问题以及实时容量规划？</li></ul> 
<p><strong>分布式链路追踪</strong>（Distributed Tracing） 就是将一次分布式请求还原成调用链路，进行日志记录、性能监控，并将一次分布式请求的调用情况集中展示。比如各个服务节点上的耗时、请求具体到达哪台机器上、每个服务节点的请求状态等等。</p> 
<p>目前业界比较流行的链路追踪系统如：<strong>Twitter的Zipkin</strong>、<strong>阿里的鹰眼</strong>、<strong>美团的Mtrace</strong>、<strong>大众点评的cat</strong>等，大部分都是基于google发表的Dapper（http://bigbully.github.io/Dapper-translation/）。Dapper阐述了分布式系统，特别是微服务架构中链路追踪的概念、数据表示、埋点、传递、收集、存储与展示等技术细节。<br>  </p> 
<h2><a id="2Spring_Cloud_Sleuth_14"></a>2、Spring Cloud Sleuth</h2> 
<h3><a id="21_Sleuth_15"></a>2.1 Sleuth简介</h3> 
<p>Spring Cloud Sleuth 主要功能就是在分布式系统中提供追踪解决方案，并且兼容支持了 zipkin，只需要在pom文件中引入相应的依赖即可。</p> 
<h3><a id="22__17"></a>2.2 相关概念</h3> 
<p>Spring Cloud Sleuth 为Spring Cloud提供了分布式追踪的解决方案，它大量借用了Google Dapper的设计。</p> 
<p>先来了解一下Sleuth中的术语和相关概念，Spring Cloud Sleuth采用的是Google的开源项目Dapper的专业术语。</p> 
<ul><li> <p><strong>Span</strong>：基本工作单元，例如，在一个新建的span中发送一个RPC等同于发送一个回应请求给RPC，span通过一个64位ID唯一标识，trace以另一个64位ID表示，span还有其他数据信息，比如摘要、时间戳事件、关键值注释(tags)、span的ID、以及进度ID(通常是IP地址)，span在不断的启动和停止同时记录了时间信息，当你创建了一个span，你必须在未来的某个时刻停止它。</p> </li><li> <p><strong>Trace</strong>：一系列spans组成的一个树状结构，例如，如果你正在跑一个分布式大数据工程，你可能需要创建一个trace。</p> </li><li> <p><strong>Annotation</strong>：用来及时记录一个事件的存在，一些核心annotations用来定义一个请求的开始和结束。</p> </li></ul> 
<blockquote> 
 <p>Annotation介绍：</p> 
 <ul><li><strong>cs - Client Sent</strong>：客户端发起一个请求，这个annotion描述了这个span的开始。</li><li><strong>sr - Server Received</strong>：服务端获得请求并准备开始处理它，如果将其sr减去cs时间戳便可得到网络延迟。</li><li><strong>ss - Server Sent</strong>：注解表明请求处理的完成(当请求返回客户端)，如果ss减去sr时间戳便可得到服务端需要的处理请求时间。</li><li><strong>cr - Client Received</strong>：表明span的结束，客户端成功接收到服务端的回复，如果cr减去cs时间戳便可得到客户端从服务端获取回复的所有所需时间。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c1/1b/s0o1NjUz_o.png" alt="在这里插入图片描述"><br>  </p> 
<h3><a id="23_Sleuth_35"></a>2.3 链路追踪Sleuth入门案例</h3> 
<p>接下来通过之前博客中的项目案例整合Sleuth，完成入门案例的编写。</p> 
<p>（1） 配置依赖<br> 修改相关微服务工程的pom.xml引入Sleuth依赖。</p> 
<pre><code>        &lt;!--sleuth链路追踪--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p>（2） 修改配置文件<br> 修改相关微服务工程的application.yml添加日志级别。</p> 
<pre><code>logging:
	level:
		root: INFO
		org.springframework.web.servlet.DispatcherServlet: DEBUG
		org.springframework.cloud.sleuth: DEBUG
</code></pre> 
<p>每个相关微服务都需要添加如上的配置，启动微服务并调用url之后，在相关微服务的控制台中可以观察到sleuth的日志输出。<br> <img src="https://images2.imgbox.com/8f/85/4l25uUFL_o.png" alt="在这里插入图片描述"><br> 其中cf81c50b403b3ee7是TraceId，后面跟着的cf81c50b403b3ee7是SpanId，依次调用有一个全局的TraceId，将调用链路串起来，仔细分析每个微服务的日志，不难看出请求的具体过程。</p> 
<p>查看日志文件并不是一个很好的方法，当微服务越来越多日志文件也会越来越多，通过Zipkin可以将日志聚合，并进行可视化展示和全文检索。<br>  </p> 
<h2><a id="3Zipkin_63"></a>3、Zipkin的概述</h2> 
<p>Zipkin 是 Twitter 的一个开源项目，它基于 Google Dapper 实现，它致力于收集服务的定时数据，以解决微服务架构中的延迟问题，包括数据的收集、存储、查找和展现。 我们可以使用它来收集各个服务器上请求链路的跟踪数据，并通过它提供的 REST API 接口来辅助我们查询跟踪数据以实现对分布式系统的监控程序，从而及时地发现系统中出现的延迟升高问题并找出系统性能瓶颈的根源。除了面向开发的 API 接口之外，它也提供了方便的 UI 组件来帮助我们直观的搜索跟踪信息和分析请求链路明细，比如：可以查询某段时间内各用户请求的处理时间等。Zipkin 提供了可插拔数据存储方式：In-Memory、MySql、Cassandra 以及 Elasticsearch。<br> <img src="https://images2.imgbox.com/f3/e8/SAG5u6Tl_o.png" alt="在这里插入图片描述"><br> 上图展示了 Zipkin 的基础架构，它主要由 4 个核心组件构成：</p> 
<blockquote> 
 <ul><li>Collector：收集器组件，它主要用于处理从外部系统发送过来的跟踪信息，将这些信息转换为<br> Zipkin 内部处理的 Span 格式，以支持后续的存储、分析、展示等功能。</li><li>Storage：存储组件，它主要对处理收集器接收到的跟踪信息，默认会将这些信息存储在内存中，<br> 我们也可以修改此存储策略，通过使用其他存储组件将跟踪信息存储到数据库中。</li><li>RESTful API：API 组件，它主要用来提供外部访问接口。比如给客户端展示跟踪信息，或是外接<br> 系统访问以实现监控等。</li><li>Web UI：UI 组件，基于 API 组件实现的上层应用。通过 UI 组件用户可以方便而有直观地查询和<br> 分析跟踪信息。</li></ul> 
</blockquote> 
<p>Zipkin 分为两端，一个是 Zipkin 服务端，一个是 Zipkin 客户端，客户端也就是微服务的应用。客户端会配置服务端的 URL 地址，一旦发生服务间的调用的时候，会被配置在微服务里面的 Sleuth 的监听器监听，并生成相应的 Trace 和 Span 信息发送给服务端。</p> 
<p>发送的方式主要有两种，一种是 HTTP 报文的方式，还有一种是消息总线的方式如 RabbitMQ。不论哪种方式，我们都需要：</p> 
<p>（1）一个 Eureka 服务注册中心。<br> （2）一个 Zipkin 服务端。<br> （3）多个微服务，且这些微服务中配置 Zipkin 客户端。<br>  </p> 
<h2><a id="4Zipkin_Server_85"></a>4、Zipkin Server的部署和配置</h2> 
<p>（1） Zipkin Server下载<br> 从spring boot 2.0开始，官方就不再支持使用自建Zipkin Server的方式进行服务链路追踪，而是直接提供了编译好的 jar 包来给我们使用，可以从官方网站下载（https://search.maven.org/remote_content?g=io.zipkin.java&amp;a=zipkin-server&amp;v=LATEST&amp;c=exec），这里我们使用的是zipkin-server-2.12.9-exec.jar。</p> 
<p>（2）Zipkin Server启动<br> 在命令行输入 <code>java -jar zipkin-server-2.12.9-exec.jar</code> 启动 Zipkin Server，Zipkin Server的启动参数可以通过官方提供的yml配置文件查找。<br> <img src="https://images2.imgbox.com/5f/14/9HY2lPOc_o.png" alt="在这里插入图片描述"><br> 默认Zipkin Server的请求端口为 9411，在浏览器输入 http://127.0.0.1:9411 即可进入到Zipkin Server的管理后台。<br> <img src="https://images2.imgbox.com/b1/08/roFK8isV_o.png" alt="在这里插入图片描述"> </p> 
<h2><a id="5ZipkinSleuth_94"></a>5、客户端Zipkin+Sleuth整合</h2> 
<p>通过查看日志分析微服务的调用链路并不是一个很直观的方案，结合zipkin可以很直观地显示微服务之间的调用关系。</p> 
<p>（1）客户端添加依赖（客户端指的是需要被追踪的微服务）</p> 
<pre><code>        &lt;!--zipkin依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p>（2）修改客户端配置文件</p> 
<pre><code>spring:
  zipkin:
    base-url: http://127.0.0.1:9411/ #zipkin server的请求地址
    sender:
      type: web #请求方式,默认以http的方式向zipkin server发送追踪数据
  sleuth:
    sampler:
      probability: 1.0 #采样的百分比
</code></pre> 
<p>指定了zipkin server的地址，接下来指定需采样的百分比，默认为0.1，即10%，这里配置1，是记录全部的sleuth信息，是为了收集到更多的数据（仅供测试用）。在分布式系统中，过于频繁的采样会影响系统性能，所以这里配置需要采用一个合适的值。</p> 
<p>（3） 测试<br> 启动Zipkin Service和每个相关的微服务，通过浏览器发送一次微服务请求。打开Zipkin Servic控制台，我们可以根据条件追踪每次请求调用过程。</p> 
<p>单击查找按钮，查看请求调用过程。<br> <img src="https://images2.imgbox.com/6b/78/WGdWOFaW_o.png" alt="在这里插入图片描述"><br> 单击该trace可以看到请求的细节。<br> <img src="https://images2.imgbox.com/70/af/WW4pDLjI_o.png" alt="在这里插入图片描述"><br>  </p> 
<h2><a id="6_130"></a>6、基于消息中间件收集数据</h2> 
<p>在默认情况下，Zipkin客户端和服务端之间是使用HTTP请求的方式进行通信（即同步的请求方式），在网络波动，Server端异常等情况下可能存在信息收集不及时的问题。Zipkin支持与rabbitMQ整合完成异步消息传输。</p> 
<p>加了rabbitMQ之后，通信过程如下图所示：<br> <img src="https://images2.imgbox.com/43/7f/XNE8ZmdH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="61_RabbitMQ_135"></a>6.1 RabbitMQ的安装与启动</h3> 
<p>由于RabbitMQ底层使用Erlang语言实现的，RabbitMQ需要安装Windows 支持的64位版本的Erlang，所以我们在使用RabbitMQ之前要先安装并配置Erlang，</p> 
<p>（1）Erlang下载及配置<br> 下载地址： https://www.erlang.org/downloads，根据自己windows的位数选择下载版本。<br> <img src="https://images2.imgbox.com/33/a8/xRPTAIC9_o.png" alt="在这里插入图片描述"><br> 下载完成后会得到一个可执行文件，双击打开，选择安装路径后一路继续确认，直到安装完成。<br> <img src="https://images2.imgbox.com/79/b0/6M3I0iZ5_o.png" alt="在这里插入图片描述"><br> 安装完成后右击 电脑–属性–高级系统设置–环境变量，新建系统变量，变量名ERLANG_HOME，变量值为Erlang的安装目录。<br> <img src="https://images2.imgbox.com/47/8c/OregfLzS_o.png" alt="在这里插入图片描述"><br> 双击系统变量的path变量，新增%ERLANG_HOME%\bin。<br> <img src="https://images2.imgbox.com/12/68/vdvwvcqE_o.png" alt="在这里插入图片描述"><br> （2）RabbitMQ下载</p> 
<p>下载地址： https://www.rabbitmq.com/download.html，在下载页面选择适合的下载方式，windows下可以选择以<code>.exe</code>可执行文件的方式下载：<br> <img src="https://images2.imgbox.com/6d/79/1HoMTwru_o.png" alt="在这里插入图片描述"><br> 下载完成后会得到一个可执行文件，双击打开，选择安装路径后一路继续确认，直到安装完成。<br> <img src="https://images2.imgbox.com/14/01/0ULSFg8I_o.png" alt="在这里插入图片描述"><br> （3）RabbitMQ启动<br> RabbitMQ安装完成后，由于RabbitMQ默认禁用了管理界面，需要通过命令重新开启管理界面，以管理员模式打开CMD，进入RabbitMQ安装目录的sbin文件夹路径下，输入并执行<code>rabbitmq-plugins enable rabbitmq_management</code>命令。<br> <img src="https://images2.imgbox.com/55/1b/8SzD42d7_o.png" alt="在这里插入图片描述"><br> 开启管理界面后，再启动RabbitMQ，点击windows按键，单击RabbitMQ Sercive - start应用启动RabbitMQ 。<br> <img src="https://images2.imgbox.com/d0/7b/K56h9vT8_o.png" alt="在这里插入图片描述"><br> 在地址栏输入<code>http://localhost:15672/</code>即可访问RabbitMQ网页控制台，默认账号密码均为：guest。<br> <img src="https://images2.imgbox.com/73/fa/mDbhqFxk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="62__160"></a>6.2 服务端启动</h3> 
<pre><code>java -jar zipkin-server-2.12.9-exec.jar --RABBIT_ADDRESSES=127.0.0.1:5672
</code></pre> 
<ul><li>RABBIT_ADDRESSES ： 指定RabbitMQ地址</li><li>RABBIT_USER： 用户名（默认guest）</li><li>RABBIT_PASSWORD ： 密码（默认guest）</li></ul> 
<p>在控制台中输入以上命令启动Zipkin Server，启动成功之后，打开RabbitMQ的控制台可以看到多了一个Queue，其中 zipkin 就是为我们自动创建的Queue队列。<br> <img src="https://images2.imgbox.com/91/4b/3BIg6fRY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="63__171"></a>6.3 客户端配置</h3> 
<p>（1） 配置依赖</p> 
<p>在相关的微服务中导入spring-rabbit 依赖，是Spring提供的对rabbit的封装，客户端会根据配置自动的生产消息并发送到目标队列中。</p> 
<pre><code>        &lt;!--sleuth链路追踪--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--zipkin依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-sleuth-zipkin&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;
            &lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p>（2） 配置消息中间件RabbitMQ地址等信息</p> 
<p>在相关的微服务的application.yml配置文件中，修改消息的投递方式改为rabbit，并添加rabbitmq的相关配置。</p> 
<pre><code>spring:
  zipkin:
    # base-url: http://127.0.0.1:9411/ #zipkin server的请求地址
    sender:
      type: rabbit #请求方式
  sleuth:
    sampler:
      probability: 1.0 #采样的百分比
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    listener: # 这里配置了重试策略
      direct:
        retry:
          enabled: true
      simple:
        retry:
          enabled: true
</code></pre> 
<p>（3） 测试<br> 关闭Zipkin Server，并调用请求。打开RabbitMQ网页管理后台可以看到，消息已经推送到RabbitMQ。当Zipkin Server启动时，会自动的从RabbitMQ获取消息并消费，展示追踪数据可以看到如下效果：</p> 
<ul><li>请求的耗时时间不会出现突然耗时特长的情况。</li><li>当ZipkinServer不可用时（比如关闭、网络不通等），追踪信息不会丢失，因为这些信息会保存在RabbitMQ服务器上，直到Zipkin服务器可用时，再从Rabbitmq中取出这段时间的信息。<br>  </li></ul> 
<h2><a id="7_232"></a>7、存储跟踪数据</h2> 
<p>Zipkin Server默认时间追踪数据信息保存到内存，这种方式不适合生产环境。因为一旦Service关闭重启或者服务崩溃，就会导致历史数据消失。Zipkin支持将追踪数据持久化到mysql数据库或者存储到elasticsearch中。这里已mysql为例。</p> 
<h3><a id="71__235"></a>7.1 准备数据库</h3> 
<p>可以从官网找到Zipkin Server持久mysql的数据库脚本。</p> 
<pre><code class="prism language-sql"><span class="token comment">/*
SQLyog Ultimate v11.33 (64 bit)
MySQL - 5.5.58 : Database - zipkin
*********************************************************************
*/</span>


<span class="token comment">/*!40101 SET NAMES utf8 */</span><span class="token punctuation">;</span>

<span class="token comment">/*!40101 SET SQL_MODE=''*/</span><span class="token punctuation">;</span>

<span class="token comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token comment">/*!32312 IF NOT EXISTS*/</span><span class="token punctuation">`</span>zipkin<span class="token punctuation">`</span> <span class="token comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> <span class="token punctuation">`</span>zipkin<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">/*Table structure for table `zipkin_annotations` */</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>zipkin_annotations<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>zipkin_annotations<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'coincides with zipkin_spans.trace_id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>span_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'coincides with zipkin_spans.id'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>a_key<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'BinaryAnnotation.key or Annotation.value if type == -1'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>a_value<span class="token punctuation">`</span> <span class="token keyword">blob</span> <span class="token keyword">COMMENT</span> <span class="token string">'BinaryAnnotation.value(), which must be smaller than 64KB'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>a_type<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'BinaryAnnotation.type() or -1 if Annotation'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>a_timestamp<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>endpoint_ipv4<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Null when Binary/Annotation.endpoint is null'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>endpoint_ipv6<span class="token punctuation">`</span> <span class="token keyword">binary</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Null when Binary/Annotation.endpoint is null, or no IPv6 address'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>endpoint_port<span class="token punctuation">`</span> <span class="token keyword">smallint</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Null when Binary/Annotation.endpoint is null'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>endpoint_service_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Null when Binary/Annotation.endpoint is null'</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>span_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a_key<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a_timestamp<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'Ignore insert on duplicate'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high_2<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>span_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for joining with zipkin_spans'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high_3<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces/ByIds'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>endpoint_service_name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>endpoint_service_name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces and getServiceNames'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>a_type<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a_type<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>a_key<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a_key<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>span_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a_key<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for dependencies job'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>COMPRESSED<span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `zipkin_annotations` */</span>

<span class="token comment">/*Table structure for table `zipkin_dependencies` */</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>zipkin_dependencies<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>zipkin_dependencies<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span><span class="token keyword">day</span><span class="token punctuation">`</span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>parent<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>child<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>call_count<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span><span class="token keyword">day</span><span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token keyword">day</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>parent<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>child<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>COMPRESSED<span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `zipkin_dependencies` */</span>

<span class="token comment">/*Table structure for table `zipkin_spans` */</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>zipkin_spans<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>zipkin_spans<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>parent_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>debug<span class="token punctuation">`</span> <span class="token keyword">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>start_ts<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Span.timestamp(): epoch micros used for endTs query and to implement TTL'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>duration<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Span.duration(): micros used for minDuration and maxDuration query'</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'ignore insert on duplicate'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high_2<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for joining with zipkin_annotations'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>trace_id_high_3<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>trace_id_high<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>trace_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTracesByIds'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces and getSpanNames'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>start_ts<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>start_ts<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'for getTraces ordering and range'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>COMPRESSED<span class="token punctuation">;</span>

<span class="token comment">/*Data for the table `zipkin_spans` */</span>

<span class="token comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span><span class="token punctuation">;</span>
<span class="token comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="72__327"></a>7.2 配置启动服务端</h3> 
<pre><code>java -jar zipkin-server-2.12.9-exec.jar --STORAGE_TYPE=mysql --MYSQL_HOST=127.0.0.1 --MYSQL_TCP_PORT=3306 --MYSQL_DB=zipkin --MYSQL_USER=root --MYSQL_PASS=root
</code></pre> 
<ul><li>STORAGE_TYPE : 存储类型</li><li>MYSQL_HOST： mysql主机地址</li><li>MYSQL_TCP_PORT：mysql端口</li><li>MYSQL_DB： mysql数据库名称</li><li>MYSQL_USER：mysql用户名</li><li>MYSQL_PASS ：mysql密码</li></ul> 
<p>配置好zipkin service服务端之后，在浏览器调用url请求，到数据库查看会发现数据已经持久化到mysql中，即使关闭重启 zipkin service，历史数据也不会消失。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e0596e772b1ae8ee7d0eeb17d6daef9f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第27课 老狼老狼几点钟 《小学生C&#43;&#43;趣味编程》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c2a752330bafa0921335d23774e5962/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算原矩阵Jaccard相似度和签名矩阵的Jaccard相似度</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>