<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s管理工具kubectl详解（二） - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s管理工具kubectl详解（二）" />
<meta property="og:description" content="目录
K8S模拟项目
一、项目的生命周期
二、创建kubectl run命令
使用run报错了
三、发布kubectl expose命令
1.service的作用
2.Service的类型
3.查看Pod网络状态详细信息和Service暴露端口
4.查看关联后端的节点
5.查看service的详细描述信息
6.访问内部IP查看
7.查看访问日志
四、更新kubectl set
1.获取修改模板
2.查看当前nginx的版本号
3.将nginx版本更新为1.15
4.监听pod状态
5.查看pod的IP变化
五、回滚kubectl rollout
1.查看历史版本
2.执行回滚到上一个版本
3.执行回滚到执行版本
查看历史版本
回到revision2，即1.15版本
4.检查回滚状态
六、删除kubectl delete
1.删除副本控制器
2.删除service
K8S模拟项目 Kubectl是管理k8s集群的命令行工具，通过生成的json格式传递给apiserver进行创建、查看、管理的操作。
//帮助信息 [root@localhost bin]# kubectl --help kubectl controls the Kubernetes cluster manager. Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/ Basic Commands (Beginner): create Create a resource from a file or from stdin. expose 使用 replication controller, service, deployment 或者 pod 并暴露它作为一个 新的 Kubernetes Service run 在集群中运行一个指定的镜像 set 为 objects 设置一个指定的特征 Basic Commands (Intermediate): explain 查看资源的文档 get 显示一个或更多 resources edit 在服务器上编辑一个资源 delete Delete resources by filenames, stdin, resources and names, or by resources and label selector Deploy Commands: rollout Manage the rollout of a resource scale 为 Deployment, ReplicaSet, Replication Controller 或者 Job 设置一个新的副本数量 autoscale 自动调整一个 Deployment, ReplicaSet, 或者 ReplicationController 的副本数量 Cluster Management Commands: certificate 修改 certificate 资源." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/6e5e4c3563df129fec711928a197ba14/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-08T17:18:58+08:00" />
<meta property="article:modified_time" content="2022-11-08T17:18:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s管理工具kubectl详解（二）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="K8S%E6%A8%A1%E6%8B%9F%E9%A1%B9%E7%9B%AE-toc" style="margin-left:0px;"><a href="#K8S%E6%A8%A1%E6%8B%9F%E9%A1%B9%E7%9B%AE" rel="nofollow">K8S模拟项目</a></p> 
<p id="%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" rel="nofollow">一、项目的生命周期</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAkubectl%20run%E5%91%BD%E4%BB%A4-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAkubectl%20run%E5%91%BD%E4%BB%A4" rel="nofollow">二、创建kubectl run命令</a></p> 
<p id="%E4%BD%BF%E7%94%A8run%E6%8A%A5%E9%94%99%E4%BA%86-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8run%E6%8A%A5%E9%94%99%E4%BA%86" rel="nofollow">使用run报错了</a></p> 
<p id="%C2%A0%E4%B8%89%E3%80%81%E5%8F%91%E5%B8%83kubectl%20expose%E5%91%BD%E4%BB%A4-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%89%E3%80%81%E5%8F%91%E5%B8%83kubectl%20expose%E5%91%BD%E4%BB%A4" rel="nofollow"> 三、发布kubectl expose命令</a></p> 
<p id="%C2%A01.service%E7%9A%84%E4%BD%9C%E7%94%A8-toc" style="margin-left:40px;"><a href="#%C2%A01.service%E7%9A%84%E4%BD%9C%E7%94%A8" rel="nofollow"> 1.service的作用</a></p> 
<p id="2.Service%E7%9A%84%E7%B1%BB%E5%9E%8B-toc" style="margin-left:40px;"><a href="#2.Service%E7%9A%84%E7%B1%BB%E5%9E%8B" rel="nofollow">2.Service的类型</a></p> 
<p id="3.%E6%9F%A5%E7%9C%8BPod%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E5%92%8CService%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3-toc" style="margin-left:40px;"><a href="#3.%E6%9F%A5%E7%9C%8BPod%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E5%92%8CService%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3" rel="nofollow">3.查看Pod网络状态详细信息和Service暴露端口</a></p> 
<p id="4.%E6%9F%A5%E7%9C%8B%E5%85%B3%E8%81%94%E5%90%8E%E7%AB%AF%E7%9A%84%E8%8A%82%E7%82%B9-toc" style="margin-left:40px;"><a href="#4.%E6%9F%A5%E7%9C%8B%E5%85%B3%E8%81%94%E5%90%8E%E7%AB%AF%E7%9A%84%E8%8A%82%E7%82%B9" rel="nofollow">4.查看关联后端的节点</a></p> 
<p id="%C2%A05.%E6%9F%A5%E7%9C%8Bservice%E7%9A%84%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0%E4%BF%A1%E6%81%AF-toc" style="margin-left:40px;"><a href="#%C2%A05.%E6%9F%A5%E7%9C%8Bservice%E7%9A%84%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0%E4%BF%A1%E6%81%AF" rel="nofollow"> 5.查看service的详细描述信息</a></p> 
<p id="%C2%A06.%E8%AE%BF%E9%97%AE%E5%86%85%E9%83%A8IP%E6%9F%A5%E7%9C%8B-toc" style="margin-left:40px;"><a href="#%C2%A06.%E8%AE%BF%E9%97%AE%E5%86%85%E9%83%A8IP%E6%9F%A5%E7%9C%8B" rel="nofollow"> 6.访问内部IP查看</a></p> 
<p id="7.%E6%9F%A5%E7%9C%8B%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97-toc" style="margin-left:40px;"><a href="#7.%E6%9F%A5%E7%9C%8B%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97" rel="nofollow">7.查看访问日志</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%9B%B4%E6%96%B0kubectl%20set-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%9B%B4%E6%96%B0kubectl%20set" rel="nofollow">四、更新kubectl set</a></p> 
<p id="1.%E8%8E%B7%E5%8F%96%E4%BF%AE%E6%94%B9%E6%A8%A1%E6%9D%BF-toc" style="margin-left:40px;"><a href="#1.%E8%8E%B7%E5%8F%96%E4%BF%AE%E6%94%B9%E6%A8%A1%E6%9D%BF" rel="nofollow">1.获取修改模板</a></p> 
<p id="2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dnginx%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7-toc" style="margin-left:40px;"><a href="#2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dnginx%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7" rel="nofollow">2.查看当前nginx的版本号</a></p> 
<p id="3.%E5%B0%86nginx%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E4%B8%BA1.15-toc" style="margin-left:40px;"><a href="#3.%E5%B0%86nginx%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E4%B8%BA1.15" rel="nofollow">3.将nginx版本更新为1.15</a></p> 
<p id="%C2%A04.%E7%9B%91%E5%90%ACpod%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#%C2%A04.%E7%9B%91%E5%90%ACpod%E7%8A%B6%E6%80%81" rel="nofollow"> 4.监听pod状态</a></p> 
<p id="%C2%A05.%E6%9F%A5%E7%9C%8Bpod%E7%9A%84IP%E5%8F%98%E5%8C%96-toc" style="margin-left:40px;"><a href="#%C2%A05.%E6%9F%A5%E7%9C%8Bpod%E7%9A%84IP%E5%8F%98%E5%8C%96" rel="nofollow"> 5.查看pod的IP变化</a></p> 
<p id="%E4%BA%94%E3%80%81%E5%9B%9E%E6%BB%9Akubectl%20rollout-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E5%9B%9E%E6%BB%9Akubectl%20rollout" rel="nofollow">五、回滚kubectl rollout</a></p> 
<p id="1.%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC-toc" style="margin-left:40px;"><a href="#1.%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC" rel="nofollow">1.查看历史版本</a></p> 
<p id="2.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%89%88%E6%9C%AC-toc" style="margin-left:40px;"><a href="#2.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%89%88%E6%9C%AC" rel="nofollow">2.执行回滚到上一个版本</a></p> 
<p id="3.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E6%89%A7%E8%A1%8C%E7%89%88%E6%9C%AC-toc" style="margin-left:40px;"><a href="#3.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E6%89%A7%E8%A1%8C%E7%89%88%E6%9C%AC" rel="nofollow">3.执行回滚到执行版本</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC-toc" style="margin-left:80px;"><a href="#%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC" rel="nofollow">查看历史版本</a></p> 
<p id="%C2%A0%E5%9B%9E%E5%88%B0revision2%EF%BC%8C%E5%8D%B31.15%E7%89%88%E6%9C%AC-toc" style="margin-left:80px;"><a href="#%C2%A0%E5%9B%9E%E5%88%B0revision2%EF%BC%8C%E5%8D%B31.15%E7%89%88%E6%9C%AC" rel="nofollow"> 回到revision2，即1.15版本</a></p> 
<p id="4.%E6%A3%80%E6%9F%A5%E5%9B%9E%E6%BB%9A%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#4.%E6%A3%80%E6%9F%A5%E5%9B%9E%E6%BB%9A%E7%8A%B6%E6%80%81" rel="nofollow">4.检查回滚状态</a></p> 
<p id="%C2%A0%E5%85%AD%E3%80%81%E5%88%A0%E9%99%A4kubectl%20delete-toc" style="margin-left:0px;"><a href="#%C2%A0%E5%85%AD%E3%80%81%E5%88%A0%E9%99%A4kubectl%20delete" rel="nofollow"> 六、删除kubectl delete</a></p> 
<p id="1.%E5%88%A0%E9%99%A4%E5%89%AF%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%99%A8-toc" style="margin-left:40px;"><a href="#1.%E5%88%A0%E9%99%A4%E5%89%AF%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%99%A8" rel="nofollow">1.删除副本控制器</a></p> 
<p id="2.%E5%88%A0%E9%99%A4service-toc" style="margin-left:40px;"><a href="#2.%E5%88%A0%E9%99%A4service" rel="nofollow">2.删除service</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="K8S%E6%A8%A1%E6%8B%9F%E9%A1%B9%E7%9B%AE">K8S模拟项目</h2> 
<p>Kubectl是管理k8s集群的<a href="https://so.csdn.net/so/search?q=%E5%91%BD%E4%BB%A4%E8%A1%8C&amp;spm=1001.2101.3001.7020" title="命令行">命令行</a>工具，通过生成的json格式传递给apiserver进行创建、查看、管理的操作。</p> 
<pre><code>//帮助信息
[root@localhost bin]# kubectl --help
kubectl controls the Kubernetes cluster manager. 
 
Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/
 
Basic Commands (Beginner):
  create         Create a resource from a file or from stdin.
  expose         使用 replication controller, service, deployment 或者 pod
并暴露它作为一个 新的 Kubernetes Service
  run            在集群中运行一个指定的镜像
  set            为 objects 设置一个指定的特征
 
Basic Commands (Intermediate):
  explain        查看资源的文档
  get            显示一个或更多 resources
  edit           在服务器上编辑一个资源
  delete         Delete resources by filenames, stdin, resources and names, or by resources and
label selector
 
Deploy Commands:
  rollout        Manage the rollout of a resource
  scale          为 Deployment, ReplicaSet, Replication Controller 或者 Job
设置一个新的副本数量
  autoscale      自动调整一个 Deployment, ReplicaSet, 或者 ReplicationController
的副本数量
 
Cluster Management Commands:
  certificate    修改 certificate 资源.
  cluster-info   显示集群信息
  top            Display Resource (CPU/Memory/Storage) usage.
  cordon         标记 node 为 unschedulable
  uncordon       标记 node 为 schedulable
  drain          Drain node in preparation for maintenance
  taint          更新一个或者多个 node 上的 taints
 
Troubleshooting and Debugging Commands:
  describe       显示一个指定 resource 或者 group 的 resources 详情
  logs           输出容器在 pod 中的日志
  attach         Attach 到一个运行中的 container
  exec           在一个 container 中执行一个命令
  port-forward   Forward one or more local ports to a pod
  proxy          运行一个 proxy 到 Kubernetes API server
  cp             复制 files 和 directories 到 containers 和从容器中复制 files 和
directories.
  auth           Inspect authorization
 </code></pre> 
<h2 id="%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">一、项目的生命周期</h2> 
<p>创建–&gt;发布–&gt;更新–&gt;回滚–&gt;删除</p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAkubectl%20run%E5%91%BD%E4%BB%A4">二、创建kubectl run命令</h2> 
<ol><li>创建并允许一个或多个容器镜像</li><li>创建一个seployment或job来管理容器</li><li>kubectl run --help查看使用帮助</li></ol> 
<p>启动nginx实例，暴露容器端口80，设置副本数3</p> 
<pre><code>kubectl run nginx --image=nginx --port=80 --replicas=3</code></pre> 
<p><img alt="" height="115" src="https://images2.imgbox.com/c2/2d/6p5YcR25_o.png" width="1200"></p> 
<h4 id="%E4%BD%BF%E7%94%A8run%E6%8A%A5%E9%94%99%E4%BA%86">使用run报错了</h4> 
<p><strong>k8sv1.18.0以后的版本， --replicas以后弃用该命令，推荐使用deployment创建pods</strong><br> 我这里用的是1.21.3版本</p> 
<ul><li>想创建多个实例时可以使用：kubectl create deployment nginx --images=nginx --port=80 --replicas=3来进行创建</li><li>查看pod: kubectl get pod，用来查看使用命令创建的所有实例</li><li>查看deploy：kubectl get deploy，用来查看实例所创建的数量；</li><li>高于1.17版本的建议以后直接使用create deployment创建pod管理器方式创建pod;</li></ul> 
<pre><code>kubectl create deployment nginx1 --image=nginx --port=80 --replicas=3</code></pre> 
<p><img alt="" height="87" src="https://images2.imgbox.com/a8/fa/ZOfuM6ks_o.png" width="1200"></p> 
<p><img alt="" height="195" src="https://images2.imgbox.com/ea/5c/UqWmKKa2_o.png" width="1161"></p> 
<p><img alt="" height="496" src="https://images2.imgbox.com/37/d4/kjWLFdZv_o.png" width="1200"></p> 
<h2 id="%C2%A0%E4%B8%89%E3%80%81%E5%8F%91%E5%B8%83kubectl%20expose%E5%91%BD%E4%BB%A4"> 三、发布kubectl expose命令</h2> 
<p><strong>将资源暴露为新的Service</strong></p> 
<p>将Deployment的<a href="https://so.csdn.net/so/search?q=nginx&amp;spm=1001.2101.3001.7020" title="nginx">nginx</a>创建Service，并通过Service的80端口转发至容器的80的端口上，Service的名称为nginx，类型为NodePort</p> 
<pre><code>kubectl expose deployment nginx --port=80 --target-port=80 --name=nginx --type=NodePort
</code></pre> 
<p><img alt="" height="359" src="https://images2.imgbox.com/90/ca/fcA1WTu3_o.png" width="1200"></p> 
<h3 id="%C2%A01.service%E7%9A%84%E4%BD%9C%E7%94%A8"> 1.service的作用</h3> 
<ol><li>Kubernetes之所以需要Service，一方面是因为Pod的IP不是固定的（Pod可能会重建），另一方面是因为一组Pod实例之间总会有负载均衡的需求</li><li>Service通过Label Selector实现对一组Pod进行访问</li><li>对于容器应用而言，Kubernetes提供了基于VIP（虚拟IP）的网桥的方式访问Service，再由Service重定向到相应的Pod</li></ol> 
<h3 id="2.Service%E7%9A%84%E7%B1%BB%E5%9E%8B">2.Service的类型</h3> 
<ol><li>ClusterIP:提供一个集群内部的虚拟IP以供Pod访问（Service默认类型）</li><li>NodePort:在每个Node上打开一个端口以供外部访问，Kubernetes将会在每个Node上打开一个端口并且每个Node的端口都是一样的，通过NodeIP:NodePort的方式</li><li>LoadBalancer:通过外部的负载均衡器来访问，通常在云平台部署LoadBalancer还需要额外的费用。</li></ol> 
<h3 id="3.%E6%9F%A5%E7%9C%8BPod%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E5%92%8CService%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3">3.查看Pod网络状态详细信息和Service暴露端口</h3> 
<pre><code>kubectl get pods,svc -o wide
</code></pre> 
<p><img alt="" height="462" src="https://images2.imgbox.com/c9/58/DmtCMSYh_o.png" width="1200"></p> 
<h3 id="4.%E6%9F%A5%E7%9C%8B%E5%85%B3%E8%81%94%E5%90%8E%E7%AB%AF%E7%9A%84%E8%8A%82%E7%82%B9">4.查看关联后端的节点</h3> 
<pre><code>kubectl get endpoints
</code></pre> 
<p><img alt="" height="166" src="https://images2.imgbox.com/c6/96/4KJscOeg_o.png" width="1092"></p> 
<h3 id="%C2%A05.%E6%9F%A5%E7%9C%8Bservice%E7%9A%84%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0%E4%BF%A1%E6%81%AF"> 5.查看service的详细描述信息</h3> 
<pre><code>kubectl describe svc nginx
</code></pre> 
<p><img alt="" height="528" src="https://images2.imgbox.com/16/ef/Ia46CizJ_o.png" width="1200"></p> 
<h3 id="%C2%A06.%E8%AE%BF%E9%97%AE%E5%86%85%E9%83%A8IP%E6%9F%A5%E7%9C%8B"> 6.访问内部IP查看</h3> 
<p><img alt="" height="695" src="https://images2.imgbox.com/de/1c/4CXqdvgT_o.png" width="1200"></p> 
<pre><code>kubectl describe svc nginx | grep NodePort
curl 192.168.131.10:32395</code></pre> 
<p><img alt="" height="769" src="https://images2.imgbox.com/50/16/cjE8ZbtR_o.png" width="1200"></p> 
<h3 id="7.%E6%9F%A5%E7%9C%8B%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">7.查看访问日志</h3> 
<pre><code>kubectl logs []</code></pre> 
<p><img alt="" height="547" src="https://images2.imgbox.com/a3/d9/ZfmKxV4v_o.png" width="1200"></p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%9B%B4%E6%96%B0kubectl%20set">四、更新kubectl set</h2> 
<ul><li>更改现有应用资源一些信息。</li></ul> 
<p>kubectl set --help查看使用帮助</p> 
<h3 id="1.%E8%8E%B7%E5%8F%96%E4%BF%AE%E6%94%B9%E6%A8%A1%E6%9D%BF">1.获取修改模板</h3> 
<pre><code>kubectl set image --help获取
</code></pre> 
<p><img alt="" height="739" src="https://images2.imgbox.com/ce/f1/4VUZ9Jok_o.png" width="1200"></p> 
<h3 id="2.%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dnginx%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7">2.查看当前nginx的版本号</h3> 
<pre><code>curl -I 192.168.131.10:32395</code></pre> 
<p></p> 
<p><img alt="" height="409" src="https://images2.imgbox.com/96/8b/pZnuVWYs_o.png" width="909"></p> 
<h3 id="3.%E5%B0%86nginx%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E4%B8%BA1.15">3.将nginx版本更新为1.15</h3> 
<pre><code>kubectl set image deployment/nginx1 nginx=nginx:1.15
</code></pre> 
<p><img alt="" height="686" src="https://images2.imgbox.com/59/ec/H1lXIbrE_o.png" width="1156"></p> 
<h3 id="%C2%A04.%E7%9B%91%E5%90%ACpod%E7%8A%B6%E6%80%81"> 4.监听pod状态</h3> 
<p>处于动态监听pod状态，由于使用的是滚动更新方式，所以会先生成一个新的pod，然后删除一个旧的pod，往后以此类推</p> 
<pre><code>kubectl get pods -w
</code></pre> 
<p><img alt="" height="204" src="https://images2.imgbox.com/c1/eb/1LucfAwR_o.png" width="1136"></p> 
<p> 注：<strong>更新规则可通过“kubetl describe deployment nginx1”的“RollingUpdateStrategy”查看，默认配置为“25% max unavailable, 25% max surge”，即按照25%的比例进行滚动更新。</strong> </p> 
<p><img alt="" height="735" src="https://images2.imgbox.com/f0/a2/wHLyV7lw_o.png" width="1200"></p> 
<h3 id="%C2%A05.%E6%9F%A5%E7%9C%8Bpod%E7%9A%84IP%E5%8F%98%E5%8C%96"> 5.查看pod的IP变化</h3> 
<pre><code>kubectl get pod -o wide
</code></pre> 
<p><img alt="" height="230" src="https://images2.imgbox.com/69/60/kzLv4Uen_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E4%BA%94%E3%80%81%E5%9B%9E%E6%BB%9Akubectl%20rollout">五、回滚kubectl rollout</h2> 
<ul><li>对资源进行回滚管理</li></ul> 
<p><strong>kubectl rollout --help查看使用帮助</strong></p> 
<h3 id="1.%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC"><strong>1.查看历史版本</strong></h3> 
<pre><code>kubectl rollout history deployment/nginx1
</code></pre> 
<p><img alt="" height="191" src="https://images2.imgbox.com/b7/aa/PqerHcG5_o.png" width="1112"></p> 
<h3 id="2.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%89%88%E6%9C%AC">2.执行回滚到上一个版本</h3> 
<pre><code>kubectl rollout undo deployment/nginx
kubectl get pods -o wide</code></pre> 
<p><img alt="" height="769" src="https://images2.imgbox.com/6c/a2/LmV0gHnz_o.png" width="1163"></p> 
<h3 id="3.%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%BB%9A%E5%88%B0%E6%89%A7%E8%A1%8C%E7%89%88%E6%9C%AC">3.执行回滚到执行版本</h3> 
<h4 id="%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC">查看历史版本</h4> 
<p><img alt="" height="196" src="https://images2.imgbox.com/b3/f5/BtO4lLFP_o.png" width="1048"></p> 
<h4 id="%C2%A0%E5%9B%9E%E5%88%B0revision2%EF%BC%8C%E5%8D%B31.15%E7%89%88%E6%9C%AC"><strong> 回到revision2，即1.15版本</strong></h4> 
<pre><code>kubectl rollout undo deployment/nginx-service --to-revision=2</code></pre> 
<p><img alt="" height="769" src="https://images2.imgbox.com/71/4d/7IH7nAHk_o.png" width="1050"></p> 
<h3 id="4.%E6%A3%80%E6%9F%A5%E5%9B%9E%E6%BB%9A%E7%8A%B6%E6%80%81">4.检查回滚状态</h3> 
<pre><code>kubectl rollout status deployment/nginx-service
</code></pre> 
<p><img alt="" height="93" src="https://images2.imgbox.com/e7/cb/OAAyGsLK_o.png" width="935"></p> 
<h2 id="%C2%A0%E5%85%AD%E3%80%81%E5%88%A0%E9%99%A4kubectl%20delete"> 六、删除kubectl delete</h2> 
<h3 id="1.%E5%88%A0%E9%99%A4%E5%89%AF%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%99%A8">1.删除副本控制器</h3> 
<pre><code>kubectl delete deployment/nginx
</code></pre> 
<p><img alt="" height="284" src="https://images2.imgbox.com/06/47/aIkB8DcO_o.png" width="1048"></p> 
<h3 id="2.%E5%88%A0%E9%99%A4service">2.删除service</h3> 
<p><img alt="" src="https://images2.imgbox.com/48/d7/z2J0Udaf_o.png"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d551295f58ee7ec1f4e7bd03611448e7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">常见keil消除警告和报错</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c1e069bf38ad99e313b2041d7b75ab64/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows安装Linux子系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>