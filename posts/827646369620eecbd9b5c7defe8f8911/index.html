<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android相机开发那些坑 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android相机开发那些坑" />
<meta property="og:description" content="转载请标明出处：http://blog.csdn.net/xx326664162/article/details/53350551 文章出自：薛瑄的博客
在Android相机开发实际开发过程中遇到了不少问题，在网上找了这些资料，但是感觉如果没有经历过Android相机开发开发，直接看这些还是有点太抽象，建议参考一些代码来学习下面的内容
由于之前没有接触过Android相机开发，所以在整个开发过程中踩了不少坑，费了不少时间和精力。这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。
一.Android中开发相机应用的两种方式 Android系统提供了两种使用手机相机资源实现拍摄功能的方法，
一种是直接通过Intent调用系统相机组件，这种方法快速方便，适用于直接获得照片的场景，如上传相册，微博、朋友圈发照片等。另一种是使用相机API来定制自定义相机，这种方法适用于需要定制相机界面或者开发特殊相机功能的场景，如需要对照片做裁剪、滤镜处理，添加贴纸，表情，地点标签等。 这篇文章主要是从如何使用相机API来定制自定义相机这个方向展开的。
二.相机API中关键类解析 通过相机API实现拍摄功能涉及以下几个关键类和接口：
Camera：最主要的类，用于管理和操作camera资源。 它提供了完整的相机底层接口，支持相机资源切换，设置预览/拍摄尺寸，设定光圈、曝光、聚焦等相关参数，获取预览/拍摄帧数据等功能，主要方法有以下这些：
open()：获取camera实例。setPreviewDisplay(SurfaceHolder)：绑定绘制预览图像的surface。surface是指向屏幕窗口原始图像缓冲区（raw buffer）的一个句柄，通过它可以获得这块屏幕上对应的canvas，进而完成在屏幕上绘制View的工作。通过surfaceHolder可以将Camera和surface连接起来，当camera和surface连接后，camera获得的预览帧数据就可以通过surface显示在屏幕上了。setPrameters设置相机参数，包括前后摄像头，闪光灯模式、聚焦模式、预览和拍照尺寸等。startPreview():开始预览，将camera底层硬件传来的预览帧数据显示在绑定的surface上。stopPreview():停止预览，关闭camra底层的帧数据传递以及surface上的绘制。release():释放Camera实例takePicture(Camera.ShutterCallback shutter, Camera.PictureCallback raw, Camera.PictureCallback jpeg):这个是实现相机拍照的主要方法，包含了三个回调参数。shutter是快门按下时的回调，raw是获取拍照原始数据的回调，jpeg是获取经过压缩成jpg格式的图像数据的回调。 SurfaceView：用于绘制相机预览图像的类，提供给用户实时的预览图像。 普通的view以及派生类都是共享同一个surface的，所有的绘制都必须在UI线程中进行。而surfaceview是一种比较特殊的view，它并不与其他普通view共享surface，而是在内部持有了一个独立的surface,surfaceview负责管理这个surface的格式、尺寸以及显示位置。由于UI线程还要同时处理其他交互逻辑，因此对view的更新速度和帧率无法保证，而surfaceview由于持有一个独立的surface，因而可以在独立的线程中进行绘制，因此可以提供更高的帧率。自定义相机的预览图像由于对更新速度和帧率要求比较高，所以比较适合用surfaceview来显示。
SurfaceHolder：控制surface的一个抽象接口 它能够控制surface的尺寸和格式，修改surface的像素，监视surface的变化等等，surfaceholder的典型应用就是用于surfaceview中。surfaceview通过getHolder()方法获得surfaceholder 实例，通过后者管理监听surface 的状态。
SurfaceHolder.Callback接口：负责监听surface状态变化的接口， 有三个方法：
surfaceCreated(SurfaceHolder holder)：在surface创建后立即被调用。在开发自定义相机时，可以通过重载这个函数调用camera.open()、camera.setPreviewDisplay()，来实现获取相机资源、连接camera和surface等操作。surfaceChanged(SurfaceHolder holder, int format, int width, int height):在surface发生format或size变化时调用。在开发自定义相机时，可以通过重载这个函数调用camera.startPreview来开启相机预览，使得camera预览帧数据可以传递给surface，从而实时显示相机预览图像。surfaceDestroyed(SurfaceHolder holder)：在surface销毁之前被调用。在开发自定义相机时，可以通过重载这个函数调用camera.stopPreview()，camera.release()来实现停止相机预览及释放相机资源等操作。 三.自定义相机的开发过程 定制一个自定义相机应用，通常需要完成以下步骤，其流程图如图1所示：
检测并访问相机资源 检查手机是否存在相机资源，如果存在，请求访问相机资源。创建预览类 创建继承自SurfaceView并实现SurfaceHolder接口的拍摄预览类。此类能够显示相机的实时预览图像。建立预览布局 有了拍摄预览类，即可创建一个布局文件，将预览画面与设计好的用户界面控件融合在一起。设置拍照监听器 给用户界面控件绑定监听器，使其能响应用户操作（如按下按钮）, 开始拍照过程。拍照并保存文件 将拍摄获得的图像转换成位图文件，最终输出保存成各种常用格式的图片。释放相机资源 相机是一个共享资源，必须对其生命周期进行细心的管理。当相机使用完毕后，应用程序必须正确地将其释放，以免其它程序访问使用时，发生冲突。 四. 开发过程遇到的一些坑 下面再讲讲我在开发自定义相机时踩过的一些坑：
1.相机预览方向适配问题的产生 1.1、相机的安装方向如何获取？ Android官方提供orientation这个属性：表示相机预览图像顺时针旋转orientation度后才能与到设备自然方向一致。
假设设备是竖屏显示。后置相机传感器是横屏安装的。
你面向屏幕时，如果后置相机传感器所采集的图像的上边和设备自然方向的右边是平行的，则后置相机的orientation是90。
如果前置相机传感器所采集的图像的上边和设备自然方向的右边是平行的，则前置相机的orientation是270。
这个值，不同的设备有所差异，但大多数都是这样的值。
1.2、Activity设为竖屏时，SurfaceView预览图像为什么是逆时针旋转90度？ 说明这个问题之前，先介绍下Android手机上几个方向的概念：
屏幕方向：在Android系统中，屏幕的左上角是坐标系统的原点（0,0）坐标。原点向右延伸是X轴正方向，原点向下延伸是Y轴正方向。
图像传感器（Image Sensor）方向：手机相机的图像数据都是来自于摄像头硬件的图像传感器，这个传感器在被固定到手机上后有一个默认的取景方向，如下图2所示，坐标原点位于手机横放时的左上角，即与横屏应用的屏幕X方向一致。换句话说，与竖屏应用的屏幕X方向呈90度角。
相机的预览方向：将图像传感器捕获的图像，显示在屏幕上的方向。在默认情况下，与图像传感器方向一致。在相机API中可以通过setDisplayOrientation()设置相机预览方向。在默认情况下，这个值为0，与图像传感器方向一致。
对于横屏（这个activity设置的是横屏显示）来说，由于屏幕方向和预览方向一致，预览图像和看到的实物方向一致。对于竖屏（这个activity设置的是竖屏显示），屏幕方向和预览方向垂直，所以会出现颠倒90度现象，无论怎么旋转手机，显示在UI预览界面的画面与人眼看到的实物始终成90度（UI预览界面逆时针转了90度）。为了得到一致的预览画面，需要将相机的预览方向旋转90，保持与屏幕方向一致， 注意：设置预览方向并不会改变拍出照片的方向
如图3所示（红色箭头表示相机预览的x轴方向，蓝色箭头表示屏幕的x轴方向）。
下面是Camera.setDisplayOrientation的注释文档：
/** * Set the clockwise rotation of preview display in degrees." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/827646369620eecbd9b5c7defe8f8911/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-06T14:05:49+08:00" />
<meta property="article:modified_time" content="2016-05-06T14:05:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android相机开发那些坑</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:0px; margin-bottom:0.75em; font-size:16px; line-height:27.2000007629395px; text-indent:1em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Tahoma,Arial,STXihei,'Microsoft YaHei',微软雅黑,sans-serif; background-color:rgb(254,254,254)"> </p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 转载请标明出处：<a target="_blank" href="http://blog.csdn.net/xx326664162/article/details/53350551" style="text-decoration:none; color:rgb(12,137,207)" rel="noopener noreferrer">http://blog.csdn.net/xx326664162/article/details/53350551</a> 文章出自：<a target="_blank" href="http://blog.csdn.net/xx326664162" style="text-decoration:none; color:rgb(12,137,207)" rel="noopener noreferrer">薛瑄的博客</a></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 在<a target="_blank" href="http://lib.csdn.net/base/android" rel="nofollow noopener noreferrer" class="replace_word" title="Android知识库" style="text-decoration:none; color:rgb(223,52,52); font-weight:bold">Android</a>相机开发实际开发过程中遇到了不少问题，在网上找了这些资料，但是感觉如果没有经历过Android相机开发开发，直接看这些还是有点太抽象，建议参考一些代码来学习下面的内容</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 由于之前没有接触过Android相机开发，所以在整个开发过程中踩了不少坑，费了不少时间和精力。这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。</p> 
<h2 id="一android中开发相机应用的两种方式" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t0" style="color:rgb(12,137,207)"></a>一.Android中开发相机应用的两种方式</h2> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> Android系统提供了两种使用手机相机资源实现拍摄功能的方法，</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">一种是直接通过Intent调用系统相机组件，这种方法快速方便，适用于直接获得照片的场景，如上传相册，微博、朋友圈发照片等。</li><li style="">另一种是使用相机API来定制自定义相机，这种方法适用于需要定制相机界面或者开发特殊相机功能的场景，如需要对照片做裁剪、滤镜处理，添加贴纸，表情，地点标签等。</li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">这篇文章主要是从如何使用相机API来定制自定义相机这个方向展开的</span>。</p> 
<h2 id="二相机api中关键类解析" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t1" style="color:rgb(12,137,207)"></a>二.相机API中关键类解析</h2> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 通过相机API实现拍摄功能涉及以下几个关键类和接口：</p> 
<h3 id="camera最主要的类用于管理和操作camera资源" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t2" style="color:rgb(12,137,207)"></a>Camera：最主要的类，用于管理和操作camera资源。</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 它提供了完整的相机底层接口，支持相机资源切换，设置预览/拍摄尺寸，设定光圈、曝光、聚焦等相关参数，获取预览/拍摄帧数据等功能，主要方法有以下这些：</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">open()：获取camera实例。</li><li style="">setPreviewDisplay(SurfaceHolder)：绑定绘制预览图像的surface。surface是指向屏幕窗口原始图像缓冲区（raw buffer）的一个句柄，通过它可以获得这块屏幕上对应的canvas，进而完成在屏幕上绘制View的工作。通过surfaceHolder可以将Camera和surface连接起来，当camera和surface连接后，camera获得的预览帧数据就可以通过surface显示在屏幕上了。</li><li style="">setPrameters设置相机参数，包括前后摄像头，闪光灯模式、聚焦模式、预览和拍照尺寸等。</li><li style="">startPreview():开始预览，将camera底层硬件传来的预览帧数据显示在绑定的surface上。</li><li style="">stopPreview():停止预览，关闭camra底层的帧数据传递以及surface上的绘制。</li><li style="">release():释放Camera实例</li><li style="">takePicture(Camera.ShutterCallback shutter, Camera.PictureCallback raw, Camera.PictureCallback jpeg):这个是实现相机拍照的主要方法，包含了三个回调参数。shutter是快门按下时的回调，raw是获取拍照原始数据的回调，jpeg是获取经过压缩成jpg格式的图像数据的回调。</li></ul> 
<h3 id="surfaceview用于绘制相机预览图像的类提供给用户实时的预览图像" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t3" style="color:rgb(12,137,207)"></a>SurfaceView：用于绘制相机预览图像的类，提供给用户实时的预览图像。</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 普通的view以及派生类都是共享同一个surface的，所有的绘制都必须在UI线程中进行。而surfaceview是一种比较特殊的view，它并不与其他普通view共享surface，而是在内部持有了一个独立的surface,surfaceview负责管理这个surface的格式、尺寸以及显示位置。由于UI线程还要同时处理其他交互逻辑，因此对view的更新速度和帧率无法保证，而surfaceview由于持有一个独立的surface，因而可以在独立的线程中进行绘制，因此可以提供更高的帧率。自定义相机的预览图像由于对更新速度和帧率要求比较高，所以比较适合用surfaceview来显示。</p> 
<h3 id="surfaceholder控制surface的一个抽象接口" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t4" style="color:rgb(12,137,207)"></a>SurfaceHolder：控制surface的一个抽象接口</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 它能够控制surface的尺寸和格式，修改surface的像素，监视surface的变化等等，surfaceholder的典型应用就是用于surfaceview中。surfaceview通过getHolder()方法获得surfaceholder 实例，通过后者管理监听surface 的状态。</p> 
<h3 id="surfaceholdercallback接口负责监听surface状态变化的接口" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t5" style="color:rgb(12,137,207)"></a>SurfaceHolder.Callback接口：负责监听surface状态变化的接口，</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 有三个方法：</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">surfaceCreated(SurfaceHolder holder)：在surface创建后立即被调用。在开发自定义相机时，可以通过重载这个函数调用camera.open()、camera.setPreviewDisplay()，来实现获取相机资源、连接camera和surface等操作。</li><li style="">surfaceChanged(SurfaceHolder holder, int format, int width, int height):在surface发生format或size变化时调用。在开发自定义相机时，可以通过重载这个函数调用camera.startPreview来开启相机预览，使得camera预览帧数据可以传递给surface，从而实时显示相机预览图像。</li><li style="">surfaceDestroyed(SurfaceHolder holder)：在surface销毁之前被调用。在开发自定义相机时，可以通过重载这个函数调用camera.stopPreview()，camera.release()来实现停止相机预览及释放相机资源等操作。</li></ul> 
<h2 id="三自定义相机的开发过程" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t6" style="color:rgb(12,137,207)"></a>三.自定义相机的开发过程</h2> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 定制一个自定义相机应用，通常需要完成以下步骤，其流程图如图1所示：</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">检测并访问相机资源 检查手机是否存在相机资源，如果存在，请求访问相机资源。</li><li style="">创建预览类 创建继承自SurfaceView并实现SurfaceHolder接口的拍摄预览类。此类能够显示相机的实时预览图像。</li><li style="">建立预览布局 有了拍摄预览类，即可创建一个布局文件，将预览画面与设计好的用户界面控件融合在一起。</li><li style="">设置拍照监听器 给用户界面控件绑定监听器，使其能响应用户操作（如按下按钮）, 开始拍照过程。</li><li style="">拍照并保存文件 将拍摄获得的图像转换成位图文件，最终输出保存成各种常用格式的图片。</li><li style="">释放相机资源 相机是一个共享资源，必须对其生命周期进行细心的管理。当相机使用完毕后，应用程序必须正确地将其释放，以免其它程序访问使用时，发生冲突。 <br style=""> <img src="https://images2.imgbox.com/f6/d8/YQqCyf49_o.jpg" alt="这里写图片描述" title="" style="border:none"></li></ul> 
<h2 id="四-开发过程遇到的一些坑" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t7" style="color:rgb(12,137,207)"></a>四. 开发过程遇到的一些坑</h2> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下面再讲讲我在开发自定义相机时踩过的一些坑：</p> 
<h3 id="1相机预览方向适配问题的产生" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t8" style="color:rgb(12,137,207)"></a>1.相机预览方向适配问题的产生</h3> 
<h4 id="11相机的安装方向如何获取" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t9" style="color:rgb(12,137,207)"></a>1.1、相机的安装方向如何获取？</h4> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> Android官方提供orientation这个属性：表示相机预览图像顺时针旋转orientation度后才能与到设备自然方向一致。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 假设设备是竖屏显示。后置相机传感器是横屏安装的。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 你面向屏幕时，如果后置相机传感器所采集的图像的上边和设备自然方向的右边是平行的，则后置相机的orientation是90。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 如果前置相机传感器所采集的图像的上边和设备自然方向的右边是平行的，则前置相机的orientation是270。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">这个值，不同的设备有所差异，但大多数都是这样的值。</span></p> 
<h4 id="12activity设为竖屏时surfaceview预览图像为什么是逆时针旋转90度" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t10" style="color:rgb(12,137,207)"></a>1.2、Activity设为竖屏时，SurfaceView预览图像为什么是逆时针旋转90度？</h4> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 说明这个问题之前，先介绍下Android手机上几个方向的概念：</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">屏幕方向：</span>在Android系统中，屏幕的左上角是坐标系统的原点（0,0）坐标。原点向右延伸是X轴正方向，原点向下延伸是Y轴正方向。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">图像传感器（Image Sensor）方向：</span>手机相机的图像数据都是来自于摄像头硬件的图像传感器，这个传感器在被固定到手机上后有一个默认的取景方向，如下图2所示，坐标原点位于手机横放时的左上角，即与横屏应用的屏幕X方向一致。换句话说，与竖屏应用的屏幕X方向呈90度角。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/5a/68/rPua9a83_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">相机的预览方向：</span>将图像传感器捕获的图像，显示在屏幕上的方向。在默认情况下，与图像传感器方向一致。在相机API中可以通过<span style="">setDisplayOrientation()</span>设置相机预览方向。在默认情况下，这个值为0，与图像传感器方向一致。</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">对于横屏（这个activity设置的是横屏显示）来说，由于屏幕方向和预览方向一致，预览图像和看到的实物方向一致。</li><li style="">对于竖屏（这个activity设置的是竖屏显示），屏幕方向和预览方向垂直，所以会出现颠倒90度现象，无论怎么旋转手机，显示在UI预览界面的画面与人眼看到的实物始终成90度（UI预览界面逆时针转了90度）。为了得到一致的预览画面，需要将相机的预览方向旋转90，保持与屏幕方向一致，</li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="color:red">注意：设置预览方向并不会改变拍出照片的方向</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 如图3所示（红色箭头表示相机预览的x轴方向，蓝色箭头表示屏幕的x轴方向）。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/12/1d/BbPeOqih_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下面是Camera.setDisplayOrientation的注释文档：</p> 
<pre class="prettyprint" name="code" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 0px solid rgb(136, 136, 136); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);"><code class="hljs applescript has-numbering" style="display: block; padding: 0px; color: inherit; box-sizing: border-box; font-family: 'Source Code Pro', monospace;font-size:undefined; white-space: pre; border-radius: 0px; word-wrap: normal; background: transparent;">/**
 * Set <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> clockwise rotation <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">of</span> preview display <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">in</span> degrees. This affects
 * <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> preview frames <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">and</span> <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> picture displayed <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">after</span> snapshot. This method
 * <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">is</span> useful <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">for</span> portrait mode applications. Note <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">that</span> preview display <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">of</span>
 * <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">front</span>-facing cameras <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">is</span> flipped horizontally <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">before</span> <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> rotation, <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">that</span>
 * <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">is</span>, <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> image <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">is</span> reflected along <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> central vertical axis <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">of</span> <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> camera
 * sensor. So <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> users can see themselves <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">as</span> looking <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">into</span> a mirror.
 *
 * &lt;p&gt;This <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">does</span> <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">not</span> affect <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">the</span> order <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">of</span> byte array passed <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">in</span> {@link
 * PreviewCallback<span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">#onPreviewFrame}, JPEG pictures, or recorded videos. This</span>
 * method <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">is</span> <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">not</span> allowed <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">to</span> be called during preview.     
 */

public native final void setDisplayOrientation(int degrees);</code>
 
 </pre><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li></ul>
 
 <ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 注释中的第二段，描述了这个API修改的仅仅是Camera的预览方向而已，并不会影响到PreviewCallback回调、生成的JPEG图片和录像文件的方向，这些数据的方向依然会跟图像Sensor的方向一致。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="color:red"><span style="">看到这里，相信你肯定有疑问，按照这样旋转的话，UI预览图应该是顺时针旋转90度才对啊，但为什么实际上是逆时针旋转</span></span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 在开始分析前，先熟悉一个概念</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">自然方向（natrual orientation）</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 每个设备都有一个自然方向，手机和平板的自然方向不同。Android:screenOrientation的默认值unspecified即为自然方向。 <br style=""> 关于orientation的两个常见值是这样定义的： <br style=""> <span style="">landscape（横屏）</span>：the display is wider than it is tall，正常拿着设备的时候，宽比高长，这是平板的自然方向。 <br style=""> <span style="">portrait（竖屏）</span>：the display is taller than it is wide，正常拿设备的时候，宽比高短，这是手机的自然方向。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下图是MI3手机的屏幕“自然”方向和后置相机的图像传感器方向。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">后置相机的orientation是90</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/ef/b8/StyCFu9k_o.png" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 1、图像传感器获得到图像后，就知道了这幅图像每个坐标的像素值，但是要显示到屏幕上，就要按照屏幕的坐标系来显示，于是就需要将图像传感器的坐标系逆时针旋转90度，才能显示到屏幕的坐标系上， <br style=""> 2、于是看到的图像逆时针旋转了90度，因此需要顺时针旋转90度，才能与手机的自然方向保持一致。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/60/09/3R9s73hQ_o.png" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<h4 id="13-前置摄像头的镜像效果" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t11" style="color:rgb(12,137,207)"></a>1.3、 前置摄像头的镜像效果</h4> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> Android相机硬件有个特殊设定，就是对于前置摄像头，</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 在预览图像是真实场景的镜像，</p> </li><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 拍出的照片和真实场景一样。</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">以MI3为例</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 通过程序调用取到的后置相机的orientation是90，前置相机的orientation是270。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> orientation可以理解为<span style="">图像传感器方向</span>顺时针旋转到<span style="">屏幕自然方向</span>的角度。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下图所示是MI3手机的后置相机和前置相机对准同一个小人，后置前置相机采集到的图像、前置相机预览的图像。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">后置</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 对于后置相机，相机<span style="">预览的图像</span>和相机<span style="">采集到的图像</span>是一样的。只需要旋转后置相机orientation度，即90度即可和屏幕方向保持一致；</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">前置</span></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 对于前置相机来说，相机<span style="">预览的图像</span>和相机<span style="">采集到的图像</span>是镜像关系， 注意下图小人头发在前置采集的图像和预览图像中头发是相反的。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 因此在MI3手机上做竖屏应用时，</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">采集的图像：</span>顺时针旋转270度后，与屏幕方向一致</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <span style="">预览的图像：</span>顺时针旋转90度后，与屏幕方向一致.（因为底层相机对采集的图像做了镜像处理，所以只需转90度）</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/06/38/gI1Zb4a3_o.png" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 1 、图像传感器获得到图像后，就知道了这幅图像每个坐标的像素值，但是要显示到屏幕上，就要按照屏幕的坐标系来显示，于是就需要将图像传感器的坐标系顺时针旋转90度，才能显示到屏幕的坐标系上，于是看到的图像顺时针旋转了90度</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 2、也就是说前置摄像头获取到的图像（未经镜像处理）需要顺时针旋转270，才能和手机的自然方向一致（上图第二行）</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 3、但是在预览的时候，做了镜像处理后，只需要顺时针旋转90度，就能和手机的自然方向一致。（如上图第三行）：</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下图显示了，屏幕的坐标系和前置摄像头的坐标系</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/78/f4/1zy6p7DE_o.png" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下图简单显示了，横屏和竖屏的情况</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/38/27/zx1AVytr_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 此外，由于拍摄图像并没有做水平翻转，所以对于前置摄像头拍出来的照片，用户会发现跟预览时所见的是左右翻转的。可以根据自己的需求进行处理。</p> 
<h4 id="14官方推荐的相机预览方向适配做法" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t12" style="color:rgb(12,137,207)"></a>1.4、官方推荐的相机预览方向适配做法</h4> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 通过orientation属性的含义可以知道，我们可以用它和应用的方向来做相机预览方向的适配，下面代码是官方网站推荐的。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 但并不是所有手机的orientation值都靠谱，比如VIVO V1手机第一次获取后置相机的CameraInfo的orientation值是90，而当执行了mCamera = Camera.open();之后再获取CameraInfo的orientation值就是0，而且以后获取的都是 0 ，除非重启手机。无论是这款手机上的哪个应用，只要执行了一次Camera.open()之后，其他所有程序中获取CameraInfo的orientation都是是0。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 因此按照此方法做适配不能解决所有手机上的问题。</p> 
<pre class="prettyprint" name="code" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 0px solid rgb(136, 136, 136); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);"><code class="hljs glsl has-numbering" style="display: block; padding: 0px; color: inherit; box-sizing: border-box; font-family: 'Source Code Pro', monospace;font-size:undefined; white-space: pre; border-radius: 0px; word-wrap: normal; background: transparent;"> public static <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">void</span> setCameraDisplayOrientation(Activity activity,
     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">int</span> cameraId, android.hardware.Camera camera) {
     android.hardware.Camera.CameraInfo info = new android.hardware.Camera.CameraInfo();
     android.hardware.Camera.getCameraInfo(cameraId, info);
     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">int</span> rotation = activity.getWindowManager().getDefaultDisplay().getRotation();
     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">int</span> <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">0</span>;
     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">switch</span> (rotation) {
         <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">case</span> Surface.ROTATION_0: <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">0</span>; <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">break</span>;
         <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">case</span> Surface.ROTATION_90: <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">90</span>; <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">break</span>;
         <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">case</span> Surface.ROTATION_180: <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">180</span>; <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">break</span>;
         <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">case</span> Surface.ROTATION_270: <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">270</span>; <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">break</span>;
     }

     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">int</span> result;
     <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">if</span> (info.facing == Camera.CameraInfo.CAMERA_FACING_FRONT) {
         result = (info.orientation + <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span>) % <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">360</span>;
         result = (<span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">360</span> - result) % <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">360</span>;  <span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">// compensate the mirror</span>
     } <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">else</span> {  <span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">// back-facing</span>
         result = (info.orientation - <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">degrees</span> + <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">360</span>) % <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">360</span>;
     }
     camera.setDisplayOrientation(result);
 }</code>
 
 </pre><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li><li style="box-sizing: border-box; padding: 0px 5px;">15</li><li style="box-sizing: border-box; padding: 0px 5px;">16</li><li style="box-sizing: border-box; padding: 0px 5px;">17</li><li style="box-sizing: border-box; padding: 0px 5px;">18</li><li style="box-sizing: border-box; padding: 0px 5px;">19</li><li style="box-sizing: border-box; padding: 0px 5px;">20</li><li style="box-sizing: border-box; padding: 0px 5px;">21</li><li style="box-sizing: border-box; padding: 0px 5px;">22</li></ul>
 
 <ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li><li style="box-sizing: border-box; padding: 0px 5px;">15</li><li style="box-sizing: border-box; padding: 0px 5px;">16</li><li style="box-sizing: border-box; padding: 0px 5px;">17</li><li style="box-sizing: border-box; padding: 0px 5px;">18</li><li style="box-sizing: border-box; padding: 0px 5px;">19</li><li style="box-sizing: border-box; padding: 0px 5px;">20</li><li style="box-sizing: border-box; padding: 0px 5px;">21</li><li style="box-sizing: border-box; padding: 0px 5px;">22</li></ul> 
<h3 id="2camera的拍照方向" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t13" style="color:rgb(12,137,207)"></a>2、Camera的拍照方向</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 当你点击拍照按钮，得到的图片方向不一定与画面中预览的方向一致，这是因为拍摄的照片是将图像Sensor采集到的数据直接存储到SDCard上的，因此，Camera的拍照方向与上述的Camera的图像Sensor方向一致。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 为了演示这个问题，我用手机的Camera对同一个场景拍了两张照片，第一张是横着拿手机拍的，第二张是竖着拿手机拍的。然后用在电脑上打开得到的图片（实际场景中的杯子是竖着的），效果如下所示：</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/f3/9c/q7uAPDzk_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 由此可见，如果横向拿手机拍照，由于正好与Camera的拍照方向一致，因此得到的照片是“正确”的；而竖着拿手机拍照的话，Camera的图像Sensor依然以上面描述的角度在采集图像并存储到SDCard上，所以得到的图片就是右图这样的，因为竖着拿手机正好与图像Sensor的方向相差了90度。由此，大家应该明白了为什么我们用手机拍出的照片经常需要旋转90度才能看到“正确”的画面了吧？</p> 
<h3 id="3-surfaceview预览图像拍摄照片拉伸变形" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t14" style="color:rgb(12,137,207)"></a>3. SurfaceView预览图像、拍摄照片拉伸变形</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 说明这个问题之前，同样先说一下几个跟相机有关的尺寸。</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> SurfaceView尺寸：即自定义相机应用中用于显示相机预览图像的View的尺寸，当它铺满全屏时就是屏幕的大小。这里surfaceview显示的预览图像暂且称作手机预览图像。</p> </li><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> Previewsize：相机硬件提供的预览帧数据尺寸。预览帧数据传递给SurfaceView，实现预览图像的显示。这里预览帧数据对应的预览图像暂且称作相机预览图像。</p> </li><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> Picturesize：相机硬件提供的拍摄帧数据尺寸。拍摄帧数据可以生成位图文件，最终保存成.jpg或者.png等格式的图片。这里拍摄帧数据对应的图像称作相机拍摄图像。图4说明了以上几种图像及照片之间的关系。手机预览图像是直接提供给用户看的图像，它由相机预览图像生成，拍摄照片的数据则来自于相机拍</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/03/c7/ZCkWqYIQ_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 下面说下我在开发过程中遇到的三种拉伸变形现象：</p> 
<ol style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style="">手机预览画面中物体被拉伸变形。</li><li style="">拍摄照片中物体被拉伸变形。</li><li style="">点击拍照瞬间，手机预览画面会停顿下，此时的图像是拉伸变形的，然后预览画面恢复后图像又正常了。</li></ol> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 现象1的原因是SurfaceView和Previewsize的长宽比率不一致。因为手机预览视图的图像是由相机预览图像根据SurfaceView大小缩放得来的，当长宽比不一致时必然会导致图像变形。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 后两个现象的原因则是Previewsize和Picturesize的长宽比率不一致所致，查了相关的资料，发现其具体原因跟某些手机相机硬件的底层实现有关。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 总之为了避免以上几种变形现象的发生，在开发时最好将SurfaceView、PreviewSize、PictureSize三个尺寸保证长宽比例一致。具体实现可以先通过camera.getSupportedPreviewSizes()和camera.getSupportedPictureSizes()获得相机硬件支持的所有预览和拍摄尺寸，然后在里面筛选出和SurfaceView的长宽比一致并且大小合适的尺寸，通过camera.setPrameters来更新设置。注意：市场上手机相机硬件支持的尺寸一般都是主流的4:3或者16:9，所以SurfaceView尺寸不能太奇葩，最好也设置成这样的长宽比。</p> 
<h3 id="4-各种crash" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t15" style="color:rgb(12,137,207)"></a>4. 各种crash</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/56/a1/o4tT0iaP_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/18/a2/l7KFybeY_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/60/c4/TyHPJgDL_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 前两个Crash的原因是：相机硬件在聚焦和拍照前必须要保证已经连接到surface，并且开启相机预览，surface有收到预览数据。如果在还没有执行camera. setPreviewDisplay或者未调用camera. startPreview之前,就调用camera.autofocus或camera.takepicture，就会出现这个运行时异常。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 对应到自定义相机的代码中，要注意在拍照按钮事件响应中执行camera.autofocus或camera.takepicture前，一定要检验camera有没有设置预览Surfaceview并开启了相机预览。这里有个方法可以判断预览状态：Camera.setPreviewCallback是预览帧数据的回调函数，它会在SurfaceView收到相机的预览帧数据时被调用，因此在里面可以设置是否允许对焦和拍照的标志位。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/1e/f8/Wv7GVQzp_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 还有一点要注意，camera.takePicture()在执行过程中会执行camera.stopPreview来获取拍摄帧数据，表现为预览画面卡住，而如果此时用户点击了按钮的话，也就是调用camera.takepicture，也会出现上面的crash，因此在开发时，可能还需要屏蔽拍照按钮的连续点击。 <br style=""> 第三个crash则涉及图像的裁剪，由于要支持1：1或者4：3尺寸镜头，所以会需要对预览视图进行裁剪，由于是竖屏应用，所以裁剪区域的坐标系跟相机传感器方向是成90度角的，表现在裁剪里就是，屏幕上的x方向，对应在拍摄图像上是高度方向，而屏幕上的y方向，对应到拍摄图像上则是宽度方向。因此在计算时要一定注意坐标系的转换以及越界保护。</p> 
<h3 id="5-锁屏下相机资源的释放问题" style="margin:0.8em 0px; padding:0px; font-weight:100; color:rgb(85,85,85); font-family:'microsoft yahei'; line-height:35px"> <a target="_blank" name="t16" style="color:rgb(12,137,207)"></a>5. 锁屏下相机资源的释放问题</h3> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 为了节省手机电量，不浪费相机资源，在开发的自定义相机里，如果预览图像已不需要显示，如按Home键盘切换后台或者锁屏后，此时就应该关闭预览并把相机资源释放掉。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 参考官方API文档，</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 当surfaceView变成可见时，会创建surface并触发surfaceHolder.callback接口中surfaceCreated回调函数。</p> </li><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 而surfaceview变成不可见时，则会销毁surface，并触发surfacedestroyed回调函数。</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 我们可以在对应的回调函数里，处理相机的相关操作，如连接surface、开启/关闭预览。 至于相机资源释放，则可以放在Acticity的onpause里执行。相应的，要重新恢复预览图像时，可以把相机资源申请和初始化放在Acticity的onResume里执行，然后通过创建surfaceview，将camera和surface相连并开启预览。 <br style=""> <img src="https://images2.imgbox.com/3a/14/apFXTlqA_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 但是在开发过程中发现，对于按HOME键切后台场景，程序可以正常运行。对于锁屏场景，则在重新申请相机资源时会发生crash，说相机资源访问失败。那么原因是什么呢？我在代码里增加了调试log， 检查了代码的执行顺序，结果如下：</p> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> 在自定义相机页面按HOME键时的执行流程：</p> 
<ul style="color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 程序运行-&gt;按HOME键 <br style=""> Activity调用的顺序是onPause-&gt;onStop <br style=""> SurfaceView调用了surfaceDestroyed方法 <br style=""> 然后再切回程序 <br style=""> Activity调用的顺序是onRestart-&gt;onStart-&gt;onResume <br style=""> SurfaceView调用了surfaceCreated-&gt;surfaceChanged方法</p> </li><li style=""> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 而对于锁屏，其执行流程则是： <br style=""> Activity只调用onPause方法 <br style=""> 解锁后Activity调用onResume方法 <br style=""> <span style="color:red">SurfaceView中surfaceholder.callback的所有方法都没有执行</span></p> <p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"> 问题找到了，由于锁屏时，callback的回调方法没有执行，导致相机和预览的连接还没有断开，相机资源就被释放了，所以导致在重新申请相机资源时，系统报crash。根据上面的文档，推测是锁屏下系统并没有改变surfaceview的可见性，于是我尝试在onPause和onResume时通过手动设置surfaceview的visibile属性，结果发现可以正常触发回调函数了。由于在切后台或者锁屏时，用户本来就应该看不到surfaceview，因此这种手动更改surfaceview的可见性的方法，并不会对用户的体验造成影响。</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px; color:rgb(85,85,85); font-family:'microsoft yahei'; font-size:14px; line-height:35px"> <img src="https://images2.imgbox.com/f3/ba/1SyvtWMN_o.jpg" alt="这里写图片描述" title="" style="border:none; max-width:602px; height:auto"></p> 
<p style="margin-top:0px; margin-bottom:0.75em; font-size:16px; line-height:27.2000007629395px; text-indent:1em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Tahoma,Arial,STXihei,'Microsoft YaHei',微软雅黑,sans-serif; background-color:rgb(254,254,254)"> <a target="_blank" class="cut cut70" href="http://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=401454605&amp;idx=1&amp;sn=d5a16f6dc13e7581fec08a4e704cd5d0&amp;scene=0#wechat_redirect&amp;utm_source=tuicool&amp;utm_medium=referral" rel="nofollow noopener noreferrer" style=""></a><br> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95677df7f51bd9ea73b18cbc03b10c4e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一次完整的HTTP过程请求步骤（输入一个URL回车，到返回页面）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c2c10d8f2afae1e474c5605620bf764/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hibernate的HQL和原生SQL返回简单对象</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>