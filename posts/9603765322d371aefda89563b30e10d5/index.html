<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【K8S 的二进制搭建】 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【K8S 的二进制搭建】" />
<meta property="og:description" content="目录 一、二进制搭建 Kubernetes v1.201、准备环境 二、操作系统初始化配置三、部署 etcd 集群1、准备签发证书环境2、在 master01 节点上操作1、生成Etcd证书 3、在 node01 节点上操作4、在 node02 节点上操作 四、部署 Master 组件五、部署 docker引擎六、部署 Worker Node 组件1、在所有 node 节点上操作1、在 master01 节点上操作 2、在 node01 节点上操作3、在 master01 节点上操作，通过 CSR 请求4、在 node01 节点上操作5、自动批准CSR请求 七、部署 CNI 网络组件1、在 node01 节点上操作2、在node2节点上进行操作3、在 master01 节点上操作 八、部署 CoreDNS1、在所有 node 节点上操作2、在 master01 节点上操作3、master02 节点部署4、负载均衡部署1、修改nginx配置文件，配置四层反向代理负载均衡，指定k8s群集2台master的节点ip和6443端口2、在 master01 节点上操作 九、部署 Dashboard1、在 master01 节点上操作 一、二进制搭建 Kubernetes v1.20 1、准备环境 k8s集群master01：192.168.102.10	kube-apiserver kube-controller-manager kube-scheduler etcd k8s集群master02：192.168.102.20 k8s集群node01：192.168.102.30	kubelet kube-proxy docker k8s集群node02：192.168.102.40 etcd集群节点1：192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/9603765322d371aefda89563b30e10d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-09T14:49:58+08:00" />
<meta property="article:modified_time" content="2023-08-09T14:49:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【K8S 的二进制搭建】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_Kubernetes_v120_4" rel="nofollow">一、二进制搭建 Kubernetes v1.20</a></li><li><ul><li><a href="#1_5" rel="nofollow">1、准备环境</a></li></ul> 
  </li><li><a href="#_22" rel="nofollow">二、操作系统初始化配置</a></li><li><a href="#_etcd__98" rel="nofollow">三、部署 etcd 集群</a></li><li><ul><li><a href="#1_112" rel="nofollow">1、准备签发证书环境</a></li><li><a href="#2_master01__122" rel="nofollow">2、在 master01 节点上操作</a></li><li><ul><li><a href="#1Etcd_143" rel="nofollow">1、生成Etcd证书</a></li></ul> 
   </li><li><a href="#3_node01__198" rel="nofollow">3、在 node01 节点上操作</a></li><li><a href="#4_node02__212" rel="nofollow">4、在 node02 节点上操作</a></li></ul> 
  </li><li><a href="#_Master__247" rel="nofollow">四、部署 Master 组件</a></li><li><a href="#_docker_377" rel="nofollow">五、部署 docker引擎</a></li><li><a href="#_Worker_Node__403" rel="nofollow">六、部署 Worker Node 组件</a></li><li><ul><li><a href="#1_node__404" rel="nofollow">1、在所有 node 节点上操作</a></li><li><ul><li><a href="#1_master01__417" rel="nofollow">1、在 master01 节点上操作</a></li></ul> 
   </li><li><a href="#2_node01__449" rel="nofollow">2、在 node01 节点上操作</a></li><li><a href="#3_master01__CSR__458" rel="nofollow">3、在 master01 节点上操作，通过 CSR 请求</a></li><li><a href="#4_node01__472" rel="nofollow">4、在 node01 节点上操作</a></li><li><a href="#5CSR_486" rel="nofollow">5、自动批准CSR请求</a></li></ul> 
  </li><li><a href="#_CNI__507" rel="nofollow">七、部署 CNI 网络组件</a></li><li><ul><li><a href="#1_node01__568" rel="nofollow">1、在 node01 节点上操作</a></li><li><a href="#2node2_585" rel="nofollow">2、在node2节点上进行操作</a></li><li><a href="#3_master01__602" rel="nofollow">3、在 master01 节点上操作</a></li></ul> 
  </li><li><a href="#_CoreDNS_613" rel="nofollow">八、部署 CoreDNS</a></li><li><ul><li><a href="#1_node__614" rel="nofollow">1、在所有 node 节点上操作</a></li><li><a href="#2_master01__622" rel="nofollow">2、在 master01 节点上操作</a></li><li><a href="#3master02__643" rel="nofollow">3、master02 节点部署</a></li><li><a href="#4_677" rel="nofollow">4、负载均衡部署</a></li><li><ul><li><a href="#1nginxk8s2masterip6443_696" rel="nofollow">1、修改nginx配置文件，配置四层反向代理负载均衡，指定k8s群集2台master的节点ip和6443端口</a></li><li><a href="#2_master01__812" rel="nofollow">2、在 master01 节点上操作</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_Dashboard_845" rel="nofollow">九、部署 Dashboard</a></li><li><ul><li><a href="#1_master01__850" rel="nofollow">1、在 master01 节点上操作</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_Kubernetes_v120_4"></a>一、二进制搭建 Kubernetes v1.20</h2> 
<h3><a id="1_5"></a>1、准备环境</h3> 
<pre><code class="prism language-bash">k8s集群master01：192.168.102.10	kube-apiserver kube-controller-manager kube-scheduler etcd
k8s集群master02：192.168.102.20

k8s集群node01：192.168.102.30	kubelet kube-proxy <span class="token function">docker</span> 
k8s集群node02：192.168.102.40

etcd集群节点1：192.168.102.10	etcd
etcd集群节点2：192.168.102.30
etcd集群节点3：192.168.102.40

负载均衡nginx+keepalive01（master）：192.168.102.50
负载均衡nginx+keepalive02（backup）：192.168.102.60
</code></pre> 
<h2><a id="_22"></a>二、操作系统初始化配置</h2> 
<p><font face="微软雅黑" size="4"><b>1、关闭防火墙</b></font></p> 
<pre><code class="prism language-bash">systemctl stop firewalld
systemctl disable firewalld
iptables <span class="token parameter variable">-F</span> <span class="token operator">&amp;&amp;</span> iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-F</span> <span class="token operator">&amp;&amp;</span> iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-F</span> <span class="token operator">&amp;&amp;</span> iptables <span class="token parameter variable">-X</span>
</code></pre> 
<p><font face="微软雅黑" size="4"><b>2、关闭selinux</b></font></p> 
<pre><code class="prism language-bash">setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/enforcing/disabled/'</span> /etc/selinux/config
</code></pre> 
<p><font face="微软雅黑" size="4"><b>3、关闭swap</b></font></p> 
<pre><code class="prism language-bash">swapoff <span class="token parameter variable">-a</span>
<span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab 
</code></pre> 
<p><font face="微软雅黑" size="4"><b>4、根据规划设置主机名</b></font></p> 
<pre><code class="prism language-bash">hostnamectl set-hostname master01
</code></pre> 
<pre><code class="prism language-bash">hostnamectl set-hostname node01
</code></pre> 
<pre><code class="prism language-bash">hostnamectl set-hostname node02
</code></pre> 
<p><font face="微软雅黑" size="4"><b>5、在master添加hosts</b></font></p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
192.168.102.10 master01
192.168.102.20 node01
192.168.102.30 node02
EOF</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/18/ec/ZDEsngad_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>6、调整内核参数</b></font></p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
#开启网桥模式，可将网桥的流量传递给iptables链
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
#关闭ipv6协议
net.ipv6.conf.all.disable_ipv6=1
net.ipv4.ip_forward=1
EOF</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">sysctl</span> <span class="token parameter variable">--system</span>
</code></pre> 
<p><font face="微软雅黑" size="4"><b>7、给所有主机进行时间同步</b></font></p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> ntpdate <span class="token parameter variable">-y</span>
ntpdate ntp.aliyun.com
</code></pre> 
<p><font face="微软雅黑" size="4"><b>将时间同步命令放到每日执行文件中</b></font><br> <img src="https://images2.imgbox.com/70/89/5ljk1rEi_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_etcd__98"></a>三、部署 etcd 集群</h2> 
<p><font face="微软雅黑" size="4"><b>etcd是CoreOS团队于2013年6月发起的开源项目，它的目标是构建一个高可用的分布式键值（key-value）数据库。etcd内部采用raft协议作为一致性算法，etcd是go语言编写的。<br> </b></font></p> 
<p><font face="微软雅黑" size="4"><b>etcd 作为服务发现系统，有以下的特点：<br> 简单：安装配置简单，而且提供了HTTP API进行交互，使用也很简单<br> 安全：支持SSL证书验证<br> 快速：单实例支持每秒2k+读操作<br> 可靠：采用raft算法，实现分布式系统数据的可用性和一致性</b></font></p> 
<p><font face="微软雅黑" size="4"><b><mark>etcd 目前默认使用2379端口提供HTTP API服务</mark>， 2380端口和peer通信(这两个端口已经被IANA(互联网数字分配机构)官方预留给etcd)。 即etcd默认使用2379端口对外为客户端提供通讯，<mark>使用端口2380来进行服务器间内部通讯</mark>。<br> etcd 在生产环境中一般推荐集群方式部署。由于etcd 的leader选举机制，要求至少为3台或以上的奇数台。</b></font></p> 
<h3><a id="1_112"></a>1、准备签发证书环境</h3> 
<p><font face="微软雅黑" size="4"><b>CFSSL 是 CloudFlare 公司开源的一款 PKI/TLS 工具。 CFSSL 包含一个命令行工具和一个用于签名、验证和捆绑 TLS 证书的 HTTP API 服务。使用Go语言编写。<br> CFSSL 使用配置文件生成证书，因此自签之前，需要生成它识别的 json 格式的配置文件，CFSSL 提供了方便的命令行生成配置文件。<br> CFSSL 用来为 etcd 提供 TLS 证书，它支持签三种类型的证书：<br> 1、client 证书，服务端连接客户端时携带的证书，用于客户端验证服务端身份，如 kube-apiserver 访问 etcd；<br> 2、server 证书，客户端连接服务端时携带的证书，用于服务端验证客户端身份，如 etcd 对外提供服务；<br> 3、peer 证书，相互之间连接时使用的证书，如 etcd 节点之间进行验证和通信。<br> 这里全部都使用同一套证书认证。</b></font></p> 
<h3><a id="2_master01__122"></a>2、在 master01 节点上操作</h3> 
<p><font face="微软雅黑" size="4"><b>1、准备cfssl证书生成工具<br> </b></font></p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/cfssl
<span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/cfssljson
<span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/cfssl-certinfo

<span class="token function">chmod</span> +x /usr/local/bin/cfssl*
</code></pre> 
<p><img src="https://images2.imgbox.com/37/9c/RNAUlGXA_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">cfssl：证书签发的工具命令
cfssljson：将 cfssl 生成的证书（json格式）变为文件承载式证书
cfssl-certinfo：验证证书的信息
cfssl-certinfo <span class="token parameter variable">-cert</span> <span class="token operator">&lt;</span>证书名称<span class="token operator">&gt;</span>			<span class="token comment">#查看证书的信息</span>
</code></pre> 
<h4><a id="1Etcd_143"></a>1、生成Etcd证书</h4> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /opt/k8s
<span class="token builtin class-name">cd</span> /opt/k8s/

<span class="token comment">#上传 etcd-cert.sh 和 etcd.sh 到 /opt/k8s/ 目录中</span>
<span class="token function">chmod</span> +x etcd-cert.sh etcd.sh
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#创建用于生成CA证书、etcd 服务器证书以及私钥的目录</span>
<span class="token function">mkdir</span> /opt/k8s/etcd-cert
<span class="token function">mv</span> etcd-cert.sh etcd-cert/
<span class="token builtin class-name">cd</span> /opt/k8s/etcd-cert/
./etcd-cert.sh			<span class="token comment">#生成CA证书、etcd 服务器证书以及私钥</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#上传 etcd-v3.4.9-linux-amd64.tar.gz 到 /opt/k8s 目录中，启动etcd服务</span>
<span class="token builtin class-name">cd</span> /opt/k8s/
<span class="token function">tar</span> zxvf etcd-v3.4.26-linux-amd64.tar.gz
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/da/cdP3vNvq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#创建用于存放 etcd 配置文件，命令文件，证书的目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/etcd/<span class="token punctuation">{<!-- --></span>cfg,bin,ssl<span class="token punctuation">}</span>

<span class="token builtin class-name">cd</span> /opt/k8s/etcd-v3.4.9-linux-amd64/
<span class="token function">mv</span> etcd etcdctl /opt/etcd/bin/
<span class="token function">cp</span> /opt/k8s/etcd-cert/*.pem /opt/etcd/ssl/
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/k8s/
./etcd.sh etcd01 <span class="token number">192.168</span>.102.10 <span class="token assign-left variable">etcd02</span><span class="token operator">=</span>https://192.168.102.30:2380,etcd03<span class="token operator">=</span>https://192.168.102.40:2380
<span class="token comment">#进入卡住状态等待其他节点加入，这里需要三台etcd服务同时启动，如果只启动其中一台后，服务会卡在那里，直到集群中所有etcd节点都已启动，可忽略这个情况</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#可另外打开一个窗口查看etcd进程是否正常</span>
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> etcd
</code></pre> 
<p><img src="https://images2.imgbox.com/ea/ea/OgwcmmcE_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#把etcd相关证书文件、命令文件和服务管理文件全部拷贝到另外两个etcd集群节点</span>
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /opt/etcd/ root@192.168.102.30:/opt/
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /opt/etcd/ root@192.168.102.40:/opt/
<span class="token function">scp</span> /usr/lib/systemd/system/etcd.service root@192.168.102.30:/usr/lib/systemd/system/
<span class="token function">scp</span> /usr/lib/systemd/system/etcd.service root@192.168.102.40:/usr/lib/systemd/system/
</code></pre> 
<h3><a id="3_node01__198"></a>3、在 node01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /opt/etcd/cfg/etcd
</code></pre> 
<p><img src="https://images2.imgbox.com/8e/6d/4C1aFeVj_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#启动etcd服务</span>
systemctl start etcd
systemctl <span class="token builtin class-name">enable</span> etcd
systemctl status etcd
</code></pre> 
<h3><a id="4_node02__212"></a>4、在 node02 节点上操作</h3> 
<p><img src="https://images2.imgbox.com/26/21/wGbK2I1t_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#启动etcd服务</span>
systemctl start etcd
systemctl <span class="token builtin class-name">enable</span> etcd
systemctl status etcd
</code></pre> 
<p><font face="微软雅黑" size="4"><b>检查etcd群集状态</b></font></p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> /opt/etcd/bin/etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/opt/etcd/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/opt/etcd/ssl/server.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/opt/etcd/ssl/server-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.102.10:2379,https://192.168.102.30:2379,https://192.168.102.40:2379"</span> endpoint health --write-out<span class="token operator">=</span>table
</code></pre> 
<pre><code class="prism language-bash">------------------------------------------------------------------------------------------
--cert-file：识别HTTPS端使用SSL证书文件
--key-file：使用此SSL密钥文件标识HTTPS客户端
--ca-file：使用此CA证书验证启用https的服务器的证书
--endpoints：集群中以逗号分隔的机器地址列表
cluster-health：检查etcd集群的运行状况
------------------------------------------------------------------------------------------
</code></pre> 
<p><img src="https://images2.imgbox.com/c2/06/gDaaNUUO_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>查看etcd集群成员列表</b></font></p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> /opt/etcd/bin/etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/opt/etcd/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/opt/etcd/ssl/server.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/opt/etcd/ssl/server-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"https://192.168.102.10:2379,https://192.168.102.30:2379,https://192.168.102.40:2379"</span> --write-out<span class="token operator">=</span>table member list
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/41/XfdkQRPE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_Master__247"></a>四、部署 Master 组件</h2> 
<pre><code class="prism language-bash">//在 master01 节点上操作
<span class="token comment">#上传 master.zip 和 k8s-cert.sh 到 /opt/k8s 目录中，解压 master.zip 压缩包</span>
<span class="token builtin class-name">cd</span> /opt/k8s/
<span class="token function">unzip</span> master.zip
<span class="token function">chmod</span> +x *.sh
</code></pre> 
<p><img src="https://images2.imgbox.com/38/0e/hrA3MPfC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#创建kubernetes工作目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/kubernetes/<span class="token punctuation">{<!-- --></span>bin,cfg,ssl,logs<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/10/be/DQkqPKj0_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> k8s-cert.sh 
<span class="token comment">#进行修改master的ip地址</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2a/af/eQuufWaR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#创建用于生成CA证书、相关组件的证书和私钥的目录</span>
<span class="token function">mkdir</span> /opt/k8s/k8s-cert
<span class="token function">mv</span> /opt/k8s/k8s-cert.sh /opt/k8s/k8s-cert
<span class="token builtin class-name">cd</span> /opt/k8s/k8s-cert/
./k8s-cert.sh				<span class="token comment">#生成CA证书、相关组件的证书和私钥</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/ca/AiKiJx7p_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#复制CA证书、apiserver相关证书和私钥到 kubernetes工作目录的 ssl 子目录中</span>
<span class="token function">cp</span> ca*pem apiserver*pem /opt/kubernetes/ssl/

<span class="token comment">#上传 kubernetes-server-linux-amd64.tar.gz 到 /opt/k8s/ 目录中，解压 kubernetes 压缩包</span>
<span class="token builtin class-name">cd</span> /opt/k8s/
<span class="token function">tar</span> zxvf kubernetes-server-linux-amd64.tar.gz
</code></pre> 
<p><img src="https://images2.imgbox.com/69/cf/4SSEKnA3_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#复制master组件的关键命令文件到 kubernetes工作目录的 bin 子目录中</span>
<span class="token builtin class-name">cd</span> /opt/k8s/kubernetes/server/bin
<span class="token function">cp</span> kube-apiserver kubectl kube-controller-manager kube-scheduler /opt/kubernetes/bin/
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /opt/kubernetes/bin/* /usr/local/bin/
</code></pre> 
<p><img src="https://images2.imgbox.com/34/7b/DBAApPSj_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>创建 bootstrap token 认证文件，apiserver 启动时会调用，然后就相当于在集群内创建了一个这个用户，接下来就可以用 RBAC 给他授权</b></font></p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/k8s/
<span class="token function">vim</span> token.sh
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vim</span> token.sh
<span class="token comment">#!/bin/bash</span>
<span class="token comment">#获取随机数前16个字节内容，以十六进制格式输出，并删除其中空格</span>
<span class="token assign-left variable">BOOTSTRAP_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">16</span> /dev/urandom <span class="token operator">|</span> od <span class="token parameter variable">-An</span> <span class="token parameter variable">-t</span> x <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span><span class="token variable">)</span></span>
<span class="token comment">#生成 token.csv 文件，按照 Token序列号,用户名,UID,用户组 的格式生成</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /opt/kubernetes/cfg/token.csv <span class="token operator">&lt;&lt;</span><span class="token string">EOF
<span class="token variable">${BOOTSTRAP_TOKEN}</span>,kubelet-bootstrap,10001,"system:kubelet-bootstrap"
EOF</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> +x token.sh
./token.sh

<span class="token function">cat</span> /opt/kubernetes/cfg/token.csv
</code></pre> 
<p><img src="https://images2.imgbox.com/40/75/Sts4HgIX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#二进制文件、token、证书都准备好后，开启 apiserver 服务</span>
<span class="token builtin class-name">cd</span> /opt/k8s/
./apiserver.sh <span class="token number">192.168</span>.102.10 https://192.168.102.10:2379,https://192.168.102.30:2379,https://192.168.102.40:2379
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#检查进程是否启动成功</span>
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> kube-apiserver

<span class="token function">netstat</span> <span class="token parameter variable">-natp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">6443</span>   <span class="token comment">#安全端口6443用于接收HTTPS请求，用于基于Token文件或客户端证书等认证</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/d3/g6YhIP3O_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#启动 scheduler 服务</span>
<span class="token builtin class-name">cd</span> /opt/k8s/
./scheduler.sh
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> kube-scheduler
</code></pre> 
<p><img src="https://images2.imgbox.com/fa/c1/CD1ao7aH_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#启动 controller-manager 服务</span>
./controller-manager.sh
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> kube-controller-manager
</code></pre> 
<p><img src="https://images2.imgbox.com/18/52/j9jUHpVZ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#生成kubectl连接集群的kubeconfig文件</span>
./admin.sh
</code></pre> 
<p><img src="https://images2.imgbox.com/59/55/a2VnBPsZ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#绑定默认cluster-admin管理员集群角色，授权kubectl访问集群</span>
kubectl create clusterrolebinding cluster-system-anonymous <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>cluster-admin <span class="token parameter variable">--user</span><span class="token operator">=</span>system:anonymous

<span class="token comment">#通过kubectl工具查看当前集群组件状态</span>
kubectl get cs
</code></pre> 
<p><img src="https://images2.imgbox.com/d6/e7/XXZBG4t7_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>查看版本信息<br> kubectl version</b></font><br> <img src="https://images2.imgbox.com/d4/df/2Pk3bj5G_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_docker_377"></a>五、部署 docker引擎</h2> 
<pre><code class="prism language-bash">//所有 <span class="token function">node</span> 节点部署docker引擎
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-ce-cli containerd.io
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{
  "registry-mirrors": ["https://6ijb8ubo.mirror.aliyuncs.com"],
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "500m", "max-file": "3"
  }
}
EOF</span>
</code></pre> 
<pre><code class="prism language-bash">systemctl start docker.service
systemctl <span class="token builtin class-name">enable</span> docker.service 
</code></pre> 
<h2><a id="_Worker_Node__403"></a>六、部署 Worker Node 组件</h2> 
<h3><a id="1_node__404"></a>1、在所有 node 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#创建kubernetes工作目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/kubernetes/<span class="token punctuation">{<!-- --></span>bin,cfg,ssl,logs<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#上传 node.zip 到 /opt 目录中，解压 node.zip 压缩包，获得kubelet.sh、proxy.sh</span>
<span class="token builtin class-name">cd</span> /opt/
<span class="token function">unzip</span> node.zip
<span class="token function">chmod</span> +x kubelet.sh proxy.sh
</code></pre> 
<h4><a id="1_master01__417"></a>1、在 master01 节点上操作</h4> 
<pre><code class="prism language-bash"><span class="token comment">#把 kubelet、kube-proxy 拷贝到 node 节点</span>
<span class="token builtin class-name">cd</span> /opt/k8s/kubernetes/server/bin
<span class="token function">scp</span> kubelet kube-proxy root@192.168.102.30:/opt/kubernetes/bin/
<span class="token function">scp</span> kubelet kube-proxy root@192.168.102.40:/opt/kubernetes/bin/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#上传kubeconfig.sh文件到/opt/k8s/kubeconfig目录中，生成kubelet初次加入集群引导kubeconfig文件和kube-proxy.kubeconfig文件</span>
<span class="token comment">#kubeconfig 文件包含集群参数（CA 证书、API Server 地址），客户端参数（上面生成的证书和私钥），集群 context 上下文参数（集群名称、用户名）。Kubenetes 组件（如 kubelet、kube-proxy）通过启动时指定不同的 kubeconfig 文件可以切换到不同的集群，连接到 apiserver。</span>
<span class="token function">mkdir</span> /opt/k8s/kubeconfig
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/k8s/kubeconfig
<span class="token function">chmod</span> +x kubeconfig.sh
./kubeconfig.sh <span class="token number">192.168</span>.102.10 /opt/k8s/k8s-cert/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#把配置文件 bootstrap.kubeconfig、kube-proxy.kubeconfig 拷贝到 node 节点</span>
<span class="token function">scp</span> bootstrap.kubeconfig kube-proxy.kubeconfig root@192.168.102.30:/opt/kubernetes/cfg/
<span class="token function">scp</span> bootstrap.kubeconfig kube-proxy.kubeconfig root@192.168.102.40:/opt/kubernetes/cfg/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#RBAC授权，使用户 kubelet-bootstrap 能够有权限发起 CSR 请求证书</span>
kubectl create clusterrolebinding kubelet-bootstrap <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>system:node-bootstrapper <span class="token parameter variable">--user</span><span class="token operator">=</span>kubelet-bootstrap
</code></pre> 
<h3><a id="2_node01__449"></a>2、在 node01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#启动 kubelet 服务</span>
<span class="token builtin class-name">cd</span> /opt/
./kubelet.sh <span class="token number">192.168</span>.102.30
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> kubelet
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/f7/eyRG1cOc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_master01__CSR__458"></a>3、在 master01 节点上操作，通过 CSR 请求</h3> 
<pre><code class="prism language-bash">kubectl certificate approve node-csr-duiobEzQ0R93HsULoS9NT9JaQylMmid_nBF3Ei3NtFE

kubectl get csr
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#查看节点，由于网络插件还没有部署，节点会没有准备就绪 NotReady</span>
kubectl get <span class="token function">node</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/21/26/nN2he61Y_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_node01__472"></a>4、在 node01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#加载 ip_vs 模块</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> /usr/lib/modules/<span class="token punctuation">$(</span>uname -r<span class="token punctuation">)</span>/kernel/net/netfilter/ipvs<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">"^[^.]*"</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$i</span><span class="token punctuation">;</span> /sbin/modinfo <span class="token parameter variable">-F</span> filename <span class="token variable">$i</span> <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;&amp;</span> /sbin/modprobe <span class="token variable">$i</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#启动proxy服务</span>
<span class="token builtin class-name">cd</span> /opt/
./proxy.sh <span class="token number">192.168</span>.102.30
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> kube-proxy
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/92/hK0wJt2J_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5CSR_486"></a>5、自动批准CSR请求</h3> 
<pre><code class="prism language-bash">kubectl create clusterrolebinding node-autoapprove-bootstrap <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>system:certificates.k8s.io:certificatesigningrequests:nodeclient <span class="token parameter variable">--user</span><span class="token operator">=</span>kubelet-bootstrap 

kubectl create clusterrolebinding node-autoapprove-certificate-rotation <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>system:certificates.k8s.io:certificatesigningrequests:selfnodeclient <span class="token parameter variable">--user</span><span class="token operator">=</span>kubelet-bootstrap
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/2b/CaFf20BY_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>使用master进行查看<br> </b></font><br> <img src="https://images2.imgbox.com/4f/b2/SDtDPmHD_o.png" alt="在这里插入图片描述"></p> 
<p><font face="微软雅黑" size="4"><b>在主机2也设置一下proxy服务</b></font></p> 
<pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> /usr/lib/modules/<span class="token punctuation">$(</span>uname -r<span class="token punctuation">)</span>/kernel/net/netfilter/ipvs<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">"^[^.]*"</span><span class="token variable">)</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$i</span><span class="token punctuation">;</span> /sbin/modinfo <span class="token parameter variable">-F</span> filename <span class="token variable">$i</span> <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;&amp;</span> /sbin/modprobe <span class="token variable">$i</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/c5/px0tdDKL_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_CNI__507"></a>七、部署 CNI 网络组件</h2> 
<p><font face="微软雅黑" size="4"><b>K8S 3种网络<br> 节点网络 Node节点网卡的IP nodeIP<br> Pod网络 podIP<br> Service网络 clusterIP</b></font></p> 
<p><font face="微软雅黑" size="4"><b>K8S 3种接口<br> CRI 容器运行时接口 docker containerd podman cri-0<br> CNI 容器网络接口 flannel calico cilium<br> CSI 容器存储接口 ceph nfs gfs s3</b></font></p> 
<p><font face="微软雅黑" size="4"><b>flannel 3种模式<br> UDP 出现最早，性能较差，基于flanneld应用程序实现数据包的封装/解封装<br> VXLAN 默认模式，推荐使用的模式，性能比UDP模式更好，基于内核实现数据包的封装/解封装<br> Host-gw 性能最好，但是配置复杂，不能跨网段</b></font></p> 
<p><font face="微软雅黑" size="4"><b>flannel UDP模式工作原理<br> 1）应用数据包从源主机的Pod容器发出到cni0网桥接口，再由cni0转发到flannel0虚拟接口<br> 2）flanneld服务会监听flannel0接口接收到的数据，flanneld服务会将内部数据包封装到UDP报文里<br> 3）flanneld会根据在etcd中维护的路由表查到目标Pod所在的Node节点IP，在UDP报文外再封装Node节点IP报文、MAC报文后，通过物理网卡发送到目标Node节点<br> 4）UDP报文通过8285号端口送到目标主机的flanneld进程进行解封装，再通过flannel0接口转发到cni0网桥，然后通过cni0网桥转发到目标Pod容器<br> </b></font></p> 
<p><font face="微软雅黑" size="4"><b>flannel VXLAN模式工作原理<br> 1）原始数据帧从源主机的Pod容器发出到cni0网桥接口，再由cni0转发到flannel.1虚拟接口<br> 2）flannel.1接口接收到数据帧后添加VXLAN头部，在内核封装成UDP报文<br> 3）flanneld会根据在etcd维护的路由表通过物理网卡发送到目标Node节点<br> 4）UDP报文通过8472号端口送到目标主机的flannel.1接口在内核进行解封装，然后将原始报文通过cni0网桥转发到目标Pod容器<br> </b></font></p> 
<p><font face="微软雅黑" size="4"><b>Calico IPIP模式工作原理<br> 1）源Pod容器发出的原始数据IP包通过内核的IPIP驱动直接封装到宿主机网络的IP包中<br> 2）根据tunl0接口的路由通过物理网卡发送到目标Node节点<br> 3）数据包到达目标节点后再通过IPIP驱动解包得到原始数据IP包<br> 4）然后通过路由规则发送给 veth pair 设备到达目标Pod容器</b></font></p> 
<p><font face="微软雅黑" size="4"><b><br> Calico BGP模式工作原理（本质就是通过路由表来维护每个 Pod 的通信）<br> 1）源Pod容器发出的原始数据IP包会通过 veth pair 设备到达宿主机网络空间<br> 2）然后根据原始数据IP包的目标IP和宿主机的路由规则，找到目标Node节点的IP，再通过物理网卡发送到目标Node节点<br> 3）根据目标Node节点的路由规则，直接通过目标Pod容器的 veth pair 设备发送到目标Pod容器</b></font></p> 
<p><font face="微软雅黑" size="4"><b>flannel 和 calico 区别？<br> flannel： UDP VXLAN Host-gw<br> 默认网段：10.244.0.0/16<br> 通常使用VXLAN模式，采用的是叠加网络、IP隧道方式传输数据，对性能有一定的影响<br> 功能简单配置方便利于管理，但是不具备复杂的网络策略规则配置能力</b></font></p> 
<p><font face="微软雅黑" size="4"><b>calico： IPIP BGP 混合模式（CrossSubnet）<br> 默认网段：192.168.0.0/16<br> 使用IPIP模式可以实现跨子网传输，但是传输过程中需要封包和解包，对性能有一定的影响<br> 使用BPG模式，把Node节点看作成路由器，根据Felix、BIRD分发和维护的路由规则，可直接实现BGP路由转发，传输过程中不需要封包和解包，因此性能较好，但只能在同一个网段内使用，无法跨子网传输<br> 具有更丰富的网络策略配置管理能力、性能更好、功能更全面，但是维护起来较为复杂</b></font></p> 
<p><font face="微软雅黑" size="4"><b>所以对于较小规模且网络要求简单的K8S集群，可以采用flannel。对于集群规模较大且要求更多的网络策略配置时，可以采用性能更好、功能全全面的calico</b></font></p> 
<p><font face="微软雅黑" size="4"><b>CoreDNS 是 K8S 的默认 DNS 实现<br> 根据 service 资源名称 解析出 Cluster IP<br> 根据 statefulset 控制器创建的 Pod 资源名称 解析出 Pod IP<br> </b></font></p> 
<h3><a id="1_node01__568"></a>1、在 node01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#上传 flannel-v0.21.5.zip 到 /opt/k8s 目录中</span>
<span class="token builtin class-name">cd</span> /opt/k8s
<span class="token function">unzip</span> flannel-v0.21.5.zip
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> flannel.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> flannel-cni-plugin.tar
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#上传 cni-plugins-linux-amd64-v1.3.0.tgz 到 /opt/k8s 目录中</span>
<span class="token function">mkdir</span> /opt/cni/bin
<span class="token function">tar</span> zxvf cni-plugins-linux-amd64-v1.3.0.tgz <span class="token parameter variable">-C</span> /opt/cni/bin
</code></pre> 
<p><img src="https://images2.imgbox.com/63/7c/SIuSTbhx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2node2_585"></a>2、在node2节点上进行操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#上传 flannel-v0.21.5.zip 到 /opt/k8s 目录中</span>
<span class="token builtin class-name">cd</span> /opt/k8s
<span class="token function">unzip</span> flannel-v0.21.5.zip
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> flannel.tar
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> flannel-cni-plugin.tar
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#上传 cni-plugins-linux-amd64-v1.3.0.tgz 到 /opt/k8s 目录中</span>
<span class="token function">mkdir</span> /opt/cni/bin
<span class="token function">tar</span> zxvf cni-plugins-linux-amd64-v1.3.0.tgz <span class="token parameter variable">-C</span> /opt/cni/bin
</code></pre> 
<p><img src="https://images2.imgbox.com/60/c6/Y9nqm9n9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/46/MVPMYR5e_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_master01__602"></a>3、在 master01 节点上操作</h3> 
<p><font face="微软雅黑" size="4"><b>将生成的kube-flannel.yml 文件传入master节点上</b></font><br> <img src="https://images2.imgbox.com/38/88/uR15nNIP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/k8s
kubectl apply <span class="token parameter variable">-f</span> kube-flannel.yml 
</code></pre> 
<p><img src="https://images2.imgbox.com/03/70/6g94d449_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_CoreDNS_613"></a>八、部署 CoreDNS</h2> 
<h3><a id="1_node__614"></a>1、在所有 node 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#上传 coredns.tar 到 /opt/k8s 目录中</span>
<span class="token builtin class-name">cd</span> /opt/k8s
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> coredns.tar
</code></pre> 
<h3><a id="2_master01__622"></a>2、在 master01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#上传 coredns.yaml 文件到 /opt/k8s 目录中，部署 CoreDNS </span>
<span class="token builtin class-name">cd</span> /opt/k8s
kubectl apply <span class="token parameter variable">-f</span> coredns.yaml
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/8b/KYnlclar_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">kubectl get pods <span class="token parameter variable">-n</span> kube-system 
</code></pre> 
<p><img src="https://images2.imgbox.com/df/90/Pi2DdmPF_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> dns-test <span class="token function">sh</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/72/1c/CcDZCaCO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3c/2b/4svzGwSG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3master02__643"></a>3、master02 节点部署</h3> 
<pre><code class="prism language-bash">//从 master01 节点上拷贝证书文件、各master组件的配置文件和服务管理文件到 master02 节点
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /opt/etcd/ root@192.168.102.20:/opt/
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /opt/kubernetes/ root@192.168.102.20:/opt
<span class="token function">scp</span> /usr/lib/systemd/system/<span class="token punctuation">{<!-- --></span>kube-apiserver,kube-controller-manager,kube-scheduler<span class="token punctuation">}</span>.service root@192.168.102.20:/usr/lib/systemd/system/
</code></pre> 
<pre><code class="prism language-bash">//修改配置文件kube-apiserver中的IP
<span class="token function">vim</span> /opt/kubernetes/cfg/kube-apiserver
</code></pre> 
<p><img src="https://images2.imgbox.com/b2/d5/SMJYQJe5_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">//在 master02 节点上启动各服务并设置开机自启
systemctl start kube-apiserver.service
systemctl <span class="token builtin class-name">enable</span> kube-apiserver.service
systemctl start kube-controller-manager.service
systemctl <span class="token builtin class-name">enable</span> kube-controller-manager.service
systemctl start kube-scheduler.service
systemctl <span class="token builtin class-name">enable</span> kube-scheduler.service
</code></pre> 
<pre><code class="prism language-bash">//查看node节点状态
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /opt/kubernetes/bin/* /usr/local/bin/
kubectl get nodes
kubectl get nodes <span class="token parameter variable">-o</span> wide			<span class="token comment">#-o=wide：输出额外信息；对于Pod，将输出Pod所在的Node名</span>
//此时在master02节点查到的node节点状态仅是从etcd查询到的信息，而此时node节点实际上并未与master02节点建立通信连接，因此需要使用一个VIP把node节点与master节点都关联起来
</code></pre> 
<p><img src="https://images2.imgbox.com/81/2f/Yx2WHL9P_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_677"></a>4、负载均衡部署</h3> 
<p><font face="微软雅黑" size="4"><b>//配置load balancer集群双机热备负载均衡（nginx实现负载均衡，keepalived实现双机热备）<br> 在lb01、lb02节点上操作<br> //配置nginx的官方在线yum源，配置本地nginx的yum源</b></font></p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/nginx.repo <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
EOF</span>
</code></pre> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> nginx <span class="token parameter variable">-y</span>
</code></pre> 
<h4><a id="1nginxk8s2masterip6443_696"></a>1、修改nginx配置文件，配置四层反向代理负载均衡，指定k8s群集2台master的节点ip和6443端口</h4> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/nginx/nginx.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/24/q6M7c1WI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">//检查配置文件语法
nginx <span class="token parameter variable">-t</span>   
</code></pre> 
<p><img src="https://images2.imgbox.com/5a/d8/Q8H82efk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">//启动nginx服务，查看已监听6443端口
systemctl start nginx
systemctl <span class="token builtin class-name">enable</span> nginx
<span class="token function">netstat</span> <span class="token parameter variable">-natp</span> <span class="token operator">|</span> <span class="token function">grep</span> nginx 
</code></pre> 
<pre><code class="prism language-bash">//部署keepalived服务
yum <span class="token function">install</span> keepalived <span class="token parameter variable">-y</span>
</code></pre> 
<pre><code class="prism language-bash">//修改keepalived配置文件
<span class="token function">vim</span> /etc/keepalived/keepalived.conf
</code></pre> 
<pre><code class="prism language-bash"><span class="token operator">!</span> Configuration File <span class="token keyword">for</span> keepalived

global_defs <span class="token punctuation">{<!-- --></span>
   <span class="token comment"># 接收邮件地址</span>
   notification_email <span class="token punctuation">{<!-- --></span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="token punctuation">}</span>
   <span class="token comment"># 邮件发送地址</span>
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server <span class="token number">127.0</span>.0.1
   smtp_connect_timeout <span class="token number">30</span>
   router_id NGINX_MASTER       <span class="token comment">#lb01节点的为 NGINX_MASTER，lb02节点的为 NGINX_BACKUP</span>
<span class="token punctuation">}</span>

<span class="token comment">#添加一个周期性执行的脚本</span>
vrrp_script check_nginx <span class="token punctuation">{<!-- --></span>
    script <span class="token string">"/etc/nginx/check_nginx.sh"</span>  <span class="token comment">#指定检查nginx存活的脚本路径</span>
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{<!-- --></span>
    state MASTER                <span class="token comment">#lb01节点的为 MASTER，lb02节点的为 BACKUP</span>
    interface ens33                     <span class="token comment">#指定网卡名称 ens33</span>
    virtual_router_id <span class="token number">51</span>        <span class="token comment">#指定vrid，两个节点要一致</span>
    priority <span class="token number">100</span>                <span class="token comment">#lb01节点的为 100，lb02节点的为 90</span>
    advert_int <span class="token number">1</span>
    authentication <span class="token punctuation">{<!-- --></span>
        auth_type PASS
        auth_pass <span class="token number">1111</span>
    <span class="token punctuation">}</span>
    virtual_ipaddress <span class="token punctuation">{<!-- --></span>
        <span class="token number">192.168</span>.102.100/24      <span class="token comment">#指定 VIP</span>
    <span class="token punctuation">}</span>
    track_script <span class="token punctuation">{<!-- --></span>
        check_nginx                     <span class="token comment">#指定vrrp_script配置的脚本</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-bash">//创建nginx状态检查脚本 
<span class="token function">vim</span> /etc/nginx/check_nginx.sh
</code></pre> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#egrep -cv "grep|$$" 用于过滤掉包含grep 或者 $$ 表示的当前Shell进程ID</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> nginx <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token parameter variable">-cv</span> <span class="token string">"grep|<span class="token variable">$$</span>"</span><span class="token variable">)</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$count</span>"</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    systemctl stop keepalived
<span class="token keyword">fi</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> +x /etc/nginx/check_nginx.sh
</code></pre> 
<pre><code class="prism language-bash">//启动keepalived服务（一定要先启动了nginx服务，再启动keepalived服务）
systemctl start keepalived
systemctl <span class="token builtin class-name">enable</span> keepalived
<span class="token function">ip</span> a				<span class="token comment">#查看VIP是否生成</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/43/VGwp4ek7_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/66/53/oncFn33o_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">//修改node节点上的bootstrap.kubeconfig,kubelet.kubeconfig配置文件为VIP
<span class="token builtin class-name">cd</span> /opt/kubernetes/cfg/
<span class="token function">vim</span> bootstrap.kubeconfig 
server: https://192.168.102.100:6443
                      
<span class="token function">vim</span> kubelet.kubeconfig
server: https://192.168.80.100:6443
                        
<span class="token function">vim</span> kube-proxy.kubeconfig
server: https://192.168.80.100:6443

//重启kubelet和kube-proxy服务
systemctl restart kubelet.service 
systemctl restart kube-proxy.service
</code></pre> 
<p><img src="https://images2.imgbox.com/d9/05/tRz95tNS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_master01__812"></a>2、在 master01 节点上操作</h4> 
<pre><code class="prism language-bash">//测试创建pod
kubectl run nginx <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx

//查看Pod的状态信息
kubectl get pods
NAME                    READY   STATUS              RESTARTS   AGE
nginx-dbddb74b8-nf9sk   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          33s   <span class="token comment">#正在创建中</span>

kubectl get pods
NAME                    READY   STATUS    RESTARTS   AGE
nginx-dbddb74b8-nf9sk   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          80s  			<span class="token comment">#创建完成，运行中</span>

kubectl get pods <span class="token parameter variable">-o</span> wide
NAME                    READY   STATUS    RESTARTS   AGE   IP            NODE            NOMINATED NODE
nginx-dbddb74b8-26r9l   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token number">172.17</span>.36.2   <span class="token number">192.168</span>.80.15   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
//READY为1/1，表示这个Pod中有1个容器

//在对应网段的node节点上操作，可以直接使用浏览器或者curl命令访问
<span class="token function">curl</span> <span class="token number">10.244</span>.0.3

//这时在master01节点上查看nginx日志，发现没有权限查看
kubectl logs nginx-dbddb74b8-nf9sk
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/99/Wy6Xvxcg_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">//在对应网段的node节点上操作，可以直接使用浏览器或者curl命令访问
</code></pre> 
<p><img src="https://images2.imgbox.com/10/f9/ObVn7dqv_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_Dashboard_845"></a>九、部署 Dashboard</h2> 
<p><font face="微软雅黑" size="4"><b>Dashboard 介绍<br> 仪表板是基于Web的Kubernetes用户界面。您可以使用仪表板将容器化应用程序部署到Kubernetes集群，对容器化应用程序进行故障排除，并管理集群本身及其伴随资源。您可以使用仪表板来概述群集上运行的应用程序，以及创建或修改单个Kubernetes资源（例如部署，作业，守护进程等）。例如，您可以使用部署向导扩展部署，启动滚动更新，重新启动Pod或部署新应用程序。仪表板还提供有关群集中Kubernetes资源状态以及可能发生的任何错误的信息。<br> </b></font></p> 
<h3><a id="1_master01__850"></a>1、在 master01 节点上操作</h3> 
<pre><code class="prism language-bash"><span class="token comment">#上传 recommended.yaml 文件到 /opt/k8s 目录中</span>
<span class="token builtin class-name">cd</span> /opt/k8s
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vim</span> recommended.yaml
<span class="token comment">#默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：</span>
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kubernetes-dashboard
spec:
  ports:
    - port: <span class="token number">443</span>
      targetPort: <span class="token number">8443</span>
      nodePort: <span class="token number">30001</span>     <span class="token comment">#添加</span>
  type: NodePort          <span class="token comment">#添加</span>
  selector:
    k8s-app: kubernetes-dashboard
</code></pre> 
<p><img src="https://images2.imgbox.com/16/ad/0ep8FaWq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">kubectl apply <span class="token parameter variable">-f</span> recommended.yaml
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#创建service account并绑定默认cluster-admin管理员集群角色</span>
kubectl create serviceaccount dashboard-admin <span class="token parameter variable">-n</span> kube-system
kubectl create clusterrolebinding dashboard-admin <span class="token parameter variable">--clusterrole</span><span class="token operator">=</span>cluster-admin <span class="token parameter variable">--serviceaccount</span><span class="token operator">=</span>kube-system:dashboard-admin
kubectl describe secrets <span class="token parameter variable">-n</span> kube-system <span class="token variable"><span class="token variable">$(</span>kubectl <span class="token parameter variable">-n</span> kube-system get secret <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/dashboard-admin/{print $1}'</span><span class="token variable">)</span></span>
</code></pre> 
<p><font face="微软雅黑" size="4"><b>登录使用的token</b></font><br> <img src="https://images2.imgbox.com/d3/97/R70QGcmX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#使用输出的token登录Dashboard</span>
https://节点ip地址:30001
</code></pre> 
<p><img src="https://images2.imgbox.com/6f/1f/TfbwOSP0_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/763e3117056a1930c89a2b92263b0ebd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【转载修正】STM32-HAL库-printf函数重定向（USART应用实例）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/837b4c1da92371ecb0c3f8fcef944643/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大模型-模型文件下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>