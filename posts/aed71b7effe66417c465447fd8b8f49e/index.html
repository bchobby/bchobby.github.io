<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>值得收藏的UmiJS 教程 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="值得收藏的UmiJS 教程" />
<meta property="og:description" content="点击上方关注 前端技术江湖，一起学习，天天进步
前言 网上的umi教程是真的少,很多人都只写了一点点，很多水文,所以打算自己写一篇,自己搭建umi,并封装了一下常用的功能,并用到公司实际项目中.
umi介绍 Umi 是什么？ Umi，中文可发音为乌米，是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。
Umi 是蚂蚁金服的底层前端框架，已直接或间接地服务了 3000&#43; 应用，包括 java、node、H5 无线、离线（Hybrid）应用、纯前端 assets 应用、CMS 应用等。他已经很好地服务了我们的内部用户，同时希望他也能服务好外部用户。
它主要具备以下功能：
🎉 可扩展，Umi 实现了完整的生命周期，并使其插件化，Umi 内部功能也全由插件完成。此外还支持插件和插件集，以满足功能和垂直域的分层需求。
📦 开箱即用，Umi 内置了路由、构建、部署、测试等，仅需一个依赖即可上手开发。并且还提供针对 React 的集成插件集，内涵丰富的功能，可满足日常 80% 的开发需求。
🐠 企业级，经蚂蚁内部 3000&#43; 项目以及阿里、优酷、网易、飞猪、口碑等公司项目的验证，值得信赖。
🚀 大量自研，包含微前端、组件打包、文档工具、请求库、hooks 库、数据流等，满足日常项目的周边需求。
🌴 完备路由，同时支持配置式路由和约定式路由，同时保持功能的完备性，比如动态路由、嵌套路由、权限路由等等。
🚄 面向未来，在满足需求的同时，我们也不会停止对新技术的探索。比如 dll 提速、modern mode、webpack@5、自动化 external、bundler less 等等。
什么时候不用 umi？ 如果你，
需要支持 IE 8 或更低版本的浏览器
需要支持 React 16.8.0 以下的 React
需要跑在 Node 10 以下的环境中
有很强的 webpack 自定义需求和主观意愿
需要选择不同的路由方案
Umi 可能不适合你。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/aed71b7effe66417c465447fd8b8f49e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-06T00:25:07+08:00" />
<meta property="article:modified_time" content="2021-11-06T00:25:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">值得收藏的UmiJS 教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:center;">点击上方关注 前端技术江湖，一起学习，天天进步</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/4a/0c/Ce2wqV2z_o.png" alt="ed086c89c8790b8a8dec4083cee8e051.png"></p> 
 <h2>前言</h2> 
 <p>网上的umi教程是真的少,很多人都只写了一点点，很多水文,所以打算自己写一篇,自己搭建umi,并封装了一下常用的功能,并用到公司实际项目中.</p> 
 <h2>umi介绍</h2> 
 <h3>Umi 是什么？</h3> 
 <p>Umi，中文可发音为<strong>乌米</strong>，是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。</p> 
 <p>Umi 是蚂蚁金服的底层前端框架，已直接或间接地服务了 3000+ 应用，包括 java、node、H5 无线、离线（Hybrid）应用、纯前端 assets 应用、CMS 应用等。他已经很好地服务了我们的内部用户，同时希望他也能服务好外部用户。</p> 
 <p>它主要具备以下功能：</p> 
 <ul><li><p>🎉 <strong>可扩展</strong>，Umi 实现了完整的生命周期，并使其插件化，Umi 内部功能也全由插件完成。此外还支持插件和插件集，以满足功能和垂直域的分层需求。</p></li><li><p>📦 <strong>开箱即用</strong>，Umi 内置了路由、构建、部署、测试等，仅需一个依赖即可上手开发。并且还提供针对 React 的集成插件集，内涵丰富的功能，可满足日常 80% 的开发需求。</p></li><li><p>🐠 <strong>企业级</strong>，经蚂蚁内部 3000+ 项目以及阿里、优酷、网易、飞猪、口碑等公司项目的验证，值得信赖。</p></li><li><p>🚀 <strong>大量自研</strong>，包含微前端、组件打包、文档工具、请求库、hooks 库、数据流等，满足日常项目的周边需求。</p></li><li><p>🌴 <strong>完备路由</strong>，同时支持配置式路由和约定式路由，同时保持功能的完备性，比如动态路由、嵌套路由、权限路由等等。</p></li><li><p>🚄 <strong>面向未来</strong>，在满足需求的同时，我们也不会停止对新技术的探索。比如 dll 提速、modern mode、webpack@5、自动化 external、bundler less 等等。</p></li></ul> 
 <h3>什么时候不用 umi？</h3> 
 <p>如果你，</p> 
 <ul><li><p>需要支持 IE 8 或更低版本的浏览器</p></li><li><p>需要支持 React 16.8.0 以下的 React</p></li><li><p>需要跑在 Node 10 以下的环境中</p></li><li><p>有很强的 webpack 自定义需求和主观意愿</p></li><li><p>需要选择不同的路由方案</p></li></ul> 
 <p>Umi 可能不适合你。</p> 
 <h3>为什么不是？</h3> 
 <h4><sup>[1]</sup>create-react-app<sup>[2]</sup></h4> 
 <p>create-react-app 是基于 webpack 的打包层方案，包含 build、dev、lint 等，他在打包层把体验做到了极致，但是不包含路由，不是框架，也不支持配置。所以，如果大家想基于他修改部分配置，或者希望在打包层之外也做技术收敛时，就会遇到困难。</p> 
 <h4><sup>[3]</sup>next.js<sup>[4]</sup></h4> 
 <p>next.js 是个很好的选择，Umi 很多功能是参考 next.js 做的。要说有哪些地方不如 Umi，我觉得可能是不够贴近业务，不够接地气。比如 antd、dva 的深度整合，比如国际化、权限、数据流、配置式路由、补丁方案、自动化 external 方面等等一线开发者才会遇到的问题。</p> 
 <h2>umi3项目初始化</h2> 
 <h3>环境准备</h3> 
 <p>首先得有 node<sup>[5]</sup>，并确保 node 版本是 10.13 或以上。</p> 
 <p>推荐使用 <code>yarn</code> 管理 npm 依赖</p> 
 <p>本项目使用的版本为 node <code>v14.17.5</code> yarn <code>1.22.15</code></p> 
 <h3>脚手架</h3> 
 <p>桌面新建umi3文件夹, 用vscode打开, 打开vscode终端,</p> 
 <p>执行 <code>yarn create @umijs/umi-app</code> 创建项目</p> 
 <p>安装依赖 <code>yarn</code></p> 
 <p>启动项目 <code>yarn start</code></p> 
 <h2>配置 prettier,eslint, stylelint</h2> 
 <p>umi 维护了一个 prettier，eslint，stylelint 的配置文件合集 umi-fabric<sup>[6]</sup></p> 
 <pre class="has"><code class="language-go">yarn add @umijs/fabric -D
复制代码</code></pre> 
 <p>根目录新建下面三个文件,删除.prettierrc文件</p> 
 <p><code>.eslintrc.js</code>、<code>.prettierrc.js</code>、<code>.stylelintrc.js</code></p> 
 <p><strong>配置如下</strong></p> 
 <pre class="has"><code class="language-go">//.eslintrc.js 配置

module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/eslint')],

  // in antd-design-pro
  globals: {
    ANT_DESIGN_PRO_ONLY_DO_NOT_USE_IN_YOUR_PRODUCTION: true,
    page: true,
  },

  rules: {
    // your rules
    'prefer-const': 0,
  },
};


//.prettierrc.js 配置

const fabric = require('@umijs/fabric')

module.exports = {
  ...fabric.prettier,
  semi: false,
}


//.stylelintrc.js 配置

const fabric = require('@umijs/fabric')

module.exports = {
  ...fabric.stylelint,
}
复制代码</code></pre> 
 <p>根目录新建eslint忽略文件 .eslintignore</p> 
 <pre class="has"><code class="language-go">.eslintrc.js
node_modules
复制代码</code></pre> 
 <p>在package.json 里面的lint-staged 新增 <code>"eslint \--fix"</code></p> 
 <img src="https://images2.imgbox.com/79/57/vgOhQYkD_o.png" alt="dcb11243d3603e678cd0f5dd0d61aa51.png"> 
 <figcaption>
   1634719305(1).png 
 </figcaption> 
 <p>最后你的 vscode 要安装这三个同名扩展插件，这时候分别去更改 js、less 文件，会发现已经有风格校验了。</p> 
 <p><code>验证</code></p> 
 <img src="https://images2.imgbox.com/26/34/665H5SDs_o.png" alt="b5d9bbcdb60d65fc14ddba9fe46b23ef.png"> 
 <figcaption>
   7d684cab2e5ef8d167c81653582af15.jpg 
 </figcaption> 
 <p>修改<code>src/paegs</code>文件夹下的<code>index.tsx</code>文件,新增一个a变量,有eslint错误提示,说明eslint生效了</p> 
 <p>然后再单独提交index.tsx这一个文件</p> 
 <img src="https://images2.imgbox.com/66/f8/745w09lI_o.png" alt="f6fe1f1bc974d813eed675abdd944519.png"> 
 <figcaption>
   f87c265f5003a8899498b860baa64ce.png 
 </figcaption> 
 <p>会提示有错误,无法提交，说明<code>pre-commmit</code> 钩子生效</p> 
 <h3>保存时自动格式化代码</h3> 
 <p>在vscode设置 文本编辑器的格式化里面 勾选Format on Save</p> 
 <img src="https://images2.imgbox.com/41/b3/KpYBY4ui_o.png" alt="9134e4fc88d7e924ad792a05eebe159e.png"> 
 <figcaption>
   1.png 
 </figcaption> 
 <h3>我的eslint，或者prettier 不生效？</h3> 
 <img src="https://images2.imgbox.com/2a/68/xVWOwEii_o.png" alt="3e4d4f1f588cf44d2cd5016b662c4148.png"> 
 <figcaption>
   222.png 
 </figcaption> 
 <p>去到终端里的输出，找到eslint或者prettier 看他们的输出日志，是否正常。如果有报错，根据报错信息处理问题</p> 
 <p><code>检查步骤</code>:</p> 
 <ul><li><p>确保安装umi-fabric</p></li><li><p>检查配置文件是否存在</p></li><li><p>vscode 得eslint 和prettier 插件是否下载</p></li><li><p>确认输出日志，是否有报错</p></li></ul> 
 <h3>pre-commit时的lint-staged 不生效</h3> 
 <p>在package.json中 我们配置了如下得代码</p> 
 <img src="https://images2.imgbox.com/a7/29/n2PrRFnr_o.png" alt="83019b8cc7f1644f5e0dcb2463415e08.png"> 
 <figcaption>
   565.png 
 </figcaption> 
 <p>意思是 在代码commit之前 执行prettier格式化代码和eslint fix 如果你在提交代码的时候没有生效，请执行</p> 
 <pre class="has"><code class="language-go">yarn install --force
复制代码</code></pre> 
 <p>执行这个命令重新拉取依赖</p> 
 <h3>不生效的原因？</h3> 
 <p>自己刚开始也是各种google，查看文档，也没有找出原因，最后在umi2的一个issue里面，自己找到了答案。</p> 
 <p>原因在于我们初始化git仓库的顺序，如果我们先初始化git仓库 然后再创建项目，再拉取依赖。是没有任何问题的。</p> 
 <p>如果我们先创建了umi项目，拉去依赖，最后初始化git，提交代码到git仓库，当我们拉去依赖时， 这是就还没有.git 就没有生成相关的pre-commit，所以就没有生效。所以这时我们就只需要在重新拉取下依赖就可以了。</p> 
 <h2>配置css初始化代码</h2> 
 <p><code>为什么要初始化css</code></p> 
 <p>建站老手都知道，这是为了考虑到浏览器的兼容问题，其实不同浏览器对有些标签的默认值是不同的，如果没对CSS初始化往往会出现浏览器之间的页面差异。当然，初始化样式会对SEO有一定的影响，但鱼和熊掌不可兼得，但力求影响最小的情况下初始化。</p> 
 <p>最简单的初始化方法就是：<code>* {padding: 0; margin: 0;}</code> 。有很多人也是这样写的。这确实很简单，但有人就会感到疑问：*号这样一个通用符在编写代码的时候是快，但如果网站很大，CSS样式表文件很大，这样写的话，他会把所有的标签都初始化一遍，这样就大大的加强了网站运行的负载，会使网站加载的时候需要很长一段时间。</p> 
 <p>CSS初始化是指重设浏览器的样式。不同的浏览器默认的样式可能不尽相同，所以开发时的第一件事可能就是如何把它们统一。如果没对CSS初始化往往会出现浏览器之间的页面差异。每次新开发网站或新网页时候通过初始化CSS样式的属性，为我们将用到的CSS或html标签更加方便准确，使得我们开发网页内容时更加方便简洁，同时减少CSS代码量，节约网页下载时间。</p> 
 <p>Umi 中约定 <code>src/global.css</code> 为全局样式，如果存在此文件，会被自动引入到入口文件最前面。</p> 
 <p>src下面新建<code>global.css</code>,代码如下</p> 
 <pre class="has"><code class="language-go">body,
ol,
ul,
h1,
h2,
h3,
h4,
h5,
h6,
p,
th,
td,
dl,
dd,
form,
fieldset,
legend,
input,
textarea,
select,
figure,
figcaption {
  margin: 0;
  padding: 0;
}

li {
  list-style-type: none;
}
a {
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
img {
  border: none;
}
input {
  outline: none;
}

复制代码</code></pre> 
 <h2>配置文件</h2> 
 <p>Umi 在 <code>.umirc.ts</code> 或 <code>config/config.ts</code> 中配置项目和插件，支持 es6。</p> 
 <p>如果项目的配置不复杂，推荐在 <code>.umirc.ts</code> 中写配置；如果项目的配置比较复杂，可以将配置写在 <code>config/config.ts</code> 中，并把配置的一部分拆分出去，比如路由配置可以拆分成单独的 <code>routes.ts</code></p> 
 <p>推荐两种配置方式二选一，<code>.umirc.ts</code> 优先级更高。</p> 
 <p>我们采用config的方式,删除.umirc.ts,根目录新建<code>config</code>文件夹, 在里面新建config.ts</p> 
 <p>默认内容如下</p> 
 <pre class="has"><code class="language-go">import { defineConfig } from 'umi';

export default defineConfig({
  nodeModulesTransform: {
    type: 'none',
  },
  routes: [
    { path: '/', component: '@/pages/index' },
  ],
  fastRefresh: {},
});
复制代码</code></pre> 
 <h2>多环境多配置文件</h2> 
 <p>可以通过环境变量 <code>UMI_ENV</code> 区分不同环境来指定配置。</p> 
 <p>为了兼容性,可借助三方工具 cross-env<sup>[7]</sup>来设置环境变量</p> 
 <pre class="has"><code class="language-go">yarn add cross-env --dev
复制代码</code></pre> 
 <p>在package.json中的<code>script</code>中</p> 
 <pre class="has"><code class="language-go">"start": "cross-env UMI_ENV=dev umi dev",
    "start:test": "cross-env UMI_ENV=test umi dev",
    "start:prd": "cross-env UMI_ENV=prd umi dev",
    "build": "cross-env UMI_ENV=dev umi build",
    "build:test": "cross-env UMI_ENV=test umi build",
    "build:prd": "cross-env UMI_ENV=prd umi build",
复制代码</code></pre> 
 <p>然后再config文件夹下 新建</p> 
 <p><code>config.dev.ts</code>,<code>config.test.ts</code>,<code>config.prd.ts</code></p> 
 <p>代表开发环境,测试环境,生产环境的配置文件.</p> 
 <p><code>config.dev.ts</code></p> 
 <pre class="has"><code class="language-go">import { defineConfig } from 'umi';
export default defineConfig({
  define: {
    CurrentEnvironment: 'dev',
  },
});

复制代码</code></pre> 
 <p><code>config.test.ts</code></p> 
 <pre class="has"><code class="language-go">import { defineConfig } from 'umi';
export default defineConfig({
  define: {
    CurrentEnvironment: 'test',
  },
});

复制代码</code></pre> 
 <p><code>config.prd.ts</code></p> 
 <pre class="has"><code class="language-go">import { defineConfig } from 'umi';
export default defineConfig({
  define: {
    CurrentEnvironment: 'prd',
  },
});

复制代码</code></pre> 
 <p><code>CurrentEnvironment</code> 变量代表当前的环境，后面根据不同的环境配置不同的请求地址会用到</p> 
 <p>define<sup>[8]</sup> 用于提供给代码中可用的变量,定义的变量可以全局拿到</p> 
 <p>这时 执行 <code>yarn start:prd</code>,然后去到pages的index.tsx打印<code>CurrentEnvironment</code>.</p> 
 <img src="https://images2.imgbox.com/64/88/JjsM0ASH_o.png" alt="1a7d2ff3e71bb518284274c73dce9e95.png"> 
 <figcaption>
   b49bd8611d5c6403479a1547ba4bbc6.png 
 </figcaption> 
 <p>这时需要去到根目录的 <code>typings.d.ts</code> 添加</p> 
 <pre class="has"><code class="language-go">// 声明当前的环境
declare const CurrentEnvironment: 'dev' | 'test' | 'prd';
复制代码</code></pre> 
 <p>然后报错消失 控制台打印如下</p> 
 <img src="https://images2.imgbox.com/27/11/8UZ4yYg8_o.png" alt="c807322f64fca062a9afbca6e433414f.png"> 
 <figcaption>
   1634721237(1).png 
 </figcaption> 
 <p>这时 重新执行<code>yanr start:test</code> 控制台打印如下</p> 
 <img src="https://images2.imgbox.com/76/53/FB253Gx8_o.png" alt="367c8e2ab9a699894799b051a13f9858.png"> 
 <figcaption>
   11.png 
 </figcaption> 
 <p>环境变量和多环境多配置 成功</p> 
 <p><code>**注意点**</code>:</p> 
 <p><code>config.ts</code>作为配置文件时，记得删除<code>.umirc.ts</code> 不然config.ts不会生效。</p> 
 <h2>自定义环境变量</h2> 
 <p>如果我们想自定义一个环境变量,REACT_APP_ENV. 同样我们可以在<code>package.json</code>里面设置</p> 
 <img src="https://images2.imgbox.com/d1/b0/X0kWkulP_o.png" alt="ca89997734e4004405eb525921304b85.png"> 
 <figcaption>
   1634783299(1).png 
 </figcaption> 
 <p>然后我们要这样拿到这个变量呢?</p> 
 <p>首先 我们要在<code>config.ts</code> 的 <code>define</code> 配置</p> 
 <pre class="has"><code class="language-go">define: {
    REACT_APP_ENV: process.env.REACT_APP_ENV,
},
复制代码</code></pre> 
 <p>然后再在根目录的 <code>typings.d.ts</code> 定义</p> 
 <pre class="has"><code class="language-go">declare const REACT_APP_ENV: string;
复制代码</code></pre> 
 <p>这样就可以以在全局中拿到和使用 <code>REACT_APP_ENV</code>这个环境变量了.</p> 
 <p>可以在任意组件 直接打印</p> 
 <pre class="has"><code class="language-go">console.log('自定义环境变量', REACT_APP_ENV);
复制代码</code></pre> 
 <h2>系统自带的环境变量</h2> 
 <p>官方提供的环境变量<sup>[9]</sup></p> 
 <p>怎么使用?</p> 
 <p>在根目录新建<code>.env</code> 环境变量配置文件</p> 
 <p>然后写入</p> 
 <pre class="has"><code class="language-go">PORT=3000  // 表示启动的端口号为3000
COMPRESS = none  // 不压缩 CSS 和 JS
复制代码</code></pre> 
 <p>还有一些环境变量 不能配在 <code>.env</code> 中，只能在命令行里添加</p> 
 <p>比如 <code>FORK_TS_CHECKER</code> 默认不开启 TypeScript 类型检查，值为 <code>1</code> 时启用。</p> 
 <pre class="has"><code class="language-go">"start": "cross-env FORK_TS_CHECKER=1 UMI_ENV=dev umi dev",
复制代码</code></pre> 
 <h2>请求的封装</h2> 
 <p>src文件夹下新建 <code>request</code>文件夹 新建<code>request.ts</code></p> 
 <p><code>request.ts</code></p> 
 <pre class="has"><code class="language-go">/**
 * 网络请求工具 封装umi-request
 * 更详细的 api 文档: https://github.com/umijs/umi-request
 */

import { extend } from 'umi-request';
import type { RequestOptionsInit } from 'umi-request';
import { notification } from 'antd';

// codeMessage仅供参考 具体根据和后端协商,在详细定义.
const codeMessage = {
  200: '服务器成功返回请求的数据。',
  400: '发出的请求有错误，服务器没有进行新建或修改数据的操作。',
  500: '服务器发生错误，请检查服务器。',
};
type mapCode = 200 | 400 | 500;

/**
 * 错误异常处理程序
 */
const errorHandler = (error: { response: Response }): Response =&gt; {
  const { response } = error;
  if (response &amp;&amp; response.status) {
    let errorText = codeMessage[response.status as mapCode] || response.statusText;
    const { status, url } = response;
    response
      ?.clone()
      ?.json()
      ?.then((res) =&gt; {
        // 后端返回错误信息,就用后端传回的
        errorText = res.msg ? res.msg : errorText;
        notification.error({
          message: `请求错误 ${status}: ${url}`,
          description: errorText,
        });
      });
  } else if (!response) {
    notification.error({
      description: '您的网络发生异常，无法连接服务器',
      message: '网络异常',
    });
  }
  return response;
};

/**
 * 配置request请求时的默认参数
 */
const request = extend({
  errorHandler, // 默认错误处理
  credentials: 'include', // 默认请求是否带上cookie
});

// 根据不同的开发环境,配置请求前缀
interface ApiPrefix {
  dev: string;
  test: string;
  prd: string;
}
const apiPreFix: ApiPrefix = {
  dev: 'http://120.55.193.14:3030/',
  test: 'http://120.55.193.14:3030/',
  prd: 'http://120.55.193.14:3030/',
};
// request拦截器, 携带token,以及根据环境,配置不同的请求前缀
request.interceptors.request.use((url: string, options: RequestOptionsInit) =&gt; {
  // 不携带token的请求数组
  let notCarryTokenArr: string[] = [];
  if (notCarryTokenArr.includes(url)) {
    return {
      url: `${apiPreFix[CurrentEnvironment]}${url}`,
      options,
    };
  }
  // 给每个请求带上token
  let token = localStorage.getItem('tokens') || '';
  let headers = {
    Authorization: `Bearer ${token}`,
  };
  return {
    url: `${apiPreFix[CurrentEnvironment]}${url}`,
    options: { ...options, interceptors: true, headers },
  };
});

/**
 * @url 请求的url
 * @parameter 上传的参数
 */

// 封装的get,post.put,delete请求
const get = async (url: string, parameter?: Record&lt;string, unknown&gt;): Promise&lt;any&gt; =&gt; {
  try {
    const res = await request(url, { method: 'get', params: parameter });
    return res;
  } catch (error) {
    console.error(error);
  }
};
const deletes = async (url: string, parameter?: Record&lt;string, unknown&gt;): Promise&lt;any&gt; =&gt; {
  try {
    const res = await request(url, { method: 'delete', params: parameter });
    return res;
  } catch (error) {
    console.error(error);
  }
};
const post = async (url: string, parameter?: Record&lt;string, unknown&gt;): Promise&lt;any&gt; =&gt; {
  try {
    const res = await request(url, { method: 'post', data: parameter });
    return res;
  } catch (error) {
    console.error(error);
  }
};
const put = async (url: string, parameter?: Record&lt;string, unknown&gt;): Promise&lt;any&gt; =&gt; {
  try {
    const res = await request(url, { method: 'put', data: parameter });
    return res;
  } catch (error) {
    console.error(error);
  }
};

export default {
  get,
  post,
  put,
  deletes,
};
复制代码</code></pre> 
 <p>这里封装了umi-request,统一处理了接口错误,请求拦截器携带token等.最后在配合useRequest 非常的好用.</p> 
 <h2>umi中使用dva</h2> 
 <h3>介绍</h3> 
 <p>包含以下功能，</p> 
 <ul><li><p><strong>内置 dva</strong>，默认版本是 <code>^2.6.0-beta.20</code>，如果项目中有依赖，会优先使用项目中依赖的版本。</p></li><li><p><strong>约定式的 model 组织方式</strong>，不用手动注册 model</p></li><li><p><strong>文件名即 namespace</strong>，model 内如果没有声明 namespace，会以文件名作为 namespace</p></li><li><p><strong>内置 dva-loading</strong>，直接 connect <code>loading</code> 字段使用即可</p></li><li><p><strong>支持 immer</strong>，通过配置 <code>immer</code> 开启</p></li></ul> 
 <h3>约定式的 model 组织方式</h3> 
 <p>符合以下规则的文件会被认为是 model 文件，</p> 
 <ul><li><p><code>src/models</code> 下的文件</p></li><li><p><code>src/pages</code> 下，子目录中 models 目录下的文件</p></li><li><p><code>src/pages</code> 下，所有 model.ts 文件(不区分任何字母大小写)</p></li></ul> 
 <h3>实际使用</h3> 
 <p>比如在src下新建 models文件夹,里面新建<code>test.ts</code></p> 
 <p><code>test.ts</code></p> 
 <pre class="has"><code class="language-go">import type { Effect, Reducer, Subscription } from 'umi'; // 映入umi 定义好的ts类型
import axios from '../request/request'; // 引入封装好的网络请求

// state 接口
export interface TextModelState {
  name?: string;
  testData?: string;
}

// test model接口
export interface TextModelType {
  namespace: 'testModel';
  state: TextModelState;
  effects: {
    query: Effect;
  };
  reducers: {
    save: Reducer&lt;TextModelState&gt;;
    msg: Reducer&lt;TextModelState&gt;;
  };
  subscriptions?: { setup: Subscription };
}

const IndexModel: TextModelType = {
  namespace: 'testModel',
  state: {
    name: '初始名字',
    testData: '初始testData',
  },
  effects: {
    *query(action, { call, put }) {
      const getDataTest = async () =&gt; {
        const data = await axios.get('test');
        return data;
      };
      let testData = yield call(getDataTest);
      yield put({
        type: 'msg',
        data: { testData: testData?.msg },
      });
    },
  },

  reducers: {
    save(state) {
      return {
        ...state,
        name: 'jimmy',
      };
    },
    msg(state, action) {
      return {
        ...state,
        testData: action?.data?.testData,
        testData2: action?.data?.testData2,
      };
    },
  },
};
export default IndexModel;

复制代码</code></pre> 
 <p>在src/pages下的<code>index.tsx</code>中使用</p> 
 <p><code>index.tsx</code></p> 
 <pre class="has"><code class="language-go">import type { Effect, Reducer, Subscription } from 'umi'; // 引入umi 定义好的ts类型
import axios from '../request/request'; // 引入封装好的网络请求

// state 接口
export interface TextModelState {
  name?: string;
  testData?: string;
}

// test model接口
export interface TextModelType {
  namespace: 'testModel';
  state: TextModelState;
  effects: {
    query: Effect;
  };
  reducers: {
    save: Reducer&lt;TextModelState&gt;;
    msg: Reducer&lt;TextModelState&gt;;
  };
  subscriptions?: { setup: Subscription };
}

const IndexModel: TextModelType = {
  namespace: 'testModel',
  state: {
    name: '初始名字',
    testData: '初始testData',
  },
  effects: {
    *query(action, { call, put }) {
      const getDataTest = async () =&gt; {
        const data = await axios.get('test');
        return data;
      };
      let testData = yield call(getDataTest);
      yield put({
        type: 'msg',
        data: { testData: testData?.msg },
      });
    },
  },

  reducers: {
    save(state) {
      return {
        ...state,
        name: 'jimmy',
      };
    },
    msg(state, action) {
      return {
        ...state,
        testData: action?.data?.testData,
        testData2: action?.data?.testData2,
      };
    },
  },
};
export default IndexModel;
复制代码</code></pre> 
 <h2>mfsu</h2> 
 <p><code>启用 mfsu 后，热启动得到 **10 倍** 提升；热更新提升 **50%**  以上！</code></p> 
 <p>如何启用</p> 
 <p>在 config/config.ts 中添加 <code>mfsu:{}</code></p> 
 <h2>项目源代码</h2> 
 <p>请点击我<sup>[10]</sup></p> 
 <p>和两个小伙伴一起,会根据实际运用中出现的问题或者没有考虑完善的地方,持续的更新迭代.如有问题,欢迎提Issue或者在评论区留言</p> 
 <h2>FAQ</h2> 
 <h3><code>umi</code> 不是内部或外部命令</h3> 
 <img src="https://images2.imgbox.com/f2/63/fPukFDrB_o.png" alt="2fba47f86491d3fbbccada3932de9660.png"> 
 <figcaption>
   image.png 
 </figcaption> 
 <p>解决办法</p> 
 <p>执行 <code>yarn global bin</code> 拿到 bin 路径。然后把这个路径添加到环境变量里面的系统变量的path里面</p> 
 <p>如果还是不行，执行</p> 
 <pre class="has"><code class="language-go">yarn global add umi
复制代码</code></pre> 
 <p><strong>如遇到更多问题，请查考</strong></p> 
 <p>官方FAQ<sup>[11]</sup></p> 
 <p>官方仓库的issue<sup>[12]</sup></p> 
 <p><code>大家还是要把官方文档看两遍哦,一些基础,简单的知识本文章没有涉及.</code></p> 
 <h2>最后</h2> 
 <p>如果后续自己还踩了坑，会继续更新，如果有什么错误或者建议，欢迎评论区留言，如果觉得文章对你有帮助，就点个赞支持一下呗。</p> 
 <p>关于本文<br></p> 
 <h2>作者：Jimmy_kiwi</h2> 
 <p>https://juejin.cn/post/7021358536504393741</p> 
 <p style="text-align:center;">The End<br></p> 
 <p>欢迎自荐投稿到《前端技术江湖》，如果你觉得这篇内容对你挺有启发，记得点个 <strong>「在看」</strong>哦</p> 
 <p style="text-align:right;">点个『在看』支持下 <img src="https://images2.imgbox.com/08/00/9Gd6mrp4_o.gif" alt="8c8512125b17dc352000156aa694e29a.gif"></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/81e6c3af2181acfa1e79fd90bcbee360/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">android 传文件的同事带参数怎么操作?以及Map中多一对双引号的原因</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/42b5278a2de43fadee9cde78e9579422/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows10安装anaconda</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>