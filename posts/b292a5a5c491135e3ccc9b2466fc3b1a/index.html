<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS7.4环境下的K8S搭建 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS7.4环境下的K8S搭建" />
<meta property="og:description" content="目录
1、k8s简介... 1
2、基础架构图... 1
2.1、master. 1
2.2、apiserver. 2
2.3、scheduler kubernetes. 2
2.4、Replication Controllers. 2
2.5、minion. 2
2.6、container. 2
2.7、 Pod. 3
2.8、Kube_proxy. 3
2.9、Etcd. 3
2.10、Services. 4
2.11、Labels 标签... 4
2.12、 Deployment. 4
2.13、Kubelet命令... 4
2.14、总结... 5
2.14.1、Kubernetes的架构... 5
2.14.2、Replication controller. 5
2.14.3、service. 5
2.14.4、Kubernetes. 5
2.14.5、pod. 5
3、环境规划... 5
4、环境准备... 6
4.1、配置k8s的yum源(master) 6
4.2、配置yum源（node1和node2）... 9
4.3、主机名规划... 10
4.4、配置/etc/hosts. 10
4.5、配置时间同步... 11
4.5.1、配置chrony服务端（master）... 11
4.5.2、配置chrony客户端（两个node节点都做）... 14
4.6、关闭防火墙... 15" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/b292a5a5c491135e3ccc9b2466fc3b1a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-17T15:14:29+08:00" />
<meta property="article:modified_time" content="2020-01-17T15:14:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS7.4环境下的K8S搭建</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;"><span style="color:#2e74b5;">目录</span></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181029" rel="nofollow">1、k8s简介... 1</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181030" rel="nofollow">2、基础架构图... 1</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181031" rel="nofollow">2.1、master. 1</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181032" rel="nofollow">2.2、apiserver. 2</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181033" rel="nofollow">2.3、scheduler kubernetes. 2</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181034" rel="nofollow">2.4、Replication Controllers. 2</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181035" rel="nofollow">2.5、minion. 2</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181036" rel="nofollow">2.6、container. 2</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181037" rel="nofollow">2.7、 Pod. 3</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181038" rel="nofollow">2.8、Kube_proxy. 3</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181039" rel="nofollow">2.9、Etcd. 3</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181040" rel="nofollow">2.10、Services. 4</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181041" rel="nofollow">2.11、Labels 标签... 4</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181042" rel="nofollow">2.12、 Deployment. 4</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181043" rel="nofollow">2.13、Kubelet命令... 4</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181044" rel="nofollow">2.14、总结... 5</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181045" rel="nofollow">2.14.1、Kubernetes的架构... 5</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181046" rel="nofollow">2.14.2、Replication controller. 5</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181047" rel="nofollow">2.14.3、service. 5</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181048" rel="nofollow">2.14.4、Kubernetes. 5</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181049" rel="nofollow">2.14.5、pod. 5</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181050" rel="nofollow">3、环境规划... 5</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181051" rel="nofollow">4、环境准备... 6</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181052" rel="nofollow">4.1、配置k8s的yum源(master) 6</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181053" rel="nofollow">4.2、配置yum源（node1和node2）... 9</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181054" rel="nofollow">4.3、主机名规划... 10</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181055" rel="nofollow">4.4、配置/etc/hosts. 10</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181056" rel="nofollow">4.5、配置时间同步... 11</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181057" rel="nofollow">4.5.1、配置chrony服务端（master）... 11</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181058" rel="nofollow">4.5.2、配置chrony客户端（两个node节点都做）... 14</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181059" rel="nofollow">4.6、关闭防火墙... 15</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181060" rel="nofollow">4.7、关闭selinux. 15</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181061" rel="nofollow">5、安装k8s. 16</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181062" rel="nofollow">5.1、安装包... 16</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181063" rel="nofollow">5.1.1、master节点安装包... 16</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181064" rel="nofollow">5.1.2、node节点安装包... 16</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181065" rel="nofollow">5.2、配置etcd服务器... 16</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181066" rel="nofollow">5.2.1、修改配置文件/etc/etcd/etcd.conf 16</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181067" rel="nofollow">5.2.2、配置文件说明... 17</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181068" rel="nofollow">5.2.3、启动etcd服务... 17</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181069" rel="nofollow">5.2.4、检查etcd通讯端口... 17</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181070" rel="nofollow">5.2.5、检查etcd集群成员表... 18</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181071" rel="nofollow">5.2.6、检查etcd集群健康状态... 18</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181072" rel="nofollow">5.3、配置master服务... 18</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181073" rel="nofollow">5.3.1、配置k8s配置文件... 18</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181074" rel="nofollow">5.3.2、config配置文件说明... 19</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181075" rel="nofollow">5.3.3、修改apiserver配置文件... 19</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181076" rel="nofollow">5.3.4、apiserver配置文件说明... 19</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181077" rel="nofollow">5.3.5、配置kube-controller-manager配置文件... 20</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181078" rel="nofollow">5.3.6、配置scheduler配置文件... 20</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181079" rel="nofollow">5.3.7、etcdctl命令使用... 21</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181080" rel="nofollow">5.3.8、设置etcd网络... 24</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181081" rel="nofollow">5.9、配置flanneld服务... 25</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181082" rel="nofollow">5.10、启动master上bube-apiserver服务... 29</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181083" rel="nofollow">5.11、启动master上kube-controller-manager 服务... 30</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181084" rel="nofollow">5.12、启动master上kube-scheduler服务... 30</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181085" rel="nofollow">5.4、配置node1 minion. 31</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181086" rel="nofollow">5.4.1、配置node1上的flanneld. 31</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181087" rel="nofollow">5.4.2、配置node1上master地址... 33</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181088" rel="nofollow">5.4.3、配置node1上的kube-proxy服务... 33</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181089" rel="nofollow">5.4.4、配置node1 kubelet. 34</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181090" rel="nofollow">5.4.5、启动node1上所有服务... 34</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181091" rel="nofollow">5.4.6、查看网卡... 39</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181092" rel="nofollow">5.4.7、查看kube-proxy. 41</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181093" rel="nofollow">5.5、配置node2 minion. 41</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181094" rel="nofollow">5.5.1、拷贝配置文件... 41</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181095" rel="nofollow">5.5.2、微改配置文件... 42</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181096" rel="nofollow">5.5.3、启动node2所有服务... 42</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181097" rel="nofollow">5.5.4、查看node2上所有服务... 42</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181098" rel="nofollow">5.5.5、查看网卡... 47</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181099" rel="nofollow">5.5.6、查看kube-proxy. 49</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181100" rel="nofollow">5.6、查看整个k8s集群状态... 50</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181101" rel="nofollow">5.7、集群服务总结... 50</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181102" rel="nofollow">5.7.1、etcd. 50</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181103" rel="nofollow">5.7.2、master. 51</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181104" rel="nofollow">5.7.3、node1-minion. 52</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181105" rel="nofollow">5.7.4、node2-minion. 53</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181106" rel="nofollow">6、Kubectl工具... 53</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181107" rel="nofollow">6.1、Kubectl概述... 53</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181108" rel="nofollow">6.2、启动相关服务... 53</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181109" rel="nofollow">6.3、获取集群状态... 53</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181110" rel="nofollow">6.4、查看版本... 53</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181111" rel="nofollow">6.5、kubectl常用命令... 54</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181112" rel="nofollow">6.6、kubectl使用举例... 54</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181113" rel="nofollow">6.6.1、上传基础镜像到所有node节点... 54</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181114" rel="nofollow">6.6.2、所有node节点上导入镜像... 55</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181115" rel="nofollow">6.6.3、所有node节点查看镜像... 57</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181116" rel="nofollow">6.6.4、kubectl run语法... 58</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181117" rel="nofollow">6.6.5、启动pod. 58</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181118" rel="nofollow">6.6.6、查看Deployment. 58</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181119" rel="nofollow">6.6.7、查看pod. 59</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181120" rel="nofollow">6.6.8、查看pod详细信息... 59</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181121" rel="nofollow">6.6.9、查看指定的pod详情... 60</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181122" rel="nofollow">6.6.10、pods常见的状态... 62</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181123" rel="nofollow">6.6.11、kubectl删除pod. 63</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181124" rel="nofollow">6.6.12、再创建一个pod. 64</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181125" rel="nofollow">6.6.13、删除deployment. 64</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181126" rel="nofollow">7、Yaml 65</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181127" rel="nofollow">7.1、yaml语法... 65</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181128" rel="nofollow">7.2、Yaml数据结构... 65</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181129" rel="nofollow">7.2.1、数据结构--对象... 65</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181130" rel="nofollow">7.2.2、数组... 66</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181131" rel="nofollow">7.2.3、复合结构... 67</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181132" rel="nofollow">7.2.4、纯量... 67</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181133" rel="nofollow">7.3、应用举例... 68</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181134" rel="nofollow">7.3.1、上传镜像到所有node节点... 68</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181135" rel="nofollow">7.3.2、上传mysql-deployment.yaml到master管理结点... 69</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181136" rel="nofollow">7.3.3、在node1和node2上导入mysql镜像... 69</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181137" rel="nofollow">7.3.4、Mysql-deployment.yaml文件内容... 70</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181138" rel="nofollow">7.3.5、该yaml文件结构... 72</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181139" rel="nofollow">7.3.6、通过yaml文件创建资源... 72</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181140" rel="nofollow">7.3.7、查看创建的pod. 73</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181141" rel="nofollow">7.3.8、查看创建的deployment. 73</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181142" rel="nofollow">7.3.9、查看pod详情... 73</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181143" rel="nofollow">7.3.10、查看service. 74</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181144" rel="nofollow">7.3.11、测试通信... 74</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181145" rel="nofollow">7.3.12、回顾：flannel地址的配置... 75</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181146" rel="nofollow">7.3.13、在node2上查看运行mysql docker实例... 75</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181147" rel="nofollow">7.3.14、简写总结... 76</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181148" rel="nofollow">7.3.15、kubectl describe. 77</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181149" rel="nofollow">7.3.16、Kubectl其他常用命令和参数... 84</a></p> 
<p style="margin-left:0cm;"><a href="#_Toc28181150" rel="nofollow">8、搭建K8s的web管理界面... 92</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181151" rel="nofollow">8.1、搭建步骤... 93</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181152" rel="nofollow">8.1.1、确认集群环境... 93</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181153" rel="nofollow">8.1.2、上传yaml文件到master. 93</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181154" rel="nofollow">8.1.3、修改apiserver. 94</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181155" rel="nofollow">8.1.4、配置文件说明... 96</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181156" rel="nofollow">8.1.5、service的三种端口... 97</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181157" rel="nofollow">8.1.6、service概述... 99</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181158" rel="nofollow">8.1.7、replicationController. 99</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181159" rel="nofollow">8.1.8、service和replicationController总结... 99</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181160" rel="nofollow">8.1.9、准备k8s相关的镜像... 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181161" rel="nofollow">8.1.10、上传yaml文件... 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181162" rel="nofollow">8.1.11、创建deployment. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181163" rel="nofollow">8.1.12、创建service. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181164" rel="nofollow">8.1.13、查看deployment. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181165" rel="nofollow">8.1.14、查看service. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181166" rel="nofollow">8.1.15、查看pod. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181167" rel="nofollow">8.1.16、查看指定pod. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181168" rel="nofollow">8.1.17、排错经验... 100</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181169" rel="nofollow">8.2、验证web浏览器访问... 100</a></p> 
<p style="margin-left:21pt;"><a href="#_Toc28181170" rel="nofollow">8.3、销毁web界面相关应用... 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181171" rel="nofollow">8.3.1、删除deployment. 100</a></p> 
<p style="margin-left:42pt;"><a href="#_Toc28181172" rel="nofollow">8.3.2、删除web对应的service. 100</a></p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181029">1</a>、k8s简介</h2> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubernetes </span><span style="color:#000000;">是Google开源的容器集群管理系统，基于Docker构建一个容器的调度服务，提供资源调度、均衡容灾、服务注册、劢态扩缩容等功能套件。 基于容器的云平台Kubernetes基于docker容器的云平台，简写成： k8s 。 openstack基于kvm虚拟机云平台。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">官网：https://kubernetes.io/ </span></p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181030">2</a>、基础架构图</h2> 
<p><img alt="" class="has" height="403" src="https://images2.imgbox.com/25/60/nd6LPmVq_o.png" width="553"></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181031">2.1</a>、master</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;"> kubernetes</span><span style="color:#000000;">管理结点 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181032">2.2</a>、apiserver</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">提供接口服务，用户通过apiserver来管理整个容器集群平台。API Server 负责和 etcd 交互（其他组件不会直接操作 etcd，只有 API Server 这么做），整个 kubernetes 集群的所有的交互都是以 API Server 为核心的。如：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2.2.1</span><span style="color:#000000;">、所有对集群迚行的查询和管理都要通过 API 来进行 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2.2.2</span><span style="color:#000000;">、所有模块之间并不会互相调用</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">而是通过和 API Server 打交道来完成自己那部分的工作 、API Server 提供的验证和授权保证了整个集群的安全 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181033">2.3</a>、scheduler kubernetes</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">调度服务 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181034">2.4</a>、Replication Controllers</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">复制， 保证pod的高可用 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Replication Controller</span><span style="color:#000000;">是Kubernetes系统中最有用的功能，实现复制多个Pod副本，往往一个应用需要多个Pod来支撑，并且可以保证其复制的副本数，即使副本所调度分配的宿主机出现异常，通过Replication Controller可以保证在其它宿主机使用同等数量的Pod。Replication Controller可以通过repcon模板来创建多个Pod副本，同样也可以直接复制已存在Pod，需要通过Label selector来关联。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181035">2.5</a>、minion</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">真正运行容器container的物理机。 kubernets中需要很多minion机器，来提供运算。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">minion [</span><span style="color:#000000;">ˈ</span><span style="color:#000000;">m</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">ni</span><span style="color:#000000;">ə</span><span style="color:#000000;">n] </span><span style="color:#000000;">爪牙 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181036">2.6</a>、container</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">容器 ，可以运行服务和程序 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181037">2.7</a>、 Pod</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">在Kubernetes系统中，调度的最小颗粒不是单纯的容器，而是抽象成一个Pod，Pod是一个可以被创建、销毁、调度、管理的最小的部署单元。pod中可以包括一个或一组容器。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pod [p</span><span style="color:#000000;">ɒ</span><span style="color:#000000;">d] </span><span style="color:#000000;">豆荚 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181038">2.8</a>、Kube_proxy</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">代理做端口转发，相当于LVS-NAT模式中的负载调度器器 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Proxy</span><span style="color:#000000;">解决了同一宿主机，相同服务端口冲突的问题，还提供了对外服务的能力，Proxy后端使用了随机、轮循负载均衡算法。 </span></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="383" src="https://images2.imgbox.com/51/2c/fKcro397_o.png" width="553"></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181039">2.9</a>、Etcd</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcd</span><span style="color:#000000;">存储kubernetes的配置信息，可以理解为是k8s的数据库，存储着k8s容器云平台中所有节点、pods、网络等信息。linux 系统中/etc 目录作用是存储配置文件。 所以etcd （daemon） 是一个存储配置文件的后台服务。</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181040">2.10</a>、Services</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">Services</span><span style="color:#000000;">是Kubernetes最外围的单元，通过虚拟一个访问IP及服务端口，可以访问我们定义好的Pod资源，目前的版本是通过iptables的nat转发来实现，转发的目标端口为Kube_proxy生成的随机端口。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181041">2.11</a>、Labels 标签</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">Labels</span><span style="color:#000000;">是用于区分Pod、Service、Replication Controller的key/value键值对，仅使用在Pod、Service、 Replication Controller之间的关系识别，但对这些单元本身进行操作时得使用name标签。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181042">2.12</a>、 Deployment</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">Deployment [d</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">'pl</span><span style="color:#000000;">ɔ</span><span style="color:#000000;">.m</span><span style="color:#000000;">ə</span><span style="color:#000000;">nt] </span><span style="color:#000000;">部署 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubernetes Deployment</span><span style="color:#000000;">用于更新Pod和Replica Set(下一代的Replication Controller)的方法，你可以在Deployment对象中只描述你所期望的理想状态（预期的运行状态），Deployment控制器会将现在的实际状态转换成期望的状态。例如，将所有的webapp:v1.0.9升级成webapp:v1.1.0，只需创建一个Deployment，Kubernetes会按照Deployment自动进行升级。通过Deployment可以用来创建新的资源。 Deployment可以帮我们实现无人值守的上线，大大降低我们的上线过程的复杂沟通、操作风险。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181043">2.13</a>、Kubelet命令</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubelet</span><span style="color:#000000;">和Kube-proxy都运行在minion节点上。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kube-proxy </span><span style="color:#000000;">实现Kubernetes网络相关内容。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubelet</span><span style="color:#000000;">命令管理Pod、Pod中容器及容器的镜像和卷等信息。 </span></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="190" src="https://images2.imgbox.com/4b/88/hMgpdsLi_o.png" width="162"></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181044">2.14</a>、总结</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181045">2.14.1</a>、Kubernetes的架构</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">由一个master和多个minion组成，master通过api提供服务，接受kubectl的请求来调度管理整个集群。 kubectl： 是k8s平台的一个管理命令。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181046">2.14.2</a>、Replication controller</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">定义了多个pod或者容器需要运行，如果当前集群中运行的pod或容器达不到配置的数量，replication controller会调度容器在多个minion上运行，保证集群中的pod数量。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181047">2.14.3</a>、service</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">则定义真实对外提供的服务，一个service会对应后端运行的多个container。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181048">2.14.4</a>、Kubernetes</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">是个管理平台，minion上的kube-proxy 拥有提供真实服务公网IP。客户端访问kubernetes中提供的服务，是直接访问到kube-proxy上的。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181049">2.14.5</a>、pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在Kubernetes中pod是一个基本单元，一个pod可以是提供相同功能的多个container，这些容器会被部署在同一个minion上。minion是运行Kubelet中容器的物理机。minion接受master的指令创建pod或者容器。 </span></p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181050">3</a>、环境规划</h2> 
<table border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">节点角色</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">IP</span><span style="color:#000000;">地址</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Cpu</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">内存</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">OS</span></p> </td></tr><tr><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">master</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.178</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">2core</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">3G</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Centos7.4</span></p> </td></tr><tr><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">etcd</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.178</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">2core</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">3G</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Centos7.4</span></p> </td></tr><tr><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Node1</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.179</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">2core</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">3G</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Centos7.4</span></p> </td></tr><tr><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Node2</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.180</span></p> </td><td style="vertical-align:top;width:85.2pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">2core</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">3G</span></p> </td><td style="vertical-align:top;width:85.25pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">Centos7.4</span></p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：正常需要4台机器，如果你内存不够，master和etcd可以运行在同一台机器上。</span></p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181051">4</a>、环境准备</h2> 
<h3 style="margin-left:0cm;"><a name="_Toc28181052">4.1</a>、配置k8s的yum源(master)</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们使用的docker-1.12的版本。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">把k8s-package.tar.gz上传到master节点上。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# ll k8s-package.tar.gz</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">-rw-r--r-- 1 root root 186724113 Dec 18 19:18 k8s-package.tar.gz</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# tar -xzvf k8s-package.tar.gz</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">CentOS-7-x86_64-DVD-1708.iso  k8s-package  k8s-package.tar.gz</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# cp -R /soft/k8s-package /var/www/html/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# cd /var/www/html/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">centos7.4  k8s-package</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">新建repo文件配置yum源</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yum.repos.d]# cat /etc/yum.repos.d/k8s-package.repo </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[k8s-package]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name=k8s-package</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">baseurl=http://192.168.2.178/k8s-package</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">enabled=1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">gpgcheck=0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yum.repos.d]# cat local.repo </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[centos7-Server]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name=centos7-Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">baseurl=http://192.168.2.178/centos7.4</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">enabled=1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">gpgcheck=0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yum.repos.d]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">安装httpd服务（自行配置本地yum源）</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">yum -y install httpd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">启动httpd服务</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">systemctl start httpd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">systemctl enable httpd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建httpd挂载目录</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mkdir /var/www/html/centos7.4</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">挂载镜像到httpd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master soft]# mount -o loop CentOS-7-x86_64-DVD-1708.iso /var/www/html/centos7.4/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mount: /soft/CentOS-7-x86_64-DVD-1708.iso is already mounted</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">清除yum源</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# yum clean all</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded plugins: fastestmirror</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Cleaning repos: centos7-Server k8s-package</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Cleaning up everything</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Cleaning up list of fastest mirrors</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# yum makecache</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded plugins: fastestmirror</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">centos7-Server                                                                                                                                                                       | 3.6 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">k8s-package                                                                                                                                                                          | 2.9 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(1/7): centos7-Server/group_gz                                                                                                                                                       | 156 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(2/7): centos7-Server/primary_db                                                                                                                                                     | 3.1 MB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(3/7): centos7-Server/filelists_db                                                                                                                                                   | 3.1 MB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(4/7): centos7-Server/other_db                                                                                                                                                       | 1.2 MB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(5/7): k8s-package/filelists_db                                                                                                                                                      |  14 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(6/7): k8s-package/other_db                                                                                                                                                          |  17 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">(7/7): k8s-package/primary_db                                                                                                                                                        |  32 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Determining fastest mirrors</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Metadata Cache Created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181053">4.2</a>、配置yum源（node1和node2）</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">从master上拷贝repo文件到另外两个节点</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#FF0000;">scp /etc/yum.repos.d/local.repo /etc/yum.repos.d/k8s-package.repo 192.168.2.179:/etc/yum.repos.d/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">root@192.168.2.179's password: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">local.repo                                                                                                                                                                100%   98    39.7KB/s   00:00    </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">k8s-package.repo                                                                                                                                                          100%   93    26.1KB/s   00:00    </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#FF0000;">scp /etc/yum.repos.d/local.repo /etc/yum.repos.d/k8s-package.repo 192.168.2.180:/etc/yum.repos.d/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">root@192.168.2.180's password: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">local.repo                                                                                                                                                                100%   98    15.9KB/s   00:00    </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">k8s-package.repo                                                                                                                                                          100%   93    36.0KB/s   00:00    </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在另外两个节点上生成yum缓存</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">yum clean all</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">yum makecache</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181054">4.3</a>、主机名规划</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">配置主机名</span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">IP</span></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">主机名</span></p> </td></tr><tr><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.178</span></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">master</span></p> </td></tr><tr><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.179</span></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">node1</span></p> </td></tr><tr><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">192.168.2.180</span></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">node2</span></p> </td></tr></tbody></table> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@</span><span style="color:#FF0000;">master</span><span style="color:#000000;"> html]# cat /etc/hostname</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Master</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@</span><span style="color:#FF0000;">node1</span><span style="color:#000000;"> yum.repos.d]# cat /etc/hostname</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@</span><span style="color:#FF0000;">node2</span><span style="color:#000000;"> ~]# cat /etc/hostname</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node2</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181055">4.4</a>、配置/etc/hosts</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">配置/etc/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">三台机器都加入下面的红色部分</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# cat /etc/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">192.168.2.178  master etcd</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">192.168.2.179  node1</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">192.168.2.180  node2</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181056">4.5</a>、配置时间同步</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181057">4.5.1</a>、配置chrony服务端（master）</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们以master为时间同步服务器，另外两台同步master的时间</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">配置master</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查chrony包</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# rpm -qa |grep chrony</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">安装chrony包</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# yum -y install chrony</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">编辑chrony配置文件</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# vi /etc/chrony.conf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Use public servers from the pool.ntp.org project.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">#server 0.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">#server 1.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">#server 2.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">#server 3.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Record the rate at which the system clock gains/losses time.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">driftfile /var/lib/chrony/drift</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Allow the system clock to be stepped in the first three updates</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># if its offset is larger than 1 second.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">makestep 1.0 3</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Enable kernel synchronization of the real-time clock (RTC).</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">rtcsync</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Enable hardware timestamping on all interfaces that support it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#hwtimestamp *</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Increase the minimum number of selectable sources required to adjust</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># the system clock.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#minsources 2</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Allow NTP client access from local network.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#allow 192.168.0.0/16</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">allow 192.168.0.0/16</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Serve time even if not synchronized to a time source.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#local stratum 10</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">local stratum 8</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Specify file containing keys for NTP authentication.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#keyfile /etc/chrony.keys</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Specify directory for log files.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">logdir /var/log/chrony</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Select which information is logged.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#log measurements statistics tracking</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">飘红的部分是修改/增加的内容。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">重启chrony服务</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# systemctl restart chronyd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# systemctl enable chronyd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查123端口监听</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#FF0000;">netstat -an |grep 123</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">udp        0      0 0.0.0.0:123             0.0.0.0:*                          </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">unix  2      [ ACC ]     STREAM     LISTENING     23123    private/verify</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181058">4.5.2</a>、配置chrony客户端（两个node节点都做）</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查chrony安装</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# rpm -qa|grep chrony</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">安装chrony</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# yum -y install chrony</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">编辑chrony配置文件</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# vi /etc/chrony.conf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注释掉如下内容：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#server 0.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#server 1.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#server 2.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#server 3.centos.pool.ntp.org iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">添加下面一行，master的ip地址</span></p> 
<p style="margin-left:0cm;"><span style="color:#FF0000;">server 192.168.2.178 iburst</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">重启chrony服务</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# systemctl restart chronyd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# systemctl enable chronyd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查同步</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# timedatectl</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      Local time: Sat 2019-12-21 12:19:49 CST</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Universal time: Sat 2019-12-21 04:19:49 UTC</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RTC time: Sat 2019-12-21 04:19:49</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">       Time zone: Asia/Shanghai (CST, +0800)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     NTP enabled: yes</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">NTP synchronized: yes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> RTC in local TZ: no</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      DST active: n/a</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# chronyc sources</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">210 Number of sources = 1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">===============================================================================</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">^*</span><span style="color:#c00000;"> master</span><span style="color:#000000;">                        8   6    37     8   +562ns[+1331us] +/-  589us</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181059">4.6</a>、关闭防火墙</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">所有节点都需要执行</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld &amp;&amp; systemctl status firewalld</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181060">4.7</a>、关闭selinux</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">所有节点都需要关闭selinux</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# cat /etc/selinux/config</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">修改为：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">SELINUX=disabled</span></p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181061">5</a>、安装k8s</h2> 
<h3 style="margin-left:0cm;"><a name="_Toc28181062">5.1</a>、安装包</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181063">5.1.1</a>、master节点安装包</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在master节点上安装如下包</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#FF0000;">yum install -y kubernetes etcd flannel</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：Flannel为Docker提供一种可配置的虚拟重叠网络。实现跨物理机的容器之间能直接访问 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">1</span><span style="color:#000000;">、Flannel在每一台主机上运行一个 agent。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2</span><span style="color:#000000;">、flanneld，负责在提前配置好的地址空间中分配子网租约。Flannel使用etcd来存储网络配置。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">3</span><span style="color:#000000;">、chrony：主要用于同步容器云平台中所有结点的时间。云平台中结点的时间需要保持一致。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">4</span><span style="color:#000000;">、kubernetes 中包括了服务端和客户端相关的软件包 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">5</span><span style="color:#000000;">、etcd是etcd服务的软件包 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181064">5.1.2</a>、node节点安装包</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">两个node节点安装如下包</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#FF0000;">yum install kubernetes flannel -y</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">每个minion都要安装一样 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181065">5.2</a>、配置etcd服务器</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181066">5.2.1</a>、修改配置文件/etc/etcd/etcd.conf</h4> 
<p style="margin-left:0cm;">按照规划，etcd服务运行在master节点上</p> 
<p style="margin-left:0cm;">vi <span style="color:#000000;">/etc/etcd/etcd.conf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_LISTEN_CLIENT_URLS="http://localhost:2379</span><span style="color:#c00000;">,http://192.168.2.178:2379</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_ADVERTISE_CLIENT_URLS="</span><span style="color:#c00000;">http://192.168.2.178:2379</span><span style="color:#000000;">"</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181067">5.2.2</a>、配置文件说明</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">第一行红色的是加的，第二行红色的是改的，需要指定成自己的master的ip。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/etc/etcd/etcd.conf</span><span style="color:#000000;">配置文件含意如下： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_NAME="default" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcd</span><span style="color:#000000;">节点名称，如果etcd集群只有一台etcd，这一项可以注释不用配置，默认名称为default，这个名字后面会用到。这里我们就用默认的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_DATA_DIR="/var/lib/etcd/default.etcd" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcd</span><span style="color:#000000;">存储数据的目录，这里我们也是使用默认的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_LISTEN_CLIENT_URLS="http://localhost:2379,http://192.168.1.63:2379" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcd</span><span style="color:#000000;">对外服务监听地址，一般默认端口就是2379端口，我们不改，如果为0.0.0.0将会监听所有接口 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ETCD_ARGS="" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">需要额外添加的参数，可以自己添加，etcd的所有参数可以通过etcd -h查看。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181068">5.2.3</a>、启动etcd服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# systemctl start etcd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# systemctl enable etcd</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181069">5.2.4</a>、检查etcd通讯端口</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# netstat -antup | grep 2379</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:2379          0.0.0.0:*               LISTEN      982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:2379      0.0.0.0:*               LISTEN      982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:60368     192.168.2.178:2379      ESTABLISHED 982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:37860         127.0.0.1:2379          ESTABLISHED 982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:2379          127.0.0.1:37860         ESTABLISHED 982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:2379      192.168.2.178:60368     ESTABLISHED 982/etcd</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181070">5.2.5</a>、检查etcd集群成员表</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl member list</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">8e9e05c52164694d: name=default peerURLs=http://localhost:2380 clientURLs=http://192.168.2.178:2379 isLeader=true</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181071">5.2.6</a>、检查etcd集群健康状态</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl cluster-health</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">member 8e9e05c52164694d is healthy: got healthy result from http://192.168.2.178:2379</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">cluster is healthy</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">到此etcd节点成功。</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181072">5.3</a>、配置master服务</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181073">5.3.1</a>、配置k8s配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# vi /etc/kubernetes/config</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_MASTER="--master=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:8080"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">飘红的是改的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">指定master在192.168.2.178 IP上监听端口8080</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181074">5.3.2</a>、config配置文件说明</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：/etc/kubernetes/config配置文件含意： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_LOGTOSTDERR="--logtostderr=true" #</span><span style="color:#000000;">表示错误日志记录到文件还是输出到stderr标准错误输出。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_LOG_LEVEL="--v=0" #</span><span style="color:#000000;">日志等级。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_ALLOW_PRIV="--allow_privileged=false" #</span><span style="color:#000000;">是否允讲运行特权容器。false表示丌允讲特权容器 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181075">5.3.3</a>、修改apiserver配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_API_ADDRESS="--insecure-bind-address=</span><span style="color:#c00000;">0.0.0.0</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_ETCD_SERVERS="--etcd-servers=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:2379"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">上面飘红的是改的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">下面这行注释掉：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#KUBE_ADMISSION_CONTROL="--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">新增为如下内容：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_ADMISSION_CONTROL="--admission-control=AlwaysAdmit"</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181076">5.3.4</a>、apiserver配置文件说明</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：/etc/kubernetes/apiserver配置文件含意： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_API_ADDRESS="--insecure-bind-address=0.0.0.0" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">##</span><span style="color:#000000;">监听的接口，如果配置为127.0.0.1则只监听localhost，配置为0.0.0.0会监听所有接口，这里配置为0.0.0.0。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_ETCD_SERVERS="--etcd-servers=http://192.168.2.178:2379" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#etcd</span><span style="color:#000000;">服务地址，前面已经启动了etcd服务 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_SERVICE_ADDRESSES="--service-cluster-ip-range=10.254.0.0/16" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#kubernetes</span><span style="color:#000000;">可以分配的ip的范围，kubernetes启动的每一个pod以及serveice都会分配一个ip地址，将从这个范围中分配IP。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_ADMISSION_CONTROL="--admission-control=AlwaysAdmit" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">不做限制，允讲所有节点可以访问apiserver ，对所有请求开绿灯。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">admission [</span><span style="color:#000000;">ə</span><span style="color:#000000;">d</span><span style="color:#000000;">ˈ</span><span style="color:#000000;">m</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">.n] </span><span style="color:#000000;">承认;准讲迚入 ， Admit [</span><span style="color:#000000;">ə</span><span style="color:#000000;">d</span><span style="color:#000000;">ˈ</span><span style="color:#000000;">m</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">t] </span><span style="color:#000000;">承认 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">扩展：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">admission-control</span><span style="color:#000000;">（准入控制） 概述：admission controller本质上一段代码，在对kubernetes api的请求过程中，顺序为 先经过认证和授权，然后执行准入操作，最后对目标对象迚行操作。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181077">5.3.5</a>、配置kube-controller-manager配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">cat /etc/kubernetes/controller-manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">该配置文件默认不需要改，够用。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">配置kube-scheduler配置文件 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181078">5.3.6</a>、配置scheduler配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# vi /etc/kubernetes/scheduler</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_SCHEDULER_ARGS="--address=</span><span style="color:#c00000;">0.0.0.0</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">改scheduler监听到的地址为：0.0.0.0，默认是127.0.0.1。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181079">5.3.7</a>、etcdctl命令使用</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcdctl </span><span style="color:#000000;">是操作etcd非关系型数据库的一个命令行客户端，它能提供一些简洁的命令，供用户直接跟 etcd 数据库打交道。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcdctl </span><span style="color:#000000;">的命令，大体上分为数据库操作和非数据库操作两类。数据库操作主要是围绕对键值和目录的CRUD完整生命周期的管理。 注：CRUD 即 Create, Read, Update, Delete。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcd</span><span style="color:#000000;">在键的组织上采用了层次化的空间结构（类似于文件系统中目录的概念），用户指定的键可以为单独的名字，如 testkey，此时实际上放在根目录 / 下面，也可以为指定目录结构，如 cluster1/node2/testkey，则将创建相应的目录结构。 </span></p> 
<p>5.3.7.1、etcdctl数据库操作</p> 
<p>5.3.7.1、set</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">指定某个键的值。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例如：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl set mk "shen"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">shen</span></p> 
<p>5.3.7.2、get</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl get mk</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">shen</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl set /testdir/testkey "hello world"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">hello world</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl get /testdir/testkey</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">hello world</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span></p> 
<p>5.3.7.3、update</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">当键存在时，更新值内容。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl update /testdir/testkey aaaa</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">aaaa</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl get /testdir/testkey</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">aaaa</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.4、rm</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">删除某个键值。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl rm mk</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PrevNode.Value: shen</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl rm /testdir/testkey</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PrevNode.Value: aaaa</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.5、etcdctl mk和etcdctl set区别</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcdctl mk </span><span style="color:#000000;">如果给定的键不存在，则创建一个新的键值。如果给定的键存在，则报错，无法创建。etcdctl set ，不管给定的键是否存在，都会创建一个新的键值。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl mk /testdir/testkey "Hello world"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Hello world</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl mk /testdir/testkey "bbbb"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Error:  105: Key already exists (/testdir/testkey) [728]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.6、mkdir</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建一个目录</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl mkdir testdir1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.7、ls</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">列出目录（默认为根目录）下的键或者子目录，默认不显示子目录中内容。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/registry</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/testdir1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/testdir</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/k8s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl ls /testdir</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/testdir/testkey</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.2、etcdctl非数据库操作</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcdctl member </span><span style="color:#000000;">后面可以加参数list、add、remove 命令。表示列出、添加、删除 etcd 实例到 etcd 集群中。</span></p> 
<p>5.3.7.2.1、list</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例如本地启动一个 etcd 服务实例后，可以用如下命令进行查看。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl member list</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">8e9e05c52164694d: name=default peerURLs=http://localhost:2380 clientURLs=http://192.168.2.178:2379 isLeader=true</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.3.7.2.2、add</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们这里就一个etcd服务器，add就不做了。</span></p> 
<p>5.3.7.2.3、remove</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们这里就一个etcd服务器，add就不做了。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181080">5.3.8</a>、设置etcd网络</h4> 
<p>5.3.8.1、创建目录</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl mkdir /k8s/network</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Error:  105: Key already exists (/k8s/network) [729]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建一个目录/ k8s/network用于存储flannel网络信息 。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我这里原来已经创建了，所以报错，没关系，我们需要创建这个目录，后面会用到。</span></p> 
<p>5.3.8.2、设置值</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl set /k8s/network/config '{"Network": "10.255.0.0/16"}'</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">给/k8s/network/config 赋一个字符串的值 '{"Network": "10.255.0.0/16"}' ，这个后续会用到。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看我们设置的值</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# etcdctl get /k8s/network/config</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">{"Network":"10.255.0.0/16"}</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：在启动flannel之前，需要在etcd中添加一条网络配置记录，这个配置将用于flannel分配给每个docker的虚拟IP地址段。用于配置在minion上docker的IP地址. </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">由于flannel将覆盖docker0上的地址，所以flannel服务要先于docker服务启动。如果docker服务已经启动，则先停止docker服务，然后启动flannel，再启动docker。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181081">5.9</a>、配置flanneld服务</h4> 
<p>5.9.1、flannel启动过程解析</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">从etcd中获取出/k8s/network/config的值</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">划分subnet子网，并在etcd中进行注册</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">将子网信息记录到/run/flannel/subnet.env中 </span></p> 
<p>5.9.2、配置flanneld服务</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">vi </span><span style="color:#000000;">/etc/sysconfig/flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_ETCD_ENDPOINTS="http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:2379"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_ETCD_PREFIX="</span><span style="color:#c00000;">/k8s/network</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_OPTIONS="</span><span style="color:#c00000;">--iface=ens33</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">分别指定etcd服务端地址，网络路径和通信的物理网卡。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">物理网卡可以通过ifconfig -a查看：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# ifconfig -a</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">ens33</span><span style="color:#000000;">: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">  netmask 255.255.255.0  broadcast 192.168.2.255</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::60d3:d739:1f01:9258  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 00:0c:29:d8:be:5b  txqueuelen 1000  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 4618  bytes 421413 (411.5 KiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 2  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 13473  bytes 17541537 (16.7 MiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p>5.9.3、启动flanneld服务</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl start flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl enable flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/flanneld.service to /usr/lib/systemd/system/flanneld.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/docker.service.requires/flanneld.service to /usr/lib/systemd/system/flanneld.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span><span style="color:#c00000;"> systemctl status flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● flanneld.service - Flanneld overlay address etcd agent</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/flanneld.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: active (running) since Sat 2019-12-21 18:35:02 CST; 20s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 12413 (flanneld)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/flanneld.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─12413 /usr/bin/flanneld -etcd-endpoints=http://192.168.2.178:2379 -etcd-prefix=/k8s/network --iface...</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master systemd[1]: Starting Flanneld overlay address etcd agent...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.719599   12413 main.go:132] Installing signal handlers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.720139   12413 manager.go:149] Using interface ....178</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.720164   12413 manager.go:166] Defaulting exter...178)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.722622   12413 local_manager.go:179] Picking su...55.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.741850   12413 manager.go:250] Lease acquired: ...0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master flanneld-start[12413]: I1221 18:35:02.742097   12413 network.go:98] Watching for new ...ases</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 18:35:02 master systemd[1]: Started Flanneld overlay address etcd agent.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Hint: Some lines were ellipsized, use -l to show in full.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p>5.9.4、查看flanneld服务网卡</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# ifconfig -a</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet 192.168.2.178  netmask 255.255.255.0  broadcast 192.168.2.255</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::60d3:d739:1f01:9258  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 00:0c:29:d8:be:5b  txqueuelen 1000  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 4856  bytes 446523 (436.0 KiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 2  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 13605  bytes 17565375 (16.7 MiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">flannel0</span><span style="color:#000000;">: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">10.255.91.0</span><span style="color:#000000;">  netmask 255.255.0.0  destination 10.255.91.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::cc29:5eca:e542:e3fa  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 3  bytes 144 (144.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p>5.9.5、查看子网信息</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# cat /run/flannel/subnet.env</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_NETWORK=10.255.0.0/16</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_SUBNET=10.255.91.1/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_MTU=1472</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_IPMASQ=false</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">之后将会有一个脚本将subnet.env转写成一个docker的环境变量文件/run/flannel/docker。docker0的地址是由 /run/flannel/subnet.env 的 FLANNEL_SUBNET 参数决定的。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# cat /run/flannel/docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">DOCKER_OPT_BIP="--bip=10.255.91.1/24"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">DOCKER_OPT_IPMASQ="--ip-masq=true"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">DOCKER_OPT_MTU="--mtu=1472"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">DOCKER_NETWORK_OPTIONS=" --bip=10.255.91.1/24 --ip-masq=true --mtu=1472"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181082">5.10</a>、启动master上bube-apiserver服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span><span style="color:#c00000;"> systemctl restart kube-apiserver</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl enable kube-apiserver</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-apiserver.service to /usr/lib/systemd/system/kube-apiserver.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span><span style="color:#c00000;"> systemctl status kube-apiserver</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kube-apiserver.service - Kubernetes API Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kube-apiserver.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: active (running) since Sat 2019-12-21 18:40:02 CST; 32s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 12495 (kube-apiserver)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kube-apiserver.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─12495 /usr/bin/kube-apiserver --logtostderr=true --v=0 --etcd-servers=http://192.168.2.178:2379 --i...</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181083">5.11</a>、启动master上kube-controller-manager 服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span><span style="color:#c00000;"> systemctl restart kube-controller-manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl enable kube-controller-manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-controller-manager.service to /usr/lib/systemd/system/kube-controller-manager.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl status kube-controller-manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kube-controller-manager.service - Kubernetes Controller Manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kube-controller-manager.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: active (running) since Sat 2019-12-21 18:41:47 CST; 13s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 12527 (kube-controller)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kube-controller-manager.service</span></p> 
<p style="margin-left:0cm;">           <span style="color:#000000;">└─12527 /usr/bin/kube-controller-manager --logtostderr=true --v=0 --master=http://192.168.2.178:8080</span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181084">5.12</a>、启动master上kube-scheduler服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#</span><span style="color:#c00000;"> systemctl restart kube-scheduler</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl enable kube-scheduler</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-scheduler.service to /usr/lib/systemd/system/kube-scheduler.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">systemctl status kube-scheduler</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kube-scheduler.service - Kubernetes Scheduler Plugin</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kube-scheduler.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: active (running) since Sat 2019-12-21 18:43:09 CST; 13s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 12559 (kube-scheduler)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kube-scheduler.service</span></p> 
<p style="margin-left:0cm;">           <span style="color:#000000;">└─12559 /usr/bin/kube-scheduler --logtostderr=true --v=0 --master=http://192.168.2.178:8080 --address...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">至此etcd和master节点成功。</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181085">5.4</a>、配置node1 minion</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181086">5.4.1</a>、配置node1上的flanneld</h4> 
<p>5.4.1.1、从master上拷贝flanneld配置文件</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们直接在node1上执行scp命令，从master复制该文件过来</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">scp 192.168.2.178:/etc/sysconfig/flanneld /etc/sysconfig/flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">The authenticity of host '192.168.2.178 (192.168.2.178)' can't be established.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ECDSA key fingerprint is SHA256:Izdvj8GeIvx0CwRk7VfCqwhWtkpLFkmmFNyxXbRwlZQ.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ECDSA key fingerprint is MD5:37:34:aa:ec:34:95:cd:1a:a0:ce:4a:38:d0:f9:87:de.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Are you sure you want to continue connecting (yes/no)? yes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Permanently added '192.168.2.178' (ECDSA) to the list of known hosts.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">root@192.168.2.178's password: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">flanneld                                                                         100%  412    38.3KB/s   00:00</span></p> 
<p>5.4.1.2、在node1上启动flanneld服务</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl restart flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl enable flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl status flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● flanneld.service - Flanneld overlay address etcd agent</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/flanneld.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:03:05 CST; 35s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2398 (flanneld)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/flanneld.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2398 /usr/bin/flanneld -etcd-endpoints=http://192.168.2.178:2379 -etcd-prefix=/k8s/network --iface=...</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 systemd[1]: Starting Flanneld overlay address etcd agent...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.372411    2398 main.go:132] Installing signal handlers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.372712    2398 manager.go:149] Using interface w...2.179</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.372724    2398 manager.go:166] Defaulting extern....179)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.376068    2398 local_manager.go:179] Picking sub...255.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.382847    2398 manager.go:250] Lease acquired: 1....0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.384297    2398 network.go:98] Watching for new s...eases</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 flanneld-start[2398]: I1221 19:03:05.392479    2398 network.go:191] Subnet added: 10.....0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:03:05 node1 systemd[1]: Started Flanneld overlay address etcd agent.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Hint: Some lines were ellipsized, use -l to show in full.</span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181087">5.4.2</a>、配置node1上master地址</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# vi /etc/kubernetes/config</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_MASTER="--master=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:8080"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">飘红的是master的地址。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181088">5.4.3</a>、配置node1上的kube-proxy服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">kube-proxy</span><span style="color:#000000;">的作用主要是负责service的实现，具体来说，就是实现了内部从pod到service。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# grep -v '^#' /etc/kubernetes/proxy</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBE_PROXY_ARGS=""</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">不用修改，默认就是监听所有ip。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：如果启动服务失败，可以使用tail -f /var/log/messages 动态查看日志。</span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181089">5.4.4</a>、配置node1 kubelet</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubelet</span><span style="color:#000000;">运行在minion节点上。Kubelet组件管理Pod、Pod中容器及容器的镜像和卷等信息。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# vi /etc/kubernetes/kubelet</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_ADDRESS="--address=</span><span style="color:#c00000;">0.0.0.0</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">默认只监听127.0.0.1，要改成：0.0.0.0，因为后期要使用kubectl进程连接到kubelet服务上，来查看pod及pod中容器的状态。如果是127就无法进程连接kubelet服务。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_HOSTNAME="--hostname-override=</span><span style="color:#c00000;">node1</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># minion</span><span style="color:#000000;">的主机名，设置成和本主机机名一样，便于识别。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_API_SERVER="--api-servers=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:8080"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">指定apiserver的地址 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">扩展：第17行的意思： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_POD_INFRA_CONTAINER="--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_POD_INFRA_CONTAINER </span><span style="color:#000000;">指定pod基础容器镜像地址。这个是一个基础容器，每一个Pod启动的时候都会启动一个这样的容器。如果你的本地没有这个镜像，kubelet会连接外网把这个镜像下载下来。最开始的时候是在Google的registry上，因此国内因为GFW都下载不了导致Pod运行不起来。现在每个版本的Kubernetes都把这个镜像地址改成红帽的地址了。你也可以提前传到自己的registry上，然后再用这个参数指定成自己的镜像链接。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：https://access.redhat.com/containers/ 是红帽的容器下载站点 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181090">5.4.5</a>、启动node1上所有服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl restart flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl enable flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-proxy.service to /usr/lib/systemd/system/kube-proxy.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">systemctl status flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● flanneld.service - Flanneld overlay address etcd agent</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/flanneld.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:16:57 CST; 20s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2485 (flanneld)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/flanneld.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2485 /usr/bin/flanneld -etcd-endpoints=http://192.168.2.178:2379 -etcd-prefix=/k8s/network --iface=ens33</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:56 node1 systemd[1]: Starting Flanneld overlay address etcd agent...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:56 node1 flanneld-start[2485]: I1221 19:16:56.894429    2485 main.go:132] Installing signal handlers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:56 node1 flanneld-start[2485]: I1221 19:16:56.896023    2485 manager.go:149] Using interface with name ens....2.179</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:56 node1 flanneld-start[2485]: I1221 19:16:56.896048    2485 manager.go:166] Defaulting external address t...2.179)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 flanneld-start[2485]: I1221 19:16:57.041167    2485 local_manager.go:134] Found lease (10.255.31....eusing</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 flanneld-start[2485]: I1221 19:16:57.047416    2485 manager.go:250] Lease acquired: 10.255.31.0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 flanneld-start[2485]: I1221 19:16:57.052767    2485 network.go:98] Watching for new subnet leases</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 flanneld-start[2485]: I1221 19:16:57.156192    2485 network.go:191] Subnet added: 10.255.91.0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 systemd[1]: Started Flanneld overlay address etcd agent.</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kube-proxy.service - Kubernetes Kube-Proxy Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kube-proxy.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running) </span><span style="color:#000000;">since Sat 2019-12-21 19:16:56 CST; 20s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2482 (kube-proxy)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kube-proxy.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2482 /usr/bin/kube-proxy --logtostderr=true --v=0 --master=http://192.168.2.178:8080</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: E1221 19:16:57.979426    2482 server.go:421] Can't get Node "node1", assuming i... found</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: I1221 19:16:57.988178    2482 server.go:215] Using iptables Proxier.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: W1221 19:16:57.991189    2482 server.go:468] Failed to retrieve node info: node... found</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: W1221 19:16:57.991276    2482 proxier.go:248] invalid nodeIP, initialize kube-p...nodeIP</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: W1221 19:16:57.991284    2482 proxier.go:253] clusterCIDR not specified, unable...raffic</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:57 node1 kube-proxy[2482]: I1221 19:16:57.991295    2482 server.go:227] Tearing down userspace rules.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:58 node1 kube-proxy[2482]: I1221 19:16:58.159672    2482 conntrack.go:81] Set sysctl 'net/netfilter/nf_con...131072</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:58 node1 kube-proxy[2482]: I1221 19:16:58.160025    2482 conntrack.go:66] Setting conntrack hashsize to 32768</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:58 node1 kube-proxy[2482]: I1221 19:16:58.167384    2482 conntrack.go:81] Set sysctl 'net/netfilter/nf_con... 86400</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:58 node1 kube-proxy[2482]: I1221 19:16:58.167418    2482 conntrack.go:81] Set sysctl 'net/netfilter/nf_con...o 3600</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kubelet.service - Kubernetes Kubelet Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active:</span><span style="color:#c00000;"> active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:16:59 CST; 17s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2749 (kubelet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kubelet.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           ├─2749 /usr/bin/kubelet --logtostderr=true --v=0 --api-servers=http://192.168.2.178:8080 --address=0.0.0.0 --hostn...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2777 journalctl -k -f</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: W1221 19:17:00.302581    2749 manager.go:247] Registration of the rkt container f...refused</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.302604    2749 factory.go:54] Registering systemd factory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.302763    2749 factory.go:86] Registering Raw factory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.302937    2749 manager.go:1106] Started watching for new ooms in manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.305309    2749 oomparser.go:185] oomparser using systemd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.305820    2749 manager.go:288] Starting recovery of all containers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.402033    2749 manager.go:293] Recovery completed</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.403468    2749 kubelet_node_status.go:227] Setting node annotation.../detach</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.418293    2749 kubelet_node_status.go:74] Attempting to register node node1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:17:00 node1 kubelet[2749]: I1221 19:17:00.422640    2749 kubelet_node_status.go:77] Successfully registered node node1</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● docker.service - Docker Application Container Engine</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Drop-In: /usr/lib/systemd/system/docker.service.d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─flannel.conf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:16:59 CST; 17s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: http://docs.docker.com</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2590 (dockerd-current)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/docker.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           ├─2590 /usr/bin/dockerd-current --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current --default-runtim...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2603 /usr/bin/docker-containerd-current -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --shim do...</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.594451020+08:00" level=info msg="devmapper: Succ...-base"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.631433746+08:00" level=warning msg="Docker could...ystem"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.651862493+08:00" level=info msg="Graph migration...conds"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.652393784+08:00" level=info msg="Loading contain...tart."</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.690533063+08:00" level=info msg="Firewalld runni...false"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.862388053+08:00" level=info msg="Loading contain...done."</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.862480340+08:00" level=info msg="Daemon has comp...ation"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.862493915+08:00" level=info msg="Docker daemon" ...1.12.6</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 systemd[1]: Started Docker Application Container Engine.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:16:59 node1 dockerd-current[2590]: time="2019-12-21T19:16:59.883346725+08:00" level=info msg="API listen on /....sock"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Hint: Some lines were ellipsized, use -l to show in full.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们可以看到我们启动了4个服务，有4个running状态，说明服务启动都是ok的。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181091">5.4.6</a>、查看网卡</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]#</span><span style="color:#c00000;"> ifconfig -a</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">10.255.31.1</span><span style="color:#000000;">  netmask 255.255.255.0  broadcast 0.0.0.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 02:42:c8:81:a9:a3  txqueuelen 0  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet 192.168.2.179  netmask 255.255.255.0  broadcast 192.168.2.255</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::ab54:d555:c844:3d6b  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 00:0c:29:da:c8:bd  txqueuelen 1000  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 9438  bytes 9035501 (8.6 MiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 3  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 2039  bytes 323350 (315.7 KiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">flannel0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">10.255.31.0</span><span style="color:#000000;">  netmask 255.255.0.0  destination 10.255.31.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::79de:95ca:6514:fbe4  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 3  bytes 144 (144.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181092">5.4.7</a>、查看kube-proxy</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# netstat -antup | grep proxy</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:</span><span style="color:#c00000;">10249</span><span style="color:#000000;">         0.0.0.0:*               LISTEN      2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.179:35532     192.168.2.178:8080      ESTABLISHED 2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.179:35534     192.168.2.178:8080      ESTABLISHED 2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">到此node1  minion节点成了。</span></p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181093">5.5</a>、配置node2 minion</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">所有的minion配置都是一样，所以我们可以直接拷贝node1的配置文件到node2上即可启动服务。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181094">5.5.1</a>、拷贝配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在node1上执行拷贝：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# scp /etc/sysconfig/flanneld 192.168.2.180:/etc/sysconfig/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# scp /etc/kubernetes/config 192.168.2.180:/etc/kubernetes/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# scp /etc/kubernetes/proxy 192.168.2.180:/etc/kubernetes/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# scp /etc/kubernetes/kubelet 192.168.2.180:/etc/kubernetes/</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181095">5.5.2</a>、微改配置文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">注意这个地方需要修改：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# vi /etc/kubernetes/kubelet</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">KUBELET_HOSTNAME="--hostname-override=</span><span style="color:#c00000;">node2</span><span style="color:#000000;">"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">这里要改成minion 2的主机名。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181096">5.5.3</a>、启动node2所有服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">systemctl restart flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">systemctl enable flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/flanneld.service to /usr/lib/systemd/system/flanneld.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/docker.service.requires/flanneld.service to /usr/lib/systemd/system/flanneld.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-proxy.service to /usr/lib/systemd/system/kube-proxy.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181097">5.5.4</a>、查看node2上所有服务</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">systemctl status flanneld kube-proxy kubelet docker</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● flanneld.service - Flanneld overlay address etcd agent</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/flanneld.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:39:06 CST; 1min 25s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2403 (flanneld)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/flanneld.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2403 /usr/bin/flanneld -etcd-endpoints=http://192.168.2.178:2379 -etcd-prefix=/k8s/network --iface=ens33</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 systemd[1]: Starting Flanneld overlay address etcd agent...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.735912    2403 main.go:132] Installing signal handlers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.738072    2403 manager.go:149] Using interface with name ens....2.180</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.738101    2403 manager.go:166] Defaulting external address t...2.180)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.786030    2403 local_manager.go:179] Picking subnet in range....255.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.805631    2403 manager.go:250] Lease acquired: 10.255.73.0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.813400    2403 network.go:98] Watching for new subnet leases</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.821537    2403 network.go:191] Subnet added: 10.255.91.0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 flanneld-start[2403]: I1221 19:39:06.821555    2403 network.go:191] Subnet added: 10.255.31.0/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:06 node2 systemd[1]: Started Flanneld overlay address etcd agent.</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kube-proxy.service - Kubernetes Kube-Proxy Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kube-proxy.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:39:06 CST; 1min 26s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2404 (kube-proxy)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kube-proxy.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2404 /usr/bin/kube-proxy --logtostderr=true --v=0 --master=http://192.168.2.178:8080</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: E1221 19:39:07.546923    2404 server.go:421] Can't get Node "node2", assuming i... found</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.548664    2404 server.go:215] Using iptables Proxier.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: W1221 19:39:07.550017    2404 server.go:468] Failed to retrieve node info: node... found</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: W1221 19:39:07.550089    2404 proxier.go:248] invalid nodeIP, initialize kube-p...nodeIP</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: W1221 19:39:07.550098    2404 proxier.go:253] clusterCIDR not specified, unable...raffic</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.550110    2404 server.go:227] Tearing down userspace rules.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.689675    2404 conntrack.go:81] Set sysctl 'net/netfilter/nf_con...131072</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.689901    2404 conntrack.go:66] Setting conntrack hashsize to 32768</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.689987    2404 conntrack.go:81] Set sysctl 'net/netfilter/nf_con... 86400</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:07 node2 kube-proxy[2404]: I1221 19:39:07.689998    2404 conntrack.go:81] Set sysctl 'net/netfilter/nf_con...o 3600</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● kubelet.service - Kubernetes Kubelet Server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:39:09 CST; 1min 23s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: https://github.com/GoogleCloudPlatform/kubernetes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2660 (kubelet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/kubelet.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           ├─2660 /usr/bin/kubelet --logtostderr=true --v=0 --api-servers=http://192.168.2.178:8080 --address=0.0.0.0 --hostn...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2688 journalctl -k -f</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: W1221 19:39:09.890184    2660 manager.go:247] Registration of the rkt container f...refused</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.890230    2660 factory.go:54] Registering systemd factory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.890446    2660 factory.go:86] Registering Raw factory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.890648    2660 manager.go:1106] Started watching for new ooms in manager</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.895816    2660 oomparser.go:185] oomparser using systemd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.896338    2660 manager.go:288] Starting recovery of all containers</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.982917    2660 manager.go:293] Recovery completed</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 kubelet[2660]: I1221 19:39:09.998995    2660 kubelet_node_status.go:227] Setting node annotation.../detach</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:10 node2 kubelet[2660]: I1221 19:39:10.000193    2660 kubelet_node_status.go:74] Attempting to register node node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:10 node2 kubelet[2660]: I1221 19:39:10.004958    2660 kubelet_node_status.go:77] Successfully registered node node2</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">● docker.service - Docker Application Container Engine</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Drop-In: /usr/lib/systemd/system/docker.service.d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─flannel.conf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   Active: </span><span style="color:#c00000;">active (running)</span><span style="color:#000000;"> since Sat 2019-12-21 19:39:09 CST; 1min 23s ago</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">     Docs: http://docs.docker.com</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Main PID: 2496 (dockerd-current)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">   CGroup: /system.slice/docker.service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           ├─2496 /usr/bin/dockerd-current --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current --default-runtim...</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">           └─2512 /usr/bin/docker-containerd-current -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --shim do...</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.075412800+08:00" level=info msg="devmapper: Succ...-base"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.111063008+08:00" level=warning msg="Docker could...ystem"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.129224027+08:00" level=info msg="Graph migration...conds"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.130233548+08:00" level=info msg="Loading contain...tart."</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.158633597+08:00" level=info msg="Firewalld runni...false"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.232333949+08:00" level=info msg="Loading contain...done."</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.232422260+08:00" level=info msg="Daemon has comp...ation"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.232432256+08:00" level=info msg="Docker daemon" ...1.12.6</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 dockerd-current[2496]: time="2019-12-21T19:39:09.249587277+08:00" level=info msg="API listen on /....sock"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Dec 21 19:39:09 node2 systemd[1]: Started Docker Application Container Engine.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Hint: Some lines were ellipsized, use -l to show in full.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181098">5.5.5</a>、查看网卡</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">ifconfig -a</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker0:</span><span style="color:#000000;"> flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">10.255.73.1</span><span style="color:#000000;">  netmask 255.255.255.0  broadcast 0.0.0.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 02:42:48:7f:f8:3c  txqueuelen 0  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet 192.168.2.180  netmask 255.255.255.0  broadcast 192.168.2.255</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::950e:ef22:9f8d:fed6  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ether 00:0c:29:4e:26:64  txqueuelen 1000  (Ethernet)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 8491  bytes 8987676 (8.5 MiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 3  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 1363  bytes 263495 (257.3 KiB)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">flannel0: </span><span style="color:#000000;">flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet </span><span style="color:#c00000;">10.255.73.0</span><span style="color:#000000;">  netmask 255.255.0.0  destination 10.255.73.0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        inet6 fe80::e105:ef44:47f9:b20d  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX packets 0  bytes 0 (0.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX packets 3  bytes 144 (144.0 B)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：flannel0是flanneld服务启动的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">上面的docker0网卡的值是根据以下来的</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# cat /run/flannel/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker      subnet.env  </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# cat /run/flannel/subnet.env </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_NETWORK=10.255.0.0/16</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_SUBNET=</span><span style="color:#c00000;">10.255.73.1/24</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_MTU=1472</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">FLANNEL_IPMASQ=false</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181099">5.5.6</a>、查看kube-proxy</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# netstat -antup | grep proxy</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:</span><span style="color:#c00000;">10249 </span><span style="color:#000000;">        0.0.0.0:*               LISTEN      2404/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58772     192.168.2.178:8080      ESTABLISHED 2404/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58770     192.168.2.178:</span><span style="color:#c00000;">8080</span><span style="color:#000000;">      ESTABLISHED 2404/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Kubeproxy</span><span style="color:#000000;">监听端口号是10249。Kubeproxy和master的8080进行通信。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">netstat -antup | grep 8080</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58772     192.168.2.178:8080      ESTABLISHED 2404/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58770     192.168.2.178:8080      ESTABLISHED 2404/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58792     192.168.2.178:8080      ESTABLISHED 2660/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58784     192.168.2.178:8080      ESTABLISHED 2660/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58786     192.168.2.178:8080      ESTABLISHED 2660/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.180:58782     192.168.2.178:8080      ESTABLISHED 2660/kubelet  </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看kubelete服务连接是否建立，此处我们发现已经建立。</span></p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181100">5.6</a>、查看整个k8s集群状态</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get nodes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      STATUS    AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1     </span><span style="color:#c00000;">Ready </span><span style="color:#000000;">    32m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node2     </span><span style="color:#c00000;">Ready </span><span style="color:#000000;">    10m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">至此说明运行正常。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">至此，整个k8s集群搭建完毕。</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181101">5.7</a>、集群服务总结</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">在本实验中kubernetes 4个结点一共需要启动13个服务，开6个端口号。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">详情如下：</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181102">5.7.1</a>、etcd</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">一共1个服务 ，通讯使用2379端口 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">启动服务 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@xuegod63 ~]#systemctl restart etcd </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">netstat -antup | grep etcd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:</span><span style="color:#c00000;">2379          0.0.0.0:*               LISTEN</span><span style="color:#000000;">      982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:</span><span style="color:#c00000;">2379      0.0.0.0:*               LISTEN</span><span style="color:#000000;">      982/etcd            </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 127.0.0.1:2380          0.0.0.0:*               LISTEN      982/etcd</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181103">5.7.2</a>、master</h4> 
<p style="margin-left:0cm;"> <span style="color:#000000;">一共4个服务，通讯使用8080端口 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@xuegod63 ~]# systemctl restart kube-apiserver kube-controller-manager kube-scheduler flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# netstat -antup | grep kube-apiserve</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 :::6443                 :::*                    LISTEN      12495/kube-apiserve </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 :::</span><span style="color:#c00000;">8080                 :::*                    LISTEN</span><span style="color:#000000;">      12495/kube-apiserve</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> netstat -antup | grep kube-controll</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 :::</span><span style="color:#c00000;">10252                :::*                    LISTEN</span><span style="color:#000000;">      12527/kube-controll </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">netstat -antup | grep kube-schedule </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 :::</span><span style="color:#c00000;">10251                :::*                    LISTEN </span><span style="color:#000000;">     12559/kube-schedule</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">netstat -antup | grep flanneld</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:60480     192.168.2.178:2379      ESTABLISHED 12413/flanneld      </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 192.168.2.178:60482     192.168.2.178:2379      ESTABLISHED 12413/flanneld      </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">udp        0      0 192.168.2.178:8285      0.0.0.0:*                           12413/flanneld</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181104">5.7.3</a>、node1-minion</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">一共4个服务 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubeproxy </span><span style="color:#000000;">监控听端口号是 10249 ，kubelet 监听端口10248、10250、10255三个端口 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# systemctl restart flanneld kube-proxy kubelet docker </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">netstat -autup | grep kube-proxy</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 </span><span style="color:#c00000;">localhost:10249         0.0.0.0:*               LISTEN</span><span style="color:#000000;">      2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35532             master:webcache         ESTABLISHED 2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35534             master:webcache         ESTABLISHED 2482/kube-proxy     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 yum.repos.d]# </span><span style="color:#c00000;">netstat -autup | grep kubelet</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 </span><span style="color:#c00000;">localhost:10248         0.0.0.0:*               LISTEN</span><span style="color:#000000;">      2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35546             master:webcache         ESTABLISHED 2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35544             master:webcache         ESTABLISHED 2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35550             master:webcache         ESTABLISHED 2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp        0      0 node1:35542             master:webcache         ESTABLISHED 2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 [::]</span><span style="color:#c00000;">:10255              [::]:*                  LISTEN</span><span style="color:#000000;">      2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 [::]:4194               [::]:*                  LISTEN      2749/kubelet        </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tcp6       0      0 [::]:</span><span style="color:#c00000;">10250              [::]:*                  LISTEN</span><span style="color:#000000;">      2749/kubelet        </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181105">5.7.4</a>、node2-minion</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">一共4个服务 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# systemctl restart flanneld kube-proxy kubelet docker </span></p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181106">6</a>、Kubectl工具</h2> 
<p style="margin-left:0cm;"><span style="color:#000000;">管理kubernetes容器平台</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181107">6.1</a>、Kubectl概述</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl</span><span style="color:#000000;">是一个用于操作kubernetes集群的命令行接口，通过利用kubectl的各种命令可以实现各种功能。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181108">6.2</a>、启动相关服务</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">systemctl restart kube-apiserver kube-controller-manager kube-scheduler flanneld </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181109">6.3</a>、获取集群状态</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl get nodes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      STATUS    AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1     Ready     3h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node2     Ready     2h</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181110">6.4</a>、查看版本</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl version</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Client Version: version.Info{Major:"1", Minor:"5", GitVersion:"</span><span style="color:#c00000;">v1.5.2</span><span style="color:#000000;">", GitCommit:"269f928217957e7126dc87e6adfa82242bfe5b1e", GitTreeState:"clean", BuildDate:"2017-07-03T15:31:10Z", GoVersion:"go1.7.4", Compiler:"gc", Platform:"linux/amd64"}</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Server Version: version.Info{Major:"1", Minor:"5", GitVersion:"</span><span style="color:#c00000;">v1.5.2</span><span style="color:#000000;">", GitCommit:"269f928217957e7126dc87e6adfa82242bfe5b1e", GitTreeState:"clean", BuildDate:"2017-07-03T15:31:10Z", GoVersion:"go1.7.4", Compiler:"gc", Platform:"linux/amd64"}</span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181111">6.5</a>、kubectl常用命令</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl</span><span style="color:#000000;">创建和删除一个pod相关操作</span></p> 
<table border="1" cellspacing="0" style="width:403.75pt;"><tbody><tr><td style="vertical-align:top;width:55.7pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">命令</span></p> </td><td style="vertical-align:top;width:348.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">说明</span></p> </td></tr><tr><td style="vertical-align:top;width:55.7pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">run</span></p> </td><td style="vertical-align:top;width:348.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">在集群上运行一个pod</span></p> </td></tr><tr><td style="vertical-align:top;width:55.7pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">create</span></p> </td><td style="vertical-align:top;width:348.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">使用文件或者标准输入的方式创建一个pod</span></p> </td></tr><tr><td style="vertical-align:top;width:55.7pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">delete</span></p> </td><td style="vertical-align:top;width:348.05pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">使用文件或者标准输入以及资源名称或者标签选择器来删除某个pod</span></p> </td></tr></tbody></table> 
<h3 style="margin-left:0cm;"><a name="_Toc28181112">6.6</a>、kubectl使用举例</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">在集群上运行一个镜像</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181113">6.6.1</a>、上传基础镜像到所有node节点</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">上传docker.io-nginx.tar和pod-infrastructure.tar两个文件到node1和node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# ll</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">total 323096</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">-rw-------. 1 root root      1294 Dec 18 19:58 anaconda-ks.cfg</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">-rw-r--r--  1 root root 112218624 Dec 18 19:28 docker.io-nginx.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">-rw-r--r--  1 root root 218623488 Dec 18 19:28 pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">传到node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# scp docker.io-nginx.tar 192.168.2.180:/root/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# scp pod-infrastructure.tar 192.168.2.180:/root/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">如果node1和node2服务器上没有docker.io-nginx.tar和pod-infrastructure.tar镜像，后期使用时会自动在dockerhub上下载此镜像，这样比较慢，所以我们提前上传到服务器上。 其中，pod-infrastructure.tar是pod的基础镜像，使用docker-io-nginx的镜像时，也是需要依赖于此镜像的。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181114">6.6.2</a>、所有node节点上导入镜像</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在node1和node2上导入镜像</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1</span><span style="color:#000000;">：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# docker load -i docker.io-nginx.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">cec7521cdf36: Loading layer [==================================================&gt;] 58.44 MB/58.44 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">350d50e58b6c: Loading layer [==================================================&gt;] 53.76 MB/53.76 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">63c39cd4a775: Loading layer [==================================================&gt;] 3.584 kB/3.584 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/nginx:latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# docker load -i pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">f1f88d1c363a: Loading layer [==================================================&gt;] 205.9 MB/205.9 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bb4f52dd78f6: Loading layer [==================================================&gt;] 10.24 kB/10.24 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">c82569247c35: Loading layer [==================================================&gt;] 12.73 MB/12.73 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: registry.access.redhat.com/rhel7/pod-infrastructure:latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node2</span><span style="color:#000000;">：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  docker.io-nginx.tar  pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# docker load -i docker.io-nginx.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">cec7521cdf36: Loading layer [==================================================&gt;] 58.44 MB/58.44 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">350d50e58b6c: Loading layer [==================================================&gt;] 53.76 MB/53.76 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">63c39cd4a775: Loading layer [==================================================&gt;] 3.584 kB/3.584 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/nginx:latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# docker load -i pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">f1f88d1c363a: Loading layer [==================================================&gt;] 205.9 MB/205.9 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bb4f52dd78f6: Loading layer [==================================================&gt;] 10.24 kB/10.24 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">c82569247c35: Loading layer [==================================================&gt;] 12.73 MB/12.73 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: registry.access.redhat.com/rhel7/pod-infrastructure:latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181115">6.6.3</a>、所有node节点查看镜像</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在两个node节点上导完镜像后可以查看一下镜像</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# docker images</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker.io/nginx</span><span style="color:#000000;">                                       latest              9e7424e5dbae        2 years ago         108.5 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">registry.access.redhat.com/rhel7/pod-infrastructure</span><span style="color:#000000;">   latest              1158bd68df6d        2 years ago         208.6 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">可以看到node1上有刚才导入的两个镜像。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# docker images</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker.io/nginx </span><span style="color:#000000;">                                      latest              231d40e811cd        4 weeks ago         126.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">&lt;none&gt;                                                &lt;none&gt;              9e7424e5dbae        2 years ago         108.5 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">registry.access.redhat.com/rhel7/pod-infrastructure</span><span style="color:#000000;">   latest              1158bd68df6d        2 years ago         208.6 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">同样node2上也有两个刚才导入的镜像。后面我们创建pod时就直接使用这两个镜像即可。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181116">6.6.4</a>、kubectl run语法</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl run</span><span style="color:#000000;">和docker run一样，kubectl run能将一个pod运行起来。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">语法： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl run NAME --image=image [--env="key=value"] [--port=port] [--replicas=replicas] </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181117">6.6.5</a>、启动pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl run nginx --image=docker.io/nginx --replicas=1 --port=9000</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "nginx" created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：使用docker.io/nginx镜像 ，--port=暴露容器端口9000 ，设置副本数1 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注： 如果docker.io/nginx镜像没有，那么node1和node2会自动在dockerhub上下载。也可以改成自己的私有仓库地址：--image=192.168.2.178:5000/nginx:1.12 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# </span><span style="color:#c00000;">docker images</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker.io/nginx</span><span style="color:#000000;">                                       latest              9e7424e5dbae        2 years ago         108.5 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">registry.access.redhat.com/rhel7/pod-infrastructure   latest              1158bd68df6d        2 years ago         208.6 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl run</span><span style="color:#000000;">之后，kubernetes创建了一个deployment </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181118">6.6.6</a>、查看Deployment</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get deployment</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx     1         1         1            0           1m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get deployment</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx     1         1         1            1           38m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看生成的pod，kubernetes将容器运行在pod中以方便实施卷和网络共享等管理</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181119">6.6.7</a>、查看pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS              RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">nginx-2187705812-mg1sg</span><span style="color:#000000;">   0/1       </span><span style="color:#c00000;">ContainerCreating</span><span style="color:#000000;">   0          2m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]#  kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-mg1sg   1/1       </span><span style="color:#c00000;">Running</span><span style="color:#000000;">   0          39m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">当首次创建pod的时候，这个状态从ContainerCreating变成Running在我的虚机上花了很长时间，估计十几分钟以上是有的。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181120">6.6.8</a>、查看pod详细信息</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;"> kubectl get pod -o wide</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE       IP            NODE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-mg1sg   1/1       Running   0          55m       </span><span style="color:#c00000;">10.255.73.2</span>   <span style="color:#c00000;">node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">这样可以看到这个pod具体运行在哪个节点上，本例中可以看到是运行在node2上。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">此时，我们可以在master节点上ping这个pod的id10.255.73.2，是可以ping通的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">ping 10.255.73.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PING 10.255.73.2 (10.255.73.2) 56(84) bytes of data.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.2: icmp_seq=1 ttl=61 time=0.795 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.2: icmp_seq=2 ttl=61 time=0.946 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">^C</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">--- 10.255.73.2 ping statistics ---</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">rtt min/avg/max/mdev = 0.795/0.870/0.946/0.081 ms</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181121">6.6.9</a>、查看指定的pod详情</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">可以使用如下的命令查看具体的pod的详情</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl describe pod nginx-2187705812-mg1sg</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Name:           </span><span style="color:#c00000;">nginx-2187705812-mg1sg</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Namespace:      default</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Node:           node2/192.168.2.180</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Start Time:     Sat, 21 Dec 2019 22:58:59 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Labels:         pod-template-hash=2187705812</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">                run=nginx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Status:         </span><span style="color:#c00000;">Running</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">IP:             10.255.73.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Controllers:    ReplicaSet/nginx-2187705812</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Containers:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  nginx:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Container ID:               docker://e511702ff41c7b41141dac923ee5a56a8b3b460565544853cbf93668848e5638</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Image:                      docker.io/nginx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Image ID:                   docker-pullable://docker.io/nginx@sha256:50cf965a6e08ec5784009d0fccb380fc479826b6e0e65684d9879170a9df8566</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Port:                       9000/TCP</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    State:                      Running</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      Started:                  Sat, 21 Dec 2019 23:14:09 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Ready:                      True</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Restart Count:              0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Volume Mounts:              &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Environment Variables:      &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Conditions:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Type          Status</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Initialized   True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Ready         True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  PodScheduled  True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">No volumes.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">QoS Class:      BestEffort</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Tolerations:    &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Events:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  FirstSeen     LastSeen        Count   From                    SubObjectPath           Type            Reason                  Message</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ---------     --------        -----   ----                    -------------           --------        ------                  -------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  41m           41m             1       {default-scheduler }                            Normal          Scheduled               Successfully assigned nginx-2187705812-mg1sg to node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  41m           41m             1       {kubelet node2}         spec.containers{nginx}  Normal          Pulling                 pulling image "docker.io/nginx"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  41m           25m             2       {kubelet node2}                                 Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using "ClusterFirst" policy. Falling back to DNSDefault policy.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  25m           25m             1       {kubelet node2}         spec.containers{nginx}  Normal          Pulled                  Successfully pulled image "docker.io/nginx"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  25m           25m             1       {kubelet node2}         spec.containers{nginx}  Normal          Created                 Created container with docker id e511702ff41c; Security:[seccomp=unconfined]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  25m           25m             1       {kubelet node2}         spec.containers{nginx}  Normal          Started                 Started container with docker id e511702ff41c</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181122">6.6.10</a>、pods常见的状态</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">1</span><span style="color:#000000;">、ContainerCreating #容器创建中</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2</span><span style="color:#000000;">、ImagePullBackOff #从后端把镜像拉取到本地 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：如果这里pod没有正常运行，都是因为docker hub没有连接上，导致镜像没有下载成功，这时，可以在node节点上把相关镜像手动上传一下或把docker源换成阿里云的。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">3</span><span style="color:#000000;">、terminating ['t</span><span style="color:#000000;">ɜ</span><span style="color:#000000;">:m</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">ne</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">t</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">ŋ</span><span style="color:#000000;"> #</span><span style="color:#000000;">终止 。当删除pod时的状态 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">4</span><span style="color:#000000;">、Running 正常运行状态 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181123">6.6.11</a>、kubectl删除pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用kubectl delete删除创建的对象 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">删除pod </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">nginx-2187705812-mg1sg </span><span style="color:#000000;">  1/1       Running   0          1h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl delete pod nginx-2187705812-mg1sg</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pod "nginx-2187705812-mg1sg" deleted</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS              RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   0/1       </span><span style="color:#c00000;">ContainerCreating</span><span style="color:#000000;">   0          4s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">这里很奇怪，我们删除这个镜像后，平台会自动构建一个新的镜像，来代替我们刚刚删除的那个镜像。这是正是replicas为1的作用，平台会一直保证有一个副本在运行。 过了大概十几分钟又起来一个pod。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       </span><span style="color:#c00000;">Running</span><span style="color:#000000;">   0          17m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在这个地方我们在起一个pod</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181124">6.6.12</a>、再创建一个pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl run </span><span style="color:#c00000;">nginx01</span><span style="color:#000000;"> --image=docker.io/nginx --replicas=1 --port=</span><span style="color:#c00000;">9009</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "nginx01" created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注意：镜像可以用一样的，但是pod的名字和端口不能重复了。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                       READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx     1/1       Running   0          21m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx01-3827941023-h4vql   1/1       Running   0          1m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">可以看到之前构建的两个pod都是running状态了。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181125">6.6.13</a>、删除deployment</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">直接删除pod触发了replicas的确保机制，所以我需要直接删除deployment。也就是说删除pod并不能真的删除pod，如果想完全删除pod，我们可以删除deployment。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span><span style="color:#c00000;">kubectl delete deployment nginx01</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "nginx01" deleted</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们直接删除刚才新建的nginx01的pod。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          25m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master html]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查发现目前只有一个pod了，就是我们之前建的名为nginx的pod了。</span></p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181126">7</a>、Yaml</h2> 
<h3 style="margin-left:0cm;"><a name="_Toc28181127">7.1</a>、yaml语法</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">yaml</span><span style="color:#000000;">语法的基本语法规则如下： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">1</span><span style="color:#000000;">、大小写敏感 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2</span><span style="color:#000000;">、使用缩进表示层级关系 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">3</span><span style="color:#000000;">、缩进时不允许使用Tab键，只允许使用空格。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">4</span><span style="color:#000000;">、缩进的空格数目不重要，叧要相同层级的元素左侧对齐即可 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">5</span><span style="color:#000000;">、# 表示注释，从这个字符一直到行尾，都会被解析器忽略。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">6</span><span style="color:#000000;">、在yaml里面，连续的项目（如：数组元素、集合元素）通过减号“-”来表示，map结构里面的键值对（key/value）用冒号“:”来分割。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181128">7.2</a>、Yaml数据结构</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary） </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">数组：一组按次序排列的值，又称为序列（sequence） / 列表（list） </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">纯量（scalars）：单个的、不可再分的值 </span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181129">7.2.1</a>、数据结构--对象</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">对象的一组键值对，使用冒号结构表示。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例1：animal代表 pets # pet [pet] 宠物 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">animal: pets </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Yaml </span><span style="color:#000000;">也允许另一种写法，将所有键值对写成一个行内对象。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例2：hash对象中包括 name和foo </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">hash: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name: Steve </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">foo: bar </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">或</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">hash: { name: Steve, foo: bar } </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181130">7.2.2</a>、数组</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">一组连词线开头的行，构成一个数组。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Cat </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Dog </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Goldfish </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">转为 JavaScript 如下。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[ 'Cat', 'Dog', 'Goldfish' ] </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">数据结构的子成员是一个数组，则可以在该项下面缩进一个空格。数组中还有数组。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Cat </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Dog </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- Goldfish </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">转为 JavaScript 如下。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[ [ 'Cat', 'Dog', 'Goldfish' ] ] </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">数组也可以采用行内表示法。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">animal: [Cat, Dog] </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">转为 JavaScript 如下。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">{ animal: [ 'Cat', 'Dog' ] } </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181131">7.2.3</a>、复合结构</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">对象和数组可以结合使用，形成复合结构。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例：编写一个包括BAT基本信息的bat.yaml配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# vim bat.yaml #</span><span style="color:#000000;">写入以下内容 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bat: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">website: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">baidu: http://www.baidu.com </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">qq: http://www.qq.com </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ali: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- http://www.taobao.com </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- http://www.tmall.com </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ceo: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">yanhongli: </span><span style="color:#000000;">李彦宏 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">huatengma: </span><span style="color:#000000;">马化腾 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">yunma: </span><span style="color:#000000;">马云</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：格式如下 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">对象 ： 对象： 对象：键值 对象： - 数组 - 数组 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181132">7.2.4</a>、纯量</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">纯量是最基本的、不可再分的值。如：字符串、布尔值、整数、浮点数、Null、时间、日期 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">例：数值直接以字面量的形式表示。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">number: 12.30  </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181133">7.3</a>、应用举例</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl create</span><span style="color:#000000;">加载yaml文件生成deployment </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用kubectl run在设定很复杂的需求时，需要非常长的一条语句，也很容易出错，也没法保存。所以更多场景下会使用yaml或者json文件。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">生成mysql-deployment.yaml 文件</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">上传mysql服务器镜像docker.io-mysql-mysql-server.tar 到node1和node2上 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181134">7.3.1</a>、上传镜像到所有node节点</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  </span><span style="color:#c00000;">docker.io-mysql-mysql-server.tar </span><span style="color:#000000;"> docker.io-nginx.tar  pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">scp</span><span style="color:#000000;">到node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# scp docker.io-mysql-mysql-server.tar node2:/root/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  </span><span style="color:#c00000;">docker.io-mysql-mysql-server.tar</span><span style="color:#000000;">  docker.io-nginx.tar  pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181135">7.3.2</a>、上传mysql-deployment.yaml到master管理结点</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  bat.yaml  </span><span style="color:#c00000;">mysql-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#  </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181136">7.3.3</a>、在node1和node2上导入mysql镜像</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  docker.io-mysql-mysql-server.tar  docker.io-nginx.tar  pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@</span><span style="color:#c00000;">node1</span><span style="color:#000000;"> ~]# </span><span style="color:#c00000;">docker load -i docker.io-mysql-mysql-server.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">0302be4b1718: Loading layer [==================================================&gt;] 124.3 MB/124.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">f9deff9cb67e: Loading layer [==================================================&gt;] 128.7 MB/128.7 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">c4c921f94c30: Loading layer [==================================================&gt;] 9.216 kB/9.216 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">0c39b2c234c8: Loading layer [==================================================&gt;] 3.072 kB/3.072 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/mysql/mysql-server:latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  docker.io-mysql-mysql-server.tar  docker.io-nginx.tar  pod-infrastructure.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@</span><span style="color:#c00000;">node2</span><span style="color:#000000;"> ~]# </span><span style="color:#c00000;">docker load -i docker.io-mysql-mysql-server.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">0302be4b1718: Loading layer [==================================================&gt;] 124.3 MB/124.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">f9deff9cb67e: Loading layer [==================================================&gt;] 128.7 MB/128.7 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">c4c921f94c30: Loading layer [==================================================&gt;] 9.216 kB/9.216 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">0c39b2c234c8: Loading layer [==================================================&gt;] 3.072 kB/3.072 kB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/mysql/mysql-server:latest</span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181137">7.3.4</a>、Mysql-deployment.yaml文件内容</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">kind: Deployment </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">使用deployment创建一个pod资源，旧k8s版本可以使用kind: ReplicationController来创建pod </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">apiVersion: extensions/v1beta1 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">metadata: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name: mysql </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#deployment</span><span style="color:#000000;">的名称，全局唯一 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">spec: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">replicas: 1 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#Pod</span><span style="color:#000000;">副本期待数量，1表示叧运行一个pod，里面一个容器 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">template: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">根据此模板创建Pod的副本（实例） </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">metadata: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">labels: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">符合目标的Pod拥有此标签。默认和name的值一样 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name: mysql </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">定义Pod的名字是mysql </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">spec: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">containers:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Pod</span><span style="color:#000000;">中容器的定义部分 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- name: mysql </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">容器的名称 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">image: docker.io/mysql/mysql-server </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">容器对应的Docker Image镜像 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">imagePullPolicy: IfNotPresent </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">默认值为：imagePullPolicy: Always一直从外网下载镜像，不用使用本地的。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">其他镜像下载策略参数说明： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#IfNotPresent </span><span style="color:#000000;">：如果本地存在镜像就优先使用本地镜像。这样可以直接使用本地镜像，加快启动速度。Present [</span><span style="color:#000000;">ˈ</span><span style="color:#000000;">preznt] </span><span style="color:#000000;">目前;现在 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#Never</span><span style="color:#000000;">：直接不再去拉取镜像了，使用本地的；如果本地不存在就报异常了。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ports: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- containerPort: 3306</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">容器暴露的端口号 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">protocol: TCP </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">env:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">注入到容器的环境变量 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- name: MYSQL_ROOT_PASSWORD </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">设置mysql root的密码 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">value: "hello123" </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181138">7.3.5</a>、该yaml文件结构</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">注： mysql-deployment.yaml 文件结构： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Deployment</span><span style="color:#000000;">的定义 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pod</span><span style="color:#000000;">的定义 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">容器的定义 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181139">7.3.6</a>、通过yaml文件创建资源</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用mysql-deployment.yaml创建和删除mysql资源 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl create -f mysql-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "mysql" created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：当一个目录下，有多个yaml文件的时候，使用kubectl create -f 目录 的方式一下全部创建 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master tmp]# kubectl create -f yamls/ </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "mysql" created </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment " mysql 1" created </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用get参数查看pod详细信息</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181140">7.3.7</a>、查看创建的pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pod </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">mysql-2261771434-x62bx</span><span style="color:#000000;">   1/1       Running   0          1m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181141">7.3.8</a>、查看创建的deployment</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get deployment</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">mysql</span><span style="color:#000000;">     1         1         1            1           2m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx     1         1         1            1           21h</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181142">7.3.9</a>、查看pod详情</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pod -o wide</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE       IP            NODE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          3m        10.255.73.2   </span><span style="color:#c00000;">node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h       10.255.31.2   </span><span style="color:#c00000;">node1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">加上-o wide参数可以查看更详细的信息,比如看到此pod在哪个node上运行，此pod的集群IP是多少也被一并显示了 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注：10.255.73.2这个IP地址是flannel 中定义的网段中的一个IP地址。 pod通过这个IP和master进行通信</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181143">7.3.10</a>、查看service</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME         CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubernetes   10.254.0.1   &lt;none&gt;        443/TCP   3d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们当前没有创建过服务，只有一个默认的kubernetes的服务。所以我们当前访问不了mysql服务。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181144">7.3.11</a>、测试通信</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">可以ping通 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">ping 10.255.73.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PING 10.255.73.2 (10.255.73.2) 56(84) bytes of data.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.2: icmp_seq=1 ttl=61 time=0.522 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.2: icmp_seq=2 ttl=61 time=3.05 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">^C</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">--- 10.255.73.2 ping statistics ---</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2 packets transmitted, 2 received, 0% packet loss, time 1001ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">rtt min/avg/max/mdev = 0.522/1.790/3.058/1.268 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> ping 10.255.73.1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">PING 10.255.73.1 (10.255.73.1) 56(84) bytes of data.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.1: icmp_seq=1 ttl=62 time=0.587 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">64 bytes from 10.255.73.1: icmp_seq=2 ttl=62 time=2.02 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">^C</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">--- 10.255.73.1 ping statistics ---</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">rtt min/avg/max/mdev = 0.587/1.308/2.029/0.721 ms</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#ping node2</span><span style="color:#000000;">上的docker0的地址，也可以通的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">总结： master，node2，pod，docker，container 它们之间通信都是使用flannel分配的地址。也就是通过flannel隧道把物理上分开的主机和容器，连接在一个局域网中了。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181145">7.3.12</a>、回顾：flannel地址的配置</h4> 
<p style="margin-left:0cm;">该部分内容无需在做，因为我们前面已经做过了。</p> 
<p>7.3.12.1、设置etcd网络</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@xuegod63 ~]# etcdctl mkdir /k8s/network #</span><span style="color:#000000;">创建一个目录/ k8s/network用于存储flannel网络信息 </span></p> 
<p>7.3.12.2、获取网络值</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">master</span><span style="color:#000000;">：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">etcdctl set /k8s/network/config '{"Network": "10.255.0.0/16"}' </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">给/k8s/network/config 赋一个字符串的值 '{"Network": "10.255.0.0/16"}' </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在这里配置的。最终是存储etcd中的 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181146">7.3.13</a>、在node2上查看运行mysql docker实例</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span><span style="color:#c00000;">docker ps</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">CONTAINER ID        IMAGE                                                        COMMAND                  CREATED             STATUS                    PORTS               NAMES</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">2fe9d8e43131        docker.io/mysql/mysql-server </span><span style="color:#000000;">                                "/entrypoint.sh mysql"   19 minutes ago      Up 19 minutes (healthy)                       k8s_mysql.31ec27ee_mysql-2261771434-x62bx_default_fdd4f3fb-24b6-11ea-ade8-000c29d8be5b_6872c9d5</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">57f3831e25ec        registry.access.redhat.com/rhel7/pod-infrastructure:latest</span><span style="color:#000000;">   "/usr/bin/pod"           19 minutes ago      Up 19 minutes                                 k8s_POD.1d520ba5_mysql-2261771434-x62bx_default_fdd4f3fb-24b6-11ea-ade8-000c29d8be5b_964c94c5</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">发现有两个docker实例在运行，底下那个是pod的基础服务镜像，要运行mysql，必须要先把pod-infrastructure镜像运行起来。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181147">7.3.14</a>、简写总结</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">get</span><span style="color:#000000;">命令能够确认的信息类别： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployments (</span><span style="color:#000000;">缩写 deploy) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">events (</span><span style="color:#000000;">缩写 ev) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">namespaces (</span><span style="color:#000000;">缩写 ns) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nodes (</span><span style="color:#000000;">缩写 no) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pods (</span><span style="color:#000000;">缩写 po) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">replicasets (</span><span style="color:#000000;">缩写 rs) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">replicationcontrollers (</span><span style="color:#000000;">缩写 rc) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">services (</span><span style="color:#000000;">缩写 svc) </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          24m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pods</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          24m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl get po</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          24m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">可以发现后面可以简写。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181148">7.3.15</a>、kubectl describe</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用describe查看k8s中详细信息</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">describe [d</span><span style="color:#000000;">ɪˈ</span><span style="color:#000000;">skra</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">b] </span><span style="color:#000000;">描述 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">语法： kubectl describe pod pod名字 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">语法： kubectl describe node node名字 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">语法： kubectl describe deployment deployment 名字 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用describe查看pod的详细描述信息 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">mysql-2261771434-x62bx</span><span style="color:#000000;">   1/1       Running   0          26m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          20h</span></p> 
<p>7.3.15.1、查看pod</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl describe pod mysql-2261771434-x62bx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Name:           </span><span style="color:#c00000;">mysql-2261771434-x62bx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Namespace:      default</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Node:           node2/192.168.2.180</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Start Time:     Sun, 22 Dec 2019 20:31:34 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Labels:         name=mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">                pod-template-hash=2261771434</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Status:         Running</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">IP:             10.255.73.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Controllers:    ReplicaSet/mysql-2261771434</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Containers:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  mysql:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Container ID:       docker://2fe9d8e43131fc0b315fca6a9f72e34b2207c85fe1eca508ae6c6600dbf2f274</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Image:              docker.io/mysql/mysql-server</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Image ID:           docker://sha256:a3ee341faefb76c6c4c6f2a4c37c513466f5aae891ca2f3cb70fd305b822f8de</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Port:               3306/TCP</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    State:              Running</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      Started:          Sun, 22 Dec 2019 20:31:35 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Ready:              True</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Restart Count:      0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Volume Mounts:      &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    Environment Variables:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      MYSQL_ROOT_PASSWORD:      hello123</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Conditions:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Type          Status</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Initialized   True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Ready         True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  PodScheduled  True </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">No volumes.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">QoS Class:      BestEffort</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Tolerations:    &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Events:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  FirstSeen     LastSeen        Count   From                    SubObjectPath           Type            Reason                  Message</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ---------     --------        -----   ----                    -------------           --------        ------                  -------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             1       {default-scheduler }                            Normal          Scheduled               Successfully assigned mysql-2261771434-x62bx to node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             2       {kubelet node2}                                 Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using "ClusterFirst" policy. Falling back to DNSDefault policy.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             1       {kubelet node2}         spec.containers{mysql}  Normal          Pulled                  Container image "docker.io/mysql/mysql-server" already present on machine</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             1       {kubelet node2}         spec.containers{mysql}  Normal          Created                 Created container with docker id 2fe9d8e43131; Security:[seccomp=unconfined]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             1       {kubelet node2}         spec.containers{mysql}  Normal          Started                 Started container with docker id 2fe9d8e43131</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">通过这个可以查看创建pod时报的错误及告警信息，可以看到以下告警： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  26m           26m             2       {kubelet node2}                                 Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using "ClusterFirst" policy. Falling back to DNSDefault policy.</span></p> 
<p>7.3.15.2、查看node</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用describe查看node的详细描述信息 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl describe node node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Name:                   node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Role:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Labels:                 beta.kubernetes.io/arch=amd64</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">                        beta.kubernetes.io/os=linux</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">                        kubernetes.io/hostname=node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Taints:                 &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">CreationTimestamp:      Sat, 21 Dec 2019 19:39:10 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Phase:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Conditions:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Type                  Status  LastHeartbeatTime                       LastTransitionTime                      Reason                          Message</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ----                  ------  -----------------                       ------------------                      ------                          -------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  OutOfDisk             False   Sun, 22 Dec 2019 21:04:30 +0800         Sat, 21 Dec 2019 19:39:10 +0800         KubeletHasSufficientDisk        kubelet has sufficient disk space available</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  MemoryPressure        False   Sun, 22 Dec 2019 21:04:30 +0800         Sat, 21 Dec 2019 19:39:10 +0800         KubeletHasSufficientMemory      kubelet has sufficient memory available</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  DiskPressure          False   Sun, 22 Dec 2019 21:04:30 +0800         Sat, 21 Dec 2019 19:39:10 +0800         KubeletHasNoDiskPressure        kubelet has no disk pressure</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Ready                 True    Sun, 22 Dec 2019 21:04:30 +0800         Sat, 21 Dec 2019 19:39:20 +0800         KubeletReady                    kubelet is posting ready status</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Addresses:              192.168.2.180,192.168.2.180,node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Capacity:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> alpha.kubernetes.io/nvidia-gpu:        0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> cpu:                                   2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> memory:                                2855652Ki</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> pods:                                  110</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Allocatable:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> alpha.kubernetes.io/nvidia-gpu:        0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> cpu:                                   2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> memory:                                2855652Ki</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> pods:                                  110</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">System Info:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Machine ID:                    c32dec1481dc4cf9b03963bf6e599d20</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> System UUID:                   4CBF4D56-41E3-C9F6-C1F6-F697A64E2664</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Boot ID:                       2dc7b509-d86d-4cdd-83c6-a9212b209eaa</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Kernel Version:                3.10.0-693.el7.x86_64</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> OS Image:                      CentOS Linux 7 (Core)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Operating System:              linux</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Architecture:                  amd64</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Container Runtime Version:     docker://1.12.6</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Kubelet Version:               v1.5.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"> Kube-Proxy Version:            v1.5.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ExternalID:                     node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Non-terminated Pods:            (1 in total)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Namespace                     Name                            CPU Requests    CPU Limits      Memory Requests Memory Limits</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ---------                     ----                            ------------    ----------      --------------- -------------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  default                       mysql-2261771434-x62bx          0 (0%)          0 (0%)          0 (0%)          0 (0%)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Allocated resources:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  (Total limits may be over 100 percent, i.e., overcommitted.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  CPU Requests  CPU Limits      Memory Requests Memory Limits</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ------------  ----------      --------------- -------------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  0 (0%)        0 (0%)          0 (0%)          0 (0%)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Events:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  FirstSeen     LastSeen        Count   From            SubObjectPath   Type            Reason                  Message</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ---------     --------        -----   ----            -------------   --------        ------                  -------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  33m           33m             2       {kubelet node2}                 Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using "ClusterFirst" policy. pod: "mysql-2261771434-x62bx_default(fdd4f3fb-24b6-11ea-ade8-000c29d8be5b)". Falling back to DNSDefault policy.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p>7.3.15.3、查看deployment</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">使用describe查看deployment的详细描述信息 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get deploy</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">mysql     </span><span style="color:#000000;">1         1         1            1           36m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx     1         1         1            1           22h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl describe deploy mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Name:                   mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Namespace:              default</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">CreationTimestamp:      Sun, 22 Dec 2019 20:31:34 +0800</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Labels:                 name=mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Selector:               name=mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Replicas:               1 updated | 1 total | 1 available | 0 unavailable</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">StrategyType:           RollingUpdate</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">MinReadySeconds:        0</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">RollingUpdateStrategy:  1 max unavailable, 1 max surge</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Conditions:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Type          Status  Reason</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ----          ------  ------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  Available     True    MinimumReplicasAvailable</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">OldReplicaSets: &lt;none&gt;</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NewReplicaSet:  mysql-2261771434 (1/1 replicas created)</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Events:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  FirstSeen     LastSeen        Count   From                            SubObjectPath   Type            Reason                  Message</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ---------     --------        -----   ----                            -------------   --------        ------                  -------</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  37m           37m             1       {deployment-controller }                        Normal          ScalingReplicaSet       Scaled up replica set mysql-2261771434 to 1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181149">7.3.16</a>、Kubectl其他常用命令和参数</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">命令 说明 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">logs </span><span style="color:#000000;">取得pod中容器的log信息 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">exec </span><span style="color:#000000;">在pod中执行一条命令 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">cp </span><span style="color:#000000;">从容器拷出或向容器拷入文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">attach Attach</span><span style="color:#000000;">到一个运行中的容器上，实时查看容器消息 </span></p> 
<p>7.3.16.1、生成测试容器资源</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">实验环境：先生成一个mysql资源： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl create -f /root /mysql-deployment.yaml </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">这个命令在之前前已经生成了。这里就不用执行了。 </span></p> 
<p>7.3.16.2、kubectl logs</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">类似于docker logs，使用kubectl logs能够取出pod中镜像的log，也是故障排除时候的重要信息 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          44m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          21h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl logs mysql-2261771434-x62bx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] MySQL Docker Image 5.7.20-1.1.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Initializing database</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Database initialized</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/iso3166.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/zone.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/zone1970.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] ignoring /docker-entrypoint-initdb.d/*</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Server shut down</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] MySQL init process done. Ready for start up.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Starting MySQL 5.7.20-1.1.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p>7.3.16.3、kubectl exec</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">exec</span><span style="color:#000000;">命令用于到pod中执行一条命令，到mysql的镜像中执行cat /etc/my.cnf命令 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          46m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          21h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl exec mysql-2261771434-x62bx cat /etc/my.cnf</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># For advice on how to change settings please see</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[mysqld]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Remove leading # and set to the amount of RAM for the most important data</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># innodb_buffer_pool_size = 128M</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Remove leading # to turn on a very important data integrity option: logging</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># changes to the binary log between backups.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># log_bin</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Remove leading # to set options mainly useful for reporting servers.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># The server defaults are faster for transactions and fast SELECTs.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Adjust sizes as needed, experiment to find the optimal values.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># join_buffer_size = 128M</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># sort_buffer_size = 2M</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># read_rnd_buffer_size = 2M</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">skip-host-cache</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">skip-name-resolve</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">datadir=/var/lib/mysql</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">socket=/var/lib/mysql/mysql.sock</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">secure-file-priv=/var/lib/mysql-files</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">user=mysql</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Disabling symbolic-links is recommended to prevent assorted security risks</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">symbolic-links=0</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">log-error=/var/log/mysqld.log</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pid-file=/var/run/mysqld/mysqld.pid</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">成功获取到了docker里面的mysql配置文件信息。</span></p> 
<p>7.3.16.4、进入容器</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">也可以直接进入到容器中，执行相关命令</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          47m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          21h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl exec -it mysql-2261771434-x62bx bash</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# </span></p> 
<p>7.3.16.5、kubectl cp</p> 
<p>7.3.16.5.1、从容器中拷出</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">用于从容器中拷出hosts文件到物理机的/tmp下 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl get pod</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                     READY     STATUS    RESTARTS   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">mysql-2261771434-x62bx   1/1       Running   0          47m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nginx-2187705812-4tmkx   1/1       Running   0          21h</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl cp mysql-2261771434-x62bx:/etc/hosts /tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">error: unexpected EOF</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">我们查看下kubectl cp的使用说明：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# kubectl cp --help</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Copy files and directories to and from containers.</span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Examples:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  # !!!Important Note!!!</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  # Requires that the 'tar' binary is present in your container</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  # image.  If 'tar' is not present, 'kubectl cp' will fail.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">发现想要使用kubectl cp你的容器实例中必须有tar库。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">如果镜像中tar命令不存在，那么kubectl cp将拷贝失败。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">那么我们就在在mysql pod中安装tar命吧</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> kubectl exec -it mysql-2261771434-x62bx bash</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# yum install tar -y                                                                                                                                                                               </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded plugins: ovl</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ol7_UEKR4                                                                                                                                                                            | 2.5 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ol7_latest                                                                                                                                                                           | 2.7 kB  00:00:00     </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Package 2:tar-1.26-35.el7.x86_64 already installed and latest version</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Nothing to do</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# </span><span style="color:#c00000;">exit</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">exit</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注意：这个安装tar是使用的在线yum源，需要容器能联网，而且一步狂慢，我执行了好久（大于3小时）才执行完。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">此时我们在尝试拷贝</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# ll /tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ls: cannot access /tmp/hosts: No such file or directory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# kubectl cp mysql-2261771434-x62bx:/etc/hosts /tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">tar: Removing leading `/' from member names</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# ls /tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/tmp/hosts</span></p> 
<p>7.3.16.5.2、从宿主机拷到容器</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">从虚机拷贝到容器docker中</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">进入容器：</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#  </span><span style="color:#c00000;">kubectl exec -it mysql-2261771434-x62bx bash</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查该文件在容器中是否存在</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# </span><span style="color:#c00000;">ls /tmp/hosts  </span>                                                                                                                                                                                  </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">ls: cannot access /tmp/hosts: No such file or directory</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# exit</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Exit</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">拷贝该文件到容器</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl cp /tmp/hosts mysql-2261771434-x62bx:/tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">进入容器</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# kubectl exec -it mysql-2261771434-x62bx bash</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">再次检查该文件是否存在</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# </span><span style="color:#c00000;">ls /tmp/hosts </span>                                                                                                                                                                                   </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查文件内容</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2#</span><span style="color:#c00000;"> cat /tmp/hosts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Kubernetes-managed hosts file.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">127.0.0.1       localhost</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">::1     localhost ip6-localhost ip6-loopback</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fe00::0 ip6-localnet</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fe00::0 ip6-mcastprefix</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fe00::1 ip6-allnodes</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">fe00::2 ip6-allrouters</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">10.255.73.2     mysql-2261771434-x62bx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">bash-4.2# </span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl attach</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl attach</span><span style="color:#000000;">用于取得pod中容器的实时信息，可以持续不断实时的取出消息。像tail -f /var/log/messages 动态查看日志的作用。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubectl logs</span><span style="color:#000000;">是一次取出所有消息，像cat /etc/passwd </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">attach [</span><span style="color:#000000;">ə</span><span style="color:#000000;">.tæ</span><span style="color:#000000;">ʃ</span><span style="color:#000000;">] </span><span style="color:#000000;">贴上 附上 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl attach mysql-2261771434-x62bx</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">If you don't see a command prompt, try pressing enter.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] MySQL Docker Image 5.7.20-1.1.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/iso3166.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Initializing database</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Database initialized</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] ignoring /docker-entrypoint-initdb.d/*</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/zone.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Warning: Unable to load '/usr/share/zoneinfo/zone1970.tab' as time zone. Skipping it.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Server shut down</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] MySQL init process done. Ready for start up.</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[Entrypoint] Starting MySQL 5.7.20-1.1.2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">^C</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">注： 到现在，所创建nginx和mysql都只是deployment设备硬件资源，并没有对应service服务，所以现在还不能直接在外网进行访问nginx和mysql服务。 </span></p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;"><a name="_Toc28181150">8</a>、搭建K8s的web管理界面</h2> 
<p style="margin-left:0cm;"><span style="color:#000000;">部署k8s Dashboard web界面</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建dashboard-deployment.yaml deployment配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建dashboard-service.yaml service配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">准备kubernetes相关的镜像 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">启动dashboard的deployment和service </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">排错经验分享 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看kubernetes dashboard web界面 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">销毁web界面相关应用 </span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在kubernetes上面的集群上搭建基于redis和docker的留言簿案例 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建Redis master deployment配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建redis master service配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建redis slave deployment配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建slave service配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建frontend guestbook deployment配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">创建frontend guestbook service配置文件 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看外部网络访问guestbook </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181151">8.1</a>、搭建步骤</h3> 
<p style="margin-left:0cm;"><span style="color:#000000;">准备deployment和service 配置文件-》导入相关镜像-》启动deployment和service </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181152">8.1.1</a>、确认集群环境</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# kubectl get node</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME      STATUS    AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1     Ready     2d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node2     Ready     2d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181153">8.1.2</a>、上传yaml文件到master</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在master上上传dashboard-deployment.yaml和dashboard-service.yaml到/root/目录</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">anaconda-ks.cfg  bat.yaml  </span><span style="color:#c00000;">dashboard-deployment.yaml  dashboard-service.yaml </span><span style="color:#000000;"> mysql-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181154">8.1.3</a>、修改apiserver</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">需要把apiserver改成自己的master地址</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# vi dashboard-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        args:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        - --apiserver-host=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:8080</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">cat dashboard-deployment.yaml </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">apiVersion: extensions/v1beta1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kind: Deployment</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">metadata:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># Keep the name in sync with image version and</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;"># gce/coreos/kube-manifests/addons/dashboard counterparts</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  name: kubernetes-dashboard-latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  namespace:</span><span style="color:#c00000;"> kube-system</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">spec:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  replicas: 1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  template:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    metadata:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      labels:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        k8s-app: </span><span style="color:#c00000;">kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        version: latest</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        kubernetes.io/cluster-service: "true"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    spec:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      containers:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">      - name: </span><span style="color:#c00000;">kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        image: </span><span style="color:#c00000;">docker.io/bestwu/kubernetes-dashboard-amd64:v1.6.3</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        imagePullPolicy: IfNotPresent</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        resources:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          # keep request = limit to keep this container in guaranteed class</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          limits:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            cpu: 100m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            memory: 50Mi</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          requests:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            cpu: 100m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            memory: 50Mi</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        ports:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        - containerPort: 9090</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        args:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        - --apiserver-host=http://</span><span style="color:#c00000;">192.168.2.178</span><span style="color:#000000;">:8080</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">       # - --apiserver-host=http://192.168.2.178:8080</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">        livenessProbe:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          httpGet:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            path: /</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">            port: 9090</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          initialDelaySeconds: 30</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">          timeoutSeconds: 30</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]#</span><span style="color:#c00000;"> cat dashboard-service.yaml </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">apiVersion: v1</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kind: Service</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">metadata:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  name: </span><span style="color:#c00000;">kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  namespace: kube-system</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  labels:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    k8s-app: </span><span style="color:#c00000;">kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    kubernetes.io/cluster-service: "true"</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">spec:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  selector:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    k8s-app: </span><span style="color:#c00000;">kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  ports:</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">  - port: 80</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">    targetPort: 9090</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181155">8.1.4</a>、配置文件说明</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;"> image: </span><span style="color:#c00000;">docker.io/bestwu/kubernetes-dashboard-amd64:v1.6.3</span></p> 
<p>8.1.4.1、关于deployment文件说明</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">这里修改成可以找到的镜像源。/bestwu/kubernetes-dashboard-amd64 这个是一个中文的web界面镜像。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">limits: #</span><span style="color:#000000;">关于pod使用的cpu和内存硬件资源做限制 。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">args: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">- --apiserver-host=http://192.168.2.178:8080 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">使用该deployment文件时，这里写成自己的apiserver服务器地址和端口。 </span></p> 
<p>8.1.4.2、关于service文件说明</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">name: kubernetes-dashboard</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">这里要和上面的deployment中定义一样 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">namespace: kube-system </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#000000;">这里要和上面的deployment中定义一样 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181156">8.1.5</a>、service的三种端口</h4> 
<p>8.1.5.1、port</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">service</span><span style="color:#000000;">暴露在cluster ip上的端口，port 是提供给集群内部客户访问service的入口。 </span></p> 
<p>8.1.5.2、nodePort</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">nodePort</span><span style="color:#000000;">是k8s提供给集群外部客户访问service入口的一种方式。 </span></p> 
<p>8.1.5.3、targetPort</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">targetPort</span><span style="color:#000000;">是pod中容器实例上的端口，从port和nodePort上到来的数据最终经过kube-proxy流入到后端pod的targetPort上迚入容器。 </span></p> 
<p>8.1.5.4、图示说明</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="322" src="https://images2.imgbox.com/bf/04/uOcRl3sF_o.png" width="554"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="332" src="https://images2.imgbox.com/b2/90/kKNamfCP_o.png" width="553"></p> 
<p>8.1.5.5、port、nodePort总结</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">port</span><span style="color:#000000;">和nodePort都是service的端口，前者暴露给集群内客户访问服务，后者暴露给集群外客户访问服务。从这两个端口到来的数据都需要经过反向代理kube-proxy流入后端pod的targetPod，从而到达pod上的容器内。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181157">8.1.6</a>、service概述</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">service</span><span style="color:#000000;">是pod的路由代理抽象，用于解决pod之间的服务发现问题。因为pod的运行状态可动态变化(比如切换机器了、缩容过程中被终止了等)，所以访问端不能以写死IP的方式去访问该pod提供的服务。service的引入旨在保证pod的动态变化对访问端透明，访问端只需要知道service的地址，由service来提供代理。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181158">8.1.7</a>、replicationController</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">是pod的复制抽象，用于解决pod的扩容缩容问题。通常，分布式应用为了性能或高可用性的考虑，需要复制多份资源，并且根据负载情况动态伸缩。通过replicationController，我们可以指定一个应用需要几份复制，Kubernetes将为每份复制创建一个pod，并且保证实际运行pod数量总是与该复制数量相等(例如，当前某个pod宕机时，自动创建新的pod来替换)。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181159">8.1.8</a>、service和replicationController总结</h4> 
<p style="margin-left:0cm;">service和replicationController<span style="color:#000000;">只是建立在pod之上的抽象，最终是要作用于pod的，那么它们如何跟pod联系起来呢？这就要引入label的概念：label其实很好理解，就是为pod加上可用于搜索或关联的一组key/value标签，而service和replicationController正是通过label来与pod关联的。如下图所示，有三个pod都有label为"app=backend"，创建service和replicationController时可以指定同样的label:"app=backend"，再通过label selector机制，就将它们与这三个pod关联起来了。例如，当有其他frontend pod访问该service时，自动会转发到其中的一个backend pod。 </span></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="238" src="https://images2.imgbox.com/78/c1/lIQQVVpR_o.png" width="553"></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181160">8.1.9</a>、准备k8s相关的镜像</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在官方的dashboard-deployment.yaml中定义了dashboard所用的镜像：gcr.io/google_containers/kubernetes-dashboard-amd64:v1.5.1，启动k8s的pod还需要一个额外的镜像：registry.access.redhat.com/rhel7/pod-infrastructure:latest，这两个镜像在国内下载比较慢。可以使用docker自带的源先下载下来： </span></p> 
<p>8.1.9.1、本地上传镜像</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">本地上传镜像到node1和node2上 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1</span><span style="color:#000000;">和nod2都要导入以下2个镜像： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">本地上传镜像到node1和node2上 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# mkdir /root/k8s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# mkdir /root/k8s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">上传镜像文件到node1和node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root/k8s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]#</span><span style="color:#c00000;"> docker images</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io/nginx                                       latest              231d40e811cd        4 weeks ago         126.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">&lt;none&gt;                                                &lt;none&gt;              9e7424e5dbae        2 years ago         108.5 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io/mysql/mysql-server                          latest              a3ee341faefb        2 years ago         245.7 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">registry.access.redhat.com/rhel7/</span><span style="color:#c00000;">pod-infrastructure</span><span style="color:#000000;">   latest              1158bd68df6d        2 years ago         208.6 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">node1</span><span style="color:#000000;">上执行导入镜像操作</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span><span style="color:#c00000;">docker load -i docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">8fc4262856aa: Loading layer [==================================================&gt;] 139.3 MB/139.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/bestwu/kubernetes-dashboard-amd64:v1.6.3</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">检查node1上面的镜像</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span><span style="color:#c00000;">docker images</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io/nginx                                       latest              231d40e811cd        4 weeks ago         126.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">&lt;none&gt;                                                &lt;none&gt;              9e7424e5dbae        2 years ago         108.5 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io/mysql/mysql-server                          latest              a3ee341faefb        2 years ago         245.7 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">registry.access.redhat.com/rhel7/</span><span style="color:#c00000;">pod-infrastructure</span><span style="color:#000000;">   latest              1158bd68df6d        2 years ago         208.6 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">docker.io/bestwu/kubernetes-dashboard-amd64</span><span style="color:#000000;">           v1.6.3              691a82db1ecd        2 years ago         139 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">pod-infrastructure</span><span style="color:#000000;">镜像是之前已经导入的。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">将</span><span style="color:#c00000;">docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span><span style="color:#000000;">文件传到node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span><span style="color:#c00000;">scp docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span><span style="color:#000000;"> node2:/root/k8s/</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">root@node2's password: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar                                                                                                                        100%  133MB  66.6MB/s   00:01    </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 k8s]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在node2上导入镜像</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 k8s]# pwd</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">/root/k8s</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 k8s]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 k8s]# </span><span style="color:#c00000;">docker load -i docker.io-bestwu-kubernetes-dashboard-amd64-zh.tar</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">8fc4262856aa: Loading layer [==================================================&gt;] 139.3 MB/139.3 MB</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Loaded image: docker.io/bestwu/kubernetes-dashboard-amd64:v1.6.3</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 k8s]# </span></p> 
<p style="margin-left:0cm;"> </p> 
<p>8.1.9.2、在线pull镜像</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">docker pull registry.access.redhat.com/rhel7/pod-infrastructure:latest </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">可以直接在node节点上下载该镜像，这是红帽的官方docker镜像下载站点，可以直接访问。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">gcr.io</span><span style="color:#000000;">这个网址在国内，没有办法访问，我使用docker.io中的镜像： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@xuegod62 ~]# docker search kubernetes-dashboard-amd </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@xuegod62 ~]# docker pull docker.io/mritd/kubernetes-dashboard-amd64 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">这种方式我执行失败了，不太好用。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181161">8.1.10</a>、上传yaml文件</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">在master上</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# mkdir /etc/kubernetes/yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# cd /etc/kubernetes/yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">将所有的yaml配置文件都上传到master的这个/etc/kubernetes/yaml目录 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# ls</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">dashboard-deployment.yaml </span><span style="color:#000000;"> frontend-deployment.yaml  redis-master-deployment.yaml  redis-slave-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">dashboard-service.yaml </span><span style="color:#000000;">    frontend-service.yaml     redis-master-service.yaml     redis-slave-service.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">飘红的是需要上传的yaml文件。</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181162">8.1.11</a>、创建deployment</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl create -f /etc/kubernetes/yaml/dashboard-deployment.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">deployment "kubernetes-dashboard-latest" created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181163">8.1.12</a>、创建service</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl create -f /etc/kubernetes/yaml/dashboard-service.yaml</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">service "kubernetes-dashboard" created</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">到此，dashboard搭建完成。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181164">8.1.13</a>、查看deployment</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]#</span><span style="color:#c00000;"> kubectl get deployment --all-namespaces</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAMESPACE     NAME                          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">default       mysql                         1         1         1            1           1d</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">default       nginx                         1         1         1            1           1d</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">kube-system   kubernetes-dashboard-latest   1         1         1            1           1m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">desired [d</span><span style="color:#000000;">ɪ</span><span style="color:#000000;">'za</span><span style="color:#000000;">ɪə</span><span style="color:#000000;">d] </span><span style="color:#000000;">希望，渴望的 ; CURRENT 现在 ; UP-TO-DATE最新的 ； available可用 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注： 因为我们定义了namespace，所以这需要加上--all-namespaces才可以显示出来，默认只显示namespaces=default的deployment。 </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181165">8.1.14</a>、查看service</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl get svc --all-namespaces</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAMESPACE     NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">default       kubernetes             10.254.0.1       &lt;none&gt;        443/TCP   4d</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">kube-system   kubernetes-dashboard   10.254.209.198   &lt;none&gt;        80/TCP    1m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181166">8.1.15</a>、查看pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl get pod -o wide --all-namespaces</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAMESPACE     NAME                                          READY     STATUS    RESTARTS   AGE       IP            NODE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">default       mysql-2261771434-x62bx                        1/1       Running   0          1d        10.255.73.2   node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">default       nginx-2187705812-4tmkx                        1/1       Running   0          1d        10.255.31.2   node1</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">kube-system   kubernetes-dashboard-latest-810449173-zhc37   1/1       Running   0          3m        10.255.73.3   node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181167">8.1.16</a>、查看指定pod</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl get pod -n kube-system -o wide</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                                          READY     STATUS    RESTARTS   AGE       IP            NODE</span></p> 
<p style="margin-left:0cm;"><span style="color:#c00000;">kubernetes-dashboard-latest-810449173-zhc37</span><span style="color:#000000;">   1/1       Running   0          4m        10.255.73.3   node2</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181168">8.1.17</a>、排错经验</h4> 
<p>8.1.17.1、kubelet 监听端口未改</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master kubernetes]# kubectl get pod -o wide --all-namespaces </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kube-system kubernetes-dashboard-latest-2351462241-slg41 0/1 CrashLoopBackOff 5 5m 10.255.9.5 node1 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">查看报错信息： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">#</span><span style="color:#c00000;">kubectl logs -f kubernetes-dashboard-latest-810449173-zhc37 -n kube-system</span><span style="color:#000000;"> #</span><span style="color:#000000;">显示 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Error from server: </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Get https://node1:10250/containerLogs/kube-system/kubernetes-dashboard-latest-2351462241-slg41/kubernetes-dashboard?follow=true: dial tcp 192.168.2.179:10250: getsockopt: connection refused </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">解决： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]# grep -v '^#' /etc/kubernetes/kubelet </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">改：KUBELET_ADDRESS="--address=127.0.0.1" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">为：KUBELET_ADDRESS="--address=0.0.0.0" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node1 ~]#systemctl restart kubelet.service </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">在node2上也同样执行以上命令。 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# grep -v '^#' /etc/kubernetes/kubelet </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">改：KUBELET_ADDRESS="--address=127.0.0.1" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">为：KUBELET_ADDRESS="--address=0.0.0.0" </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]#systemctl restart kubelet.service </span></p> 
<p style="margin-left:0cm;"> </p> 
<p>8.1.17.2、防火墙未关</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# kubectl logs kubernetes-dashboard-latest-2661119796-64km9 -n kube-system </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Error from server: Get </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">https://node2:10250/containerLogs/kube-system/kubernetes-dashboard-latest-2661119796-64km9/kubernetes-dashboard: dial tcp 192.168.2.179:10250: getsockopt: no route to host </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">解决： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# iptables -F #</span><span style="color:#000000;">清空防火墙 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# systemctl stop firewalld </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@node2 ~]# systemctl disable firewalld </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">清空防火墙后，再查看日志： </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master ~]# </span><span style="color:#c00000;">kubectl logs kubernetes-dashboard-latest-810449173-zhc37 -n kube-system </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Starting HTTP server on port 9090 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Creating API server client for http://192.168.2.178:8080 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Successful initial request to the apiserver, version: v1.5.2 </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">Creating in-cluster Heapster client </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">弹出以上界面说明我们配置成功。 </span></p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181169">8.2</a>、验证web浏览器访问</h3> 
<p style="margin-left:0cm;"><a href="http://192.168.2.178:8080/ui" rel="nofollow">http://192.168.2.178:8080/ui</a></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="292" src="https://images2.imgbox.com/cc/d8/FhIurThY_o.png" width="553"></p> 
<p style="margin-left:0cm;">到这里可以对虚机做一个快照，方便后面的实验。</p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;"><a name="_Toc28181170">8.3</a>、销毁web界面相关应用</h3> 
<h4 style="margin-left:0cm;"><a name="_Toc28181171">8.3.1</a>、删除deployment</h4> 
<p style="margin-left:0cm;">[root@master yaml]# <span style="color:#c00000;">kubectl get deploy</span></p> 
<p style="margin-left:0cm;">NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</p> 
<p style="margin-left:0cm;">mysql     1         1         1            1           1d</p> 
<p style="margin-left:0cm;">nginx     1         1         1            1           1d</p> 
<p style="margin-left:0cm;">[root@master yaml]#<span style="color:#c00000;"> kubectl get deployment --namespace=kube-system</span></p> 
<p style="margin-left:0cm;">NAME                          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</p> 
<p style="margin-left:0cm;">kubernetes-dashboard-latest   1         1         1            1           15m</p> 
<p style="margin-left:0cm;">[root@master yaml]#</p> 
<p style="margin-left:0cm;"><span style="color:#000000;">注意一定要加namespace，不然获取到的就是default空间的deployment。</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">删除web对应的deployment</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span><span style="color:#c00000;">kubectl delete deployment kubernetes-dashboard-latest --namespace=kube-system</span></p> 
<h4 style="margin-left:0cm;"><a name="_Toc28181172">8.3.2</a>、删除web对应的service</h4> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]#</span><span style="color:#c00000;"> kubectl get svc --namespace=kube-system</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">kubernetes-dashboard   10.254.209.198   &lt;none&gt;        80/TCP    17m</span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]# </span></p> 
<p style="margin-left:0cm;"><span style="color:#000000;">[root@master yaml]#</span><span style="color:#c00000;"> kubectl delete svc kubernetes-dashboard --namespace=kube-system</span></p> 
<p style="margin-left:0cm;"> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f34a11d6400ef6b27a36ad8ca0a432fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LeetCode 图解 | 21.合并两个有序链表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3bd00c46e064fef750e9f90ef7e3b7cc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware已安装，出现没有虚拟网络适配器，windows不能访问虚拟机ip问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>