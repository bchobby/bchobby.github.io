<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Observability：使用 Elastic Agent 来摄入日志及指标 - Elastic Stack 8.0 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Observability：使用 Elastic Agent 来摄入日志及指标 - Elastic Stack 8.0" />
<meta property="og:description" content="如果你已经安装过最近的 Elastic Stack 的话，你可能已经发现 Beats 已经不是推荐的数据摄入方式，取而代之的是 Elastic Agent。我们可以看一下如下的图：
上图展示的是 Elastic Stack 整体的栈的结构图。我们会发现其中最重要的一个变化是使用了 Integrations 而不是之前的 Beats 和 Logstash，尽管它们仍然适用。也就是推荐的办法是使用 Integration 来摄入数据。我们之前使用 Beats 来采集数据的架构是这样的：
所有的 Beats 的数据都可以发送至 Elasticsearch。它们都分别进行配置，但是不能在 Kibana 中进行集中管理和配置。
什么是 integration（集成）？
Elastic 集成是一组资产，定义了如何使用 Elastic Stack 观察特定产品或服务：
数据摄取、存储和转换规则设置选项预构建的自定义仪表板和可视化文档测试 集成具有严格、定义明确的结构，并提供许多优于其他摄取选项的优势：
围绕被观察的服务构建 — 而不是监控代理简单、不易出错的配置用户安装的监控代理更少只需点击几下即可部署从 Elastic Stack 解耦发布过程 使用 Elastic Agent 来采集数据可以给我带来如下的好处：
我们使用一个 Elastic Agent，但是它可以代替我们在之前的许多的 Beats：
以 Elastic Agent 为基础的数据摄入架构如下：
在今天的文章中，我们将介绍如何使用 Fleet 来设置 Elastic Agent 并摄入需要的数据。你将了解：
配置 Fleet使用 Elastic Agent 来发送数据到 Elastic Stack监控整个公司的系统和服务的日志和指标 我们可以通过 Fleet 来对 Elastic Agents 进行集中管理和配置。 在每一个 Elastic Agent 中，它是实现了如下的功能：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/b3f36b0096d018cb550c7a216dd14c21/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-19T11:28:01+08:00" />
<meta property="article:modified_time" content="2023-05-19T11:28:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Observability：使用 Elastic Agent 来摄入日志及指标 - Elastic Stack 8.0</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>如果你已经安装过最近的 Elastic Stack 的话，你可能已经发现 Beats 已经不是推荐的数据摄入方式，取而代之的是 Elastic Agent。我们可以看一下如下的图：</p> 
<p class="img-center"><img alt="" height="469" src="https://images2.imgbox.com/cc/d1/FQvxoPXq_o.png" width="600"></p> 
<p>上图展示的是 Elastic Stack 整体的栈的结构图。我们会发现其中最重要的一个变化是使用了 Integrations 而不是之前的 Beats 和 Logstash，尽管它们仍然适用。也就是推荐的办法是使用 Integration 来摄入数据。我们之前使用 Beats 来采集数据的架构是这样的：</p> 
<p class="img-center"><img alt="" height="796" src="https://images2.imgbox.com/7d/17/qv2GIUNE_o.png" width="800"></p> 
<p>所有的 Beats 的数据都可以发送至 Elasticsearch。它们都分别进行配置，但是不能在 Kibana 中进行集中管理和配置。</p> 
<p></p> 
<p><strong>什么是 integration（集成）？</strong></p> 
<p>Elastic 集成是一组资产，定义了如何使用 Elastic Stack 观察特定产品或服务：</p> 
<ul><li>数据摄取、存储和转换规则</li><li>设置选项</li><li>预构建的自定义仪表板和可视化</li><li>文档</li><li>测试</li></ul> 
<p>集成具有严格、定义明确的结构，并提供许多优于其他摄取选项的优势：</p> 
<ul><li>围绕被观察的服务构建 — 而不是监控代理</li><li>简单、不易出错的配置</li><li>用户安装的监控代理更少</li><li>只需点击几下即可部署</li><li>从 Elastic Stack 解耦发布过程</li></ul> 
<p>使用 Elastic Agent 来采集数据可以给我带来如下的好处：</p> 
<p class="img-center"><img alt="" height="460" src="https://images2.imgbox.com/a0/50/N8x4txTl_o.png" width="1027"></p> 
<p>我们使用一个 Elastic Agent，但是它可以代替我们在之前的许多的 Beats：</p> 
<p class="img-center"><img alt="" height="932" src="https://images2.imgbox.com/0b/98/nUmfk3OY_o.png" width="1200"></p> 
<p>以 Elastic Agent 为基础的数据摄入架构如下：</p> 
<p class="img-center"><img alt="" height="478" src="https://images2.imgbox.com/53/42/rowv8TqI_o.png" width="1200"></p> 
<p>在今天的文章中，我们将介绍如何使用 Fleet 来设置 Elastic Agent 并摄入需要的数据。你将了解：</p> 
<ul><li>配置 Fleet</li><li>使用 Elastic Agent 来发送数据到 Elastic Stack</li><li>监控整个公司的系统和服务的日志和指标</li></ul> 
<p class="img-center"><img alt="" height="717" src="https://images2.imgbox.com/c5/13/FUCIX0U3_o.png" width="800"></p> 
<p>我们可以通过 Fleet 来对 Elastic Agents 进行集中管理和配置。 在每一个 Elastic Agent 中，它是实现了如下的功能：</p> 
<p><img alt="" height="921" src="https://images2.imgbox.com/8a/33/ScI9wRl3_o.png" width="1200"></p> 
<p>它通过 Agent policy 的使用来配置相应的 Beats 来收集数据。 </p> 
<p>在实际的使用中，我们需要把 Elastic Agent 部署到一个单独的服务器中。它可以被用来收集该服务器的指标，日志等信息。我们甚至也可以使用 Elastic Agent 来从一些服务或各种 API 中收集数据并传入到 Elasticsearch 中：</p> 
<p class="img-center"><img alt="" height="676" src="https://images2.imgbox.com/57/24/DihLKVVD_o.png" width="1200"></p> 
<p>Elastic Agent 是一种向主机添加日志、指标和其他类型数据的监控的单一、统一的方法。 它还可以保护主机免受安全威胁、从操作系统查询数据、从远程服务或硬件转发数据等等。 单个代理可以更轻松、更快速地在您的基础架构中部署监控。 每个代理都有一个可以更新的策略，以添加新数据源、安全保护等的集成。</p> 
<p>如下图所示，Elastic Agent 可以监控部署它的主机，并且可以从无法直接部署的远程服务和硬件收集和转发数据。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3a/ad/ix2Z9Bzq_o.png"></p> 
<p>在今天的练习中，我将使用 Elastic Stack 8.0 来进行展示。我使用的测试环境如下：</p> 
<p class="img-center"><img alt="" height="409" src="https://images2.imgbox.com/3d/61/eJSpnHiN_o.png" width="600"></p> 
<p> 我在 macOS 上安装 Elastic Stack 8.0，而在 Ubuntu OS 的机器上安装 Fleet server 及 Elastic Agent。</p> 
<div class="csdn-video-box"> 
 <iframe id="uIZBktwV-1646196265773" frameborder="0" src="https://player.bilibili.com/player.html?aid=681914389" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>在 Elastic Stack 8.0 中使用 Elastic Agent 来摄入日志及指标</p> 
</div> 
<p><a href="https://www.bilibili.com/video/BV1wU4y1f7tS/" rel="nofollow" title="在 Elastic Stack 8.0 中使用 Elastic Agent 来摄入日志及指标_哔哩哔哩_bilibili">在 Elastic Stack 8.0 中使用 Elastic Agent 来摄入日志及指标_哔哩哔哩_bilibili</a></p> 
<p></p> 
<h2>安装</h2> 
<p>在进行下面的练习之前，我们必须安装好 Elasticsearch 及 Kibana。我们可以参考之前的文章：</p> 
<ul><li> <p id="articleContentId"><a class="link-info" href="https://blog.csdn.net/UbuntuTouch/article/details/122874932" title="Elastic Stack 8.0 安装 - 保护你的 Elastic Stack 现在比以往任何时候都简单">Elastic Stack 8.0 安装 - 保护你的 Elastic Stack 现在比以往任何时候都简单</a></p> </li><li> <p id="articleContentId"><a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/122936411" rel="nofollow" title="Elastic：使用 Docker 安装 Elastic Stack 8.0 并开始使用">Elastic：使用 Docker 安装 Elastic Stack 8.0 并开始使用</a></p> </li></ul> 
<p>我们按照上面的要求进行安装 Elasticsearch 及 Kibana。为了能够让 fleet 正常工作，<a class="link-info" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.0/security-settings.html#api-key-service-settings" rel="nofollow" title="内置的 API service">内置的 API service</a> 必须启动。我们必须为 Elasticsearch 的配置文件 config/elasticsearch.yml 文件配置：</p> 
<pre><code>xpack.security.authc.api_key.enabled: true</code></pre> 
<p>配置完后，我们再重新启动 Elasticsearch。针对 Kibana，我们也需要做一个额外的配置。我们需要修改 config/kibana.yml 文件。在这个文件的最后面，添加如下的一行：</p> 
<pre><code>
xpack.encryptedSavedObjects.encryptionKey: 'fhjskloppd678ehkdfdlliverpoolfcr'</code></pre> 
<p>如果你不想使用上面的这个设置，你可以使用如下的方式来获得：</p> 
<pre><code>./bin/kibana-encryption-keys generate</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d2/c7/ToFkK4jo_o.png" width="1200"></p> 
<p>从上面的输出中，我们可以看出来，有三个输出的 key。我们可以把这三个同时拷贝，并添加到 config/kibana.yml 文件的后面。当然，我们也可以只拷贝其中的一个也可。我们再重新启动 Kibana。</p> 
<p>这样我们对 Elasticsearch 及 Kibana 的配置就完成。 针对 Elastic Stack 8.0 以前的版本安装，请阅读我之前的文章 “<a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/122678925" rel="nofollow" title="Observability：如何在最新的 Elastic Stack 中使用 Fleet 摄入 system 日志及指标">Observability：如何在最新的 Elastic Stack 中使用 Fleet 摄入 system 日志及指标</a>”。 </p> 
<p>除此之外，Kibana 需要 Internet 连接才能从 Elastic Package Registry 下载集成包。 确保 Kibana 服务器可以连接到<a class="link-info" href="https://epr.elastic.co" rel="nofollow" title="https://epr.elastic.co">https://epr.elastic.co</a> 的端口 443 上 。如果你的环境有网络流量限制，有一些方法可以解决此要求。 有关详细信息，请参阅<a class="link-info" href="https://www.elastic.co/guide/en/fleet/8.0/air-gapped.html" rel="nofollow" title="气隙环境">气隙环境</a>。</p> 
<p>目前，Fleet 只能被具有 <a class="link-info" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.0/built-in-roles.html" rel="nofollow" title="superuser role">superuser role</a> 的用户所使用。</p> 
<p></p> 
<h2>配置 Fleet</h2> 
<p>使用 Kibana 中的 Fleet 将日志、指标和安全数据导入 Elastic Stack。第一次使用 Fleet 时，你可能需要对其进行设置并添加 Fleet Server。在做配置之前，我们首先来查看一下有没有任何的 integration 被安装：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ff/14/zDjleO0j_o.png" width="1200"></p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/0d/e0/eJotk7q9_o.png" width="1200"></p> 
<p>我们打开 Fleet 页面：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a1/71/Pw8NqpNd_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/1b/66/gujYhCys_o.png" width="1200"></p> 
<p>由于我们还没有指定 Fleet server 的地址，所以我们点击 Edit hosts：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e0/be/39s7sx0D_o.png" width="1200"></p> 
<p> 在我们的配置中，我们想把 Fleet server 安装到 Ubuntu OS 的机器上，所以在上面的输入框中，我们输入 Ubuntu OS 的地址 192.168.0.4。端口地址 8220 是默认的地址。点击上面的 Save and apply settings：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/26/d7/bFtw7GjJ_o.png" width="1200"></p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/cf/a1/aogjtNe6_o.png" width="1200"></p> 
<p>在上面，我们查看 Elasticsearch 的地址也是对的。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/85/09/ptrxygs8_o.png" width="1200"></p> 
<p>点击 Agents 选项卡：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/b5/8b/21Ra7jug_o.png" width="1200"></p> 
<p> 对于我们自管型的不是中，有一个默认的 Default Fleet Server Policy。我们也可以创建一个自己的 Policy。</p> 
<blockquote> 
 <p>Fleet Server policy 到底是什么呢？</p> 
 <p>它是包含 Fleet Server 集成的 agent policy。 在自管型的集群中，第一次运行 Fleet 时会自动创建默认的 Fleet Server 策略。 如果你要部署一个自我管理的 Fleet Server 以使用我们托管的 Elasticsearch 服务，你必须明确<a class="link-info" href="https://www.elastic.co/guide/en/fleet/8.0/agent-policy.html#create-a-policy" rel="nofollow" title="创建一个包含 Fleet Server 集成的新代理策略">创建一个包含 Fleet Server 集成的新代理策略</a>。</p> 
</blockquote> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/3b/07/XwrYnYik_o.png" width="1200"></p> 
<p>由于我们的 Ubuntu OS 系统是 Linux 64-bit，我们选择上面的选项进行下载。我们在 Ubuntu 机器的 terminal 中打入如下的命令：</p> 
<pre><code>curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-linux-x86_64.tar.gz</code></pre> 
<pre><code>liuxg@liuxgu:~/fleet$ curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-linux-x86_64.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  256M  100  256M    0     0  9775k      0  0:00:26  0:00:26 --:--:-- 9257k</code></pre> 
<p> 我们使用如下的命令来进行安装：</p> 
<pre><code>tar xzf elastic-agent-8.0.0-linux-x86_64.tar.gz</code></pre> 
<p><img alt="" height="670" src="https://images2.imgbox.com/32/20/iZT1yiIR_o.png" width="1200"></p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/3d/dd/MAmh2kmn_o.png" width="1200"></p> 
<p>在上面，我选择 “Quick Start” 来进行部署。在实际的生产环境中，被推荐的办法是使用 “Production” 选项来部署以确保 Fleet server 和 Elastic Agent 之间的安全连接。详细阅读请参阅文章 “<a class="link-info" href="https://blog.csdn.net/UbuntuTouch/article/details/124522674" title="Observability：在生产环境中配置 Fleet Server 和 Elastic Agent 之间的安全">Observability：在生产环境中配置 Fleet Server 和 Elastic Agent 之间的安全</a>”。点击上面的 Generate service token：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/57/b5/OqqEGK0u_o.png" width="1200"></p> 
<p>在上面的界面中，我们可以看到它一直显示 Waiting for Fleet Server to connect ...。我们点击上面的两个文档按钮以拷贝并保存 Service token。 我们在 Ubuntu 机器下运行上面的命令：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/cf/b7/uNPvLnIK_o.png" width="1200"></p> 
<p>我们再次回到 Kibana 的界面：</p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/d0/07/H5q3JKTk_o.png" width="1200"></p> 
<p>上面显示 Fleet Server connected。它清楚地表明我们的 Fleet 已经成功地连接起来了。我们点击上面的 Continue：</p> 
<p><img alt="" height="1176" src="https://images2.imgbox.com/89/0f/Y3n4UXKu_o.png" width="1200">上面显示我们的 Agents 已经成功地部署，并且它的状态是 Healthy 的。</p> 
<p>如果你有多个 Fleet Server，建议你为每个 Fleet Server 创建一个唯一的 service token。你可以参考链接 <a class="link-info" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.0/service-tokens-command.html" rel="nofollow" title="elasticsearch-service-tokens">elasticsearch-service-tokens</a> 来生成 service token。有关 Fleet Server 的更多信息，请参考<a class="link-info" href="https://www.elastic.co/guide/en/fleet/8.0/fleet-server.html" rel="nofollow" title="链接">链接</a>。</p> 
<p>在上面，我们已经成功地为 Default Fleet Server policy 创建了一个 Agent。它安装了 Fleet Server。这个是必须的步骤，一个 Fleet Server 可以管理许多的 Agents。有关 Fleet 的架构更多信息，请参阅文章 “<a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/119143697" rel="nofollow" title="Observability：运用 Fleet 来轻松地导入 Nginx 日志及指标">Observability：运用 Fleet 来轻松地导入 Nginx 日志及指标</a>”。</p> 
<p></p> 
<h2>添加 Elastic Agent 到 Fleet</h2> 
<p>Elastic Agent 是一个单一的统一代理，你可以将其部署到主机或容器以收集数据并将其发送到 Elastic Stack。 在后台，Elastic Agent 运行你的配置所需的 Beats shippers 或 Elastic Endpoint。</p> 
<p>要将日志和指标发送到 Elastic Stack。你首先要在那个机器上下载 Elastic Agent，并解压缩：</p> 
<ul><li>macOS</li></ul> 
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-darwin-x86_64.tar.gz
tar xzvf elastic-agent-8.0.0-darwin-x86_64.tar.gz</code></pre> 
<ul><li>Linux OS</li></ul> 
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-linux-x86_64.tar.gz
tar xzvf elastic-agent-8.0.0-linux-x86_64.tar.gz</code></pre> 
<ul><li>Windows</li></ul> 
<pre><code># PowerShell 5.0+
wget https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-windows-x86_64.zip -OutFile elastic-agent-8.0.0-windows-x86_64.zip
Expand-Archive .\elastic-agent-8.0.0-windows-x86_64.zip</code></pre> 
<ul><li>DEB</li></ul> 
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-amd64.deb
sudo dpkg -i elastic-agent-8.0.0-amd64.deb</code></pre> 
<ul><li>RPM</li></ul> 
<pre><code>curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-x86_64.rpm
sudo rpm -vi elastic-agent-8.0.0-x86_64.rpm</code></pre> 
<p>更多关于 Elastic Agent 的下载信息，请参阅官方链接 <a class="link-info" href="https://www.elastic.co/downloads/elastic-agent" rel="nofollow" title="Download Elastic Agent">Download Elastic Agent</a>。</p> 
<p>针对我们的情况，我们需要手机的是 Ubuntu OS 上的日志及指标，所以我们下载的是 Linux 的版本。在我们之前安装 Fleet Server 时已经解压缩，并运行了，所以我们并不需要做任何其它特别的。</p> 
<p>我们接下来添加 Agent：</p> 
<p><img alt="" height="1158" src="https://images2.imgbox.com/0b/38/zDeZipJD_o.png" width="1200"></p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/77/27/SCsSLWnn_o.png" width="1200"></p> 
<p>在上面，我们选择 Default policy，它目前含有一个叫做 system 的 integration。你也可以创建自己的 policy。选择 Default policy 会让我们的练习进展更快。我们按照 <a class="link-info" href="https://www.elastic.co/downloads/past-releases/elastic-agent-8-0-0" rel="nofollow" title="Go to download page">Go to download page</a> 去下载相应的 Agent。这个和我们之前的 Fleet Server 是一样的页面。这里就不再累述了。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/de/5e/WVEMpqlf_o.png" width="1200"></p> 
<p>我们点击上面的文档按钮来进行注册：</p> 
<pre><code>sudo ./elastic-agent install --url=http://192.168.0.4:8220 --enrollment-token=amw2a0FIOEJnUDdoZ29vRmJBVkY6TDRCZ3liNnpTSFNZdENnLXFrOExSZw==</code></pre> 
<p>请注意，在上面 <a href="http://192.168.0.4:8220" rel="nofollow" title="http://192.168.0.4:8220">http://192.168.0.4:8220</a> 是我们的 Fleet Server 的地址，也就是说 Agent 的注册是直接发向 Fleet Server 的。当然如果你是其它的平台，你需要在上面的页面进行选择。</p> 
<p>运行上面的命令：</p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/54/22/tYELc5m7_o.png" width="1200"></p> 
<p>因为之前，我们在安装 Fleet Server 的时候，已经按照好 Elastic Agent 了，所以会出现上面的错误信息。如果你还有其它的 Linux 机器，你可以通过上面的方法来注册你的 Elastic Agent。</p> 
<p>现在，我把我的一台树莓派的 Ubuntu OS 机器开起来，我们使用如下的方法来进行注册：</p> 
<pre><code>liuxg@liuxgarm:~/fleet$ curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.0.0-linux-arm64.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  241M  100  241M    0     0  5615k      0  0:00:44  0:00:44 --:--:-- 5953k
liuxg@liuxgarm:~/fleet$ ls
elastic-agent-8.0.0-linux-arm64.tar.gz
liuxg@liuxgarm:~/fleet$ tar xzf elastic-agent-8.0.0-linux-arm64.tar.gz 
liuxg@liuxgarm:~/fleet$ cd elastic-agent-8.0.0-linux-arm64/
liuxg@liuxgarm:~/fleet/elastic-agent-8.0.0-linux-arm64$ sudo ./elastic-agent install --url=http://192.168.0.4:8220 --enrollment-token=amw2a0FIOEJnUDdoZ29vRmJBVkY6TDRCZ3liNnpTSFNZdENnLXFrOExSZw==
[sudo] password for liuxg: 
Elastic Agent will be installed at /opt/Elastic/Agent and will run as a service. Do you want to continue? [Y/n]:Y
Error: Error: connection to fleet-server is insecure, strongly recommended to use a secure connection (override with --insecure)
For help, please see our troubleshooting guide at https://www.elastic.co/guide/en/fleet/8.0/fleet-troubleshooting.html
Error: enroll command failed with exit code: 1
For help, please see our troubleshooting guide at https://www.elastic.co/guide/en/fleet/8.0/fleet-troubleshooting.html
liuxg@liuxgarm:~/fleet/elastic-agent-8.0.0-linux-arm64$ sudo ./elastic-agent install --url=http://192.168.0.4:8220 --enrollment-token=amw2a0FIOEJnUDdoZ29vRmJBVkY6TDRCZ3liNnpTSFNZdENnLXFrOExSZw== --insecure
Elastic Agent will be installed at /opt/Elastic/Agent and will run as a service. Do you want to continue? [Y/n]:Y
{"log.level":"warn","@timestamp":"2022-02-16T16:34:20.428+0800","log.logger":"tls","log.origin":{"file.name":"tlscommon/tls_config.go","file.line":105},"message":"SSL/TLS verifications disabled.","ecs.version":"1.6.0"}
{"log.level":"info","@timestamp":"2022-02-16T16:34:20.544+0800","log.origin":{"file.name":"cmd/enroll_cmd.go","file.line":456},"message":"Starting enrollment to URL: http://192.168.0.4:8220/","ecs.version":"1.6.0"}
{"log.level":"info","@timestamp":"2022-02-16T16:34:21.501+0800","log.origin":{"file.name":"cmd/enroll_cmd.go","file.line":256},"message":"Successfully triggered restart on running Elastic Agent.","ecs.version":"1.6.0"}
Successfully enrolled the Elastic Agent.
Elastic Agent has been successfully installed.</code></pre> 
<p>如上所示，因为我们尝试去注册一个使用自签名证书的 Fleet Server，在上面我们出现了一个错误。我在上面的命令后面添加一个选项 --insecure：</p> 
<pre><code>sudo ./elastic-agent install --url=http://192.168.0.4:8220 --enrollment-token=amw2a0FIOEJnUDdoZ29vRmJBVkY6TDRCZ3liNnpTSFNZdENnLXFrOExSZw== --insecure</code></pre> 
<p>那么我们这次运行是成功的。我们回到 Kibana 的界面：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/05/f7/RF2gJbWz_o.png" width="1200"></p> 
<p>这个时候，我们看到了一个新增加的叫做 liuxgarm 的 agent。在上面的两个 agent 中，Fleet server 是运行于 liuxgu 机器上的。如过我们想收集这个机器的日志及指标的话，我们需要在 Default Fleet Server policy 中去添加 System integration。</p> 
<p><img alt="" height="1112" src="https://images2.imgbox.com/dc/4c/JyzHCQh5_o.png" width="1200"></p> 
<p><img alt="" height="1044" src="https://images2.imgbox.com/e7/91/cTFYiQC8_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/8a/58/Axi31tmJ_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d0/c2/6PH6PCfD_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/6d/78/WFaQX1qJ_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5c/52/jcGIH7nU_o.png" width="1200"></p> 
<p><img alt="" height="1146" src="https://images2.imgbox.com/20/7d/NdPmbYiC_o.png" width="1200"></p> 
<p>这我们的 liuxgu agent 就可以收集 system 指标及日志了。</p> 
<p>我们点击 Data streams：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/4f/cb/tcSTR4z2_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/49/0c/PA6sm11c_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f1/f4/W6M6TTcd_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fd/14/ShMb1JnF_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/09/c1/Zl2vL3tF_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/74/22/c2ipXtQ1_o.png" width="1200"></p> 
<p>我们可以看到两个机器都有日志信息。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d0/56/S1bEoB7d_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/b2/55/g5wfLmLM_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ce/93/FrXOQgzu_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/67/81/lEDCGpph_o.png" width="1200"></p> 
<p><img alt="" height="1118" src="https://images2.imgbox.com/a8/92/QCSwfS92_o.png" width="1200"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c170683a0e9713545efa8291754f9bcc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决echarts图形没有及时清除更新，清空重绘问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7981011679d45606634737b9a0225479/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">webstorm vue3&#43;ts报错:Cannot find module ‘@/views/xxx.vue‘ or its corresponding type declarations</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>