<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>游戏思考30：技能碰撞检测分类枚举及逆水寒魔兽老兵服副本攻略（英雄武林风云录，后续更新舞阳城、扬州、清明等副本攻略） - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="游戏思考30：技能碰撞检测分类枚举及逆水寒魔兽老兵服副本攻略（英雄武林风云录，后续更新舞阳城、扬州、清明等副本攻略）" />
<meta property="og:description" content="文章目录 一、技能碰撞检测方式分类讲解1）AABB2）OBB3）像素检测碰撞4）矩阵变换检测碰撞(打住，略)5）Tile地形检测碰撞（其实就是九方格遍历查找攻击对象） 二、武林风云录1）老一：陈斩槐（只有四个机制，dps压力不大，留爆发打影子就行）（1）点名红色扇形区域（2）点名红色长条，注意最后还有一段大劈（3）BOSS在百分之80 、50、20血量时会击退玩家，会刷新三个输出位置（4）BOSS在百分之35血时会吸玩家到其周围，释放旋风斩，得交解控技能。但是不要着急回去，还有一个圆圈的下坠伤害 2）老二：醉仙（1）红圈和点名略过（2）输出记得喝酒（龙吟内功，铁衣外功等）（3）每一个奉茶小厮都有名字，得按照诗词来按照顺序击杀小二 3）老三：楚相玉（1）boss有狂暴机制，冰火玄功达到极致，倒数360s，将直接团灭（人均得有1.2Wdps）（2）地上出现红圈，0.5s后将冒出冰柱，击飞造成一段伤害，落地造成二段伤害（估计代码是设计成击飞后掉落下来还在圆圈内）（3）点名T红色长条，多段伤害（4）烈焰焚身，需要交减伤或无敌规避伤害（5）冰风火凤融合产生圆形爆炸区域（6）赤炎寒光破（7）暴风雪 4）老四：刀狂（1）略过半圆斩、三段长条大劈、落地红圈、黑水机制不在赘述（2）达到百分之90血时，地上出现追忆碎片，分内外场地（血河上马溜boss，需要奶妈往返内网场用追忆碎片奶安抚boss并奶白剑）（3）刀狂有怒气机制，到百分之100时增加移速和攻击力（4）内场讲解 三、舞阳城1）老一：黑天尊使（1）攻击BOSS会叠加debuff原理及解决方法（2）BOSS怒气机制1、一阶段2、二阶段3、三阶段4、四阶段 2）老二：火焰围攻（机制说明）3）老三：药人战4）老四：红衣尊使5）老五：雷音尊使6）老六：薛魔主 一、技能碰撞检测方式分类讲解 1）AABB 定义
采用一个长方体将物体包裹起来，进行两个物体的相交性检测时仅检测物体对应包围盒（包裹物体的长方体）的相交性。长方体每一个面都是与某个坐标轴平面平行的，因此，AABB 包围盒又称了 轴对齐包围盒 。
备注
确定 AABB 包围盒就简单多了，仅需要记录 6 个值即可，这 6 个值分别代表包围盒在每个坐标轴上的最小值与最大值，即 xmin、xmax、ymin、ymax、zmin、zmax。也就是说，实际物体上所有的点都必须满足以下条件：
代码计算
1）C&#43;&#43;版本检测AABB碰撞
法一:（1）包围盒 struct stBoundingBox { stBoundingBox () { min[0] = min[1] = min[2] = max[0] = max[1] = max[2] = 0; } float min[3]; float max[3]; }; //检测点是否在包围盒内 // Point inside box. bool OnCollision(stBoundingBox bb, float x, float y, float z) { if(bb.max[0] &lt;= x) return false; if(bb." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/c52bb47b4ea638b05f1002f19a71dbf1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-19T17:02:21+08:00" />
<meta property="article:modified_time" content="2023-02-19T17:02:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">游戏思考30：技能碰撞检测分类枚举及逆水寒魔兽老兵服副本攻略（英雄武林风云录，后续更新舞阳城、扬州、清明等副本攻略）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、技能碰撞检测方式分类讲解</a></li><li><ul><li><a href="#1AABB_2" rel="nofollow">1）AABB</a></li><li><a href="#2OBB_264" rel="nofollow">2）OBB</a></li><li><a href="#3_274" rel="nofollow">3）像素检测碰撞</a></li><li><a href="#4_447" rel="nofollow">4）矩阵变换检测碰撞(打住，略)</a></li><li><a href="#5Tile_448" rel="nofollow">5）Tile地形检测碰撞（其实就是九方格遍历查找攻击对象）</a></li></ul> 
   </li><li><a href="#_1426" rel="nofollow">二、武林风云录</a></li><li><ul><li><a href="#1dps_1427" rel="nofollow">1）老一：陈斩槐（只有四个机制，dps压力不大，留爆发打影子就行）</a></li><li><ul><li><a href="#1_1428" rel="nofollow">（1）点名红色扇形区域</a></li><li><a href="#2_1430" rel="nofollow">（2）点名红色长条，注意最后还有一段大劈</a></li><li><a href="#3BOSS80_5020_1433" rel="nofollow">（3）BOSS在百分之80 、50、20血量时会击退玩家，会刷新三个输出位置</a></li><li><a href="#4BOSS35_1441" rel="nofollow">（4）BOSS在百分之35血时会吸玩家到其周围，释放旋风斩，得交解控技能。但是不要着急回去，还有一个圆圈的下坠伤害</a></li></ul> 
    </li><li><a href="#2_1447" rel="nofollow">2）老二：醉仙</a></li><li><ul><li><a href="#1_1461" rel="nofollow">（1）红圈和点名略过</a></li><li><a href="#2_1463" rel="nofollow">（2）输出记得喝酒（龙吟内功，铁衣外功等）</a></li><li><a href="#3_1465" rel="nofollow">（3）每一个奉茶小厮都有名字，得按照诗词来按照顺序击杀小二</a></li></ul> 
    </li><li><a href="#3_1467" rel="nofollow">3）老三：楚相玉</a></li><li><ul><li><a href="#1boss360s12Wdps_1471" rel="nofollow">（1）boss有狂暴机制，冰火玄功达到极致，倒数360s，将直接团灭（人均得有1.2Wdps）</a></li><li><a href="#205s_1473" rel="nofollow">（2）地上出现红圈，0.5s后将冒出冰柱，击飞造成一段伤害，落地造成二段伤害（估计代码是设计成击飞后掉落下来还在圆圈内）</a></li><li><a href="#3T_1475" rel="nofollow">（3）点名T红色长条，多段伤害</a></li><li><a href="#4_1481" rel="nofollow">（4）烈焰焚身，需要交减伤或无敌规避伤害</a></li><li><a href="#5_1483" rel="nofollow">（5）冰风火凤融合产生圆形爆炸区域</a></li><li><a href="#6_1488" rel="nofollow">（6）赤炎寒光破</a></li><li><a href="#7_1491" rel="nofollow">（7）暴风雪</a></li></ul> 
    </li><li><a href="#4_1497" rel="nofollow">4）老四：刀狂</a></li><li><ul><li><a href="#1_1498" rel="nofollow">（1）略过半圆斩、三段长条大劈、落地红圈、黑水机制不在赘述</a></li><li><a href="#290bossboss_1500" rel="nofollow">（2）达到百分之90血时，地上出现追忆碎片，分内外场地（血河上马溜boss，需要奶妈往返内网场用追忆碎片奶安抚boss并奶白剑）</a></li><li><a href="#3100_1503" rel="nofollow">（3）刀狂有怒气机制，到百分之100时增加移速和攻击力</a></li><li><a href="#4_1509" rel="nofollow">（4）内场讲解</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_1521" rel="nofollow">三、舞阳城</a></li><li><ul><li><a href="#1_1524" rel="nofollow">1）老一：黑天尊使</a></li><li><ul><li><a href="#1BOSSdebuff_1525" rel="nofollow">（1）攻击BOSS会叠加debuff原理及解决方法</a></li><li><a href="#2BOSS_1536" rel="nofollow">（2）BOSS怒气机制</a></li><li><ul><li><a href="#1_1541" rel="nofollow">1、一阶段</a></li><li><a href="#2_1555" rel="nofollow">2、二阶段</a></li><li><a href="#3_1567" rel="nofollow">3、三阶段</a></li><li><a href="#4_1578" rel="nofollow">4、四阶段</a></li></ul> 
    </li></ul> 
    </li><li><a href="#2_1584" rel="nofollow">2）老二：火焰围攻（机制说明）</a></li><li><a href="#3_1604" rel="nofollow">3）老三：药人战</a></li><li><a href="#4_1606" rel="nofollow">4）老四：红衣尊使</a></li><li><a href="#5_1608" rel="nofollow">5）老五：雷音尊使</a></li><li><a href="#6_1610" rel="nofollow">6）老六：薛魔主</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、技能碰撞检测方式分类讲解</h3> 
<h4><a id="1AABB_2"></a>1）AABB</h4> 
<ul><li> <p>定义<br> 采用一个长方体将物体包裹起来，进行两个物体的相交性检测时仅检测物体对应包围盒（包裹物体的长方体）的相交性。长方体每一个面都是与某个坐标轴平面平行的，因此，AABB 包围盒又称了 轴对齐包围盒 。<br> <img src="https://images2.imgbox.com/a0/80/8JhaYbbB_o.png" alt="在这里插入图片描述"></p> </li><li> <p>备注<br> 确定 AABB 包围盒就简单多了，仅需要记录 6 个值即可，这 6 个值分别代表包围盒在每个坐标轴上的最小值与最大值，即 xmin、xmax、ymin、ymax、zmin、zmax。也就是说，实际物体上所有的点都必须满足以下条件：<br> <img src="https://images2.imgbox.com/af/5a/OdjmMSUG_o.png" alt="在这里插入图片描述"></p> </li><li> <p>代码计算<br> 1）C++版本检测AABB碰撞</p> </li></ul> 
<pre><code class="prism language-c">法一<span class="token operator">:</span>（<span class="token number">1</span>）包围盒
<span class="token keyword">struct</span> <span class="token class-name">stBoundingBox</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token function">stBoundingBox</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span>
                      max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">float</span> min<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span> max<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//检测点是否在包围盒内</span>
<span class="token comment">// Point inside box.</span>
bool <span class="token function">OnCollision</span><span class="token punctuation">(</span>stBoundingBox bb<span class="token punctuation">,</span> <span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> x<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> x<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> z<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> z<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>

   <span class="token comment">// Return true then we have collision.</span>
	<span class="token keyword">return</span> true<span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token comment">//检测包围盒相撞</span>
<span class="token comment">// Box on box.</span>
bool <span class="token function">OnCollision</span><span class="token punctuation">(</span>stBoundingBox <span class="token operator">&amp;</span>bb1<span class="token punctuation">,</span> stBoundingBox <span class="token operator">&amp;</span>bb2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bb1<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb2<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>bb2<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb1<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> false<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bb1<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb2<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>bb2<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb1<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> false<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bb1<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb2<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>bb2<span class="token punctuation">.</span>min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> bb1<span class="token punctuation">.</span>max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> false<span class="token punctuation">;</span>

   <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
法二<span class="token operator">:</span>立方体检测
（一）优点：对结构而言，对边界框使用<span class="token number">4</span>个浮点数需要的空间较少，而这是较合理的空间坐标。
（二）缺点：盒子变成了立方体。这样在尝试封装物体时会浪费更多的空间，因为需要为深度、宽度和高度使用最
大的尺寸值，而不是使用每个方向上所必须的扩展值
（这里给出了一个使用<span class="token number">4</span>个浮点数以及一个最大、最小数值对来定义和创建边框的方法）
<span class="token keyword">struct</span> <span class="token class-name">stBoundingBox</span>
<span class="token punctuation">{<!-- --></span>
    CVector3 min<span class="token punctuation">,</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">stBoundingBox</span>
<span class="token punctuation">{<!-- --></span>
    CVector3 center<span class="token punctuation">;</span>
    <span class="token keyword">float</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
法三：边界求检测
（一）定义：边界球完全围绕在一些几何图形周围，它除了不用方
框之外，和边界框结构非常相似。边界球结构可以使用<span class="token number">4</span>个浮点值
确定。前<span class="token number">3</span>个浮点值代表了边界球的中心位置，第四个浮点数代表
了边界球的半径
（二）优点：边界框相比较而言，边界球在处理碰撞检测和可见度时速度更快
（三）缺点：环绕造成的空间浪费要比边界框多
<span class="token keyword">struct</span> <span class="token class-name">stBoundingSphere</span>
<span class="token punctuation">{<!-- --></span>
    CVector3 center<span class="token punctuation">;</span>
    <span class="token keyword">double</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


stBoundingSphere <span class="token function">CalculateBoundingSphere</span><span class="token punctuation">(</span>CVector3 <span class="token operator">*</span>vList<span class="token punctuation">,</span> <span class="token keyword">int</span> totalVerts<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">float</span> d<span class="token punctuation">,</span> maxDistance <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
   stBoundingSphere sphere<span class="token punctuation">;</span>

   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalVerts<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&lt;</span> min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;</span> max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token operator">&lt;</span> min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token operator">&gt;</span> max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   CVector3 center <span class="token operator">=</span> <span class="token punctuation">(</span>max <span class="token operator">+</span> min<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>

   <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalVerts<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
         d <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> center<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> center<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
             <span class="token punctuation">(</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> center<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> center<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
             <span class="token punctuation">(</span><span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token operator">-</span> center<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>vList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token operator">-</span> center<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">&gt;</span> maxDistance<span class="token punctuation">)</span>
            maxDistance <span class="token operator">=</span> d<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   sphere<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>maxDistance<span class="token punctuation">)</span><span class="token punctuation">;</span>
   sphere<span class="token punctuation">.</span>center <span class="token operator">=</span> center<span class="token punctuation">;</span>
   
   <span class="token keyword">return</span> sphere<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>球体检测综合评价<br> 如前所述，<code>边界球要比边界框更容易处理</code>(碰撞、能见度等)，因为<code>对球所做的操作都是比较便宜的CPU相关的</code>。这样在想要快速确定一个物体是否和其他物体发生碰撞或是那个物体是否可见的情况下，就最有可能选择使用边界球。某些混合法包括先使用边界球快速拒绝几何图形，然后使用边界框进行更准确的测试。如果这两个测试都通过了，那么接下来的操作要么是接受物体测试成功，要么是将物体分解成更小的块，然后分别对围绕这些块的边界框进行测试。当然，使用的方法很大程度上取决于程序的要求。取代使用大的球，然后是大的边界框，可以先使用大的边界球，然后再直接使用小一些的边界框。无论如何，最初使用边界球进行测试经过证明十分有用，因为进行碰撞和可见度测试使用的大量时间对包含大量物体的场景而言都是不够的</li></ul> 
<p>2）java版本</p> 
<pre><code class="prism language-csharp">（<span class="token number">1</span>）<span class="token number">3D</span>结构体定义
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vector3f</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token keyword">float</span></span> x<span class="token punctuation">;</span><span class="token comment">//三维变量中的x值</span>
    <span class="token class-name"><span class="token keyword">float</span></span> y<span class="token punctuation">;</span><span class="token comment">//三维变量中的y值</span>
    <span class="token class-name"><span class="token keyword">float</span></span> z<span class="token punctuation">;</span><span class="token comment">//三维变量中的z值</span>
    <span class="token keyword">public</span> <span class="token function">Vector3f</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> x<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> y<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> z<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token operator">=</span>x<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token operator">=</span>y<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>z<span class="token operator">=</span>z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token class-name">Vector3f</span> temp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token operator">+=</span>temp<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token operator">+=</span>temp<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>z<span class="token operator">+=</span>temp<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
（<span class="token number">2</span>）包围盒定义
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AABBBox</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token keyword">float</span></span> minX<span class="token punctuation">;</span><span class="token comment">//x轴最小位置</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxX<span class="token punctuation">;</span><span class="token comment">//x轴最大位置</span>
    <span class="token class-name"><span class="token keyword">float</span></span> minY<span class="token punctuation">;</span><span class="token comment">//y轴最小位置</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxY<span class="token punctuation">;</span><span class="token comment">//y轴最大位置</span>
    <span class="token class-name"><span class="token keyword">float</span></span> minZ<span class="token punctuation">;</span><span class="token comment">//z轴最小位置</span>
    <span class="token class-name"><span class="token keyword">float</span></span> maxZ<span class="token punctuation">;</span><span class="token comment">//z轴最大位置</span>

    <span class="token keyword">public</span> <span class="token function">AABBBox</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> vertices<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">findMinAndMax</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">AABBBox</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> minX<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> maxX<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> minY<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> maxY<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> minZ<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">float</span></span> maxZ<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minX<span class="token operator">=</span>minX<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxX<span class="token operator">=</span>maxX<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minY<span class="token operator">=</span>minY<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxY<span class="token operator">=</span>maxY<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minZ<span class="token operator">=</span>minZ<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxZ<span class="token operator">=</span>maxZ<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//初始化包围盒的最小以及最大顶点坐标</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        minX<span class="token operator">=</span>Float<span class="token punctuation">.</span>POSITIVE_INFINITY<span class="token punctuation">;</span> <span class="token comment">// 正无穷</span>
        maxX<span class="token operator">=</span>Float<span class="token punctuation">.</span>NEGATIVE_INFINITY<span class="token punctuation">;</span> <span class="token comment">// 负无穷</span>
        minY<span class="token operator">=</span>Float<span class="token punctuation">.</span>POSITIVE_INFINITY<span class="token punctuation">;</span>
        maxY<span class="token operator">=</span>Float<span class="token punctuation">.</span>NEGATIVE_INFINITY<span class="token punctuation">;</span>
        minZ<span class="token operator">=</span>Float<span class="token punctuation">.</span>POSITIVE_INFINITY<span class="token punctuation">;</span>
        maxZ<span class="token operator">=</span>Float<span class="token punctuation">.</span>NEGATIVE_INFINITY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获取包围盒的实际最小以及最大顶点坐标</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">findMinAndMax</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> vertices<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vertices<span class="token punctuation">.</span>length<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//判断X轴的最小和最大位置</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>minX<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                minX<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>maxX<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                maxX<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//判断Y轴的最小和最大位置</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>minY<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                minY<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>maxY<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                maxY<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//判断Z轴的最小和最大位置</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>minZ<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                minZ<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>maxZ<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                maxZ<span class="token operator">=</span>vertices<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获得物体平移后的AABB包围盒</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">AABBBox</span> <span class="token function">getCurrAABBBox</span><span class="token punctuation">(</span><span class="token class-name">Vector3f</span> currPosition<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AABBBox</span> result<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AABBBox</span>
                <span class="token punctuation">(</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>minX<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>maxX<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>minY<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>maxY<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>minZ<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>maxZ<span class="token operator">+</span>currPosition<span class="token punctuation">.</span>z
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

（<span class="token number">3</span>）碰撞检测函数
 <span class="token keyword">public</span> <span class="token return-type class-name">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">RigidBody</span> ra<span class="token punctuation">,</span> <span class="token class-name">RigidBody</span> rb<span class="token punctuation">)</span><span class="token comment">//true为撞上</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> over <span class="token operator">=</span> calOverTotal
                <span class="token punctuation">(</span>
	                <span class="token comment">// 两个物体的 AABB 包围盒</span>
                        ra<span class="token punctuation">.</span>collObject<span class="token punctuation">.</span><span class="token function">getCurrAABBBox</span><span class="token punctuation">(</span>ra<span class="token punctuation">.</span>currLocation<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        rb<span class="token punctuation">.</span>collObject<span class="token punctuation">.</span><span class="token function">getCurrAABBBox</span><span class="token punctuation">(</span>rb<span class="token punctuation">.</span>currLocation<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 三个方向的交叠值与设定的阈值进行比较</span>
        <span class="token keyword">return</span> over<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> V_UNIT <span class="token operator">&amp;&amp;</span> over<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> V_UNIT <span class="token operator">&amp;&amp;</span> over<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> V_UNIT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	<span class="token comment">// 传入两个物体的 AABB 包围盒</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">calOverTotal</span><span class="token punctuation">(</span><span class="token class-name">AABBBox</span> a<span class="token punctuation">,</span> <span class="token class-name">AABBBox</span> b<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">float</span></span> xOver <span class="token operator">=</span> <span class="token function">calOverOne</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>maxX<span class="token punctuation">,</span> a<span class="token punctuation">.</span>minX<span class="token punctuation">,</span> b<span class="token punctuation">.</span>maxX<span class="token punctuation">,</span> b<span class="token punctuation">.</span>minX<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">float</span></span> yOver <span class="token operator">=</span> <span class="token function">calOverOne</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>maxY<span class="token punctuation">,</span> a<span class="token punctuation">.</span>minY<span class="token punctuation">,</span> b<span class="token punctuation">.</span>maxY<span class="token punctuation">,</span> b<span class="token punctuation">.</span>minY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">float</span></span> zOver <span class="token operator">=</span> <span class="token function">calOverOne</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>maxZ<span class="token punctuation">,</span> a<span class="token punctuation">.</span>minZ<span class="token punctuation">,</span> b<span class="token punctuation">.</span>maxZ<span class="token punctuation">,</span> b<span class="token punctuation">.</span>minZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{<!-- --></span>xOver<span class="token punctuation">,</span> yOver<span class="token punctuation">,</span> zOver<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 计算每个轴方向的交叠值</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">calOverOne</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> amax<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> amin<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> bmax<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> bmin<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">float</span></span> minMax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">float</span></span> maxMin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>amax <span class="token operator">&lt;</span> bmax<span class="token punctuation">)</span><span class="token comment">//a物体在b物体左侧</span>
        <span class="token punctuation">{<!-- --></span>
            minMax <span class="token operator">=</span> amax<span class="token punctuation">;</span>
            maxMin <span class="token operator">=</span> bmin<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token comment">//a物体在b物体右侧</span>
        <span class="token punctuation">{<!-- --></span>
            minMax <span class="token operator">=</span> bmax<span class="token punctuation">;</span>
            maxMin <span class="token operator">=</span> amin<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>minMax <span class="token operator">&gt;</span> maxMin<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> minMax <span class="token operator">-</span> maxMin<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> 
<h4><a id="2OBB_264"></a>2）OBB</h4> 
<ul><li>定义<br> 两个凸包多边形，当且仅当存在一条线，这两个多边形在这条线上的投影不相交，则这两个多边形也不相交.</li><li>举例<br> 这里不能取2因为投影会相交，可以取1为投影轴<br> <img src="https://images2.imgbox.com/c8/32/UQ7OmK6N_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/88/5a/idRhYTzp_o.png" alt="在这里插入图片描述"></li><li><a href="https://blog.csdn.net/silangquan/article/details/50812425?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167483435716800184144520%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167483435716800184144520&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-50812425-null-null.142%5Ev71%5Epc_new_rank,201%5Ev4%5Eadd_ask&amp;utm_term=OBB&amp;spm=1018.2226.3001.4187">链接传送门</a></li></ul> 
<h4><a id="3_274"></a>3）像素检测碰撞</h4> 
<ul><li> <p>使用背景<br> 1）使用<code>像素碰撞检测法算是最精确的算法</code><br> 2）<code>效率上的低下</code>。除非是在极为特殊的情况下，要求使用非常精确的碰撞，否则，一般情况下在游戏中是不建议使用这种算法，特别是在运行效率不太高的HTML5游戏中。</p> </li><li> <p>使用顺序<br> 一般来说在使用像素碰撞检测之前会使用AABB矩形包围盒先检测两个精灵是否有碰撞，如果AABB包围盒检测没有碰撞，那一定是没有碰撞到，反之，则不一定，需要进一步进行像素检测。如下图所示，很明显，虽然两个精灵的包围盒发生了碰撞，但两个精灵本身没有发生碰撞，所以在这种精灵的形状极为不规则的情况下，除非使用多边形包围盒，并且需要多边形和精灵的形状极为接近，才能够获取好的效果，而且，别忘了，多边形只适合凸多边形的情况。<br> <img src="https://images2.imgbox.com/fc/e5/waYuUF7Y_o.png" alt="在这里插入图片描述"></p> </li><li> <p>定义<br> 这样，我们就只能采用像素检测算法达到精确检测的目的。接下来，先来看看像素碰撞的原理，首先，我们知道所有的精灵都是由像素点组成，而在canvas的像素数据中每个点都是由RGBA四个数据组成。如果某个点的A（alpha值，透明度）为0则表示该点是透明的，比如在图6-19中两个精灵的空白部分的点的A值为0。如果两个精灵发生碰撞，则表示两个精灵有像素点发生了重叠，即两个精灵的像素点坐标相同，如下图所示。<br> <img src="https://images2.imgbox.com/bc/ad/gOscQWfF_o.png" alt="在这里插入图片描述"><br> 根据这个原理，基本上我们可以采取以下步骤来进行检测。</p> </li></ul> 
<pre><code class="prism language-shell">（1）选择需要检测的两个精灵。
（2）先检测两个精灵是否发生包围盒碰撞，如果没有则退出，否则获取两个矩形的相交区域，并继续。
（3）把一个精灵绘制到和游戏屏幕等大的空白的后台缓冲区中，获取缓冲区中在相交区域的像素数据。
（4）清除后台缓冲区。
（5）对另一个精灵进行步骤3的操作。
（6）得到两个精灵在同一个相交矩形的像素数据后，循环比较每一个像素点，如果两个精灵在同一位置的透明度不都是0，则表示两个精灵有相交，退出循环，返回真。

</code></pre> 
<ul><li>备注点<br> 需要注意的一点是，在第3步获取相交区域的像素数据中，需要在后台另外的一个和游戏屏幕等大的空白区域中绘制，而不能直接获取游戏画面中的相交区域，因为两个精灵在相交区域中的像素已经发生了重叠【包围盒】。</li><li>注意点<br> 由以上的算法可以看出，在进行像素检测的时候，需要另外一个缓冲区，把需要检测的精灵绘制一次，需要清空缓冲区，最后还要使用一个for循环检测像素。如果相交区域为100×100个像素点，则最坏的情况需要循环10 000 次，由此看来，这真不是一个省时的工作。</li><li>代码</li></ul> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>盒包围碰撞算法-像素检测算法<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">#stage</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid lightgray<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>包围盒是否碰撞：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hitTestBox<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>否<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>像素检测是否碰撞：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hitTestPixel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>否<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./images/penguin.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>penguinImg<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>penguinImg<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./images/giraffe.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>giraffeImg<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>giraffeImg<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> stage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#stage'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ctx <span class="token operator">=</span> stage<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stage<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
        stage<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
 
        <span class="token comment">//创建后台canvas</span>
        <span class="token keyword">var</span> bC <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bC<span class="token punctuation">.</span>width <span class="token operator">=</span> stage<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        bC<span class="token punctuation">.</span>height <span class="token operator">=</span> stage<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token keyword">var</span> backBuf <span class="token operator">=</span> bC<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">var</span> penguin <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#penguinImg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>giraffe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#giraffeImg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> penguinImg <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">x</span><span class="token operator">:</span>stage<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token literal-property property">y</span><span class="token operator">:</span>stage<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token literal-property property">r</span><span class="token operator">:</span><span class="token number">128</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>giraffeImg <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token literal-property property">r</span><span class="token operator">:</span><span class="token number">128</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
        <span class="token keyword">function</span> <span class="token function">drawImageBox</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//缓存画布绘制方法</span>
        <span class="token keyword">function</span> <span class="token function">drawImageBC</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            backBuf<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>stage<span class="token punctuation">.</span>width<span class="token punctuation">,</span>stage<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            backBuf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            backBuf<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            backBuf<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token comment">//获取两个矩形相交区域</span>
        <span class="token keyword">function</span> <span class="token function">getInRect</span><span class="token punctuation">(</span><span class="token parameter">x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y2<span class="token punctuation">,</span>x3<span class="token punctuation">,</span>y3<span class="token punctuation">,</span>x4<span class="token punctuation">,</span>y4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x3<span class="token punctuation">)</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span>y3<span class="token punctuation">)</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span>x4<span class="token punctuation">)</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>y2<span class="token punctuation">,</span>y4<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
 
        document<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> e <span class="token operator">=</span> event <span class="token operator">||</span> window<span class="token punctuation">.</span>event <span class="token operator">||</span> arguments<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>caller<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//根据地图数组碰撞将测</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token number">37</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Left"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>penguinImg<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        penguinImg<span class="token punctuation">.</span>x <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">38</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Top"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>penguinImg<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        penguinImg<span class="token punctuation">.</span>y <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">39</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Right"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>penguinImg<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> stage<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        penguinImg<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">40</span><span class="token operator">:</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Bottom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>penguinImg<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> stage<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        penguinImg<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
 
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        stage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> stage<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token keyword">var</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> stage<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top<span class="token punctuation">;</span>
            penguinImg<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
            penguinImg<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
        <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawImageBox</span><span class="token punctuation">(</span>giraffe<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawImageBox</span><span class="token punctuation">(</span>penguin<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.hitTestBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"否"</span><span class="token punctuation">;</span>
            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.hitTestPixel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"否"</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token function">getInRect</span><span class="token punctuation">(</span>giraffeImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>x<span class="token operator">+</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>y<span class="token operator">+</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>x<span class="token operator">+</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>y<span class="token operator">+</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">)</span>
 
            <span class="token comment">//如果没有相交则退出</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span>rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">||</span>rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span>rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 
            <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.hitTestBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"是"</span><span class="token punctuation">;</span>
                giraffeImg<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                penguinImg<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token comment">//获取精灵在相交矩形像素数据</span>
                <span class="token function">drawImageBC</span><span class="token punctuation">(</span>giraffe<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>giraffeImg<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                giraffeImg<span class="token punctuation">.</span>data <span class="token operator">=</span> backBuf<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
                <span class="token function">drawImageBC</span><span class="token punctuation">(</span>penguin<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>x<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>y<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">,</span>penguinImg<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                penguinImg<span class="token punctuation">.</span>data <span class="token operator">=</span> backBuf<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>giraffeImg<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">+=</span><span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>giraffeImg<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>penguinImg<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.hitTestPixel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"是"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
 
            <span class="token punctuation">}</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li><a href="https://github.com/krapnikkk/JS-gameMathematics">在线预览地址</a></li></ul> 
<h4><a id="4_447"></a>4）矩阵变换检测碰撞(打住，略)</h4> 
<h4><a id="5Tile_448"></a>5）Tile地形检测碰撞（其实就是九方格遍历查找攻击对象）</h4> 
<pre><code class="prism language-c">（<span class="token number">1</span>）头文件中

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"cocos2d.h"</span></span>

using namespace cocos2d<span class="token punctuation">;</span>



class AA<span class="token operator">:</span>public CCLayer

<span class="token punctuation">{<!-- --></span>

public<span class="token operator">:</span>

    virtual bool <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> CCScene <span class="token operator">*</span><span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">CREATE_FUNC</span><span class="token punctuation">(</span>AA<span class="token punctuation">)</span><span class="token punctuation">;</span>

  

     CCSprite <span class="token operator">*</span>_player<span class="token punctuation">;</span>

    <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    bool mode<span class="token punctuation">;</span>

    

    CCArray <span class="token operator">*</span>bulletArray<span class="token punctuation">;</span>

    CCArray <span class="token operator">*</span>enemyArray<span class="token punctuation">;</span>

    CCTMXTiledMap <span class="token operator">*</span>_tileMap<span class="token punctuation">;</span>

    CCTMXTiledMap <span class="token operator">*</span>_titleMap<span class="token punctuation">;</span>

    CCTMXLayer <span class="token operator">*</span>wall<span class="token punctuation">,</span><span class="token operator">*</span>foreground<span class="token punctuation">;</span>

    CCPoint mapPoint<span class="token punctuation">,</span>heroPoint<span class="token punctuation">,</span>beginPoint<span class="token punctuation">;</span>

     CCLabelTTF <span class="token operator">*</span>label<span class="token punctuation">;</span>

    <span class="token comment">//碰撞检测</span>

    <span class="token keyword">void</span> <span class="token function">detection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bool <span class="token function">iscallision</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span>mysprite<span class="token punctuation">,</span>CCSprite <span class="token operator">*</span>testsprite<span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCRect <span class="token function">getRect</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span>sprite<span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token comment">//触摸事件</span>

    virtual bool <span class="token function">ccTouchBegan</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    virtual <span class="token keyword">void</span> <span class="token function">ccTouchMoved</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    virtual <span class="token keyword">void</span> <span class="token function">ccTouchEnded</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    virtual <span class="token keyword">void</span> <span class="token function">ccTouchCancelled</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    

   

    <span class="token keyword">void</span> <span class="token function">goon</span><span class="token punctuation">(</span>CCNode <span class="token operator">*</span>pSender<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">toggleGame</span><span class="token punctuation">(</span>CCObject <span class="token operator">*</span>pSender<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">targetFinish</span><span class="token punctuation">(</span>CCNode <span class="token operator">*</span>pSender<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

（<span class="token number">2</span>）实现文件中
<span class="token comment">//</span>

<span class="token comment">//  AA.cpp</span>

<span class="token comment">//  date10</span>

<span class="token comment">//</span>

<span class="token comment">//  Created by Student on 14-9-22.</span>

<span class="token comment">//</span>

<span class="token comment">//</span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AA.h"</span></span>



CCScene <span class="token operator">*</span>AA<span class="token operator">::</span><span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    CCScene <span class="token operator">*</span>s<span class="token operator">=</span>CCScene<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    AA <span class="token operator">*</span>layer<span class="token operator">=</span>AA<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    s<span class="token operator">-&gt;</span><span class="token function">addChild</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> s<span class="token punctuation">;</span>

<span class="token punctuation">}</span>



bool AA<span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>CCLayer<span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">return</span> false<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    mode<span class="token operator">=</span>true<span class="token punctuation">;</span>

    <span class="token comment">//初始化数组</span>

    bulletArray <span class="token operator">=</span> CCArray<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bulletArray<span class="token operator">-&gt;</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    enemyArray <span class="token operator">=</span> CCArray<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    enemyArray<span class="token operator">-&gt;</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//加载瓦片地图</span>

    _tileMap<span class="token operator">=</span>CCTMXTiledMap<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"ThefirstTiled1.tmx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _tileMap<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span>mapPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">addChild</span><span class="token punctuation">(</span>_tileMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//读取瓦片地图中的层和对象</span>

    wall<span class="token operator">=</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">layerNamed</span><span class="token punctuation">(</span><span class="token string">"wall"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    foreground<span class="token operator">=</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">layerNamed</span><span class="token punctuation">(</span><span class="token string">"water"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCTMXObjectGroup <span class="token operator">*</span>objects<span class="token operator">=</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">objectGroupNamed</span><span class="token punctuation">(</span><span class="token string">"hero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCDictionary  <span class="token operator">*</span>spawnPoint<span class="token operator">=</span>objects<span class="token operator">-&gt;</span><span class="token function">objectNamed</span><span class="token punctuation">(</span><span class="token string">"pa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    heroPoint<span class="token punctuation">.</span>x<span class="token operator">=</span>spawnPoint<span class="token operator">-&gt;</span><span class="token function">valueForKey</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    heroPoint<span class="token punctuation">.</span>y<span class="token operator">=</span>spawnPoint<span class="token operator">-&gt;</span><span class="token function">valueForKey</span><span class="token punctuation">(</span><span class="token string">"y"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">CCLog</span><span class="token punctuation">(</span><span class="token string">"x=%f,y=%f"</span><span class="token punctuation">,</span>heroPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span>heroPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//加载英雄到界面</span>

    _player<span class="token operator">=</span>CCSprite<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"www.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _player<span class="token operator">-&gt;</span><span class="token function">setAnchorPoint</span><span class="token punctuation">(</span><span class="token function">CCPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _player<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span>heroPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

    _tileMap<span class="token operator">-&gt;</span><span class="token function">addChild</span><span class="token punctuation">(</span>_player<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//加载敌人到界面</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span>objects<span class="token operator">-&gt;</span><span class="token function">getObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//得到敌人的数量</span>

    <span class="token punctuation">{<!-- --></span>

        CCDictionary <span class="token operator">*</span>enemy<span class="token operator">=</span><span class="token punctuation">(</span>CCDictionary <span class="token operator">*</span><span class="token punctuation">)</span>objects<span class="token operator">-&gt;</span><span class="token function">getObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>enemy<span class="token operator">-&gt;</span><span class="token function">valueForKey</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token punctuation">{<!-- --></span>

            CCSprite <span class="token operator">*</span>s<span class="token operator">=</span>CCSprite<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"enemy1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">float</span> x<span class="token operator">=</span>enemy<span class="token operator">-&gt;</span><span class="token function">valueForKey</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">float</span> y<span class="token operator">=</span>enemy<span class="token operator">-&gt;</span><span class="token function">valueForKey</span><span class="token punctuation">(</span><span class="token string">"y"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            s<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            s<span class="token operator">-&gt;</span><span class="token function">setAnchorPoint</span><span class="token punctuation">(</span><span class="token function">CCPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _tileMap<span class="token operator">-&gt;</span><span class="token function">addChild</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            enemyArray<span class="token operator">-&gt;</span><span class="token function">addObject</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

            CCActionInterval <span class="token operator">*</span>move<span class="token operator">=</span>CCMoveBy<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token function">CCPoint</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">-</span>s<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">?</span><span class="token number">10</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">-</span>s<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">?</span><span class="token number">10</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//goon 表示不断的移动</span>

            CCFiniteTimeAction <span class="token operator">*</span>func<span class="token operator">=</span>CCCallFuncN<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span><span class="token function">callfuncN_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>goon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            s<span class="token operator">-&gt;</span><span class="token function">runAction</span><span class="token punctuation">(</span>CCSequence<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>move<span class="token punctuation">,</span>func<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//加载开关选项</span>

    CCMenuItem <span class="token operator">*</span>oon<span class="token punctuation">,</span><span class="token operator">*</span>ooff<span class="token punctuation">;</span>

    oon<span class="token operator">=</span>CCMenuItemImage<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"projectile-button-on.png"</span><span class="token punctuation">,</span><span class="token string">"projectile-button-on.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ooff<span class="token operator">=</span>CCMenuItemImage<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"projectile-button-off.png"</span><span class="token punctuation">,</span><span class="token string">"projectile-button-off.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCMenuItemToggle <span class="token operator">*</span>toggle<span class="token operator">=</span>CCMenuItemToggle<span class="token operator">::</span><span class="token function">createWithTarget</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span>

                                                                <span class="token function">menu_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>toggleGame<span class="token punctuation">)</span><span class="token punctuation">,</span>

                                                                ooff<span class="token punctuation">,</span>oon<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCMenu <span class="token operator">*</span>menu<span class="token operator">=</span>CCMenu<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>toggle<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    menu<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>oon<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>oon<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">addChild</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//加入触摸的单例</span>

   CCDirector<span class="token operator">::</span><span class="token function">sharedDirector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getTouchDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addTargetedDelegate</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//碰撞检测的调用</span>

    this<span class="token operator">-&gt;</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token function">schedule_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>detection<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    

    

    label<span class="token operator">=</span>CCLabelTTF<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token string">"Arial"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    label<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>CCDirector<span class="token operator">::</span><span class="token function">sharedDirector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getWinSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token operator">-</span>label<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>label<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">addChild</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">//表示敌人不断移动的距离</span>

<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">goon</span><span class="token punctuation">(</span>CCNode <span class="token operator">*</span>pSender<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    <span class="token function">CCLOG</span><span class="token punctuation">(</span><span class="token string">"goon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CCSprite <span class="token operator">*</span>s<span class="token operator">=</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span>pSender<span class="token punctuation">;</span>

    CCActionInterval <span class="token operator">*</span>move<span class="token operator">=</span>CCMoveBy<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token function">CCPoint</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">-</span>s<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">?</span><span class="token number">10</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">-</span>s<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">?</span><span class="token number">10</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCFiniteTimeAction <span class="token operator">*</span>func<span class="token operator">=</span>CCCallFuncN<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span><span class="token function">callfuncN_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>goon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    s<span class="token operator">-&gt;</span><span class="token function">runAction</span><span class="token punctuation">(</span>CCSequence<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>move<span class="token punctuation">,</span>func<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>



<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">toggleGame</span><span class="token punctuation">(</span>CCObject <span class="token operator">*</span>pSender<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    mode<span class="token operator">=</span>mode<span class="token operator">?</span>false<span class="token operator">:</span>true<span class="token punctuation">;</span>

<span class="token punctuation">}</span>



bool AA<span class="token operator">::</span><span class="token function">ccTouchBegan</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    beginPoint<span class="token operator">=</span>pTouch<span class="token operator">-&gt;</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>

<span class="token punctuation">}</span>



<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">ccTouchMoved</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    <span class="token comment">/*

    if(mode)

    {

        //得到先前的坐标（0，0）

        CCPoint PP=pTouch-&gt;getPreviousLocation();

        //得到当前的坐标

        CCPoint np=pTouch-&gt;getLocation();

        //两坐标相减

        CCPoint dp=ccpSub(np, PP);

        //向左为负 右侧为正

        if(_titleMap-&gt;getPosition().x+dp.x&gt;-480 &amp;&amp;  _titleMap-&gt;getPosition().x+dp.x&lt;0)

        {

            mapPoint=ccp(_titleMap-&gt;getPosition().x+dp.x,0);

            _titleMap-&gt;setPosition(mapPoint);

        }

    }

     */</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

        CCPoint pp<span class="token operator">=</span>pTouch<span class="token operator">-&gt;</span><span class="token function">getPreviousLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        CCPoint np<span class="token operator">=</span>pTouch<span class="token operator">-&gt;</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        CCPoint dp<span class="token operator">=</span><span class="token function">ccpSub</span><span class="token punctuation">(</span>np<span class="token punctuation">,</span>pp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        

        <span class="token keyword">if</span><span class="token punctuation">(</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span>dp<span class="token punctuation">.</span>x<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">480</span><span class="token operator">&amp;&amp;</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span>dp<span class="token punctuation">.</span>x<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token punctuation">{<!-- --></span>

            mapPoint<span class="token operator">=</span><span class="token function">ccp</span><span class="token punctuation">(</span>_tileMap<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span>dp<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _tileMap<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span>mapPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">ccTouchEnded</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    <span class="token comment">/*

     //地图里的坐标（0，0）是从左上角开始的

    步骤：

    1、判断是否点击

    2、判断点击的位置与英雄的位置的X,Y的差值     比较DX与DY的大小

    3、判断英雄的X做标要大于点击的X坐标  才能向左

    4、判断移动时是否撞击墙和移出地图外

     */</span>

   <span class="token comment">//获得点击的位置</span>

   

    <span class="token comment">/*

    CCPoint pp=pTouch-&gt;getLocation();

    if(mode)

    {

         //是点击不是滑动  在原地点击下又点击离开

        if(beginPoint.x==pp.x &amp;&amp; beginPoint.y==pp.y)//beginPoint是开始触摸的位置

        {

            //—player的位置

            CCPoint pt=_player-&gt;getPosition();

           //判断是否 x&gt;y

            if(fabs(pt.x-(pp.x-mapPoint.x))&gt;=fabs( pt.y-(pp.y-mapPoint.y))    )

            {

               点击点向左移动   英雄的X做标要大于点击的X坐标  才能向左

                if(pt.x&gt;=pp.x-mapPoint.x)

                {

                    

                    if(9-_player-&gt;getPosition().y/32&lt;10 &amp;&amp; 9-_player-&gt;getPosition().y/32&gt;=0&amp;&amp;

                       _player-&gt;getPosition().x/32-1&lt;50&amp;&amp;_player-&gt;getPosition().x/32-1&gt;=0&amp;&amp;

                       !(wall-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32-1,9-_player-&gt;getPosition().y/32))))//判断是否是地图外面，或者是不是墙

                    {

                        _player-&gt;setPosition(ccp(_player-&gt;getPosition().x-32,_player-&gt;getPosition().y));

                        if(foreground-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32)))

                        {

                            foreground-&gt;removeTileAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32));

                            count++;

                            CCString *temp=CCString::createWithFormat("%d",count);

                            label-&gt;setString(temp-&gt;getCString());

                        }

                    }

                    

                }

                else

                {

                    if(9-_player-&gt;getPosition().y/32&lt;10&amp;&amp;9-_player-&gt;getPosition().y/32&gt;=0&amp;&amp;_player-&gt;getPosition().x/32+1&lt;50&amp;&amp;_player-&gt;getPosition().x/32+1&gt;=0&amp;&amp;!(wall-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32+1,9-_player-&gt;getPosition().y/32))))

                    {

                        _player-&gt;setPosition(ccp(_player-&gt;getPosition().x+32,_player-&gt;getPosition().y));

                        if(foreground-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32)))

                        {

                            foreground-&gt;removeTileAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32));

count++;

                            CCString *temp=CCString::createWithFormat("%d",count);

                            label-&gt;setString(temp-&gt;getCString());

                        }

                    }

                    

                }

            }

            else

            {

                if(pt.y&gt;=pp.y-mapPoint.y)

                {

                    if(9-_player-&gt;getPosition().y/32+1&lt;10&amp;&amp;9-_player-&gt;getPosition().y/32+1&gt;=0&amp;&amp;_player-&gt;getPosition().x/32&lt;50&amp;&amp;_player-&gt;getPosition().x/32&gt;=0&amp;&amp;!(wall-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32+1))))

                    {

                        _player-&gt;setPosition(ccp(_player-&gt;getPosition().x,_player-&gt;getPosition().y-32));

                        if(foreground-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32)))

                        {

                            foreground-&gt;removeTileAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32));

count++;

                            CCString *temp=CCString::createWithFormat("%d",count);

                            label-&gt;setString(temp-&gt;getCString());

                        }

                    }

                }

                else

                {

                    if(9-_player-&gt;getPosition().y/32-1&lt;10&amp;&amp;9-_player-&gt;getPosition().y/32-1&gt;=0&amp;&amp;_player-&gt;getPosition().x/32&lt;50&amp;&amp;_player-&gt;getPosition().x/32&gt;=0&amp;&amp;!(wall-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32-1))))

                    {

                        _player-&gt;setPosition(ccp(_player-&gt;getPosition().x,_player-&gt;getPosition().y+32));

                        if(foreground-&gt;tileGIDAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32)))

                        {

                            foreground-&gt;removeTileAt(ccp(_player-&gt;getPosition().x/32,9-_player-&gt;getPosition().y/32));

count++;

                            CCString *temp=CCString::createWithFormat("%d",count);

                            label-&gt;setString(temp-&gt;getCString());

                        }

                    }

                    

                }

            }

            

        }

}

    else

{

CCSprite *s=CCSprite::create("Projectile.png");

s-&gt;setPosition(_player-&gt;getPosition());

_tileMap-&gt;addChild(s,4);

        bulletArray-&gt;addObject(s);

float dx=pp.x-_player-&gt;getPosition().x;

float dy=pp.y-_player-&gt;getPosition().y;

if(dx&gt;0)

{

float lx=32*30-_player-&gt;getPosition().x;

float ly=dy/dx*lx;

CCActionInterval *move=CCMoveBy::create(3,ccp(lx+s-&gt;getContentSize().width,ly));

CCFiniteTimeAction *ff=CCCallFuncN::create(this,callfuncN_selector(AA::targetFinish));

s-&gt;runAction(CCSequence::create(move,ff,NULL));

}

else

{

float lx=0-_player-&gt;getPosition().x;

float ly=dy/dx*lx;

CCActionInterval *move=CCMoveBy::create(3,ccp(lx-s-&gt;getContentSize().width,ly));

CCFiniteTimeAction *ff=CCCallFuncN::create(this,callfuncN_selector(AA::targetFinish));

s-&gt;runAction(CCSequence::create(move,ff,NULL));

}

}

    */</span>

    

   CCPoint pp<span class="token operator">=</span>pTouch<span class="token operator">-&gt;</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token comment">//移动</span>

<span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>beginPoint<span class="token punctuation">.</span>x<span class="token operator">==</span>pp<span class="token punctuation">.</span>x<span class="token operator">&amp;&amp;</span>beginPoint<span class="token punctuation">.</span>y<span class="token operator">==</span>pp<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

        <span class="token punctuation">{<!-- --></span>

            cocos2d<span class="token operator">::</span>CCPoint pt<span class="token operator">=</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//dx&gt;dy</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x<span class="token operator">-</span><span class="token punctuation">(</span>pp<span class="token punctuation">.</span>x<span class="token operator">-</span>mapPoint<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token function">fabs</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token punctuation">(</span>pp<span class="token punctuation">.</span>y<span class="token operator">-</span>mapPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//左移</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x<span class="token operator">&gt;=</span>pp<span class="token punctuation">.</span>x<span class="token operator">-</span>mapPoint<span class="token punctuation">.</span>x<span class="token punctuation">)</span>

                <span class="token punctuation">{<!-- --></span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&amp;&amp;</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>

                       _player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token number">50</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>

                       <span class="token operator">!</span><span class="token punctuation">(</span>wall<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//判断是否是地图外面，或者是不是墙  //tileGIDAt表示有没有的意思</span>

                    <span class="token punctuation">{<!-- --></span>

                        <span class="token comment">//32表示32个像素  表示向左挪动了1个单位</span>

                        _player<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                         <span class="token comment">//判断西瓜的和_player相撞</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span>foreground<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token punctuation">{<!-- --></span>

                            <span class="token comment">//西瓜的位置消失</span>

                            foreground<span class="token operator">-&gt;</span><span class="token function">removeTileAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            count<span class="token operator">++</span><span class="token punctuation">;</span>

                            CCString <span class="token operator">*</span>temp<span class="token operator">=</span>CCString<span class="token operator">::</span><span class="token function">createWithFormat</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            label<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span>temp<span class="token operator">-&gt;</span><span class="token function">getCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>

                <span class="token comment">//右移</span>

                <span class="token keyword">else</span>

                <span class="token punctuation">{<!-- --></span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&amp;&amp;</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token number">50</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token punctuation">(</span>wall<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token punctuation">{<!-- --></span>

                        _player<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span>foreground<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token punctuation">{<!-- --></span>

                            foreground<span class="token operator">-&gt;</span><span class="token function">removeTileAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

count<span class="token operator">++</span><span class="token punctuation">;</span>

                            CCString <span class="token operator">*</span>temp<span class="token operator">=</span>CCString<span class="token operator">::</span><span class="token function">createWithFormat</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            label<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span>temp<span class="token operator">-&gt;</span><span class="token function">getCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span>

                    

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

             <span class="token comment">//dx&lt;dy</span>

            <span class="token keyword">else</span>

            <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//下移</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y<span class="token operator">&gt;=</span>pp<span class="token punctuation">.</span>y<span class="token operator">-</span>mapPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

                <span class="token punctuation">{<!-- --></span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&amp;&amp;</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&lt;</span><span class="token number">50</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token punctuation">(</span>wall<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token punctuation">{<!-- --></span>

                        _player<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span>foreground<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token punctuation">{<!-- --></span>

                            foreground<span class="token operator">-&gt;</span><span class="token function">removeTileAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

count<span class="token operator">++</span><span class="token punctuation">;</span>

                            CCString <span class="token operator">*</span>temp<span class="token operator">=</span>CCString<span class="token operator">::</span><span class="token function">createWithFormat</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            label<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span>temp<span class="token operator">-&gt;</span><span class="token function">getCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>

                 <span class="token comment">//上移</span>

                <span class="token keyword">else</span>

                <span class="token punctuation">{<!-- --></span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&amp;&amp;</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&lt;</span><span class="token number">50</span><span class="token operator">&amp;&amp;</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token punctuation">(</span>wall<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    <span class="token punctuation">{<!-- --></span>

                        _player<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span>foreground<span class="token operator">-&gt;</span><span class="token function">tileGIDAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token punctuation">{<!-- --></span>

                            foreground<span class="token operator">-&gt;</span><span class="token function">removeTileAt</span><span class="token punctuation">(</span><span class="token function">ccp</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

count<span class="token operator">++</span><span class="token punctuation">;</span>

                            CCString <span class="token operator">*</span>temp<span class="token operator">=</span>CCString<span class="token operator">::</span><span class="token function">createWithFormat</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            label<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span>temp<span class="token operator">-&gt;</span><span class="token function">getCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span>

                    

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

            

        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

    <span class="token comment">//英雄发射子弹</span>

<span class="token keyword">else</span>

<span class="token punctuation">{<!-- --></span>

CCSprite <span class="token operator">*</span>s<span class="token operator">=</span>CCSprite<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Projectile.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

s<span class="token operator">-&gt;</span><span class="token function">setPosition</span><span class="token punctuation">(</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

_tileMap<span class="token operator">-&gt;</span><span class="token function">addChild</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        bulletArray<span class="token operator">-&gt;</span><span class="token function">addObject</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> dx<span class="token operator">=</span>pp<span class="token punctuation">.</span>x<span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>

<span class="token keyword">float</span> dy<span class="token operator">=</span>pp<span class="token punctuation">.</span>y<span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>dx<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

<span class="token keyword">float</span> lx<span class="token operator">=</span><span class="token number">32</span><span class="token operator">*</span><span class="token number">30</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>

<span class="token keyword">float</span> ly<span class="token operator">=</span>dy<span class="token operator">/</span>dx<span class="token operator">*</span>lx<span class="token punctuation">;</span>

CCActionInterval <span class="token operator">*</span>move<span class="token operator">=</span>CCMoveBy<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">ccp</span><span class="token punctuation">(</span>lx<span class="token operator">+</span>s<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>ly<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CCFiniteTimeAction <span class="token operator">*</span>ff<span class="token operator">=</span>CCCallFuncN<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span><span class="token function">callfuncN_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>targetFinish<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

s<span class="token operator">-&gt;</span><span class="token function">runAction</span><span class="token punctuation">(</span>CCSequence<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>move<span class="token punctuation">,</span>ff<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">else</span>

<span class="token punctuation">{<!-- --></span>

<span class="token keyword">float</span> lx<span class="token operator">=</span><span class="token number">0</span><span class="token operator">-</span>_player<span class="token operator">-&gt;</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>

<span class="token keyword">float</span> ly<span class="token operator">=</span>dy<span class="token operator">/</span>dx<span class="token operator">*</span>lx<span class="token punctuation">;</span>

CCActionInterval <span class="token operator">*</span>move<span class="token operator">=</span>CCMoveBy<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">ccp</span><span class="token punctuation">(</span>lx<span class="token operator">-</span>s<span class="token operator">-&gt;</span><span class="token function">getContentSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>ly<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CCFiniteTimeAction <span class="token operator">*</span>ff<span class="token operator">=</span>CCCallFuncN<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span><span class="token function">callfuncN_selector</span><span class="token punctuation">(</span>AA<span class="token operator">::</span>targetFinish<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

s<span class="token operator">-&gt;</span><span class="token function">runAction</span><span class="token punctuation">(</span>CCSequence<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>move<span class="token punctuation">,</span>ff<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>



<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">targetFinish</span><span class="token punctuation">(</span>CCNode <span class="token operator">*</span>pSender<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    pSender<span class="token operator">-&gt;</span><span class="token function">removeFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">ccTouchCancelled</span><span class="token punctuation">(</span>CCTouch <span class="token operator">*</span>pTouch<span class="token punctuation">,</span> CCEvent <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>



<span class="token punctuation">}</span>

<span class="token comment">//碰撞检测</span>

<span class="token keyword">void</span> AA<span class="token operator">::</span><span class="token function">detection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    <span class="token comment">/*

     1、英雄与敌人碰撞

     2、子弹与敌人碰撞

     */</span>

    <span class="token comment">//遍历敌人</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>enemyArray<span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>

    <span class="token punctuation">{<!-- --></span>

        CCSprite <span class="token operator">*</span>s<span class="token operator">=</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span>enemyArray<span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//判断英雄是否和敌人碰撞</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">iscallision</span><span class="token punctuation">(</span>_player<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token punctuation">{<!-- --></span>

            <span class="token function">CCLog</span><span class="token punctuation">(</span><span class="token string">"--------aaaaaaaa-------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//创建临时的数组</span>

    CCArray <span class="token operator">*</span>bulletA<span class="token operator">=</span>CCArray<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCArray <span class="token operator">*</span>enemyA<span class="token operator">=</span>CCArray<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//遍历子弹</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>bulletArray<span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>

    <span class="token punctuation">{<!-- --></span>

        CCSprite <span class="token operator">*</span>bullet<span class="token operator">=</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span>bulletArray<span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历敌人</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>enemyArray<span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>

        <span class="token punctuation">{<!-- --></span>

            CCSprite <span class="token operator">*</span>enemy<span class="token operator">=</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span>enemyArray<span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//判断子弹是否和敌人相撞</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">iscallision</span><span class="token punctuation">(</span>bullet<span class="token punctuation">,</span> enemy<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//这里移除后应该加入数组  否则会崩溃</span>

                enemy<span class="token operator">-&gt;</span><span class="token function">removeFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                bullet<span class="token operator">-&gt;</span><span class="token function">removeFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                bulletA<span class="token operator">-&gt;</span><span class="token function">addObject</span><span class="token punctuation">(</span>bullet<span class="token punctuation">)</span><span class="token punctuation">;</span>

                enemyA<span class="token operator">-&gt;</span><span class="token function">addObject</span><span class="token punctuation">(</span>enemy<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//从数组中移除子弹</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>bulletA<span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>

    <span class="token punctuation">{<!-- --></span>

        CCSprite <span class="token operator">*</span>bullet <span class="token operator">=</span> <span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span> bulletA<span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        bulletArray<span class="token operator">-&gt;</span><span class="token function">removeObject</span><span class="token punctuation">(</span>bullet<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

     <span class="token comment">//从数组中移除敌人</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>enemyA<span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>

    <span class="token punctuation">{<!-- --></span>

        CCSprite <span class="token operator">*</span>enemy <span class="token operator">=</span> <span class="token punctuation">(</span>CCSprite <span class="token operator">*</span><span class="token punctuation">)</span> enemyA<span class="token operator">-&gt;</span><span class="token function">objectAtIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        enemyArray<span class="token operator">-&gt;</span><span class="token function">removeObject</span><span class="token punctuation">(</span>enemy<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//碰撞检测</span>

bool AA<span class="token operator">::</span><span class="token function">iscallision</span><span class="token punctuation">(</span>CCSprite <span class="token operator">*</span>mysprite<span class="token punctuation">,</span>CCSprite <span class="token operator">*</span>testsprite<span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>

    CCRect myrect<span class="token operator">=</span>mysprite<span class="token operator">-&gt;</span><span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    CCRect testrect<span class="token operator">=</span>testsprite<span class="token operator">-&gt;</span><span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> myrect<span class="token punctuation">.</span><span class="token function">intersectsRect</span><span class="token punctuation">(</span>testrect<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>











<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
©著作权归作者所有：来自<span class="token number">51</span>CTO博客作者春蕾夏荷的原创作品，请联系作者获取转载授权，否则将追究法律责任
Cocos2d<span class="token operator">-</span>X 瓦片地图使用的实例项目（包含碰撞检测，移动）
https<span class="token operator">:</span><span class="token comment">//blog.51cto.com/u_10486491/3217098</span>
</code></pre> 
<h3><a id="_1426"></a>二、武林风云录</h3> 
<h4><a id="1dps_1427"></a>1）老一：陈斩槐（只有四个机制，dps压力不大，留爆发打影子就行）</h4> 
<h5><a id="1_1428"></a>（1）点名红色扇形区域</h5> 
<p><img src="https://images2.imgbox.com/67/71/BtAEJ6H3_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_1430"></a>（2）点名红色长条，注意最后还有一段大劈</h5> 
<p><img src="https://images2.imgbox.com/4d/8a/7UgkC9CB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1c/eb/czUG2h31_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3BOSS80_5020_1433"></a>（3）BOSS在百分之80 、50、20血量时会击退玩家，会刷新三个输出位置</h5> 
<ul><li>应对策略<br> 需要三个输出职业进入篮圈击杀影子</li><li>注意点<br> ①每个篮圈只能进一个人，<br> ②如果没在<code>30s</code>内击杀影子，影子会爆炸，BOSS将释放<code>地图炮</code>导致团灭<br> ③进去打影子的队友，奶妈是奶不了的，需要躲好红圈，躲不了平A<br> <img src="https://images2.imgbox.com/d9/cb/m8BW05oF_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="4BOSS35_1441"></a>（4）BOSS在百分之35血时会吸玩家到其周围，释放旋风斩，得交解控技能。但是不要着急回去，还有一个圆圈的下坠伤害</h5> 
<p><img src="https://images2.imgbox.com/3a/88/HFOLFQL5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c6/75/y8QU9DCY_o.png" alt="在这里插入图片描述"></p> 
<ul><li>额外注意<br> boss释放完技能后原地会生成一个龙卷风，靠近会暴毙，需要T尽可能的往副本初始位置拉boss<br> <img src="https://images2.imgbox.com/21/ee/4oTB4Tyz_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="2_1447"></a>2）老二：醉仙</h4> 
<ul><li>机制讲解<br> boss是软狂暴boss，每一次喝酒都会叠加后劲不足buff，叠加到12层后会一直放技能而不会平A，解茶小厮也不会出现<br> <img src="https://images2.imgbox.com/c4/2a/qSMK6W55_o.png" alt="在这里插入图片描述"></li><li>备注<br> ①奶妈一定要切天问，打好飘絮给boss百分之25增伤<br> <img src="https://images2.imgbox.com/e2/49/x6zr1UaL_o.png" alt="在这里插入图片描述"><br> ②四个输出位置平均喝酒后需要3w的秒伤，T是第二轮供酒可以喝，不然吸引不了仇恨<br> <img src="https://images2.imgbox.com/2d/e3/0SB8r6rA_o.png" alt="在这里插入图片描述"><br> ③奶妈不要喝酒<br> ④喝酒叠加的buff不要满了，否则点名必死<br> <img src="https://images2.imgbox.com/ea/e0/z1mN39t2_o.png" alt="在这里插入图片描述"><br> ⑤小二都刷新在周边，需要把boss往中心拉否则容易误伤小二</li></ul> 
<h5><a id="1_1461"></a>（1）红圈和点名略过</h5> 
<p><img src="https://images2.imgbox.com/3e/2c/7uwAK5Os_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_1463"></a>（2）输出记得喝酒（龙吟内功，铁衣外功等）</h5> 
<p><img src="https://images2.imgbox.com/97/aa/ZyKTgB3k_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_1465"></a>（3）每一个奉茶小厮都有名字，得按照诗词来按照顺序击杀小二</h5> 
<p><img src="https://images2.imgbox.com/fe/f0/pSfRcuaf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_1467"></a>3）老三：楚相玉</h4> 
<ul><li>备注<br> ①老三技能不按照顺序，有时得同时处理多个boss</li></ul> 
<h5><a id="1boss360s12Wdps_1471"></a>（1）boss有狂暴机制，冰火玄功达到极致，倒数360s，将直接团灭（人均得有1.2Wdps）</h5> 
<p><img src="https://images2.imgbox.com/d6/c5/O6AzlPHj_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="205s_1473"></a>（2）地上出现红圈，0.5s后将冒出冰柱，击飞造成一段伤害，落地造成二段伤害（估计代码是设计成击飞后掉落下来还在圆圈内）</h5> 
<p><img src="https://images2.imgbox.com/7b/fe/AFUjZauS_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3T_1475"></a>（3）点名T红色长条，多段伤害</h5> 
<p><img src="https://images2.imgbox.com/1e/3f/pkoZ87dh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a7/59/ftxLPiue_o.png" alt="在这里插入图片描述"></p> 
<ul><li>备注<br> 若红条击中冰柱，则冰柱直接消失<br> <img src="https://images2.imgbox.com/c9/55/LZqEvDaf_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="4_1481"></a>（4）烈焰焚身，需要交减伤或无敌规避伤害</h5> 
<p><img src="https://images2.imgbox.com/b9/bd/FAgBDYWr_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_1483"></a>（5）冰风火凤融合产生圆形爆炸区域</h5> 
<p><img src="https://images2.imgbox.com/6d/4a/sbrMHNEo_o.png" alt="在这里插入图片描述"></p> 
<ul><li>应对<br> 铁衣或神像击飞或吹走</li></ul> 
<h5><a id="6_1488"></a>（6）赤炎寒光破</h5> 
<p>全图玩家都被吸附到boss周围，得躲到冰柱后面，注意得站在冰柱后面，否则服务器判断坐标和冰柱重合或稍微飘逸，则会死亡，这很坑爹<br> <img src="https://images2.imgbox.com/36/33/xhyc1WlP_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="7_1491"></a>（7）暴风雪</h5> 
<p>得站在地图的火焰点处<br> <img src="https://images2.imgbox.com/27/93/8YqUUZ7V_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_1497"></a>4）老四：刀狂</h4> 
<h5><a id="1_1498"></a>（1）略过半圆斩、三段长条大劈、落地红圈、黑水机制不在赘述</h5> 
<p><img src="https://images2.imgbox.com/c5/7f/BNHXHLCh_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="290bossboss_1500"></a>（2）达到百分之90血时，地上出现追忆碎片，分内外场地（血河上马溜boss，需要奶妈往返内网场用追忆碎片奶安抚boss并奶白剑）</h5> 
<p><img src="https://images2.imgbox.com/3e/2e/aPVPV89c_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3100_1503"></a>（3）刀狂有怒气机制，到百分之100时增加移速和攻击力</h5> 
<p><img src="https://images2.imgbox.com/7d/56/bhkr5oOJ_o.png" alt="在这里插入图片描述"><br> 内场会出现安抚之力，需要奶妈拾取<br> <img src="https://images2.imgbox.com/9e/14/yBQnlF1u_o.png" alt="在这里插入图片描述"><br> 对boss使用安抚之力，boss怒气值清零，地上将会掉落<code>追忆草</code>，失去后增加玩家治疗量<br> <img src="https://images2.imgbox.com/fc/1a/STUVKQi2_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_1509"></a>（4）内场讲解</h5> 
<blockquote> 
 <p>内场将会有白剑npc和各种小怪</p> 
</blockquote> 
<p>白剑：场中npc，需要玩家治疗她，奶满后击败boss后通关<br> <img src="https://images2.imgbox.com/6b/d2/RqoKkVLy_o.png" alt="在这里插入图片描述"><br> 小怪：集火秒掉就行</p> 
<blockquote> 
 <p>嗔：打死后出现追忆碎片，使用后出现治疗圆圈，可以治疗玩家和白剑<br> 痴：减疗怪<br> 狂：秒人怪<br> 贪：会回血，且会吃掉场上没被使用的追忆碎片</p> 
</blockquote> 
<h3><a id="_1521"></a>三、舞阳城</h3> 
<h4><a id="1_1524"></a>1）老一：黑天尊使</h4> 
<h5><a id="1BOSSdebuff_1525"></a>（1）攻击BOSS会叠加debuff原理及解决方法</h5> 
<ul><li>代码机制<br> ①boss<code>被击事件</code>：在攻击怪物对象，若该被击obj类型是boss类型，则读表若boss有对应被击事件，则<code>触发对应事件</code>，这个事件是叠加某个debuff<br> ②传功<code>黑雾事件</code>：内外功相互传功后，定时器几秒后产生黑雾（黑雾是特效），实际上在传功这个消息到服务器后，服务器启发一个几秒的定时器，这个定时器几秒后对一个圆形范围内玩家进行伤害，可能有多段定时器，一个定时器触发另外一个定时器，一步步增大范围</li><li>debuff对应的作用<br> 攻击频率越高叠加越快，超过<code>20层开始持续掉血，层数越高掉血越快</code></li><li>解决方法<br> ①需要20层以上的内外功职业互相按F清零层数，传功完地上会出现黑雾造成大量伤害要马上原理<br> 还有一种方法是所有都20层后，去一个敌方站在一起，团长倒数321一起按F一起出<br> <img src="https://images2.imgbox.com/8a/85/gYtwxPkV_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="2BOSS_1536"></a>（2）BOSS怒气机制</h5> 
<ul><li>怒气基本机制<br> boss遭受任何<code>被击事件</code>都会涨怒气，而怒气达到百分之百又会<code>触发</code>解锁<code>新技能这个事件</code><br> <img src="https://images2.imgbox.com/d0/2e/BGCh4MZx_o.png" alt="在这里插入图片描述"></li></ul> 
<h6><a id="1_1541"></a>1、一阶段</h6> 
<ul><li> <p>描述<br> 开局boss怒气是满的，只会平A</p> </li><li> <p>一阶段技能<br> 开怪20秒后，BOSS怒气清零，学会技能：<code>红圈砸地</code>、<code>红盾</code><br> <img src="https://images2.imgbox.com/ee/31/ehR8HYv7_o.png" alt="在这里插入图片描述"></p> </li><li> <p>技能说明<br> ①<code>红圈</code>：红圈要躲，飘字广播给玩家后，定时器几秒在地上出现红圈秒杀圆形范围内玩家<br> <img src="https://images2.imgbox.com/22/26/3cXVIxUM_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<p>②<code>红盾</code>：红盾出现要在boss后面输出，在前面会被反弹以及破招，但是<code>外功职业的输出可以破盾</code>，不破盾内功伤害会变得非常低（boss的盾其实也算是一种类似血量的属性，加盾其实也是加了一层减少伤害的BUFF）<br> <img src="https://images2.imgbox.com/95/24/OOCpAtuW_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2_1555"></a>2、二阶段</h6> 
<ul><li>解锁技能<br> <code>飞爪</code></li><li>技能说明<br> ①<code>飞爪</code>：随机跳抓一个人，抓到人技能会在抓到人的地点多次砸地造成AOE伤害</li><li>解决方法<br> 所有人轻功跳/燕回风/位移技能躲避</li><li>躲避成功<br> 若BOSS没抓到人，会进入虚弱状态（其实也是加了定时器，技能触发结束会有个定时器去判断是否抓到人）</li></ul> 
<p><img src="https://images2.imgbox.com/ba/ac/vJR1Yo4u_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3_1567"></a>3、三阶段</h6> 
<ul><li>解锁技能<br> <code>吸人</code></li><li>解决方法<br> 需要远程往吸的范围内打技能，奶妈在吸里卖弄解控+扶风即可破掉</li><li>破掉吸人触发对应事件<br> 若是第一次，则给boss触发虚弱状态</li><li>若技能到期没被破掉<br> 若没被破掉就会原地抓人，造成AOE</li></ul> 
<h6><a id="4_1578"></a>4、四阶段</h6> 
<ul><li>解锁技能<br> <code>反噬煞气</code></li><li>技能说明<br> 战斗一定事件后BOSS会条上天全屏秒杀，可以跳跃躲避</li></ul> 
<h4><a id="2_1584"></a>2）老二：火焰围攻（机制说明）</h4> 
<p>①轻功跳跃会被飞针扎下来，并被定身+封脉，所以<code>老二不要跳</code><br> ②神像冰系技能(神像)和<code>荒城剑气</code>(奇遇)灭火，副本里面的荒城剑气CD会变成1分钟而不是24小时<br> ③打怪死后得用火系技能烧尸体(<code>神像平A</code>和火技能、<code>血河烈焰枪</code>、<code>铁艺炼火拳</code>等)<br> ④<code>火器攻击</code>得躲,截图里面的绿点和蓝点是安全点位，不会被火器轰击到<br> <img src="https://images2.imgbox.com/e0/a2/0fXGG2rR_o.png" alt="在这里插入图片描述"></p> 
<p>⑤不要在地图边缘和台阶下面打，会被炸弹炸到<br> ⑥<code>飞针</code>英雄服务器是连续扎四下并定身，灭了火进白雾也无法规避，但可以用无敌技能卡规避，被飞针命中的玩家技能会有<code>Debuff：受到火属性伤害提升</code><br> <img src="https://images2.imgbox.com/b2/b6/LnvSqi1z_o.png" alt="在这里插入图片描述"></p> 
<p>⑦副本倒计时158s会有一只<code>屠百怪</code>从天上劈下造成范围AOE伤害，得<code>一直用血河的击飞</code>或其他职业的<code>击飞技能</code><br> <img src="https://images2.imgbox.com/05/3b/2FOZbNB5_o.png" alt="在这里插入图片描述"></p> 
<p>⑧最后三只怪会释放黑雾，黑雾内玩家打怪会失手以及被压制，所有人远离让怪出来再打即可</p> 
<h4><a id="3_1604"></a>3）老三：药人战</h4> 
<h4><a id="4_1606"></a>4）老四：红衣尊使</h4> 
<h4><a id="5_1608"></a>5）老五：雷音尊使</h4> 
<h4><a id="6_1610"></a>6）老六：薛魔主</h4>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbaf2773871ace25a9cfc24c1a11c849/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如果我想使用esp32-S3-eye连接的homkit上，我应该怎么做</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/18c4e5f22fd7af4e04e546587c4f578f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java控制台模拟抢红包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>