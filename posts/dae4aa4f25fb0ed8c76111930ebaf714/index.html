<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pytorch实现：卷积神经网络识别FashionMNIST - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pytorch实现：卷积神经网络识别FashionMNIST" />
<meta property="og:description" content="pytorch实现：卷积神经网络识别FashionMNIST 一、卷积神经网络1.1 导入需要的包1.2 图像数据准备1.3 卷积神经网络搭建1.4 卷积神经网络训练与预测 二、空洞卷积神经网络2.1 空洞卷积神经网络搭建2.2 空洞卷积网络预测 一、卷积神经网络 1.1 导入需要的包 对于moduleNotFoundError: No module named ‘pandas’等情况发生时，需要在Anaconda Prompt下进入pytorch（activate pytorch）环境，然后conda install pandas即可。（采用pip安装会报错，但也可以尝试）
import pandas as pd import numpy as np import matplotlib.pyplot as plt import seaborn as sns import copy import time import torch import torch.nn as nn import torch.utils.data as Data from sklearn.metrics import accuracy_score, confusion_matrix, classification_report from torch.optim import Adam from torchvision.datasets import FashionMNIST from torchvision import transforms import warnings warnings." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/dae4aa4f25fb0ed8c76111930ebaf714/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-21T11:37:03+08:00" />
<meta property="article:modified_time" content="2022-04-21T11:37:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pytorch实现：卷积神经网络识别FashionMNIST</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>pytorch实现：卷积神经网络识别FashionMNIST</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、卷积神经网络</a></li><li><ul><li><a href="#11__2" rel="nofollow">1.1 导入需要的包</a></li><li><a href="#12__23" rel="nofollow">1.2 图像数据准备</a></li><li><a href="#13__81" rel="nofollow">1.3 卷积神经网络搭建</a></li><li><a href="#14__139" rel="nofollow">1.4 卷积神经网络训练与预测</a></li></ul> 
  </li><li><a href="#_273" rel="nofollow">二、空洞卷积神经网络</a></li><li><ul><li><a href="#21____274" rel="nofollow">2.1 空洞卷积神经网络搭建</a></li><li><a href="#22__334" rel="nofollow">2.2 空洞卷积网络预测</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、卷积神经网络</h2> 
<h3><a id="11__2"></a>1.1 导入需要的包</h3> 
<p>对于moduleNotFoundError: No module named ‘pandas’等情况发生时，需要在Anaconda Prompt下进入pytorch（activate pytorch）环境，然后conda install pandas即可。（采用pip安装会报错，但也可以尝试）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> copy
<span class="token keyword">import</span> time
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> Data
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> confusion_matrix<span class="token punctuation">,</span> classification_report
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> Adam
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> FashionMNIST
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span> <span class="token comment">#忽略warning</span>
</code></pre> 
<h3><a id="12__23"></a>1.2 图像数据准备</h3> 
<p>train_data=FashionMNIST(root=‘./data/FashionMNIST’, train=True, transform=transforms.ToTensor(), download=True) #第一次运行时，需要将download设置为True</p> 
<pre><code class="prism language-python">train_data<span class="token operator">=</span>FashionMNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data/FashionMNIST'</span><span class="token punctuation">,</span>
                        train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                        transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        download<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
test_data<span class="token operator">=</span>FashionMNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data/FashionMNIST'</span><span class="token punctuation">,</span> <span class="token comment">#数据路径</span>
                        train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                        transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#装换成tensor变量</span>
                        download<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment">#已经下载过了，不需要下载</span>
<span class="token comment">#为数据添加一个通道维度，将数据缩放到0-1</span>
test_data_x<span class="token operator">=</span>test_data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">255.0</span>
test_data_x<span class="token operator">=</span>torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>test_data_x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_data_y<span class="token operator">=</span>test_data<span class="token punctuation">.</span>targets
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test_data_x.shape:'</span><span class="token punctuation">,</span> test_data_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test_data_y.shape:'</span><span class="token punctuation">,</span> test_data_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment">#结果</span>
test_data_x<span class="token punctuation">.</span>shape<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_data_y<span class="token punctuation">.</span>shape<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#定义一个数据加载器</span>
train_loader<span class="token operator">=</span>Data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>train_data<span class="token punctuation">,</span>
                             batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
                             shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                             num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
test_loader<span class="token operator">=</span>Data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>test_data<span class="token punctuation">,</span>
                             batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
                             shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                             num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'train_loader的batch数量为：'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#显示batch的数量</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test_loader的batch数量为：'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_loader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#显示batch的数量</span>
<span class="token comment">#结果</span>
train_loader的batch数量为： <span class="token number">938</span>
test_loader的batch数量为： <span class="token number">157</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#获得一个batch的数据，进行可视化</span>
<span class="token keyword">for</span> step<span class="token punctuation">,</span> <span class="token punctuation">(</span>b_x<span class="token punctuation">,</span> b_y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> step<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token comment">#可视化batch数据</span>
    batch_x<span class="token operator">=</span>b_x<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    batch_y<span class="token operator">=</span>b_y<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    class_label<span class="token operator">=</span>train_data<span class="token punctuation">.</span>classes
    class_label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T-shirt'</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>batch_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>batch_x<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>gray<span class="token punctuation">)</span> <span class="token comment">#灰度图</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>class_label<span class="token punctuation">[</span>batch_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span><span class="token comment">#关闭坐标轴</span>
        plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>wspace<span class="token operator">=</span><span class="token number">.05</span><span class="token punctuation">)</span> <span class="token comment">#调节子图之间的横轴之间的间距</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/ee/rLJ6eUmA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13__81"></a>1.3 卷积神经网络搭建</h3> 
<p>网络结构为：</p> 
<p>impute images–&gt;16个3<em>3卷积核，relu激活函数，平均池化AvgPool2d–&gt;32个3</em>3卷积核，relu激活函数，平均池化AvgPool2d–&gt;全连接层，256个神经元–&gt;全连接层，128个神经元–&gt;输出层，10个神经元。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MyConvNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MyConvNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token comment">#super().__init__()，就是继承父类的init方法，同样可以使用super().其他方法名，去继承父类其他方法。</span>
        <span class="token comment">#super(MyConvNet,self).__init__()：首先找到MyConvNet的父类，然后将MyConvNet类的对象转化为父类的对象</span>
        <span class="token comment">#然后让这个"被转化"的对象调用自己的__init__()函数。</span>
        
        <span class="token comment">## 定义第一层卷积层</span>
        self<span class="token punctuation">.</span>conv1<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>
                                           in_channels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">#输入的一张图片</span>
                                           out_channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token comment">#输出通道为16</span>
                                           kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">#卷积核尺寸</span>
                                           stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">#卷积步长</span>
                                           padding<span class="token operator">=</span><span class="token number">1</span> <span class="token comment">#进行填充</span>
                                 <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">## 卷积后: (1*28*28)→(16*28*28)</span>
                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">## 激活函数</span>
                                 nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span>
                                              kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">#平均池化，池化窗口为2*2，步长为2</span>
                                              stride<span class="token operator">=</span><span class="token number">2</span> <span class="token comment">#池化步长为2</span>
                                 <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">##池化后：(16*28*28)→(16*14*14)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">## 定义第二层卷积层</span>
        self<span class="token punctuation">.</span>conv2<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 卷积后：(16*14*14)→(32*12*12)</span>
                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">##激活函数</span>
                                 nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">##池化后：(32*12*12)→(32*6*6)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">## 定义全连接层</span>
        self<span class="token punctuation">.</span>classifier<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">*</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
    <span class="token comment">## 定义前向传播网络</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x<span class="token operator">=</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x<span class="token operator">=</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x<span class="token operator">=</span>x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">##展平层</span>
        output<span class="token operator">=</span>self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output

<span class="token comment">## 输出网络结构</span>
myconvnet<span class="token operator">=</span>MyConvNet<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>myconvnet<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/48/b5/hT4jgQkS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14__139"></a>1.4 卷积神经网络训练与预测</h3> 
<pre><code class="prism language-python"><span class="token comment">#定义网络训练过程函数</span>
<span class="token keyword">def</span> <span class="token function">train_model</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> train_data_loader<span class="token punctuation">,</span> train_rate<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> num_opochs<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    #model：网络模型
    #train_data_loader：训练数据集，分为训练集和验证集
    #train_rate：训练集batchsize百分比
    #criterion：损失函数
    #optimizer：优化防范
    #num_opochs：训练轮次
    '''</span>
    <span class="token comment">##计算训练使用的batch数量</span>
    batch_num<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_data_loader<span class="token punctuation">)</span>
    train_batch_num<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>batch_num<span class="token operator">*</span>train_rate<span class="token punctuation">)</span>
    
    <span class="token comment">##复制模型参数</span>
    best_model_paras<span class="token operator">=</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    best_acc<span class="token operator">=</span><span class="token number">0.0</span>
    train_loss_all<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    train_acc_all<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    val_loss_all<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    val_acc_all<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    since<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_opochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> num_opochs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token comment">##每个epoch有2个训练阶段</span>
        train_loss<span class="token operator">=</span><span class="token number">0.0</span>
        train_corrects<span class="token operator">=</span><span class="token number">0</span>
        train_num<span class="token operator">=</span><span class="token number">0</span>
        val_loss<span class="token operator">=</span><span class="token number">0.0</span>
        val_corrects<span class="token operator">=</span><span class="token number">0</span>
        val_num<span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> step<span class="token punctuation">,</span> <span class="token punctuation">(</span>b_x<span class="token punctuation">,</span> b_y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_data_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> step<span class="token operator">&lt;</span>train_batch_num<span class="token punctuation">:</span>
                model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">##设置模型为训练模式</span>
                output<span class="token operator">=</span>model<span class="token punctuation">(</span>b_x<span class="token punctuation">)</span> <span class="token comment">#进行预测</span>
                pre_lab<span class="token operator">=</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#返回output每行的最大索引，即求出预测的类别</span>
                loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> b_y<span class="token punctuation">)</span> <span class="token comment">#计算loss</span>
                optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#梯度初始化为零</span>
                loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#反向传播求梯度</span>
                optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#更新所有参数</span>
                train_loss<span class="token operator">+=</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>b_x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#.item()方法得到张量中元素值</span>
                train_corrects<span class="token operator">+=</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>pre_lab<span class="token operator">==</span>b_y<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">#计算预测正确的个数</span>
                train_num<span class="token operator">+=</span>b_x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#训练样本个数</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#设置模型为评估模式，即进入预测模式</span>
                output<span class="token operator">=</span>model<span class="token punctuation">(</span>b_x<span class="token punctuation">)</span>
                pre_lab<span class="token operator">=</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> b_y<span class="token punctuation">)</span>
                val_loss<span class="token operator">+=</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>b_x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                val_corrects<span class="token operator">+=</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>pre_lab<span class="token operator">==</span>b_y<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                val_num<span class="token operator">+=</span>b_x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            
        <span class="token comment">## 计算一个epoch在训练集和验证集上的损失和精度</span>
        train_loss_all<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_loss<span class="token operator">/</span>train_num<span class="token punctuation">)</span>
        train_acc_all<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_corrects<span class="token punctuation">.</span>double<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>train_num<span class="token punctuation">)</span>
        val_loss_all<span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_loss<span class="token operator">/</span>val_num<span class="token punctuation">)</span>
        val_acc_all<span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_corrects<span class="token punctuation">.</span>double<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>val_num<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} Train Loss: {:.4f}  Train Acc: {:.4f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> train_loss_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> train_acc_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} Val Loss: {:.4f}  Val Acc: {:.4f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> val_loss_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> val_acc_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment">## 拷贝模型最高精度下的参数</span>
        <span class="token keyword">if</span> val_loss_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>best_acc<span class="token punctuation">:</span>
            best_acc<span class="token operator">=</span>val_loss_all<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            best_model_paras<span class="token operator">=</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time_use<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>since
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Train and val complete in {:.0f}m {:.0f}s'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time_use<span class="token operator">//</span><span class="token number">60</span><span class="token punctuation">,</span> time_use<span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">## 使用最好的模型参数</span>
    model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>best_model_paras<span class="token punctuation">)</span>
    train_process<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'epoch'</span><span class="token punctuation">:</span><span class="token builtin">range</span><span class="token punctuation">(</span>num_opochs<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     <span class="token string">'train_loss_all'</span><span class="token punctuation">:</span>train_loss_all<span class="token punctuation">,</span>
                                     <span class="token string">'val_loss_all'</span><span class="token punctuation">:</span>val_loss_all<span class="token punctuation">,</span>
                                     <span class="token string">'train_acc_all'</span><span class="token punctuation">:</span>train_acc_all<span class="token punctuation">,</span>
                                     <span class="token string">'val_acc_all'</span><span class="token punctuation">:</span>val_acc_all<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> model<span class="token punctuation">,</span> train_process
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#对模型进行训练</span>
optimizer<span class="token operator">=</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>myconvnet<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">.0003</span><span class="token punctuation">)</span>
criterion<span class="token operator">=</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#损失函数</span>
myconvnet<span class="token punctuation">,</span> train_process<span class="token operator">=</span>train_model<span class="token punctuation">(</span>myconvnet<span class="token punctuation">,</span> train_loader<span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> num_opochs<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/d0/nMSJq2Pp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">## 可视化训练过程</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>train_loss_all<span class="token punctuation">,</span> <span class="token string">'ro-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Train loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>val_loss_all<span class="token punctuation">,</span> <span class="token string">'bs-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'epoch'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>train_acc_all<span class="token punctuation">,</span> <span class="token string">'ro-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>val_acc_all<span class="token punctuation">,</span> <span class="token string">'bs-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'epoch'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'acc'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/1d/75KzFfnk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">##对测试集进行测试，并可视化预测效果</span>
myconvnet<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
output<span class="token operator">=</span>myconvnet<span class="token punctuation">(</span>test_data_x<span class="token punctuation">)</span>
pre_lab<span class="token operator">=</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
acc<span class="token operator">=</span>accuracy_score<span class="token punctuation">(</span>test_data_y<span class="token punctuation">,</span> pre_lab<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'在测试集上的预测精度为：'</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span>
<span class="token comment">#结果</span>
在测试集上的预测精度为： <span class="token number">0.7877</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#计算混淆矩阵并可视化</span>
conf_mat<span class="token operator">=</span>confusion_matrix<span class="token punctuation">(</span>test_data_y<span class="token punctuation">,</span> pre_lab<span class="token punctuation">)</span>
df_cm<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>conf_mat<span class="token punctuation">,</span> index<span class="token operator">=</span>class_label<span class="token punctuation">,</span> columns<span class="token operator">=</span>class_label<span class="token punctuation">)</span>
heatmap<span class="token operator">=</span>sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>df_cm<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'YlGnBu'</span><span class="token punctuation">)</span> <span class="token comment">#annot=True显示数字, fmt='d'格式设置，以整数形式显示, cmap='YlGnBu'颜色</span>
heatmap<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span>heatmap<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>get_ticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
heatmap<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span>heatmap<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>get_ticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True label'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predicted label'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a4/63/qAeuzfvZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_273"></a>二、空洞卷积神经网络</h2> 
<h3><a id="21____274"></a>2.1 空洞卷积神经网络搭建</h3> 
<p>空洞卷积通过在卷积核中添加空洞（0元素），从而增大感受野，获取更多的信息。</p> 
<p>感受野：某一层输出结果中的一个元素所对应的输入层区域的大小。</p> 
<p>空洞卷积通过使用函数nn.Conv2d(),调节参数dilation的取值，来实现不同大小卷积核的空洞卷积的运算。</p> 
<p>dilation：整数或数组，卷积核元素之间的步幅，该步幅可调整空洞卷积的空洞大小，默认为1</p> 
<p>这里引入了一个新的超参数 d，(d - 1) 的值则为塞入的空格数，假定原来的卷积核大小为 k，那么塞入了 (d - 1) 个空格后的卷积核大小 n 为： n=k+(k-1)*(d-1)</p> 
<p>进而，假定输入空洞卷积的大小为 i，步长 为 s ,填空大小为p，空洞卷积后特征图大小 o 的计算公式为： o=[i+2p-k-(k-1)(d-1)/s]+1 向下取整</p> 
<p>网络结构为：</p> 
<p>impute images–&gt;16个33空洞卷积核，relu激活函数，平均池化AvgPool2d–&gt;32个33空洞卷积核，relu激活函数，平均池化AvgPool2d–&gt;全连接层，256个神经元–&gt;全连接层，128个神经元–&gt;输出层，10个神经元。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MyConvdilaNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MyConvdilaNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">##定义第一个卷积层</span>
        self<span class="token punctuation">.</span>conv1<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                 <span class="token comment"># 卷积后，(1*28*28)→(16*26*26)</span>
                                 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#输入图像通道数为1，输出通道为16，卷积核为3*3，步长为1，输入两边0填充数量为1，卷积核元素之间的步幅为1</span>
                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#激活函数</span>
                                 nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">#池化后(16*26*26)→(16*13*13)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">##定义第二个卷积层</span>
        self<span class="token punctuation">.</span>conv2<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                 <span class="token comment"># 卷积后，(16*13*13)→(32*9*9)</span>
                                 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#激活函数</span>
                                 nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">#平均池化，池化层窗口大小为2，步幅为2，池化后，(32*9*9)→(32*4*4)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">##定义全连接层</span>
        self<span class="token punctuation">.</span>classifier<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
    <span class="token comment">##定义网络前向传播路径</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x<span class="token operator">=</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x<span class="token operator">=</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x<span class="token operator">=</span>x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">##展平层, 把卷积池化后的图像展开成：batch_size*(32*6*6)</span>
        output<span class="token operator">=</span>self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output

<span class="token comment">## 输出网络结构</span>
myconvdilanet<span class="token operator">=</span>MyConvdilaNet<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>myconvdilanet<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/4d/QA3qZWGg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__334"></a>2.2 空洞卷积网络预测</h3> 
<pre><code class="prism language-python"><span class="token comment">#对模型进行训练</span>
optimizer<span class="token operator">=</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>myconvdilanet<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">.0003</span><span class="token punctuation">)</span>
criterion<span class="token operator">=</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#损失函数</span>
myconvdilanet<span class="token punctuation">,</span> train_process<span class="token operator">=</span>train_model<span class="token punctuation">(</span>myconvdilanet<span class="token punctuation">,</span> train_loader<span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/54/2f/5VpSqZCl_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">## 可视化训练过程</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>train_loss_all<span class="token punctuation">,</span> <span class="token string">'ro-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Train loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>val_loss_all<span class="token punctuation">,</span> <span class="token string">'bs-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'epoch'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>train_acc_all<span class="token punctuation">,</span> <span class="token string">'ro-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_process<span class="token punctuation">.</span>epoch<span class="token punctuation">,</span> train_process<span class="token punctuation">.</span>val_acc_all<span class="token punctuation">,</span> <span class="token string">'bs-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'epoch'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'acc'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/54/92/hisqPISI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">#对测试集进行预测</span>
myconvdilanet<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
output<span class="token operator">=</span>myconvdilanet<span class="token punctuation">(</span>test_data_x<span class="token punctuation">)</span>
pre_lab<span class="token operator">=</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
acc<span class="token operator">=</span>accuracy_score<span class="token punctuation">(</span>test_data_y<span class="token punctuation">,</span> pre_lab<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'在测试集上的预测精度为：'</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span>
<span class="token comment">#结果</span>
在测试集上的预测精度为： <span class="token number">0.7531</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#计算混淆矩阵并可视化</span>
conf_mat<span class="token operator">=</span>confusion_matrix<span class="token punctuation">(</span>test_data_y<span class="token punctuation">,</span> pre_lab<span class="token punctuation">)</span>
df_cm<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>conf_mat<span class="token punctuation">,</span> index<span class="token operator">=</span>class_label<span class="token punctuation">,</span> columns<span class="token operator">=</span>class_label<span class="token punctuation">)</span>
heatmap<span class="token operator">=</span>sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>df_cm<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'YlGnBu'</span><span class="token punctuation">)</span> <span class="token comment">#annot=True显示数字, fmt='d'格式设置，以整数形式显示, cmap='YlGnBu'颜色</span>
heatmap<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span>heatmap<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>get_ticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
heatmap<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span>heatmap<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>get_ticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True label'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predicted label'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/81/ed/1cUrmTQD_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc2ad8f43bc24d1b78ec423a08d8713a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GPU深度学习环境配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/96d3fe0cced6907f578f376488b98062/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用VScode 开发ESP32-----1 VSCODE 创建 编译 下载程序基本使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>