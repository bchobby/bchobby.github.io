<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【完结】囚生CYの备忘录（20231014~20231117） - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【完结】囚生CYの备忘录（20231014~20231117）" />
<meta property="og:description" content="序言 代有才人出，我们这一辈也已经老了。
邂逅花有重开日
断路人无再会时
月明林下寄旧诗
水佩风裳知不知？
罢了。
文章目录 序言202210142023101520231016~2023101720231018~2023101920231020~20231021202310222023102320231024202310252023102620231027~20231028202310302023103120231101~2023110320231104~2023110520231106~2023110820231109~2023111020231111~2023111220231113~2023111420231115~2023111620231117 20221014 本以为下午怡宝的比赛至少是能跑到前三，结果连前五都没摸到，赛前都知道路线不可能有5km，因为即便是绕着主校区最外沿跑一圈也才4km出头，我估摸着是2500米，实际上只有1700米，所以就是全程冲刺，但因为急转弯太多，亏了太多力气，加上年纪大不中用了，实在是没能冲得过几个新生，嘉伟不到5分钟就杀死了比赛，新来的崔洲宸第二，宋镇均第三，退伍生第五，还有一个不认识的是第四，我最后快到终点前是第六，听到王炳杰在后面跟着我，我以为第六还是能拿到手环的（他特别想要），就在终点前把第六让给他了，用时5分40秒，结果都是三等奖，属实难蚌，难兄难弟，但好歹有一箱水和蓝牙跳绳，我也不是很需要手环。后面还有个周俊呈第九，他现在无氧水平也算是提升了不少，但还是力量太差，注定很难有很大突破。卢星雨和丁古丽分列女子前二，她俩确实跑得很勤快。虽然一定程度上是因为距离太短，撞上无氧耐力的短板，但跑得确实笨重（这两天体重有点反弹，快71kg了，之前一直都是69kg上下），身体休息恢复得不好，怕再难以恢复到巅峰，而且今晚喉咙开始疼，大概是受凉了，下午跑的时候喉咙就痒的不停咳，明早的二工大的10km路跑赛很悬，准备跟着宋镇均混了，他这小子两周不跑还能这么快，B话是一句都不能信。 gradio@request
import gradio as gr def echo(text, request: gr.Request): if request: print(&#34;Request headers dictionary:&#34;, request.headers) print(&#34;IP address:&#34;, request.client.host) print(&#34;Query parameters:&#34;, dict(request.query_params)) return text io = gr.Interface(echo, &#34;textbox&#34;, &#34;textbox&#34;).launch() import gradio as gr def predict(text, request: gr.Request): headers = request.headers host = request.client.host user_agent = request.headers[&#34;user-agent&#34;] return { &#34;ip&#34;: host, &#34;user_agent&#34;: user_agent, &#34;headers&#34;: headers, } gr.Interface(predict, &#34;text&#34;, &#34;json&#34;).queue().launch() 20231015 Unirun 10K成绩38’26&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/e1d9406e1d383ecf480bf4d9d74287d6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T23:35:34+08:00" />
<meta property="article:modified_time" content="2023-11-17T23:35:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【完结】囚生CYの备忘录（20231014~20231117）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>序言</h2> 
<p>代有才人出，我们这一辈也已经老了。</p> 
<blockquote> 
 <p><font color="green" face="楷体" size="3">邂逅花有重开日<br>断路人无再会时<br>月明林下寄旧诗<br>水佩风裳知不知？</font></p> 
</blockquote> 
<p>罢了。</p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">序言</a></li><li><ul><li><a href="#20221014_15" rel="nofollow">20221014</a></li><li><a href="#20231015_50" rel="nofollow">20231015</a></li><li><a href="#2023101620231017_222" rel="nofollow">20231016~20231017</a></li><li><a href="#2023101820231019_396" rel="nofollow">20231018~20231019</a></li><li><a href="#2023102020231021_457" rel="nofollow">20231020~20231021</a></li><li><a href="#20231022_553" rel="nofollow">20231022</a></li><li><a href="#20231023_575" rel="nofollow">20231023</a></li><li><a href="#20231024_645" rel="nofollow">20231024</a></li><li><a href="#20231025_728" rel="nofollow">20231025</a></li><li><a href="#20231026_843" rel="nofollow">20231026</a></li><li><a href="#2023102720231028_920" rel="nofollow">20231027~20231028</a></li><li><a href="#20231030_980" rel="nofollow">20231030</a></li><li><a href="#20231031_1004" rel="nofollow">20231031</a></li><li><a href="#2023110120231103_1032" rel="nofollow">20231101~20231103</a></li><li><a href="#2023110420231105_1115" rel="nofollow">20231104~20231105</a></li><li><a href="#2023110620231108_1146" rel="nofollow">20231106~20231108</a></li><li><a href="#2023110920231110_1248" rel="nofollow">20231109~20231110</a></li><li><a href="#2023111120231112_1365" rel="nofollow">20231111~20231112</a></li><li><a href="#2023111320231114_1394" rel="nofollow">20231113~20231114</a></li><li><a href="#2023111520231116_1479" rel="nofollow">20231115~20231116</a></li><li><a href="#20231117_1536" rel="nofollow">20231117</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="20221014_15"></a>20221014</h3> 
<blockquote> 
 <ul><li>本以为下午怡宝的比赛至少是能跑到前三，结果连前五都没摸到，赛前都知道路线不可能有5km，因为即便是绕着主校区最外沿跑一圈也才4km出头，我估摸着是2500米，实际上只有1700米，所以就是全程冲刺，但因为急转弯太多，亏了太多力气，加上年纪大不中用了，实在是没能冲得过几个新生，嘉伟不到5分钟就杀死了比赛，新来的崔洲宸第二，宋镇均第三，退伍生第五，还有一个不认识的是第四，我最后快到终点前是第六，听到王炳杰在后面跟着我，我以为第六还是能拿到手环的（他特别想要），就在终点前把第六让给他了，用时5分40秒，结果都是三等奖，属实难蚌，难兄难弟，但好歹有一箱水和蓝牙跳绳，我也不是很需要手环。后面还有个周俊呈第九，他现在无氧水平也算是提升了不少，但还是力量太差，注定很难有很大突破。卢星雨和丁古丽分列女子前二，她俩确实跑得很勤快。</li><li>虽然一定程度上是因为距离太短，撞上无氧耐力的短板，但跑得确实笨重（这两天体重有点反弹，快71kg了，之前一直都是69kg上下），身体休息恢复得不好，怕再难以恢复到巅峰，而且今晚喉咙开始疼，大概是受凉了，下午跑的时候喉咙就痒的不停咳，明早的二工大的10km路跑赛很悬，准备跟着宋镇均混了，他这小子两周不跑还能这么快，B话是一句都不能信。</li></ul> 
</blockquote> 
<p>gradio@request</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> gradio <span class="token keyword">as</span> gr
<span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> request<span class="token punctuation">:</span> gr<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Request headers dictionary:"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP address:"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>client<span class="token punctuation">.</span>host<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Query parameters:"</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> text
io <span class="token operator">=</span> gr<span class="token punctuation">.</span>Interface<span class="token punctuation">(</span>echo<span class="token punctuation">,</span> <span class="token string">"textbox"</span><span class="token punctuation">,</span> <span class="token string">"textbox"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> gradio <span class="token keyword">as</span> gr


<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> request<span class="token punctuation">:</span> gr<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> request<span class="token punctuation">.</span>headers
    host <span class="token operator">=</span> request<span class="token punctuation">.</span>client<span class="token punctuation">.</span>host
    user_agent <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"user-agent"</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"ip"</span><span class="token punctuation">:</span> host<span class="token punctuation">,</span>
        <span class="token string">"user_agent"</span><span class="token punctuation">:</span> user_agent<span class="token punctuation">,</span>
        <span class="token string">"headers"</span><span class="token punctuation">:</span> headers<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
gr<span class="token punctuation">.</span>Interface<span class="token punctuation">(</span>predict<span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>queue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="20231015_50"></a>20231015</h3> 
<blockquote> 
 <ul><li>Unirun 10K成绩38’26"，均配4’07"，实际上只有9300米多一些的距离，总体来说还是挺满意的，毕竟最近也没怎么认真练，又是连上七天班，但基本上持平了万米最佳的配速（虽然距离上略少一些，而且最后400米确实已经跑不动了），前程跟打了鸡血一样，5km分段用时20’20"，因为大家一开始都贼猛，被迫跟着发疯，第一个1km只用了3’48"，我就知道坏了，赶紧调整节奏，后程虽然掉的很厉害，但还是顺利完赛。嘉伟因为昨晚跟MBA测5000米，早上状态不好，最后是37分完赛，宋某人赛前口口声声跑不动，结果起跑就把我甩没影了，我本来想叫住他别那么快，结果直到6k以后我才慢慢赶上他，但一直有100米的差距，直到终点也追不上去，他38分整完赛。另外那个新生崔洲宸确实很强，不愧是刚入学就放言要校运会拿第一的家伙，确实有两把刷子，他接力的4000米分段配速达到了令人咋舌的3’30"，两年来对嘉伟有威胁的人终于出现了。</li><li>中午李婷玉带队在三号湾干了一顿饭，发现三号湾那边真心物美价廉，五角场附近有这么便宜的店真不容易。</li><li>另外胡鑫宇今天在泰州半马（他的首半马）跑出1:34:59的好成绩，均配4’30"，他水平跟我差不多，体能不错，但力量短板，不过运气确实好，首半马即发挥出真实水平，我在锡马跑了1小时42分，因为人太多前5000米都跑不开，泰州人少确实也好跑。下周他还有一场苏州的半马。AK则是去南京参加越野赛，拿到了25km男子组的第三名，AK真乃神人也。嘉伟通过怡宝的活动拿到了12月上马直通名额，全马对我们来说还是太困难了，但总有一天是要去跑的。</li></ul> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author : caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> pandas
<span class="token keyword">from</span> xml<span class="token punctuation">.</span>etree <span class="token keyword">import</span> ElementTree

<span class="token keyword">def</span> <span class="token function">yield_race_sample</span><span class="token punctuation">(</span>race_path<span class="token punctuation">,</span> types<span class="token punctuation">,</span> difficulties<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
    batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> type_ <span class="token keyword">in</span> types<span class="token punctuation">:</span>
        <span class="token comment"># train, dev, test</span>
        <span class="token keyword">for</span> difficulty <span class="token keyword">in</span> difficulties<span class="token punctuation">:</span>
            <span class="token comment"># high, middle</span>
            data_root <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>race_path<span class="token punctuation">,</span> type_<span class="token punctuation">,</span> difficulty<span class="token punctuation">)</span>
            <span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_root<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_root<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                article_id <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
                article <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"article"</span><span class="token punctuation">]</span>
                questions <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"questions"</span><span class="token punctuation">]</span>
                options <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"options"</span><span class="token punctuation">]</span>
                answers <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"answers"</span><span class="token punctuation">]</span>
                <span class="token comment"># Ensure the number of questions, options and answers are the same</span>
                <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span><span class="token punctuation">,</span> article_id
                <span class="token comment"># Ensure id matches filename</span>
                <span class="token keyword">assert</span> article_id <span class="token operator">==</span> difficulty <span class="token operator">+</span> filename<span class="token punctuation">,</span> article_id
                <span class="token keyword">for</span> question_id<span class="token punctuation">,</span> <span class="token punctuation">(</span>question<span class="token punctuation">,</span> option<span class="token punctuation">,</span> answer<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>questions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># Ensure total option is 4</span>
                    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>article_id<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>question_id<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    <span class="token comment"># @yield article_id	    : "high1.txt"</span>
                    <span class="token comment"># @yield question_id	: 0</span>
                    <span class="token comment"># @yield article		: "My husband is a born shopper. He ..."</span>
                    <span class="token comment"># @yield question		: "The husband likes shopping because   _  ."</span>
                    <span class="token comment"># @yield options	    : ["he has much money.", "he likes the shops.", "he likes to compare the prices between the same items.", "he has nothing to do but shopping."]</span>
                    <span class="token comment"># @yield answer		    : 'C'</span>
                    batch_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"article_id"</span><span class="token punctuation">:</span> article_id<span class="token punctuation">,</span>
                                       <span class="token string">"question_id"</span><span class="token punctuation">:</span> question_id<span class="token punctuation">,</span>
                                       <span class="token string">"article"</span><span class="token punctuation">:</span> article<span class="token punctuation">,</span>
                                       <span class="token string">"question"</span><span class="token punctuation">:</span> question<span class="token punctuation">,</span>
                                       <span class="token string">"options"</span><span class="token punctuation">:</span> option<span class="token punctuation">,</span>
                                       <span class="token string">"answer"</span><span class="token punctuation">:</span> answer<span class="token punctuation">,</span>
                                       <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    current_batch_size <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> current_batch_size <span class="token operator">==</span> batch_size<span class="token punctuation">:</span>
                        <span class="token keyword">yield</span> batch_data
                        current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
                        batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> current_batch_size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> batch_data


<span class="token keyword">def</span> <span class="token function">yield_dream_sample</span><span class="token punctuation">(</span>dream_path<span class="token punctuation">,</span> types<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
    batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> type_ <span class="token keyword">in</span> types<span class="token punctuation">:</span>
        <span class="token comment"># train, dev, test</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dream_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>type_<span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">for</span> article_sentences<span class="token punctuation">,</span> questions<span class="token punctuation">,</span> article_id <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            article <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>article_sentences<span class="token punctuation">)</span>
            <span class="token keyword">for</span> question_id<span class="token punctuation">,</span> question_item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">:</span>
                question <span class="token operator">=</span> question_item<span class="token punctuation">[</span><span class="token string">"question"</span><span class="token punctuation">]</span>
                options <span class="token operator">=</span> question_item<span class="token punctuation">[</span><span class="token string">"choice"</span><span class="token punctuation">]</span>
                flag <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>article_id<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>question_id<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> option <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> option <span class="token operator">==</span> question_item<span class="token punctuation">[</span><span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token keyword">assert</span> <span class="token keyword">not</span> flag<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>article_id<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>question_id<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                        answer <span class="token operator">=</span> <span class="token string">"ABC"</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                        flag <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">assert</span> flag<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>article_id<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>question_id<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token comment"># @yield article_id	    : "4-199"</span>
                <span class="token comment"># @yield question_id	: 0</span>
                <span class="token comment"># @yield article		: "W: The movie next Tuesday ..."</span>
                <span class="token comment"># @yield question		: "What can we conclude about the movie?"</span>
                <span class="token comment"># @yield options		: ["They want to buy the tickets for the movie.", "The tickets for the movie were sold.", "The movie will not be shown."]</span>
                <span class="token comment"># @yield answer		    : 'C'</span>
                batch_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"article_id"</span><span class="token punctuation">:</span> article_id<span class="token punctuation">,</span>
                                   <span class="token string">"question_id"</span><span class="token punctuation">:</span> question_id<span class="token punctuation">,</span>
                                   <span class="token string">"article"</span><span class="token punctuation">:</span> article<span class="token punctuation">,</span>
                                   <span class="token string">"question"</span><span class="token punctuation">:</span> question<span class="token punctuation">,</span>
                                   <span class="token string">"options"</span><span class="token punctuation">:</span> options<span class="token punctuation">,</span>
                                   <span class="token string">"answer"</span><span class="token punctuation">:</span> answer<span class="token punctuation">,</span>
                                   <span class="token punctuation">}</span><span class="token punctuation">)</span>
                current_batch_size <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">if</span> current_batch_size <span class="token operator">==</span> batch_size<span class="token punctuation">:</span>
                    <span class="token keyword">yield</span> batch_data
                    current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
                    batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> current_batch_size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> batch_data


<span class="token comment"># @param race_path: Str, e.g. D:\resource\data\RACE</span>
<span class="token comment"># @param id_	  : Str, e.g. high10001.txt</span>
<span class="token comment"># @param type_	  : Str, optional, e.g. train, dev, test</span>
<span class="token keyword">def</span> <span class="token function">load_race_sample</span><span class="token punctuation">(</span>race_path<span class="token punctuation">,</span> id_<span class="token punctuation">,</span> type_<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> id_<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'high'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        difficulty <span class="token operator">=</span> <span class="token string">'high'</span>
    <span class="token keyword">elif</span> id_<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'middle'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        difficulty <span class="token operator">=</span> <span class="token string">'middle'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Unknown RACE id: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> type_ <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> candidate_type <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'dev'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>race_path<span class="token punctuation">,</span> candidate_type<span class="token punctuation">,</span> difficulty<span class="token punctuation">,</span> id_<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>difficulty<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                type_ <span class="token operator">=</span> candidate_type
        <span class="token keyword">if</span> type_ <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_<span class="token punctuation">}</span></span><span class="token string"> not found!'</span></span><span class="token punctuation">)</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>race_path<span class="token punctuation">,</span> type_<span class="token punctuation">,</span> difficulty<span class="token punctuation">,</span> id_<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>difficulty<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token comment"># @param dream_path	: Str, e.g. D:\resource\data\dream\data</span>
<span class="token comment"># @param id_	  	: Str, e.g. 4-199</span>
<span class="token comment"># @param type_	  	: Str, optional, e.g. train, dev, test</span>
<span class="token keyword">def</span> <span class="token function">load_dream_sample</span><span class="token punctuation">(</span>dream_path<span class="token punctuation">,</span> id_<span class="token punctuation">,</span> type_<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> type_ <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> candidate_type <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"dev"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dream_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>candidate_type<span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                json_string <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token string-interpolation"><span class="token string">f"\"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_<span class="token punctuation">}</span></span><span class="token string">\""</span></span> <span class="token keyword">in</span> json_string<span class="token punctuation">:</span>
                    type_ <span class="token operator">=</span> candidate_type
                    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_string<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">if</span> type_ <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_<span class="token punctuation">}</span></span><span class="token string"> not found!"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dream_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>type_<span class="token punctuation">}</span></span><span class="token string">.json"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    ids <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> sample<span class="token punctuation">:</span> sample<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    index <span class="token operator">=</span> ids<span class="token punctuation">.</span>index<span class="token punctuation">(</span>id_<span class="token punctuation">)</span>
    <span class="token keyword">return</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">generate_dataloader</span><span class="token punctuation">(</span>data_name<span class="token punctuation">,</span> types<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> settings <span class="token keyword">import</span> DATA_SUMMARY
    data_path <span class="token operator">=</span> DATA_SUMMARY<span class="token punctuation">[</span>data_name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> data_name <span class="token operator">==</span> <span class="token string">"RACE"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> yield_race_sample<span class="token punctuation">(</span>race_path<span class="token operator">=</span>data_path<span class="token punctuation">,</span>
                                 types<span class="token operator">=</span>types<span class="token punctuation">,</span>
                                 difficulties<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"high"</span><span class="token punctuation">,</span> <span class="token string">"middle"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                 batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                 <span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data_name <span class="token operator">==</span> <span class="token string">"DREAM"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> yield_dream_sample<span class="token punctuation">(</span>dream_path<span class="token operator">=</span>data_path<span class="token punctuation">,</span>
                                  types<span class="token operator">=</span>types<span class="token punctuation">,</span>
                                  batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unknown data: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>data_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generate_dataloader</span><span class="token punctuation">(</span>data_name<span class="token punctuation">,</span> dtypes<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> settings <span class="token keyword">import</span> DATA_SUMMARY

    data_path <span class="token operator">=</span> DATA_SUMMARY<span class="token punctuation">[</span>data_name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> data_name <span class="token operator">==</span> <span class="token string">"RACE"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> sadsd
</code></pre> 
<hr> 
<h3><a id="2023101620231017_222"></a>20231016~20231017</h3> 
<blockquote> 
 <ul><li>昨晚回去加速跑了10圈，赛后大腿酸痛，简单维持一下状态。</li><li>今晚回来已经挺累了，本来只打算过去小跑一下，结果先是遇崔洲宸，我还从没和他过招，虽然知道跑不过他，但还是想探探这个新生的底，他每天早晚各一个5k，不到一个月就把5000米从22分跑到19分半（他是有基础的，暑假没练而已，他现在跑姿不太行，依然是后跟跑法，只要经过系统训练，就是下一个陈嘉伟），今晚是慢摇5000米的最后1k跟他冲了一下，不到3分半，对我来说很吃力。</li><li>然后我已经打算撤了，看到卢星雨过来，她正好下午组会延迟没赶上训练（这学期晚上没有碰到过，她一般都是晚饭前五六点跑），于是拿了块15kg的片来练了30个×8组的箭步走，后又陪着慢跑了七八圈，她慢跑比我还快，我一般都是5分配出头慢摇，她都能摇到5分以内，很久没有看过她全力跑的水平，我觉得她3k绝对还能进13分钟，只是不想参赛。</li><li>最后拉伸完真的准备走了，胡鑫宇又来，他正好半马回来后还没碰过面，凑合着陪他跑了一圈，聊了会儿，整个人都打开了，完全没有疲劳的感觉了。有时候一个人跑确实越跑越累，但是陪人一起跑确实舒服很多。</li></ul> 
</blockquote> 
<p>发现一个文件编码（确切的说是请求头Accept Encoding字段的坑）的坑，以前不知道这个点，然后碰巧在<a href="https://blog.csdn.net/YungGuo/article/details/110197818">https://blog.csdn.net/YungGuo/article/details/110197818</a>的评论里有人指出来的。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> re
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

<span class="token keyword">class</span> <span class="token class-name">BaseCrawler</span><span class="token punctuation">:</span>
	tag_regex <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"&lt;[^&gt;]+&gt;|\n|\t"</span><span class="token punctuation">)</span>
	global_timeout <span class="token operator">=</span> <span class="token number">60</span>
	global_interval <span class="token operator">=</span> <span class="token number">300</span>
	<span class="token keyword">def</span> <span class="token function">headers_to_dict</span><span class="token punctuation">(</span>headers<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
		lines <span class="token operator">=</span> headers<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
		headers_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
			key<span class="token punctuation">,</span> value <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			headers_dict<span class="token punctuation">[</span>key<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> headers_dict

	<span class="token keyword">def</span> <span class="token function">easy_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
				logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>method<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>url<span class="token punctuation">}</span></span><span class="token string">, exception information: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
				logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Wait for </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>global_interval<span class="token punctuation">}</span></span><span class="token string"> seconds ..."</span></span><span class="token punctuation">)</span>
				time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>global_interval<span class="token punctuation">)</span>
		<span class="token keyword">return</span> response

<span class="token keyword">class</span> <span class="token class-name">DxsbbCrawler</span><span class="token punctuation">(</span>BaseCrawler<span class="token punctuation">)</span><span class="token punctuation">:</span>

	host_url <span class="token operator">=</span> <span class="token string">"https://www.dxsbb.com/"</span>

	headers <span class="token operator">=</span> <span class="token triple-quoted-string string">"""Host: www.dxsbb.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Cookie: acw_tc=b6284e9216974488936938256e5b60c9f3bc9bb94890ea21751e528cb8; ASPSESSIONIDQWAARSQD=FMMFAGCCLOHLIFKCFMMIFPGO; Hm_lvt_0fde2fa52b98e38f3c994a6100b45558=1697448894; Hm_lpvt_0fde2fa52b98e38f3c994a6100b45558=1697448894
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
TE: trailers"""</span>
	
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>DxsbbCrawler<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
		
	<span class="token keyword">def</span> <span class="token function">parse_table</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> save_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		response <span class="token operator">=</span> self<span class="token punctuation">.</span>easy_requests<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span>BaseCrawler<span class="token punctuation">.</span>headers_to_dict<span class="token punctuation">(</span>headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span>
		encoding <span class="token operator">=</span> response<span class="token punctuation">.</span>encoding <span class="token keyword">if</span> response<span class="token punctuation">.</span>encoding <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> response<span class="token punctuation">.</span>apparent_encoding
		<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"iso8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">"lxml"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> save_path <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			save_path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string<span class="token punctuation">}</span></span><span class="token string">.csv"</span></span>
		table <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"table"</span><span class="token punctuation">)</span>
		write_string <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	
		<span class="token keyword">for</span> tr <span class="token keyword">in</span> table<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">"tr"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">for</span> td <span class="token keyword">in</span> tr<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">"td"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				write_string <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>td<span class="token punctuation">.</span>string<span class="token punctuation">}</span></span><span class="token string">\t"</span></span>
			write_string <span class="token operator">=</span> write_string<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>write_string<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_dxsbb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	crawler <span class="token operator">=</span> DxsbbCrawler<span class="token punctuation">(</span><span class="token punctuation">)</span>
	url <span class="token operator">=</span> <span class="token string">"https://www.dxsbb.com/news/95119.html"</span>
	<span class="token comment"># url = "https://www.dxsbb.com/news/111477.html"</span>
	crawler<span class="token punctuation">.</span>parse_table<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
	run_dxsbb<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>这是一段爬取大学生必备网页面表格的脚本，以前爬虫经常会有返回的源代码是乱码的情况，不过那时候一般只要<code>html.encode("iso8859-1").decode("utf8")</code>就能解决，或者不放心查看一下<code>response.encoding</code>和<code>response.apparent_encoding</code>，确保是<code>iso8859-1</code>的编码。但是这次一直都报错，就是不能正确编解码（加入参数<code>errors="ignore"</code>也不行）。</p> 
<p>于是我用了最笨的方法，就是遍历所有的编解码组合，看看到底哪一组能编解乱码：</p> 
<pre><code class="prism language-python">
root <span class="token operator">=</span> <span class="token string">r"C:\Users\caoyang\Anaconda3\pkgs\python-3.7.0-hea74fb7_0\Lib\encodings"</span>
string <span class="token operator">=</span> <span class="token string">r"é&gt;Ä™™™ÍˇûóSå7@g÷°“MmY*="</span>
string <span class="token operator">=</span> <span class="token string">r"é&gt;Ä™™™ÍˇûóSå7@g÷°“MmY*=|¶g`f†ÁPs*˜å.˜òpÀ™ €1‹£¬=*"</span>
string <span class="token operator">=</span> <span class="token string">r"é&gt;Ä™™™ÍˇûóSå7@g÷°“MmY*=|¶g`f†ÁPs*˜å.˜òpÀ™ €1‹£¬=*w7wss3s7ﬂ,‹7w3u7è åÆ¨å HØãœ¨Ë¨à¥Ãﬂwbˇù£T"</span>

<span class="token keyword">import</span> os

encodings <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".py"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token keyword">not</span> filename<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"__init__"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		encoding <span class="token operator">=</span> filename<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		encodings<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"d:/log.txt"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span> <span class="token keyword">pass</span>
<span class="token keyword">for</span> encode_by <span class="token keyword">in</span> encodings<span class="token punctuation">:</span>
	<span class="token keyword">for</span> decode_by <span class="token keyword">in</span> encodings<span class="token punctuation">:</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			res <span class="token operator">=</span> string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encode_by<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>decode_by<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>
			<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"d:/log.txt"</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
				f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>encode_by<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>decode_by<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>res<span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
		<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
			<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"d:/log.txt"</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
				f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>encode_by<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>decode_by<span class="token punctuation">}</span></span><span class="token string"> - ERROR: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">64]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>很不幸，唯一编解拿到不是乱码的结果是用<code>utf7</code>编码，然后各种常规解码都可以，但结果完全不是HTML：</p> 
<pre><code class="prism language-python">utf_7 <span class="token operator">-</span> iso8859_3 <span class="token operator">-</span> <span class="token operator">+</span>AAUA6Q<span class="token operator">&gt;</span><span class="token operator">+</span>AMQhIiEiISIAzQLHAPsA8w<span class="token operator">-</span>S<span class="token operator">+</span>AOU<span class="token operator">-</span><span class="token number">7</span>@g<span class="token operator">+</span>APcAsCAc<span class="token operator">-</span>MmY<span class="token operator">*=</span><span class="token operator">|</span><span class="token operator">+</span>ALY<span class="token operator">-</span>g<span class="token operator">+</span>AAY`f<span class="token operator">+</span>ICAAwQ<span class="token operator">-</span>P<span class="token operator">+</span>AAM<span class="token operator">-</span>s<span class="token operator">*</span><span class="token operator">+</span><span class="token operator">+</span>P8ADALcAOX4<span class="token operator">/</span>w<span class="token punctuation">.</span><span class="token operator">+</span>AA8C3ADy<span class="token operator">-</span>p<span class="token operator">+</span>AMAhIg <span class="token operator">+</span>IKw<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span>IDkAowCs<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">+</span>ABY<span class="token operator">-</span>w7ws<span class="token operator">+</span>AAs<span class="token operator">-</span>s3s7<span class="token operator">+</span><span class="token operator">+</span>wI<span class="token punctuation">,</span><span class="token operator">+</span>IDkAFg<span class="token operator">-</span>7w3u7<span class="token operator">+</span>AOg <span class="token operator">+</span>AOUAxgCoAOU H<span class="token operator">+</span>ANgAAgDjABgBUwCoAMsAqADgAKUAwwAI<span class="token operator">+</span>wI<span class="token operator">-</span>wb<span class="token operator">+</span>AscA<span class="token operator">+</span>QCj<span class="token operator">-</span>T<span class="token operator">+</span>ABU<span class="token operator">-</span>
utf_7 <span class="token operator">-</span> iso8859_4 <span class="token operator">-</span> <span class="token operator">+</span>AAUA6Q<span class="token operator">&gt;</span><span class="token operator">+</span>AMQhIiEiISIAzQLHAPsA8w<span class="token operator">-</span>S<span class="token operator">+</span>AOU<span class="token operator">-</span><span class="token number">7</span>@g<span class="token operator">+</span>APcAsCAc<span class="token operator">-</span>MmY<span class="token operator">*=</span><span class="token operator">|</span><span class="token operator">+</span>ALY<span class="token operator">-</span>g<span class="token operator">+</span>AAY`f<span class="token operator">+</span>ICAAwQ<span class="token operator">-</span>P<span class="token operator">+</span>AAM<span class="token operator">-</span>s<span class="token operator">*</span><span class="token operator">+</span><span class="token operator">+</span>P8ADALcAOX4<span class="token operator">/</span>w<span class="token punctuation">.</span><span class="token operator">+</span>AA8C3ADy<span class="token operator">-</span>p<span class="token operator">+</span>AMAhIg <span class="token operator">+</span>IKw<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span>IDkAowCs<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">+</span>ABY<span class="token operator">-</span>w7ws<span class="token operator">+</span>AAs<span class="token operator">-</span>s3s7<span class="token operator">+</span><span class="token operator">+</span>wI<span class="token punctuation">,</span><span class="token operator">+</span>IDkAFg<span class="token operator">-</span>7w3u7<span class="token operator">+</span>AOg <span class="token operator">+</span>AOUAxgCoAOU H<span class="token operator">+</span>ANgAAgDjABgBUwCoAMsAqADgAKUAwwAI<span class="token operator">+</span>wI<span class="token operator">-</span>wb<span class="token operator">+</span>AscA<span class="token operator">+</span>QCj<span class="token operator">-</span>T<span class="token operator">+</span>ABU<span class="token operator">-</span>
utf_7 <span class="token operator">-</span> iso8859_5 <span class="token operator">-</span> <span class="token operator">+</span>AAUA6Q<span class="token operator">&gt;</span><span class="token operator">+</span>AMQhIiEiISIAzQLHAPsA8w<span class="token operator">-</span>S<span class="token operator">+</span>AOU<span class="token operator">-</span><span class="token number">7</span>@g<span class="token operator">+</span>APcAsCAc<span class="token operator">-</span>MmY<span class="token operator">*=</span><span class="token operator">|</span><span class="token operator">+</span>ALY<span class="token operator">-</span>g<span class="token operator">+</span>AAY`f<span class="token operator">+</span>ICAAwQ<span class="token operator">-</span>P<span class="token operator">+</span>AAM<span class="token operator">-</span>s<span class="token operator">*</span><span class="token operator">+</span><span class="token operator">+</span>P8ADALcAOX4<span class="token operator">/</span>w<span class="token punctuation">.</span><span class="token operator">+</span>AA8C3ADy<span class="token operator">-</span>p<span class="token operator">+</span>AMAhIg <span class="token operator">+</span>IKw<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span>IDkAowCs<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">+</span>ABY<span class="token operator">-</span>w7ws<span class="token operator">+</span>AAs<span class="token operator">-</span>s3s7<span class="token operator">+</span><span class="token operator">+</span>wI<span class="token punctuation">,</span><span class="token operator">+</span>IDkAFg<span class="token operator">-</span>7w3u7<span class="token operator">+</span>AOg <span class="token operator">+</span>AOUAxgCoAOU H<span class="token operator">+</span>ANgAAgDjABgBUwCoAMsAqADgAKUAwwAI<span class="token operator">+</span>wI<span class="token operator">-</span>wb<span class="token operator">+</span>AscA<span class="token operator">+</span>QCj<span class="token operator">-</span>T<span class="token operator">+</span>ABU<span class="token operator">-</span>
</code></pre> 
<p>python内置的编码方式有120多种，这就很纳闷了，所有的编解码组合有15000多种，愣是一组都解不出来，最后才知道，问题出在请求头里：</p> 
<pre><code>"""User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Cookie: acw_tc=b6284e9216974488936938256e5b60c9f3bc9bb94890ea21751e528cb8; ASPSESSIONIDQWAARSQD=FMMFAGCCLOHLIFKCFMMIFPGO; Hm_lvt_0fde2fa52b98e38f3c994a6100b45558=1697448894; Hm_lpvt_0fde2fa52b98e38f3c994a6100b45558=1697448894
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
TE: trailers"""
</code></pre> 
<p>一般来说Accept-Encoding都是gzip，这里多了一个br，这个是压缩的方式，只要把br去掉就行了。</p> 
<p>如果一定要带着br请求，可以考虑：https://blog.csdn.net/qq_37952113/article/details/120625794</p> 
<pre><code>浏览器支持的编码类型。一般有gzip,deflate,br 等等。

python的requests里，有response.text 和 response.content，一般解码byte和str类型。所以如果遇到br类型就会解码得到一堆乱码。

br是brotli，一种新的数据格式。在网页右键‘检查’，‘Network’里面，可以查看网页的压缩模式：

content-encoding:br
 
content-type:text/html; charset=utf-8
解决方案：
在python中导入brotli包（安装：pip install brptli）：

import brotli
并将‘br’添加到headers的Accept_encoding中：

 'Accept-Encoding': 'br,gizp,defale'
</code></pre> 
<p>另外BeautifulSoup解析库，<code>lxml</code>容易解析不全，对于纯HTML5文本，<code>html5lib</code>最准但最慢，<code>html.parser</code>快且准，<code>lxml</code>最快但最不准（烦，被这个bug整了半天，不知道为什么会解析不全）。</p> 
<hr> 
<h3><a id="2023101820231019_396"></a>20231018~20231019</h3> 
<blockquote> 
 <ul><li>周二练完力量，休两日，今天是最疼的一天。昨天卢星雨一共干了15km，5’20"的配速，这丫头是真的可怕，跟硕士新生李昊然和周俊呈（他们两个都是国教的，但水平一般，卢星雨如果全力跑，他俩都未必是对手）。九点半回校去操场摇了5圈，还能碰到崔洲宸和嘉伟在练，现在有崔洲宸在，嘉伟也是有点压力，期待他5k能突破17分的一天。</li><li>周日的UniRun成绩公示，嘉伟第8，宋镇均第10，我第13（好可惜，前12是有证书和奖品的，就是这个同济的吕艺，穿个红裤衩，前两圈都跟着我，我第三圈好不容易把他甩了，后面一直没看到他，结果最后进田径场200米冲刺把我反超，不过我进田径场的时候也倒霉方向跑反了，折了一段，然后冲刺拼不过这些年轻人）。嘉伟显然发挥太失常，只比我快了49秒，宋某人这B就不谈了，说好一起跑，结果只是一起起跑（确切的说，跑前我跟他讲，我准备跑410的配速，你快就我跟你，我快就你跟我，结果起跑就是3分整配速冲刺，甩得人都没影）。不过就这个成绩而言，我已无不满。这场高手很少，不如市运会甲组，虽然冠军实力断层碾压，但嘉伟状态好是有希望争前三。</li><li>下半年最后两场，月底31号的校运会5000米，争取第三站个台，主要对手还是宋镇均，嘉伟和崔洲宸确实比我强。11月中旬高百（之前说是28号场地4000米接力，那个太无聊了），现在最新消息是11月中旬线下，16人（至少2女）×10km路跑接力，我点了一下人头，只靠在校生还是很难凑出16人的阵容，女生是够的，但男生水平够用的太少，除了AK35分台，嘉伟37分台，李乐康、宋镇均、退伍兵和我算40分台，其他人45分钟都够呛，如果能凑出全部sub40的阵容，也能跟同济交大海医海事上体五强正面对抗）。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/03/dc/LBHq5ZOJ_o.png" alt="在这里插入图片描述"></p> 
<p>招聘信息结构化</p> 
<pre><code class="prism language-python">	<span class="token keyword">def</span> <span class="token function">extract_metadata</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> document<span class="token punctuation">,</span> index<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 编写正则表达式</span>
		<span class="token comment"># regex_sal = re.compile("[^a-zA-Z\d][1-9]\d{1,2}00[^\d号年届]")	# 其实这个更好，但是这个在匹配形如“工资4000-6000元/月”的句式时只能匹配到4000，而忽略6000</span>
		regex_sal <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">"([1-9]\d{1,2}00)[^\d号年届]"</span><span class="token punctuation">)</span>			<span class="token comment"># 这个避免了上面的问题，但可能匹配到不合适的结果</span>
		regex_edu_raw <span class="token operator">=</span> <span class="token string">'('</span>
		<span class="token keyword">for</span> edu <span class="token keyword">in</span> self<span class="token punctuation">.</span>education_1s <span class="token operator">+</span> self<span class="token punctuation">.</span>education_2s <span class="token operator">+</span> self<span class="token punctuation">.</span>education_3s<span class="token punctuation">:</span>
			regex_edu_raw <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>edu<span class="token punctuation">}</span></span><span class="token string">|"</span></span>
		regex_edu_raw <span class="token operator">=</span> regex_edu_raw<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">')'</span>
		regex_edu_raw <span class="token operator">+=</span> <span class="token string">"(研究生)?(学历)?(以?及)?(以[上内下])?(学历)?"</span>
		regex_edu <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>regex_edu_raw<span class="token punctuation">)</span>
		<span class="token comment"># 生成</span>
		regex_maj_raw <span class="token operator">=</span> <span class="token string">'('</span>
		<span class="token keyword">for</span> major <span class="token keyword">in</span> self<span class="token punctuation">.</span>major_1s <span class="token operator">+</span> self<span class="token punctuation">.</span>major_2s <span class="token operator">+</span> self<span class="token punctuation">.</span>major_3s<span class="token punctuation">:</span>
			regex_maj_raw <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>major<span class="token punctuation">}</span></span><span class="token string">|"</span></span>
			<span class="token keyword">if</span> major<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"大类"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				regex_maj_raw <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>major<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-2]</span><span class="token punctuation">}</span></span><span class="token string">|"</span></span>
			<span class="token keyword">elif</span> major<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"类"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				regex_maj_raw <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>major<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-1]</span><span class="token punctuation">}</span></span><span class="token string">|"</span></span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				<span class="token keyword">continue</span>
		regex_maj_raw <span class="token operator">=</span> regex_maj_raw<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">')'</span>
		regex_maj_raw <span class="token operator">+=</span> <span class="token string">"(专业)?"</span>
		regex_maj <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>regex_maj_raw<span class="token punctuation">)</span>
		
		<span class="token comment"># 解析招聘广告（非结构化-&gt;结构化数据）</span>
		res <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			   <span class="token string">"salary"</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			   <span class="token string">"education"</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			   <span class="token string">"major"</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			   <span class="token punctuation">}</span>
		<span class="token keyword">def</span> <span class="token function">_resolve_job_ad</span><span class="token punctuation">(</span> _ad_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
			_match_string_sal <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>_result <span class="token keyword">for</span> _result <span class="token keyword">in</span> regex_sal<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>_ad_text<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>				<span class="token comment"># 薪资</span>
			_match_string_edu <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>_result<span class="token punctuation">)</span> <span class="token keyword">for</span> _result <span class="token keyword">in</span> regex_edu<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>_ad_text<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>		<span class="token comment"># 学历</span>
			_match_string_maj <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>_result<span class="token punctuation">)</span> <span class="token keyword">for</span> _result <span class="token keyword">in</span> regex_maj<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>_ad_text<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>		<span class="token comment"># 专业</span>
			res<span class="token punctuation">[</span><span class="token string">"salary"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>_match_string_sal<span class="token punctuation">)</span>
			res<span class="token punctuation">[</span><span class="token string">"education"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>_match_string_edu<span class="token punctuation">)</span>
			res<span class="token punctuation">[</span><span class="token string">"major"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>_match_string_maj<span class="token punctuation">)</span>
		<span class="token comment"># 统计数据并导出</span>
		count <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
		<span class="token keyword">for</span> i<span class="token punctuation">,</span> ad_text <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> document<span class="token punctuation">)</span><span class="token punctuation">:</span>
			count <span class="token operator">+=</span> <span class="token number">1</span>
			<span class="token keyword">if</span> count <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
				logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
			res<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			_resolve_job_ad<span class="token punctuation">(</span>_ad_text<span class="token operator">=</span>ad_text<span class="token punctuation">)</span>
		res <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>res<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Save to </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>save_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
		res<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>		
</code></pre> 
<hr> 
<h3><a id="2023102020231021_457"></a>20231020~20231021</h3> 
<blockquote> 
 <ul><li>昨天周五，回来已经困得头疼，本想直接就回去把论文投了就洗洗睡，但想还是去操场溜达一下，刚好碰到卢星雨打完球在放松慢跑，陪着跑了一下，慢慢带到430的配速，我试探性地问了一下是否吃力，似乎她还游刃有余，不过确实有人一起跑会轻松些，虽然我已经是疲劳驾驶，但也没觉得累。后来宋镇均到，我脱了外套让他带我冲了最后1500米，340配速。一共跑了5000米左右，跑完一下子就打开了。</li><li>跑完我问卢星雨为什么近两年都不跑校运会，她说要是参加就占了本科生的名次，影响她们奖学金加分，woc，顿时格局打开，我恍然大悟，我咋就达不到这种层次呢？</li><li>周末补觉，但现在连懒觉都睡不着，昨晚熬到两点多，今天不到九点就醒了，中午也只睡了一个小时多一些。晚上过去先陪嘉伟外道跑了5圈（他明早10km精英赛，今晚只是顺腿，但也带到了355的配速），然后崔洲宸来，我顺道就跟着跑了，发现这家伙真的NB，比我想象的还要快，他早上刚跑了8km，然后晚上一个3000米还能跑到11’12"的水平，把我甩了一根直道，完全跟不住，他现在月跑量有300km，太可怕了，正式比赛绝对是能跟上嘉伟，甚至我觉得给他三个月时间是能超越嘉伟的。（我查了一下他pyq，昨天8km均配是3’56"，万米绝对能开40分钟，而且现在这些新生朋友圈发的真勤快，一天能发五六条，后浪来袭，我们真的老了）。最后陪退伍兵慢摇了5000米，445的配速，边跑边聊天，轻松惬意。</li><li>估算了一下校运会的对手，今年校运会的5000米极有可能是近5年水平最高的一次，除了嘉伟和洲宸T0之外（有望跑进18分钟），宋镇均、退伍兵、外加从800米转中长的徐瀚韬和我都算是T1（19分台），此外据说新生里还有不少水平极高的人，想必真的是一场腥风血雨了，想争前三几乎不太可能。</li></ul> 
</blockquote> 
<p>多轴作图：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> math
<span class="token keyword">import</span> numpy
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>axisartist<span class="token punctuation">.</span>parasite_axes <span class="token keyword">import</span> HostAxes<span class="token punctuation">,</span> ParasiteAxes


<span class="token comment"># @param y_prob: torch.FloatTensor, (batch_size, n_option)</span>
<span class="token comment"># @param y_true: torch.LongTensor, (batch_size, )</span>
<span class="token comment"># Evaluate single-choice outputs</span>
<span class="token keyword">def</span> <span class="token function">evaluate_single_choice</span><span class="token punctuation">(</span>y_prob<span class="token punctuation">,</span> y_true<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>y_prob<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    score <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y_pred <span class="token operator">==</span> y_true<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"accuracy"</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>true_divide<span class="token punctuation">(</span>score<span class="token punctuation">,</span> y_true<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"y_pred"</span><span class="token punctuation">:</span> y_pred<span class="token punctuation">,</span>
            <span class="token string">"score"</span><span class="token punctuation">:</span> score<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>

<span class="token comment"># @param model_name                 : str</span>
<span class="token comment"># @param train_logging_dataframe	: pandas.DataFrame[epoch, iteration, loss, accuracy]</span>
<span class="token comment"># @param dev_logging_dataframe		: pandas.DataFrame[epoch, accuracy]</span>
<span class="token comment"># @param train_plot_export_path     : str</span>
<span class="token comment"># @param dev_plot_export_path       : str</span>
<span class="token comment"># Plot single-choice by logging</span>
<span class="token keyword">def</span> <span class="token function">plot_single_choice</span><span class="token punctuation">(</span>model_name<span class="token punctuation">,</span> train_log_dataframe<span class="token punctuation">,</span> dev_log_dataframe<span class="token punctuation">,</span> train_plot_path<span class="token punctuation">,</span> dev_plot_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> train_log_dataframe <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"figure.figsize"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12.</span><span class="token punctuation">,</span> <span class="token number">9.</span><span class="token punctuation">)</span>
        epochs <span class="token operator">=</span> train_log_dataframe<span class="token punctuation">[</span><span class="token string">"epoch"</span><span class="token punctuation">]</span>
        losses <span class="token operator">=</span> train_log_dataframe<span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">]</span>
        accuracies <span class="token operator">=</span> train_log_dataframe<span class="token punctuation">[</span><span class="token string">"accuracy"</span><span class="token punctuation">]</span>

        <span class="token comment"># aggregate_dataframe = train_logging_dataframe.groupby("epoch").mean()</span>
        <span class="token comment"># plt.plot(aggregate_dataframe.index, aggregate_dataframe["loss"], label="loss")</span>
        <span class="token comment"># plt.plot(aggregate_dataframe.index, aggregate_dataframe["accuracy"], label="accuracy")</span>
        <span class="token comment"># plt.xlabel("epoch")</span>
        <span class="token comment"># plt.ylabel("metric")</span>
        <span class="token comment"># plt.title(f"Train Plot for {model_name}")</span>
        <span class="token comment"># plt.legend()</span>
        <span class="token comment"># plt.show()</span>

        xs <span class="token operator">=</span> numpy<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> epochs<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        figure <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        host <span class="token operator">=</span> HostAxes<span class="token punctuation">(</span>figure<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">.65</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        par1 <span class="token operator">=</span> ParasiteAxes<span class="token punctuation">(</span>host<span class="token punctuation">,</span> sharex<span class="token operator">=</span>host<span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>parasites<span class="token punctuation">.</span>append<span class="token punctuation">(</span>par1<span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"loss"</span><span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"epoch"</span><span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>major_ticklabels<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        figure<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span>host<span class="token punctuation">)</span>
        p1<span class="token punctuation">,</span> <span class="token operator">=</span> host<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> losses<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"loss"</span><span class="token punctuation">)</span>
        p2<span class="token punctuation">,</span> <span class="token operator">=</span> par1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> accuracies<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"left"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>set_color<span class="token punctuation">(</span>p1<span class="token punctuation">.</span>get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>set_color<span class="token punctuation">(</span>p2<span class="token punctuation">.</span>get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        host<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Train Plot for </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> train_plot_path <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>train_plot_path<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> dev_log_dataframe <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        epochs <span class="token operator">=</span> dev_log_dataframe<span class="token punctuation">[</span><span class="token string">"epoch"</span><span class="token punctuation">]</span>
        accuracies <span class="token operator">=</span> dev_log_dataframe<span class="token punctuation">[</span><span class="token string">"accuracy"</span><span class="token punctuation">]</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> accuracies<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"epoch"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"metric"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Valid Plot for </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> dev_plot_path <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>dev_plot_path<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="20231022_553"></a>20231022</h3> 
<blockquote> 
 <ul><li>这是一个群星璀璨的时代！！！！！！！！！！！</li><li>嘉伟今早上马10k精英赛跑出令人咋舌的36’25"，均配3’38"，这比他上个月在129测的17’35"的5000米还要硬，要知道他之前的10k个人最佳还是在去年市运会前在跑步机上跑出来的37分半，去年的高百接力的10k也不过刚刚进39分，没想到不到一年又有如此恐怖的提升，完全看不到他的极限在哪里，我昨天跟崔洲宸跑完觉得嘉伟地位或受威胁，还是我太幼稚，一直以为嘉伟已经触及瓶颈，但进步的速度依然惊人，说不定哪一天5000米就破开17分钟直冲二级了。</li><li>另外今早AK的江阴半马净成绩1:16:58，均配3’38"，比嘉伟还强，你宽哥还是你宽哥，虽然AK之前的PB是1小时13分，这个配速不过是他全马PB的配速而已；胡鑫宇的苏州太湖半马1:36:12，因为有隧道和山，发挥真的很稳定。</li><li>AK一如既往的稳定发挥，他周六甚至还去环球金融中心参加了爬楼比赛（80层），而这周末他将前往浙江台州参加柴古唐斯越野赛，这场越野赛最低的组别是26km，爬升有800米，最高的组别是115km，将持续超过一天时间，爬升达到1300米+，不得不说AK真的是太猛了。</li></ul> 
</blockquote> 
<p>stata读excel表，按excel默认的编号，改名，删列</p> 
<pre><code>import excel "全国2023年第2季度原始数据.xlsx",clear firstrow

rename A loginName
rename B firmName
rename C firmOrg // 企业所属组织
rename D firmProvince
rename E firmIndustry

drop W FQl FQl RCEP RCEPFQl AA AB
</code></pre> 
<hr> 
<h3><a id="20231023_575"></a>20231023</h3> 
<blockquote> 
 <ul><li>晚上回来慢跑遇嘉伟，陪他散了会儿步，当然我说的是<strong>嘉伟在散步</strong>，我已经几近使出全力，最后是42分整的10km（对于社畜来说已经很努力了，如果不是遇到嘉伟我打算摇个10圈就溜了），嘉伟又补了五圈到12km，他现在定了课表在在认真按计划训练（一三五LSD堆跑量，周二周六队内训练，周四129团练，周日跑休练力量），备战十二月的上马，嘉伟是真的动真格了。</li><li>昨晚后来遇到徐瀚韬问他是否要比5000米，他似乎并无此意，依然是报了1500米，李乐康今天也跟我说不回来参加校运会了，因此主要对手仍然是宋镇均和叶赵志，这两人水平隐约在我之上，目前我全盛状态下预计5000米进19分半，10000米能进41分钟。</li><li>说句心里话，虽然这两年饮食睡眠都没有好好控制，训练也是三天打鱼、两天晒网，但总归感觉水平是比两年前最巅峰的时期要稍许强些，我的身体素质和身体条件都是相当一般，没有嘉伟那样瘦削的身材和超长的跟腱，从小体育无能，即便现在我每天都坚持睡前做核心腰腹训练，每周坚持一天力量训练，每天坚持一定的跑量，也注定达不到嘉伟的高度，嘉伟这两年平均配速提升了30多秒，我只提升了5秒不到，但是我现在也不希望真的瘦到嘉伟那种程度，70kg对我来说刚刚好，如果一定要减重的代价以获取更好的成绩，我宁可选择平庸，人生就是这样一个权衡得失的过程。</li></ul> 
</blockquote> 
<p>modelscope@pipeline，转载自<a href="https://modelscope.cn/docs/" rel="nofollow">https://modelscope.cn/docs/</a></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>pipelines <span class="token keyword">import</span> pipeline
word_segmentation <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">'word-segmentation'</span><span class="token punctuation">)</span>

input_str <span class="token operator">=</span> <span class="token string">'今天天气不错，适合出去游玩'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_segmentation<span class="token punctuation">(</span>input_str<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token string">'今天 天气 不错 ， 适合 出去 游玩'</span><span class="token punctuation">}</span>

inputs <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token string">'今天天气不错，适合出去游玩'</span><span class="token punctuation">,</span><span class="token string">'这本书很好，建议你看看'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_segmentation<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'天气'</span><span class="token punctuation">,</span> <span class="token string">'不错'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'适合'</span><span class="token punctuation">,</span> <span class="token string">'出去'</span><span class="token punctuation">,</span> <span class="token string">'游玩'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'这'</span><span class="token punctuation">,</span> <span class="token string">'本'</span><span class="token punctuation">,</span> <span class="token string">'书'</span><span class="token punctuation">,</span> <span class="token string">'很'</span><span class="token punctuation">,</span> <span class="token string">'好'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'建议'</span><span class="token punctuation">,</span> <span class="token string">'你'</span><span class="token punctuation">,</span> <span class="token string">'看看'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

inputs <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token string">'今天天气不错，适合出去游玩'</span><span class="token punctuation">,</span><span class="token string">'这本书很好，建议你看看'</span><span class="token punctuation">]</span>
<span class="token comment"># 指定batch_size参数来支持批量推理</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_segmentation<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'天气'</span><span class="token punctuation">,</span> <span class="token string">'不错'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'适合'</span><span class="token punctuation">,</span> <span class="token string">'出去'</span><span class="token punctuation">,</span> <span class="token string">'游玩'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'这'</span><span class="token punctuation">,</span> <span class="token string">'本'</span><span class="token punctuation">,</span> <span class="token string">'书'</span><span class="token punctuation">,</span> <span class="token string">'很'</span><span class="token punctuation">,</span> <span class="token string">'好'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'建议'</span><span class="token punctuation">,</span> <span class="token string">'你'</span><span class="token punctuation">,</span> <span class="token string">'看看'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>msdatasets <span class="token keyword">import</span> MsDataset
<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>pipelines <span class="token keyword">import</span> pipeline

inputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'今天天气不错，适合出去游玩'</span><span class="token punctuation">,</span> <span class="token string">'这本书很好，建议你看看'</span><span class="token punctuation">]</span>
dataset <span class="token operator">=</span> MsDataset<span class="token punctuation">.</span>load<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> target<span class="token operator">=</span><span class="token string">'sentence'</span><span class="token punctuation">)</span>
word_segmentation <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">'word-segmentation'</span><span class="token punctuation">)</span>
outputs <span class="token operator">=</span> word_segmentation<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
<span class="token keyword">for</span> o <span class="token keyword">in</span> outputs<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'天气'</span><span class="token punctuation">,</span> <span class="token string">'不错'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'适合'</span><span class="token punctuation">,</span> <span class="token string">'出去'</span><span class="token punctuation">,</span> <span class="token string">'游玩'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'这'</span><span class="token punctuation">,</span> <span class="token string">'本'</span><span class="token punctuation">,</span> <span class="token string">'书'</span><span class="token punctuation">,</span> <span class="token string">'很'</span><span class="token punctuation">,</span> <span class="token string">'好'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'建议'</span><span class="token punctuation">,</span> <span class="token string">'你'</span><span class="token punctuation">,</span> <span class="token string">'看看'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>models <span class="token keyword">import</span> Model
<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>pipelines <span class="token keyword">import</span> pipeline

model <span class="token operator">=</span> Model<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">'damo/nlp_structbert_word-segmentation_chinese-base'</span><span class="token punctuation">)</span>
word_segmentation <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">'word-segmentation'</span><span class="token punctuation">,</span> model<span class="token operator">=</span>model<span class="token punctuation">)</span>
<span class="token builtin">input</span> <span class="token operator">=</span> <span class="token string">'今天天气不错，适合出去游玩'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_segmentation<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'天气'</span><span class="token punctuation">,</span> <span class="token string">'不错'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'适合'</span><span class="token punctuation">,</span> <span class="token string">'出去'</span><span class="token punctuation">,</span> <span class="token string">'游玩'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>models <span class="token keyword">import</span> Model
<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>pipelines <span class="token keyword">import</span> pipeline
<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>preprocessors <span class="token keyword">import</span> Preprocessor<span class="token punctuation">,</span> TokenClassificationTransformersPreprocessor

model <span class="token operator">=</span> Model<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">'damo/nlp_structbert_word-segmentation_chinese-base'</span><span class="token punctuation">)</span>
tokenizer <span class="token operator">=</span> Preprocessor<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model<span class="token punctuation">.</span>model_dir<span class="token punctuation">)</span>
<span class="token comment"># Or call the constructor directly: </span>
<span class="token comment"># tokenizer = TokenClassificationTransformersPreprocessor(model.model_dir)</span>
word_segmentation <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">'word-segmentation'</span><span class="token punctuation">,</span> model<span class="token operator">=</span>model<span class="token punctuation">,</span> preprocessor<span class="token operator">=</span>tokenizer<span class="token punctuation">)</span>
<span class="token builtin">input</span> <span class="token operator">=</span> <span class="token string">'今天天气不错，适合出去游玩'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_segmentation<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'output'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'天气'</span><span class="token punctuation">,</span> <span class="token string">'不错'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'适合'</span><span class="token punctuation">,</span> <span class="token string">'出去'</span><span class="token punctuation">,</span> <span class="token string">'游玩'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="20231024_645"></a>20231024</h3> 
<p>matplotlib设置坐标轴标签</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
matplotlib<span class="token punctuation">.</span>rc<span class="token punctuation">(</span><span class="token string">"font"</span><span class="token punctuation">,</span>family<span class="token operator">=</span><span class="token string">'MicroSoft YaHei'</span><span class="token punctuation">,</span>weight<span class="token operator">=</span><span class="token string">"bold"</span><span class="token punctuation">)</span> <span class="token comment"># 设置中文字体</span>
<span class="token operator">%</span>matplotlib inline
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"count"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"mean"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>ticks<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token operator">=</span>educations_by_level<span class="token punctuation">)</span> <span class="token comment"># ticks是默认的第一个参数，可以不加keyword augment，但是如果要使用labels，必须带ticks，此时ticks和labels长度一致，且可以比实际数据的长度少</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>简单插次坐标轴，以前用的是<code>mpl_toolkits</code>里的工具：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>axisartist<span class="token punctuation">.</span>parasite_axes <span class="token keyword">import</span> HostAxes<span class="token punctuation">,</span> ParasiteAxes

figure <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
host <span class="token operator">=</span> HostAxes<span class="token punctuation">(</span>figure<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">.15</span><span class="token punctuation">,</span> <span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">.65</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 主轴对象host</span>
par1 <span class="token operator">=</span> ParasiteAxes<span class="token punctuation">(</span>host<span class="token punctuation">,</span> sharex<span class="token operator">=</span>host<span class="token punctuation">)</span>       <span class="token comment"># 与host共享x轴的par1</span>
host<span class="token punctuation">.</span>parasites<span class="token punctuation">.</span>append<span class="token punctuation">(</span>par1<span class="token punctuation">)</span>                  <span class="token comment"># 主轴添加par1</span>
host<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"loss"</span><span class="token punctuation">)</span>
host<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"epoch"</span><span class="token punctuation">)</span>
host<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token comment"># host不显示右侧坐标轴</span>
par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>         <span class="token comment"># par1显示右侧坐标轴</span>
par1<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span>
par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>major_ticklabels<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 显示par1右侧坐标轴主要的tick</span>
par1<span class="token punctuation">.</span>axis<span class="token punctuation">[</span><span class="token string">"right"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>            <span class="token comment"># 显示par1右侧坐标轴的label</span>
figure<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span>host<span class="token punctuation">)</span>
p1<span class="token punctuation">,</span> <span class="token operator">=</span> host<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> losses<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"loss"</span><span class="token punctuation">)</span>
p2<span class="token punctuation">,</span> <span class="token operator">=</span> par1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xs<span class="token punctuation">,</span> accuracys<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span>
par1<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">)</span>
host<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
host<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>发现可以直接用matplotlib自带的twinx函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 构造数据</span>
t <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
data1 <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
data2 <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> t<span class="token punctuation">)</span>
<span class="token comment"># 第一个子图</span>
ax1 <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># get current axis，拿到坐标轴</span>
ax1<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'time (s)'</span><span class="token punctuation">)</span>                  <span class="token comment"># 设置坐标轴</span>
ax1<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'exp'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>            <span class="token comment"># 设置坐标轴</span>
ax1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t<span class="token punctuation">,</span> data1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>               <span class="token comment"># 折线图y = exp(x)</span>
ax1<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> labelcolor<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>   <span class="token comment"># 设置x轴的tick属性</span>
ax2 <span class="token operator">=</span> ax1<span class="token punctuation">.</span>twinx<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 创建与ax1共享x轴的第二个子图</span>
ax2<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'sin'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>            <span class="token comment"># 折线图y = sin(x)</span>
ax2<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t<span class="token punctuation">,</span> data2<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>               
ax2<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> labelcolor<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>   <span class="token comment"># 设置x轴的tick属性</span>
</code></pre> 
<p>另外发现不知为何最新版pandas不接受直接创建空dataFrame了：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 会报错：object has no attribute dtype</span>
</code></pre> 
<p>报错原因大概是此时dataframe里的数据都是object类型，没有属性dtype</p> 
<p>现在只能手动创建全部都是缺失值的dataframe了</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="20231025_728"></a>20231025</h3> 
<blockquote> 
 <ul><li>晚上6000米+30个×8组负重箭步（15kg），本来很累只想5分配慢摇，但3000米被一个穿校队服的瘦猴超了，这我能忍？跟了他一段，就把他带崩了，这家伙不到3000米就下场了，均配410，属实拉垮，但应该是个新生，还是很有提升空间的，本想拉他进队，但估计应该是别的校队成员，就算了。跑完来了精神，补了力量训练，比较到位的一晚，现在15kg其实比较轻松，即便身体很疲劳也能坚持完8组，但换20kg又太吃力。</li><li>嘉伟已经成功中签上马，期望他首马破三。高百上海站接力赛已定于11月11日在海湾森林公园举行，形式是16人×10km路跑，那地方也没比滴水湖近多少，从学校过去贼费事，但我其实挺想去跑的，但是今年队里想去跑的人很多，虽然除了崔洲宸和嘉伟，其他人都远不如我，只是想去凑个热闹，主要看马协的态度，因为今年跟21年不同，21年下半年因为疫情根本没有马拉松赛可参加，所以马协的校友大佬都来跑高百了，今年每周末都有赛事，他们不一定来得了，到时候队里还是得出人补齐16个名额的。毕竟是线下赛，2021年疫情期间尚且办的很满意，今年还是挺值得期待的。</li></ul> 
</blockquote> 
<p>modelscope@train</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>msdatasets <span class="token keyword">import</span> MsDataset
<span class="token comment"># 载入训练数据，数据格式类似于{'sentence1': 'some content here', 'sentence2': 'other content here', 'label': 0}</span>
train_dataset <span class="token operator">=</span> MsDataset<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'clue'</span><span class="token punctuation">,</span>  subset_name<span class="token operator">=</span><span class="token string">'afqmc'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">)</span>
<span class="token comment"># 载入评估数据</span>
eval_dataset <span class="token operator">=</span> MsDataset<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'clue'</span><span class="token punctuation">,</span>  subset_name<span class="token operator">=</span><span class="token string">'afqmc'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'validation'</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>hub <span class="token keyword">import</span> read_config
<span class="token comment"># 上面的model_id</span>
config <span class="token operator">=</span> read_config<span class="token punctuation">(</span>model_id<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>pretty_text<span class="token punctuation">)</span>

<span class="token comment"># 使用该模型适配的预处理器sen-sim-tokenizer</span>
cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'sen-sim-tokenizer'</span>
<span class="token comment"># 预处理器输入的dict中，句子1的key，参考上文加载数据集中的afqmc的格式</span>
cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>first_sequence <span class="token operator">=</span> <span class="token string">'sentence1'</span>
<span class="token comment"># 预处理器输入的dict中，句子2的key</span>
cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>second_sequence <span class="token operator">=</span> <span class="token string">'sentence2'</span>
<span class="token comment"># 预处理器输入的dict中，label的key</span>
cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'label'</span>
<span class="token comment"># 预处理器需要的label和id的mapping</span>
cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>label2id <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>

<span class="token comment"># num_labels是该模型分类数</span>
cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> <span class="token number">2</span>

<span class="token comment"># 修改task类型为'text-classification'</span>
cfg<span class="token punctuation">.</span>task <span class="token operator">=</span> <span class="token string">'text-classification'</span>
<span class="token comment"># 修改pipeline名称，用于后续推理</span>
cfg<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'text-classification'</span><span class="token punctuation">}</span>

<span class="token comment"># 设置训练epoch</span>
cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>max_epochs <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment"># 工作目录</span>
cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>work_dir <span class="token operator">=</span> <span class="token string">'/tmp'</span>
<span class="token comment"># 设置batch_size</span>
cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu <span class="token operator">=</span> <span class="token number">32</span>
cfg<span class="token punctuation">.</span>evaluation<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu <span class="token operator">=</span> <span class="token number">32</span>
<span class="token comment"># 设置learning rate</span>
cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>optimizer<span class="token punctuation">.</span>lr <span class="token operator">=</span> <span class="token number">2e-5</span>
<span class="token comment"># 设置LinearLR的total_iters，这项和数据集大小相关</span>
cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>total_iters <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span> <span class="token operator">/</span> cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu<span class="token punctuation">)</span> <span class="token operator">*</span> cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>max_epochs
<span class="token comment"># 设置评估metric类</span>
cfg<span class="token punctuation">.</span>evaluation<span class="token punctuation">.</span>metrics <span class="token operator">=</span> <span class="token string">'seq-cls-metric'</span>

<span class="token comment"># 这个方法在trainer读取configuration.json后立即执行，先于构造模型、预处理器等组件</span>
<span class="token keyword">def</span> <span class="token function">cfg_modify_fn</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">:</span>
  cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'sen-sim-tokenizer'</span>
  cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>first_sequence <span class="token operator">=</span> <span class="token string">'sentence1'</span>
  cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>second_sequence <span class="token operator">=</span> <span class="token string">'sentence2'</span>
  cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'label'</span>
  cfg<span class="token punctuation">.</span>preprocessor<span class="token punctuation">.</span>label2id <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
  cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> <span class="token number">2</span>
  cfg<span class="token punctuation">.</span>task <span class="token operator">=</span> <span class="token string">'text-classification'</span>
  cfg<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'text-classification'</span><span class="token punctuation">}</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>max_epochs <span class="token operator">=</span> <span class="token number">5</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>work_dir <span class="token operator">=</span> <span class="token string">'/tmp'</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu <span class="token operator">=</span> <span class="token number">32</span>
  cfg<span class="token punctuation">.</span>evaluation<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu <span class="token operator">=</span> <span class="token number">32</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>workers_per_gpu <span class="token operator">=</span> <span class="token number">0</span>
  cfg<span class="token punctuation">.</span>evaluation<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>workers_per_gpu <span class="token operator">=</span> <span class="token number">0</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>optimizer<span class="token punctuation">.</span>lr <span class="token operator">=</span> <span class="token number">2e-5</span>
  cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>total_iters <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span> <span class="token operator">/</span> cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>batch_size_per_gpu<span class="token punctuation">)</span> <span class="token operator">*</span> cfg<span class="token punctuation">.</span>train<span class="token punctuation">.</span>max_epochs
  cfg<span class="token punctuation">.</span>evaluation<span class="token punctuation">.</span>metrics <span class="token operator">=</span> <span class="token string">'seq-cls-metric'</span>
  <span class="token comment"># 注意这里需要返回修改后的cfg</span>
  <span class="token keyword">return</span> cfg

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>trainers <span class="token keyword">import</span> build_trainer

<span class="token comment"># 配置参数</span>
kwargs <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
        model<span class="token operator">=</span>model_id<span class="token punctuation">,</span>
        train_dataset<span class="token operator">=</span>train_dataset<span class="token punctuation">,</span>
        eval_dataset<span class="token operator">=</span>eval_dataset<span class="token punctuation">,</span>
        cfg_modify_fn<span class="token operator">=</span>cfg_modify_fn<span class="token punctuation">)</span>
trainer <span class="token operator">=</span> build_trainer<span class="token punctuation">(</span>default_args<span class="token operator">=</span>kwargs<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>msdatasets <span class="token keyword">import</span> MsDataset
<span class="token comment"># 载入评估数据</span>
eval_dataset <span class="token operator">=</span> MsDataset<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'clue'</span><span class="token punctuation">,</span>  subset_name<span class="token operator">=</span><span class="token string">'afqmc'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'validation'</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>trainers <span class="token keyword">import</span> build_trainer

<span class="token comment"># 配置参数</span>
kwargs <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
        <span class="token comment"># 由于使用的模型训练后的目录，因此不需要传入cfg_modify_fn</span>
        model<span class="token operator">=</span><span class="token string">'/tmp/output'</span><span class="token punctuation">,</span>
        eval_dataset<span class="token operator">=</span>eval_dataset<span class="token punctuation">)</span>
trainer <span class="token operator">=</span> build_trainer<span class="token punctuation">(</span>default_args<span class="token operator">=</span>kwargs<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>msdatasets <span class="token keyword">import</span> MsDataset
<span class="token comment"># 载入评估数据</span>
eval_dataset <span class="token operator">=</span> MsDataset<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'clue'</span><span class="token punctuation">,</span>  subset_name<span class="token operator">=</span><span class="token string">'afqmc'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'validation'</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modelscope<span class="token punctuation">.</span>trainers <span class="token keyword">import</span> build_trainer

<span class="token comment"># 配置参数</span>
kwargs <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
        <span class="token comment"># 由于使用的模型训练后的目录，因此不需要传入cfg_modify_fn</span>
        model<span class="token operator">=</span><span class="token string">'/tmp/output'</span><span class="token punctuation">,</span>
        eval_dataset<span class="token operator">=</span>eval_dataset<span class="token punctuation">)</span>
trainer <span class="token operator">=</span> build_trainer<span class="token punctuation">(</span>default_args<span class="token operator">=</span>kwargs<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="20231026_843"></a>20231026</h3> 
<blockquote> 
 <ul><li>晚上回来，计划是去蜀地源暴食一顿，但是之前我都要先练一会儿，以防负罪感太深。去操场想起今晚队里例训，果然人都在，东哥得知我饿着肚子，便赏了我块烧饼，让我带大一小朋友跑了12圈变速（嘉伟、宋某、崔洲宸都去了129，所以队里中长跑已经是我最强了），小朋友水平还是有待开发，连我这种下班穿着衬衫平底鞋来练的人都跟不上，而且为了照顾卢星雨和丁古丽，我快圈只带了1’30"，慢圈2’30"，他们有两个连卢星雨都跑不过，我仿佛看到了自己刚进队的样子。</li><li>后来又陪着练了俯身两头起和背部的力量训练，以及两组核心训练，最后陪卢星雨放松跑了3圈，结束已经8点50，比较到位的一晚，成功省了一顿饭钱。</li><li>说实话如果不是卢星雨在，我可能带完变速就去大快朵颐了，比队里大一大二的小朋友至少也大个六七岁，实在是没啥可谈，虽然跟她也交集也少，但是至少认知水平是相近的，说的东西也都能听得懂，而且跟女生跑不会累，边练边说会儿也开心些。白天我也都是跟宝玺姐一起吃饭行动，身边其他都是三十多岁的大哥大姐，有丁克、有刚婚假蜜月从欧洲回来的、有家人都移民的、还有一周五天在北上广深杭五个地方的，认知完全不在一个档次上，我觉得我说话会被觉得幼稚（还有一个关键就是我们的专业差太多，如果谈论技术，我还是有话可说，但是谈论金融就只能纸上谈兵，level差太多了）。所以我还是挺佩服卢星雨，每年新生入队她都能很快融入新生群体，今年入队的已经小她六岁了，对我来说六岁已经是很大的代沟了。</li></ul> 
</blockquote> 
<p>Firefox浏览器selenium配置（转载自https://blog.csdn.net/u010451638/article/details/109580906）</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>proxy <span class="token keyword">import</span> <span class="token operator">*</span> 
<span class="token triple-quoted-string string">'''
#这种方法在py3好像有点问题隐藏了
# 代理
myProxy = '202.202.90.20:8080'
# 代理格式
proxy = Proxy({
  'proxyType': ProxyType.MANUAL, 
  'httpProxy': myProxy, 
  'ftpProxy': myProxy, 
  'sslProxy': myProxy, 
  'noProxy': ''
 })

profile = webdriver.FirefoxProfile()
profile = get_firefox_profile_with_proxy_set(profile, proxy)
'''</span>
ip <span class="token operator">=</span> <span class="token string">'27.44.221.62:4213'</span>
ip_ip <span class="token operator">=</span> ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
ip_port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
profile <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>FirefoxProfile<span class="token punctuation">(</span><span class="token punctuation">)</span>
profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 默认值0，就是直接连接；1就是手工配置代理。</span>
profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.http'</span><span class="token punctuation">,</span> ip_ip<span class="token punctuation">)</span>
profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.http_port'</span><span class="token punctuation">,</span> ip_port<span class="token punctuation">)</span>
profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.ssl'</span><span class="token punctuation">,</span> ip_ip<span class="token punctuation">)</span>
profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.ssl_port'</span><span class="token punctuation">,</span> ip_port<span class="token punctuation">)</span>
profile<span class="token punctuation">.</span>update_preferences<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span>profile<span class="token punctuation">)</span>

profile<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">"general.useragent.override"</span><span class="token punctuation">,</span> user_agent<span class="token punctuation">)</span>

<span class="token comment"># firefox无头模式</span>
options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>FirefoxOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--headless'</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--disable-gpu'</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'window-size=1200x600'</span><span class="token punctuation">)</span>
executable_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">'geckodriver.exe'</span><span class="token punctuation">)</span>

driver<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span>proxy<span class="token operator">=</span>proxy<span class="token punctuation">,</span> profile<span class="token operator">=</span>profile<span class="token punctuation">,</span> 
						 options<span class="token operator">=</span>options<span class="token punctuation">,</span> executable_path<span class="token operator">=</span>executable_path<span class="token punctuation">)</span> 
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span> 
driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>FirefoxOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 不加载图片,加快访问速度</span>
<span class="token comment">#options.set_preference('permissions.default.image',2)</span>
<span class="token comment"># 此步骤很重要，设置为开发者模式，防止被各大网站识别出来使用了Selenium  火狐好像不用设置</span>
<span class="token comment">#options.add_experimental_option('excludeSwitches', ['enable-automation'])</span>
<span class="token comment"># 添加本地代理</span>

<span class="token comment">## 第二步：开启“手动设置代理”</span>
options<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 第三步：设置代理IP</span>
options<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.http'</span><span class="token punctuation">,</span> <span class="token string">'221.180.170.104'</span><span class="token punctuation">)</span>
<span class="token comment">## 第四步：设置代理端口，注意端口是int类型，不是字符串</span>
options<span class="token punctuation">.</span>set_preference<span class="token punctuation">(</span><span class="token string">'network.proxy.http_port'</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>

<span class="token comment"># 添加UA</span>
<span class="token comment">#ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36'</span>
<span class="token comment">#options.add_argument('user-agent=' + ua)</span>

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span>

</code></pre> 
<hr> 
<h3><a id="2023102720231028_920"></a>20231027~20231028</h3> 
<blockquote> 
 <ul><li>下午嘉伟4分配带LSD（实际3’57"），一共16km，带的非常稳，他新买了nike vapofly，现在价格已经跌倒七八百了。我跟了前5000米，19’34"，后面实在是跟不住，基本上是跑两圈歇一圈，加起一共跟了26圈，非常极限，但嘉伟依然游刃有余，以他目前的水平，全马破三并不是很困难的事情，他现在半马有120的水平，对应全马是255，如果他最后一个月还能继续突破，甚至有可能首马打开250。</li><li>今天凌晨柴骨唐斯越野开赛，AK是55km组，中途有两座山要上下，一共爬升2200米，最后以41名完赛（1200人），129的查敏（人称五哥）跑了55km组第5名，用时5小时38分（大部分人这个时间平地上都跑不完55km，相当于1小时10km的速度连跑5个多小时，爬升2200米，这是多么恐怖的体能），AK用了6小时50分才跑完（第二座山跑崩），事实上就全马成绩，五哥不会比AK快超过20分钟，但是越野确实太吃策略和经验，我经常爬楼梯深有体会，可能前十层能一口气三级三级台阶冲上去，但是一旦到达心肺阈值，就只能一步一步往上走，很难保持匀速爬完几十层楼，更何况坡度起伏的越野赛，平地跑55km都不见得能跑完，何况55km的跑山。而柴古唐斯还有85km（爬升4000米+）和115km（爬升6000米+）两个组别，加起来的参赛人数也有近2000人，能参加的都是跑者中最精英的一批人，全马成绩至少都是250以内，另外有90人参加了26km（爬升800米）的组别，即便是最低的组别，对于我们这种业余跑者也极其困难。因此半马全马不过入门而已，能跑越野才是真正的登堂入室。</li></ul> 
</blockquote> 
<p>xpath如何取包含多个class属性</p> 
<p>如果html结构是这样</p> 
<pre><code>&lt;div class="demo"&gt;&lt;/div&gt;
</code></pre> 
<p>那么我知道可以写xpath <code>//div[@class="demo"]</code>，但是如果我的html是</p> 
<pre><code>&lt;div class="test demo"&gt;&lt;/div&gt;
&lt;div class="demo test"&gt;&lt;/div&gt;
&lt;div class="test demo2"&gt;&lt;/div&gt;
</code></pre> 
<p>我只想选出有demo这个class的对象，那应该怎么弄</p> 
<p>要取多个class属性值的元素，应该如何办呢；</p> 
<p>如：</p> 
<pre><code>&lt;div class='a b'&gt;test&lt;/div&gt;
</code></pre> 
<p>如果是用xpath(‘//div[@class=“a”]’) 会取不到这里面的值；</p> 
<p>可以用如下的表达式：</p> 
<pre><code>xpath('//div[contains(@class,"a")]')   #它会取得所有class为a的元素
</code></pre> 
<p>或者</p> 
<pre><code>xpath('//div[contains(@class,"a") and contains(@class,"b")]') #它会取class同时有a和b的元素
</code></pre> 
<p>如果没记错的话可以这么来：</p> 
<pre><code>//div[contains(@class, 'demo')]
</code></pre> 
<p>如果是多个则可以：</p> 
<pre><code>//div[contains(@class, 'demo') and contains(@class, 'other')]
</code></pre> 
<p>如果目标 class 不一定是第一个，那么：</p> 
<pre><code>//div[contains(concat(' ', @class, ' '), 'demo')]
</code></pre> 
<hr> 
<h3><a id="20231030_980"></a>20231030</h3> 
<blockquote> 
 <ul><li>AK瘫了两天，但依然坚持周一上班，身残志坚，吾辈楷模。看了他分享的照片，真的是太燃了，柴古唐斯，这辈子我一定要去一次（但我们现在根本连报名的资格都没有）。</li><li>昨晚去散步陪MBA的人跑了六七公里，他们在跑LSD，比较慢，圈速1’57"上下，对我来说就是放松跑，穿个白衬衫和平底鞋也非常轻松。其实我并不在MBA的跑圈群里，但是他们有不少人都认识我，听到有人喊那个穿白衬衫的小哥哥很快的（我上周日陪花姐跑了一下，花姐是公认的上财MBA女子第一人，全马PB250，水平在我之上，但是我不好意思跟着女性跑，觉得丢人，所以我在外道隔了两根道陪她跑了十几圈，400配速，跑的我累死），也是沾了AK和嘉伟的光。</li><li>今晚田径场已经封场，跑休，明天就是校运会，看起来这次搞得还挺隆重。最后一次，嘉伟、宋某、炳杰都不在，嘉伟大概是想把机会留给新人，否则他来冠军就没悬念了（他今年一项都没有报，他从400~5000，报啥都是稳稳的冠军），炳杰出差来不了，宋镇均就是纯懒，我都不想谈，他要是明天出现在起跑线，我就把他嘴抽烂。如果没有黑马的话，这次很有机会冲击亚军（只输一手崔洲宸，年轻人太硬了），上半年毕竟赛前一周扭伤，停跑近十天，比赛只跑了20’56"，太过遗憾，这次赛前一周的训练整体来说还是比较到位的，及格线是跑进20分钟，希望往19分冲一冲，2021年12月之后就再也没有刷新过任何PB，身体这么快就老了么？或许，谁知道呢。</li></ul> 
</blockquote> 
<p>一个小的冷僻点，<code>dataframe[column].sum()</code>，如果这一列是字符串类型的，求和的效果是把字段全部拼起来。</p> 
<p>常用的xpath路径表达式：</p> 
<table><thead><tr><th>表达式</th><th>描述</th><th>实例</th></tr></thead><tbody><tr><td>nodename</td><td>选取nodename节点的所有子节点</td><td>xpath('//div’)</td></tr><tr><td>选取了div节点的所有子节点</td><td>/</td><td></td></tr><tr><td>从根节点选取 xpath('/div’) 从根节点上选取div节点</td><td></td><td></td></tr><tr><td>//</td><td>选取所有的当前节点，不考虑他们的位置</td><td></td></tr><tr><td>xpath('//div’)</td><td>选取所有的div节点</td><td></td></tr><tr><td>.</td><td>选取当前节点</td><td>xpath('./div’)</td></tr><tr><td>选取当前节点下的div节点</td><td></td><td></td></tr><tr><td>…</td><td>选取当前节点的父节点</td><td></td></tr><tr><td>xpath('…’)</td><td>回到上一个节点</td><td></td></tr><tr><td>@</td><td>选取属性</td><td>xpath（’//@calss’）</td></tr></tbody></table> 
<hr> 
<h3><a id="20231031_1004"></a>20231031</h3> 
<blockquote> 
 <ul><li>我还是老了。</li><li>其实我真的很兴奋，虽说是人生第二次参加校运会，但是第一次毕竟是带伤跑，那时只是不想错过，这次就算不是全盛状态，也至少有个九成五的状态了，才算是我真正第一次参赛。我早上就兴奋，中午睡不着，起跑前身上从手指麻到小腿，僵硬得不行，起跑时整个人都变形了，特别别扭，都不会跑步了，起手就被甩到第七名，1km用时3’37"上升到第六，我很纳闷这届年轻人这么猛的吗？2km用时7’35"，此时我已经上升到第五，但感觉已经崩了，不过其他人比我更崩，3km分段11分30秒，4km结束我被崔洲辰套圈，此时我上升到第三，且完全不知道谁是第二（因为我也套了很多人圈），胡鑫宇跟我说第三应该稳的，我实在太累就放了一些到5分配缓了一下（后来查表发现自己那段心率最高达到了196，已经突破了我现在的最大心率220-26=194，当时就觉得完全不可能再顶得下去，必须降速走一段了），最后300米我听到背后一声咆哮，叶赵志终于超上来了，他在最后200米追上了我，但我们约定最后都不冲刺，携手通过终点线。</li><li>一个原因是今天太热，十月底居然有28度艳阳直晒，体感肯定是30度以上，我号码牌都被汗淋湿得掉色了。第二个原因是前面冲太猛，导致后面跑崩，以至于我最后一圈都提不了速度冲刺。如果最后能第三拿块牌子就好了，但叶赵志确实是让了我一手，我是肯定冲不过他的。</li><li>后来晚上遇到嘉伟在堆跑量，12.8km（3’57"/km）+1.6km（3’30"/km）+6.4km（4’08"/km）+1.6km（3’47"/km）+1.6（5’08"/km），量太大了，我跟了大概有3~4km，嘉伟今天一天都没到校运会现场，其实肯定是有隐情的，大概率是感情问题，人之常情，也不便多问。</li><li>主要成绩记录：李婷玉跳远冠军（4.12米，她是真的NB，身高不到1米6，而且还是女博士，爆发力这么恐怖，但是100米这次她没跑进决赛），男子1500米群英荟萃，三人跑进4’50"，徐瀚韬4’44"拿下冠军，崔洲宸4’48"季军，女子3000米丁古丽第三13’14"，黄懿嘉冠军13’13"（咬得很紧），胡鑫宇1500米5’16"第六，非常不错了。5000米成绩因为有人有异议今天没有公布。</li></ul> 
</blockquote> 
<p>Xpath谓语：</p> 
<p>谓语被嵌在方括号内，用来查找某个特定的节点或包含某个制定的值的节点</p> 
<p>实例：</p> 
<p>表达式 结果<br> xpath(‘/body/div[1]’)<br> 选取body下的第一个div节点<br> xpath(’/body/div[last()]’)<br> 选取body下最后一个div节点<br> xpath(‘/body/div[last()-1]’) 选取body下倒数第二个div节点<br> xpath(’/body/div[positon()❤️]’) 选取body下前两个div节点<br> xpath(‘/body/div[@class]’) 选取body下带有class属性的div节点<br> xpath(’/body/div[@class=“main”]’) 选取body下class属性为main的div节点<br> xpath('/body/div[price&gt;35.00]’) 选取body下price元素值大于35的div节点</p> 
<hr> 
<h3><a id="2023110120231103_1032"></a>20231101~20231103</h3> 
<blockquote> 
 <ul><li>这三天特别累，步执突然开始很上心项目，让我有点措手不及。周三休整，去小姨家补了口血，周四回来头都疼了，但还是跑了21圈（4’49"配速诚信有氧，真的完全不累），今天回来头更疼，不得不早睡，但还是补了14圈，4’47"配速，太累太累，眼睛都快睁不开了。</li><li>崔洲宸这个小伙子，自从校运会5000米冠军后，见人就要吹，已经在高百群、上财马协群、129跑营群里都说了，也没人问他，他就是想炫耀一下，每次都是我校运会18分10秒，还要刻意强调一下套了第二名一圈，其实之前交流就发现，他这个人不太合群，我跟嘉伟经常约他跑，他都不理，后来我们也懒得找他。我水平差就算了，好歹也尊重一下嘉伟，水平至少目前还在他之上，又是他统计学院的学长，有点太目中无人，现在05后太拽，这次高百准备让他跑第一棒，让他好好见识一下长三角高手的水平，好好打磨打磨他，不可否认他的上限很高，将来很可能是会超越嘉伟，但是也得先学会做人。</li><li>下周末双十一，上海海湾森林公园，高校百英里接力赛上海站，我财今年水平远远超过21年滴水湖之战的水平，希望能拿下前六，剑指全国总决赛。</li></ul> 
</blockquote> 
<p>hotpotqa process script</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">hotpotqa_to_dataframe</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
						  save_dir<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
						  <span class="token punctuation">)</span><span class="token punctuation">:</span>
	title_to_article <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	title_to_article_id <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	article_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"id"</span>		<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					<span class="token string">"title"</span>		<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					<span class="token string">"sentences"</span>	<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span>
	question_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"id"</span>				<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"question"</span>			<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"context"</span>			<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"answer"</span>			<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"supporting_facts"</span>	<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"type"</span>				<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"level"</span>			<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str</span>
					 <span class="token string">"source"</span>			<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># Str: New columns indicating from which data file the sample comes</span>
					 <span class="token punctuation">}</span>
	substitude <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">b'\xc2\xa0'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
	<span class="token keyword">def</span> <span class="token function">_clean_string</span><span class="token punctuation">(</span>_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> _raw<span class="token punctuation">,</span> _new <span class="token keyword">in</span> substitude<span class="token punctuation">:</span>
			<span class="token keyword">return</span> _string<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>_raw<span class="token punctuation">,</span> _new<span class="token punctuation">)</span>

	article_id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token keyword">for</span> file_name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> file_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"hotpot_"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> file_name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			source <span class="token operator">=</span> file_name<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>	<span class="token comment"># Extract xxx from hotpot_xxx.json</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> source<span class="token punctuation">)</span>
			data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
				id_ <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"_id"</span><span class="token punctuation">]</span>									<span class="token comment"># Str</span>
				question <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"question"</span><span class="token punctuation">]</span>							<span class="token comment"># Str</span>
				context <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"context"</span><span class="token punctuation">]</span>							<span class="token comment"># List[Str, List[Str]]</span>
				answer <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"answer"</span><span class="token punctuation">)</span>							<span class="token comment"># Str: Maynot in test dataset</span>
				supporting_facts <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"supporting_facts"</span><span class="token punctuation">)</span>		<span class="token comment"># List[Str, Int]: Maynot in test dataset</span>
				type_ <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span>							<span class="token comment"># Str: Maynot in test dataset</span>
				level <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"level"</span><span class="token punctuation">)</span>							<span class="token comment"># Str: Maynot in test dataset</span>
				<span class="token keyword">for</span> title<span class="token punctuation">,</span> sentences <span class="token keyword">in</span> context<span class="token punctuation">:</span>
					sentences <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>_clean_string<span class="token punctuation">,</span> sentences<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token comment"># It is proved that no '\n' exists in any article sentence, so we can concatenate sentences by '\n' without losing information</span>
					article <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span>	
					<span class="token keyword">if</span> <span class="token keyword">not</span> title <span class="token keyword">in</span> title_to_article<span class="token punctuation">:</span>
						<span class="token comment"># New title comes</span>
						article_id <span class="token operator">+=</span> <span class="token number">1</span>
						article_dict<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>article_id<span class="token punctuation">)</span>
						article_dict<span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>article_id<span class="token punctuation">)</span>
						article_dict<span class="token punctuation">[</span><span class="token string">"sentences"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">)</span>
						title_to_article<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">=</span> article
						title_to_article_id<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">=</span> article_id
					<span class="token keyword">else</span><span class="token punctuation">:</span>
						<span class="token comment"># Duplicate title comes</span>
						<span class="token keyword">assert</span> article <span class="token operator">==</span> title_to_article<span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">,</span> title
				<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
					logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>id_<span class="token punctuation">)</span>
				context_easy <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> _x<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>title_to_article_id<span class="token punctuation">[</span>_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				supporting_facts_easy <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token keyword">if</span> supporting_facts <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> _x<span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>title_to_article_id<span class="token punctuation">[</span>_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>_x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> supporting_facts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>id_<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"question"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>question<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"context"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>context_easy<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"answer"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>answer<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"supporting_facts"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>supporting_facts_easy<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>type_<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"level"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>level<span class="token punctuation">)</span>
				question_dict<span class="token punctuation">[</span><span class="token string">"source"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>source<span class="token punctuation">)</span>
	article_dataframe <span class="token operator">=</span> pandas<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>article_dict<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>article_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	question_dataframe <span class="token operator">=</span> pandas<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>question_dict<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>question_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> save_dir <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_dir<span class="token punctuation">,</span> <span class="token string">"hotpot_title_to_article.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>title_to_article<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
		article_dataframe<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_dir<span class="token punctuation">,</span> <span class="token string">"hotpot_article.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
		question_dataframe<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_dir<span class="token punctuation">,</span> <span class="token string">"hotpot_question.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> title_to_article<span class="token punctuation">,</span> article_dataframe<span class="token punctuation">,</span> question_dataframe
</code></pre> 
<hr> 
<h3><a id="2023110420231105_1115"></a>20231104~20231105</h3> 
<blockquote> 
 <ul><li>昨天跟队训练，400米×8的间歇，加沙坑箭步跳训练（沙坑弹性小，难度更大），我大概已经4个月没有跑过400米间歇了，第一组1’10"，第二组1’14"，然后大腿就已经酸麻得完全动不了了，我一共跑了6组，后面基本上是1’15"~1’20"，实在顶不下去，宋镇均跑间歇确实猛，8组全部跑进1’10"，崔洲宸显然没练过间歇，竟然跑着很吃力，后面的箭步做得也很吃力（这个其实不仅是腿部力量，更重要的核心，否则在沙坑里都站不稳，我就觉得很轻松），他力量上来之后，提升会非常大。</li><li>今晚嘉伟自测5000米，我为他计时及领跑（我每圈领跑200米，然后沿斜线返回终点线，可惜没有人给他带后200米），AK和李浩然为他录像拍照，胡鑫宇为他清理内道散步的人，第一个1000米用时3’14"，3000米用时10’08"（均配3’22"），前9圈维持了1’24"以内的全速，10-12圈掉到1’25"-1’26"，最后一圈1’16"，最终5000米用时17’08"，平均配速3’25"/km，平均心率182bpm，最大心率203bpm，艳压群芳，技惊四座！已经超越了AK巅峰期（强如AK，5000米也不曾打开17分钟，官方PB是大运会的17’10"）！不到两个月时间，再次提升近30秒，太可怕太可怕，破开17分指日可待，财大现役中长跑无可争议第一人。</li><li>校运会5000米最终还是我拿了季军，胜之不武，虽赢但菜，总算是拿到了心心念念的奖牌和证书，可惜无法站台拍照留念，多少有些无奈，不知明年还能否有机会站上赛道。</li></ul> 
</blockquote> 
<p>chatglm3-6b @ https://github.com/THUDM/ChatGLM3</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> transformers <span class="token keyword">import</span> AutoTokenizer<span class="token punctuation">,</span> AutoModel
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"THUDM/chatglm3-6b"</span><span class="token punctuation">,</span> trust_remote_code<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> model <span class="token operator">=</span> AutoModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"THUDM/chatglm3-6b"</span><span class="token punctuation">,</span> trust_remote_code<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">'cuda'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> model <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">,</span> history <span class="token operator">=</span> model<span class="token punctuation">.</span>chat<span class="token punctuation">(</span>tokenizer<span class="token punctuation">,</span> <span class="token string">"你好"</span><span class="token punctuation">,</span> history<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
你好👋!我是人工智能助手 ChatGLM3<span class="token operator">-</span>6B<span class="token punctuation">,</span>很高兴见到你<span class="token punctuation">,</span>欢迎问我任何问题。
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">,</span> history <span class="token operator">=</span> model<span class="token punctuation">.</span>chat<span class="token punctuation">(</span>tokenizer<span class="token punctuation">,</span> <span class="token string">"晚上睡不着应该怎么办"</span><span class="token punctuation">,</span> history<span class="token operator">=</span>history<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
晚上睡不着可能会让你感到焦虑或不舒服<span class="token punctuation">,</span>但以下是一些可以帮助你入睡的方法<span class="token punctuation">:</span>

<span class="token number">1.</span> 制定规律的睡眠时间表<span class="token punctuation">:</span>保持规律的睡眠时间表可以帮助你建立健康的睡眠习惯<span class="token punctuation">,</span>使你更容易入睡。尽量在每天的相同时间上床<span class="token punctuation">,</span>并在同一时间起床。
<span class="token number">2.</span> 创造一个舒适的睡眠环境<span class="token punctuation">:</span>确保睡眠环境舒适<span class="token punctuation">,</span>安静<span class="token punctuation">,</span>黑暗且温度适宜。可以使用舒适的床上用品<span class="token punctuation">,</span>并保持房间通风。
<span class="token number">3.</span> 放松身心<span class="token punctuation">:</span>在睡前做些放松的活动<span class="token punctuation">,</span>例如泡个热水澡<span class="token punctuation">,</span>听些轻柔的音乐<span class="token punctuation">,</span>阅读一些有趣的书籍等<span class="token punctuation">,</span>有助于缓解紧张和焦虑<span class="token punctuation">,</span>使你更容易入睡。
<span class="token number">4.</span> 避免饮用含有咖啡因的饮料<span class="token punctuation">:</span>咖啡因是一种刺激性物质<span class="token punctuation">,</span>会影响你的睡眠质量。尽量避免在睡前饮用含有咖啡因的饮料<span class="token punctuation">,</span>例如咖啡<span class="token punctuation">,</span>茶和可乐。
<span class="token number">5.</span> 避免在床上做与睡眠无关的事情<span class="token punctuation">:</span>在床上做些与睡眠无关的事情<span class="token punctuation">,</span>例如看电影<span class="token punctuation">,</span>玩游戏或工作等<span class="token punctuation">,</span>可能会干扰你的睡眠。
<span class="token number">6.</span> 尝试呼吸技巧<span class="token punctuation">:</span>深呼吸是一种放松技巧<span class="token punctuation">,</span>可以帮助你缓解紧张和焦虑<span class="token punctuation">,</span>使你更容易入睡。试着慢慢吸气<span class="token punctuation">,</span>保持几秒钟<span class="token punctuation">,</span>然后缓慢呼气。

如果这些方法无法帮助你入睡<span class="token punctuation">,</span>你可以考虑咨询医生或睡眠专家<span class="token punctuation">,</span>寻求进一步的建议。
</code></pre> 
<hr> 
<h3><a id="2023110620231108_1146"></a>20231106~20231108</h3> 
<blockquote> 
 <ul><li>高百备赛，期望可以跑进41分，在校生的出战阵容：陈嘉伟（PB 36’25"），崔洲辰（38分台），宋镇均、胡鑫宇、李乐康、我都是41分台，外带一个稍微差些的李浩然，如果能把李浩然换成AK，这阵容将是绝杀，可惜AK来不了，不然我财今年总决赛必有一席之位。</li><li>最近很忙，但每天回来精力还是很充沛，周一20圈5分配（前7km心率都压在150以内，最后1km冲了一下也没有突破160，心肺能力确有提升），周二给老板汇报回来的太晚，九点吃了两个鸡肉卷就去冲了两组2000米，配速4’05"和4’20"，今晚是4’24"配速的8km，稍微上点强度，全程心率压在170以内。慢跑对我速度能力的提升已经没有太大助益，但可以维持状态，这样很好。</li></ul> 
</blockquote> 
<p>ideatalk自动化脚本</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> requests

<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait

<span class="token keyword">from</span> src<span class="token punctuation">.</span>base <span class="token keyword">import</span> BaseCrawler

<span class="token keyword">class</span> <span class="token class-name">IdeaTalkCrawler</span><span class="token punctuation">(</span>BaseCrawler<span class="token punctuation">)</span><span class="token punctuation">:</span>
	urls <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"home"</span><span class="token punctuation">:</span> <span class="token string">"https://idealab.alibaba-inc.com/chat"</span><span class="token punctuation">,</span>		<span class="token comment"># Home URL</span>
			<span class="token punctuation">}</span>
	layout_xpaths <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"safe-alert-button"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"safe-introduce-dialog-body-button\"]"</span><span class="token punctuation">,</span>						<span class="token comment"># XPath of the button appearing at safe alert box(not always)</span>
					 <span class="token string">"model-cards"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"next-slick-list\"]"</span><span class="token punctuation">,</span>											<span class="token comment"># XPath of all model cards on home page</span>
					 <span class="token string">"input-box"</span>			<span class="token punctuation">:</span> <span class="token string">"//textarea[@id=\"inputValue\"]"</span><span class="token punctuation">,</span>												<span class="token comment"># XPath of the input box for human</span>
					 <span class="token string">"send-button"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"send-button\"]"</span><span class="token punctuation">,</span>												<span class="token comment"># XPath of the button to send text of input box</span>
					 <span class="token string">"chat-area"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"idea-talk-prompted\"]"</span><span class="token punctuation">,</span>										<span class="token comment"># XPath of the chat area which contains all the talks (consist of several chat boxes)</span>
					 <span class="token string">"human-box"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"prompt-box\"]"</span><span class="token punctuation">,</span>												<span class="token comment"># XPath of human chat box</span>
					 <span class="token string">"ai-box"</span>				<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"ChatBox\"]"</span><span class="token punctuation">,</span>													<span class="token comment"># XPath of AI chat box</span>
					 <span class="token string">"ai-box-text"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"ChatBox\"]//div[@class=\"ChatBox-contents-inner-box-text\"]"</span><span class="token punctuation">,</span>	<span class="token comment"># XPath of the text contained in AI chat box</span>
					 <span class="token string">"create-new-button"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"idea-talk-record-list-add\"]"</span><span class="token punctuation">,</span>								<span class="token comment"># XPath of create new talk</span>
					 <span class="token string">"like-or-dislike-area"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"like-or-dislike\"]"</span><span class="token punctuation">,</span>											<span class="token comment"># XPath of div tag contains like and dislike icons</span>
					 <span class="token comment"># "like-icon"			: "//svg[@class=\"next-icon-remote like-icon\"]",								# XPath of like icon under AI chat box</span>
					 <span class="token comment"># "like-icon"			: "//svg[contains(@class, \"like-icon\")]",										# XPath of like icon under AI chat box</span>
					 <span class="token comment"># "like-icon"			: "//div[@class=\"like-or-dislike\"]//svg",										# XPath of like icon under AI chat box</span>
					 <span class="token comment"># "dislike-icon"		: "//svg[@class=\"next-icon-remote dislike-icon\"]",							# XPath of dislike icon under AI chat box</span>
					 <span class="token comment"># "dislike-icon"		: "//svg[contains(@class, \"dislike-icon\")]",									# XPath of dislike icon under AI chat box</span>
					 <span class="token comment"># "dislike-icon"		: "//div[@class=\"like-or-dislike\"]//svg",										# XPath of dislike icon under AI chat box</span>
					 <span class="token punctuation">}</span>
	model_card_xpaths <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"chatgpt3.5"</span>		<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"next-slick-list\"]//div[@data-index=\"0\"]"</span><span class="token punctuation">,</span>					<span class="token comment"># XPath of the first model card (ChatGPT 3.5) on home page</span>
						 <span class="token string">"chatgpt3.5(16k)"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"next-slick-list\"]//div[@data-index=\"1\"]"</span><span class="token punctuation">,</span>					<span class="token comment"># XPath of the second model card (ChatGLM2) on home page</span>
						 <span class="token string">"vertex"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"next-slick-list\"]//div[@data-index=\"2\"]"</span><span class="token punctuation">,</span>					<span class="token comment"># XPath of the third model card (Vertex) on home page</span>
						 <span class="token string">"chatglm2"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"next-slick-list\"]//div[@data-index=\"3\"]"</span><span class="token punctuation">,</span>					<span class="token comment"># XPath of the fourth model card (ChatGLM2) on home page</span>
						 <span class="token punctuation">}</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>IdeaTalkCrawler<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment"># @param driver		: WebDriver object</span>
	<span class="token comment"># @param prompt		: The question you would like to ask AI</span>
	<span class="token comment"># @param model_name	: One of the key in `model_card_xpath`, e.g. "chatgpt3.5(16k)"</span>
	<span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> driver<span class="token punctuation">,</span> prompt<span class="token punctuation">,</span> model_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
		driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>urls<span class="token punctuation">[</span><span class="token string">"home"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"model-cards"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>	<span class="token comment"># Check if model cards is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"input-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>		<span class="token comment"># Check if input box is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>	<span class="token comment"># Check if send button is rendered</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"safe-alert-button"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment"># Check if alert box is existed</span>
			logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Safe alerting!"</span><span class="token punctuation">)</span>
		<span class="token keyword">except</span><span class="token punctuation">:</span>
			logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No safe alerting!"</span><span class="token punctuation">)</span>


		<span class="token comment"># Request</span>
		driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_card_xpaths<span class="token punctuation">[</span>model_name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment"># Click on the given model name</span>
		driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"input-box"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>	<span class="token comment"># Input the given prompt</span>
		driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment"># Click on the button to send the prompt</span>
		<span class="token comment"># Wait for response</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"chat-area"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>	<span class="token comment"># Check if chat area is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"human-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>	<span class="token comment"># Check if human chat box is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>		<span class="token comment"># Check if AI chat box is rendered</span>
		finish_flag <span class="token operator">=</span> <span class="token boolean">True</span>	<span class="token comment"># Indicating if AI generation is finished</span>
		<span class="token keyword">while</span> finish_flag<span class="token punctuation">:</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"like-or-dislike-area"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				finish_flag <span class="token operator">=</span> <span class="token boolean">False</span>
			<span class="token keyword">except</span><span class="token punctuation">:</span>
				ai_box_text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box-text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>						<span class="token comment"># Find AI response text element</span>
				ai_box_text_inner_html <span class="token operator">=</span> ai_box_text<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">"innerHTML"</span><span class="token punctuation">)</span>										<span class="token comment"># Get inner HTML of the element</span>
				response <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_regex<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ai_box_text_inner_html<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n\t "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'\\n'</span><span class="token punctuation">)</span>	<span class="token comment"># Process response text</span>
				<span class="token keyword">if</span> <span class="token string">"今天体验次数已用完"</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>
					finish_flag <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token comment"># Extract AI response text</span>
		ai_box_text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box-text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment"># Find AI response text element</span>
		ai_box_text_inner_html <span class="token operator">=</span> ai_box_text<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">"innerHTML"</span><span class="token punctuation">)</span>					<span class="token comment"># Get inner HTML of the element</span>
		response <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_regex<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ai_box_text_inner_html<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n\t "</span><span class="token punctuation">)</span>		<span class="token comment"># Process response text</span>
		<span class="token keyword">return</span> response

	<span class="token comment"># @param data_path: EXCEL file of job descriptions</span>
	<span class="token comment"># @param save_path: file path for storing AI response</span>
	<span class="token comment"># @param model_name: defined in model_card_xpaths</span>
	<span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token string">"chatgpt3.5(16k)"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		driver <span class="token operator">=</span> self<span class="token punctuation">.</span>initialize_driver<span class="token punctuation">(</span>browser<span class="token operator">=</span><span class="token string">"chrome"</span><span class="token punctuation">,</span> headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
		prompt <span class="token operator">=</span> <span class="token string">"给我讲述一下《基督山伯爵》的故事，500字左右。"</span>
		response <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> prompt<span class="token punctuation">,</span> model_name<span class="token punctuation">)</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"d:/answer-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string">.txt"</span></span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
		driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="2023110920231110_1248"></a>20231109~20231110</h3> 
<blockquote> 
 <ul><li>事情都是在节骨眼上出问题，胡鑫宇和李浩然大腿拉伤，力量训练太少，加上气温骤降，跑前热身不充分，光腿跑就拉伤了。替补本来就紧张，吴征也有点不近人情，非要胡鑫宇到场，胡哥也有点不高兴，我从中周旋才终于摆平。16个人一起出去旅游尚且丢三落四，何况是一起去跑步呢。想到强风吹拂里灰二凑齐10个人跑箱根是那么困难，当天也会有人出状况，但他们还是克服下来跑完了210km的接力。最后我们在校生出战高百的人是宋某、嘉伟、小崔和我，还有李乐康，我差点忘了这个拽小子。</li><li>但每个人对于跑步的情感是不同的。我是一个严肃跑者，校运会虽然最终跑进前三，但仍未PB，我5k,10k,半马的PB全部停留在21年12月，我渴望PB，渴望了太久太久，我知道以后真的工作、成家，我这样的条件再不能像那些MBA大佬一样花费大量时间在跑步上，所以我无比渴望在还年轻的时候，看到自己能10k开40分，全马破3的样子。我发现自己越来越不能在日常训练中顶住强度，我只能在赛场上才能找到久违的兴奋感。</li><li>这次我的状态依然是尚可，尽管每天搬砖，但下班回来都有保持训练量。周一周三有氧8k，周二两组全力2k，周四实验楼上下5组（75层），今天跑休。明天我与宋镇均将作为AB组的第一棒出发，宋某是我老兄弟，水平相近，知根知底，携带彼此再好不过。</li><li><font color="black" face="华文行楷" size="4">我还年轻，我是不会放弃的</font>。<img src="https://images2.imgbox.com/2e/1f/TO9jhkWm_o.png" alt="在这里插入图片描述"></li></ul> 
</blockquote> 
<p>chatglm浏览器访问脚本</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @author: caoyang</span>
<span class="token comment"># @email: caoyang@163.sufe.edu.cn</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> requests

<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait

<span class="token keyword">from</span> src<span class="token punctuation">.</span>base <span class="token keyword">import</span> BaseCrawler

<span class="token keyword">class</span> <span class="token class-name">ChatGLMCrawler</span><span class="token punctuation">(</span>BaseCrawler<span class="token punctuation">)</span><span class="token punctuation">:</span>
	urls <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"home"</span><span class="token punctuation">:</span> <span class="token string">"https://chatglm.cn/"</span><span class="token punctuation">,</span>		<span class="token comment"># Home URL</span>
			<span class="token punctuation">}</span>
	layout_xpaths <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token comment"># "input-box"			: "//textarea[@class=\"scroll-display-none\"]",					# XPath of the input box for human</span>
					 <span class="token string">"input-box"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"input-box-inner\"]"</span><span class="token punctuation">,</span>							<span class="token comment"># XPath of the input box for human</span>
					 <span class="token string">"send-button-1"</span>		<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"enter\"]"</span><span class="token punctuation">,</span>									<span class="token comment"># XPath of the button to send text of input box</span>
					 <span class="token string">"send-button-2"</span>		<span class="token punctuation">:</span> <span class="token string">"//img[@class=\"enter_icon\"]"</span><span class="token punctuation">,</span>								<span class="token comment"># XPath of the button to send text of input box</span>
					 <span class="token string">"chat-area"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@id=\"session-container\"]"</span><span class="token punctuation">,</span>							<span class="token comment"># XPath of the chat area which contains all the talks (consist of several chat boxes)</span>
					 <span class="token string">"human-box"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"pr\"]"</span><span class="token punctuation">,</span>										<span class="token comment"># XPath of human chat box</span>
					 <span class="token string">"ai-box"</span>				<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"answer-content-wrap\"]"</span><span class="token punctuation">,</span>						<span class="token comment"># XPath of AI chat box</span>
					 <span class="token string">"ai-box-text"</span>			<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"markdown-body\"]"</span><span class="token punctuation">,</span>							<span class="token comment"># XPath of the text contained in AI chat box</span>
					 <span class="token string">"create-new-button"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"new-session-button\"]"</span><span class="token punctuation">,</span>						<span class="token comment"># XPath of create new talk</span>
					 <span class="token string">"like-or-dislike-area"</span>	<span class="token punctuation">:</span> <span class="token string">"//div[@class=\"interact-operate\"]"</span><span class="token punctuation">,</span>							<span class="token comment"># XPath of div tag contains like and dislike icons</span>
					 <span class="token string">"delete-session"</span>		<span class="token punctuation">:</span> <span class="token string">"//span[@class=\"btn delete\"]"</span><span class="token punctuation">,</span>								<span class="token comment"># XPath of button to delete old talk</span>
					 <span class="token punctuation">}</span>
	forbidden_strings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>ChatGLMCrawler<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment"># @param driver		: WebDriver object</span>
	<span class="token comment"># @param prompt		: The question you would like to ask AI</span>
	<span class="token comment"># @param model_name	: One of the key in `model_card_xpath`, e.g. "chatgpt3.5(16k)"</span>
	<span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> driver<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span><span class="token punctuation">:</span>
		driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>urls<span class="token punctuation">[</span><span class="token string">"home"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"input-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>		<span class="token comment"># Check if input box is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button-1"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>	<span class="token comment"># Check if send button is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button-2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>	<span class="token comment"># Check if send button is rendered</span>

		<span class="token comment"># Delete old talk</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button-1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
			logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Delete old talk ..."</span><span class="token punctuation">)</span>
		<span class="token keyword">except</span><span class="token punctuation">:</span>
			logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No old talk found ..."</span><span class="token punctuation">)</span>
		
		<span class="token comment"># Request</span>
		driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"input-box"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>	<span class="token comment"># Input the given prompt</span>
		<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
			<span class="token comment"># The button is dynamic and sometimes fail to click on</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button-1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment"># Click on the button to send the prompt</span>
				logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Use send button 1 ..."</span><span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token keyword">except</span><span class="token punctuation">:</span>
				<span class="token keyword">try</span><span class="token punctuation">:</span>
					driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"send-button-2"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment"># Click on the button to send the prompt</span>
					logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Use send button 2 ..."</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span>
				<span class="token keyword">except</span><span class="token punctuation">:</span>
					logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Use send button error ..."</span><span class="token punctuation">)</span>
					<span class="token keyword">continue</span>
		<span class="token comment"># Wait for response</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"chat-area"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>	<span class="token comment"># Check if chat area is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"human-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>	<span class="token comment"># Check if human chat box is rendered</span>
		self<span class="token punctuation">.</span>check_element_by_xpath<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> xpath<span class="token operator">=</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>		<span class="token comment"># Check if AI chat box is rendered</span>
		finish_flag <span class="token operator">=</span> <span class="token boolean">True</span>	<span class="token comment"># Indicating if AI generation is finished</span>
		<span class="token keyword">while</span> finish_flag<span class="token punctuation">:</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				<span class="token comment"># If like or dislike appear, then stop</span>
				driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"like-or-dislike-area"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				finish_flag <span class="token operator">=</span> <span class="token boolean">False</span>
			<span class="token keyword">except</span><span class="token punctuation">:</span>
				ai_box_text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box-text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>						<span class="token comment"># Find AI response text element</span>
				<span class="token comment"># ai_box_text = driver.find_element_by_xpath(self.layout_xpaths["ai-box"])							# Find AI response text element</span>
				ai_box_text_inner_html <span class="token operator">=</span> ai_box_text<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">"innerHTML"</span><span class="token punctuation">)</span>										<span class="token comment"># Get inner HTML of the element</span>
				response <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_regex<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ai_box_text_inner_html<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n\t "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'\\n'</span><span class="token punctuation">)</span>	<span class="token comment"># Process response text</span>
				forbidden_flags <span class="token operator">=</span> <span class="token punctuation">[</span>forbidden_string <span class="token keyword">in</span> response <span class="token keyword">for</span> forbidden_string <span class="token keyword">in</span> self<span class="token punctuation">.</span>forbidden_strings<span class="token punctuation">]</span>
				<span class="token keyword">if</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>forbidden_flags<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
					<span class="token comment"># It indicates that a forbidden string occurs</span>
					finish_flag <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token comment"># Extract AI response text</span>
		ai_box_text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>self<span class="token punctuation">.</span>layout_xpaths<span class="token punctuation">[</span><span class="token string">"ai-box-text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment"># Find AI response text element</span>
		ai_box_text_inner_html <span class="token operator">=</span> ai_box_text<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">"innerHTML"</span><span class="token punctuation">)</span>					<span class="token comment"># Get inner HTML of the element</span>
		response <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_regex<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ai_box_text_inner_html<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n\t "</span><span class="token punctuation">)</span>		<span class="token comment"># Process response text</span>
		<span class="token keyword">return</span> response

	<span class="token comment"># @param data_path: EXCEL file of job descriptions</span>
	<span class="token comment"># @param save_path: file path for storing AI response</span>
	<span class="token comment"># @param model_name: defined in model_card_xpaths</span>
	<span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token string">"chatgpt3.5(16k)"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		driver <span class="token operator">=</span> self<span class="token punctuation">.</span>initialize_driver<span class="token punctuation">(</span>browser<span class="token operator">=</span><span class="token string">"chrome"</span><span class="token punctuation">,</span> headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
		prompt <span class="token operator">=</span> <span class="token string">"给我讲述一下《基督山伯爵》的故事，500字左右。"</span>
		response <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"d:/answer-chatglm.txt"</span></span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
		driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="2023111120231112_1365"></a>20231111~20231112</h3> 
<blockquote> 
 <ul><li>高百净成绩40分12秒，一场等了两年的10km路跑PB</li><li>21年10月，那时我的场地万米只跑进过一次44分，10月1日自测万米时44分出头，10月3日临时被拉去参加高百，选拔赛即跑崩，46分都没跑进，发奋图强，分别在资格赛跑出21’02"的5000米和决赛43’15"（10km）的PB，此后一发不可收拾，11月参加荧光夜跑活动，跟一个骑自行车刷跑量的哥们儿怄气，连续一周每天一个10km（44分以内），12月份迎来了超级大爆发，先是月初队内测试赛场地5000米PB19’59"，中旬自测万米跑出41’15"的PB，下旬操场53圈自测半马，1小时32分40秒，平均配速4’23"，前15km均配都维持在4’20"以内，当时觉得太棒了，22年至少能万米打开40分，踏入业余精英的门槛。</li><li>可是天不遂人愿，疫情的冲击，跑步水平起起落落落落，直到今年暑假与AK、嘉伟坚持1个月强度夏训，才逐渐接近巅峰期，本来上个月底的校运会是奔着5000米PB去跑，希望能冲进19分半，结果前程跑崩连20分都没进，心灰意冷。</li><li>其实今年水平真的很高，路线是环湖两圈（每圈5km），每圈4座桥，还有一个W型坡，难度非常大，总距离略少于10km（少100米），但难度不会比场地万米简单。队里5人跑进40分，两个女生的成绩45分整和48分出头，总用时11小时7分远远超过21年，但别的学校更是出动了精英主力，交大用时9小时58分（平均每个人37分），都屈居第二，因此还是没能取得理想的名次。我在途中更是被浙大和扬大的女生拉爆，尤其是扬大的女生（谢严乐，我记住她的名字了），看起来很瘦弱，明显是很年轻的本科生，我毕竟也是土生土长的扬州人，没想到扬州也有这么强悍的女生，我跟她撕咬了接近2km，谁也超不过谁，最后竟然是我率先不支，败下阵来，她的成绩是39’37"，女子排名第三。</li><li>我的成绩40’12"在最后512人（每个队16人还包括2个女生）中仅能排名245（有4个女生比我快，比21年好多了），强如嘉伟36’35"也排到72名，这次有接近一半的人都打开了40分大关，太可怕。崔洲宸37’56"，宋镇均39’03"发挥出色，李乐康42’12"略微拉胯，另外23级金融专硕吴安迪（本科浙大，这次高百属于是浙大内鬼，才做了2个月上财人）40’55"也很强势，另一个大一新生董祖浩，高中练短跑，这次作为替补上场，10km即跑出47’29"，值得鼓励。</li></ul> 
</blockquote> 
<p>关于selenium的expected_condition</p> 
<ol><li>title_is，判断当前页面的标题是否等于预期，返回布尔值</li><li>title_contains()，判断当前页面的标题是否包含预期字符串</li><li>presence_of_element_located() 判断元素是否被加在DOM树里，并不代表该元素一定可见</li><li>visibility_of_element_located() 判断元素是否可见（可见代表元素非隐藏，并且元素的宽和高都不等于0）</li><li>visibility_of() 判断元素是否可见</li><li>presence_of_all_element_located() 判断是否至少有一个元素存在DOM树中</li><li>text_to_be_present_in_element() 判断某个元素中的text是否包含了预期的字符串</li><li>text_to_be_present_in_element_value() 判断某个元素中的value属性是否包含了预期字符串</li><li>frame_to_be_available_and_switch_to_it() 判断该表单是否可以切换进去，如果可以，返回True并switch进去，否则返回False</li><li>invisibility_of_element_located()判断某个元素是否不存在与DOM树中或不可见</li><li>element_to_be_clickable() 判断元素是否可见并是可以点击的,如果元素存在且可点击，则返回元素，如果元素存在但不可点击，则返回False</li><li>staleness_of() 等到一个元素从DOM树中移除，传入element元素，可以判断页面是否刷新了</li><li>element_to_be_selected() 判断某个元素是否被选中，一般用在下拉列表，传入element元素</li><li>element_selection_state_to_be() 判断某个元素的选中状态是否符合预期，方法参数是element和 is_selected</li><li>element_located_selection_state_to_be() 与element_selection_state_to_be()作用一样，只是方法参数不同，方法参数是located和 is_selected</li><li>alert_is_present() 按断页面上是否存在alert警告</li></ol> 
<hr> 
<h3><a id="2023111320231114_1394"></a>20231113~20231114</h3> 
<blockquote> 
 <ul><li>电脑突然变卡，可是才用了两年，检查了一大圈没发现问题，电脑除了微信钉钉，其他装的都是开源软件，而且是全固态硬盘，Legion系列买的时候还是花了7000多，不至于两年就卡成这样，最后觉得肯定硬件问题，拆壳给风扇去灰，CPU抹了点硅油，终于恢复如初。我发誓再也不买垃圾联想游戏本，反正现在PC机也跑不了什么东西，真不如超薄本商务本实在，DELL惠普的用个五六年都不卡，为了支持国货买了两台联想，除了散热好（可是DELL发热也正常用额），电池耐用，其他真心一般，价格也没啥优势。而且游戏本真的不如商务本好使，还贵辣么多。</li><li>寒冬将至，晚上下班回来冷得要死，都不太想跑（但还是每天晃个十几圈）。这两天发现这边一家哈尔滨老式麻辣烫很好吃，主要是量足，性价比感觉都要比学校麻辣烫高（学校已经从荤素不分23.8元/斤涨到25.8元/斤了，关键是根本没啥荤），但麻辣烫真的不健康，还是少吃了，之前一直都是吃小碗菜，今年比赛都结束了，这两天有点不太节制。</li><li>26号有空准备陪陈嘉伟去参加上马，给他路上补给，嘉伟高百一战，确实也是有点触动，没想到长三角高手这么多，他在上马10km精英赛以36’25"能排到108名（7000人），但高百36’35"仅排72名（512人），11人破34分钟（二级运动员），29人破35分钟，第一名是来自杭州电子科技大学的章侣楠31’21"（这个都快接近一级运动员水平了），要知道这个比赛是禁止注册运动员参赛，因此这些都是业余跑者，嘉伟在财大可以制霸中长跑，但跟其他学校相比还有很大差距，学校人少，跑步氛围也不够，这么看前年我们上海站第八拿奖纯属侥幸，甚至压了复旦一头，想要在高百赛场上有一席之地，要培养新鲜血液，任重道远。</li></ul> 
</blockquote> 
<p>Levenshtein库内存占用太大，小长度建议自己写带缓存的编辑距离函数算，可能大长度的串计算会快一点？</p> 
<pre><code class="prism language-python"><span class="token comment"># @param article_path: Data path saving article dataframe</span>
<span class="token comment"># @param question_path: Data path saving question dataframe</span>
<span class="token comment"># @param source: List or Str, using to filter question dataframe by column source</span>
<span class="token comment"># @param batch_size: Batch size of samples at each yield</span>
<span class="token comment"># @param shuffle: Whether to shuffle question dataframe</span>
<span class="token comment"># @param use_corrected_context: Whether to use column `context_1`(otherwise `context`), some titles in supporting_facts do not exist in context, simply add them to `context` to get `context_1`</span>
<span class="token keyword">def</span> <span class="token function">yield_hotpotqa_batch</span><span class="token punctuation">(</span>article_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
						 question_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
						 source<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
						 batch_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
						 shuffle<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
						 use_corrected_context<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
						 <span class="token punctuation">)</span><span class="token punctuation">:</span>
	context_column <span class="token operator">=</span> <span class="token string">"context_1"</span> <span class="token keyword">if</span> use_corrected_context <span class="token keyword">else</span> <span class="token string">"context"</span>
	<span class="token comment"># Load data and preprocess data</span>
	article_dataframe <span class="token operator">=</span> pandas<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>article_path<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
	article_dataframe<span class="token punctuation">[</span><span class="token string">"sentences"</span><span class="token punctuation">]</span> <span class="token operator">=</span> article_dataframe<span class="token punctuation">[</span><span class="token string">"sentences"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">)</span>
	question_dataframe <span class="token operator">=</span> pandas<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>question_path<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> source <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		filter_flag <span class="token operator">=</span> question_dataframe<span class="token punctuation">[</span><span class="token string">"source"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> question_dataframe<span class="token punctuation">[</span><span class="token string">"source"</span><span class="token punctuation">]</span> <span class="token operator">==</span> source
		question_dataframe <span class="token operator">=</span> question_dataframe<span class="token punctuation">[</span>filter_flag<span class="token punctuation">]</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> shuffle<span class="token punctuation">:</span>
		question_dataframe <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>frac<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	<span class="token comment"># Easy column value process</span>
	<span class="token keyword">def</span> <span class="token function">_easy_process</span><span class="token punctuation">(</span>_column<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> _column <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"context"</span><span class="token punctuation">,</span> <span class="token string">"context_1"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
			_context <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> _value<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			_result <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> _article_id <span class="token keyword">in</span> _context<span class="token punctuation">:</span>
				_result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"id"</span>		<span class="token punctuation">:</span> _article_id<span class="token punctuation">,</span>
								<span class="token string">"title"</span>		<span class="token punctuation">:</span> article_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>_article_id<span class="token punctuation">,</span> <span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
								<span class="token string">"sentences"</span>	<span class="token punctuation">:</span> article_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>_article_id<span class="token punctuation">,</span> <span class="token string">"sentences"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> _result
		<span class="token keyword">if</span> _column <span class="token operator">==</span> <span class="token string">"supporting_facts"</span><span class="token punctuation">:</span>
			_supporting_facts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> _x<span class="token punctuation">:</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> _x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _value<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			_result <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> _article_id<span class="token punctuation">,</span> _sentence <span class="token keyword">in</span> _supporting_facts<span class="token punctuation">:</span>
				_result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"id"</span>		<span class="token punctuation">:</span> _article_id<span class="token punctuation">,</span>
								<span class="token string">"title"</span>		<span class="token punctuation">:</span> article_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>_article_id<span class="token punctuation">,</span> <span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
								<span class="token string">"sentence"</span>	<span class="token punctuation">:</span> _sentence<span class="token punctuation">,</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> _result
		<span class="token keyword">assert</span> <span class="token boolean">False</span><span class="token punctuation">,</span> _column
	<span class="token comment"># Yield batch</span>
	current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
	batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>question_dataframe<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		id_ <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">]</span>
		question <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"question"</span><span class="token punctuation">]</span>
		context <span class="token operator">=</span>  question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> context_column<span class="token punctuation">]</span>
		answer <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"answer"</span><span class="token punctuation">]</span>
		supporting_facts <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"supporting_facts"</span><span class="token punctuation">]</span>
		type_ <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">]</span>
		level <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"level"</span><span class="token punctuation">]</span>
		source <span class="token operator">=</span> question_dataframe<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">"source"</span><span class="token punctuation">]</span>
		batch_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"id"</span>					<span class="token punctuation">:</span> id_<span class="token punctuation">,</span>
						   <span class="token string">"question"</span>			<span class="token punctuation">:</span> question<span class="token punctuation">,</span>
						   <span class="token string">"context"</span>			<span class="token punctuation">:</span> _easy_process<span class="token punctuation">(</span>context_column<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">,</span>
						   <span class="token string">"answer"</span>				<span class="token punctuation">:</span> answer<span class="token punctuation">,</span>
						   <span class="token string">"supporting_facts"</span>	<span class="token punctuation">:</span> _easy_process<span class="token punctuation">(</span><span class="token string">"supporting_facts"</span><span class="token punctuation">,</span> supporting_facts<span class="token punctuation">)</span><span class="token punctuation">,</span>
						   <span class="token string">"type"</span>				<span class="token punctuation">:</span> type_<span class="token punctuation">,</span>
						   <span class="token string">"level"</span>				<span class="token punctuation">:</span> level<span class="token punctuation">,</span>
						   <span class="token string">"source"</span>				<span class="token punctuation">:</span> source<span class="token punctuation">,</span>
						   <span class="token punctuation">}</span><span class="token punctuation">)</span>
		current_batch_size <span class="token operator">+=</span> <span class="token number">1</span>
		<span class="token keyword">if</span> current_batch_size <span class="token operator">==</span> batch_size<span class="token punctuation">:</span>	
			<span class="token keyword">yield</span> batch_data
			current_batch_size <span class="token operator">=</span> <span class="token number">0</span>
			batch_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> current_batch_size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token comment"># Final batch</span>
		<span class="token keyword">yield</span> batch_data
</code></pre> 
<hr> 
<h3><a id="2023111520231116_1479"></a>20231115~20231116</h3> 
<blockquote> 
 <ul><li>最近发现个有趣的问题，准备久违地写篇博客记录一下。</li><li>我好像终于要感冒了，这两天有点冻着，主要组里好多人一直感冒，感觉国庆回来后，好多人咳嗽就一直没好，之前我还是注意防范的，加上每天锻炼，所以一直没中招，但是最近一下子降到10℃以下，连续三天晚上在下面弄到太晚又不加衣服（主要是懒，就硬冻着），还是顶不太住。</li><li>年末没有比赛，这周下班回来都是长裤衬衫跑5000米出头，前天是4’38"的均配，昨天是4’19"的均配，外加200个沙坑箭步跳，今晚跟队少许练了会儿，卢星雨忙了半个月回来终于又参加训练了。前5圈都是穿外套5分配开外慢摇热身，5圈后脱外套提到4’05"~4’15"，其实并没有什么区别，日常训练条件差些，更能提高水平，冬训本来也不追求速度，维持量即可，而且这个量对于下班回来的状态刚刚好，跑完精神得很，其实完全可以跑更远，但是不想太累了。</li><li>这周开始坚持每天吊1分钟杆，以提升背部力量（我吊着得时候很难想象我有力量能把自己拉高哪怕10公分），跑了快四年，对训练有些心得，对自己身体也更加了解，知道想要再有突破需要做什么训练。跑步生涯最后的四个梦想： 
   <ul><li>万米跑进40分钟（高百摸到40分钟的大门后，我坚信自己一定可以破开40分钟大关）</li><li>半马跑进90分钟（需要极好的状态，参加半马比赛的成绩都要比正常水平慢十几分钟，硬实力一定是可以进的）</li><li>全马跑进3小时（现在的跑量还不支持我完成全马，需要一段时间的跑量训练）</li><li>最后是跑一次越野或铁三（大铁或标铁，这个一辈子一次就足够了，身体吃不消，但很想要跑一次）。</li></ul> </li><li>突然被SXY trigger了一下pyq。毕业工作后，职场看到的东西更多，接触的人也更多，生活方式也不同了，以前我见识短，现在相比就更短了。说没有遗憾是假的，也想回到四年前，但人总是要向前看的。</li></ul> 
</blockquote> 
<p>错误记录：<code>ChromeDriver only supports characters in the BMP</code></p> 
<p>原因是<code>send_keys</code>的元素包含了非BMP字符，检查发现：</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token string">"Cathedral of Petr\u00f3polis"</span><span class="token punctuation">:</span> <span class="token string">"The Cathedral of Saint Peter of Alcantara (Portuguese: \"Catedral de S\u00e3o Pedro de Alc\u00e2ntara\" ), also known as the Cathedral of Petr\u00f3polis, is a Roman Catholic cathedral in Petr\u00f3polis, Brazil.\n The cathedral is dedicated to Saint Peter of Alcantara, the patron saint of Brazil.\n Is also home of the Imperial Mausoleum of the Brazilian Imperial Family."</span><span class="token punctuation">}</span>
</code></pre> 
<p>中的<code>\u00e3</code>和<code>u00e2</code>，应该是带变音符号的法语字母。</p> 
<p>解决方案：使用firefox驱动，或者直接执行JS代码</p> 
<pre><code class="prism language-python"><span class="token comment"># 将要执行的代码</span>
JS_ADD_TEXT_TO_INPUT <span class="token operator">=</span> <span class="token triple-quoted-string string">"""var elm = arguments[0], txt = arguments[1];
elm.value += txt;
elm.dispatchEvent(new Event('change'));"""</span>

<span class="token comment"># 将要输入文本的元素（带有非BMP字符）</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
elem <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xxx<span class="token punctuation">(</span><span class="token punctuation">)</span>

text <span class="token operator">=</span> <span class="token string">"\u00e3\u00e2"</span>

browser<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>JS_ADD_TEXT_TO_INPUT<span class="token punctuation">,</span> elem<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
</code></pre> 
<p>另外发现长文本输入会造成阻塞，以至于页面卡死，也是改为执行JS代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># driver.find_element_by_xpath(self.layout_xpaths["input-box"]).send_keys(prompt)			# Input the given prompt</span>

<span class="token comment"># When inputting long text, `element.send_keys` maybe blocked</span>
<span class="token comment"># Use JavaScript or JQuery instead, e.g.</span>
<span class="token comment"># JavaScript: `document.getElementByTagName(&lt;tagName&gt;).value = &lt;value&gt;`</span>
<span class="token comment"># JavaScript: `document.getElementById(&lt;idName&gt;).value = &lt;value&gt;`</span>
<span class="token comment"># JQuery: `$(&lt;xpath&gt;).val(&lt;value&gt;)`</span>
js <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'document.getElementByTagName("textarea").value="</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>prompt<span class="token punctuation">}</span></span><span class="token string">"'</span></span>
dirver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js<span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"  - ok!"</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="20231117_1536"></a>20231117</h3> 
<blockquote> 
 <ul><li>后来昨晚跟队练蛙跳，陪嘉伟和卢星雨慢摇了会儿，最后发现吴安迪，他在拉25km（他中签上马，小伙子很帅气，浙大保过来的金专，现在中信实习，之前已经完赛过厦马，3小时48分，虽然高百成绩不如我，但是我也只是超常发挥，他硬实力或在我之上），陪他干了最后5k，边跑边聊，很健谈，畅快得很。我主要没换鞋子（因为我根本没打算训练），穿的是冬天的厚硬底鞋，太笨重，不好跑也不好蛙跳，导致我今天大腿酸痛得特别厉害，以至于今晚回来只能6分配速（这回真是养生跑了）摇了10圈。</li><li>今天是S空间建成纪念日，3~18层每层都有活动兑换奖品，可惜中午要睡觉只玩了自己这层的，换了一杯水果吃。明天陪嘉伟做上马最后一次长距离拉练（计划是4分半的30km，我估计跑不完，主要是怕他一个人跑太无聊，所以陪他练一次），预祝嘉伟成功破三。</li></ul> 
</blockquote> 
<p>EC的使用</p> 
<pre><code class="prism language-python"><span class="token comment"># 结合显式等待和EC模块实现元素定位</span>
bd_input <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>presence_of_element_located<span class="token punctuation">(</span>input_locator<span class="token punctuation">)</span><span class="token punctuation">)</span>
bd_button <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>presence_of_element_located<span class="token punctuation">(</span>button_loator<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
<span class="token comment"># 5.操作元素</span>
bd_input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"【心善渊&amp;Selenium3.0基础】"</span><span class="token punctuation">)</span>
sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
bd_button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p>字数多，写得太卡了，虽然才写了一个月。</p> 
<p>结篇就不写了，更了一篇博客，想说的都写在后记里了。</p> 
<p>（END）</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/904d957613afad1d62fa538854771af7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">利用虚拟机做Web服务器，使用物理机通过在浏览器输入IP和域名来访问自己做的网站</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a0e12e59e803473da7810356daedf356/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL如何查看锁表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>