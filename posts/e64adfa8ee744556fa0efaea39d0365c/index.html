<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flask Mega-Tutorial V2.0 第17章：在Linux上部署 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Flask Mega-Tutorial V2.0 第17章：在Linux上部署" />
<meta property="og:description" content="最近在Flask Web Development作者博客看到第二版Flask Mega-Tutorial已在2017年底更新，现翻译给大家参考，希望帮助大家学习flask。
这是Flask Mega-Tutorial系列的第十七章，我将把Microblog部署到Linux服务器。
供您参考，以下是本系列文章的列表。
第1章：Hello, World！第2章：模板 第3章：Web表单第4章：数据库第5章：用户登录第6章：配置文件页面和头像第7章：错误处理第8章：关注与被关注第9章：分页第10章：电子邮件支持第11章：整容第12章：日期和时间第13章：I18n和L10n第14章：Ajax第15章：大型应用程序结构第16章：全文搜索第17章：在Linux上部署（本文）第18章：在Heroku上部署第19章：Docker容器上的部署第20章：一些JavaScript Magic第21章：用户通知第22章：后台工作第23章：应用程序编程接口（API） 注意1：如果您正在寻找本教程的旧版本，请在此处。
注意2：如果您想在此博客上支持我的工作，或者只是没有耐心等待每周的文章，我将提供完整的本教程版本，打包成电子书或视频集。欲了解更多信息，请访问courses.miguelgrinberg.com。
在本章中，我将达到Microblog应用生命中的一个里程碑，因为我将讨论在生产服务器上部署该应用的方式，以便真实用户可以访问该应用。
部署的主题很广泛，因此不可能在这里涵盖所有范畴。 本章致力于探讨传统托管方式，包括Ubuntu发行版的Linux服务器和流行的树莓派微机。 我将在后面的章节中介绍其他选项，例如云和容器部署。
本章的GitHub链接是：Browse，Zip，Diff。
传统托管 当我提到“传统托管”时，我的意思是应用是手动或通过原始服务器机器上的脚本安装部署的。该过程涉及安装应用程序，其依赖项和生产规模的Web服务器，并配置系统以使其安全。
当您将要部署自己的项目时，您需要问的第一个问题是在哪里可以找到服务器。目前有很多经济托管服务。例如，Digital Ocean，Linode或Amazon Lightsail会以每月5美元的价格租用一台虚拟Linux服务器，在其中运行您的部署实验（Linode和Digital Ocean为其入门级服务器提供1GB RAM，而Amazon仅提供512MB ）。如果您一分钱都不愿意花，那么Vagrant和VirtualBox这两个工具结合在一起，使可以您在自己的计算机上创建类似于付费服务器的虚拟服务器。
从技术的角度来看，就操作系统的选择而言，此应用程序可以部署在任何主要操作系统上，该列表包括各种各样的开源Linux和BSD发行版以及商业OS X和Microsoft Windows（尽管OS X是基于开源BSD衍生产品Darwin的，它是开源/商业的混合选项）。
由于OS X和Windows是未优化为用作服务器的桌面操作系统，因此我将其作为候选者丢弃。在Linux或BSD操作系统之间进行选择主要取决于喜好，因此，我将选择两种操作系统中最流行的一种，即Linux。至于Linux发行版，我将再次选择流行度，并选择Ubuntu。
创建一个Ubuntu服务器 如果您有兴趣与我一起进行此部署，则显然需要一台服务器来进行工作。我将为您推荐两种选择来购买服务器，一种是付费的，另一种是免费的。如果您愿意花一点钱，可以在Digital Ocean，Linode或Amazon Lightsail上获得一个帐户，然后创建一个Ubuntu 16.04虚拟服务器。您应该使用最小的服务器选项，在我撰写本文时，这三个提供商的费用均为每月5美元。开销是按照服务器启动的小时数进行比例计算的，因此，如果您创建服务器，将其使用几个小时然后删除，则只需支付几分钱。
免费替代方案基于您可以在自己的计算机上运行的虚拟机。要使用此选项，请在计算机上安装Vagrant和VirtualBox，然后创建一个名为Vagrantfile的文件并用以下内容来描述虚拟机的规格：
Vagrantfile：Vagrant配置。
Vagrant.configure(&#34;2&#34;) do |config| config.vm.box = &#34;ubuntu/xenial64&#34; config.vm.network &#34;private_network&#34;, ip: &#34;192.168.33.10&#34; config.vm.provider &#34;virtualbox&#34; do |vb| vb.memory = &#34;1024&#34; end end 该文件配置了一个带有1GB RAM的Ubuntu 16.04服务器，你可以用其IP地址192.168.33.10来访问该服务器。 要创建服务器，请运行以下命令：
$ vagrant up 请查阅Vagrant命令行文档，以了解管理虚拟服务器的其他选项。
使用SSH客户端 您的服务器处于后端，因此不会像在您自己的计算机上那样拥有桌面。您将通过SSH客户端连接到服务器，并通过命令行对其进行操作。如果您使用的是Linux或Mac OS X，则可能已经安装了OpenSSH。如果您使用的是Microsoft Windows，则Cygwin，Git和 Windows Subsystem for Linux 都提供OpenSSH，因此您可以安装这些选项中的任何一个。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/e64adfa8ee744556fa0efaea39d0365c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-20T21:05:33+08:00" />
<meta property="article:modified_time" content="2021-03-20T21:05:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flask Mega-Tutorial V2.0 第17章：在Linux上部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>最近在Flask Web Development作者博客看到第二版Flask Mega-Tutorial已在2017年底更新，现翻译给大家参考，希望帮助大家学习flask。</p> 
</blockquote> 
<p>这是Flask Mega-Tutorial系列的第十七章，我将把Microblog部署到Linux服务器。</p> 
<p>供您参考，以下是本系列文章的列表。</p> 
<ul><li><a href="https://blog.csdn.net/gh254172840/article/details/81409498">第1章：Hello, World！</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410270">第2章：模板</a> </li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410281">第3章：Web表单</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410292">第4章：数据库</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410296">第5章：用户登录</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410299">第6章：配置文件页面和头像</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410299">第7章：错误处理</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410311">第8章：关注与被关注</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410319">第9章：分页</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410325">第10章：电子邮件支持</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410332">第11章：整容</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410334">第12章：日期和时间</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410340">第13章：I18n和L10n</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410341">第14章：Ajax</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410350">第15章：大型应用程序结构</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410355">第16章：全文搜索</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410357">第17章：在Linux上部署</a>（本文）</li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410363">第18章：在Heroku上部署</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410368">第19章：Docker容器上的部署</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410372">第20章：一些JavaScript Magic</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410382">第21章：用户通知</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410386">第22章：后台工作</a></li><li><a href="https://blog.csdn.net/gh254172840/article/details/81410391">第23章：应用程序编程接口（API）</a></li></ul> 
<p><em>注意1：如果您正在寻找本教程的旧版本，请<a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy" rel="nofollow">在此处</a>。</em></p> 
<p><em>注意2：如果您想在此博客上支持我的工作，或者只是没有耐心等待每周的文章，我将提供完整的本教程版本，打包成电子书或视频集。欲了解更多信息，请访问<a href="https://courses.miguelgrinberg.com/" rel="nofollow">courses.miguelgrinberg.com</a>。</em></p> 
<p style="margin-left:0px;"><span style="color:#333333;">在本章中，我将达到Microblog应用生命中的一个里程碑，因为我将讨论在生产服务器上部署该应用的方式，以便真实用户可以访问该应用。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">部署的主题很广泛，</span>因此不可能在这里涵盖所有范畴。 本章致力于探讨传统托管方式，包括Ubuntu发行版的Linux服务器和流行的树莓派微机。 我将在后面的章节中介绍其他选项，例如云和容器部署。</p> 
<p><em>本章的GitHub链接是：<a href="https://github.com/miguelgrinberg/microblog/tree/v0.17">Browse</a>，<a href="https://github.com/miguelgrinberg/microblog/archive/v0.17.zip">Zip</a>，<a href="https://github.com/miguelgrinberg/microblog/compare/v0.16...v0.17">Diff</a>。</em></p> 
<hr> 
<h3 id="%E4%BC%A0%E7%BB%9F%E6%89%98%E7%AE%A1"><span style="color:#333333;">传统托管</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">当我提到“传统托管”时，我的意思是</span>应用是手动或通过原始服务器机器上的脚本安装部署的<span style="color:#333333;">。该过程涉及安装应用程序，其依赖项和生产规模的Web服务器，并配置系统以使其安全。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">当您将要部署自己的项目时，您需要问的第一个问题是在哪里可以找到服务器。目前有很多经济托管服务。例如，<a href="https://www.digitalocean.com/" rel="nofollow">Digital Ocean</a>，<a href="https://www.linode.com/" rel="nofollow">Linode</a>或<a href="https://amazonlightsail.com/" rel="nofollow">Amazon Lightsail</a>会以每月5美元的<a href="https://amazonlightsail.com/" rel="nofollow">价格</a>租用一台虚拟Linux服务器，在其中运行您的部署实验（Linode和Digital Ocean为其入门级服务器提供1GB RAM，而Amazon仅提供512MB ）。如果您一分钱都不愿意花，那么<a href="https://www.vagrantup.com/" rel="nofollow">Vagrant</a>和<a href="https://www.virtualbox.org/" rel="nofollow">VirtualBox</a>这两个工具结合在一起，使可以您在自己的计算机上创建类似于付费服务器的虚拟服务器。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">从技术的角度来看，就操作系统的选择而言，此应用程序可以部署在任何主要操作系统上，该列表包括各种各样的开源Linux和BSD发行版以及商业OS X和Microsoft Windows（尽管OS X是基于开源BSD衍生产品Darwin的，它是开源/商业的混合选项）。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">由于OS X和Windows是未优化为用作服务器的桌面操作系统，因此我将其作为候选者丢弃。在Linux或BSD操作系统之间进行选择主要取决于喜好，因此，我将选择两种操作系统中最流行的一种，即Linux。至于Linux发行版，我将再次选择流行度，并选择Ubuntu。</span></p> 
<h3 id="%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAUbuntu%E6%9C%8D%E5%8A%A1%E5%99%A8"><span style="color:#333333;">创建一个Ubuntu服务器</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您有兴趣与我一起进行此部署，则显然需要一台服务器来进行工作。我将为您推荐两种选择来购买服务器，一种是付费的，另一种是免费的。如果您愿意花一点钱，可以在Digital Ocean，Linode或Amazon Lightsail上获得一个帐户，然后创建一个Ubuntu 16.04虚拟服务器。您应该使用最小的服务器选项，在我撰写本文时，这三个提供商的费用均为每月5美元。</span>开销是按照服务器启动的小时数进行比例计算的<span style="color:#333333;">，因此，如果您创建服务器，将其使用几个小时然后删除，则只需支付几分钱。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">免费替代方案基于您可以在自己的计算机上运行的虚拟机。要使用此选项，请在计算机上安装<a href="https://www.vagrantup.com/" rel="nofollow">Vagrant</a>和<a href="https://www.virtualbox.org/" rel="nofollow">VirtualBox</a>，</span>然后创建一个名为<em>Vagrantfile</em>的文件并用以下内容来描述虚拟机的规格：</p> 
<p style="margin-left:0px;"><span style="color:#333333;"><em>Vagrantfile</em>：</span>Vagrant配置。</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/xenial64"
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.provider "virtualbox" do |vb|
    vb.memory = "1024"
  end
end</code></pre> 
<p style="margin-left:0px;">该文件配置了一个带有1GB RAM的Ubuntu 16.04服务器，你可以用其IP地址192.168.33.10来访问该服务器。 要创建服务器，请运行以下命令：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ vagrant up</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">请查阅Vagrant<a href="https://www.vagrantup.com/docs/cli/" rel="nofollow">命令行文档，</a>以了解管理虚拟服务器的其他选项。</span></p> 
<h3 id="%E4%BD%BF%E7%94%A8SSH%E5%AE%A2%E6%88%B7%E7%AB%AF"><span style="color:#333333;">使用SSH客户端</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">您的服务器</span>处于后端<span style="color:#333333;">，因此不会像在您自己的计算机上那样拥有桌面。您将通过SSH客户端连接到服务器，并通过命令行对其进行操作。如果您使用的是Linux或Mac OS X，则可能已经安装了<a href="http://www.openssh.org/" rel="nofollow">OpenSSH</a>。如果您使用的是Microsoft Windows，则<a href="https://www.cygwin.com/" rel="nofollow">Cygwin</a>，<a href="https://git-scm.com/" rel="nofollow">Git</a>和</span> <a href="https://msdn.microsoft.com/en-us/commandline/wsl/about" rel="nofollow">Windows Subsystem for Linux</a> 都<span style="color:#333333;">提供OpenSSH，因此您可以安装这些选项中的任何一个。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您使用的是来自第三方提供商的虚拟服务器，则在创建服务器时会为其提供IP地址。您可以使用以下命令打开与该服务器的终端会话：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ ssh root@&lt;server-ip-address&gt;</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">系统将提示您输入密码。</span>密码已在创建服务器后自动生成并显示给你，或者你自己指定了密码。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">如果使用的是Vagrant VM，则可以使用以下命令打开终端会话：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ vagrant ssh</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">如果使用Windows并具有Vagrant VM，请注意，</span>你需要从可以调用<code>ssh</code>命令的shell运行上述命令。</p> 
<h3 id="%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95"><span style="color:#333333;">无密码登录</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您使用的是Vagrant VM，则可以跳过本节，因为Vagrant已将VM正确配置为使用名为<code>ubuntu</code>的非root用户帐户，而无需密码。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您使用的是虚拟服务器，建议您创建一个常规用户帐户来进行部署工作，并配置该帐户以不使用密码即可登录，这乍一看似乎是个坏主意，但是您我会发现它不仅更方便，而且更安全。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">我将创建一个名为<code>ubuntu</code>（如果您愿意，可以使用其他名称）的用户帐户。要创建此用户帐户，请使用<code>ssh</code>上一节中的说明登录到服务器的root帐户，然后键入以下命令来创建用户，赋予用户<code>sudo</code>权限并最终切换到该用户：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ adduser --gecos "" ubuntu
$ usermod -aG sudo ubuntu
$ su ubuntu</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">现在，我将配置此新<code>ubuntu</code>帐户以使用<a href="http://en.wikipedia.org/wiki/Public-key_cryptography" rel="nofollow">公共密钥</a>身份验证，以便您无需输入密码即可登录。</span></p> 
<p style="margin-left:0px;">先不管服务器上打开的终端会话，然后在本地计算机上启动第二个终端。 如果你使用的是Windows，这需要是可以访问<code>ssh</code>命令的终端，所以它可能是一个<code>bash</code>或者类似的提示符的终端，而不是本地的Windows终端。 在该终端会话中，检查 <em>~/.ssh</em> 目录的内容：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ ls ~/.ssh
id_rsa  id_rsa.pub</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">如果目录列表显示的文件名为<em>id_rsa</em>和<em>id_rsa.pub</em>，如上所示，则您已经有了一个密钥。如果没有这两个文件，或者根本没有<em>〜/ .ssh</em>目录，则需要通过运行以下命令（也是OpenSSH工具集的一部分）来创建SSH密钥对：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ ssh-keygen</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">该应用将提示您输入一些内容，我建议您通过在所有提示上按Enter接受默认值。如果您知道自己在做什么，而又想做其他设置，那么您当然可以。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">运行此命令后，您应该有上面列出的两个文件。文件<em>id_rsa.pub</em>是您的<em>公共密钥</em>，它是您将提供给第三方以识别您身份的文件。该<em>id_rsa</em>文件是你的<em>私钥</em>，不应与任何人共享。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">现在，您需要将公钥配置为服务器中的<em>授权主机</em>。在您自己的计算机上打开的终端上，将公共密钥打印到屏幕上：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCjw....F8Xv4f/0+7WT miguel@miguelspc</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">这将是一个非常长的字符序列，可能跨越多行。您需要将此数据复制到剪贴板，然后切换回远程服务器上的终端，在该终端上您将发出以下命令来存储公钥：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ echo &lt;paste-your-key-here&gt; &gt;&gt; ~/.ssh/authorized_keys
$ chmod 600 ~/.ssh/authorized_keys</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">无密码登录现在应该可以正常工作了。背后的逻辑是，</span>你机器上的<code>ssh</code>会用私钥执行加密操作来向服务器标识自己<span style="color:#333333;">。然后，服务器使用您的公共密钥验证该操作是否有效。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">现在，您可以注销<code>ubuntu</code>会话，然后从会话中注销<code>root</code>，然后尝试使用以下方法直接登录到<code>ubuntu</code>帐户：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ ssh ubuntu@&lt;server-ip-address&gt;</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">这次您不必输入密码！</span></p> 
<h3 id="%E4%BF%9D%E6%8A%A4%E4%BD%A0%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8"><span style="color:#333333;">保护你的服务器</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">为了最大程度地降低服务器受到攻击的风险，您可以采取一些步骤，直接关闭许多潜在的后门，攻击者可以通过这些后门进行访问。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">我要进行的第一个更改是</span>禁用root用户通过SSH登录<span style="color:#333333;">。现在，您可以无密码访问<code>ubuntu</code>帐户，并且可以通过<code>sudo</code>来从该帐户运行管理员命令，因此实际上不需要暴露root帐户。要禁用root登录，您需要在服务器上编辑</span><em>/etc/ssh/sshd_config</em><span style="color:#333333;">文件。您可能已在服务器中安装了<code>vi</code>和<code>nano</code>文本编辑器，可用于编辑文件（如果您对这两个文件都不熟悉，请先尝试<code>nano</code>）。</span>由于SSH配置对普通用户是不可访问的，所以你需要在编辑器命令前添加<code>sudo</code>（即<code>sudo vi /etc/ssh/sshd_config</code>）。 <span style="color:#333333;">您需要在此文件中更改一行：</span></p> 
<p style="margin-left:0px;"><em>/etc/ssh/sshd_config</em><span style="color:#333333;">：禁用root登录。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">PermitRootLogin no</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">请注意，要进行此更改，您需要找到以<code>PermitRootLogin</code>开头的行</span>（找不到就新建一行），并将该值更改为<code>no</code>。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">下一个更改在同一文件中。现在，我将禁用所有帐户的密码登录。您已设置了无密码登录名，因此根本不需要允许密码。如果您对完全禁用密码感到不安，可以跳过此更改，但是对于生产服务器，这是一个不错的主意，因为攻击者一直在尝试在所有服务器上尝试使用随机的帐户名和密码，</span>并希望能中奖<span style="color:#333333;">。要禁用密码登录，请在</span> <em>/etc/ssh/sshd_config</em> <span style="color:#333333;"><em>中</em>更改以下行：</span></p> 
<p style="margin-left:0px;"> <em>/etc/ssh/sshd_config</em> <span style="color:#333333;">：禁用密码登录。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">PasswordAuthentication no</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">完成SSH配置的编辑后，需要重新启动SSH服务以使更改生效：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo service ssh restart</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">我要进行的第三项更改是安装<em>防火墙</em>。这是一款阻止在未明确启用的任何端口上访问服务器的软件：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo apt-get install -y ufw
$ sudo ufw allow ssh
$ sudo ufw allow http
$ sudo ufw allow 443/tcp
$ sudo ufw --force enable
$ sudo ufw status</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">这些命令将安装<a href="https://wiki.ubuntu.com/UncomplicatedFirewall" rel="nofollow">ufw</a>（简单防火墙），并将其配置为仅允许端口22（ssh），80（http）和443（https）上的外部通信。不允许使用任何其他端口。</span></p> 
<h3 id="%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E4%BE%9D%E8%B5%96%E9%A1%B9"><span style="color:#333333;">安装基本依赖项</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您遵循我的建议并为服务器配置了Ubuntu 16.04版本，那么您的系统将完全支持Python 3.5，因此这是我将用于部署的</span>Python<span style="color:#333333;">版本。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">基本的Python解释器可能已预先安装在您的服务器上，但是可能没有一些额外的软件包，</span>而且Python之外还有一些其他软件包可用于创建健壮的生产环境部署。<span style="color:#333333;">对于数据库服务器，我将从SQLite切换到MySQL。postfix包是一个邮件传输代理，我将使用它来发送电子邮件。</span>Supervisor工具将监视Flask服务器进程，并在其崩溃时自动重启，并当Supervisor服务重启后自动启动其监视的服务。 Nginx服务器将接受来自外部世界的所有请求，并将它们转发给应用程序。 最后，我将使用git来从git仓库下载应用程序。</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo apt-get -y update
$ sudo apt-get -y install python3 python3-venv python3-dev
$ sudo apt-get -y install mysql-server postfix supervisor nginx git</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">这些安装大多在无人值守的情况下运行，但是在运行第三条安装语句时，有时会提示您选择MySQL服务的root密码，并且还会询问一些有关postfix软件包安装的问题。您可以接受其默认答案。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">请注意，对于此部署，我选择不安装Elasticsearch。此服务需要大量的RAM，因此只有在拥有2GB以上RAM的大型服务器时，此服务才可行。为避免服务器内存不足的问题，我将取消搜索功能。如果您有足够大的服务器，则可以从<a href="https://elastic.co/" rel="nofollow">Elasticsearch站点</a>下载官方.deb软件包，然后按照其安装说明将其添加到服务器中。请注意，Ubuntu 16.04软件包存储库中可用的Elasticsearch软件包太旧，无法使用，您需要版本6.x或更高版本。</span></p> 
<p style="margin-left:0px;">我还注意到，默认安装的postfix可能不足以在生产环境中发送电子邮件。 为了避免垃圾邮件和恶意邮件，很多服务器都要求发件人服务器通过安全扩展标识自己，这意味着至少你必须拥有与你的服务器相关联的域名。 如果你想了解如何完全配置电子邮件服务器以使其通过标准安全测试，请参阅以下Digital Ocean的指南：</p> 
<ul><li><a href="http://do.co/2FhdIes" rel="nofollow">Postfix配置</a></li><li><a href="http://do.co/2Ff8ksk" rel="nofollow">添加SPF记录</a></li><li><a href="http://do.co/2HW2oTD" rel="nofollow">DKIM安装和配置</a></li></ul> 
<h3 id="%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span style="color:#333333;">安装应用程序</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">现在，我将用于<code>git</code>从我的GitHub存储库下载Microblog源代码。如果您不熟悉git源代码控制，</span>我建议你阅读<a href="http://ryanflorence.com/git-for-beginners/" rel="nofollow">git for beginners</a>。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">要将应用下载到服务器，请确保您位于<code>ubuntu</code>用户的主目录中，然后运行：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ git clone https://github.com/miguelgrinberg/microblog
$ cd microblog
$ git checkout v0.17</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">这会将代码安装在您的服务器上，并将其同步到本章。如果将本教程代码的版本保留在自己的git存储库中，则可以将存储库URL更改为自己的git，在这种情况下，可以跳过<code>git checkout</code>命令。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">现在，我需要创建一个虚拟环境，并使用所</span>所有的包依赖项来填充它<span style="color:#333333;">，我将它们方便地保存到<a href="https://blog.csdn.net/gh254172840/article/details/81410350">第15章中</a>的<em>requirements.txt</em>文件中：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ python3 -m venv venv
$ source venv/bin/activate
(venv) $ pip install -r requirements.txt</code></pre> 
<p style="margin-left:0px;">除了<em>requirements.txt</em>中的包之外，我还将使用此生产部署指定的两个包，因此它们不包含在<em>requirements.txt</em>文件中。 <code>gunicorn</code>软件包是Python应用程序的生产Web服务器。 <code>pymysql</code>软件包包含MySQL驱动程序，它使SQLAlchemy能够与MySQL数据库一起工作：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">(venv) $ pip install gunicorn pymysql</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">我需要创建一个<em>.env</em>文件，其中包含所有需要的环境变量：</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;"><em>/home/ubuntu/microblog/.env</em>：环境配置。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">SECRET_KEY=52cb883e323b48d78a0a36e8e951ba4a
MAIL_SERVER=localhost
MAIL_PORT=25
DATABASE_URL=mysql+pymysql://microblog:&lt;db-password&gt;@localhost:3306/microblog
MS_TRANSLATOR_KEY=&lt;your-translator-key-here&gt;</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">该<em>.env</em>文件与我在<a href="https://blog.csdn.net/gh254172840/article/details/81410350">第15章中</a>显示的示例最相似，但是我使用了一个随机字符串作为<code>SECRET_KEY</code>。为了生成此随机字符串，我使用了以下命令：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">python3 -c "import uuid; print(uuid.uuid4().hex)"</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">对于<code>DATABASE_URL</code>变量，我定义了一个MySQL URL。在下一节中，我将向您展示如何配置数据库。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">我需要将<code>FLASK_APP</code>环境变量设置为应用的入口点，以使<code>flask</code>命令起作用，但是在解析<em>.env</em>文件之前需要此变量，因此需要手动设置。为了避免每次都要设置它，我将其添加到<code>ubuntu</code>帐户的<em>〜/.profile</em>文件的底部，以便每次登录时自动设置：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ echo "export FLASK_APP=microblog.py" &gt;&gt; ~/.profile</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您注销并重新登录，现在<code>FLASK_APP</code>将为您设置就已经设置好了。您可以通过运行<code>flask --help</code>确认</span>它是否已经设置好了。<span style="color:#333333;">如果帮助消息显示了应用添加的<code>translate</code>命令，则说明已找到该应用。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">既然<code>flask</code>命令已经可以使用了，我就可以编译语言翻译了：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">(venv) $ flask translate compile</code></pre> 
<h3 id="%E8%AE%BE%E7%BD%AEMySQL"><span style="color:#333333;">设置MySQL</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">我在开发过程中使用的sqlite数据库非常适合简单的应用程序，但是当部署功能强大的Web服务器（可能一次需要处理多个请求）时，最好使用功能更强大的数据库。因此，我将建立一个名为<code>microblog</code>的MySQL数据库。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">为了管理数据库服务器，我将使用<code>mysql</code>命令，该命令应该已经安装在您的服务器上：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6
Server version: 5.7.19-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">请注意，您将需要输入在安装MySQL时选择的MySQL超级用户密码，才能访问MySQL命令提示符。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">这些命令将创建一个名为<code>microblog</code>的新数据库，以及一个具有完全访问权限的同名用户：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">mysql&gt; create database microblog character set utf8 collate utf8_bin;
mysql&gt; create user 'microblog'@'localhost' identified by '&lt;db-password&gt;';
mysql&gt; grant all privileges on microblog.* to 'microblog'@'localhost';
mysql&gt; flush privileges;
mysql&gt; quit;</code></pre> 
<p style="margin-left:0px;">你将需要用你选择的密码来替换<code>&lt;db-password&gt;</code><span style="color:#333333;">。这将是<code>microblog</code>数据库用户的密码，因此最好不要使用您为root用户选择的密码。</span><code>microblog</code>用户的密码需要与你包含在 <em>.env</em> 文件中的<code>DATABASE_URL</code>变量中的密码相匹配。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">如果您的数据库配置正确，</span>你现在应该能够运行数据库迁移以创建所有的表：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">(venv) $ flask db upgrade</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">在继续操作之前，请确保上述命令已完成且不会产生任何错误。</span></p> 
<h3 id="%E8%AE%BE%E7%BD%AEGunicorn%E5%92%8CSupervisor%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B"><span style="color:#333333;">设置Gunicorn和</span>Supervisor</h3> 
<p style="margin-left:0px;"><span style="color:#333333;">当使用<code>flask run</code>运行服务器时，您使用的是Flask随附的Web服务器。该服务器在开发过程中非常有用，但不是用于生产服务器的好选择，</span>因为它不考虑性能和稳健性。 取而代之，我决定使用<a href="http://gunicorn.org/" rel="nofollow">gunicorn</a>，它是一个纯粹的Python Web服务器，但与Flask不同，它是一个支持高并发的强大生产服务器，同时它也非常容易使用。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">要在gunicorn下启动Microblog，可以使用以下命令：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">(venv) $ gunicorn -b localhost:8000 -w 4 microblog:app
</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;"><code>-b</code>选项告诉gunicorn在哪里侦听请求，我将其设置为8000端口的内部网络接口。</span> 在没有外部访问的情况下运行Python Web应用程序通常是一个好主意，然后还需要一个非常快速的Web服务器，它可以优化来自客户端的所有静态文件的请求。 这个快速的Web服务器将直接提供静态文件，并将用于应用的任何请求转发到内部服务器。<span style="color:#333333;">在下一节中，我将向您展示如何将nginx设置为面向公众的服务器。</span></p> 
<p style="margin-left:0px;"><code>-w</code>选项配置gunicorn将运行多少<em>worker</em>。 拥有四个进程可以让应用程序同时处理多达四个客户端，这对于Web应用程序通常足以处理大量客户端请求，因为并非所有客户端都在不断请求内容。 根据服务器的RAM大小，你可能需要调整worker数量，以免内存不足。</p> 
<p style="margin-left:0px;"><span style="color:#333333;"><code>microblog:app</code>参数告诉g​​unicorn如何加载应用实例。冒号之前的名称是包含应用的模块，冒号之后的名称是此应用的名称。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">虽然gunicorn的设置非常简单，但是从命令行运行服务器实际上对于生产服务器不是一个好的解决方案。我要做的是让服务器在后台运行，并在不断的监视下进行，因为如果服务器由于某种原因崩溃并退出，我想确保自动启动新服务器来代替它。而且我还想确保如果重新启动计算机，则服务器在启动时会自动运行，而无需人工登录和启动。我将使用上面安装的<a href="http://supervisord.org/" rel="nofollow">supervisor</a>包来执行此操作。</span></p> 
<p style="margin-left:0px;">Supervisor使用配置文件定义它要监视什么程序以及如何在必要时重新启动它们。 配置文件必须存储在 <em>/etc/supervisor/conf.d</em> 中。 这是Microblog的配置文件，我将其称为<em>microblog.conf</em>：</p> 
<p style="margin-left:0px;"><span style="color:#333333;"><em>/etc/supervisor/conf.d/microblog.conf</em>：</span>Supervisor<span style="color:#333333;">配置。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">[program:microblog]
command=/home/ubuntu/microblog/venv/bin/gunicorn -b localhost:8000 -w 4 microblog:app
directory=/home/ubuntu/microblog
user=ubuntu
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;"><code>command</code>，<code>directory<font face="-apple-system, SF UI Text, Arial, PingFang SC, Hiragino Sans GB, Microsoft YaHei, WenQuanYi Micro Hei, sans-serif, SimHei, SimSun">和</font></code><code>user</code>设置告诉supervisor如何运行应用程序。<code>autostart</code>和<code>autorestart</code></span>设置会使microblog自动重新启动<span style="color:#333333;">。在<code>stopasgroup</code>和<code>killasgroup</code></span>选项确保当supervisor需要停止应用程序来重新启动它时，它仍然会调度成顶级gunicorn进程的子进程。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">写入此配置文件后，必须重新加载</span>supervisor<span style="color:#333333;">服务才能将其导入：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo supervisorctl reload</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">就像这样，gunicorn Web服务器应该已启动和运行，并处于监控之中！</span></p> 
<h3 id="%E8%AE%BE%E7%BD%AENginx"><span style="color:#333333;">设置Nginx</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">由gunicorn启动的</span>microblog<span style="color:#333333;">应用服务器现在正在本地端口8000上运行。我现在需要将该应用暴露给外界，</span>为了使面向公众的web服务器能够被访问，我在防火墙上打开了两个端口（80和443）来处理应用程序的Web通信。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">我希望这是一个安全的部署，</span>所以我要配置端口80将所有流量转发到将要加密的端口443。 我将首先创建一个SSL证书。创建一个<em>自签名SSL证书</em>，这对于测试是可以的，但对于真正的部署不太好，因为Web浏览器会警告用户，证书不是由可信证书颁发机构颁发的。 创建microblog的SSL证书的命令是：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ mkdir certs
$ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 \
  -keyout certs/key.pem -out certs/cert.pem</code></pre> 
<p style="margin-left:0px;">该命令将要求你提供关于应用程序和你自己的一些信息。 这些信息将包含在SSL证书中，如果用户请求查看它，Web浏览器则会向用户显示它们。上述命令的结果将是名为<em>key.pem</em>和<em>cert.pem</em>的两个文件，我将其放置在Microblog根目录的<em>certs</em>子目录中。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">要让nginx服务一个网站，您需要为其编写一个配置文件。在大多数nginx安装中，此文件必须位于<em>/etc/nginx/sites-enabled</em>目录中。</span>Nginx在这个位置安装了一个我不需要的测试站点，所以我将首先删除它：</p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo rm /etc/nginx/sites-enabled/default</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">在下面，您可以看到Microblog的nginx配置文件，该文件位于</span> <em>/etc/nginx/sites-enabled/microblog</em> <span style="color:#333333;"><em>中</em>：</span></p> 
<p style="margin-left:0px;"> <em>/etc/nginx/sites-enabled/microblog</em> <span style="color:#333333;">：Nginx配置。</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">server {
    # listen on port 80 (http)
    listen 80;
    server_name _;
    location / {
        # redirect any requests to the same URL but on https
        return 301 https://$host$request_uri;
    }
}
server {
    # listen on port 443 (https)
    listen 443 ssl;
    server_name _;

    # location of the self-signed SSL certificate
    ssl_certificate /home/ubuntu/microblog/certs/cert.pem;
    ssl_certificate_key /home/ubuntu/microblog/certs/key.pem;

    # write access and error logs to /var/log
    access_log /var/log/microblog_access.log;
    error_log /var/log/microblog_error.log;

    location / {
        # forward application requests to the gunicorn server
        proxy_pass http://localhost:8000;
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static {
        # handle static files directly, without forwarding to the application
        alias /home/ubuntu/microblog/app/static;
        expires 30d;
    }
}</code></pre> 
<p style="margin-left:0px;"><span style="color:#333333;">Nginx配置绝非易事，但我添加了一些注释，以便您至少知道每个部分的功能。如果您想获得有关特定指令的信息，请查阅<a href="https://nginx.org/en/docs/" rel="nofollow">nginx官方文档</a>。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">添加此文件后，需要告诉nginx重新加载配置以将其激活：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">$ sudo service nginx reload</code></pre> 
<p style="margin-left:0px;">现在应用程序应该部署成功了。<span style="color:#333333;">在Web浏览器中，您可以键入服务器的IP地址（如果使用的是Vagrant VM，则为192.168.33.10），</span>然后该服务器将连接到应用程序<span style="color:#333333;">。由于您使用的是自签名证书，因此您将从网络浏览器中收到一条警告，必须将其解除。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">针对您自己的项目按照上述说明完成部署后，强烈建议您使用真实的证书替换自签名证书，以便浏览器不会警告用户有关您的站点的信息。为此，您首先需要购买一个域名并将其配置为指向服务器的IP地址。</span>一旦你有一个域名，你可以申请一个免费的<a href="https://letsencrypt.org/" rel="nofollow">Let's Encrypt</a> SSL证书。 我在博客上写了一篇关于如何<a href="https://blog.miguelgrinberg.com/post/running-your-flask-application-over-https" rel="nofollow">通过HTTPS运行你的Flask应用程序</a>的详细文章。</p> 
<h3 id="%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9B%B4%E6%96%B0"><span style="color:#333333;">部署应用更新</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;">关于基于Linux的部署，我要讨论的最后一个主题是如何处理应用升级。应用源代码通过<code>git</code>安装在服务器中，因此，每当您要将应用程序升级到最新版本时，都可以运行<code>git pull</code>以下载自上次部署以来所做的新提交。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">当然，下载新版本的代码不会引起升级。当前正在运行的服务器进程将继续使用已读取并存储在内存中的旧代码运行。要触发升级，您必须停止当前服务器并启动新服务器，以强制再次读取所有代码。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">通常，进行升级比仅重启服务器要复杂得多。您可能需要应用数据库迁移或编译新的语言翻译，因此实际上，执行升级的过程涉及以下命令序列：</span></p> 
<pre class="has" style="margin-left:0px;"><code class="language-prettyprint language-bash">(venv) $ git pull                              # download the new version
(venv) $ sudo supervisorctl stop microblog     # stop the current server
(venv) $ flask db upgrade                      # upgrade the database
(venv) $ flask translate compile               # upgrade the translations
(venv) $ sudo supervisorctl start microblog    # start a new server
</code></pre> 
<h3 id="Raspberry%20Pi%E6%89%98%E7%AE%A1">树莓派<span style="color:#333333;">托管</span></h3> 
<p style="margin-left:0px;"><span style="color:#333333;"><a href="http://www.raspberrypi.org/" rel="nofollow">树莓派</a>是具有非常低的功耗低成本革命性的小台Linux计算机，因此它是</span>托管家庭Web服务器的理想设备<span style="color:#333333;">，可以每天24小时在线而不会占用您的桌面电脑或笔记本电脑。</span>有几个Linux发行版可以在树莓派上运行。 我的选择是<a href="http://www.raspbian.org/" rel="nofollow">Raspbian</a>，这是树莓派基金会的官方发行版。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">为了准备</span>树莓派的环境<span style="color:#333333;">，我将安装一个新的Raspbian版本。我将使用Raspbian Stretch Lite的2017年9月版，但是到您阅读此书时，可能会有较新的版本发布，因此请查看官方<a href="https://www.raspberrypi.org/downloads/raspbian/" rel="nofollow">下载页面</a>以获取最新版本。</span></p> 
<p style="margin-left:0px;">Raspbian镜像需要安装在SD卡上，然后插入树莓派，以便它启动时可以识别到。 在<a href="https://www.raspberrypi.org/documentation/installation/installing-images/" rel="nofollow">树莓派站点</a>上可以查看到从Windows，Mac OS X和Linux将Raspbian镜像复制到SD卡的方法。</p> 
<p style="margin-left:0px;"><span style="color:#333333;">首次启动树莓派时，请在连接键盘和显示器的情况下进行操作，以便进行设置。至少应启用SSH，以便可以从计算机登录以更轻松地执行部署任务。</span></p> 
<p style="margin-left:0px;"><span style="color:#333333;">与Ubuntu一样，Raspbian是Debian的衍生产品，因此上面有关Ubuntu Linux的说明在大多数情况下也适用于树莓派。但是，如果您打算在家庭网络上运行没有外部访问权限的小型应用程序，则可以决定跳过某些步骤。例如，您可能不需要防火墙或无密码登录。您可能想在如此小的计算机上使用SQLite而不是MySQL。</span> 你可以选择不使用nginx，并且让gunicorn服务器直接监听来自客户端的请求。 你可能只想要一个gunicorn worker进程。 Supervisor服务对于确保应用程序始终处于运行状态非常有用，因此我建议你仍然在树莓派上使用它。</p> 
<hr> 
<p>原文链接：<a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvii-deployment-on-linux" rel="nofollow">https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvii-deployment-on-linux</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c4ad5fca2e7a3f74dbb1ced00381aa4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTML</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/faf929cdf5981b247bdda610d0c31b12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flask Mega-Tutorial V2.0 第18章：在Heroku上部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>