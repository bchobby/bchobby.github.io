<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>实战案例，手把手教你用 Python 构建电商用户画像 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="实战案例，手把手教你用 Python 构建电商用户画像" />
<meta property="og:description" content="大家好，本文以真实案为例手把手教你搭建电商系统的用户画像。
先来看该电商用户画像用到的标签。
数据内容包括user_id（用户身份）、item_id（商品）、IDbehavior_type（用户行为类型，包含点击、收藏、加购物车、支付四种行为，分别用数字1、2、3、4表示）、user_geohash（地理位置）、item_category（品类ID，即商品所属的品类）、Time（用户行为发生的时间），其中user_id和item_id因为涉及隐私，做了脱敏处理，显示的是数字编号。
下面是具体的代码实现过程。
导入库 本示例除了用到numpy、pandas、matplotlib，还用到其他一些模块。
# 导入所需的库 %matplotlib inline import numpy as np import pandas as pd from matplotlib import pyplot as plt from datetime import datetime 参数说明如下。
%matplotlib inline： 一个魔法函数，由于%matplotlib inline的存在，当输入plt.plot()后，不必再输入plt.show()，图像将自动显示出来。
datetime： 用来显示时间的模块。
数据准备 # 导入数据集 df_orginal = pd.read_csv(&#39;./taobao_persona.csv&#39;) # 抽取部分数据 df = df_orginal.sample(frac=0.2,random_state=None) 此处使用Pandas的read_csv方法读取数据文件，由于数据集太大，为了提高运行效率，使用sample函数随机抽取20%的数据。
DataFrame.sample()是Pandas中的函数，DataFrame是一种数据格式，代指df_orginal。frac(fraction)是抽取多少数据，random_state是随机数种子，目的是保证每次随机抽取的数据一样，防止执行命令时使用不一样的数据。
数据预处理 # 查看其中是否有缺失值，统计各字段缺失值 df.isnull().any().sum() # 发现只有user_geohash有缺失值，且缺失的比例很高，无统计分析的意义，将此列删 df.drop(&#39;user_geohash&#39;,axis=1,inplace=True) # 将time字段拆分为日期和时段 df[&#39;date&#39;] = df[&#39;time&#39;].str[0:10] df[&#39;time&#39;] = df[&#39;time&#39;].str[11:] df[&#39;time&#39;] = df[&#39;time&#39;].astype(int) # date用str方法取0-9位的字符，time取11位到最后一位，将time转化成int类型。 # 将时段分为&#39;凌晨&#39;,&#39;上午&#39;,&#39;中午&#39;,&#39;下午&#39;,&#39;晚上&#39; df[&#39;hour&#39;] = pd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/eacf248b37074202df823b1d292df36a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-30T09:27:06+08:00" />
<meta property="article:modified_time" content="2022-01-30T09:27:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">实战案例，手把手教你用 Python 构建电商用户画像</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>大家好，本文以真实案为例手把手教你搭建电商系统的用户画像。</p> 
<p>先来看该电商用户画像用到的标签。</p> 
<p>数据内容包括user_id（用户身份）、item_id（商品）、IDbehavior_type（用户行为类型，包含点击、收藏、加购物车、支付四种行为，分别用数字1、2、3、4表示）、user_geohash（地理位置）、item_category（品类ID，即商品所属的品类）、Time（用户行为发生的时间），其中user_id和item_id因为涉及隐私，做了脱敏处理，显示的是数字编号。</p> 
<p>下面是具体的代码实现过程。</p> 
<h3><a id="_13"></a><strong>导入库</strong></h3> 
<p>本示例除了用到numpy、pandas、matplotlib，还用到其他一些模块。</p> 
<pre><code class="prism language-python"><span class="token comment"># 导入所需的库</span>
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
</code></pre> 
<p>参数说明如下。</p> 
<ul><li> <p><strong>%matplotlib inline：</strong> 一个魔法函数，由于%matplotlib inline的存在，当输入plt.plot()后，不必再输入plt.show()，图像将自动显示出来。</p> </li><li> <p><strong>datetime：</strong> 用来显示时间的模块。</p> </li></ul> 
<h3><a id="_42"></a><strong>数据准备</strong></h3> 
<pre><code class="prism language-python"><span class="token comment"># 导入数据集</span>
df_orginal <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./taobao_persona.csv'</span><span class="token punctuation">)</span>
<span class="token comment"># 抽取部分数据</span>
df <span class="token operator">=</span> df_orginal<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>frac<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p>此处使用Pandas的read_csv方法读取数据文件，由于数据集太大，为了提高运行效率，使用sample函数随机抽取20%的数据。</p> 
<p>DataFrame.sample()是Pandas中的函数，DataFrame是一种数据格式，代指df_orginal。frac(fraction)是抽取多少数据，random_state是随机数种子，目的是保证每次随机抽取的数据一样，防止执行命令时使用不一样的数据。</p> 
<h3><a id="_67"></a><strong>数据预处理</strong></h3> 
<pre><code class="prism language-python"><span class="token comment"># 查看其中是否有缺失值，统计各字段缺失值</span>
df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 发现只有user_geohash有缺失值，且缺失的比例很高，无统计分析的意义，将此列删</span>
df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'user_geohash'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 将time字段拆分为日期和时段</span>
df<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment"># date用str方法取0-9位的字符，time取11位到最后一位，将time转化成int类型。</span>
<span class="token comment"># 将时段分为'凌晨','上午','中午','下午','晚上'</span>
df<span class="token punctuation">[</span><span class="token string">'hour'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span>labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'凌晨'</span><span class="token punctuation">,</span><span class="token string">'上午'</span><span class="token punctuation">,</span><span class="token string">'中午'</span><span class="token punctuation">,</span><span class="token string">'下午'</span><span class="token punctuation">,</span><span class="token string">'晚上'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p>结果如图1所示。<br> <img src="https://images2.imgbox.com/81/b9/5nRlKTkB_o.png" alt="图片"></p> 
<p>图1　数据预处理结果</p> 
<pre><code class="prism language-python"><span class="token comment"># 生成用户标签表，制作好的标签都加入这个表中</span>
users <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>users<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><strong>pd.DataFrame()：</strong> 其中数据填充的是users，列名为user_id。</li></ul> 
<p>结果如图2所示。</p> 
<p><img src="https://images2.imgbox.com/9b/33/1QWmX3XJ_o.png" alt="图片"></p> 
<p>图2 制作好的用户ID</p> 
<p>之后分析后的内容都会放置在此表中，相当于建立了一个空白表，将自己分析后的结论一一加入。</p> 
<h3><a id="_117"></a><strong>数构建用户行为标签</strong></h3> 
<p><strong>1）对用户浏览时间段进行分析</strong></p> 
<p>选取出各用户浏览次数最多的时段，看看用户到底在什么时间浏览商品比较多。</p> 
<pre><code class="prism language-python"> <span class="token comment"># 对用户和时段分组，统计浏览次数</span>
time_browse <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'hour'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_id<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
time_browse<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_id'</span><span class="token punctuation">:</span><span class="token string">'hour_counts'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 <span class="token comment"># 统计每个用户浏览次数最多的时段</span>
time_browse_max <span class="token operator">=</span> time_browse<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hour_counts<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
time_browse_max<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'hour_counts'</span><span class="token punctuation">:</span><span class="token string">'read_counts_max'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
time_browse <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>time_browse<span class="token punctuation">,</span>time_browse_max<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
<span class="token comment"># 之前已经按照user_id和hour进行了浏览物品次数的计数统计，现在借用浏览次数统计user_id在</span>
<span class="token comment"># 哪个时间段浏览次数最多，并将其作为该用户的浏览时间标签的代表。</span>
<span class="token comment"># 选取各用户浏览次数最多的时段，如有并列最多的时段，用逗号连接</span>
time_browse_hour<span class="token operator">=</span>time_browse<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>time_browse<span class="token punctuation">[</span><span class="token string">'hour_counts'</span><span class="token punctuation">]</span><span class="token operator">==</span>time_browse<span class="token punctuation">[</span><span class="token string">'read_counts_max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'hour'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>time_browse<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
time_browse_hour<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 将用户浏览活跃时间段加入用户标签表中</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>time_browse_hour<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'hour'</span><span class="token punctuation">:</span><span class="token string">'time_browse'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># labels相当于一张考试卷纸，上面展示的都是最后处理好的结果</span>
</code></pre> 
<p>结果如图3所示。</p> 
<p><img src="https://images2.imgbox.com/30/d3/QktHZGXp_o.png" alt="图片"></p> 
<p>图3 用户浏览时间段</p> 
<ul><li> <p><strong>groupby([‘key1’,‘key2’])：</strong> 多列聚合，分组键为列名。</p> </li><li> <p><strong>reset_index()：</strong> 默认drop=False，可以获得新的index，原来的index变成数据列保留下来，第一列会添加计数的数字，不会使用数据中的index。</p> </li><li> <p><strong>rename()：</strong> 进行重命名，此处将item_id替换成hour_counts，inplace为是否原地填充。</p> </li><li> <p><strong>pd.merge()：</strong> 将两个表合并在一起，横向合并，on代表通过某个主键，how指左合并，每行一一对应。</p> </li><li> <p><strong>loc函数：</strong> 通过行索引Index中的具体值来取指定数据。</p> </li><li> <p><strong>aggregate函数：</strong> groupby分组之后会返回多个子数据帧，该函数可以实现数据聚合，可以得到每个子数据帧的某些列的某些信息。</p> </li><li> <p><strong>lambda函数：</strong> 可以定义一个匿名函数，lambda [arg1[, arg2, … argN]]: expression，其中参数是函数的输入，是可选的，后面的表达式则为输出，此处和join()函数一起用，其中每个x值能被“,”隔开;使用类似的代码可以生成浏览活跃时间段，此处就不再赘述。</p> </li></ul> 
<p><strong>2）关于类目的用户行为。</strong></p> 
<pre><code class="prism language-python">df_browse <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df_collect <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df_cart <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df_buy <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>根据不同的用户行为，如浏览、收藏等，分别导出数据进行分析。</p> 
<pre><code class="prism language-python"> <span class="token comment"># 对用户与类目进行分组，统计浏览次数</span>
df_cate_most_browse <span class="token operator">=</span> df_browse<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_id<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_cate_most_browse<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_id'</span><span class="token punctuation">:</span><span class="token string">'item_category_counts'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 统计每个用户浏览次数最多的类目</span>
df_cate_most_browse_max<span class="token operator">=</span>df_cate_most_browse<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_category_counts<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_cate_most_browse_max<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_category_counts'</span><span class="token punctuation">:</span><span class="token string">'item_category_counts_max'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
df_cate_most_browse <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df_cate_most_browse<span class="token punctuation">,</span>df_cate_most_browse_max<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
<span class="token comment"># 将item_category的数字类型改为字符串型</span>
df_cate_most_browse<span class="token punctuation">[</span><span class="token string">'item_category'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_cate_most_browse<span class="token punctuation">[</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token comment"># 选取各用户浏览次数最多的类目，如有并列最多的类目，用逗号连接</span>
df_cate_browse<span class="token operator">=</span>df_cate_most_browse<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_cate_most_browse<span class="token punctuation">[</span><span class="token string">'item_category_counts'</span><span class="token punctuation">]</span><span class="token operator">==</span>df_cate_most_browse<span class="token punctuation">[</span><span class="token string">'item_category_counts_max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'item_category'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>df_cate_most_browse<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将用户浏览最多的类目加入用户标签表中</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>df_cate_browse<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_category'</span><span class="token punctuation">:</span><span class="token string">'cate_most_browse'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<p>用户浏览最多的类目如图4所示。</p> 
<p><img src="https://images2.imgbox.com/b7/10/Mfw9xVmL_o.png" alt="图片"></p> 
<p>图4　浏览最多的类目</p> 
<p>收藏、加购和购买最多的类目生成逻辑相同，重复操作后结果如图5所示。</p> 
<p><img src="https://images2.imgbox.com/c9/75/ZPt00AGA_o.png" alt="图片"></p> 
<p>图5　关于类目的用户行为</p> 
<p>从整理的数据中可以看出，浏览、加购物车、收藏、购买之前其实不一定存在明显的必然关系，我们还需要进一步分析得到一些规律。</p> 
<p><strong>3）近30天用户行为分析。</strong></p> 
<p>近30天购买次数：</p> 
<pre><code class="prism language-python"><span class="token comment"># 将购买行为按用户进行分组，统计次数</span>
df_counts_30_buy <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_id<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>df_counts_30_buy<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_id'</span><span class="token punctuation">:</span><span class="token string">'counts_30_buy'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>近30天加购次数：</p> 
<pre><code class="prism language-python"><span class="token comment"># 将加购行为按用户进行分组，统计次数</span>
df_counts_30_cart <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_id<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>df_counts_30_cart<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_id'</span><span class="token punctuation">:</span><span class="token string">'counts_30_cart'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>近30天活跃天数：</p> 
<pre><code class="prism language-python"><span class="token comment"># 对用户进行分组，统计活跃的天数，包括浏览、收藏、加购、购买</span>
counts_30_active <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>counts_30_active<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'date'</span><span class="token punctuation">:</span><span class="token string">'counts_30_active'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如图6所示。</p> 
<p><img src="https://images2.imgbox.com/ab/8c/DoMkJ6q2_o.png" alt="图片"></p> 
<p>图6　近30天用户行为</p> 
<p>近30天用户行为分析属于中长期的用户行为，我们可以依此判断是否需要调整营销策略，类似可以得到短期的7天用户行为分析，观察中短期或一个小周期内，用户的行为是何种情况。</p> 
<p><strong>4）最后一次行为距今天数。</strong></p> 
<p>分析上次和本次用户行为的时间差值可以实现精确推荐分析，下面我们来看看具体如何实现。</p> 
<p>上次浏览距今天数：</p> 
<pre><code class="prism language-python">days_browse <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">'2014-12-19'</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>days<span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>days_browse<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'date'</span><span class="token punctuation">:</span><span class="token string">'days_browse'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><strong>datetime.strptime(‘2014-12-19’,’%Y-%m-%d’)-x).days：</strong> 该部分属于lambda中的函数表达式部分，即计算规则，此处最后取相减后的天数总和。</p> </li><li> <p><strong>apply()：</strong> 格式为apply(func,*args,**kwargs)，当一个函数的参数存在于一个元组或者一个字典中时，可间接调用这个函数，并将元组或者字典中的参数按照顺序传递给该函数，返回值就是func函数的返回值。相当于循环遍历，起到处理每一条数据的效果。</p> </li></ul> 
<p>类似可以生成上次加购、购买距今天数，分析得到用户的活跃情况，如图7所示，如果长时间没有活跃，则需要推送一些内容，或者发放优惠券刺激用户。</p> 
<p><img src="https://images2.imgbox.com/a6/45/oxypVuhI_o.png" alt="图片"></p> 
<p>图7　最后一次行为距今天情况统计</p> 
<p><strong>5）最近两次购买间隔天数。</strong></p> 
<pre><code class="prism language-python"> df_interval_buy <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_id<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
 interval_buy <span class="token operator">=</span> df_interval_buy<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
 interval_buy<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> interval_buy<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">.</span>days<span class="token punctuation">)</span>
 interval_buy<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'level_1'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
interval_buy<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'date'</span><span class="token punctuation">:</span><span class="token string">'interval_buy'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>interval_buy<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
</code></pre> 
<p>用购买间隔数分析用户的购买频率，方便确定用户的消费活跃等级，精准制定营销方式。结果如图8所示。</p> 
<p><img src="https://images2.imgbox.com/e8/39/oWOOCQri_o.png" alt="图片"></p> 
<p>图8　最近两次购买间隔天数统计</p> 
<p><strong>6）是否浏览未下单。</strong></p> 
<pre><code class="prism language-python">df_browse_buy<span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'behavior_type'</span><span class="token punctuation">,</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
browse_not_buy<span class="token operator">=</span>pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>df_browse_buy<span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>aggfunc<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
browse_not_buy<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'browse'</span><span class="token punctuation">,</span><span class="token string">'buy'</span><span class="token punctuation">]</span>
browse_not_buy<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 添加了一列browse_not_buy，初始值为0。</span>
browse_not_buy<span class="token punctuation">[</span><span class="token string">'browse_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># 浏览数&gt;0,购买数=0的数据输出1.</span>
browse_not_buy<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>browse_not_buy<span class="token punctuation">[</span><span class="token string">'browse'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>browse_not_buy<span class="token punctuation">[</span><span class="token string">'buy'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'browse_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
browse_not_buy<span class="token operator">=</span>browse_not_buy<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'browse_not_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>browse_not_buy<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">[</span><span class="token string">'browse_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'browse_not_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'是'</span> <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">0</span>  <span class="token keyword">else</span> <span class="token string">'否'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><strong>|：</strong> 在Python语句中表示或，&amp;表示且。</p> </li><li> <p><strong>pd.pivot_table()：</strong> 透视表功能，df_browse_buy为data块，values可以对需要的计算数据进行筛选，aggfunc参数可以设置我们对数据聚合时进行的函数操作。</p> </li><li> <p><strong>fillna：</strong> 会填充NaN数据，返回填充后的结果，inplace=True代表原地填充。</p> </li></ul> 
<p>结果如图9所示。</p> 
<p><img src="https://images2.imgbox.com/e2/b9/RTYsrSPH_o.png" alt="图片"></p> 
<p>图9　是否浏览未下单情况统计</p> 
<p>针对浏览未下单的用户要加大推广力度，可以增加优惠券的发放次数，促进购物。</p> 
<p><strong>7）是否加购未下单。</strong></p> 
<pre><code class="prism language-python"> df_cart_buy<span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">,</span><span class="token string">'behavior_type'</span><span class="token punctuation">,</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
cart_not_buy<span class="token operator">=</span>pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>df_cart_buy<span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">,</span><span class="token string">'item_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>aggfunc<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cart_not_buy<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cart'</span><span class="token punctuation">,</span><span class="token string">'buy'</span><span class="token punctuation">]</span>
cart_not_buy<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
cart_not_buy<span class="token punctuation">[</span><span class="token string">'cart_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
cart_not_buy<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>cart_not_buy<span class="token punctuation">[</span><span class="token string">'cart'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>cart_not_buy<span class="token punctuation">[</span><span class="token string">'buy'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'cart_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
cart_not_buy <span class="token operator">=</span> cart_not_buy<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'cart_not_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>cart_not_buy<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">[</span><span class="token string">'cart_not_buy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'cart_not_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'是'</span> <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">'否'</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如图10所示。</p> 
<p><img src="https://images2.imgbox.com/08/f2/mPUpWpxj_o.png" alt="图片"></p> 
<p>图10　是否加购未下单情况统计</p> 
<p>制定营销策略时，要重点注意这部分人群，因为加购未下单的购买转化率是最大的，有成功下单、最大潜力的客户就在这里。</p> 
<h3><a id="_433"></a><strong>构建用户属性标签</strong></h3> 
<p><strong>1）是否复购用户：</strong></p> 
<pre><code class="prism language-python">buy_again <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'item_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
buy_again<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_id'</span><span class="token punctuation">:</span><span class="token string">'buy_again'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>buy_again<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
labels<span class="token punctuation">[</span><span class="token string">'buy_again'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 未购买的用户标记为'未购买'，有购买未复购的用户标记为'否'，有复购的用户标记为'是'</span>
labels<span class="token punctuation">[</span><span class="token string">'buy_again'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'buy_again'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'是'</span> <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">else</span>   <span class="token string">'否'</span> <span class="token keyword">if</span> x<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">'未购买'</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如图11所示。</p> 
<p><img src="https://images2.imgbox.com/a7/c1/4UCjqTvO_o.png" alt="图片"></p> 
<p>图11　是否复购用户统计</p> 
<p><strong>2）访问活跃度：</strong></p> 
<pre><code class="prism language-python">user_active_level <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'counts_30_active'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
user_active_level<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'30天内访问次数与访问人数的关系'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'访问人数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'访问次数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token comment"># 用于显示中文</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 先将user_active_level全部设置成高，再搜索数值&lt;16的部分，设置成低</span>
labels<span class="token punctuation">[</span><span class="token string">'user_active_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'高'</span>
labels<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>labels<span class="token punctuation">[</span><span class="token string">'counts_30_active'</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">'user_active_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'低'</span>
</code></pre> 
<p>结果如图12所示。</p> 
<p><img src="https://images2.imgbox.com/61/68/ajp8dXTs_o.png" alt="图片"></p> 
<p>图12　30天内访问次数与访问人数的关系</p> 
<ul><li> <p><strong>value_counts()：</strong> 查看表格某列中有多少个不同值，并计算每个不同值在该列中有多少重复值。</p> </li><li> <p><strong>sort_index()：</strong> 按照某一列的大小进行排序，ascending=False是按照从大到小排序。</p> </li><li> <p><strong>plt.figure(figsize=(a,b))：</strong> 创建画板，figsize代表宽为a，高为b的图形，单位为英寸。</p> </li><li> <p><strong>plt.ylabel：</strong> 设置y轴，fontsize是字体大小。</p> </li><li> <p><strong>plt.xlabel：</strong> 设置x轴。</p> </li></ul> 
<p>通过图12可以看出，访问次数多的用户比访问次数少的用户数量多，且以15次左右为拐点，因此定义访问次数小于等于16次的用户为低活跃用户，访问次数大于16次的用户定义为高活跃用户，此定义只是从用户的角度出发，工作中当从业务角度定义。访问次数多的访客比访问次数少的访客数量多，与绝大多数的产品访问规律相反，从侧面反映了用户黏性之强。</p> 
<p><strong>3）购买活跃度：</strong></p> 
<pre><code class="prism language-python">buy_active_level <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'counts_30_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>ascending<span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
buy_active_level<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'30天内购买次数与购买人数的关系'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'购买人数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'购买次数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
labels<span class="token punctuation">[</span><span class="token string">'buy_active_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'高'</span>
labels<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>labels<span class="token punctuation">[</span><span class="token string">'counts_30_buy'</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string">'buy_active_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'低'</span>
</code></pre> 
<p>结果如图13所示。</p> 
<p><img src="https://images2.imgbox.com/f7/3f/U4f57EcQ_o.png" alt="图片"></p> 
<p>图13　30天内购买次数与购买人数的关系</p> 
<p>由图13可知，14次左右是个拐点，因此定义购买次数小于等于14次的用户为低活跃用户，大于14次的用户为高活跃用户。</p> 
<p><strong>4）购买的品类是否单一：</strong></p> 
<pre><code class="prism language-python">buy_single<span class="token operator">=</span>df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'behavior_type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item_category<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
buy_single<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'item_category'</span><span class="token punctuation">:</span><span class="token string">'buy_single'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 
labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>buy_single<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'user_id'</span><span class="token punctuation">)</span>
 
labels<span class="token punctuation">[</span><span class="token string">'buy_single'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

labels<span class="token punctuation">[</span><span class="token string">'buy_single'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'buy_single'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'是'</span> <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">'否'</span> <span class="token keyword">if</span> x<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">'未购买'</span> <span class="token punctuation">)</span>
</code></pre> 
<p>结果如图14所示。</p> 
<p><img src="https://images2.imgbox.com/3a/21/HvNXSVcq_o.png" alt="图片"></p> 
<p>图14　购买品类单一情况统计</p> 
<p>了解用户购买的品类有利于构建用户群体行为，比如该群体统一对化妆品消费占比巨大，则该用户群体的主要特征标签之一就是化妆品。</p> 
<p><strong>5）用户价值分组（RFM模型）：</strong></p> 
<pre><code class="prism language-python">last_buy_days <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'days_buy'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
last_buy_days<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'最后一次购买距今天数与购买人数的关系'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'购买人数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'距今天数'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如图15所示。</p> 
<p><img src="https://images2.imgbox.com/c9/92/8DcF8xgL_o.png" alt="图片"></p> 
<p>图15　最后购买行为距今天数与购买人数的关系</p> 
<p>使用RFM模型分析：</p> 
<pre><code class="prism language-python">labels<span class="token punctuation">[</span><span class="token string">'buy_days_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'高'</span>
labels<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>labels<span class="token punctuation">[</span><span class="token string">'days_buy'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'buy_days_level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'低'</span>
labels<span class="token punctuation">[</span><span class="token string">'rfm_value'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'buy_active_level'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>labels<span class="token punctuation">[</span><span class="token string">'buy_days_level'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">trans_value</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">'高高'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'重要价值客户'</span>
    <span class="token keyword">elif</span> x <span class="token operator">==</span> <span class="token string">'低高'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'重要深耕客户'</span>
    <span class="token keyword">elif</span> x <span class="token operator">==</span> <span class="token string">'高低'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'重要唤回客户'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> 
        <span class="token keyword">return</span> <span class="token string">'即将流失客户'</span>
labels<span class="token punctuation">[</span><span class="token string">'rfm'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token string">'rfm_value'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>trans_value<span class="token punctuation">)</span>
<span class="token comment"># 此处的apply()调用了一个自己定义（def）的函数</span>
labels<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'buy_days_level'</span><span class="token punctuation">,</span><span class="token string">'rfm_value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
labels<span class="token punctuation">[</span><span class="token string">'rfm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如图16所示。</p> 
<p><img src="https://images2.imgbox.com/f9/f0/HqoLWbnX_o.png" alt="图片"></p> 
<p>图16 RFM模型分析结果</p> 
<ul><li> <p><strong>str.cat()</strong> 是指将两个独立的字符串拼接，此处将</p> </li><li> <p><strong>’buy_active_level‘和’buy_days_level’</strong> 拼接。如果要在两个合并的列中间加一个分隔符号，可在cat括号内加：sep=’-’，用-连接合并内容。</p> </li></ul> 
<p>将buy_active_level和buy_days_level组合，形成“高高”或者“高低”等。将两个重要指标合并后，每个user_id进入不同的分类组。RFM模型是衡量客户价值和客户创利能力的重要工具和手段，其中，R(recently)：最近一次消费；F（Frequently）：消费频率；M（Monetary）：消费金额。</p> 
<p>对最后输出的用户群体制定不同的营销策略。针对重要价值客户要予以关注并维护；针对重要深耕用户，予以相应的价格刺激，如折扣和捆绑销售等增加用户的购买频率，提高黏性；针对重要唤回用户，要在特定时间点进行刺激，比如进行产品卖点刺激、品牌灌输等，不断加强他们对品牌的认可，提高忠诚度；针对流失客户，在此例中，因其数量占三分之一左右，需进一步分析得出流失原因。</p> 
<h5><a id="_636"></a>推荐文章</h5> 
<ul><li><a href="https://blog.csdn.net/weixin_38037405/article/details/122367702?spm=1001.2014.3001.5501">上瘾了，最近又给公司撸了一个可视化大屏(附源码)</a></li><li><a href="https://blog.csdn.net/weixin_38037405/article/details/121956510?spm=1001.2014.3001.5501">如此优雅，4款 Python 自动数据分析神器真香啊</a></li><li><a href="https://blog.csdn.net/weixin_38037405/article/details/121805448?spm=1001.2014.3001.5501">梳理半月有余，精心准备了17张知识思维导图，这次要讲清统计学</a></li><li><a href="https://blog.csdn.net/weixin_38037405/article/details/122103186?spm=1001.2014.3001.5501">年终汇总：20份可视化大屏模板，直接套用真香(文末附源码)</a></li></ul> 
<h3><a id="_643"></a>技术交流</h3> 
<p>欢迎转载、收藏、有所收获点赞支持一下！</p> 
<p><img src="https://images2.imgbox.com/cc/e7/qatdzSTQ_o.png" alt="在这里插入图片描述"></p> 
<p>目前开通了技术交流群，群友已超过<strong>2000人</strong>，添加时最好的备注方式为：来源+兴趣方向，方便找到志同道合的朋友</p> 
<ul><li>方式①、发送如下图片至微信，长按识别，后台回复：加群；</li><li>方式②、添加微信号：<strong>dkl88191</strong>，备注：来自CSDN</li><li>方式③、微信搜索公众号：<strong>Python学习与数据挖掘</strong>，后台回复：加群</li></ul> 
<p><img src="https://images2.imgbox.com/39/96/vuYFNACT_o.png" alt="长按关注"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc160b075d560fa170b191428df0c2a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于DBSCAN聚类算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4cd4a294ddf801f8e11997f99915c402/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UVM验证之config_db机制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>