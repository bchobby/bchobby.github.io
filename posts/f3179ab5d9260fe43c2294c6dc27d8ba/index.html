<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【头歌实训】kafka-入门篇 - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【头歌实训】kafka-入门篇" />
<meta property="og:description" content="文章目录 第1关：kafka - 初体验任务描述相关知识Kafka 简述Kafka 应用场景Kafka 架构组件kafka 常用命令 编程要求测试说明答案代码 第2关：生产者 （Producer ） - 简单模式任务描述相关知识Producer 简单模式Producer 的开发步骤Kafka 常用配置参数 编程要求测试说明答案代码 第3关：消费者（ Consumer）- 自动提交偏移量任务描述相关知识Kafka 消费者开发步骤自动提交偏移量的优劣 编程要求测试说明答案代码 第4关：消费者（ Consumer ）- 手动提交偏移量任务描述相关知识Kafka 两种手动提交方式 编程要求测试说明答案代码 第1关：kafka - 初体验 任务描述 本关任务：使用 Kafka 命令创建一个副本数量为1、分区数量为3的 Topic 。
相关知识 为了完成本关任务，你需要掌握：1.如何使用 Kafka 的常用命令。
课程视频《Kafka简介》
Kafka 简述 类 JMS 消息队列，结合 JMS 中的两种模式，可以有多个消费者主动拉取数据，在 JMS 中只有点对点模式才有消费者主动拉取数据。
Kafka 是一个生产-消费模型。
Producer ：消息生产者，就是向 Kafka Broker 发消息的客户端。
Consumer ：消息消费者，向 Kafka Broker 取消息的客户端。
Topic ：我们可以理解为一个队列。
Consumer Group （CG）：这是 Kafka 用来实现一个 Topic 消息的广播（发给所有的 Consumer ）和单播（发给任意一个 Consumer ）的手段。一个 Topic 可以有多个CG。Topic 的消息会复制（不是真的复制，是概念上的）到所有的 CG ，但每个 Partion 只会把消息发给该 CG 中的一个 Consumer 。如果需要实现广播，只要每个 Consumer 有一个独立的 CG 就可以了。要实现单播只要所有的 Consumer 在同一个 CG。用CG 还可以将 Consumer 进行自由的分组而不需要多次发送消息到不同的 Topic。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/f3179ab5d9260fe43c2294c6dc27d8ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T22:33:59+08:00" />
<meta property="article:modified_time" content="2023-12-28T22:33:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【头歌实训】kafka-入门篇</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1kafka___1" rel="nofollow">第1关：kafka - 初体验</a></li><li><ul><li><a href="#_3" rel="nofollow">任务描述</a></li><li><a href="#_7" rel="nofollow">相关知识</a></li><li><ul><li><a href="#Kafka__14" rel="nofollow">Kafka 简述</a></li><li><a href="#Kafka__34" rel="nofollow">Kafka 应用场景</a></li><li><a href="#Kafka__43" rel="nofollow">Kafka 架构组件</a></li><li><a href="#kafka__49" rel="nofollow">kafka 常用命令</a></li></ul> 
   </li><li><a href="#_64" rel="nofollow">编程要求</a></li><li><a href="#_81" rel="nofollow">测试说明</a></li><li><a href="#_89" rel="nofollow">答案代码</a></li></ul> 
  </li><li><a href="#2_Producer____117" rel="nofollow">第2关：生产者 （Producer ） - 简单模式</a></li><li><ul><li><a href="#_119" rel="nofollow">任务描述</a></li><li><a href="#_123" rel="nofollow">相关知识</a></li><li><ul><li><a href="#Producer__131" rel="nofollow">Producer 简单模式</a></li><li><a href="#Producer__135" rel="nofollow">Producer 的开发步骤</a></li><li><a href="#Kafka__152" rel="nofollow">Kafka 常用配置参数</a></li></ul> 
   </li><li><a href="#_163" rel="nofollow">编程要求</a></li><li><a href="#_167" rel="nofollow">测试说明</a></li><li><a href="#_171" rel="nofollow">答案代码</a></li></ul> 
  </li><li><a href="#3_Consumer__252" rel="nofollow">第3关：消费者（ Consumer）- 自动提交偏移量</a></li><li><ul><li><a href="#_254" rel="nofollow">任务描述</a></li><li><a href="#_258" rel="nofollow">相关知识</a></li><li><ul><li><a href="#Kafka__262" rel="nofollow">Kafka 消费者开发步骤</a></li><li><a href="#_296" rel="nofollow">自动提交偏移量的优劣</a></li></ul> 
   </li><li><a href="#_303" rel="nofollow">编程要求</a></li><li><a href="#_307" rel="nofollow">测试说明</a></li><li><a href="#_311" rel="nofollow">答案代码</a></li></ul> 
  </li><li><a href="#4_Consumer___365" rel="nofollow">第4关：消费者（ Consumer ）- 手动提交偏移量</a></li><li><ul><li><a href="#_367" rel="nofollow">任务描述</a></li><li><a href="#_371" rel="nofollow">相关知识</a></li><li><ul><li><a href="#Kafka__375" rel="nofollow">Kafka 两种手动提交方式</a></li></ul> 
   </li><li><a href="#_387" rel="nofollow">编程要求</a></li><li><a href="#_391" rel="nofollow">测试说明</a></li><li><a href="#_395" rel="nofollow">答案代码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1kafka___1"></a>第1关：kafka - 初体验</h2> 
<h3><a id="_3"></a>任务描述</h3> 
<p>本关任务：使用 Kafka 命令创建一个副本数量为<code>1</code>、分区数量为<code>3</code>的 Topic 。</p> 
<h3><a id="_7"></a>相关知识</h3> 
<p>为了完成本关任务，你需要掌握：1.如何使用 Kafka 的常用命令。</p> 
<p><a href="https://video.educoder.net/sv/619118c-176279bdc24/619118c-176279bdc24.mp4" rel="nofollow">课程视频《Kafka简介》</a></p> 
<h4><a id="Kafka__14"></a>Kafka 简述</h4> 
<p>类 JMS 消息队列，结合 JMS 中的两种模式，可以有多个消费者主动拉取数据，在 JMS 中只有点对点模式才有消费者主动拉取数据。</p> 
<p>Kafka 是一个生产-消费模型。</p> 
<p>Producer ：消息生产者，就是向 Kafka Broker 发消息的客户端。</p> 
<p>Consumer ：消息消费者，向 Kafka Broker 取消息的客户端。</p> 
<p>Topic ：我们可以理解为一个队列。</p> 
<p>Consumer Group （CG）：这是 Kafka 用来实现一个 Topic 消息的广播（发给所有的 Consumer ）和单播（发给任意一个 Consumer ）的手段。一个 Topic 可以有多个CG。Topic 的消息会复制（不是真的复制，是概念上的）到所有的 CG ，但每个 Partion 只会把消息发给该 CG 中的一个 Consumer 。如果需要实现广播，只要每个 Consumer 有一个独立的 CG 就可以了。要实现单播只要所有的 Consumer 在同一个 CG。用CG 还可以将 Consumer 进行自由的分组而不需要多次发送消息到不同的 Topic。</p> 
<p>Broker ：一台 Kafka 服务器就是一个 Broker 。一个集群由多个Broker组成。一个 Broker 可以容纳多个 Topic。</p> 
<p>Partition ：为了实现扩展性，一个非常大的 Topic 可以分布到多个Broker（即服务器）上，一个 Topic 可以分为多个 Partition ，每个 Partition 是一个有序的队列。Partition 中的每条消息都会被分配一个有序的 Id（ Offset ）。Kafka 只保证按一个 Partition 中的顺序将消息发给 Consumer ，不保证一个 Topic 的整体（多个 Partition间）的顺序。</p> 
<p>Offset ：Kafka 的存储文件都是按照 Offset . index 来命名，用Offset 做名字的好处是方便查找。例如你想找位于<code>2049</code>的位置，只要找到 2048 . index 的文件即可。当然 the first offset 就是 00000000000 . index。</p> 
<h4><a id="Kafka__34"></a>Kafka 应用场景</h4> 
<ul><li>日志收集：一个公司可以用 Kafka 可以收集各种服务的 Log ，通过Kafka 以统一接口服务的方式开放给各种 Consumer ，例如 Hadoop 、Hbase 、Solr 等。</li><li>消息系统：解耦和生产者和消费者、缓存消息等。</li><li>用户活动跟踪：Kafka 经常被用来记录 Web 用户或者 App 用户的各种活动，如浏览网页、搜索、点击等活动，这些活动信息被各个服务器发布到 Kafka 的Topic 中，然后订阅者通过订阅这些 Topic 来做实时的监控分析，或者装载到 Hadoop 、数据仓库中做离线分析和挖掘。</li><li>运营指标：Kafka 也经常用来记录运营监控数据。包括收集各种分布式应用的数据，生产各种操作的集中反馈，比如报警和报告。</li><li>流式处理：比如 Spark streaming 和 Storm、Flink。</li><li>事件源。</li></ul> 
<h4><a id="Kafka__43"></a>Kafka 架构组件</h4> 
<p>Kafka 中发布订阅的对象是 Topic。我们可以为每类数据创建一个 Topic ，把向 Topic 发布消息的客户端称作 Producer ，从 Topic 订阅消息的客户端称作 Consumer 。Producers 和 Consumers 可以同时从多个 Topic 读写数据。一个 Kafka 集群由一个或多个 Broker 服务器组成，它负责持久化和备份具体的 Kafka 消息。</p> 
<p><img src="https://images2.imgbox.com/b7/ef/g6yJyoVm_o.png" alt="img"></p> 
<h4><a id="kafka__49"></a>kafka 常用命令</h4> 
<ul><li>查看当前服务器中的所有 Topic <code>bin/kafka-topics.sh --list --zookeeper zk01:2181</code></li><li>创建 Topic <code>./kafka-topics.sh --create --zookeeper zk01:2181 --replication-factor 1 --partitions 3 --topic first</code></li></ul> 
<p><em>说明：<code>replication-factor</code> 是指副本数量，<code>partitions</code> 是指分区数量</em></p> 
<ul><li>删除 Topic <code>bin/kafka-topics.sh --delete --zookeeper zk01:2181 --topic test</code> 需要 <code>server.properties</code> 中设置 <code>delete.topic.enable = true</code> 否则只是标记删除或者直接重启。</li><li>通过 Shell 命令发送消息 <code>kafka-console-producer.sh --broker-list kafka01:9092 --topic demo</code></li><li>通过 Shell 消费消息 <code>bin/kafka-console-consumer.sh --zookeeper zk01:2181 --from-beginning --topic test1</code></li><li>查看消费位置 <code>kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper zk01:2181 --group testGroup</code></li><li>查看某个 Topic 的详情 <code> kafka-topics.sh --topic test --describe --zookeeper zk01:2181</code></li></ul> 
<p>说明 ：此处的 <code>zk01</code> 是 Zookeeper 的 IP 地址， <code>kafka01</code> 是 Broker 的 IP 地址</p> 
<h3><a id="_64"></a>编程要求</h3> 
<p>根据提示，在右侧编辑器补充代码完成以下任务。</p> 
<ul><li>创建一个副本数量为<code>1</code>、分区数量为<code>3</code>、名为 <code>demo</code> 的 Topic</li><li>查看所有 Topic</li><li>查看名为 <code>demo</code> 的 Topic 的详情信息</li></ul> 
<p>注意：Broker 的 IP 为127.0.0.1，Zookeeper 的 IP 为127.0.0.1</p> 
<p>扩展任务：</p> 
<ul><li>使用一个命令行开启 Kafka Producer Shell 窗口并对名为 <code>demo</code> 的 Topic 进行数据生产</li><li>使用另一个命令行开启 Kafka Customer Shell 窗口并对名为 <code>demo</code> 的 Topic进行消费</li></ul> 
<p>说明：扩展任务没有进行评测，此任务目的是为了让用户体验下 Kafka 的数据生产与数据消费的两个环节，更好理解 Kafka</p> 
<h3><a id="_81"></a>测试说明</h3> 
<p>平台会对你的命令进行检验并运行，你只需要按照任务需求，补充右侧编辑器的代码，然后点击评测就ok了。 - -</p> 
<p><em><strong>特别注意：为了确保运行拥有一个正常的运行环境，请在评测之前，重置下运行环境</strong></em></p> 
<p><img src="https://images2.imgbox.com/e9/98/ivN6hoOb_o.png" alt="img"></p> 
<h3><a id="_89"></a>答案代码</h3> 
<p>命令行代码</p> 
<pre><code class="prism language-sh">kafka-server-start.sh  /opt/kafka_2.11-1.1.0/config/server.properties
</code></pre> 
<p><code>shell</code> 文件</p> 
<pre><code class="prism language-sh"><span class="token shebang important">#!/bin/bash</span>
 
<span class="token comment">#1.创建一个副本数量为1、分区数量为3、名为 demo 的 Topic</span>
kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 --replication-factor <span class="token number">1</span> <span class="token parameter variable">--partitions</span> <span class="token number">3</span> <span class="token parameter variable">--topic</span> demo
 
<span class="token comment">#2.查看所有Topic</span>
kafka-topics.sh <span class="token parameter variable">--list</span> <span class="token parameter variable">--zookeeper</span>  <span class="token number">127.0</span>.0.1:2181
 
<span class="token comment">#3.查看名为demo的Topic的详情信息</span>
kafka-topics.sh <span class="token parameter variable">--topic</span> demo <span class="token parameter variable">--describe</span> <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181
 
</code></pre> 
<h2><a id="2_Producer____117"></a>第2关：生产者 （Producer ） - 简单模式</h2> 
<h3><a id="_119"></a>任务描述</h3> 
<p>本关任务：编写一个 Kafka 的 Producer 进行数据生产。</p> 
<h3><a id="_123"></a>相关知识</h3> 
<p>为了完成本关任务，你需要掌握：1.如何使用 Kafka 的 Producer API 进行数据生产。</p> 
<p>课程视频《使用Python生产消费kafka的数据》</p> 
<h4><a id="Producer__131"></a>Producer 简单模式</h4> 
<p>Producer 采用默认分区方式将消息散列的发送到各个分区当中。</p> 
<h4><a id="Producer__135"></a>Producer 的开发步骤</h4> 
<ol><li> <p>创建配置文件对象<code> Properties props = new Properties();</code></p> </li><li> <p>设置连接 Kakfa 的基本参数，如下：</p> <pre><code class="prism language-py">props<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"kafka-01:9092,kafka-02:9092,kafka-03:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
props<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"acks"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
props<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
props<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>创建 Kafka 生产者对象<code>Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);</code></p> </li><li> <p>发送消息<code>producer.send(new ProducerRecord&lt;String, String&gt;("Topic", "key", "value"));</code></p> </li></ol> 
<h4><a id="Kafka__152"></a>Kafka 常用配置参数</h4> 
<table><thead><tr><th>名称</th><th>说明</th><th>默认值</th><th>有效值</th><th>重要性</th></tr></thead><tbody><tr><td>bootstrap.servers</td><td>kafka集群的broker-list，如： hadoop01:9092,hadoop02:9092</td><td>无</td><td></td><td>必选</td></tr><tr><td>key.serializer</td><td>key的序列化器</td><td></td><td>ByteArraySerializer StringSerializer</td><td>必选</td></tr><tr><td>value.serializer</td><td>value的序列化器</td><td></td><td>ByteArraySerializer StringSerializer</td><td>必选</td></tr><tr><td>acks</td><td>确保生产者可靠性设置，有三个选项： acks=0：不等待成功返回 acks=1：等Leader写成功返回 acks=all：等Leader和所有ISR中的Follower写成功返回，all也可以用-1代替</td><td>-1</td><td>0,1,-1,all</td><td>建议必选</td></tr><tr><td>buffer.memory</td><td>Producer总体内存大小</td><td>33554432</td><td>不要超过物理内存，根据实际情况调整</td><td>建议必选</td></tr><tr><td>batch.size</td><td>每个partition的未发送消息大小</td><td>16384</td><td>根据实际情况调整</td><td>建议必选</td></tr></tbody></table> 
<h3><a id="_163"></a>编程要求</h3> 
<p>根据提示，在右侧编辑器补充代码，使用 Kafka Producer API 对名为 <code>demo</code> 的 Topic 进行数据生产。</p> 
<h3><a id="_167"></a>测试说明</h3> 
<p>平台会对你的命令进行检验并运行，你只需要按照任务需求，补充右侧编辑器的代码，然后点击评测就ok了。 - -</p> 
<h3><a id="_171"></a>答案代码</h3> 
<p>用 <code>conf/server.properties</code> ，如果用 <code>config/server.properties</code> 的话需要把 <code>log.dirs</code> 和 <code>num.partitions</code> 这两个配置改了</p> 
<pre><code class="prism language-sh"><span class="token builtin class-name">cd</span> <span class="token variable">$KAFKA_HOME</span>/
<span class="token function">vim</span> config/server.properties

<span class="token comment"># 使用 :/log.dirs 找到位置，或者直接 :$ 在最后一行加 </span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/export/servers/logs/kafka/
<span class="token assign-left variable">num.partitions</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre> 
<p>命令行执行代码</p> 
<pre><code class="prism language-sh"><span class="token comment"># kafka 依赖 zookeeper，所以需要先启动 zookeeper 服务</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$ZOOKEEPER_HOME</span>/
bin/zkServer.sh start conf/zoo.cfg
<span class="token comment"># 启动 Kafka 服务</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$KAFKA_HOME</span>/
bin/kafka-server-start.sh <span class="token parameter variable">-daemon</span> conf/server.properties
</code></pre> 
<p><code>Java</code> 代码</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>educoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token comment">/**
 * kafka producer 简单模式
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 1.创建配置文件对象，一般采用 Properties
         */</span>
        <span class="token comment">/**----------------begin-----------------------*/</span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------end-------------------------*/</span>
        <span class="token comment">/**
         * 2.设置kafka的一些参数
         *          bootstrap.servers --&gt; kafka的连接地址 127.0.0.1:9092
         *          key、value的序列化类 --&gt;org.apache.kafka.common.serialization.StringSerializer
         *          acks：1，-1,0
         */</span>
        <span class="token comment">/**-----------------begin-----------------------*/</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"acks"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------end-------------------------*/</span>
        <span class="token comment">/**
         * 3.构建kafkaProducer对象
         */</span>
        <span class="token comment">/**-----------------begin-----------------------*/</span>
        <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------end-------------------------*/</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/**
             * 4.发送消息
             */</span>
            <span class="token comment">/**-----------------begin-----------------------*/</span>
            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/**-----------------end-------------------------*/</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<h2><a id="3_Consumer__252"></a>第3关：消费者（ Consumer）- 自动提交偏移量</h2> 
<h3><a id="_254"></a>任务描述</h3> 
<p>本关任务：编写一个 Kafka 消费者并设置自动提交偏移量进行数据消费。</p> 
<h3><a id="_258"></a>相关知识</h3> 
<p>为了完成本关任务，你需要掌握：1.如何编写 Kafka 消费者，2.如何使用自动提交偏移量。</p> 
<h4><a id="Kafka__262"></a>Kafka 消费者开发步骤</h4> 
<ol><li> <p>创建配置文件对象 <code>Properties props = new Properties();</code></p> </li><li> <p>设置连接 Kakfa 的基本参数，如下：</p> <pre><code class="prism language-java"><span class="token comment">//设置kafka集群的地址</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9092</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置消费者组，组名字自定义，组名字相同的消费者在一个组</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"group.id"</span><span class="token punctuation">,</span> <span class="token string">"g1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//开启offset自动提交</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enable.auto.commit"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//自动提交时间间隔</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"auto.commit.interval.ms"</span><span class="token punctuation">,</span> <span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//序列化器</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>创建 Kafka 消费者对象 <code>KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);</code></p> </li><li> <p>订阅主题 Topic <code>consumer.subscribe(Arrays.asList("demo"));</code></p> </li><li> <p>消费 Topic 的数据</p> <pre><code class="prism language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"offset = %d, key = %s, value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h4><a id="_296"></a>自动提交偏移量的优劣</h4> 
<p>消费者拉取数据之后自动提交偏移量，不关心后续对消息的处理是否正确。</p> 
<ul><li>优点：消费快，适用于数据一致性弱的业务场景</li><li>缺点：消息很容易丢失</li></ul> 
<h3><a id="_303"></a>编程要求</h3> 
<p>使用 Kafka Consumer API 对名为 <code>demo</code> 的 <code>Topic</code> 进行消费，并设置自动提交偏移量。</p> 
<h3><a id="_307"></a>测试说明</h3> 
<p>平台会对你的命令进行检验并运行，你只需要按照任务需求，补充右侧编辑器的代码，然后点击评测就 ok 了。 - -</p> 
<h3><a id="_311"></a>答案代码</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>educoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecords</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">KafkaConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**--------------begin----------------*/</span>
        <span class="token comment">//1.设置kafka集群的地址</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.设置消费者组，组名字自定义，组名字相同的消费者在一个组</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"group.id"</span><span class="token punctuation">,</span> <span class="token string">"g1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.开启offset自动提交</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enable.auto.commit"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.自动提交时间间隔</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"auto.commit.interval.ms"</span><span class="token punctuation">,</span> <span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.序列化器</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**---------------end---------------*/</span>
        <span class="token comment">/**--------------begin----------------*/</span>
        <span class="token comment">//6.创建kafka消费者</span>
        <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//7.订阅kafka的topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**---------------end---------------*/</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">/**----------------------begin--------------------------------*/</span>
            <span class="token comment">//8.poll消息数据,返回的变量为crs</span>
            <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> crs <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cr <span class="token operator">:</span> crs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consume data:"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/**----------------------end--------------------------------*/</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="4_Consumer___365"></a>第4关：消费者（ Consumer ）- 手动提交偏移量</h2> 
<h3><a id="_367"></a>任务描述</h3> 
<p>本关任务：编写一个 Kafka 消费者并使用手动提交偏移量进行数据消费。</p> 
<h3><a id="_371"></a>相关知识</h3> 
<p>为了完成本关任务，你需要掌握：1.如何编写 Kafka 消费者，2.如何手动提交偏移量。</p> 
<h4><a id="Kafka__375"></a>Kafka 两种手动提交方式</h4> 
<ol><li>异步提交( CommitAsync )：</li></ol> 
<p>异步模式下，提交失败也不会尝试提交。消费者线程不会被阻塞，因为异步操作，可能在提交偏移量操作结果未返回时就开始下一次拉取操作。</p> 
<ol><li>同步提交( CommitSync )：</li></ol> 
<p>同步模式下，提交失败时一直尝试提交，直到遇到无法重试才结束。同步方式下，消费者线程在拉取消息时会被阻塞，直到偏移量提交操作成功或者在提交过程中发生错误。</p> 
<p>注意：实现手动提交前需要在创建消费者时关闭自动提交，设置<code>enable.auto.commit=false</code></p> 
<h3><a id="_387"></a>编程要求</h3> 
<p>根据提示，在右侧编辑器补充代码，使用 Kafka Producer API 对名为 <code>demo</code> 的 Topic 进行数据生产</p> 
<h3><a id="_391"></a>测试说明</h3> 
<p>平台会对你的命令进行检验并运行，你只需要按照任务需求，补充右侧编辑器的代码，然后点击评测就ok了。 - -</p> 
<h3><a id="_395"></a>答案代码</h3> 
<p>命令行代码</p> 
<pre><code class="prism language-sh"><span class="token comment"># kafka 依赖 zookeeper，所以需要先启动 zookeeper 服务</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$ZOOKEEPER_HOME</span>/
bin/zkServer.sh start conf/zoo.cfg
<span class="token comment"># 启动 Kafka 服务</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$KAFKA_HOME</span>/
bin/kafka-server-start.sh <span class="token parameter variable">-daemon</span> conf/server.properties
</code></pre> 
<p><code>Java</code> 代码</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>educoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumerRecords</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">KafkaConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------begin------------------------*/</span>
        <span class="token comment">//1.设置kafka集群的地址</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.设置消费者组，组名字自定义，组名字相同的消费者在一个组</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"group.id"</span><span class="token punctuation">,</span> <span class="token string">"g1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.关闭offset自动提交</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enable.auto.commit"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.序列化器</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------end------------------------*/</span>
        <span class="token comment">/**-----------------begin------------------------*/</span>
        <span class="token comment">//5.实例化一个消费者</span>
        <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.消费者订阅主题，订阅名为demo的主题</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**-----------------end------------------------*/</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> minBatchSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConsumerRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                buffer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> minBatchSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span> bf <span class="token operator">:</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"offset = %d, key = %s, value = %s%n"</span><span class="token punctuation">,</span> bf<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bf<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bf<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">/**-----------------begin------------------------*/</span>
                <span class="token comment">//7.手动提交偏移量</span>
                consumer<span class="token punctuation">.</span><span class="token function">commitSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">/**-----------------end------------------------*/</span>
                buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8eb0969f0c314e2c5a5f508ee2f94067/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Crypto API - 9.1 编程接口-块密码算法定义</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a57e8c0e19f2c6f30fb08de9fa113be3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第十二章 Sleuth分布式请求链路跟踪</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>