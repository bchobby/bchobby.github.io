<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch：如何在 Django 中使用 Elasticsearch - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch：如何在 Django 中使用 Elasticsearch" />
<meta property="og:description" content="你是否正在构建需要搜索海量数据集的 Django 应用程序？ 你可能正在考虑使用标准关系数据库。 但是你很快就会发现，在处理高级需求时，此解决方案可能会很慢且有问题。 这就是 Elasticsearch 的用武之地。
这是 Django 的 Elasticsearch 教程，可帮助你在项目中充分利用这个方便的搜索引擎。
为什么要使用 Elasticsearch？ 在海量数据库上运行搜索引擎的应用程序经常面临这个问题：检索产品信息的时间太长。这反过来又会导致糟糕的用户体验，从而对应用程序作为数字产品的潜力产生负面影响。
大多数情况下，搜索滞后源于开发团队用于构建应用程序的关系数据库，其中数据分散在许多不同的表中。为了检索有意义的信息，系统需要从这些表中获取数据——这可能比某些用户准备等待的时间更长。
在通过数据库查询检索数据和获取搜索结果时，关系数据库的工作速度可能非常缓慢。这就是为什么开发人员一直忙于寻找可以加速数据检索过程的替代方法。
这就是 Elasticsearch 的用武之地。它是一个 NoSQL 分布式数据存储，适用于灵活的面向文档的数据库，以匹配具有实时参与需求的苛刻工作负载应用程序。
如果你对 Elasticsearch 还不是很了解的话，请参阅我之前的文章：
Elasticsearch 简介
Elasticsearch 中的一些重要概念: cluster, node, index, document, shards 及 replica
更多关于 Elastic Stack 方面的知识，请阅读 “Elastic：菜鸟上手指南”。
在 Django 中使用 Elasticsearch 为了在 Django 中利用 Elasticsearch，我们将使用一些非常有用的包：
Elasticsearch DSL - 一个高级库，可帮助编写和运行针对 Elasticsearch 的查询。 它建立在官方低级客户端（elasticsearch-py）之上。Django Elasticsearch DSL – 一个允许轻松集成和配置 Elasticsearch 与 Django 的包。 它是围绕 elasticsearch-dsl-py 构建的薄包装器，因此您可以使用由 elasticsearch-dsl-py 团队开发的所有功能。Django Elasticsearch DSL DRF – 集成了 Elasticsearch DSL 和 Django REST 框架。 它为我们提供了API 来最有效地访问 Elasticsearch。 Haystack 与 Elasticsearch DSL" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/fa75c1f7a3a9941d320aebbecd36e008/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-13T14:31:30+08:00" />
<meta property="article:modified_time" content="2021-09-13T14:31:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch：如何在 Django 中使用 Elasticsearch</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>你是否正在构建需要搜索海量数据集的 Django 应用程序？ 你可能正在考虑使用标准关系数据库。 但是你很快就会发现，在处理高级需求时，此解决方案可能会很慢且有问题。 这就是 Elasticsearch 的用武之地。</p> 
<p>这是 Django 的 Elasticsearch 教程，可帮助你在项目中充分利用这个方便的搜索引擎。</p> 
<p></p> 
<h2>为什么要使用 Elasticsearch？</h2> 
<p>在海量数据库上运行搜索引擎的应用程序经常面临这个问题：检索产品信息的时间太长。这反过来又会导致糟糕的用户体验，从而对应用程序作为数字产品的潜力产生负面影响。</p> 
<p>大多数情况下，搜索滞后源于开发团队用于构建应用程序的关系数据库，其中数据分散在许多不同的表中。为了检索有意义的信息，系统需要从这些表中获取数据——这可能比某些用户准备等待的时间更长。</p> 
<p>在通过数据库查询检索数据和获取搜索结果时，关系数据库的工作速度可能非常缓慢。这就是为什么开发人员一直忙于寻找可以加速数据检索过程的替代方法。</p> 
<p>这就是 Elasticsearch 的用武之地。它是一个 NoSQL 分布式数据存储，适用于灵活的面向文档的数据库，以匹配具有实时参与需求的苛刻工作负载应用程序。</p> 
<p>如果你对 Elasticsearch 还不是很了解的话，请参阅我之前的文章：</p> 
<ul><li> <p id="articleContentId"><a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/98871531" rel="nofollow" title="Elasticsearch 简介">Elasticsearch 简介</a></p> </li><li> <p><a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/102728604" rel="nofollow" title="Elasticsearch 中的一些重要概念: cluster, node, index, document, shards 及 replica">Elasticsearch 中的一些重要概念: cluster, node, index, document, shards 及 replica</a></p> </li></ul> 
<p>更多关于 Elastic Stack 方面的知识，请阅读 “<a class="link-info" href="https://elasticstack.blog.csdn.net/article/details/102728604" rel="nofollow" title="Elastic：菜鸟上手指南">Elastic：菜鸟上手指南</a>”。</p> 
<p></p> 
<h2>在 Django 中使用 Elasticsearch</h2> 
<p>为了在 Django 中利用 Elasticsearch，我们将使用一些非常有用的包：</p> 
<ul><li>Elasticsearch DSL - 一个高级库，可帮助编写和运行针对 Elasticsearch 的查询。 它建立在官方低级客户端（elasticsearch-py）之上。</li><li>Django Elasticsearch DSL – 一个允许轻松集成和配置 Elasticsearch 与 Django 的包。 它是围绕 elasticsearch-dsl-py 构建的薄包装器，因此您可以使用由 elasticsearch-dsl-py 团队开发的所有功能。</li><li>Django Elasticsearch DSL DRF – 集成了 Elasticsearch DSL 和 Django REST 框架。 它为我们提供了API 来最有效地访问 Elasticsearch。</li></ul> 
<p>Haystack 与 Elasticsearch DSL</p> 
<p>Haystack 是一个很棒的开源包，它为 Django 提供模块化搜索。 不幸的是，它不完全支持最新版本的 Elasticsearch 或更复杂的查询。 此外，配置是最小的并且受到高度限制。</p> 
<p></p> 
<p>为了方便大家对本教程的理解，我把最终的代码放入到 github 中供大家参考：<a href="https://github.com/liu-xiao-guo/django_elasticsearch" title="https://github.com/liu-xiao-guo/django_elasticsearch">https://github.com/liu-xiao-guo/django_elasticsearch</a></p> 
<p></p> 
<h2>安装</h2> 
<p>在做下面的练习之前，我们需要安装一些必要的软件：</p> 
<h3>Elasticsearch</h3> 
<p>我们可以参考文章 “<a href="https://elasticstack.blog.csdn.net/article/details/99413578" rel="nofollow" title="如何在 Linux，MacOS 及 Windows 上进行安装 Elasticsearch">如何在 Linux，MacOS 及 Windows 上进行安装 Elasticsearch</a>” 来安装自己的 Elasticsearch。我可以直接在 <a class="link-info" href="http://localhost:9200" rel="nofollow" title="http://localhost:9200">http://localhost:9200</a> 上进行访问。</p> 
<h3>Kibana</h3> 
<p>我们可以参考文章 “<a href="https://elasticstack.blog.csdn.net/article/details/99433732" rel="nofollow" title="Kibana：如何在 Linux，MacOS 及 Windows上安装 Elastic 栈中的 Kibana">Kibana：如何在 Linux，MacOS 及 Windows上安装 Elastic 栈中的 Kibana</a>” 来安装自己的 Kibana。我们可以在 http://localhost:5601 上访问自己的 Kibana。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fa/8a/fpNOvsRL_o.png" width="1200"></p> 
<p></p> 
<h2>安装 Python</h2> 
<p>我们根据自己的操作系统安装相应的 Python 及最新的版本。我们接着创建一个自己的 django 项目。我们首先创建一个叫做 django_elastic 的目录：</p> 
<pre><code>$ mkdir django_elastic
$ cd django_elastic</code></pre> 
<p>我们进入到该目录，并使用如下的命令来创建一个 virtualenv：</p> 
<pre><code>virtualenv -p python3 .</code></pre> 
<pre><code>$ virtualenv -p python3 .
created virtual environment CPython3.8.5.final.0-64 in 648ms
  creator CPython3Posix(dest=/Users/liuxg/python/django_elastic, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/Users/liuxg/Library/Application Support/virtualenv)
    added seed packages: pip==21.2.4, setuptools==57.4.0, wheel==0.37.0
  activators BashActivator,CShellActivator,FishActivator,PowerShellActivator,PythonActivator
$ ls
bin        lib        pyvenv.cfg</code></pre> 
<p>我们使用如下的命令来进入到该环境中：</p> 
<pre><code>source ./bin/activate</code></pre> 
<pre><code>$ source ./bin/activate
(django_elastic) $ </code></pre> 
<p>在这个  virtualenv 我们使用如下的命令来安装 django：</p> 
<pre><code>pip3 install django</code></pre> 
<p>我们接着使用如下的命令来创建一个叫做 elastic 的项目：</p> 
<pre><code>django-admin startproject elastic .</code></pre> 
<pre><code>(django_elastic) $ django-admin startproject elastic .
(django_elastic) $ ls
bin        elastic    lib        manage.py  pyvenv.cfg</code></pre> 
<p>这样我们就创建了一个叫做 elastic 的项目。接下来，我们创建一个叫做 news 的 app：</p> 
<pre><code>python manage.py startapp news</code></pre> 
<pre><code>(django_elastic) $ python manage.py startapp news
(django_elastic) $ ls
bin        elastic    lib        manage.py  news       pyvenv.cfg</code></pre> 
<p>从上面，我们可以看出来，我们已经创建了一个叫做 news 的应用。所有的 app 的文件将被置于 news 这个目录中。</p> 
<p>由于一些原因，我们需要在命令行中打入如下的命令才可以使得像 django-admin makemigrations 的命令得以顺利的执行：</p> 
<pre><code>(django_elastic) $ export PYTHONPATH=.
(django_elastic) $ export DJANGO_SETTINGS_MODULE='elastic.settings'</code></pre> 
<p>请注意上面的 elastic.settings 中的 "elastic" 是项目的名称。我们可以在 manage.py 中找到相应的字符串。经过上面的修改后，我们可以使得如下的命令能够顺利地执行：</p> 
<pre><code>(django_elastic) $ django-admin makemigrations 
No changes detected</code></pre> 
<p>我们可以使用我们喜欢的编辑器来修改我们的项目。针对我的情况，我可以使用 code 来编辑我们的项目：</p> 
<pre><code>code .</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/90/dc/S6ht7lJj_o.png" width="1200"></p> 
<p>通过上面的步骤，我们创建了一个最为基本的 django 项目。我们会在以后的练习中来对这个项目进行相应的修改。</p> 
<p></p> 
<h3>安装本地 JSON server</h3> 
<p>为了能够在 django 中写入一些文档到 Elasticsearch 中，我仿照文章 “<a class="link-info" href="https://www.jianshu.com/p/920d73fc32de" rel="nofollow" title="json-server模拟后端接口">json-server模拟后端接口</a>” 来创建一个本地的 JSON 色server。它的目的是为了让 django 的代码读取这个接口并写入到 Elasticsearch 中。我们可以仿照文章中的步骤，并编辑相应的 db.json 文件如下：</p> 
<p><strong>db.json</strong></p> 
<pre><code>{
  "news": [
    {
       "id":1,
       "title":"Tesla's Autopilot, other driver assists are in a regulatory grey zone",
       "content":"Filed under: Government/Legal,Tesla,Safety,Technology Continue reading Tesla's Autopilot, other driver assists are in a regulatory grey zone Tesla's Autopilot, other driver assists are in a regulatory grey zone originally appeared on Autoblog on Sat, 24 Apr"
    },
    {
       "id":2,
       "title":"‘A Bunch of People Will Probably Die’ at Onset of Mars Colonisation, Musk Cautions",
       "content":"The Silicone Valley mogul has candidly outlined the pitfalls of potential trips to the red planet, as his brainchild SpaceX has been going to great lengths to make commercial tourism on Mars possible one day."
    },
    {
       "id":3,
       "title":"IRS says to do this one thing to get the biggest possible tax refund",
       "content":"In a normal year, one in which the country wasn't dealing with the catastrophic public health and financial impacts of a global pandemic, tax season would..."
    },
   ...
  ]
}</code></pre> 
<p>等我们安装好后，我们运行 json server：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/79/58/E7fqer74_o.png" width="1200"></p> 
<p>我们可以在浏览器中访问该本地服务器：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d7/16/0o9sqjns_o.png" width="1200"></p> 
<p> 在上面，我们可以看到一个 JSON 输出格式的相应。我们共有 40 个文档。</p> 
<p></p> 
<h2>在 Django 中使用 Elasticsearch</h2> 
<p>在这节中，我将展示如何在 Django 中使用 Elasticsearch。我们接着上面已经创建的 django 项目继续修改。</p> 
<h3>安装应用及相应的包</h3> 
<p>我们首先打开项目的 settings.py 文件：</p> 
<p><strong>elastic/settings.py</strong></p> 
<pre><code>INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'news',
    'rest_framework',
    'django_elasticsearch_dsl',
    'django_elasticsearch_dsl_drf',    
]

ELASTICSEARCH_DSL = {
    'default': {
        'hosts': 'localhost:9200'
    },
}</code></pre> 
<p>在上面，我们添加了如下的应用：</p> 
<pre><code>    'news',
    'rest_framework',
    'django_elasticsearch_dsl',
    'django_elasticsearch_dsl_drf',    </code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d3/a5/hXKqc8My_o.png" width="1200"></p> 
<p> 我们也同时定义了 ELASTICSEARCH_DSL。你的 Elasticsearch 的地址如有不同，你需要做相应的调整。当然我们也需要安装相应的 python 包。为了方便大家安装，我们可以在项目的根目录下创建如下的一个 requirements.txt 文件：</p> 
<p><strong>requirements.txt</strong></p> 
<pre><code>asgiref==3.3.4
certifi==2020.12.5
chardet==4.0.0
Django==3.2
django-cors-headers==3.7.0
django-debug-toolbar==3.2.1
django-discover-runner==1.0
django-elasticsearch-dsl==7.2.0
django-elasticsearch-dsl-drf==0.22
django-froala-editor==3.2.2
django-ipware==3.0.2
django-nine==0.2.4
django-redis==4.12.1
django-rest-elasticsearch==0.4.2
django-role-permissions==3.1.1
django-webpack-loader==0.7.0
djangorestframework==3.12.4
elasticsearch==7.12.0
elasticsearch-dsl==7.3.0
Faker==8.1.0
idna==2.10
ipaddress==1.0.23
Pillow==8.2.0
python-dateutil==2.8.1
pytz==2021.1
redis==3.5.3
requests==2.25.1
six==1.15.0
sqlparse==0.4.1
text-unidecode==1.3
typing-extensions==3.7.4.3
urllib3==1.26.4</code></pre> 
<p>我们可以使用如下的命令来安装所需要的包：</p> 
<pre><code>pip3 install -r requirements.txt</code></pre> 
<p></p> 
<h3>创建 model</h3> 
<p>接下来，我们来修改在 news app 下的 models.py：</p> 
<p><strong>news/models.py</strong></p> 
<pre><code>from django.db import models

# Create your models here.
class ElasticNews(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/45/5d/eKyBEL0p_o.png" width="1200"></p> 
<p></p> 
<h3>添加 model 到管理页面</h3> 
<p>我们在 news app 的 admin.py 中进行如下的修改：</p> 
<p><strong>news/admin.py</strong></p> 
<pre><code>from django.contrib import admin

# Register your models here.
from news.models import *


admin.site.register(ElasticNews)</code></pre> 
<p></p> 
<h3>创建 documents.py</h3> 
<p>我们在 news app 下创建一个叫做 documents.py 的文件：</p> 
<p><strong>news/documents.py</strong></p> 
<pre><code>from django_elasticsearch_dsl import (
    Document ,
    fields,
    Index,
)

from .models import ElasticNews
PUBLISHER_INDEX = Index('elastic_news')

PUBLISHER_INDEX.settings(
    number_of_shards=1,
    number_of_replicas=0
)

@PUBLISHER_INDEX.doc_type
class NewsDocument(Document):

    id = fields.IntegerField(attr='id')
    fielddata=True
    title = fields.TextField(
        fields={
            'keyword':{
                'type': 'keyword',
            }
            
        }
    )
    content = fields.TextField(
        fields={
            'keyword': {
                'type': 'keyword',
                
            }
        },
    )
   

    class Django(object):
        model = ElasticNews</code></pre> 
<p>在上面我们定义了文档的 mapping。</p> 
<p></p> 
<h3>创建 serializers.py</h3> 
<p>我们在 News app 下创建一个叫做 serializsers.py 的文件：</p> 
<p><strong>news/serializers.py</strong></p> 
<pre><code>import json
from .models import ElasticNews

from django_elasticsearch_dsl_drf.serializers import DocumentSerializer
from .documents import *


class NewsDocumentSerializer(DocumentSerializer):

    class Meta(object):
        """Meta options."""
        model = ElasticNews
        document = NewsDocument
        fields = (
            'title',
            'content',
        )
        def get_location(self, obj):
            """Represent location value."""
            try:
                return obj.location.to_dict()
            except:
                return {}</code></pre> 
<p></p> 
<h3>创建 index view</h3> 
<p>接下来，我们来修改在 News app 下的 views.py 文件，以便能在访问页面时生产相应的 Elasticsearch 文档：</p> 
<p><strong>news/views.py</strong></p> 
<pre><code>from django.shortcuts import render
from django.http import HttpResponse

# Create your views here.
from django.http import JsonResponse
import requests
import json
from news.models import *

from .documents import *
from .serializers import *

from django_elasticsearch_dsl_drf.filter_backends import (
    FilteringFilterBackend,
    CompoundSearchFilterBackend
)
from django_elasticsearch_dsl_drf.viewsets import DocumentViewSet
from django_elasticsearch_dsl_drf.filter_backends import (
    FilteringFilterBackend,
    OrderingFilterBackend,
)

def generate_random_data():
    url = 'http://localhost:3000/news'
    r = requests.get(url)
    payload = json.loads(r.text)
    count = 1
    
    # print (payload)
    print ("type of payload is: ", type(payload))
    for data in payload:
        # print("title: ", data['title'])
        # print("content: ", data['content'])
        ElasticNews.objects.create(
            title = data['title'],
            content = data['content']
        )

def index(request):
    generate_random_data()
    return JsonResponse({'status' : 200})
    # return HttpResponse("Hello, the world")


class PublisherDocumentView(DocumentViewSet):
    document = NewsDocument
    serializer_class = NewsDocumentSerializer
    lookup_field = 'first_name'
    fielddata=True
    filter_backends = [
        FilteringFilterBackend,
        OrderingFilterBackend,
        CompoundSearchFilterBackend,
    ]
   
    search_fields = (
        'title',
        'content',
    )
    multi_match_search_fields = (
       'title',
        'content',
    )
    filter_fields = {
       'title' : 'title',
        'content' : 'content',
    }
    ordering_fields = {
        'id': None,
    }
    ordering = ( 'id'  ,)</code></pre> 
<p>在上面有两个 view。第一个 view 是在访问主页时自动向本地的服务器发送一个请求，并得到 JSON 文档。最终写入到 Elasticsearch 中。第二个 view 是用来读数据进行搜索并排序的一个 view。</p> 
<p></p> 
<h3>修改 ulrpatterns</h3> 
<p>到目前为止我们的应用基本已经创建完毕。我们接下来的工作就是来把上面创建的 view 和 ulrpattern 对应起来。我们修改 elastic 项目下的 urls.py 如下：</p> 
<p><strong>elastic/urls.py</strong></p> 
<pre><code>"""elastic URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/3.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from home.views import *

urlpatterns = [
    path('' , index),
    path('search/' , PublisherDocumentView.as_view({'get': 'list'})),
    path('admin/', admin.site.urls),
]</code></pre> 
<p></p> 
<h3>运行应用</h3> 
<p>到目前为止，我们已经完成了整个应用的设计。接下来，我们使用如下的命令来创建 Elasticsearch 索引 mapping：</p> 
<pre><code>django-admin makemigrations
django-admin migrate
python manage.py search_index — rebuild</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/06/2d/4DUo5Zl2_o.png" width="1200"></p> 
<p> 运行我们的应用：</p> 
<pre><code>python manage.py runserver</code></pre> 
<p><img alt="" height="416" src="https://images2.imgbox.com/6f/6a/UbyfbMDp_o.png" width="1200"></p> 
<p>我们在浏览器中方为 <a class="link-info" href="http://localhost:8000" rel="nofollow" title="http://localhost:8000 ">http://localhost:8000 </a>:</p> 
<p><img alt="" height="1156" src="https://images2.imgbox.com/2e/1d/OdR5fOFD_o.png" width="1200"></p> 
<p>按照我们的设计，它将为 elastic_news 索引创建一些文档。我们可以在 Kibana 中进行查看：</p> 
<pre><code>GET elastic_news/_search</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7a/14/asjA1zaH_o.png" width="1200"></p> 
<p> 我们可以看到有 80 个文档。这是因为我们运行接口两次的缘故。每次都会写入 40个。这和我们之前在 jsonserver 中看到的是一样的。</p> 
<p>我们使用 django 中的第二个 view 来进行搜索。我们在浏览器中打开 <a href="http://localhost:8000/search/" rel="nofollow" title="：http://localhost:8000/search/">：http://localhost:8000/search/</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/b2/98/cQGDbJCE_o.png" width="1200"></p> 
<p>我们可以看到 40 个文档。我们也可以对我们的索引进行如下的搜索：</p> 
<pre><code>http://localhost:8000/search/?search=Tesla</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bd/d8/TiqpZUTO_o.png" width="1200"></p> 
<p>如上所示，这次我们只看到很少的几个文档。我们看到有重复的搜索结果，这是因为在 index 接口我们摄入了两组同样的文档的缘故。</p> 
<p>我们可以在 Kibana 中查看我们的文档的 mapping：</p> 
<pre><code>GET elastic_news/_mapping</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fe/0b/HPXl7OqI_o.png" width="1200"></p> 
<p>显然这个和我们之前在 documents.py 中定义的是一致的。 </p> 
<p></p> 
<h2>总结</h2> 
<p>我希望本指南可以帮助您在 Django 中使用 Elasticsearch。如你所见，Elasticsearch 并不像看起来那么可怕。 借助 REST API，每个 Web 开发人员都可以快速熟悉此解决方案。 该方案的构建类似于数据库概念，便于理解什么是节点、索引、类型和文档。</p> 
<p></p> 
<p>参考</p> 
<p>【1】 <a class="link-info" href="https://medium.com/geekculture/how-to-use-elasticsearch-with-django-ff49fe02b58d" rel="nofollow" title="How to Use ElasticSearch With Django">How to Use ElasticSearch With Django</a></p> 
<p>【2】<a href="https://sunscrapers.com/blog/how-to-use-elasticsearch-with-django/" rel="nofollow" title="https://sunscrapers.com/blog/how-to-use-elasticsearch-with-django/">https://sunscrapers.com/blog/how-to-use-elasticsearch-with-django/</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/da103403bf8ec8a2078f7d4d5eb5d06f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Error inflating class TextView</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1b2ca2081f992a7ea4bced1744f02d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle sql字段截取后六位</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>