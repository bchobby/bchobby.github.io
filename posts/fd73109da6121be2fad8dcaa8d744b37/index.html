<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>第五章 WebRTC, SIP和 Verto - 编程爱好者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="第五章 WebRTC, SIP和 Verto" />
<meta property="og:description" content="WebRTC，视频和音频的实时通信，已经在超过十亿个浏览器上工作。很快移动应用程序就会成倍增长。WebRTC有望成为物联网（IOT）所采用的多媒体通信层。
FreeSwitch是一个完整的WebRTC解决方案，使现有的和遗留的应用程序能够通过新的渠道为用户服务。此外，Freeswitch是一个超级可编程应用服务器，是您创建杀手级服务的基础，它定义了“快速致富”的新概念！
WebRTC是一组P2P多媒体流的技术和标准。WebRTC需要一个额外的信令和会话管理层才能真正有用：它包括用户目录、用户定位、故障管理等等。
FreeSWITCH既支持WebRTC上的SIP（会话初始化协议），也支持VERTO协议。VERTO是一种新的开源协议，它的设计旨在为JavaScript开发者提供方便。
我们将看到如何安装、配置和管理FreeSWITCH服务，把它作为一个集成的WebRTC平台。我们还将看到Verto Communicator (VC)的惊人先进性，和简单的浏览器客户端视频会议和远程呈现应用。
最后，我们将以两种难以区分的方式实现同一个应用：WebRTC房间，一种基于SIP.js，另一种基于verto.js。
这一章，我们将讨论以下主题：
WebRTC 概念WebRTC 里的加密FreeSWITCH的WebRTCSIP和Verto协议的基本原理安装并配置一个完整的FreeSWITCH WebRTC平台Verto通信的惊人特性怎样利用Verto和SIP.js编写测试应用 WebRTC概念 WebRTC是一组支持P2P音频、视频和数据采集、流媒体和交换的标准和技术。它的首款“杀手级”应用是视频电话和视频会议。它首先在web浏览器上实现(已有超过10亿个兼容WebRTC的浏览器)，这项技术已经在许多智能手机应用上推广，据预测，它可能成为物联网多媒体通信的基础(将有数十亿的物联网设备启用WebRTC)。
在最直接和流行的实现中，浏览器会访问一个页面，并加载页面所包含的Javascript。脚本的函数使用WebRTC API（后面介绍）与计算机多媒体硬件交互（麦克风、摄像头），并且和对端交换音视频媒体流。
这里的重点是P2P。WebRTC不规定或支持任何超出抓取、发送、接收和播放流之外的操作。没有信令，没有用户目录或定位服务，没有协商通信会话建立和销毁的协议，等等。
WebRTC既不是协议，也不是服务。仅使用WebRTC技术，你必须对两个端点的应用地址硬编码，嗅探它们的监听，而应用程序只对这些端点有效。
除了最简单演示之外，WebRTC还需要某种信令和会话管理协议。对于你的WebRTC服务来说，你可以选择现成的协议，或者自己发明一套私有协议。
最成熟的会话管理信令协议显然是SIP，它支持着整个世界的通信网络，从PSTN运营商到移动运营商，再到PBX呼叫服务，SIP的身影无处不在。另一种广泛应用的协议是XMPP，它主要用于管理即时消息和状态服务。有许多专有封闭的协议，其中以Skype背后的协议最为突出。还有面向Web开发人员和JavaScript编程人员的开源替代方案，如Freeswitch的Verto。你必须选择一种，或自己写。
WebRTC技术体现为软件开发人员构建程序时用到的三组应用编程接口（API）：GetUserMedia (GUM)、RTCPeerConnection (RTCPC 或PC)和RTCDataChannels (RTCDC 或 DC)。
GetUserMedia 用于枚举机器上的多媒体硬件，请求用户权限来控制麦克风和摄像头，获取媒体流，并通过屏幕和扬声器播放流。RTCPeerConnection 用于在定义的端点间传输音频和视频流。RTCDataChannels 用于在定义的端点间传输任意数据（即使是结构化数据）。 WebRTC RTCPeerConnection 必须使用ICE，STUN和TURN来穿透防火墙和NAT，最终抵达另一端。
ICE是WebRTC自身推广的一种技术，并获得了巨大的吸引力。它是解决所有网络问题的真正的灵丹妙药，并且工作完成得相当完美，是多年VoIP工程服务的精华。
ICE将通过一个STUN服务器告诉应用程序它的公网地址是什么（从NAT和防火墙的另一侧看到的公网地址），并使用一个TURN服务器作为中继，防止 P2P通信失败。因此，一个功能完整的WebRTC应用需要：
使用 GetUserMedia API 控制麦克风和摄像头使用一种会话协议和可能的外部辅助服务器定位对方端点并建立会话使用ICE (和 STUN 和 TURN) 确定网络路径使用 RTCPeerConnection 传输音/视频媒体流 加密无处不在 对媒体流和数据流加密是强制性的。 如果不对交换的媒体流加密，就没有WebRTC通信。包括所有的媒体流（音频和视频）和可能存在的数据流都需要加密。媒体流被加密为SRTP，通过DTLS交换密钥。这一切都是由RTCPeerConnection API替你完成的。
但是，当你操作时，对会话协议一并加密才更具意义。这种信令选择的传输层通常选择安全的WebSocket。在定义WebRTC信令服务器和终端端时，WSS:// 这样的URI前缀(WebSocket Secure)到处可见。WSS信令交换是TLS加密的（就像web的HTTPS）。未加密的交换方式，前缀是WS，但除了测试之外，很少使用。
FreeSWITCH的WebRTC 好了，抽象的内容说得够多了，是时候拿出点实质性的东西了：FreeSWITCH是怎样实现WebRTC的？
FreeSWITCH是一个完整的WebRTC平台，既可以作为WebRTC网关，也可以作为WebRTC应用服务器。例如，FreeSWITCH能够把WebRTC客户端连接到外部“正常”的SIP和PSTN服务（或者PBX），从而使现有或遗留的服务能够被超过10亿的浏览器在线访问。与此同时（这是真实的，作为网关同时提供某些附加的服务），FreeSWITCH能够为WebRTC客户端（浏览器或App）提供与其它“正常”SIP和PSTN客户端相同的服务，比如PBX、IVR、呼叫中心、会议系统、电话卡，等等。
对FreeSWITCH来说，WebRTC只不过是另一种类型的通信通道，和SIP、TDM、MGCP、H323、Skype、Jingle是一样的。FreeSWITCH的所有特性天然支持WebRTC。
FS 的WebRTC信令: SIP和Verto 从这一章的前面部分内容中，我们已经知道WebRTC需要一种会话协议来补充它自己的媒体流功能。这个协议将用于定位端点位置、建立与拆除会话，管理状态和消息。 FreeSWITCH支持两种这类型的协议：SIP和Verto。
这两种不同的协议只影响客户端的编写方式（客户端是加载Javascript的网页，可以访问FreeSWITCH）和客户端与FreeSWITCH的“交谈”方式。两种协议都可以完全访问FreeSWITCH的所有功能和服务。此外，不同客户端可以同时使用两种协议接入同一服务，甚至直接互动。例如：我们可以在FreeSWITCH上发起一个视频会议，让一个基于SIP的FreeSWITCH客户端，一个基于Verto的客户端，还有其它TDM客户端，普通（非WebRTC）SIP客户端同时接入会议室：
为什么选择SIP？又为什么选择Verto? 记住：这里的选择影响的只是访问FreeSWITCH的页面应用的Javascript编写方式。在本章的后续内容中，我们将介绍一个具体实例，分别用两种协议实现一个相同的应用程序。从终端用户的角度看，感觉不到其中的差异。
尽管SIP很复杂，但有电信背景的程序员很容易接受，他们对这些概念很熟悉：会话、对话、事务、REGISTER/ INVITE/ BYE消息，等等。它是在复杂环境中集成WebRTC客户端的完美选择，在扩展、监视和部署方面拥有20年的经验积累。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bchobby.github.io/posts/fd73109da6121be2fad8dcaa8d744b37/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-08T14:35:22+08:00" />
<meta property="article:modified_time" content="2019-08-08T14:35:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程爱好者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程爱好者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">第五章 WebRTC, SIP和 Verto</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;">      WebRTC，视频和音频的实时通信，已经在超过十亿个浏览器上工作。很快移动应用程序就会成倍增长。WebRTC有望成为物联网（IOT）所采用的多媒体通信层。</p> 
<p style="margin-left:0cm;">        FreeSwitch是一个完整的WebRTC解决方案，使现有的和遗留的应用程序能够通过新的渠道为用户服务。此外，Freeswitch是一个超级可编程应用服务器，是您创建杀手级服务的基础，它定义了“快速致富”的新概念！</p> 
<p style="margin-left:0cm;">        WebRTC是一组P2P多媒体流的技术和标准。WebRTC需要一个额外的信令和会话管理层才能真正有用：它包括用户目录、用户定位、故障管理等等。</p> 
<p style="margin-left:0cm;">        FreeSWITCH既支持WebRTC上的SIP（会话初始化协议），也支持VERTO协议。VERTO是一种新的开源协议，它的设计旨在为JavaScript开发者提供方便。</p> 
<p style="margin-left:0cm;">       我们将看到如何安装、配置和管理FreeSWITCH服务，把它作为一个集成的WebRTC平台。我们还将看到Verto Communicator (VC)的惊人先进性，和简单的浏览器客户端视频会议和远程呈现应用。</p> 
<p style="margin-left:0cm;">       最后，我们将以两种难以区分的方式实现同一个应用：WebRTC房间，一种基于SIP.js，另一种基于verto.js。</p> 
<p style="margin-left:0cm;">      这一章，我们将讨论以下主题：</p> 
<ol><li>WebRTC 概念</li><li>WebRTC 里的加密</li><li>FreeSWITCH的WebRTC</li><li>SIP和Verto协议的基本原理</li><li>安装并配置一个完整的FreeSWITCH WebRTC平台</li><li>Verto通信的惊人特性</li><li>怎样利用Verto和SIP.js编写测试应用</li></ol> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">WebRTC概念</h2> 
<p style="margin-left:0cm;">        WebRTC是一组支持P2P音频、视频和数据采集、流媒体和交换的标准和技术。它的首款“杀手级”应用是视频电话和视频会议。它首先在web浏览器上实现(已有超过10亿个兼容WebRTC的浏览器)，这项技术已经在许多智能手机应用上推广，据预测，它可能成为物联网多媒体通信的基础(将有数十亿的物联网设备启用WebRTC)。</p> 
<p style="margin-left:0cm;">        在最直接和流行的实现中，浏览器会访问一个页面，并加载页面所包含的<strong>Javascript</strong><strong>。</strong>脚本的函数使用<strong>WebRTC API</strong><strong>（后面介绍）</strong>与计算机多媒体硬件交互（麦克风、摄像头），并且和对端交换音视频媒体流。</p> 
<p style="margin-left:0cm;">        这里的重点是P2P。WebRTC不规定或支持任何超出抓取、发送、接收和播放流之外的操作。没有信令，没有用户目录或定位服务，没有协商通信会话建立和销毁的协议，等等。</p> 
<p style="margin-left:0cm;"><strong>        WebRTC</strong><strong>既不是协议，也不是服务</strong>。仅使用WebRTC技术，你必须对两个端点的应用地址硬编码，嗅探它们的监听，而应用程序只对这些端点有效。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="170" src="https://images2.imgbox.com/bc/96/bzo8V1cg_o.png" width="208"></p> 
<p style="margin-left:0cm;">        除了最简单演示之外，<strong>WebRTC</strong>还需要某种<strong>信令和会话管理协议</strong>。对于你的WebRTC服务来说，你可以选择现成的协议，或者自己发明一套私有协议。</p> 
<p style="margin-left:0cm;">        最成熟的会话管理信令协议显然是SIP，它支持着整个世界的通信网络，从PSTN运营商到移动运营商，再到PBX呼叫服务，SIP的身影无处不在。另一种广泛应用的协议是XMPP，它主要用于管理即时消息和状态服务。有许多专有封闭的协议，其中以<strong>Skype</strong>背后的协议最为突出。还有面向Web开发人员和JavaScript编程人员的开源替代方案，如Freeswitch的Verto。你必须选择一种，或自己写。</p> 
<p style="margin-left:0cm;"><strong>        WebRTC</strong>技术体现为软件开发人员构建程序时用到的三组应用编程接口（API）：GetUserMedia (GUM)、RTCPeerConnection (RTCPC 或PC)和RTCDataChannels (RTCDC 或 DC)。</p> 
<ul><li><strong>GetUserMedia</strong><strong> </strong>用于枚举机器上的多媒体硬件，请求用户权限来控制麦克风和摄像头，获取媒体流，并通过屏幕和扬声器播放流。</li><li><strong>RTCPeerConnection </strong>用于在定义的端点间传输音频和视频流。</li><li><strong>RTCDataChannels </strong>用于在定义的端点间传输任意数据（即使是结构化数据）。</li></ul> 
<p style="margin-left:0cm;">      WebRTC RTCPeerConnection 必须使用ICE，STUN和TURN来穿透防火墙和NAT，最终抵达另一端。</p> 
<p style="margin-left:0cm;">      ICE是WebRTC自身推广的一种技术，并获得了巨大的吸引力。它是解决所有网络问题的真正的灵丹妙药，并且工作完成得相当完美，是多年VoIP工程服务的精华。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="266" src="https://images2.imgbox.com/46/b0/pEJz0yw7_o.png" width="529"></p> 
<p style="margin-left:0cm;">        ICE将通过一个STUN服务器告诉应用程序它的公网地址是什么（从NAT和防火墙的另一侧看到的公网地址），并使用一个TURN服务器作为中继，防止 P2P通信失败。因此，一个功能完整的WebRTC应用需要：</p> 
<ul><li>使用 GetUserMedia API 控制麦克风和摄像头</li><li>使用一种会话协议和可能的外部辅助服务器定位对方端点并建立会话</li><li>使用ICE (和 STUN 和 TURN) 确定网络路径</li><li>使用 RTCPeerConnection 传输音/视频媒体流</li></ul> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">加密无处不在</h2> 
<p style="margin-left:0cm;"><strong>        对媒体流和数据流加密是强制性的。</strong> 如果不对交换的媒体流加密，就没有WebRTC通信。包括所有的媒体流（音频和视频）和可能存在的数据流都需要加密。媒体流被加密为SRTP，通过DTLS交换密钥。这一切都是由RTCPeerConnection API替你完成的。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="270" src="https://images2.imgbox.com/3f/e4/IrPmtqxz_o.png" width="359"></p> 
<p style="margin-left:0cm;">        但是，当你操作时，对会话协议一并加密才更具意义。这种信令选择的传输层通常选择安全的WebSocket。在定义WebRTC信令服务器和终端端时，<strong>WSS:// </strong>这样的<strong>URI</strong><strong>前缀</strong>(WebSocket Secure)到处可见。WSS信令交换是TLS加密的（就像web的HTTPS）。未加密的交换方式，前缀是WS，但除了测试之外，很少使用。</p> 
<h2 style="margin-left:0cm;">FreeSWITCH的WebRTC</h2> 
<p style="margin-left:0cm;">        好了，抽象的内容说得够多了，是时候拿出点实质性的东西了：FreeSWITCH是怎样实现WebRTC的？</p> 
<p style="margin-left:0cm;">        FreeSWITCH是一个完整的WebRTC平台，既可以作为WebRTC网关，也可以作为WebRTC应用服务器。例如，FreeSWITCH能够把WebRTC客户端连接到外部“正常”的SIP和PSTN服务（或者PBX），从而使现有或遗留的服务能够被超过10亿的浏览器在线访问。与此同时（这是真实的，作为网关同时提供某些附加的服务），FreeSWITCH能够为WebRTC客户端（浏览器或App）提供与其它“正常”SIP和PSTN客户端相同的服务，比如PBX、IVR、呼叫中心、会议系统、电话卡，等等。</p> 
<p style="margin-left:0cm;">        对FreeSWITCH来说，<strong>WebRTC</strong><strong>只不过是另一种类型的通信通道，和</strong><strong>SIP</strong><strong>、</strong><strong>TDM</strong><strong>、</strong><strong>MGCP</strong><strong>、</strong><strong>H323</strong><strong>、</strong><strong>Skype</strong><strong>、</strong><strong>Jingle</strong><strong>是一样的。</strong>FreeSWITCH的所有特性天然支持WebRTC。</p> 
<h3 style="margin-left:0cm;">FS 的WebRTC信令: SIP和Verto</h3> 
<p style="margin-left:0cm;">        从这一章的前面部分内容中，我们已经知道WebRTC需要一种会话协议来补充它自己的媒体流功能。这个协议将用于定位端点位置、建立与拆除会话，管理状态和消息。 FreeSWITCH支持两种这类型的协议：SIP和Verto。</p> 
<p style="margin-left:0cm;">        这两种不同的协议只影响客户端的编写方式（客户端是加载Javascript的网页，可以访问FreeSWITCH）和客户端与FreeSWITCH的“交谈”方式。两种协议都可以完全访问FreeSWITCH的所有功能和服务。此外，不同客户端可以同时使用两种协议接入同一服务，甚至直接互动。例如：我们可以在FreeSWITCH上发起一个视频会议，让一个基于SIP的FreeSWITCH客户端，一个基于Verto的客户端，还有其它TDM客户端，普通（非WebRTC）SIP客户端同时接入会议室：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="173" src="https://images2.imgbox.com/a9/f2/6ECn2FQC_o.png" width="483"></p> 
<h4 style="margin-left:0cm;">为什么选择SIP？又为什么选择Verto?</h4> 
<p style="margin-left:0cm;">        记住：这里的选择影响的只是访问FreeSWITCH的页面应用的Javascript编写方式。在本章的后续内容中，我们将介绍一个具体实例，分别用两种协议实现一个相同的应用程序。从终端用户的角度看，感觉不到其中的差异。</p> 
<p style="margin-left:0cm;">        尽管SIP很复杂，但有电信背景的程序员很容易接受，他们对这些概念很熟悉：会话、对话、事务、REGISTER/ INVITE/ BYE消息，等等。它是在复杂环境中集成WebRTC客户端的完美选择，在扩展、监视和部署方面拥有20年的经验积累。</p> 
<p style="margin-left:0cm;">        Verto是一种完全不同的体验：非常简单，它使用Web程序员已经熟悉的编程结构，如JSON数据结构。此外，Verto还提供了与FreeSWITCH内部服务器交互的API和双向同步的数据结构。例如，在FreeSWITCH中使用Verto时，你可以有一个数据结构（假设是视频会议的成员列表），它对所有Verto客户端透明地实时同步信息，这样，如果有新的成员加入会议（即使是从PSTN加入），他的状态会立刻呈现在所有Verto客户端的浏览器上，不需要任何客户端侧的动作（比如拉取状态）。</p> 
<p style="margin-left:0cm;">        你可以在基于SIP的JavaScript上复制这种行为（聪明的程序员可以完成任何他想做的事情，所有的一切不都是字节吗？），使用数据流，特定的消息，推送技术等等，但在Verto中，它是原生的，仅需要几行代码。</p> 
<p style="margin-left:0cm;"><br><img alt="" class="has" height="201" src="https://images2.imgbox.com/ae/b0/vPEUrZox_o.png" width="381"></p> 
<p> </p> 
<h3>FS 的WebRTC媒体流: SRTP</h3> 
<p style="margin-left:0cm;">        与会话信令选择（SIP或Verto可选）不同，WebRTC客户端的媒体流处理总是遵循WebRTC规范，强制加密。它没有选择，只能用SRTP，并通过<strong>DTLS</strong><strong>交换密钥。</strong>事实上，在FreeSWITCH内部，对两种不同信令的客户端，媒体流加密使用的是同一个模块和同一套代码。如前所术，WebRTC定义了媒体流和加密方式，把会话协议留给应用实现者自由处理。</p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">在FS中安装并配置WebRTC</h2> 
<p style="margin-left:0cm;">        为了快速测试，Tristan Mahe贡献了一个脚本，它自动安装WebRTC需要的所有内容，从FreeSWITCH本身到WEB服务器证书，再到Verto通信器，用于新部署的Debian 8最小安装服务器。在硬件上安装基础的操作系统，或安装一台虚拟机，ssh连接这台机器，执行完脚本，你就已经准备好一台新的WebRTC会议服务器。从这里下载脚本：</p> 
<p style="margin-left:0cm;"><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">h</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">p</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">://f</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">r</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">w</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">c</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">h</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">.</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">o</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">r</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">g</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">/c</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">o</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">n</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">f</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">l</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">u</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">n</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">c</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">/d</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">p</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">l</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">a</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">y</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">/F</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">R</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">E</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">E</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">S</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">W</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">I</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">T</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">C</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">H</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">/D</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">b</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">a</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">n</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">+8+J</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">#D</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">b</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">a</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">n</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">8J</a> <a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">s</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">-</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">Q</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">u</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">c</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">k</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">S</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">a</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">r</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">F</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">r</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">S</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">W</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">I</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">T</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">C</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">H</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">D</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">m</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">o</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">W</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">h</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">V</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">e</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">r</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">o</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">C</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">o</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">m</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">m</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">u</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">n</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">i</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">c</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">a</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">t</a><a href="https://freeswitch.org/confluence/display/FREESWITCH/Debian%2B8%2BJessie#Debian8Jessie-QuickStartFreeSWITCHDemoWithVertoCommunicator" rel="nofollow">or</a></p> 
<p style="margin-left:0cm;">        在接下来的内容中，我们不会使用自动安装脚本。而是从安装开始，逐步构建一个完整的WebRTC FreeSWITCH平台。</p> 
<p style="margin-left:0cm;">       事实上，在缺省部署完成后，支持WebRTC不需要附加安装任何模块。所有需要的模块都已经安装好了。FreeSwitch是一款可以开箱即用的WebRTC应用服务器。</p> 
<p style="margin-left:0cm;">        我们需要编辑几个配置文件，这样，Freeswitch就可以找到强制的SSL证书、知道要监听的端口以及许多其他细节。</p> 
<h3 style="margin-left:0cm;">证书</h3> 
<p style="margin-left:0cm;">        这是许多FreeSWITCH/WebRTC新手的一块绊脚石。我们需要许多与证书相关的文件，以及它们的不同组合，以帮助加密FreeSwitch流量的不同部分：“传统的”基于TLS的SIP（即"sips"，详情请参考RFC3261）；基于WSS的SIP；基于WSS的Verto；和SRTP媒体。</p> 
<p style="margin-left:0cm;">        HTTPS服务器也需要证书文件，它将为我们的WebRTC客户端加载页面和JavaScript提供服务。我们需要证书颁发机构的根文件和链文件。我们也需要私钥。此外，原始证书文件需要以不同的方式连接，以形成我们需要的不同的即用证书。内容有点多，难怪很多人觉得这很困惑。</p> 
<p style="margin-left:0cm;">        我采用一种简单的解决方案：把所有证书相关的文件放在一个目录中，让FreeSWITCH的模块和WEB服务器(Apache 或 Nginx)到这个目录获取。我还写了个脚本以保证它们正确连接。如果你的证书供应商和我的一样，你可以直接使用它；如果不一样也不要紧，你可以修改它，让它适配你的证书提供商。</p> 
<p style="margin-left:0cm;">        首先，忘掉自签证书和类似的增强解决方案。自签名证书“可能”适用于测试目的，但是要正确协调所有的活动部件，这样做是不值得的，而且肯定会浪费大量的时间和挫折。简单地说：不要使用自签证书。对真实有效的域名，使用真实有效的证书。</p> 
<p style="margin-left:0cm;">      如果你的服务只响应一两个域名的请求，那么你是幸运的。可以从letsencrypt.org免费获取证书。如果你想让你的服务对一个域名下的所有子域名都响应（比如：<a href="http://www.mydomain.com/" rel="nofollow">www.mydomain.com、 </a>sip.mydomain.com、 support.mydomain.com、 sip.mycustomername.mydomain.com、 <span style="color:#0000FF;"><u>www.mysecondcustomername.mydomain.com </u></span>），那么你需要购买通配证书。当前没有免费的通配证书可以选择，但将来也许会有。</p> 
<p style="margin-left:0cm;">        如使用www.letsencrypt.org提供的免费(且完全有效)证书(请查看其网站上的说明):</p> 
<pre class="has"><code class="language-bash">#!/bin/sh

cp /etc/letsencrypt/live/my.fqdn.com/* /usr/local/freeswitch/certs/ cd /usr/local/freeswitch/certs/

cat fullchain.pem privkey.pem &gt; wss.pem cat cert.pem privkey.pem &gt; agent.pem cat chain.pem &gt; cafile.pem</code></pre> 
<p style="margin-left:0cm;">        如果是由Comodo颁发的PositiveSSL wilcard证书（谷歌搜索最低价的），请注意：你必须找到并下载<em>addtrustexternalcaroot.crt</em>文件：</p> 
<pre class="has"><code class="language-bash">#!/bin/sh

cd /usr/local/freeswitch/certs/ cp myserver.key privkey.pem

cp STAR_mydomain_com.crt cert.pem

cp STAR_mydomain_com.ca-bundle chain.pem

cat cert.pem chain.pem addtrustexternalcaroot.crt &gt; fullchain.pem cat cert.pem privkey.pem fullchain.pem &gt; wss.pem

cat fullchain.pem privkey.pem &gt; agent.pem cat chain.pem &gt; cafile.pem</code></pre> 
<h3 style="margin-left:0cm;"> </h3> 
<h3 style="margin-left:0cm;">安装并配置Apache或NginX，提供HTTPS服务</h3> 
<p style="margin-left:0cm;">        我们需要为WebRTC客户端准备支持TLS/SSL访问的WEB服务器。任意一款支持HTTPS的WEB服务器都行。目前最流行的两款WEB服务器是Apache和NginX。接下来我们看看怎么在Debian 8 (Jessie)上安装它们，并启用HTTPS/SSL。</p> 
<p style="margin-left:0cm;">然后，我们将准备好的用于提供服务的页面文件放在下面目录下：</p> 
<p style="margin-left:0cm;">/var/www/html/</p> 
<p style="margin-left:0cm;">        这一点Apache和NginX一样</p> 
<p style="margin-left:0cm;">        你只需要选用Apache或NginX的其中一个，没必要两个都安装</p> 
<h4 style="margin-left:0cm;">Apache</h4> 
<p style="margin-left:0cm;">        第一步是更新安装包和数据库，然后安装apache2和ca-certificates包。后一个包将安装证书机构颁发的证书，这在处理SSL时可能很有用。</p> 
<p style="margin-left:0cm;">        接下来启用SSL Apache模块，以及通过HTTPS提供服务的缺省SSL站点。</p> 
<p style="margin-left:0cm;">        接下来的两行代码（为了方便阅读，排版时分为三行），使用PERL替换SSL/TLS证书和私钥的文件名和路径。最后一行代码重启Apache服务：</p> 
<pre class="has"><code class="language-bash">apt-get update

apt-get install apache2 ca-certificates a2enmod ssl

a2ensite default-ssl.conf perl -i -pe \ 's|/etc/ssl/certs/ssl-cert-

snakeoil.pem|/usr/local/freeswitch/certs/cert.pem|g' \ /etc/apache2/sites- enabled/default-ssl.conf

perl -i -pe \ 's|/etc/ssl/private/ssl-cert-

snakeoil.key|/usr/local/freeswitch/certs/privkey.pem|g' \

/etc/apache2/sites-enabled/default-ssl.conf service apache2 restart</code></pre> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;">NginX</h4> 
<p style="margin-left:0cm;">        和Apache安装一样，我们先更新安装包一数据库。然后安装nginx和ca-certificates包。后一个包将安装证书机构颁发的证书，这在处理SSL时可能很有用。</p> 
<p style="margin-left:0cm;">        接下来，启用443端口（SSL）监听，并为通过HTTPS提供服务的缺省站点包含snippet。接下来的两行代码（为了方便阅读，排版时分为三行），使用PERL替换SSL/TLS证书和私钥的文件名和路径。最后一行代码重启NginX。</p> 
<pre class="has"><code class="language-bash">apt-get update

apt-get install nginx ca-certificates

perl -i -pe 's/# listen/listen/g' /etc/nginx/sites-enabled/default perl -i -pe \

's/# include snippets\/snakeoil.conf/include snippets\/snakeoil.conf/g' \

/etc/nginx/sites-enabled/default perl -i -pe \ 's|/etc/ssl/certs/ssl-cert-

snakeoil.pem|/usr/local/freeswitch/certs/cert.pem|g' \

/etc/nginx/snippets/snakeoil.conf perl -i -pe \ 's|/etc/ssl/private/ssl-cert-

snakeoil.key|/usr/local/freeswitch/certs/privkey.pem|g' \

/etc/nginx/snippets/snakeoil.conf service nginx restart</code></pre> 
<h3 style="margin-left:0cm;">配置 VERTO</h3> 
<p style="margin-left:0cm;">        在FreeSWITCH缺省安装环境下，mod_verto模块的配置文件是/usr/local/freeswitch/conf/autoload_configs/verto.conf.xml。我们将编辑"default- v4"这个配置，IPV4是目前网络连接通常使用的地址类型。您要检查TCP端口，Verto将在该端口上侦听WSS传输上的信令。注意，<strong>secure="true"</strong>表示<strong>WSS</strong>（而不是简单的WS）。</p> 
<pre class="has"><code class="language-html">&lt;param name="bind-local" value="$${local_ip_v4}:8082" secure="true"/&gt;

&lt;param name="ext-rtp-ip" value="93.58.44.181"/&gt;

&lt;param name="debug" value="0"/&gt;</code></pre> 
<p style="margin-left:0cm;">        参数ext-rtp-ip的值配置媒体的外部IP地址，VERTO会通知WebRTC客户端连接这个地址以进行媒体交换。因此，对于从因特网访问的客户端来说，ext-rtp-ip必须设置为NAT后的公网IP（通常和WEB服务的IP地址相同）。</p> 
<p style="margin-left:0cm;">        你可能需要临时把"debug"的值设为10，这样VERTO的所有交换信息都会呈现在FreeSWITCH控制台和fs_cli界面上（红色的！）。把mod_verto的debug输出与客户端浏览器上的javascript控制台日志结合起来，就能得到信令交换的完整跟踪信息。</p> 
<h3 style="margin-left:0cm;">配置基于SIP的WebRTC (WSS)</h3> 
<p style="margin-left:0cm;">        在FreeSWITCH缺省安装环境下，你只需要修改"internal" SIP profile。打开/usr/local/freeswitch/conf/sip_profiles/internal.xml文件，检查"<strong>wss-binding"</strong>配置，它指定了SIP模块(mod_sofia)监听WSS信令的<strong>TCP</strong><strong>端口</strong>。</p> 
<pre class="has"><code class="language-html">&lt;param name="wss-binding" value=":7443"/&gt;

&lt;param name="ext-rtp-ip" value="93.58.44.181"/&gt;

&lt;param name="ext-sip-ip" value="93.58.44.181"/&gt;</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        参数ext-rtp-ip和ext-sip-ip设置媒体和信令的交换地址，WebRTC客户端将通过它们交换信令和媒体。它必须设置为WebRTC客户端看到的FreeSWITCH IP地址。因此，如果客户端从因特网访问，ext-rtp-ip必须设置为NAT转换后的公司IP，换句话说，路由可达的IP（通常和WEB服务器IP相同）。</p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">编写 WebRTC 客户端</h2> 
<p style="margin-left:0cm;">        WebRTC 客户端最主流的实现就是一个加载JavaScript的HTML页面。HTML和JavaScript分别定义WebRTC的GUI和行为。</p> 
<p style="margin-left:0cm;">      通常，由HTML加载的javascript部分会用到一个或多个javascript库。这些库实现选定的信令协议（SIP或VERTO）和WebRTC API的交互。我们已经了解WebRTC API提供了访问本地多媒体硬件（麦克风和摄像头）的能力；还能管理音视频媒体流；还有双向的数据通道。</p> 
<p style="margin-left:0cm;">        会话信令协议将会利用和补充WebRTC P2P功能，因此它们的作用远远超过连接一个已知的地址和端口。</p> 
<h3 style="margin-left:0cm;">SIP 和 JavaScript</h3> 
<p style="margin-left:0cm;">        WebRTC的SIP在jssip JavaScript开源库中得到了显著的实现。JsSIP由José Luis Millán, Iñaki Baz Castillo, 和 Saúl Ibarra Corretgé编写，他们是RFC 7118的联合作者，这份规范定义了SIP的WS和WSS用法。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="76" src="https://images2.imgbox.com/ef/19/7c6ik57h_o.png" width="133"></p> 
<p style="margin-left:0cm;">         后来，在OnSIP工作期间，Will Mitchell和他的团队分裂JsSIP并进一步开发。他们的开发成果以开源<strong>SIP.js</strong><strong>库</strong>的的形式发布。如今，SIP.js已经被广泛采用，它是FreeSWITCH社区中最常用的Javascript WebRTC SIP库。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="40" src="https://images2.imgbox.com/21/0f/YFK4TZJY_o.png" width="137"></p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        另一个值得注意且独立的JavaScript实现的开源SIP库是sipml5(事实上它是HTML5的第一个SIP客户端)，它由Doubango电信开发。</p> 
<p style="margin-left:0cm;">        这些库都很容易从网上找到，包含完整的文档，实例客户端。支持和开发最积极的似乎是SIP.js。在本章的后面内容中，我们会看到SIP.js的实际应用，实现一个WebRTC聊天室。</p> 
<h3 style="margin-left:0cm;">Verto 和 JavaScript</h3> 
<p style="margin-left:0cm;">        VERTO协议是一个典型的JSON协议，JavaScript程序员通过引用其中的一个“特色”库，就可以使用它。</p> 
<p style="margin-left:0cm;">        第一个“特色”库是verto-min.js，它是一个迷你版的基础库，随FreeSWITCH源码一起发布 ，一个普通的“原始”javascript库，依赖于jquery和and jquery.json。另一个“特色”库是一个JQuery的"verto"插件，可以从"npm" Node管理器获取。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="59" src="https://images2.imgbox.com/9f/89/Gv8bwSD4_o.png" width="199"></p> 
<p style="margin-left:0cm;">        VERTO库是由Anthony Minessale II开发的，他是FreeSWITCH的主要开发者和作者，在FreeSWITCH 1.5开发期间，VERTO的进展与mod_verto模块并行。</p> 
<p style="margin-left:0cm;"><strong>        Verto JQuery</strong><strong>插件</strong>和它的文档由Italo Rossi及其团队在evolution .net.br进一步开发（他们还是Verto Communicator的开发者），并由开源软件wiz Chad Phillips (hunmonk on IRC)提供。从<a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">h</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">t</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">t</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">p</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">://e</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">v</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">o</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">l</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">u</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">x</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">b</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">r</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">.</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">g</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">i</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">t</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">h</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">u</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">b</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">.</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">i</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">o</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">/v</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">e</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">r</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">t</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">o</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">-</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">d</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">o</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">c</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">s</a><a href="http://evoluxbr.github.io/verto-docs/" rel="nofollow">/</a>，你可以找到完整的文档，还有手把手的编程指南和客户端示例。</p> 
<p style="margin-left:0cm;">       在我们的<strong>WebRTC</strong><strong>聊天室</strong>中，为了简单起见，将选择<strong>verto-min.js</strong>库。</p> 
<p style="margin-left:0cm;"> </p> 
<h4 style="margin-left:0cm;">Verto Communicator, 一个高级的WebRTC客户端</h4> 
<p style="margin-left:0cm;">        Verto Communicator是由<strong>Italo Rossi</strong>及其团队在evolution .net.br编写的，它是一个完整的高级开源WebRTC VERTO客户端示例，非常酷，具有视频会议的附加功能。</p> 
<p style="margin-left:0cm;">        如果你在FreeSWITCH中配置了一个具有完整选项的视频会议，像演示配置里的3500那样，那么就能体验Verto Communicator (<strong>VC</strong>)的所有特性。</p> 
<p style="margin-left:0cm;">      它具有屏幕共享、音频/视频静音或解除、聊天、会员名单、实时显示发言者、自动可视化的头像、全屏、拨号板、麦克风和摄像头的选择、带宽等功能。</p> 
<p style="margin-left:0cm;">        下图是<strong>Seven Du Jin Fang</strong><strong>（杜金房）</strong>提供的一张VC使用截屏，杜先生是FreeSWITCH视频代码的作者，还是蓬勃发展的FreeSWITCH中国社区的领导人。图中他在主屏幕区，其他与会者正陆续加入，并自动围绕在他周围。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="350" src="https://images2.imgbox.com/3b/a2/gNGtcTRZ_o.png" width="571"></p> 
<p style="margin-left:0cm;">      当你以"<strong>moderator</strong>"（设置"|moderator"标识）主持权限接入会议时，它将为你提供大量附加功能：你可以踢除与会者；开始和停止音视频录制；播放音/视频文件；截图；在每个参与者视频流的底部放置带有任意文本（例如，名称和位置）的横幅；选择与会者的“位置”，等。等。你实际上成为了会议的“电影导演”：让谁显示在屏幕上，决定屏幕上同时显示多少人，你可以让演讲者的共享屏幕显示为全屏，并在其中嵌入一个演讲者的小画面，等等。现场合成画面。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="335" src="https://images2.imgbox.com/c7/51/uQrHDAyu_o.png" width="571"></p> 
<p style="margin-left:0cm;">        要在Debian 8 Jessie上安装Verto Communicator，git克隆FreeSWITCH源码，并执行：</p> 
<pre class="has"><code class="language-bash">cd /usr/src

git config --global url."https://".insteadOf git://

git clone https://freeswitch.org/stash/scm/fs/freeswitch.git -bv1.6 freeswitch

cd /usr/src/freeswitch/html5/verto/verto_communicator/

./debian8-install.sh

ln -s /usr/src/freeswitch/html5/verto/verto_communicator/dist

/var/www/html/vc</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        然后你需要编辑/var/www/html/vc/config.json，根据你的值修改（把密码改为/usr/local/freeswitch/conf/vars.xml里配置的值）：</p> 
<pre class="has"><code class="language-javascript">{

"login": "1008",

"password": "mydefaultpasswordfromvars.xml", "wsURL": "wss://lab.opentelecomsolutions.com:8082"

}</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        在/usr/src/freeswitch/html5/verto/verto_communicator/src/config.json.sample，有一个更完整的定制配置示例，它由FreeSWITCH内核组开发成员Ken Rice精心制作。</p> 
<p style="margin-left:0cm;">        我们会在第13章，<em>会议与</em><em>WebRTC</em><em>视频会议</em>中再次介绍VC。</p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">WebRTC 聊天室,同时支持SIP和Verto客户端</h2> 
<p style="margin-left:0cm;">        让我们来看一个简单的项目，希望您能够将它用于测试、生产，并作为进一步开发的基础。</p> 
<p style="margin-left:0cm;">        顺便说一句，Len Graham已经改编了一个早期的WebRTC聊天室版本（来自Packt 2016年出版的"Mastering FreeSWITCH" 一书），并把它作成FusionPBX的VERTO客户端插件（FusionPBX官网<a href="http://www.fusionpbx.com" rel="nofollow">www.fusionpbx.com</a>，Mark Crane是它的主要开发人员。FusionPBX是一个完整的Web界面，用于配置和管理基于FreeSWITCH的工业级PBX。）。</p> 
<p style="margin-left:0cm;">        WebRTC聊天室是一个基础的WEB客户端，它能够发起和接收视频呼叫、在通话中发送DTMF，并与FreeSWITCH会议功能的聊天系统对接。它有两个版本，区别在于JavaScript实现会话信令协议的部分。其中一个版本使用SIP，另一个使用VERTO。有趣的是，两个版本的HTML、用户界面、行为、用户体验完全相同。实际上，如果不在浏览器中启动JavaScript控制台，它们是不可区分的。</p> 
<p style="margin-left:0cm;">        下面是sip.js风格的截图（您可以在javascript控制台中看到sip消息），稍后您将看到Verto风格：</p> 
<p><br><img alt="" class="has" height="400" src="https://images2.imgbox.com/4b/11/1kbFx71B_o.png" width="571"></p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;">在WebRTC会议室中聊天</h3> 
<p style="margin-left:0cm;">        通常，会议聊天功能只在VERTO WebRTC客户端可用。通过VERTO协议的保持数据结构交同步分发给所有连接客户端的特性，聊天功能几乎唾手可得。Verto客户端只需要实现接收聊天事件的回调函数就可以。</p> 
<p style="margin-left:0cm;">        SIP协议没有定义数据同步和事件分发的内容，它完全属于另一个世界。SIP WebRTC聊天室的实现只交换“传统”的SIP简单消息，它不使用WebRTC或JavaScript技术获取聊天事件，而只使用SIP技术。实事上，它使用与“传统”SIP硬/软电话相同的SIP即时消息技术（我们将会看到，在WebRTC聊天室里，会议聊天消息可以通过“传统”的SIP硬/软电话接收和发送）。</p> 
<p style="margin-left:0cm;">        作为与SIP会议参与者交换聊天信息的“桥梁”，我们将使用FreeSWITCH内部的CHAT API，以及mod_sms及其聊天方案（chatplan）。</p> 
<p style="margin-left:0cm;">        正如我们稍后将看到的，mod_sms能够截获和路由（根据其chatplan）FreeSWITCH的内部CHAT API相关的所有消息。FreeSWITCH的会议模块(mod_conference)使用FreeSWITCH CHAT API向与会者发送聊天消息。同时，SIP客户端发送的简单SIP消息可以被mod_sms接收，并根据chatplan路由（这和FreeSWITCH接收呼叫并通过拨号方案路由的方式本质上是一样的）。</p> 
<p style="margin-left:0cm;">        因此，考虑接收会议室信息的话，用会议室的CHAT API注册SIP客户端就够了。此外，设置一个chatplan，可以指示mod_sms模块SIP客户端发送过来的简单SIP消息路由给会议的CHAT API。</p> 
<p style="margin-left:0cm;">        顺便说一下，这一机制同样适用于其它实现FreeSWITCH CHAT API的模块，比如说通过mod_dingaling或mod_gsmopen接入的与会者。</p> 
<h3 style="margin-left:0cm;">FreeSWITCH会议</h3> 
<p style="margin-left:0cm;">        FreeSWITCH的会议有许多特性。演示配置实例中，有一个会议"<strong>profile</strong>"，它封装了所有内容。这个"<strong>profile</strong>"名叫"<strong>video-mcu-stereo</strong>"，它是在/usr/local/freeswitch/conf/autoload_configs/conference.conf.xml中定义的。使用演示配置，可以拨打3500-3599接入会议，可以享受<strong>“CD音质的会议”</strong>。</p> 
<p style="margin-left:0cm;">        它提供的最重要特性包括：对视频流混频；屏幕共享；视频特效，如字幕、色度键、画中画、视频播放等等。此外，它还提供了一个聊天和实时显示与会者状态的系统。</p> 
<p style="margin-left:0cm;">        我们将主要用3500进行测试，但如果你更关注资源开销和节省CPU，可以用3000-3099（缺省会议配置，定义了名为"nb_conferences"的extension）。</p> 
<h3 style="margin-left:0cm;">mod_sms 和 chatplan</h3> 
<p style="margin-left:0cm;"><strong>        Chatplan</strong>就是聊天相关的<strong>dialplan</strong>。Chatplan是一种新的黑科技！首先，你必须编辑/usr/local/freeswitch/conf/autoload_configs/modules.conf.xml文件，去掉mod_sms那一行的注释符，这样才能在FS启动时加载mod_sms模块：</p> 
<pre class="has"><code class="language-html">&lt;load module="mod_sms"/&gt;</code></pre> 
<p style="margin-left:0cm;">        接下来，你可以重启FreeSWITCH，或通过fs_cli命令手动加载mod_sms模块：</p> 
<p style="margin-left:0cm;">load mod_sms</p> 
<p style="margin-left:0cm;">        现在，我们必须编辑chatplan，打开/usr/local/freeswitch/conf/chatplan/default.xml：</p> 
<pre class="has"><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;include&gt;

&lt;context name="public"&gt;

&lt;extension name="demo"&gt;

&lt;condition field="to" expression="^(3\d{3})@.*$"&gt;

&lt;action application="info"/&gt;

&lt;action application="set" data="to=${to_user}-${to_host}"/&gt;

&lt;action application="set" data="dest_proto=conf"/&gt;

&lt;action application="set" data="chat_proto=conf"/&gt;

&lt;action application="set" data="skip_global_process=true"/&gt;

&lt;action application="set" data="from=${from_user}"/&gt;

&lt;action application="set" data="final_delivery=true"/&gt;

&lt;action application="set" data="from_full=&lt;sip:${from_user}@${from_host}&gt;"/&gt;

&lt;action application="info"/&gt;

&lt;action application="send"/&gt;

&lt;action application="stop"/&gt;

&lt;action application="info"/&gt;

&lt;/condition&gt;

&lt;/extension&gt;

&lt;/context&gt;

&lt;/include&gt;</code></pre> 
<p style="margin-left:0cm;">        这个chatplan会拦截发送给会议的SIP即时消息（正则表达式以3打头，紧跟3位数字，然后@加上一些内容，对应拨号方案里的会议号码），交把它路由给会议聊天室（to”字段模拟会议聊天事件的内部FreeSWITCH路由）。然后我们修改"from"字段，让它展现在会议聊天室时可读性更好些。</p> 
<p style="margin-left:0cm;">        在转换的前后，我们都所有的变量信息输出到FreeSWITCH控制台（和拨号方案里的"info" APP一样）。 这个chatplan将在SIP即时消息和会议聊天事件间建立桥梁。</p> 
<p style="margin-left:0cm;">别忘记在fs_cli发命令重载FreeSWITCH配置：</p> 
<p style="margin-left:0cm;"><strong>reloadxml</strong></p> 
<p style="margin-left:0cm;"> </p> 
<h3 style="margin-left:0cm;">拨号方案的 "chat_proto" extension</h3> 
<p style="margin-left:0cm;">        在mod_conference内部(conference_event.c 文件)，有一种机制可以将会议中的所有聊天信息广播给所有的参会者（避免二次发送）。</p> 
<p style="margin-left:0cm;">        消息将发给与会者客户端的"presence_id"，但前提是这个客户端通道的"chat_proto"变量值是有效的（例如：mod_conference需要知道对特定的presence_id"向CHAT FS API提供哪个参数）。许多终端模块有它们自己的聊天协议，你甚至可以在fs_cli中使用它：</p> 
<p style="margin-left:0cm;">freeswitch@lxc111&gt; show api chat name,description,syntax,ikey</p> 
<p style="margin-left:0cm;">chat,chat,&lt;proto&gt;|&lt;from&gt;|&lt;to&gt;|&lt;message&gt;|[&lt;content-type&gt;],mod_dptools</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        无论如何，mod_conference广播消息会用到"chat_proto"变量，但只有mod_verto通道会自动设置这个变量值。如果没有chat_proto，使用SIP的与会者将收不到任何聊天消息，我们需要纠正这种歧视。让我们编辑/usr/local/freeswitch/conf/dialplan/default.xml里的拨号方案，在文件的开头处插入以下内容：<br>  </p> 
<pre class="has"><code class="language-html">&lt;extension name="chat1" continue="true"&gt;

&lt;condition field="${source}" expression="^mod_sofia$"&gt;

&lt;action application="set" data="chat_proto=sip"/&gt;

&lt;/condition&gt;

&lt;/extension&gt;

</code></pre> 
<p style="margin-left:0cm;">        这个extension将会为所有来自mod_sofia的呼叫添加"chat_proto"变量，把它设置为"sip"，它对所有SIP呼叫都有效，包括使用SIP的WebRTC呼叫。我们要感谢"continue=true"的参数设置，拨号计划会继续执行，寻找匹配其它extension。</p> 
<h3 style="margin-left:0cm;">HTML</h3> 
<p style="margin-left:0cm;">哈，现在我们进入应用程序的内部圣地。实际上，SIP.js版和VERTO版的HTML (index.html)是相同的。唯一需要更改的是加载哪个JavaScript文件。</p> 
<p style="margin-left:0cm;">下面VERTO版的代码：</p> 
<pre class="has"><code class="language-html">&lt;!DOCTYPE html&gt;

&lt;html lang="en"&gt;

&lt;head&gt;

&lt;meta charset="utf-8"&gt;

&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;

&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;

&lt;!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --&gt;

&lt;meta name="description" content="A WebRTC client for Verto FreeSWITCH module"&gt;

&lt;meta name="author" content="Giovanni Maruzzelli"&gt;

&lt;link rel="icon" href="favicon.ico"&gt;

&lt;title&gt;WebRTC Rooms&lt;/title&gt;

&lt;!-- Bootstrap core CSS --&gt;

&lt;link href="css/bootstrap.min.css" rel="stylesheet"&gt;

&lt;!-- Custom styles for this template --&gt;

&lt;link href="high.css" rel="stylesheet"&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;div id="conference"&gt;

&lt;input type="hidden" id="passwd" value="mysecretpassword_LOL" /&gt;

&lt;input type="hidden" id="cidnumber" value="WebRTC" /&gt;

&lt;div class="form-signin"&gt;

&lt;h2 class="form-signin-heading"&gt;WebRTC Rooms&lt;/h2&gt;

&lt;div id="content" class="form-signin-content"&gt;

&lt;input type=number id="login" min=1000 max=1019 step=1 class="form-control" placeholder="Login with a Number between 1000 and 1019" required autofocus&gt;

&lt;button class="btn btn-lg btn-primary btn-success" data- inline="true" id="loginbtn"&gt;Login&lt;/button&gt;

&lt;input id="ext" class="form-control" placeholder="Insert the Extension to Call or Wait to be Called" required autofocus&gt;

&lt;button class="btn btn-lg btn-primary btn-success" data- inline="true" id="callbtn"&gt;Call&lt;/button&gt;

&lt;button class="btn btn-lg btn-primary btn-danger" data- inline="true" id="backbtn"&gt;Back&lt;/button&gt;

&lt;/div&gt;

&lt;div id="video1" align="center" class="embed-responsive embed- responsive-4by3"&gt;

&lt;video id="webcam" autoplay="autoplay" class="embed- responsive-item"&gt; &lt;/video&gt;

&lt;/div&gt;

&lt;button class="btn btn-lg btn-primary btn-danger" data- inline="true" id="hupbtn"&gt;Hangup&lt;/button&gt;

&lt;br id="br" /&gt;

&lt;textarea id="chatwin" class="form-control" rows="5" readonly&gt;&lt;/textarea&gt;

&lt;br id="br" /&gt;

&lt;input id="chatmsg" class="form-control" rows="1" placeholder="type here your chat msg" autofocus&gt;&lt;/input&gt;

&lt;button class="btn btn-primary btn-success" data-inline="true" id="chatsend"&gt;Send Msg&lt;/button&gt;

&lt;/div&gt;

&lt;div align="center" class="inner"&gt;

&lt;p&gt;2017&lt;br/&gt;Giovanni Maruzzelli - OpenTelecom.IT&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;

&lt;script type="text/javascript" src="js/jquery.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/jquery.json-2.4.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/verto-min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/md5.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="high2.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre> 
<p style="margin-left:0cm;">        这个文件使用CSS的引导框架，因此它可以在移动设备上完美工作，并适应各种不同的显示格式和尺寸。前几行代码就是为这个目的而写，设置一个极简但快速的GUI界面。在接下来的HTML主体中，有许多DIV、BUTTON、 INPUT、TEXTAREA，每个都有它自己的ID。</p> 
<p style="margin-left:0cm;">        我们将会在Javascript中用这些ID来引用每个独立的HTML元素，可以控制它们的显示和隐藏（比如说，在注册成功后隐藏登陆按钮），或者读取输入内容，或者输出某些内容（我们需要读取呼叫的号码，需要在文本区显示聊天的内容）。</p> 
<p style="margin-left:0cm;">        我们有一个特殊的"video"元素，bootstrap.css以一种漂亮的方式在各种设备上展示它。它的"id"将被VERTO和SIP.js的初始化脚本引用（例如，他们需要知道在哪里显示视频流）。</p> 
<p style="margin-left:0cm;">最        后几行说明要加载的脚本。我们认得verto-min.js，它来自/usr/src/freeswitch/html5/verto/video_demo/js/verto-min.js，是VERTO JavaScript库的一种风格，随FreeSWITCH源码发布。在我们的脚本里，与HTML元素的ID交互的是high2.js。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">修改index.html的最后几行，加载SIP.js相关的几个脚本：</p> 
<pre class="has"><code class="language-html">&lt;script type="text/javascript" src="js/jquery.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/jquery.json-2.4.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/sip.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="js/md5.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="highsipjs2.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">         我们之前描述过<strong>sip.js</strong>库，可以从<a href="http://sipjs.com/download/" rel="nofollow">h</a><a href="http://sipjs.com/download/" rel="nofollow">t</a><a href="http://sipjs.com/download/" rel="nofollow">t</a><a href="http://sipjs.com/download/" rel="nofollow">p</a><a href="http://sipjs.com/download/" rel="nofollow">://s</a><a href="http://sipjs.com/download/" rel="nofollow">i</a><a href="http://sipjs.com/download/" rel="nofollow">p</a><a href="http://sipjs.com/download/" rel="nofollow">j</a><a href="http://sipjs.com/download/" rel="nofollow">s</a><a href="http://sipjs.com/download/" rel="nofollow">.</a><a href="http://sipjs.com/download/" rel="nofollow">c</a><a href="http://sipjs.com/download/" rel="nofollow">o</a><a href="http://sipjs.com/download/" rel="nofollow">m</a><a href="http://sipjs.com/download/" rel="nofollow">/d</a><a href="http://sipjs.com/download/" rel="nofollow">o</a><a href="http://sipjs.com/download/" rel="nofollow">w</a><a href="http://sipjs.com/download/" rel="nofollow">n</a><a href="http://sipjs.com/download/" rel="nofollow">l</a><a href="http://sipjs.com/download/" rel="nofollow">o</a><a href="http://sipjs.com/download/" rel="nofollow">a</a><a href="http://sipjs.com/download/" rel="nofollow">d</a><a href="http://sipjs.com/download/" rel="nofollow">/ </a>下载最新的版本。最后的highsipjs2.js是我们写的脚本。</p> 
<p> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        下面是VERTO 版的一个截图，我们打开Javascript 控制台，可以看到Verto 对象：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="403" src="https://images2.imgbox.com/b5/95/UE4sAIa7_o.png" width="571"></p> 
<h3 style="margin-left:0cm;"> </h3> 
<h3 style="margin-left:0cm;">JavaScript</h3> 
<p style="margin-left:0cm;">无论是<strong>VERTO</strong><strong>版</strong>还是<strong>SIP</strong>.js版，WebRTC聊天室的脚本是非常相似的。事实上，首先实现的是VERTO版，它是2016年出版的《"Mastering FreeSWITCH"》一书里的实例。在这本书中，你可以看到逐行的解说。新版中解决了一些问题，并增加了一些特性（自动应答、更友好的DTMF发送方式、可以呼叫非数字的分机，以及各种优化）。</p> 
<pre class="has"><code class="language-javascript">$(window).load(function() { cur_call = null; chatting_with = false;

$("#conference").show();

$("#ext").hide();

$("#backbtn").hide();

$("#cidname").hide();

$("#callbtn").hide();

$("#hupbtn").hide();

$("#chatwin").hide();

$("#chatmsg").hide();

$("#chatsend").hide();

$("#webcam").hide();

$("#video1").hide();

$("#login").keyup(function(event) {

if (event.keyCode == 13 &amp;&amp; !event.shiftKey) {

$("#loginbtn").trigger("click");

}

});

$("#ext").keyup(function(event) {

if (event.keyCode == 13 &amp;&amp; !event.shiftKey) {

$("#callbtn").trigger("click");

});

}

});</code></pre> 
<p> </p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">启动时，两种风格的脚本都执行"load"函数，它设置HTML的可见元素，并定义了用户在登陆框或输入分机时按“回车”键的响应方式。</p> 
<p style="margin-left:0cm;">用户填入登陆信息并按回车或点击登陆按钮时，会执行init()函数。在init()函数内部，创建主要的JavaScript对象----我们的WebRTC UA客户端。让我们看下SIP.js风格的代码，VERTO风格的很相似：</p> 
<pre class="has"><code class="language-javascript">function init() { cur_call = null;

chatting_with = false;

var nameHost;

var which_server;

nameHost = window.location.hostname;

which_server = "wss://" + nameHost + ":" + "3384"; console.error("which_server=", which_server);

ua = new SIP.UA({

wsServers: which_server,

uri: $("#login").val() + "@" + nameHost,

password: $("#passwd").val(), userAgentString: 'SIP.js/0.7.7 Sara', traceSip: true,

});



$("#cidname").keyup(function(event) {

if (event.keyCode == 13 &amp;&amp; !event.shiftKey) {

$("#callbtn").trigger("click");

}

});

setupChat();

$(document).keypress(function(event) {

var key = String.fromCharCode(event.keyCode || event.charCode); var i = parseInt(key);

var tag = event.target.tagName.toLowerCase();



if (tag != 'input') {

if (key === "#" || key === "*" || key === "0" || (i &gt; 0 &amp;&amp; i &lt;=9)) {

cur_call.dtmf(key);

}

}

});

}</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        我们首先确保没有呼叫和聊天数据，清空数据结构。然后确定要连接的服务器（在基于域的分区进行大规模扩展时很有用），然后使用从HTML获取的值创建主要对象，即”ua”对象。</p> 
<p style="margin-left:0cm;">        我们准备在输入被叫号码时响应回车按键。</p> 
<p style="margin-left:0cm;">        然后，我们调用setupChat()函数，这个函数对两种风格的实现来说有些细微的差别。这是因为：在VERTO风格的实现中，我们需要填充"from"字段，而在SIP.js风格的实现中，这些字段由主对象自动设置。下面是VERTO风格的代码：</p> 
<pre class="has"><code class="language-javascript">function setupChat() {

$("#chatwin").html("");



$("#chatsend").click(function() {

if (!cur_call &amp;&amp; chatting_with) { return;

}

cur_call.message({

to: chatting_with,

body: $("#chatmsg").val(),

from_msg_name: cur_call.params.caller_id_name, from_msg_number: cur_call.params.caller_id_number

});

$("#chatmsg").val("");

});



$("#chatmsg").keyup(function(event) {

if (event.keyCode == 13 &amp;&amp; !event.shiftKey) {

$("#chatsend").trigger("click");

}

});

}</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        然后，我们可以管理许多按钮和场景：挂机、回退、呼叫，诸如此类。</p> 
<p style="margin-left:0cm;">        “呼叫”按钮执行docall()函数，两种风格的代码还是很相似：在SIP.js风格中调用INVITE方法，而在VERTO风格中调用newCall方法。它们得到或多或少相似的参数表：在VERTO风格代码中，你在主对象初始化时设置事件的回调函数；而SIP.js风格代码中，现在设置回调。</p> 
<p style="margin-left:0cm;">        让我们看看VERTO风格的代码：</p> 
<pre class="has"><code class="language-javascript">function docall() { if (cur_call) {

return;

}

cur_call = verto.newCall({ destination_number: $("#ext").val(), caller_id_name: $("#login").val(), caller_id_number: $("#login").val(), useVideo: true,

useStereo: true, useCamera: 'any', useSpeak: 'any', useMic: 'any'

});

}</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        脚本的其余部分都是在设置回调，以响应聊天消息、挂机、以及会话的建立（比如等待对端应答）等等。</p> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">      下面是FreeSWITCH控制台的一幅截图，显示了chatplan信息，SIP的即时消息，还有Verto消息。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="425" src="https://images2.imgbox.com/86/1f/B00DtQWC_o.png" width="571"></p> 
<p style="margin-left:0cm;">让我们看看来电应答处理的区别（两种风格的代码都会自动替你应答）。</p> 
<p style="margin-left:0cm;">SIP.js注册handleInvite函数作为来电事件的回调函数，下面是实现代码：</p> 
<pre class="has"><code class="language-javascript">function handleInvite(s) { cur_call = s;

s.accept({

media: {

constraints: { audio: true,

video: true

},

render: {

remote: document.getElementById('webcam')

}

}

});

$("#ext").val(s.remoteIdentity.uri.toString()); cur_call.on('accepted', onAccepted.bind(cur_call)); cur_call.once('bye', onTerminated.bind(cur_call)); cur_call.once('failed', onTerminated.bind(cur_call)); cur_call.once('cancel', onTerminated.bind(cur_call));

$("#chatwin").html("");

}</code></pre> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">        它接受呼叫，为媒体流给出自己的约束，设置一些呼叫事件（成功、远程挂机等）的回调，然后设置几个HTML字段的内容。</p> 
<p style="margin-left:0cm;">        VERTO风格的脚本同样注册了来电事件和状态变化（类似GUI消息驱动的编程风格）的回调函数：</p> 
<pre class="has"><code class="language-javascript">onDialogState: function(d) { if (!cur_call) {

cur_call = d;

}

switch (d.state) {

case $.verto.enum.state.ringing: console.error("RINGING");



$("#webcam").show();

$("#video1").show(); cur_call.answer({

callee_id_name: "ciao", callee_id_number: "1234567", useVideo: true,

useStereo: true, useCamera: true, useMic: true

});

break;</code></pre> 
<p> </p> 
<h3 style="margin-left:0cm;">待办事项</h3> 
<p style="margin-left:0cm;">        内容很多！比如，用VERTO实现直接聊天（会议之外，普通呼叫的即时消息）。</p> 
<p style="margin-left:0cm;">        在SIP.js版本中，在聊天文本区打印发送的消息（接收消息的显示已经实现了）。</p> 
<p style="margin-left:0cm;">        交互与视觉的优化。</p> 
<p style="margin-left:0cm;">        添加按钮、菜单和命令来管理会议布局，版主职责，桌面共享等。</p> 
<p style="margin-left:0cm;">        对呼叫失败进行更健壮的管理，在出现问题时进行健壮的清理。</p> 
<p style="margin-left:0cm;"> </p> 
<h2 style="margin-left:0cm;">总结</h2> 
<p style="margin-left:0cm;">这一章，我们讨论了以下内容：</p> 
<ol><li>什么是 WebRTC？它有什么意义？</li><li>WebRTC中的强制安全</li><li>FreeSWITCH的WebRTC 实现</li><li>WebRTC中，信令协议 (SIP 和 Verto) 所扮演的角色</li><li>完成 FreeSWITCH 和支持WebRTC 的组件安装和配置(包括证书、Web服务器)</li><li>介绍一个超级先进和功能齐全的浏览器客户端，可实现WebRTC 视频会议和状态呈现：Verto Communicator</li><li>怎样用VERTO 或SIP.js 实现一个Web客户端</li></ol> 
<p style="margin-left:0cm;"> </p> 
<p style="margin-left:0cm;">      这一章，我们研究了理论和细节，并学习了如何为我们的用户群建立真实的WebRTC服务。</p> 
<p style="margin-left:0cm;">       下一章，我们将深入XML拨号方案—FreeSWITCH内核的呼叫路由引擎。我们将研究如何实现最多样化的服务，同时利用缺省演示配置中的丰富示例。</p> 
<p style="margin-left:0cm;"> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b847d031cd20264c5aaff5f826fc2b22/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python selenium 启动浏览器，有无界面</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6dc565166ca1ed545a7de5eda147296e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">teamviewer检测为商业用途 5分钟后关闭解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程爱好者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151260"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>